<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="robots" content="noindex">

	<title>File vues/html2pdf/_tcpdf_5.0.002/tcpdf.php</title>

	<link rel="stylesheet" href="resources/style.css?e99947befd7bf673c6b43ff75e9e0f170c88a60e">

</head>

<body>
<div id="left">
	<div id="menu">
		<a href="index.html" title="Overview"><span>Overview</span></a>


		<div id="groups">
				<h3>Packages</h3>
			<ul>
				<li>
					<a href="package-com.html">
						com<span></span>
					</a>

						<ul>
				<li>
					<a href="package-com.tecnick.html">
						tecnick<span></span>
					</a>

						<ul>
				<li>
					<a href="package-com.tecnick.tcpdf.html">
						tcpdf					</a>

						</li>
							</ul></li></ul></li>
				<li>
					<a href="package-default.html">
						default					</a>

						</li>
				<li>
					<a href="package-None.html">
						None					</a>

						</li>
			</ul>
		</div>

		<hr>


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li><a href="class-HTML2PDF.html" class="invalid">HTML2PDF</a></li>
				<li><a href="class-HTML2PDF_exception.html">HTML2PDF_exception</a></li>
				<li><a href="class-HTML2PDF_locale.html">HTML2PDF_locale</a></li>
				<li><a href="class-HTML2PDF_myPdf.html">HTML2PDF_myPdf</a></li>
				<li><a href="class-HTML2PDF_parsingCss.html">HTML2PDF_parsingCss</a></li>
				<li><a href="class-HTML2PDF_parsingHtml.html">HTML2PDF_parsingHtml</a></li>
				<li><a href="class-PdoGsb.html">PdoGsb</a></li>
				<li><a href="class-QRcode.html">QRcode</a></li>
				<li><a href="class-TCPDF.html">TCPDF</a></li>
				<li><a href="class-TCPDF2DBarcode.html">TCPDF2DBarcode</a></li>
				<li><a href="class-TCPDFBarcode.html">TCPDFBarcode</a></li>
			</ul>





			<h3>Functions</h3>
			<ul>
				<li><a href="function-ajouterErreur.html">ajouterErreur</a></li>
				<li><a href="function-CheckTTF.html">CheckTTF</a></li>
				<li><a href="function-connecter.html">connecter</a></li>
				<li><a href="function-creationFichesFrais.html">creationFichesFrais</a></li>
				<li><a href="function-creationFraisForfait.html">creationFraisForfait</a></li>
				<li><a href="function-creationFraisHorsForfait.html">creationFraisHorsForfait</a></li>
				<li><a href="function-dateAnglaisVersFrancais.html">dateAnglaisVersFrancais</a></li>
				<li><a href="function-dateFrancaisVersAnglais.html">dateFrancaisVersAnglais</a></li>
				<li><a href="function-deconnecter.html">deconnecter</a></li>
				<li><a href="function-estConnecte.html">estConnecte</a></li>
				<li><a href="function-estDateDepassee.html">estDateDepassee</a></li>
				<li><a href="function-estDateValide.html">estDateValide</a></li>
				<li><a href="function-estEntierPositif.html">estEntierPositif</a></li>
				<li><a href="function-estTableauEntiers.html">estTableauEntiers</a></li>
				<li><a href="function-fnReadDir.html">fnReadDir</a></li>
				<li><a href="function-getDernierMois.html">getDernierMois</a></li>
				<li><a href="function-getDesFraisHorsForfait.html">getDesFraisHorsForfait</a></li>
				<li><a href="function-getLesFichesFrais.html">getLesFichesFrais</a></li>
				<li><a href="function-getLesIdFraisForfait.html">getLesIdFraisForfait</a></li>
				<li><a href="function-getLesVisiteurs.html">getLesVisiteurs</a></li>
				<li><a href="function-getMois.html" class="invalid">getMois</a></li>
				<li><a href="function-getMoisPrecedent.html">getMoisPrecedent</a></li>
				<li><a href="function-getMoisSuivant.html">getMoisSuivant</a></li>
				<li><a href="function-lesQteFraisValides.html">lesQteFraisValides</a></li>
				<li><a href="function-majFicheFrais.html">majFicheFrais</a></li>
				<li><a href="function-MakeFont.html">MakeFont</a></li>
				<li><a href="function-MakeFontDescriptor.html">MakeFontDescriptor</a></li>
				<li><a href="function-MakeFontEncoding.html">MakeFontEncoding</a></li>
				<li><a href="function-MakeWidthArray.html">MakeWidthArray</a></li>
				<li><a href="function-nbErreurs.html">nbErreurs</a></li>
				<li><a href="function-ReadAFM.html">ReadAFM</a></li>
				<li><a href="function-ReadLong.html">ReadLong</a></li>
				<li><a href="function-ReadMap.html">ReadMap</a></li>
				<li><a href="function-ReadShort.html">ReadShort</a></li>
				<li><a href="function-ReadUFM.html">ReadUFM</a></li>
				<li><a href="function-SaveToFile.html">SaveToFile</a></li>
				<li><a href="function-str_split.html">str_split</a></li>
				<li><a href="function-updateMdpVisiteur.html">updateMdpVisiteur</a></li>
				<li><a href="function-valideInfosFrais.html">valideInfosFrais</a></li>
			</ul>
		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
<div id="rightInner">
	<form id="search">
		<input type="hidden" name="cx" value="">
		<input type="hidden" name="ie" value="UTF-8">
		<input type="text" name="q" class="text" placeholder="Search">
	</form>

	<div id="navigation">
		<ul>
			<li>
				<a href="index.html" title="Overview"><span>Overview</span></a>
			</li>
			<li>
<span>Package</span>			</li>
			<li>
<span>Class</span>			</li>
		</ul>
		<ul>
		</ul>
		<ul>
		</ul>
	</div>

<pre><code><span id="1" class="l"><a href="#1">    1: </a><span class="xlang">&lt;?php</span>
</span><span id="2" class="l"><a href="#2">    2: </a><span class="php-comment">//============================================================+</span>
</span><span id="3" class="l"><a href="#3">    3: </a><span class="php-comment">// File name   : tcpdf.php</span>
</span><span id="4" class="l"><a href="#4">    4: </a><span class="php-comment">// Begin       : 2002-08-03</span>
</span><span id="5" class="l"><a href="#5">    5: </a><span class="php-comment">// Last Update : 2010-05-06</span>
</span><span id="6" class="l"><a href="#6">    6: </a><span class="php-comment">// Author      : Nicola Asuni - info@tecnick.com - http://www.tcpdf.org</span>
</span><span id="7" class="l"><a href="#7">    7: </a><span class="php-comment">// Version     : 5.0.002</span>
</span><span id="8" class="l"><a href="#8">    8: </a><span class="php-comment">// License     : GNU LGPL (http://www.gnu.org/copyleft/lesser.html)</span>
</span><span id="9" class="l"><a href="#9">    9: </a><span class="php-comment">//  ----------------------------------------------------------------------------</span>
</span><span id="10" class="l"><a href="#10">   10: </a><span class="php-comment">//  Copyright (C) 2002-2010  Nicola Asuni - Tecnick.com S.r.l.</span>
</span><span id="11" class="l"><a href="#11">   11: </a><span class="php-comment">//</span>
</span><span id="12" class="l"><a href="#12">   12: </a><span class="php-comment">//  This program is free software: you can redistribute it and/or modify</span>
</span><span id="13" class="l"><a href="#13">   13: </a><span class="php-comment">//  it under the terms of the GNU Lesser General Public License as published by</span>
</span><span id="14" class="l"><a href="#14">   14: </a><span class="php-comment">//  the Free Software Foundation, either version 2.1 of the License, or</span>
</span><span id="15" class="l"><a href="#15">   15: </a><span class="php-comment">//  (at your option) any later version.</span>
</span><span id="16" class="l"><a href="#16">   16: </a><span class="php-comment">//</span>
</span><span id="17" class="l"><a href="#17">   17: </a><span class="php-comment">//  This program is distributed in the hope that it will be useful,</span>
</span><span id="18" class="l"><a href="#18">   18: </a><span class="php-comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="19" class="l"><a href="#19">   19: </a><span class="php-comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="20" class="l"><a href="#20">   20: </a><span class="php-comment">//  GNU Lesser General Public License for more details.</span>
</span><span id="21" class="l"><a href="#21">   21: </a><span class="php-comment">//</span>
</span><span id="22" class="l"><a href="#22">   22: </a><span class="php-comment">//  You should have received a copy of the GNU Lesser General Public License</span>
</span><span id="23" class="l"><a href="#23">   23: </a><span class="php-comment">//  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
</span><span id="24" class="l"><a href="#24">   24: </a><span class="php-comment">//</span>
</span><span id="25" class="l"><a href="#25">   25: </a><span class="php-comment">//  See LICENSE.TXT file for more information.</span>
</span><span id="26" class="l"><a href="#26">   26: </a><span class="php-comment">//  ----------------------------------------------------------------------------</span>
</span><span id="27" class="l"><a href="#27">   27: </a><span class="php-comment">//</span>
</span><span id="28" class="l"><a href="#28">   28: </a><span class="php-comment">// Description : This is a PHP class for generating PDF documents without</span>
</span><span id="29" class="l"><a href="#29">   29: </a><span class="php-comment">//               requiring external extensions.</span>
</span><span id="30" class="l"><a href="#30">   30: </a><span class="php-comment">//</span>
</span><span id="31" class="l"><a href="#31">   31: </a><span class="php-comment">// NOTE:</span>
</span><span id="32" class="l"><a href="#32">   32: </a><span class="php-comment">// This class was originally derived in 2002 from the Public</span>
</span><span id="33" class="l"><a href="#33">   33: </a><span class="php-comment">// Domain FPDF class by Olivier Plathey (http://www.fpdf.org),</span>
</span><span id="34" class="l"><a href="#34">   34: </a><span class="php-comment">// but now is almost entirely rewritten.</span>
</span><span id="35" class="l"><a href="#35">   35: </a><span class="php-comment">//</span>
</span><span id="36" class="l"><a href="#36">   36: </a><span class="php-comment">// Main features:</span>
</span><span id="37" class="l"><a href="#37">   37: </a><span class="php-comment">//  * no external libraries are required for the basic functions;</span>
</span><span id="38" class="l"><a href="#38">   38: </a><span class="php-comment">//  * all ISO page formats, custom page formats, custom margins and units of measure;</span>
</span><span id="39" class="l"><a href="#39">   39: </a><span class="php-comment">//  * UTF-8 Unicode and Right-To-Left languages;</span>
</span><span id="40" class="l"><a href="#40">   40: </a><span class="php-comment">//  * TrueTypeUnicode, OpenTypeUnicode, TrueType, OpenType, Type1 and CID-0 fonts;</span>
</span><span id="41" class="l"><a href="#41">   41: </a><span class="php-comment">//  * methods to publish some XHTML code, Javascript and Forms;</span>
</span><span id="42" class="l"><a href="#42">   42: </a><span class="php-comment">//  * images, graphic (geometric figures) and transformation methods;</span>
</span><span id="43" class="l"><a href="#43">   43: </a><span class="php-comment">//  * supports JPEG, PNG and SVG images natively, all images supported by GD (GD, GD2, GD2PART, GIF, JPEG, PNG, BMP, XBM, XPM) and all images supported via ImagMagick (http://www.imagemagick.org/www/formats.html)</span>
</span><span id="44" class="l"><a href="#44">   44: </a><span class="php-comment">//  * 1D and 2D barcodes: CODE 39, ANSI MH10.8M-1983, USD-3, 3 of 9, CODE 93, USS-93, Standard 2 of 5, Interleaved 2 of 5, CODE 128 A/B/C, 2 and 5 Digits UPC-Based Extention, EAN 8, EAN 13, UPC-A, UPC-E, MSI, POSTNET, PLANET, RMS4CC (Royal Mail 4-state Customer Code), CBC (Customer Bar Code), KIX (Klant index - Customer index), Intelligent Mail Barcode, Onecode, USPS-B-3200, CODABAR, CODE 11, PHARMACODE, PHARMACODE TWO-TRACKS, QR-Code;</span>
</span><span id="45" class="l"><a href="#45">   45: </a><span class="php-comment">//  * Grayscale, RGB, CMYK, Spot Colors and Transparencies;</span>
</span><span id="46" class="l"><a href="#46">   46: </a><span class="php-comment">//  * automatic page header and footer management;</span>
</span><span id="47" class="l"><a href="#47">   47: </a><span class="php-comment">//  * document encryption and digital signature certifications;</span>
</span><span id="48" class="l"><a href="#48">   48: </a><span class="php-comment">//  * transactions to UNDO commands;</span>
</span><span id="49" class="l"><a href="#49">   49: </a><span class="php-comment">//  * PDF annotations, including links, text and file attachments;</span>
</span><span id="50" class="l"><a href="#50">   50: </a><span class="php-comment">//  * text rendering modes (fill, stroke and clipping);</span>
</span><span id="51" class="l"><a href="#51">   51: </a><span class="php-comment">//  * multiple columns mode;</span>
</span><span id="52" class="l"><a href="#52">   52: </a><span class="php-comment">//  * bookmarks and table of content;</span>
</span><span id="53" class="l"><a href="#53">   53: </a><span class="php-comment">//  * text hyphenation;</span>
</span><span id="54" class="l"><a href="#54">   54: </a><span class="php-comment">//  * automatic page break, line break and text alignments including justification;</span>
</span><span id="55" class="l"><a href="#55">   55: </a><span class="php-comment">//  * automatic page numbering and page groups;</span>
</span><span id="56" class="l"><a href="#56">   56: </a><span class="php-comment">//  * move and delete pages;</span>
</span><span id="57" class="l"><a href="#57">   57: </a><span class="php-comment">//  * page compression (requires php-zlib extension);</span>
</span><span id="58" class="l"><a href="#58">   58: </a><span class="php-comment">//</span>
</span><span id="59" class="l"><a href="#59">   59: </a><span class="php-comment">// -----------------------------------------------------------</span>
</span><span id="60" class="l"><a href="#60">   60: </a><span class="php-comment">// THANKS TO:</span>
</span><span id="61" class="l"><a href="#61">   61: </a><span class="php-comment">//</span>
</span><span id="62" class="l"><a href="#62">   62: </a><span class="php-comment">// Olivier Plathey (http://www.fpdf.org) for original FPDF.</span>
</span><span id="63" class="l"><a href="#63">   63: </a><span class="php-comment">// Efthimios Mavrogeorgiadis (emavro@yahoo.com) for suggestions on RTL language support.</span>
</span><span id="64" class="l"><a href="#64">   64: </a><span class="php-comment">// Klemen Vodopivec (http://www.fpdf.de/downloads/addons/37/) for Encryption algorithm.</span>
</span><span id="65" class="l"><a href="#65">   65: </a><span class="php-comment">// Warren Sherliker (wsherliker@gmail.com) for better image handling.</span>
</span><span id="66" class="l"><a href="#66">   66: </a><span class="php-comment">// dullus for text Justification.</span>
</span><span id="67" class="l"><a href="#67">   67: </a><span class="php-comment">// Bob Vincent (pillarsdotnet@users.sourceforge.net) for &lt;li&gt; value attribute.</span>
</span><span id="68" class="l"><a href="#68">   68: </a><span class="php-comment">// Patrick Benny for text stretch suggestion on Cell().</span>
</span><span id="69" class="l"><a href="#69">   69: </a><span class="php-comment">//</span>
</span><span id="70" class="l"><a href="#70">   70: </a><span class="php-comment">// Denis Van Nuffelen for Dynamic Form.</span>
</span><span id="71" class="l"><a href="#71">   71: </a><span class="php-comment">// Jacek Czekaj for multibyte justification</span>
</span><span id="72" class="l"><a href="#72">   72: </a><span class="php-comment">// Anthony Ferrara for the reintroduction of legacy image methods.</span>
</span><span id="73" class="l"><a href="#73">   73: </a><span class="php-comment">// Sourceforge user 1707880 (hucste) for line-trough mode.</span>
</span><span id="74" class="l"><a href="#74">   74: </a><span class="php-comment">// Larry Stanbery for page groups.</span>
</span><span id="75" class="l"><a href="#75">   75: </a><span class="php-comment">// Martin Hall-May for transparency.</span>
</span><span id="76" class="l"><a href="#76">   76: </a><span class="php-comment">// Aaron C. Spike for Polycurve method.</span>
</span><span id="77" class="l"><a href="#77">   77: </a><span class="php-comment">// Mohamad Ali Golkar, Saleh AlMatrafe, Charles Abbott for Arabic and Persian support.</span>
</span><span id="78" class="l"><a href="#78">   78: </a><span class="php-comment">// Moritz Wagner and Andreas Wurmser for graphic functions.</span>
</span><span id="79" class="l"><a href="#79">   79: </a><span class="php-comment">// Andrew Whitehead for core fonts support.</span>
</span><span id="80" class="l"><a href="#80">   80: </a><span class="php-comment">//</span>
</span><span id="81" class="l"><a href="#81">   81: </a><span class="php-comment">// Teus Hagen for several suggestions and fixes.</span>
</span><span id="82" class="l"><a href="#82">   82: </a><span class="php-comment">// Yukihiro Nakadaira for CID-0 CJK fonts fixes.</span>
</span><span id="83" class="l"><a href="#83">   83: </a><span class="php-comment">// Kosmas Papachristos for some CSS improvements.</span>
</span><span id="84" class="l"><a href="#84">   84: </a><span class="php-comment">// Marcel Partap for some fixes.</span>
</span><span id="85" class="l"><a href="#85">   85: </a><span class="php-comment">// Won Kyu Park for several suggestions, fixes and patches.</span>
</span><span id="86" class="l"><a href="#86">   86: </a><span class="php-comment">// Dominik Dzienia for QR-code support.</span>
</span><span id="87" class="l"><a href="#87">   87: </a><span class="php-comment">// Laurent Minguet for some suggestions.</span>
</span><span id="88" class="l"><a href="#88">   88: </a><span class="php-comment">// Anyone that has reported a bug or sent a suggestion.</span>
</span><span id="89" class="l"><a href="#89">   89: </a><span class="php-comment">//============================================================+</span>
</span><span id="90" class="l"><a href="#90">   90: </a>
</span><span id="91" class="l"><a href="#91">   91: </a><span class="php-comment">/**
</span></span><span id="92" class="l"><a href="#92">   92: </a><span class="php-comment"> * This is a PHP class for generating PDF documents without requiring external extensions.&lt;br&gt;
</span></span><span id="93" class="l"><a href="#93">   93: </a><span class="php-comment"> * TCPDF project (http://www.tcpdf.org) was originally derived in 2002 from the Public Domain FPDF class by Olivier Plathey (http://www.fpdf.org), but now is almost entirely rewritten.&lt;br&gt;
</span></span><span id="94" class="l"><a href="#94">   94: </a><span class="php-comment"> * &lt;h3&gt;TCPDF main features are:&lt;/h3&gt;
</span></span><span id="95" class="l"><a href="#95">   95: </a><span class="php-comment"> * &lt;ul&gt;
</span></span><span id="96" class="l"><a href="#96">   96: </a><span class="php-comment"> * &lt;li&gt;no external libraries are required for the basic functions;&lt;/li&gt;
</span></span><span id="97" class="l"><a href="#97">   97: </a><span class="php-comment"> * &lt;li&gt;all ISO page formats, custom page formats, custom margins and units of measure;&lt;/li&gt;
</span></span><span id="98" class="l"><a href="#98">   98: </a><span class="php-comment"> * &lt;li&gt;UTF-8 Unicode and Right-To-Left languages;&lt;/li&gt;
</span></span><span id="99" class="l"><a href="#99">   99: </a><span class="php-comment"> * &lt;li&gt;TrueTypeUnicode, OpenTypeUnicode, TrueType, OpenType, Type1 and CID-0 fonts;&lt;/li&gt;
</span></span><span id="100" class="l"><a href="#100">  100: </a><span class="php-comment"> * &lt;li&gt;methods to publish some XHTML code, Javascript and Forms;&lt;/li&gt;
</span></span><span id="101" class="l"><a href="#101">  101: </a><span class="php-comment"> * &lt;li&gt;images, graphic (geometric figures) and transformation methods;
</span></span><span id="102" class="l"><a href="#102">  102: </a><span class="php-comment"> * &lt;li&gt;supports JPEG, PNG and SVG images natively, all images supported by GD (GD, GD2, GD2PART, GIF, JPEG, PNG, BMP, XBM, XPM) and all images supported via ImagMagick (http://www.imagemagick.org/www/formats.html)&lt;/li&gt;
</span></span><span id="103" class="l"><a href="#103">  103: </a><span class="php-comment"> * &lt;li&gt;1D and 2D barcodes: CODE 39, ANSI MH10.8M-1983, USD-3, 3 of 9, CODE 93, USS-93, Standard 2 of 5, Interleaved 2 of 5, CODE 128 A/B/C, 2 and 5 Digits UPC-Based Extention, EAN 8, EAN 13, UPC-A, UPC-E, MSI, POSTNET, PLANET, RMS4CC (Royal Mail 4-state Customer Code), CBC (Customer Bar Code), KIX (Klant index - Customer index), Intelligent Mail Barcode, Onecode, USPS-B-3200, CODABAR, CODE 11, PHARMACODE, PHARMACODE TWO-TRACKS, QR-Code;&lt;/li&gt;
</span></span><span id="104" class="l"><a href="#104">  104: </a><span class="php-comment"> * &lt;li&gt;Grayscale, RGB, CMYK, Spot Colors and Transparencies;&lt;/li&gt;
</span></span><span id="105" class="l"><a href="#105">  105: </a><span class="php-comment"> * &lt;li&gt;automatic page header and footer management;&lt;/li&gt;
</span></span><span id="106" class="l"><a href="#106">  106: </a><span class="php-comment"> * &lt;li&gt;document encryption and digital signature certifications;&lt;/li&gt;
</span></span><span id="107" class="l"><a href="#107">  107: </a><span class="php-comment"> * &lt;li&gt;transactions to UNDO commands;&lt;/li&gt;
</span></span><span id="108" class="l"><a href="#108">  108: </a><span class="php-comment"> * &lt;li&gt;PDF annotations, including links, text and file attachments;&lt;/li&gt;
</span></span><span id="109" class="l"><a href="#109">  109: </a><span class="php-comment"> * &lt;li&gt;text rendering modes (fill, stroke and clipping);&lt;/li&gt;
</span></span><span id="110" class="l"><a href="#110">  110: </a><span class="php-comment"> * &lt;li&gt;multiple columns mode;&lt;/li&gt;
</span></span><span id="111" class="l"><a href="#111">  111: </a><span class="php-comment"> * &lt;li&gt;bookmarks and table of content;&lt;/li&gt;
</span></span><span id="112" class="l"><a href="#112">  112: </a><span class="php-comment"> * &lt;li&gt;text hyphenation;&lt;/li&gt;
</span></span><span id="113" class="l"><a href="#113">  113: </a><span class="php-comment"> * &lt;li&gt;automatic page break, line break and text alignments including justification;&lt;/li&gt;
</span></span><span id="114" class="l"><a href="#114">  114: </a><span class="php-comment"> * &lt;li&gt;automatic page numbering and page groups;&lt;/li&gt;
</span></span><span id="115" class="l"><a href="#115">  115: </a><span class="php-comment"> * &lt;li&gt;move and delete pages;&lt;/li&gt;
</span></span><span id="116" class="l"><a href="#116">  116: </a><span class="php-comment"> * &lt;li&gt;page compression (requires php-zlib extension);&lt;/li&gt;
</span></span><span id="117" class="l"><a href="#117">  117: </a><span class="php-comment"> * &lt;/ul&gt;
</span></span><span id="118" class="l"><a href="#118">  118: </a><span class="php-comment"> * Tools to encode your unicode fonts are on fonts/utils directory.&lt;/p&gt;
</span></span><span id="119" class="l"><a href="#119">  119: </a><span class="php-comment"> * @package com.tecnick.tcpdf
</span></span><span id="120" class="l"><a href="#120">  120: </a><span class="php-comment"> * @abstract Class for generating PDF files on-the-fly without requiring external extensions.
</span></span><span id="121" class="l"><a href="#121">  121: </a><span class="php-comment"> * @author Nicola Asuni
</span></span><span id="122" class="l"><a href="#122">  122: </a><span class="php-comment"> * @copyright 2002-2010 Nicola Asuni - Tecnick.com S.r.l (www.tecnick.com) Via Della Pace, 11 - 09044 - Quartucciu (CA) - ITALY - www.tecnick.com - info@tecnick.com
</span></span><span id="123" class="l"><a href="#123">  123: </a><span class="php-comment"> * @link http://www.tcpdf.org
</span></span><span id="124" class="l"><a href="#124">  124: </a><span class="php-comment"> * @license http://www.gnu.org/copyleft/lesser.html LGPL
</span></span><span id="125" class="l"><a href="#125">  125: </a><span class="php-comment"> * @version 5.0.002
</span></span><span id="126" class="l"><a href="#126">  126: </a><span class="php-comment"> */</span>
</span><span id="127" class="l"><a href="#127">  127: </a>
</span><span id="128" class="l"><a href="#128">  128: </a><span class="php-comment">/**
</span></span><span id="129" class="l"><a href="#129">  129: </a><span class="php-comment"> * main configuration file
</span></span><span id="130" class="l"><a href="#130">  130: </a><span class="php-comment"> */</span>
</span><span id="131" class="l"><a href="#131">  131: </a><span class="php-keyword1">require_once</span>(<span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/config/tcpdf_config.php'</span>);
</span><span id="132" class="l"><a href="#132">  132: </a>
</span><span id="133" class="l"><a href="#133">  133: </a><span class="php-comment">// includes some support files</span>
</span><span id="134" class="l"><a href="#134">  134: </a>
</span><span id="135" class="l"><a href="#135">  135: </a><span class="php-comment">/**
</span></span><span id="136" class="l"><a href="#136">  136: </a><span class="php-comment"> * unicode data
</span></span><span id="137" class="l"><a href="#137">  137: </a><span class="php-comment"> */</span>
</span><span id="138" class="l"><a href="#138">  138: </a><span class="php-keyword1">require_once</span>(<span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/unicode_data.php'</span>);
</span><span id="139" class="l"><a href="#139">  139: </a>
</span><span id="140" class="l"><a href="#140">  140: </a><span class="php-comment">/**
</span></span><span id="141" class="l"><a href="#141">  141: </a><span class="php-comment"> * html colors table
</span></span><span id="142" class="l"><a href="#142">  142: </a><span class="php-comment"> */</span>
</span><span id="143" class="l"><a href="#143">  143: </a><span class="php-keyword1">require_once</span>(<span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/htmlcolors.php'</span>);
</span><span id="144" class="l"><a href="#144">  144: </a>
</span><span id="145" class="l"><a href="#145">  145: </a><span class="php-keyword1">if</span> (!<span class="php-keyword2">class_exists</span>(<span class="php-quote">'TCPDF'</span>, <span class="php-keyword1">false</span>)) {
</span><span id="146" class="l"><a href="#146">  146: </a>    <span class="php-comment">/**
</span></span><span id="147" class="l"><a href="#147">  147: </a><span class="php-comment">     * define default PDF document producer
</span></span><span id="148" class="l"><a href="#148">  148: </a><span class="php-comment">     */</span>
</span><span id="149" class="l"><a href="#149">  149: </a>    <span class="php-keyword2">define</span>(<span class="php-quote">'PDF_PRODUCER'</span>, <span class="php-quote">'TCPDF 5.0.002 (http://www.tcpdf.org)'</span>);
</span><span id="150" class="l"><a href="#150">  150: </a>
</span><span id="151" class="l"><a href="#151">  151: </a>    <span class="php-comment">/**
</span></span><span id="152" class="l"><a href="#152">  152: </a><span class="php-comment">    * This is a PHP class for generating PDF documents without requiring external extensions.&lt;br&gt;
</span></span><span id="153" class="l"><a href="#153">  153: </a><span class="php-comment">    * TCPDF project (http://www.tcpdf.org) has been originally derived in 2002 from the Public Domain FPDF class by Olivier Plathey (http://www.fpdf.org), but now is almost entirely rewritten.&lt;br&gt;
</span></span><span id="154" class="l"><a href="#154">  154: </a><span class="php-comment">    * @name TCPDF
</span></span><span id="155" class="l"><a href="#155">  155: </a><span class="php-comment">    * @package com.tecnick.tcpdf
</span></span><span id="156" class="l"><a href="#156">  156: </a><span class="php-comment">    * @version 5.0.002
</span></span><span id="157" class="l"><a href="#157">  157: </a><span class="php-comment">    * @author Nicola Asuni - info@tecnick.com
</span></span><span id="158" class="l"><a href="#158">  158: </a><span class="php-comment">    * @link http://www.tcpdf.org
</span></span><span id="159" class="l"><a href="#159">  159: </a><span class="php-comment">    * @license http://www.gnu.org/copyleft/lesser.html LGPL
</span></span><span id="160" class="l"><a href="#160">  160: </a><span class="php-comment">    */</span>
</span><span id="161" class="l"><a href="#161">  161: </a>    <span class="php-keyword1">class</span> TCPDF {
</span><span id="162" class="l"><a href="#162">  162: </a>
</span><span id="163" class="l"><a href="#163">  163: </a>        <span class="php-comment">// protected or Protected properties</span>
</span><span id="164" class="l"><a href="#164">  164: </a>
</span><span id="165" class="l"><a href="#165">  165: </a>        <span class="php-comment">/**
</span></span><span id="166" class="l"><a href="#166">  166: </a><span class="php-comment">         * @var current page number
</span></span><span id="167" class="l"><a href="#167">  167: </a><span class="php-comment">         * @access protected
</span></span><span id="168" class="l"><a href="#168">  168: </a><span class="php-comment">         */</span>
</span><span id="169" class="l"><a href="#169">  169: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$page</span>;
</span><span id="170" class="l"><a href="#170">  170: </a>
</span><span id="171" class="l"><a href="#171">  171: </a>        <span class="php-comment">/**
</span></span><span id="172" class="l"><a href="#172">  172: </a><span class="php-comment">         * @var current object number
</span></span><span id="173" class="l"><a href="#173">  173: </a><span class="php-comment">         * @access protected
</span></span><span id="174" class="l"><a href="#174">  174: </a><span class="php-comment">         */</span>
</span><span id="175" class="l"><a href="#175">  175: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$n</span>;
</span><span id="176" class="l"><a href="#176">  176: </a>
</span><span id="177" class="l"><a href="#177">  177: </a>        <span class="php-comment">/**
</span></span><span id="178" class="l"><a href="#178">  178: </a><span class="php-comment">         * @var array of object offsets
</span></span><span id="179" class="l"><a href="#179">  179: </a><span class="php-comment">         * @access protected
</span></span><span id="180" class="l"><a href="#180">  180: </a><span class="php-comment">         */</span>
</span><span id="181" class="l"><a href="#181">  181: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$offsets</span>;
</span><span id="182" class="l"><a href="#182">  182: </a>
</span><span id="183" class="l"><a href="#183">  183: </a>        <span class="php-comment">/**
</span></span><span id="184" class="l"><a href="#184">  184: </a><span class="php-comment">         * @var buffer holding in-memory PDF
</span></span><span id="185" class="l"><a href="#185">  185: </a><span class="php-comment">         * @access protected
</span></span><span id="186" class="l"><a href="#186">  186: </a><span class="php-comment">         */</span>
</span><span id="187" class="l"><a href="#187">  187: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$buffer</span>;
</span><span id="188" class="l"><a href="#188">  188: </a>
</span><span id="189" class="l"><a href="#189">  189: </a>        <span class="php-comment">/**
</span></span><span id="190" class="l"><a href="#190">  190: </a><span class="php-comment">         * @var array containing pages
</span></span><span id="191" class="l"><a href="#191">  191: </a><span class="php-comment">         * @access protected
</span></span><span id="192" class="l"><a href="#192">  192: </a><span class="php-comment">         */</span>
</span><span id="193" class="l"><a href="#193">  193: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$pages</span> = <span class="php-keyword1">array</span>();
</span><span id="194" class="l"><a href="#194">  194: </a>
</span><span id="195" class="l"><a href="#195">  195: </a>        <span class="php-comment">/**
</span></span><span id="196" class="l"><a href="#196">  196: </a><span class="php-comment">         * @var current document state
</span></span><span id="197" class="l"><a href="#197">  197: </a><span class="php-comment">         * @access protected
</span></span><span id="198" class="l"><a href="#198">  198: </a><span class="php-comment">         */</span>
</span><span id="199" class="l"><a href="#199">  199: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$state</span>;
</span><span id="200" class="l"><a href="#200">  200: </a>
</span><span id="201" class="l"><a href="#201">  201: </a>        <span class="php-comment">/**
</span></span><span id="202" class="l"><a href="#202">  202: </a><span class="php-comment">         * @var compression flag
</span></span><span id="203" class="l"><a href="#203">  203: </a><span class="php-comment">         * @access protected
</span></span><span id="204" class="l"><a href="#204">  204: </a><span class="php-comment">         */</span>
</span><span id="205" class="l"><a href="#205">  205: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$compress</span>;
</span><span id="206" class="l"><a href="#206">  206: </a>
</span><span id="207" class="l"><a href="#207">  207: </a>        <span class="php-comment">/**
</span></span><span id="208" class="l"><a href="#208">  208: </a><span class="php-comment">         * @var current page orientation (P = Portrait, L = Landscape)
</span></span><span id="209" class="l"><a href="#209">  209: </a><span class="php-comment">         * @access protected
</span></span><span id="210" class="l"><a href="#210">  210: </a><span class="php-comment">         */</span>
</span><span id="211" class="l"><a href="#211">  211: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$CurOrientation</span>;
</span><span id="212" class="l"><a href="#212">  212: </a>
</span><span id="213" class="l"><a href="#213">  213: </a>        <span class="php-comment">/**
</span></span><span id="214" class="l"><a href="#214">  214: </a><span class="php-comment">         * @var array that stores page dimensions and graphic status.&lt;ul&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['w'] =&gt; page_width_in_points&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['h'] =&gt; height in points&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['wk'] =&gt; page_width_in_points&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['hk'] =&gt; height&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['tm'] =&gt; top_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['bm'] =&gt; bottom_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['lm'] =&gt; left_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['rm'] =&gt; right_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['pb'] =&gt; auto_page_break&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['or'] =&gt; page_orientation&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['olm'] =&gt; original_left_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['orm'] =&gt; original_right_margin&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="215" class="l"><a href="#215">  215: </a><span class="php-comment">         * @access protected
</span></span><span id="216" class="l"><a href="#216">  216: </a><span class="php-comment">         */</span>
</span><span id="217" class="l"><a href="#217">  217: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$pagedim</span> = <span class="php-keyword1">array</span>();
</span><span id="218" class="l"><a href="#218">  218: </a>
</span><span id="219" class="l"><a href="#219">  219: </a>        <span class="php-comment">/**
</span></span><span id="220" class="l"><a href="#220">  220: </a><span class="php-comment">         * @var scale factor (number of points in user unit)
</span></span><span id="221" class="l"><a href="#221">  221: </a><span class="php-comment">         * @access protected
</span></span><span id="222" class="l"><a href="#222">  222: </a><span class="php-comment">         */</span>
</span><span id="223" class="l"><a href="#223">  223: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$k</span>;
</span><span id="224" class="l"><a href="#224">  224: </a>
</span><span id="225" class="l"><a href="#225">  225: </a>        <span class="php-comment">/**
</span></span><span id="226" class="l"><a href="#226">  226: </a><span class="php-comment">         * @var width of page format in points
</span></span><span id="227" class="l"><a href="#227">  227: </a><span class="php-comment">         * @access protected
</span></span><span id="228" class="l"><a href="#228">  228: </a><span class="php-comment">         */</span>
</span><span id="229" class="l"><a href="#229">  229: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$fwPt</span>;
</span><span id="230" class="l"><a href="#230">  230: </a>
</span><span id="231" class="l"><a href="#231">  231: </a>        <span class="php-comment">/**
</span></span><span id="232" class="l"><a href="#232">  232: </a><span class="php-comment">         * @var height of page format in points
</span></span><span id="233" class="l"><a href="#233">  233: </a><span class="php-comment">         * @access protected
</span></span><span id="234" class="l"><a href="#234">  234: </a><span class="php-comment">         */</span>
</span><span id="235" class="l"><a href="#235">  235: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$fhPt</span>;
</span><span id="236" class="l"><a href="#236">  236: </a>
</span><span id="237" class="l"><a href="#237">  237: </a>        <span class="php-comment">/**
</span></span><span id="238" class="l"><a href="#238">  238: </a><span class="php-comment">         * @var current width of page in points
</span></span><span id="239" class="l"><a href="#239">  239: </a><span class="php-comment">         * @access protected
</span></span><span id="240" class="l"><a href="#240">  240: </a><span class="php-comment">         */</span>
</span><span id="241" class="l"><a href="#241">  241: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$wPt</span>;
</span><span id="242" class="l"><a href="#242">  242: </a>
</span><span id="243" class="l"><a href="#243">  243: </a>        <span class="php-comment">/**
</span></span><span id="244" class="l"><a href="#244">  244: </a><span class="php-comment">         * @var current height of page in points
</span></span><span id="245" class="l"><a href="#245">  245: </a><span class="php-comment">         * @access protected
</span></span><span id="246" class="l"><a href="#246">  246: </a><span class="php-comment">         */</span>
</span><span id="247" class="l"><a href="#247">  247: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$hPt</span>;
</span><span id="248" class="l"><a href="#248">  248: </a>
</span><span id="249" class="l"><a href="#249">  249: </a>        <span class="php-comment">/**
</span></span><span id="250" class="l"><a href="#250">  250: </a><span class="php-comment">         * @var current width of page in user unit
</span></span><span id="251" class="l"><a href="#251">  251: </a><span class="php-comment">         * @access protected
</span></span><span id="252" class="l"><a href="#252">  252: </a><span class="php-comment">         */</span>
</span><span id="253" class="l"><a href="#253">  253: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$w</span>;
</span><span id="254" class="l"><a href="#254">  254: </a>
</span><span id="255" class="l"><a href="#255">  255: </a>        <span class="php-comment">/**
</span></span><span id="256" class="l"><a href="#256">  256: </a><span class="php-comment">         * @var current height of page in user unit
</span></span><span id="257" class="l"><a href="#257">  257: </a><span class="php-comment">         * @access protected
</span></span><span id="258" class="l"><a href="#258">  258: </a><span class="php-comment">         */</span>
</span><span id="259" class="l"><a href="#259">  259: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$h</span>;
</span><span id="260" class="l"><a href="#260">  260: </a>
</span><span id="261" class="l"><a href="#261">  261: </a>        <span class="php-comment">/**
</span></span><span id="262" class="l"><a href="#262">  262: </a><span class="php-comment">         * @var left margin
</span></span><span id="263" class="l"><a href="#263">  263: </a><span class="php-comment">         * @access protected
</span></span><span id="264" class="l"><a href="#264">  264: </a><span class="php-comment">         */</span>
</span><span id="265" class="l"><a href="#265">  265: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$lMargin</span>;
</span><span id="266" class="l"><a href="#266">  266: </a>
</span><span id="267" class="l"><a href="#267">  267: </a>        <span class="php-comment">/**
</span></span><span id="268" class="l"><a href="#268">  268: </a><span class="php-comment">         * @var top margin
</span></span><span id="269" class="l"><a href="#269">  269: </a><span class="php-comment">         * @access protected
</span></span><span id="270" class="l"><a href="#270">  270: </a><span class="php-comment">         */</span>
</span><span id="271" class="l"><a href="#271">  271: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$tMargin</span>;
</span><span id="272" class="l"><a href="#272">  272: </a>
</span><span id="273" class="l"><a href="#273">  273: </a>        <span class="php-comment">/**
</span></span><span id="274" class="l"><a href="#274">  274: </a><span class="php-comment">         * @var right margin
</span></span><span id="275" class="l"><a href="#275">  275: </a><span class="php-comment">         * @access protected
</span></span><span id="276" class="l"><a href="#276">  276: </a><span class="php-comment">         */</span>
</span><span id="277" class="l"><a href="#277">  277: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$rMargin</span>;
</span><span id="278" class="l"><a href="#278">  278: </a>
</span><span id="279" class="l"><a href="#279">  279: </a>        <span class="php-comment">/**
</span></span><span id="280" class="l"><a href="#280">  280: </a><span class="php-comment">         * @var page break margin
</span></span><span id="281" class="l"><a href="#281">  281: </a><span class="php-comment">         * @access protected
</span></span><span id="282" class="l"><a href="#282">  282: </a><span class="php-comment">         */</span>
</span><span id="283" class="l"><a href="#283">  283: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$bMargin</span>;
</span><span id="284" class="l"><a href="#284">  284: </a>
</span><span id="285" class="l"><a href="#285">  285: </a>        <span class="php-comment">/**
</span></span><span id="286" class="l"><a href="#286">  286: </a><span class="php-comment">         * @var cell internal padding
</span></span><span id="287" class="l"><a href="#287">  287: </a><span class="php-comment">         * @access protected
</span></span><span id="288" class="l"><a href="#288">  288: </a><span class="php-comment">         */</span>
</span><span id="289" class="l"><a href="#289">  289: </a>        <span class="php-comment">//protected</span>
</span><span id="290" class="l"><a href="#290">  290: </a>        <span class="php-keyword1">public</span> <span class="php-var">$cMargin</span>;
</span><span id="291" class="l"><a href="#291">  291: </a>
</span><span id="292" class="l"><a href="#292">  292: </a>        <span class="php-comment">/**
</span></span><span id="293" class="l"><a href="#293">  293: </a><span class="php-comment">         * @var cell internal padding (previous value)
</span></span><span id="294" class="l"><a href="#294">  294: </a><span class="php-comment">         * @access protected
</span></span><span id="295" class="l"><a href="#295">  295: </a><span class="php-comment">         */</span>
</span><span id="296" class="l"><a href="#296">  296: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$oldcMargin</span>;
</span><span id="297" class="l"><a href="#297">  297: </a>
</span><span id="298" class="l"><a href="#298">  298: </a>        <span class="php-comment">/**
</span></span><span id="299" class="l"><a href="#299">  299: </a><span class="php-comment">         * @var current horizontal position in user unit for cell positioning
</span></span><span id="300" class="l"><a href="#300">  300: </a><span class="php-comment">         * @access protected
</span></span><span id="301" class="l"><a href="#301">  301: </a><span class="php-comment">         */</span>
</span><span id="302" class="l"><a href="#302">  302: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$x</span>;
</span><span id="303" class="l"><a href="#303">  303: </a>
</span><span id="304" class="l"><a href="#304">  304: </a>        <span class="php-comment">/**
</span></span><span id="305" class="l"><a href="#305">  305: </a><span class="php-comment">         * @var current vertical position in user unit for cell positioning
</span></span><span id="306" class="l"><a href="#306">  306: </a><span class="php-comment">         * @access protected
</span></span><span id="307" class="l"><a href="#307">  307: </a><span class="php-comment">         */</span>
</span><span id="308" class="l"><a href="#308">  308: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$y</span>;
</span><span id="309" class="l"><a href="#309">  309: </a>
</span><span id="310" class="l"><a href="#310">  310: </a>        <span class="php-comment">/**
</span></span><span id="311" class="l"><a href="#311">  311: </a><span class="php-comment">         * @var height of last cell printed
</span></span><span id="312" class="l"><a href="#312">  312: </a><span class="php-comment">         * @access protected
</span></span><span id="313" class="l"><a href="#313">  313: </a><span class="php-comment">         */</span>
</span><span id="314" class="l"><a href="#314">  314: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$lasth</span>;
</span><span id="315" class="l"><a href="#315">  315: </a>
</span><span id="316" class="l"><a href="#316">  316: </a>        <span class="php-comment">/**
</span></span><span id="317" class="l"><a href="#317">  317: </a><span class="php-comment">         * @var line width in user unit
</span></span><span id="318" class="l"><a href="#318">  318: </a><span class="php-comment">         * @access protected
</span></span><span id="319" class="l"><a href="#319">  319: </a><span class="php-comment">         */</span>
</span><span id="320" class="l"><a href="#320">  320: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$LineWidth</span>;
</span><span id="321" class="l"><a href="#321">  321: </a>
</span><span id="322" class="l"><a href="#322">  322: </a>        <span class="php-comment">/**
</span></span><span id="323" class="l"><a href="#323">  323: </a><span class="php-comment">         * @var array of standard font names
</span></span><span id="324" class="l"><a href="#324">  324: </a><span class="php-comment">         * @access protected
</span></span><span id="325" class="l"><a href="#325">  325: </a><span class="php-comment">         */</span>
</span><span id="326" class="l"><a href="#326">  326: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$CoreFonts</span>;
</span><span id="327" class="l"><a href="#327">  327: </a>
</span><span id="328" class="l"><a href="#328">  328: </a>        <span class="php-comment">/**
</span></span><span id="329" class="l"><a href="#329">  329: </a><span class="php-comment">         * @var array of used fonts
</span></span><span id="330" class="l"><a href="#330">  330: </a><span class="php-comment">         * @access protected
</span></span><span id="331" class="l"><a href="#331">  331: </a><span class="php-comment">         */</span>
</span><span id="332" class="l"><a href="#332">  332: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$fonts</span> = <span class="php-keyword1">array</span>();
</span><span id="333" class="l"><a href="#333">  333: </a>
</span><span id="334" class="l"><a href="#334">  334: </a>        <span class="php-comment">/**
</span></span><span id="335" class="l"><a href="#335">  335: </a><span class="php-comment">         * @var array of font files
</span></span><span id="336" class="l"><a href="#336">  336: </a><span class="php-comment">         * @access protected
</span></span><span id="337" class="l"><a href="#337">  337: </a><span class="php-comment">         */</span>
</span><span id="338" class="l"><a href="#338">  338: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FontFiles</span> = <span class="php-keyword1">array</span>();
</span><span id="339" class="l"><a href="#339">  339: </a>
</span><span id="340" class="l"><a href="#340">  340: </a>        <span class="php-comment">/**
</span></span><span id="341" class="l"><a href="#341">  341: </a><span class="php-comment">         * @var array of encoding differences
</span></span><span id="342" class="l"><a href="#342">  342: </a><span class="php-comment">         * @access protected
</span></span><span id="343" class="l"><a href="#343">  343: </a><span class="php-comment">         */</span>
</span><span id="344" class="l"><a href="#344">  344: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$diffs</span> = <span class="php-keyword1">array</span>();
</span><span id="345" class="l"><a href="#345">  345: </a>
</span><span id="346" class="l"><a href="#346">  346: </a>        <span class="php-comment">/**
</span></span><span id="347" class="l"><a href="#347">  347: </a><span class="php-comment">         * @var array of used images
</span></span><span id="348" class="l"><a href="#348">  348: </a><span class="php-comment">         * @access protected
</span></span><span id="349" class="l"><a href="#349">  349: </a><span class="php-comment">         */</span>
</span><span id="350" class="l"><a href="#350">  350: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$images</span> = <span class="php-keyword1">array</span>();
</span><span id="351" class="l"><a href="#351">  351: </a>
</span><span id="352" class="l"><a href="#352">  352: </a>        <span class="php-comment">/**
</span></span><span id="353" class="l"><a href="#353">  353: </a><span class="php-comment">         * @var array of Annotations in pages
</span></span><span id="354" class="l"><a href="#354">  354: </a><span class="php-comment">         * @access protected
</span></span><span id="355" class="l"><a href="#355">  355: </a><span class="php-comment">         */</span>
</span><span id="356" class="l"><a href="#356">  356: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$PageAnnots</span> = <span class="php-keyword1">array</span>();
</span><span id="357" class="l"><a href="#357">  357: </a>
</span><span id="358" class="l"><a href="#358">  358: </a>        <span class="php-comment">/**
</span></span><span id="359" class="l"><a href="#359">  359: </a><span class="php-comment">         * @var array of internal links
</span></span><span id="360" class="l"><a href="#360">  360: </a><span class="php-comment">         * @access protected
</span></span><span id="361" class="l"><a href="#361">  361: </a><span class="php-comment">         */</span>
</span><span id="362" class="l"><a href="#362">  362: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$links</span> = <span class="php-keyword1">array</span>();
</span><span id="363" class="l"><a href="#363">  363: </a>
</span><span id="364" class="l"><a href="#364">  364: </a>        <span class="php-comment">/**
</span></span><span id="365" class="l"><a href="#365">  365: </a><span class="php-comment">         * @var current font family
</span></span><span id="366" class="l"><a href="#366">  366: </a><span class="php-comment">         * @access protected
</span></span><span id="367" class="l"><a href="#367">  367: </a><span class="php-comment">         */</span>
</span><span id="368" class="l"><a href="#368">  368: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FontFamily</span>;
</span><span id="369" class="l"><a href="#369">  369: </a>
</span><span id="370" class="l"><a href="#370">  370: </a>        <span class="php-comment">/**
</span></span><span id="371" class="l"><a href="#371">  371: </a><span class="php-comment">         * @var current font style
</span></span><span id="372" class="l"><a href="#372">  372: </a><span class="php-comment">         * @access protected
</span></span><span id="373" class="l"><a href="#373">  373: </a><span class="php-comment">         */</span>
</span><span id="374" class="l"><a href="#374">  374: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FontStyle</span>;
</span><span id="375" class="l"><a href="#375">  375: </a>
</span><span id="376" class="l"><a href="#376">  376: </a>        <span class="php-comment">/**
</span></span><span id="377" class="l"><a href="#377">  377: </a><span class="php-comment">         * @var current font ascent (distance between font top and baseline)
</span></span><span id="378" class="l"><a href="#378">  378: </a><span class="php-comment">         * @access protected
</span></span><span id="379" class="l"><a href="#379">  379: </a><span class="php-comment">         * @since 2.8.000 (2007-03-29)
</span></span><span id="380" class="l"><a href="#380">  380: </a><span class="php-comment">         */</span>
</span><span id="381" class="l"><a href="#381">  381: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FontAscent</span>;
</span><span id="382" class="l"><a href="#382">  382: </a>
</span><span id="383" class="l"><a href="#383">  383: </a>        <span class="php-comment">/**
</span></span><span id="384" class="l"><a href="#384">  384: </a><span class="php-comment">         * @var current font descent (distance between font bottom and baseline)
</span></span><span id="385" class="l"><a href="#385">  385: </a><span class="php-comment">         * @access protected
</span></span><span id="386" class="l"><a href="#386">  386: </a><span class="php-comment">         * @since 2.8.000 (2007-03-29)
</span></span><span id="387" class="l"><a href="#387">  387: </a><span class="php-comment">         */</span>
</span><span id="388" class="l"><a href="#388">  388: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FontDescent</span>;
</span><span id="389" class="l"><a href="#389">  389: </a>
</span><span id="390" class="l"><a href="#390">  390: </a>        <span class="php-comment">/**
</span></span><span id="391" class="l"><a href="#391">  391: </a><span class="php-comment">         * @var underlining flag
</span></span><span id="392" class="l"><a href="#392">  392: </a><span class="php-comment">         * @access protected
</span></span><span id="393" class="l"><a href="#393">  393: </a><span class="php-comment">         */</span>
</span><span id="394" class="l"><a href="#394">  394: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$underline</span>;
</span><span id="395" class="l"><a href="#395">  395: </a>
</span><span id="396" class="l"><a href="#396">  396: </a>        <span class="php-comment">/**
</span></span><span id="397" class="l"><a href="#397">  397: </a><span class="php-comment">         * @var overlining flag
</span></span><span id="398" class="l"><a href="#398">  398: </a><span class="php-comment">         * @access protected
</span></span><span id="399" class="l"><a href="#399">  399: </a><span class="php-comment">         */</span>
</span><span id="400" class="l"><a href="#400">  400: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$overline</span>;
</span><span id="401" class="l"><a href="#401">  401: </a>
</span><span id="402" class="l"><a href="#402">  402: </a>        <span class="php-comment">/**
</span></span><span id="403" class="l"><a href="#403">  403: </a><span class="php-comment">         * @var current font info
</span></span><span id="404" class="l"><a href="#404">  404: </a><span class="php-comment">         * @access protected
</span></span><span id="405" class="l"><a href="#405">  405: </a><span class="php-comment">         */</span>
</span><span id="406" class="l"><a href="#406">  406: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$CurrentFont</span>;
</span><span id="407" class="l"><a href="#407">  407: </a>
</span><span id="408" class="l"><a href="#408">  408: </a>        <span class="php-comment">/**
</span></span><span id="409" class="l"><a href="#409">  409: </a><span class="php-comment">         * @var current font size in points
</span></span><span id="410" class="l"><a href="#410">  410: </a><span class="php-comment">         * @access protected
</span></span><span id="411" class="l"><a href="#411">  411: </a><span class="php-comment">         */</span>
</span><span id="412" class="l"><a href="#412">  412: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FontSizePt</span>;
</span><span id="413" class="l"><a href="#413">  413: </a>
</span><span id="414" class="l"><a href="#414">  414: </a>        <span class="php-comment">/**
</span></span><span id="415" class="l"><a href="#415">  415: </a><span class="php-comment">         * @var current font size in user unit
</span></span><span id="416" class="l"><a href="#416">  416: </a><span class="php-comment">         * @access protected
</span></span><span id="417" class="l"><a href="#417">  417: </a><span class="php-comment">         */</span>
</span><span id="418" class="l"><a href="#418">  418: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FontSize</span>;
</span><span id="419" class="l"><a href="#419">  419: </a>
</span><span id="420" class="l"><a href="#420">  420: </a>        <span class="php-comment">/**
</span></span><span id="421" class="l"><a href="#421">  421: </a><span class="php-comment">         * @var commands for drawing color
</span></span><span id="422" class="l"><a href="#422">  422: </a><span class="php-comment">         * @access protected
</span></span><span id="423" class="l"><a href="#423">  423: </a><span class="php-comment">         */</span>
</span><span id="424" class="l"><a href="#424">  424: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$DrawColor</span>;
</span><span id="425" class="l"><a href="#425">  425: </a>
</span><span id="426" class="l"><a href="#426">  426: </a>        <span class="php-comment">/**
</span></span><span id="427" class="l"><a href="#427">  427: </a><span class="php-comment">         * @var commands for filling color
</span></span><span id="428" class="l"><a href="#428">  428: </a><span class="php-comment">         * @access protected
</span></span><span id="429" class="l"><a href="#429">  429: </a><span class="php-comment">         */</span>
</span><span id="430" class="l"><a href="#430">  430: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$FillColor</span>;
</span><span id="431" class="l"><a href="#431">  431: </a>
</span><span id="432" class="l"><a href="#432">  432: </a>        <span class="php-comment">/**
</span></span><span id="433" class="l"><a href="#433">  433: </a><span class="php-comment">         * @var commands for text color
</span></span><span id="434" class="l"><a href="#434">  434: </a><span class="php-comment">         * @access protected
</span></span><span id="435" class="l"><a href="#435">  435: </a><span class="php-comment">         */</span>
</span><span id="436" class="l"><a href="#436">  436: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$TextColor</span>;
</span><span id="437" class="l"><a href="#437">  437: </a>
</span><span id="438" class="l"><a href="#438">  438: </a>        <span class="php-comment">/**
</span></span><span id="439" class="l"><a href="#439">  439: </a><span class="php-comment">         * @var indicates whether fill and text colors are different
</span></span><span id="440" class="l"><a href="#440">  440: </a><span class="php-comment">         * @access protected
</span></span><span id="441" class="l"><a href="#441">  441: </a><span class="php-comment">         */</span>
</span><span id="442" class="l"><a href="#442">  442: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$ColorFlag</span>;
</span><span id="443" class="l"><a href="#443">  443: </a>
</span><span id="444" class="l"><a href="#444">  444: </a>        <span class="php-comment">/**
</span></span><span id="445" class="l"><a href="#445">  445: </a><span class="php-comment">         * @var automatic page breaking
</span></span><span id="446" class="l"><a href="#446">  446: </a><span class="php-comment">         * @access protected
</span></span><span id="447" class="l"><a href="#447">  447: </a><span class="php-comment">         */</span>
</span><span id="448" class="l"><a href="#448">  448: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$AutoPageBreak</span>;
</span><span id="449" class="l"><a href="#449">  449: </a>
</span><span id="450" class="l"><a href="#450">  450: </a>        <span class="php-comment">/**
</span></span><span id="451" class="l"><a href="#451">  451: </a><span class="php-comment">         * @var threshold used to trigger page breaks
</span></span><span id="452" class="l"><a href="#452">  452: </a><span class="php-comment">         * @access protected
</span></span><span id="453" class="l"><a href="#453">  453: </a><span class="php-comment">         */</span>
</span><span id="454" class="l"><a href="#454">  454: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$PageBreakTrigger</span>;
</span><span id="455" class="l"><a href="#455">  455: </a>
</span><span id="456" class="l"><a href="#456">  456: </a>        <span class="php-comment">/**
</span></span><span id="457" class="l"><a href="#457">  457: </a><span class="php-comment">         * @var flag set when processing footer
</span></span><span id="458" class="l"><a href="#458">  458: </a><span class="php-comment">         * @access protected
</span></span><span id="459" class="l"><a href="#459">  459: </a><span class="php-comment">         */</span>
</span><span id="460" class="l"><a href="#460">  460: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$InFooter</span> = <span class="php-keyword1">false</span>;
</span><span id="461" class="l"><a href="#461">  461: </a>
</span><span id="462" class="l"><a href="#462">  462: </a>        <span class="php-comment">/**
</span></span><span id="463" class="l"><a href="#463">  463: </a><span class="php-comment">         * @var zoom display mode
</span></span><span id="464" class="l"><a href="#464">  464: </a><span class="php-comment">         * @access protected
</span></span><span id="465" class="l"><a href="#465">  465: </a><span class="php-comment">         */</span>
</span><span id="466" class="l"><a href="#466">  466: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$ZoomMode</span>;
</span><span id="467" class="l"><a href="#467">  467: </a>
</span><span id="468" class="l"><a href="#468">  468: </a>        <span class="php-comment">/**
</span></span><span id="469" class="l"><a href="#469">  469: </a><span class="php-comment">         * @var layout display mode
</span></span><span id="470" class="l"><a href="#470">  470: </a><span class="php-comment">         * @access protected
</span></span><span id="471" class="l"><a href="#471">  471: </a><span class="php-comment">         */</span>
</span><span id="472" class="l"><a href="#472">  472: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$LayoutMode</span>;
</span><span id="473" class="l"><a href="#473">  473: </a>
</span><span id="474" class="l"><a href="#474">  474: </a>        <span class="php-comment">/**
</span></span><span id="475" class="l"><a href="#475">  475: </a><span class="php-comment">         * @var title
</span></span><span id="476" class="l"><a href="#476">  476: </a><span class="php-comment">         * @access protected
</span></span><span id="477" class="l"><a href="#477">  477: </a><span class="php-comment">         */</span>
</span><span id="478" class="l"><a href="#478">  478: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$title</span> = <span class="php-quote">''</span>;
</span><span id="479" class="l"><a href="#479">  479: </a>
</span><span id="480" class="l"><a href="#480">  480: </a>        <span class="php-comment">/**
</span></span><span id="481" class="l"><a href="#481">  481: </a><span class="php-comment">         * @var subject
</span></span><span id="482" class="l"><a href="#482">  482: </a><span class="php-comment">         * @access protected
</span></span><span id="483" class="l"><a href="#483">  483: </a><span class="php-comment">         */</span>
</span><span id="484" class="l"><a href="#484">  484: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$subject</span> = <span class="php-quote">''</span>;
</span><span id="485" class="l"><a href="#485">  485: </a>
</span><span id="486" class="l"><a href="#486">  486: </a>        <span class="php-comment">/**
</span></span><span id="487" class="l"><a href="#487">  487: </a><span class="php-comment">         * @var author
</span></span><span id="488" class="l"><a href="#488">  488: </a><span class="php-comment">         * @access protected
</span></span><span id="489" class="l"><a href="#489">  489: </a><span class="php-comment">         */</span>
</span><span id="490" class="l"><a href="#490">  490: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$author</span> = <span class="php-quote">''</span>;
</span><span id="491" class="l"><a href="#491">  491: </a>
</span><span id="492" class="l"><a href="#492">  492: </a>        <span class="php-comment">/**
</span></span><span id="493" class="l"><a href="#493">  493: </a><span class="php-comment">         * @var keywords
</span></span><span id="494" class="l"><a href="#494">  494: </a><span class="php-comment">         * @access protected
</span></span><span id="495" class="l"><a href="#495">  495: </a><span class="php-comment">         */</span>
</span><span id="496" class="l"><a href="#496">  496: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$keywords</span> = <span class="php-quote">''</span>;
</span><span id="497" class="l"><a href="#497">  497: </a>
</span><span id="498" class="l"><a href="#498">  498: </a>        <span class="php-comment">/**
</span></span><span id="499" class="l"><a href="#499">  499: </a><span class="php-comment">         * @var creator
</span></span><span id="500" class="l"><a href="#500">  500: </a><span class="php-comment">         * @access protected
</span></span><span id="501" class="l"><a href="#501">  501: </a><span class="php-comment">         */</span>
</span><span id="502" class="l"><a href="#502">  502: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$creator</span> = <span class="php-quote">''</span>;
</span><span id="503" class="l"><a href="#503">  503: </a>
</span><span id="504" class="l"><a href="#504">  504: </a>        <span class="php-comment">/**
</span></span><span id="505" class="l"><a href="#505">  505: </a><span class="php-comment">         * @var alias for total number of pages
</span></span><span id="506" class="l"><a href="#506">  506: </a><span class="php-comment">         * @access protected
</span></span><span id="507" class="l"><a href="#507">  507: </a><span class="php-comment">         */</span>
</span><span id="508" class="l"><a href="#508">  508: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$AliasNbPages</span> = <span class="php-quote">'{nb}'</span>;
</span><span id="509" class="l"><a href="#509">  509: </a>
</span><span id="510" class="l"><a href="#510">  510: </a>        <span class="php-comment">/**
</span></span><span id="511" class="l"><a href="#511">  511: </a><span class="php-comment">         * @var alias for page number
</span></span><span id="512" class="l"><a href="#512">  512: </a><span class="php-comment">         * @access protected
</span></span><span id="513" class="l"><a href="#513">  513: </a><span class="php-comment">         */</span>
</span><span id="514" class="l"><a href="#514">  514: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$AliasNumPage</span> = <span class="php-quote">'{pnb}'</span>;
</span><span id="515" class="l"><a href="#515">  515: </a>
</span><span id="516" class="l"><a href="#516">  516: </a>        <span class="php-comment">/**
</span></span><span id="517" class="l"><a href="#517">  517: </a><span class="php-comment">         * @var right-bottom corner X coordinate of inserted image
</span></span><span id="518" class="l"><a href="#518">  518: </a><span class="php-comment">         * @since 2002-07-31
</span></span><span id="519" class="l"><a href="#519">  519: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="520" class="l"><a href="#520">  520: </a><span class="php-comment">         * @access protected
</span></span><span id="521" class="l"><a href="#521">  521: </a><span class="php-comment">         */</span>
</span><span id="522" class="l"><a href="#522">  522: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$img_rb_x</span>;
</span><span id="523" class="l"><a href="#523">  523: </a>
</span><span id="524" class="l"><a href="#524">  524: </a>        <span class="php-comment">/**
</span></span><span id="525" class="l"><a href="#525">  525: </a><span class="php-comment">         * @var right-bottom corner Y coordinate of inserted image
</span></span><span id="526" class="l"><a href="#526">  526: </a><span class="php-comment">         * @since 2002-07-31
</span></span><span id="527" class="l"><a href="#527">  527: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="528" class="l"><a href="#528">  528: </a><span class="php-comment">         * @access protected
</span></span><span id="529" class="l"><a href="#529">  529: </a><span class="php-comment">         */</span>
</span><span id="530" class="l"><a href="#530">  530: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$img_rb_y</span>;
</span><span id="531" class="l"><a href="#531">  531: </a>
</span><span id="532" class="l"><a href="#532">  532: </a>        <span class="php-comment">/**
</span></span><span id="533" class="l"><a href="#533">  533: </a><span class="php-comment">         * @var adjusting factor to convert pixels to user units.
</span></span><span id="534" class="l"><a href="#534">  534: </a><span class="php-comment">         * @since 2004-06-14
</span></span><span id="535" class="l"><a href="#535">  535: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="536" class="l"><a href="#536">  536: </a><span class="php-comment">         * @access protected
</span></span><span id="537" class="l"><a href="#537">  537: </a><span class="php-comment">         */</span>
</span><span id="538" class="l"><a href="#538">  538: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$imgscale</span> = <span class="php-num">1</span>;
</span><span id="539" class="l"><a href="#539">  539: </a>
</span><span id="540" class="l"><a href="#540">  540: </a>        <span class="php-comment">/**
</span></span><span id="541" class="l"><a href="#541">  541: </a><span class="php-comment">         * @var boolean set to true when the input text is unicode (require unicode fonts)
</span></span><span id="542" class="l"><a href="#542">  542: </a><span class="php-comment">         * @since 2005-01-02
</span></span><span id="543" class="l"><a href="#543">  543: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="544" class="l"><a href="#544">  544: </a><span class="php-comment">         * @access protected
</span></span><span id="545" class="l"><a href="#545">  545: </a><span class="php-comment">         */</span>
</span><span id="546" class="l"><a href="#546">  546: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$isunicode</span> = <span class="php-keyword1">false</span>;
</span><span id="547" class="l"><a href="#547">  547: </a>
</span><span id="548" class="l"><a href="#548">  548: </a>        <span class="php-comment">/**
</span></span><span id="549" class="l"><a href="#549">  549: </a><span class="php-comment">         * @var PDF version
</span></span><span id="550" class="l"><a href="#550">  550: </a><span class="php-comment">         * @since 1.5.3
</span></span><span id="551" class="l"><a href="#551">  551: </a><span class="php-comment">         * @access protected
</span></span><span id="552" class="l"><a href="#552">  552: </a><span class="php-comment">         */</span>
</span><span id="553" class="l"><a href="#553">  553: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$PDFVersion</span> = <span class="php-quote">'1.7'</span>;
</span><span id="554" class="l"><a href="#554">  554: </a>
</span><span id="555" class="l"><a href="#555">  555: </a>        <span class="php-comment">/**
</span></span><span id="556" class="l"><a href="#556">  556: </a><span class="php-comment">         * @var Minimum distance between header and top page margin.
</span></span><span id="557" class="l"><a href="#557">  557: </a><span class="php-comment">         * @access protected
</span></span><span id="558" class="l"><a href="#558">  558: </a><span class="php-comment">         */</span>
</span><span id="559" class="l"><a href="#559">  559: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$header_margin</span>;
</span><span id="560" class="l"><a href="#560">  560: </a>
</span><span id="561" class="l"><a href="#561">  561: </a>        <span class="php-comment">/**
</span></span><span id="562" class="l"><a href="#562">  562: </a><span class="php-comment">         * @var Minimum distance between footer and bottom page margin.
</span></span><span id="563" class="l"><a href="#563">  563: </a><span class="php-comment">         * @access protected
</span></span><span id="564" class="l"><a href="#564">  564: </a><span class="php-comment">         */</span>
</span><span id="565" class="l"><a href="#565">  565: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$footer_margin</span>;
</span><span id="566" class="l"><a href="#566">  566: </a>
</span><span id="567" class="l"><a href="#567">  567: </a>        <span class="php-comment">/**
</span></span><span id="568" class="l"><a href="#568">  568: </a><span class="php-comment">         * @var original left margin value
</span></span><span id="569" class="l"><a href="#569">  569: </a><span class="php-comment">         * @access protected
</span></span><span id="570" class="l"><a href="#570">  570: </a><span class="php-comment">         * @since 1.53.0.TC013
</span></span><span id="571" class="l"><a href="#571">  571: </a><span class="php-comment">         */</span>
</span><span id="572" class="l"><a href="#572">  572: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$original_lMargin</span>;
</span><span id="573" class="l"><a href="#573">  573: </a>
</span><span id="574" class="l"><a href="#574">  574: </a>        <span class="php-comment">/**
</span></span><span id="575" class="l"><a href="#575">  575: </a><span class="php-comment">         * @var original right margin value
</span></span><span id="576" class="l"><a href="#576">  576: </a><span class="php-comment">         * @access protected
</span></span><span id="577" class="l"><a href="#577">  577: </a><span class="php-comment">         * @since 1.53.0.TC013
</span></span><span id="578" class="l"><a href="#578">  578: </a><span class="php-comment">         */</span>
</span><span id="579" class="l"><a href="#579">  579: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$original_rMargin</span>;
</span><span id="580" class="l"><a href="#580">  580: </a>
</span><span id="581" class="l"><a href="#581">  581: </a>        <span class="php-comment">/**
</span></span><span id="582" class="l"><a href="#582">  582: </a><span class="php-comment">         * @var Header font.
</span></span><span id="583" class="l"><a href="#583">  583: </a><span class="php-comment">         * @access protected
</span></span><span id="584" class="l"><a href="#584">  584: </a><span class="php-comment">         */</span>
</span><span id="585" class="l"><a href="#585">  585: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$header_font</span>;
</span><span id="586" class="l"><a href="#586">  586: </a>
</span><span id="587" class="l"><a href="#587">  587: </a>        <span class="php-comment">/**
</span></span><span id="588" class="l"><a href="#588">  588: </a><span class="php-comment">         * @var Footer font.
</span></span><span id="589" class="l"><a href="#589">  589: </a><span class="php-comment">         * @access protected
</span></span><span id="590" class="l"><a href="#590">  590: </a><span class="php-comment">         */</span>
</span><span id="591" class="l"><a href="#591">  591: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$footer_font</span>;
</span><span id="592" class="l"><a href="#592">  592: </a>
</span><span id="593" class="l"><a href="#593">  593: </a>        <span class="php-comment">/**
</span></span><span id="594" class="l"><a href="#594">  594: </a><span class="php-comment">         * @var Language templates.
</span></span><span id="595" class="l"><a href="#595">  595: </a><span class="php-comment">         * @access protected
</span></span><span id="596" class="l"><a href="#596">  596: </a><span class="php-comment">         */</span>
</span><span id="597" class="l"><a href="#597">  597: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$l</span>;
</span><span id="598" class="l"><a href="#598">  598: </a>
</span><span id="599" class="l"><a href="#599">  599: </a>        <span class="php-comment">/**
</span></span><span id="600" class="l"><a href="#600">  600: </a><span class="php-comment">         * @var Barcode to print on page footer (only if set).
</span></span><span id="601" class="l"><a href="#601">  601: </a><span class="php-comment">         * @access protected
</span></span><span id="602" class="l"><a href="#602">  602: </a><span class="php-comment">         */</span>
</span><span id="603" class="l"><a href="#603">  603: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$barcode</span> = <span class="php-keyword1">false</span>;
</span><span id="604" class="l"><a href="#604">  604: </a>
</span><span id="605" class="l"><a href="#605">  605: </a>        <span class="php-comment">/**
</span></span><span id="606" class="l"><a href="#606">  606: </a><span class="php-comment">         * @var If true prints header
</span></span><span id="607" class="l"><a href="#607">  607: </a><span class="php-comment">         * @access protected
</span></span><span id="608" class="l"><a href="#608">  608: </a><span class="php-comment">         */</span>
</span><span id="609" class="l"><a href="#609">  609: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$print_header</span> = <span class="php-keyword1">true</span>;
</span><span id="610" class="l"><a href="#610">  610: </a>
</span><span id="611" class="l"><a href="#611">  611: </a>        <span class="php-comment">/**
</span></span><span id="612" class="l"><a href="#612">  612: </a><span class="php-comment">         * @var If true prints footer.
</span></span><span id="613" class="l"><a href="#613">  613: </a><span class="php-comment">         * @access protected
</span></span><span id="614" class="l"><a href="#614">  614: </a><span class="php-comment">         */</span>
</span><span id="615" class="l"><a href="#615">  615: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$print_footer</span> = <span class="php-keyword1">true</span>;
</span><span id="616" class="l"><a href="#616">  616: </a>
</span><span id="617" class="l"><a href="#617">  617: </a>        <span class="php-comment">/**
</span></span><span id="618" class="l"><a href="#618">  618: </a><span class="php-comment">         * @var Header image logo.
</span></span><span id="619" class="l"><a href="#619">  619: </a><span class="php-comment">         * @access protected
</span></span><span id="620" class="l"><a href="#620">  620: </a><span class="php-comment">         */</span>
</span><span id="621" class="l"><a href="#621">  621: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$header_logo</span> = <span class="php-quote">''</span>;
</span><span id="622" class="l"><a href="#622">  622: </a>
</span><span id="623" class="l"><a href="#623">  623: </a>        <span class="php-comment">/**
</span></span><span id="624" class="l"><a href="#624">  624: </a><span class="php-comment">         * @var Header image logo width in mm.
</span></span><span id="625" class="l"><a href="#625">  625: </a><span class="php-comment">         * @access protected
</span></span><span id="626" class="l"><a href="#626">  626: </a><span class="php-comment">         */</span>
</span><span id="627" class="l"><a href="#627">  627: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$header_logo_width</span> = <span class="php-num">30</span>;
</span><span id="628" class="l"><a href="#628">  628: </a>
</span><span id="629" class="l"><a href="#629">  629: </a>        <span class="php-comment">/**
</span></span><span id="630" class="l"><a href="#630">  630: </a><span class="php-comment">         * @var String to print as title on document header.
</span></span><span id="631" class="l"><a href="#631">  631: </a><span class="php-comment">         * @access protected
</span></span><span id="632" class="l"><a href="#632">  632: </a><span class="php-comment">         */</span>
</span><span id="633" class="l"><a href="#633">  633: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$header_title</span> = <span class="php-quote">''</span>;
</span><span id="634" class="l"><a href="#634">  634: </a>
</span><span id="635" class="l"><a href="#635">  635: </a>        <span class="php-comment">/**
</span></span><span id="636" class="l"><a href="#636">  636: </a><span class="php-comment">         * @var String to print on document header.
</span></span><span id="637" class="l"><a href="#637">  637: </a><span class="php-comment">         * @access protected
</span></span><span id="638" class="l"><a href="#638">  638: </a><span class="php-comment">         */</span>
</span><span id="639" class="l"><a href="#639">  639: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$header_string</span> = <span class="php-quote">''</span>;
</span><span id="640" class="l"><a href="#640">  640: </a>
</span><span id="641" class="l"><a href="#641">  641: </a>        <span class="php-comment">/**
</span></span><span id="642" class="l"><a href="#642">  642: </a><span class="php-comment">         * @var Default number of columns for html table.
</span></span><span id="643" class="l"><a href="#643">  643: </a><span class="php-comment">         * @access protected
</span></span><span id="644" class="l"><a href="#644">  644: </a><span class="php-comment">         */</span>
</span><span id="645" class="l"><a href="#645">  645: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$default_table_columns</span> = <span class="php-num">4</span>;
</span><span id="646" class="l"><a href="#646">  646: </a>
</span><span id="647" class="l"><a href="#647">  647: </a>
</span><span id="648" class="l"><a href="#648">  648: </a>        <span class="php-comment">// variables for html parser</span>
</span><span id="649" class="l"><a href="#649">  649: </a>
</span><span id="650" class="l"><a href="#650">  650: </a>        <span class="php-comment">/**
</span></span><span id="651" class="l"><a href="#651">  651: </a><span class="php-comment">         * @var HTML PARSER: array to store current link and rendering styles.
</span></span><span id="652" class="l"><a href="#652">  652: </a><span class="php-comment">         * @access protected
</span></span><span id="653" class="l"><a href="#653">  653: </a><span class="php-comment">         */</span>
</span><span id="654" class="l"><a href="#654">  654: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$HREF</span> = <span class="php-keyword1">array</span>();
</span><span id="655" class="l"><a href="#655">  655: </a>
</span><span id="656" class="l"><a href="#656">  656: </a>        <span class="php-comment">/**
</span></span><span id="657" class="l"><a href="#657">  657: </a><span class="php-comment">         * @var store a list of available fonts on filesystem.
</span></span><span id="658" class="l"><a href="#658">  658: </a><span class="php-comment">         * @access protected
</span></span><span id="659" class="l"><a href="#659">  659: </a><span class="php-comment">         */</span>
</span><span id="660" class="l"><a href="#660">  660: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$fontlist</span> = <span class="php-keyword1">array</span>();
</span><span id="661" class="l"><a href="#661">  661: </a>
</span><span id="662" class="l"><a href="#662">  662: </a>        <span class="php-comment">/**
</span></span><span id="663" class="l"><a href="#663">  663: </a><span class="php-comment">         * @var current foreground color
</span></span><span id="664" class="l"><a href="#664">  664: </a><span class="php-comment">         * @access protected
</span></span><span id="665" class="l"><a href="#665">  665: </a><span class="php-comment">         */</span>
</span><span id="666" class="l"><a href="#666">  666: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$fgcolor</span>;
</span><span id="667" class="l"><a href="#667">  667: </a>
</span><span id="668" class="l"><a href="#668">  668: </a>        <span class="php-comment">/**
</span></span><span id="669" class="l"><a href="#669">  669: </a><span class="php-comment">         * @var HTML PARSER: array of boolean values, true in case of ordered list (OL), false otherwise.
</span></span><span id="670" class="l"><a href="#670">  670: </a><span class="php-comment">         * @access protected
</span></span><span id="671" class="l"><a href="#671">  671: </a><span class="php-comment">         */</span>
</span><span id="672" class="l"><a href="#672">  672: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$listordered</span> = <span class="php-keyword1">array</span>();
</span><span id="673" class="l"><a href="#673">  673: </a>
</span><span id="674" class="l"><a href="#674">  674: </a>        <span class="php-comment">/**
</span></span><span id="675" class="l"><a href="#675">  675: </a><span class="php-comment">         * @var HTML PARSER: array count list items on nested lists.
</span></span><span id="676" class="l"><a href="#676">  676: </a><span class="php-comment">         * @access protected
</span></span><span id="677" class="l"><a href="#677">  677: </a><span class="php-comment">         */</span>
</span><span id="678" class="l"><a href="#678">  678: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$listcount</span> = <span class="php-keyword1">array</span>();
</span><span id="679" class="l"><a href="#679">  679: </a>
</span><span id="680" class="l"><a href="#680">  680: </a>        <span class="php-comment">/**
</span></span><span id="681" class="l"><a href="#681">  681: </a><span class="php-comment">         * @var HTML PARSER: current list nesting level.
</span></span><span id="682" class="l"><a href="#682">  682: </a><span class="php-comment">         * @access protected
</span></span><span id="683" class="l"><a href="#683">  683: </a><span class="php-comment">         */</span>
</span><span id="684" class="l"><a href="#684">  684: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$listnum</span> = <span class="php-num">0</span>;
</span><span id="685" class="l"><a href="#685">  685: </a>
</span><span id="686" class="l"><a href="#686">  686: </a>        <span class="php-comment">/**
</span></span><span id="687" class="l"><a href="#687">  687: </a><span class="php-comment">         * @var HTML PARSER: indent amount for lists.
</span></span><span id="688" class="l"><a href="#688">  688: </a><span class="php-comment">         * @access protected
</span></span><span id="689" class="l"><a href="#689">  689: </a><span class="php-comment">         */</span>
</span><span id="690" class="l"><a href="#690">  690: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$listindent</span> = <span class="php-num">0</span>;
</span><span id="691" class="l"><a href="#691">  691: </a>
</span><span id="692" class="l"><a href="#692">  692: </a>        <span class="php-comment">/**
</span></span><span id="693" class="l"><a href="#693">  693: </a><span class="php-comment">         * @var HTML PARSER: current list indententation level.
</span></span><span id="694" class="l"><a href="#694">  694: </a><span class="php-comment">         * @access protected
</span></span><span id="695" class="l"><a href="#695">  695: </a><span class="php-comment">         */</span>
</span><span id="696" class="l"><a href="#696">  696: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$listindentlevel</span> = <span class="php-num">0</span>;
</span><span id="697" class="l"><a href="#697">  697: </a>
</span><span id="698" class="l"><a href="#698">  698: </a>        <span class="php-comment">/**
</span></span><span id="699" class="l"><a href="#699">  699: </a><span class="php-comment">         * @var current background color
</span></span><span id="700" class="l"><a href="#700">  700: </a><span class="php-comment">         * @access protected
</span></span><span id="701" class="l"><a href="#701">  701: </a><span class="php-comment">         */</span>
</span><span id="702" class="l"><a href="#702">  702: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$bgcolor</span>;
</span><span id="703" class="l"><a href="#703">  703: </a>
</span><span id="704" class="l"><a href="#704">  704: </a>        <span class="php-comment">/**
</span></span><span id="705" class="l"><a href="#705">  705: </a><span class="php-comment">         * @var Store temporary font size in points.
</span></span><span id="706" class="l"><a href="#706">  706: </a><span class="php-comment">         * @access protected
</span></span><span id="707" class="l"><a href="#707">  707: </a><span class="php-comment">         */</span>
</span><span id="708" class="l"><a href="#708">  708: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$tempfontsize</span> = <span class="php-num">10</span>;
</span><span id="709" class="l"><a href="#709">  709: </a>
</span><span id="710" class="l"><a href="#710">  710: </a>        <span class="php-comment">/**
</span></span><span id="711" class="l"><a href="#711">  711: </a><span class="php-comment">         * @var spacer for LI tags.
</span></span><span id="712" class="l"><a href="#712">  712: </a><span class="php-comment">         * @access protected
</span></span><span id="713" class="l"><a href="#713">  713: </a><span class="php-comment">         */</span>
</span><span id="714" class="l"><a href="#714">  714: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$lispacer</span> = <span class="php-quote">''</span>;
</span><span id="715" class="l"><a href="#715">  715: </a>
</span><span id="716" class="l"><a href="#716">  716: </a>        <span class="php-comment">/**
</span></span><span id="717" class="l"><a href="#717">  717: </a><span class="php-comment">         * @var default encoding
</span></span><span id="718" class="l"><a href="#718">  718: </a><span class="php-comment">         * @access protected
</span></span><span id="719" class="l"><a href="#719">  719: </a><span class="php-comment">         * @since 1.53.0.TC010
</span></span><span id="720" class="l"><a href="#720">  720: </a><span class="php-comment">         */</span>
</span><span id="721" class="l"><a href="#721">  721: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$encoding</span> = <span class="php-quote">'UTF-8'</span>;
</span><span id="722" class="l"><a href="#722">  722: </a>
</span><span id="723" class="l"><a href="#723">  723: </a>        <span class="php-comment">/**
</span></span><span id="724" class="l"><a href="#724">  724: </a><span class="php-comment">         * @var PHP internal encoding
</span></span><span id="725" class="l"><a href="#725">  725: </a><span class="php-comment">         * @access protected
</span></span><span id="726" class="l"><a href="#726">  726: </a><span class="php-comment">         * @since 1.53.0.TC016
</span></span><span id="727" class="l"><a href="#727">  727: </a><span class="php-comment">         */</span>
</span><span id="728" class="l"><a href="#728">  728: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$internal_encoding</span>;
</span><span id="729" class="l"><a href="#729">  729: </a>
</span><span id="730" class="l"><a href="#730">  730: </a>        <span class="php-comment">/**
</span></span><span id="731" class="l"><a href="#731">  731: </a><span class="php-comment">         * @var indicates if the document language is Right-To-Left
</span></span><span id="732" class="l"><a href="#732">  732: </a><span class="php-comment">         * @access protected
</span></span><span id="733" class="l"><a href="#733">  733: </a><span class="php-comment">         * @since 2.0.000
</span></span><span id="734" class="l"><a href="#734">  734: </a><span class="php-comment">         */</span>
</span><span id="735" class="l"><a href="#735">  735: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$rtl</span> = <span class="php-keyword1">false</span>;
</span><span id="736" class="l"><a href="#736">  736: </a>
</span><span id="737" class="l"><a href="#737">  737: </a>        <span class="php-comment">/**
</span></span><span id="738" class="l"><a href="#738">  738: </a><span class="php-comment">         * @var used to force RTL or LTR string inversion
</span></span><span id="739" class="l"><a href="#739">  739: </a><span class="php-comment">         * @access protected
</span></span><span id="740" class="l"><a href="#740">  740: </a><span class="php-comment">         * @since 2.0.000
</span></span><span id="741" class="l"><a href="#741">  741: </a><span class="php-comment">         */</span>
</span><span id="742" class="l"><a href="#742">  742: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$tmprtl</span> = <span class="php-keyword1">false</span>;
</span><span id="743" class="l"><a href="#743">  743: </a>
</span><span id="744" class="l"><a href="#744">  744: </a>        <span class="php-comment">// --- Variables used for document encryption:</span>
</span><span id="745" class="l"><a href="#745">  745: </a>
</span><span id="746" class="l"><a href="#746">  746: </a>        <span class="php-comment">/**
</span></span><span id="747" class="l"><a href="#747">  747: </a><span class="php-comment">         * Indicates whether document is protected
</span></span><span id="748" class="l"><a href="#748">  748: </a><span class="php-comment">         * @access protected
</span></span><span id="749" class="l"><a href="#749">  749: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="750" class="l"><a href="#750">  750: </a><span class="php-comment">         */</span>
</span><span id="751" class="l"><a href="#751">  751: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$encrypted</span>;
</span><span id="752" class="l"><a href="#752">  752: </a>
</span><span id="753" class="l"><a href="#753">  753: </a>        <span class="php-comment">/**
</span></span><span id="754" class="l"><a href="#754">  754: </a><span class="php-comment">         * U entry in pdf document
</span></span><span id="755" class="l"><a href="#755">  755: </a><span class="php-comment">         * @access protected
</span></span><span id="756" class="l"><a href="#756">  756: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="757" class="l"><a href="#757">  757: </a><span class="php-comment">         */</span>
</span><span id="758" class="l"><a href="#758">  758: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$Uvalue</span>;
</span><span id="759" class="l"><a href="#759">  759: </a>
</span><span id="760" class="l"><a href="#760">  760: </a>        <span class="php-comment">/**
</span></span><span id="761" class="l"><a href="#761">  761: </a><span class="php-comment">         * O entry in pdf document
</span></span><span id="762" class="l"><a href="#762">  762: </a><span class="php-comment">         * @access protected
</span></span><span id="763" class="l"><a href="#763">  763: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="764" class="l"><a href="#764">  764: </a><span class="php-comment">         */</span>
</span><span id="765" class="l"><a href="#765">  765: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$Ovalue</span>;
</span><span id="766" class="l"><a href="#766">  766: </a>
</span><span id="767" class="l"><a href="#767">  767: </a>        <span class="php-comment">/**
</span></span><span id="768" class="l"><a href="#768">  768: </a><span class="php-comment">         * P entry in pdf document
</span></span><span id="769" class="l"><a href="#769">  769: </a><span class="php-comment">         * @access protected
</span></span><span id="770" class="l"><a href="#770">  770: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="771" class="l"><a href="#771">  771: </a><span class="php-comment">         */</span>
</span><span id="772" class="l"><a href="#772">  772: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$Pvalue</span>;
</span><span id="773" class="l"><a href="#773">  773: </a>
</span><span id="774" class="l"><a href="#774">  774: </a>        <span class="php-comment">/**
</span></span><span id="775" class="l"><a href="#775">  775: </a><span class="php-comment">         * encryption object id
</span></span><span id="776" class="l"><a href="#776">  776: </a><span class="php-comment">         * @access protected
</span></span><span id="777" class="l"><a href="#777">  777: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="778" class="l"><a href="#778">  778: </a><span class="php-comment">         */</span>
</span><span id="779" class="l"><a href="#779">  779: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$enc_obj_id</span>;
</span><span id="780" class="l"><a href="#780">  780: </a>
</span><span id="781" class="l"><a href="#781">  781: </a>        <span class="php-comment">/**
</span></span><span id="782" class="l"><a href="#782">  782: </a><span class="php-comment">         * last RC4 key encrypted (cached for optimisation)
</span></span><span id="783" class="l"><a href="#783">  783: </a><span class="php-comment">         * @access protected
</span></span><span id="784" class="l"><a href="#784">  784: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="785" class="l"><a href="#785">  785: </a><span class="php-comment">         */</span>
</span><span id="786" class="l"><a href="#786">  786: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$last_rc4_key</span>;
</span><span id="787" class="l"><a href="#787">  787: </a>
</span><span id="788" class="l"><a href="#788">  788: </a>        <span class="php-comment">/**
</span></span><span id="789" class="l"><a href="#789">  789: </a><span class="php-comment">         * last RC4 computed key
</span></span><span id="790" class="l"><a href="#790">  790: </a><span class="php-comment">         * @access protected
</span></span><span id="791" class="l"><a href="#791">  791: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="792" class="l"><a href="#792">  792: </a><span class="php-comment">         */</span>
</span><span id="793" class="l"><a href="#793">  793: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$last_rc4_key_c</span>;
</span><span id="794" class="l"><a href="#794">  794: </a>
</span><span id="795" class="l"><a href="#795">  795: </a>        <span class="php-comment">/**
</span></span><span id="796" class="l"><a href="#796">  796: </a><span class="php-comment">         * RC4 padding
</span></span><span id="797" class="l"><a href="#797">  797: </a><span class="php-comment">         * @access protected
</span></span><span id="798" class="l"><a href="#798">  798: </a><span class="php-comment">         */</span>
</span><span id="799" class="l"><a href="#799">  799: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$padding</span> = <span class="php-quote">&quot;\x28\xBF\x4E\x5E\x4E\x75\x8A\x41\x64\x00\x4E\x56\xFF\xFA\x01\x08\x2E\x2E\x00\xB6\xD0\x68\x3E\x80\x2F\x0C\xA9\xFE\x64\x53\x69\x7A&quot;</span>;
</span><span id="800" class="l"><a href="#800">  800: </a>
</span><span id="801" class="l"><a href="#801">  801: </a>        <span class="php-comment">/**
</span></span><span id="802" class="l"><a href="#802">  802: </a><span class="php-comment">         * RC4 encryption key
</span></span><span id="803" class="l"><a href="#803">  803: </a><span class="php-comment">         * @access protected
</span></span><span id="804" class="l"><a href="#804">  804: </a><span class="php-comment">         */</span>
</span><span id="805" class="l"><a href="#805">  805: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$encryption_key</span>;
</span><span id="806" class="l"><a href="#806">  806: </a>
</span><span id="807" class="l"><a href="#807">  807: </a>        <span class="php-comment">// --- bookmark ---</span>
</span><span id="808" class="l"><a href="#808">  808: </a>
</span><span id="809" class="l"><a href="#809">  809: </a>        <span class="php-comment">/**
</span></span><span id="810" class="l"><a href="#810">  810: </a><span class="php-comment">         * Outlines for bookmark
</span></span><span id="811" class="l"><a href="#811">  811: </a><span class="php-comment">         * @access protected
</span></span><span id="812" class="l"><a href="#812">  812: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="813" class="l"><a href="#813">  813: </a><span class="php-comment">         */</span>
</span><span id="814" class="l"><a href="#814">  814: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$outlines</span> = <span class="php-keyword1">array</span>();
</span><span id="815" class="l"><a href="#815">  815: </a>
</span><span id="816" class="l"><a href="#816">  816: </a>        <span class="php-comment">/**
</span></span><span id="817" class="l"><a href="#817">  817: </a><span class="php-comment">         * Outline root for bookmark
</span></span><span id="818" class="l"><a href="#818">  818: </a><span class="php-comment">         * @access protected
</span></span><span id="819" class="l"><a href="#819">  819: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="820" class="l"><a href="#820">  820: </a><span class="php-comment">         */</span>
</span><span id="821" class="l"><a href="#821">  821: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$OutlineRoot</span>;
</span><span id="822" class="l"><a href="#822">  822: </a>
</span><span id="823" class="l"><a href="#823">  823: </a>
</span><span id="824" class="l"><a href="#824">  824: </a>        <span class="php-comment">// --- javascript and form ---</span>
</span><span id="825" class="l"><a href="#825">  825: </a>
</span><span id="826" class="l"><a href="#826">  826: </a>        <span class="php-comment">/**
</span></span><span id="827" class="l"><a href="#827">  827: </a><span class="php-comment">         * javascript code
</span></span><span id="828" class="l"><a href="#828">  828: </a><span class="php-comment">         * @access protected
</span></span><span id="829" class="l"><a href="#829">  829: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="830" class="l"><a href="#830">  830: </a><span class="php-comment">         */</span>
</span><span id="831" class="l"><a href="#831">  831: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$javascript</span> = <span class="php-quote">''</span>;
</span><span id="832" class="l"><a href="#832">  832: </a>
</span><span id="833" class="l"><a href="#833">  833: </a>        <span class="php-comment">/**
</span></span><span id="834" class="l"><a href="#834">  834: </a><span class="php-comment">         * javascript counter
</span></span><span id="835" class="l"><a href="#835">  835: </a><span class="php-comment">         * @access protected
</span></span><span id="836" class="l"><a href="#836">  836: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="837" class="l"><a href="#837">  837: </a><span class="php-comment">         */</span>
</span><span id="838" class="l"><a href="#838">  838: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$n_js</span>;
</span><span id="839" class="l"><a href="#839">  839: </a>
</span><span id="840" class="l"><a href="#840">  840: </a>        <span class="php-comment">/**
</span></span><span id="841" class="l"><a href="#841">  841: </a><span class="php-comment">         * line trough state
</span></span><span id="842" class="l"><a href="#842">  842: </a><span class="php-comment">         * @access protected
</span></span><span id="843" class="l"><a href="#843">  843: </a><span class="php-comment">         * @since 2.8.000 (2008-03-19)
</span></span><span id="844" class="l"><a href="#844">  844: </a><span class="php-comment">         */</span>
</span><span id="845" class="l"><a href="#845">  845: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$linethrough</span>;
</span><span id="846" class="l"><a href="#846">  846: </a>
</span><span id="847" class="l"><a href="#847">  847: </a>        <span class="php-comment">// --- Variables used for User's Rights ---</span>
</span><span id="848" class="l"><a href="#848">  848: </a>        <span class="php-comment">// See PDF reference chapter 8.7 Digital Signatures</span>
</span><span id="849" class="l"><a href="#849">  849: </a>
</span><span id="850" class="l"><a href="#850">  850: </a>        <span class="php-comment">/**
</span></span><span id="851" class="l"><a href="#851">  851: </a><span class="php-comment">         * If true enables user's rights on PDF reader
</span></span><span id="852" class="l"><a href="#852">  852: </a><span class="php-comment">         * @access protected
</span></span><span id="853" class="l"><a href="#853">  853: </a><span class="php-comment">         * @since 2.9.000 (2008-03-26)
</span></span><span id="854" class="l"><a href="#854">  854: </a><span class="php-comment">         */</span>
</span><span id="855" class="l"><a href="#855">  855: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$ur</span>;
</span><span id="856" class="l"><a href="#856">  856: </a>
</span><span id="857" class="l"><a href="#857">  857: </a>        <span class="php-comment">/**
</span></span><span id="858" class="l"><a href="#858">  858: </a><span class="php-comment">         * Names specifying additional document-wide usage rights for the document.
</span></span><span id="859" class="l"><a href="#859">  859: </a><span class="php-comment">         * @access protected
</span></span><span id="860" class="l"><a href="#860">  860: </a><span class="php-comment">         * @since 2.9.000 (2008-03-26)
</span></span><span id="861" class="l"><a href="#861">  861: </a><span class="php-comment">         */</span>
</span><span id="862" class="l"><a href="#862">  862: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$ur_document</span>;
</span><span id="863" class="l"><a href="#863">  863: </a>
</span><span id="864" class="l"><a href="#864">  864: </a>        <span class="php-comment">/**
</span></span><span id="865" class="l"><a href="#865">  865: </a><span class="php-comment">         * Names specifying additional annotation-related usage rights for the document.
</span></span><span id="866" class="l"><a href="#866">  866: </a><span class="php-comment">         * @access protected
</span></span><span id="867" class="l"><a href="#867">  867: </a><span class="php-comment">         * @since 2.9.000 (2008-03-26)
</span></span><span id="868" class="l"><a href="#868">  868: </a><span class="php-comment">         */</span>
</span><span id="869" class="l"><a href="#869">  869: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$ur_annots</span>;
</span><span id="870" class="l"><a href="#870">  870: </a>
</span><span id="871" class="l"><a href="#871">  871: </a>        <span class="php-comment">/**
</span></span><span id="872" class="l"><a href="#872">  872: </a><span class="php-comment">         * Names specifying additional form-field-related usage rights for the document.
</span></span><span id="873" class="l"><a href="#873">  873: </a><span class="php-comment">         * @access protected
</span></span><span id="874" class="l"><a href="#874">  874: </a><span class="php-comment">         * @since 2.9.000 (2008-03-26)
</span></span><span id="875" class="l"><a href="#875">  875: </a><span class="php-comment">         */</span>
</span><span id="876" class="l"><a href="#876">  876: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$ur_form</span>;
</span><span id="877" class="l"><a href="#877">  877: </a>
</span><span id="878" class="l"><a href="#878">  878: </a>        <span class="php-comment">/**
</span></span><span id="879" class="l"><a href="#879">  879: </a><span class="php-comment">         * Names specifying additional signature-related usage rights for the document.
</span></span><span id="880" class="l"><a href="#880">  880: </a><span class="php-comment">         * @access protected
</span></span><span id="881" class="l"><a href="#881">  881: </a><span class="php-comment">         * @since 2.9.000 (2008-03-26)
</span></span><span id="882" class="l"><a href="#882">  882: </a><span class="php-comment">         */</span>
</span><span id="883" class="l"><a href="#883">  883: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$ur_signature</span>;
</span><span id="884" class="l"><a href="#884">  884: </a>
</span><span id="885" class="l"><a href="#885">  885: </a>        <span class="php-comment">/**
</span></span><span id="886" class="l"><a href="#886">  886: </a><span class="php-comment">         * Dot Per Inch Document Resolution (do not change)
</span></span><span id="887" class="l"><a href="#887">  887: </a><span class="php-comment">         * @access protected
</span></span><span id="888" class="l"><a href="#888">  888: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="889" class="l"><a href="#889">  889: </a><span class="php-comment">         */</span>
</span><span id="890" class="l"><a href="#890">  890: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$dpi</span> = <span class="php-num">72</span>;
</span><span id="891" class="l"><a href="#891">  891: </a>
</span><span id="892" class="l"><a href="#892">  892: </a>        <span class="php-comment">/**
</span></span><span id="893" class="l"><a href="#893">  893: </a><span class="php-comment">         * Array of page numbers were a new page group was started
</span></span><span id="894" class="l"><a href="#894">  894: </a><span class="php-comment">         * @access protected
</span></span><span id="895" class="l"><a href="#895">  895: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="896" class="l"><a href="#896">  896: </a><span class="php-comment">         */</span>
</span><span id="897" class="l"><a href="#897">  897: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$newpagegroup</span> = <span class="php-keyword1">array</span>();
</span><span id="898" class="l"><a href="#898">  898: </a>
</span><span id="899" class="l"><a href="#899">  899: </a>        <span class="php-comment">/**
</span></span><span id="900" class="l"><a href="#900">  900: </a><span class="php-comment">         * Contains the number of pages of the groups
</span></span><span id="901" class="l"><a href="#901">  901: </a><span class="php-comment">         * @access protected
</span></span><span id="902" class="l"><a href="#902">  902: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="903" class="l"><a href="#903">  903: </a><span class="php-comment">         */</span>
</span><span id="904" class="l"><a href="#904">  904: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$pagegroups</span>;
</span><span id="905" class="l"><a href="#905">  905: </a>
</span><span id="906" class="l"><a href="#906">  906: </a>        <span class="php-comment">/**
</span></span><span id="907" class="l"><a href="#907">  907: </a><span class="php-comment">         * Contains the alias of the current page group
</span></span><span id="908" class="l"><a href="#908">  908: </a><span class="php-comment">         * @access protected
</span></span><span id="909" class="l"><a href="#909">  909: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="910" class="l"><a href="#910">  910: </a><span class="php-comment">         */</span>
</span><span id="911" class="l"><a href="#911">  911: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$currpagegroup</span>;
</span><span id="912" class="l"><a href="#912">  912: </a>
</span><span id="913" class="l"><a href="#913">  913: </a>        <span class="php-comment">/**
</span></span><span id="914" class="l"><a href="#914">  914: </a><span class="php-comment">         * Restrict the rendering of some elements to screen or printout.
</span></span><span id="915" class="l"><a href="#915">  915: </a><span class="php-comment">         * @access protected
</span></span><span id="916" class="l"><a href="#916">  916: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="917" class="l"><a href="#917">  917: </a><span class="php-comment">         */</span>
</span><span id="918" class="l"><a href="#918">  918: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$visibility</span> = <span class="php-quote">'all'</span>;
</span><span id="919" class="l"><a href="#919">  919: </a>
</span><span id="920" class="l"><a href="#920">  920: </a>        <span class="php-comment">/**
</span></span><span id="921" class="l"><a href="#921">  921: </a><span class="php-comment">         * Print visibility.
</span></span><span id="922" class="l"><a href="#922">  922: </a><span class="php-comment">         * @access protected
</span></span><span id="923" class="l"><a href="#923">  923: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="924" class="l"><a href="#924">  924: </a><span class="php-comment">         */</span>
</span><span id="925" class="l"><a href="#925">  925: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$n_ocg_print</span>;
</span><span id="926" class="l"><a href="#926">  926: </a>
</span><span id="927" class="l"><a href="#927">  927: </a>        <span class="php-comment">/**
</span></span><span id="928" class="l"><a href="#928">  928: </a><span class="php-comment">         * View visibility.
</span></span><span id="929" class="l"><a href="#929">  929: </a><span class="php-comment">         * @access protected
</span></span><span id="930" class="l"><a href="#930">  930: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="931" class="l"><a href="#931">  931: </a><span class="php-comment">         */</span>
</span><span id="932" class="l"><a href="#932">  932: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$n_ocg_view</span>;
</span><span id="933" class="l"><a href="#933">  933: </a>
</span><span id="934" class="l"><a href="#934">  934: </a>        <span class="php-comment">/**
</span></span><span id="935" class="l"><a href="#935">  935: </a><span class="php-comment">         * Array of transparency objects and parameters.
</span></span><span id="936" class="l"><a href="#936">  936: </a><span class="php-comment">         * @access protected
</span></span><span id="937" class="l"><a href="#937">  937: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="938" class="l"><a href="#938">  938: </a><span class="php-comment">         */</span>
</span><span id="939" class="l"><a href="#939">  939: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$extgstates</span>;
</span><span id="940" class="l"><a href="#940">  940: </a>
</span><span id="941" class="l"><a href="#941">  941: </a>        <span class="php-comment">/**
</span></span><span id="942" class="l"><a href="#942">  942: </a><span class="php-comment">         * Set the default JPEG compression quality (1-100)
</span></span><span id="943" class="l"><a href="#943">  943: </a><span class="php-comment">         * @access protected
</span></span><span id="944" class="l"><a href="#944">  944: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="945" class="l"><a href="#945">  945: </a><span class="php-comment">         */</span>
</span><span id="946" class="l"><a href="#946">  946: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$jpeg_quality</span>;
</span><span id="947" class="l"><a href="#947">  947: </a>
</span><span id="948" class="l"><a href="#948">  948: </a>        <span class="php-comment">/**
</span></span><span id="949" class="l"><a href="#949">  949: </a><span class="php-comment">         * Default cell height ratio.
</span></span><span id="950" class="l"><a href="#950">  950: </a><span class="php-comment">         * @access protected
</span></span><span id="951" class="l"><a href="#951">  951: </a><span class="php-comment">         * @since 3.0.014 (2008-05-23)
</span></span><span id="952" class="l"><a href="#952">  952: </a><span class="php-comment">         */</span>
</span><span id="953" class="l"><a href="#953">  953: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$cell_height_ratio</span> = K_CELL_HEIGHT_RATIO;
</span><span id="954" class="l"><a href="#954">  954: </a>
</span><span id="955" class="l"><a href="#955">  955: </a>        <span class="php-comment">/**
</span></span><span id="956" class="l"><a href="#956">  956: </a><span class="php-comment">         * PDF viewer preferences.
</span></span><span id="957" class="l"><a href="#957">  957: </a><span class="php-comment">         * @access protected
</span></span><span id="958" class="l"><a href="#958">  958: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="959" class="l"><a href="#959">  959: </a><span class="php-comment">         */</span>
</span><span id="960" class="l"><a href="#960">  960: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$viewer_preferences</span>;
</span><span id="961" class="l"><a href="#961">  961: </a>
</span><span id="962" class="l"><a href="#962">  962: </a>        <span class="php-comment">/**
</span></span><span id="963" class="l"><a href="#963">  963: </a><span class="php-comment">         * A name object specifying how the document should be displayed when opened.
</span></span><span id="964" class="l"><a href="#964">  964: </a><span class="php-comment">         * @access protected
</span></span><span id="965" class="l"><a href="#965">  965: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="966" class="l"><a href="#966">  966: </a><span class="php-comment">         */</span>
</span><span id="967" class="l"><a href="#967">  967: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$PageMode</span>;
</span><span id="968" class="l"><a href="#968">  968: </a>
</span><span id="969" class="l"><a href="#969">  969: </a>        <span class="php-comment">/**
</span></span><span id="970" class="l"><a href="#970">  970: </a><span class="php-comment">         * Array for storing gradient information.
</span></span><span id="971" class="l"><a href="#971">  971: </a><span class="php-comment">         * @access protected
</span></span><span id="972" class="l"><a href="#972">  972: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="973" class="l"><a href="#973">  973: </a><span class="php-comment">         */</span>
</span><span id="974" class="l"><a href="#974">  974: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$gradients</span> = <span class="php-keyword1">array</span>();
</span><span id="975" class="l"><a href="#975">  975: </a>
</span><span id="976" class="l"><a href="#976">  976: </a>        <span class="php-comment">/**
</span></span><span id="977" class="l"><a href="#977">  977: </a><span class="php-comment">         * Array used to store positions inside the pages buffer.
</span></span><span id="978" class="l"><a href="#978">  978: </a><span class="php-comment">         * keys are the page numbers
</span></span><span id="979" class="l"><a href="#979">  979: </a><span class="php-comment">         * @access protected
</span></span><span id="980" class="l"><a href="#980">  980: </a><span class="php-comment">         * @since 3.2.000 (2008-06-26)
</span></span><span id="981" class="l"><a href="#981">  981: </a><span class="php-comment">         */</span>
</span><span id="982" class="l"><a href="#982">  982: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$intmrk</span> = <span class="php-keyword1">array</span>();
</span><span id="983" class="l"><a href="#983">  983: </a>
</span><span id="984" class="l"><a href="#984">  984: </a>        <span class="php-comment">/**
</span></span><span id="985" class="l"><a href="#985">  985: </a><span class="php-comment">         * Array used to store content positions inside the pages buffer.
</span></span><span id="986" class="l"><a href="#986">  986: </a><span class="php-comment">         * keys are the page numbers
</span></span><span id="987" class="l"><a href="#987">  987: </a><span class="php-comment">         * @access protected
</span></span><span id="988" class="l"><a href="#988">  988: </a><span class="php-comment">         * @since 4.6.021 (2009-07-20)
</span></span><span id="989" class="l"><a href="#989">  989: </a><span class="php-comment">         */</span>
</span><span id="990" class="l"><a href="#990">  990: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$cntmrk</span> = <span class="php-keyword1">array</span>();
</span><span id="991" class="l"><a href="#991">  991: </a>
</span><span id="992" class="l"><a href="#992">  992: </a>        <span class="php-comment">/**
</span></span><span id="993" class="l"><a href="#993">  993: </a><span class="php-comment">         * Array used to store footer positions of each page.
</span></span><span id="994" class="l"><a href="#994">  994: </a><span class="php-comment">         * @access protected
</span></span><span id="995" class="l"><a href="#995">  995: </a><span class="php-comment">         * @since 3.2.000 (2008-07-01)
</span></span><span id="996" class="l"><a href="#996">  996: </a><span class="php-comment">         */</span>
</span><span id="997" class="l"><a href="#997">  997: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$footerpos</span> = <span class="php-keyword1">array</span>();
</span><span id="998" class="l"><a href="#998">  998: </a>
</span><span id="999" class="l"><a href="#999">  999: </a>
</span><span id="1000" class="l"><a href="#1000"> 1000: </a>        <span class="php-comment">/**
</span></span><span id="1001" class="l"><a href="#1001"> 1001: </a><span class="php-comment">         * Array used to store footer length of each page.
</span></span><span id="1002" class="l"><a href="#1002"> 1002: </a><span class="php-comment">         * @access protected
</span></span><span id="1003" class="l"><a href="#1003"> 1003: </a><span class="php-comment">         * @since 4.0.014 (2008-07-29)
</span></span><span id="1004" class="l"><a href="#1004"> 1004: </a><span class="php-comment">         */</span>
</span><span id="1005" class="l"><a href="#1005"> 1005: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$footerlen</span> = <span class="php-keyword1">array</span>();
</span><span id="1006" class="l"><a href="#1006"> 1006: </a>
</span><span id="1007" class="l"><a href="#1007"> 1007: </a>        <span class="php-comment">/**
</span></span><span id="1008" class="l"><a href="#1008"> 1008: </a><span class="php-comment">         * True if a newline is created.
</span></span><span id="1009" class="l"><a href="#1009"> 1009: </a><span class="php-comment">         * @access protected
</span></span><span id="1010" class="l"><a href="#1010"> 1010: </a><span class="php-comment">         * @since 3.2.000 (2008-07-01)
</span></span><span id="1011" class="l"><a href="#1011"> 1011: </a><span class="php-comment">         */</span>
</span><span id="1012" class="l"><a href="#1012"> 1012: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$newline</span> = <span class="php-keyword1">true</span>;
</span><span id="1013" class="l"><a href="#1013"> 1013: </a>
</span><span id="1014" class="l"><a href="#1014"> 1014: </a>        <span class="php-comment">/**
</span></span><span id="1015" class="l"><a href="#1015"> 1015: </a><span class="php-comment">         * End position of the latest inserted line
</span></span><span id="1016" class="l"><a href="#1016"> 1016: </a><span class="php-comment">         * @access protected
</span></span><span id="1017" class="l"><a href="#1017"> 1017: </a><span class="php-comment">         * @since 3.2.000 (2008-07-01)
</span></span><span id="1018" class="l"><a href="#1018"> 1018: </a><span class="php-comment">         */</span>
</span><span id="1019" class="l"><a href="#1019"> 1019: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$endlinex</span> = <span class="php-num">0</span>;
</span><span id="1020" class="l"><a href="#1020"> 1020: </a>
</span><span id="1021" class="l"><a href="#1021"> 1021: </a>        <span class="php-comment">/**
</span></span><span id="1022" class="l"><a href="#1022"> 1022: </a><span class="php-comment">         * PDF string for last line width
</span></span><span id="1023" class="l"><a href="#1023"> 1023: </a><span class="php-comment">         * @access protected
</span></span><span id="1024" class="l"><a href="#1024"> 1024: </a><span class="php-comment">         * @since 4.0.006 (2008-07-16)
</span></span><span id="1025" class="l"><a href="#1025"> 1025: </a><span class="php-comment">         */</span>
</span><span id="1026" class="l"><a href="#1026"> 1026: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$linestyleWidth</span> = <span class="php-quote">''</span>;
</span><span id="1027" class="l"><a href="#1027"> 1027: </a>
</span><span id="1028" class="l"><a href="#1028"> 1028: </a>        <span class="php-comment">/**
</span></span><span id="1029" class="l"><a href="#1029"> 1029: </a><span class="php-comment">         * PDF string for last line width
</span></span><span id="1030" class="l"><a href="#1030"> 1030: </a><span class="php-comment">         * @access protected
</span></span><span id="1031" class="l"><a href="#1031"> 1031: </a><span class="php-comment">         * @since 4.0.006 (2008-07-16)
</span></span><span id="1032" class="l"><a href="#1032"> 1032: </a><span class="php-comment">         */</span>
</span><span id="1033" class="l"><a href="#1033"> 1033: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$linestyleCap</span> = <span class="php-quote">'0 J'</span>;
</span><span id="1034" class="l"><a href="#1034"> 1034: </a>
</span><span id="1035" class="l"><a href="#1035"> 1035: </a>        <span class="php-comment">/**
</span></span><span id="1036" class="l"><a href="#1036"> 1036: </a><span class="php-comment">         * PDF string for last line width
</span></span><span id="1037" class="l"><a href="#1037"> 1037: </a><span class="php-comment">         * @access protected
</span></span><span id="1038" class="l"><a href="#1038"> 1038: </a><span class="php-comment">         * @since 4.0.006 (2008-07-16)
</span></span><span id="1039" class="l"><a href="#1039"> 1039: </a><span class="php-comment">         */</span>
</span><span id="1040" class="l"><a href="#1040"> 1040: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$linestyleJoin</span> = <span class="php-quote">'0 j'</span>;
</span><span id="1041" class="l"><a href="#1041"> 1041: </a>
</span><span id="1042" class="l"><a href="#1042"> 1042: </a>        <span class="php-comment">/**
</span></span><span id="1043" class="l"><a href="#1043"> 1043: </a><span class="php-comment">         * PDF string for last line width
</span></span><span id="1044" class="l"><a href="#1044"> 1044: </a><span class="php-comment">         * @access protected
</span></span><span id="1045" class="l"><a href="#1045"> 1045: </a><span class="php-comment">         * @since 4.0.006 (2008-07-16)
</span></span><span id="1046" class="l"><a href="#1046"> 1046: </a><span class="php-comment">         */</span>
</span><span id="1047" class="l"><a href="#1047"> 1047: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$linestyleDash</span> = <span class="php-quote">'[] 0 d'</span>;
</span><span id="1048" class="l"><a href="#1048"> 1048: </a>
</span><span id="1049" class="l"><a href="#1049"> 1049: </a>        <span class="php-comment">/**
</span></span><span id="1050" class="l"><a href="#1050"> 1050: </a><span class="php-comment">         * True if marked-content sequence is open
</span></span><span id="1051" class="l"><a href="#1051"> 1051: </a><span class="php-comment">         * @access protected
</span></span><span id="1052" class="l"><a href="#1052"> 1052: </a><span class="php-comment">         * @since 4.0.013 (2008-07-28)
</span></span><span id="1053" class="l"><a href="#1053"> 1053: </a><span class="php-comment">         */</span>
</span><span id="1054" class="l"><a href="#1054"> 1054: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$openMarkedContent</span> = <span class="php-keyword1">false</span>;
</span><span id="1055" class="l"><a href="#1055"> 1055: </a>
</span><span id="1056" class="l"><a href="#1056"> 1056: </a>        <span class="php-comment">/**
</span></span><span id="1057" class="l"><a href="#1057"> 1057: </a><span class="php-comment">         * Count the latest inserted vertical spaces on HTML
</span></span><span id="1058" class="l"><a href="#1058"> 1058: </a><span class="php-comment">         * @access protected
</span></span><span id="1059" class="l"><a href="#1059"> 1059: </a><span class="php-comment">         * @since 4.0.021 (2008-08-24)
</span></span><span id="1060" class="l"><a href="#1060"> 1060: </a><span class="php-comment">         */</span>
</span><span id="1061" class="l"><a href="#1061"> 1061: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$htmlvspace</span> = <span class="php-num">0</span>;
</span><span id="1062" class="l"><a href="#1062"> 1062: </a>
</span><span id="1063" class="l"><a href="#1063"> 1063: </a>        <span class="php-comment">/**
</span></span><span id="1064" class="l"><a href="#1064"> 1064: </a><span class="php-comment">         * Array of Spot colors
</span></span><span id="1065" class="l"><a href="#1065"> 1065: </a><span class="php-comment">         * @access protected
</span></span><span id="1066" class="l"><a href="#1066"> 1066: </a><span class="php-comment">         * @since 4.0.024 (2008-09-12)
</span></span><span id="1067" class="l"><a href="#1067"> 1067: </a><span class="php-comment">         */</span>
</span><span id="1068" class="l"><a href="#1068"> 1068: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$spot_colors</span> = <span class="php-keyword1">array</span>();
</span><span id="1069" class="l"><a href="#1069"> 1069: </a>
</span><span id="1070" class="l"><a href="#1070"> 1070: </a>        <span class="php-comment">/**
</span></span><span id="1071" class="l"><a href="#1071"> 1071: </a><span class="php-comment">         * Symbol used for HTML unordered list items
</span></span><span id="1072" class="l"><a href="#1072"> 1072: </a><span class="php-comment">         * @access protected
</span></span><span id="1073" class="l"><a href="#1073"> 1073: </a><span class="php-comment">         * @since 4.0.028 (2008-09-26)
</span></span><span id="1074" class="l"><a href="#1074"> 1074: </a><span class="php-comment">         */</span>
</span><span id="1075" class="l"><a href="#1075"> 1075: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$lisymbol</span> = <span class="php-quote">''</span>;
</span><span id="1076" class="l"><a href="#1076"> 1076: </a>
</span><span id="1077" class="l"><a href="#1077"> 1077: </a>        <span class="php-comment">/**
</span></span><span id="1078" class="l"><a href="#1078"> 1078: </a><span class="php-comment">         * String used to mark the beginning and end of EPS image blocks
</span></span><span id="1079" class="l"><a href="#1079"> 1079: </a><span class="php-comment">         * @access protected
</span></span><span id="1080" class="l"><a href="#1080"> 1080: </a><span class="php-comment">         * @since 4.1.000 (2008-10-18)
</span></span><span id="1081" class="l"><a href="#1081"> 1081: </a><span class="php-comment">         */</span>
</span><span id="1082" class="l"><a href="#1082"> 1082: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$epsmarker</span> = <span class="php-quote">'x#!#EPS#!#x'</span>;
</span><span id="1083" class="l"><a href="#1083"> 1083: </a>
</span><span id="1084" class="l"><a href="#1084"> 1084: </a>        <span class="php-comment">/**
</span></span><span id="1085" class="l"><a href="#1085"> 1085: </a><span class="php-comment">         * Array of transformation matrix
</span></span><span id="1086" class="l"><a href="#1086"> 1086: </a><span class="php-comment">         * @access protected
</span></span><span id="1087" class="l"><a href="#1087"> 1087: </a><span class="php-comment">         * @since 4.2.000 (2008-10-29)
</span></span><span id="1088" class="l"><a href="#1088"> 1088: </a><span class="php-comment">         */</span>
</span><span id="1089" class="l"><a href="#1089"> 1089: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$transfmatrix</span> = <span class="php-keyword1">array</span>();
</span><span id="1090" class="l"><a href="#1090"> 1090: </a>
</span><span id="1091" class="l"><a href="#1091"> 1091: </a>        <span class="php-comment">/**
</span></span><span id="1092" class="l"><a href="#1092"> 1092: </a><span class="php-comment">         * Current key for transformation matrix
</span></span><span id="1093" class="l"><a href="#1093"> 1093: </a><span class="php-comment">         * @access protected
</span></span><span id="1094" class="l"><a href="#1094"> 1094: </a><span class="php-comment">         * @since 4.8.005 (2009-09-17)
</span></span><span id="1095" class="l"><a href="#1095"> 1095: </a><span class="php-comment">         */</span>
</span><span id="1096" class="l"><a href="#1096"> 1096: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$transfmatrix_key</span> = <span class="php-num">0</span>;
</span><span id="1097" class="l"><a href="#1097"> 1097: </a>
</span><span id="1098" class="l"><a href="#1098"> 1098: </a>        <span class="php-comment">/**
</span></span><span id="1099" class="l"><a href="#1099"> 1099: </a><span class="php-comment">         * Booklet mode for double-sided pages
</span></span><span id="1100" class="l"><a href="#1100"> 1100: </a><span class="php-comment">         * @access protected
</span></span><span id="1101" class="l"><a href="#1101"> 1101: </a><span class="php-comment">         * @since 4.2.000 (2008-10-29)
</span></span><span id="1102" class="l"><a href="#1102"> 1102: </a><span class="php-comment">         */</span>
</span><span id="1103" class="l"><a href="#1103"> 1103: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$booklet</span> = <span class="php-keyword1">false</span>;
</span><span id="1104" class="l"><a href="#1104"> 1104: </a>
</span><span id="1105" class="l"><a href="#1105"> 1105: </a>        <span class="php-comment">/**
</span></span><span id="1106" class="l"><a href="#1106"> 1106: </a><span class="php-comment">         * Epsilon value used for float calculations
</span></span><span id="1107" class="l"><a href="#1107"> 1107: </a><span class="php-comment">         * @access protected
</span></span><span id="1108" class="l"><a href="#1108"> 1108: </a><span class="php-comment">         * @since 4.2.000 (2008-10-29)
</span></span><span id="1109" class="l"><a href="#1109"> 1109: </a><span class="php-comment">         */</span>
</span><span id="1110" class="l"><a href="#1110"> 1110: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$feps</span> = <span class="php-num">0.005</span>;
</span><span id="1111" class="l"><a href="#1111"> 1111: </a>
</span><span id="1112" class="l"><a href="#1112"> 1112: </a>        <span class="php-comment">/**
</span></span><span id="1113" class="l"><a href="#1113"> 1113: </a><span class="php-comment">         * Array used for custom vertical spaces for HTML tags
</span></span><span id="1114" class="l"><a href="#1114"> 1114: </a><span class="php-comment">         * @access protected
</span></span><span id="1115" class="l"><a href="#1115"> 1115: </a><span class="php-comment">         * @since 4.2.001 (2008-10-30)
</span></span><span id="1116" class="l"><a href="#1116"> 1116: </a><span class="php-comment">         */</span>
</span><span id="1117" class="l"><a href="#1117"> 1117: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$tagvspaces</span> = <span class="php-keyword1">array</span>();
</span><span id="1118" class="l"><a href="#1118"> 1118: </a>
</span><span id="1119" class="l"><a href="#1119"> 1119: </a>        <span class="php-comment">/**
</span></span><span id="1120" class="l"><a href="#1120"> 1120: </a><span class="php-comment">         * @var HTML PARSER: custom indent amount for lists.
</span></span><span id="1121" class="l"><a href="#1121"> 1121: </a><span class="php-comment">         * Negative value means disabled.
</span></span><span id="1122" class="l"><a href="#1122"> 1122: </a><span class="php-comment">         * @access protected
</span></span><span id="1123" class="l"><a href="#1123"> 1123: </a><span class="php-comment">         * @since 4.2.007 (2008-11-12)
</span></span><span id="1124" class="l"><a href="#1124"> 1124: </a><span class="php-comment">         */</span>
</span><span id="1125" class="l"><a href="#1125"> 1125: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$customlistindent</span> = -<span class="php-num">1</span>;
</span><span id="1126" class="l"><a href="#1126"> 1126: </a>
</span><span id="1127" class="l"><a href="#1127"> 1127: </a>        <span class="php-comment">/**
</span></span><span id="1128" class="l"><a href="#1128"> 1128: </a><span class="php-comment">         * @var if true keeps the border open for the cell sides that cross the page.
</span></span><span id="1129" class="l"><a href="#1129"> 1129: </a><span class="php-comment">         * @access protected
</span></span><span id="1130" class="l"><a href="#1130"> 1130: </a><span class="php-comment">         * @since 4.2.010 (2008-11-14)
</span></span><span id="1131" class="l"><a href="#1131"> 1131: </a><span class="php-comment">         */</span>
</span><span id="1132" class="l"><a href="#1132"> 1132: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$opencell</span> = <span class="php-keyword1">true</span>;
</span><span id="1133" class="l"><a href="#1133"> 1133: </a>
</span><span id="1134" class="l"><a href="#1134"> 1134: </a>        <span class="php-comment">/**
</span></span><span id="1135" class="l"><a href="#1135"> 1135: </a><span class="php-comment">         * @var array of files to embedd
</span></span><span id="1136" class="l"><a href="#1136"> 1136: </a><span class="php-comment">         * @access protected
</span></span><span id="1137" class="l"><a href="#1137"> 1137: </a><span class="php-comment">         * @since 4.4.000 (2008-12-07)
</span></span><span id="1138" class="l"><a href="#1138"> 1138: </a><span class="php-comment">         */</span>
</span><span id="1139" class="l"><a href="#1139"> 1139: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$embeddedfiles</span> = <span class="php-keyword1">array</span>();
</span><span id="1140" class="l"><a href="#1140"> 1140: </a>
</span><span id="1141" class="l"><a href="#1141"> 1141: </a>        <span class="php-comment">/**
</span></span><span id="1142" class="l"><a href="#1142"> 1142: </a><span class="php-comment">         * @var boolean true when inside html pre tag
</span></span><span id="1143" class="l"><a href="#1143"> 1143: </a><span class="php-comment">         * @access protected
</span></span><span id="1144" class="l"><a href="#1144"> 1144: </a><span class="php-comment">         * @since 4.4.001 (2008-12-08)
</span></span><span id="1145" class="l"><a href="#1145"> 1145: </a><span class="php-comment">         */</span>
</span><span id="1146" class="l"><a href="#1146"> 1146: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$premode</span> = <span class="php-keyword1">false</span>;
</span><span id="1147" class="l"><a href="#1147"> 1147: </a>
</span><span id="1148" class="l"><a href="#1148"> 1148: </a>        <span class="php-comment">/**
</span></span><span id="1149" class="l"><a href="#1149"> 1149: </a><span class="php-comment">         * Array used to store positions of graphics transformation blocks inside the page buffer.
</span></span><span id="1150" class="l"><a href="#1150"> 1150: </a><span class="php-comment">         * keys are the page numbers
</span></span><span id="1151" class="l"><a href="#1151"> 1151: </a><span class="php-comment">         * @access protected
</span></span><span id="1152" class="l"><a href="#1152"> 1152: </a><span class="php-comment">         * @since 4.4.002 (2008-12-09)
</span></span><span id="1153" class="l"><a href="#1153"> 1153: </a><span class="php-comment">         */</span>
</span><span id="1154" class="l"><a href="#1154"> 1154: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$transfmrk</span> = <span class="php-keyword1">array</span>();
</span><span id="1155" class="l"><a href="#1155"> 1155: </a>
</span><span id="1156" class="l"><a href="#1156"> 1156: </a>        <span class="php-comment">/**
</span></span><span id="1157" class="l"><a href="#1157"> 1157: </a><span class="php-comment">         * Default color for html links
</span></span><span id="1158" class="l"><a href="#1158"> 1158: </a><span class="php-comment">         * @access protected
</span></span><span id="1159" class="l"><a href="#1159"> 1159: </a><span class="php-comment">         * @since 4.4.003 (2008-12-09)
</span></span><span id="1160" class="l"><a href="#1160"> 1160: </a><span class="php-comment">         */</span>
</span><span id="1161" class="l"><a href="#1161"> 1161: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$htmlLinkColorArray</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">255</span>);
</span><span id="1162" class="l"><a href="#1162"> 1162: </a>
</span><span id="1163" class="l"><a href="#1163"> 1163: </a>        <span class="php-comment">/**
</span></span><span id="1164" class="l"><a href="#1164"> 1164: </a><span class="php-comment">         * Default font style to add to html links
</span></span><span id="1165" class="l"><a href="#1165"> 1165: </a><span class="php-comment">         * @access protected
</span></span><span id="1166" class="l"><a href="#1166"> 1166: </a><span class="php-comment">         * @since 4.4.003 (2008-12-09)
</span></span><span id="1167" class="l"><a href="#1167"> 1167: </a><span class="php-comment">         */</span>
</span><span id="1168" class="l"><a href="#1168"> 1168: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$htmlLinkFontStyle</span> = <span class="php-quote">'U'</span>;
</span><span id="1169" class="l"><a href="#1169"> 1169: </a>
</span><span id="1170" class="l"><a href="#1170"> 1170: </a>        <span class="php-comment">/**
</span></span><span id="1171" class="l"><a href="#1171"> 1171: </a><span class="php-comment">         * Counts the number of pages.
</span></span><span id="1172" class="l"><a href="#1172"> 1172: </a><span class="php-comment">         * @access protected
</span></span><span id="1173" class="l"><a href="#1173"> 1173: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="1174" class="l"><a href="#1174"> 1174: </a><span class="php-comment">         */</span>
</span><span id="1175" class="l"><a href="#1175"> 1175: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$numpages</span> = <span class="php-num">0</span>;
</span><span id="1176" class="l"><a href="#1176"> 1176: </a>
</span><span id="1177" class="l"><a href="#1177"> 1177: </a>        <span class="php-comment">/**
</span></span><span id="1178" class="l"><a href="#1178"> 1178: </a><span class="php-comment">         * Array containing page lengths in bytes.
</span></span><span id="1179" class="l"><a href="#1179"> 1179: </a><span class="php-comment">         * @access protected
</span></span><span id="1180" class="l"><a href="#1180"> 1180: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="1181" class="l"><a href="#1181"> 1181: </a><span class="php-comment">         */</span>
</span><span id="1182" class="l"><a href="#1182"> 1182: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$pagelen</span> = <span class="php-keyword1">array</span>();
</span><span id="1183" class="l"><a href="#1183"> 1183: </a>
</span><span id="1184" class="l"><a href="#1184"> 1184: </a>        <span class="php-comment">/**
</span></span><span id="1185" class="l"><a href="#1185"> 1185: </a><span class="php-comment">         * Counts the number of pages.
</span></span><span id="1186" class="l"><a href="#1186"> 1186: </a><span class="php-comment">         * @access protected
</span></span><span id="1187" class="l"><a href="#1187"> 1187: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="1188" class="l"><a href="#1188"> 1188: </a><span class="php-comment">         */</span>
</span><span id="1189" class="l"><a href="#1189"> 1189: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$numimages</span> = <span class="php-num">0</span>;
</span><span id="1190" class="l"><a href="#1190"> 1190: </a>
</span><span id="1191" class="l"><a href="#1191"> 1191: </a>        <span class="php-comment">/**
</span></span><span id="1192" class="l"><a href="#1192"> 1192: </a><span class="php-comment">         * Store the image keys.
</span></span><span id="1193" class="l"><a href="#1193"> 1193: </a><span class="php-comment">         * @access protected
</span></span><span id="1194" class="l"><a href="#1194"> 1194: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="1195" class="l"><a href="#1195"> 1195: </a><span class="php-comment">         */</span>
</span><span id="1196" class="l"><a href="#1196"> 1196: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$imagekeys</span> = <span class="php-keyword1">array</span>();
</span><span id="1197" class="l"><a href="#1197"> 1197: </a>
</span><span id="1198" class="l"><a href="#1198"> 1198: </a>        <span class="php-comment">/**
</span></span><span id="1199" class="l"><a href="#1199"> 1199: </a><span class="php-comment">         * Length of the buffer in bytes.
</span></span><span id="1200" class="l"><a href="#1200"> 1200: </a><span class="php-comment">         * @access protected
</span></span><span id="1201" class="l"><a href="#1201"> 1201: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="1202" class="l"><a href="#1202"> 1202: </a><span class="php-comment">         */</span>
</span><span id="1203" class="l"><a href="#1203"> 1203: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$bufferlen</span> = <span class="php-num">0</span>;
</span><span id="1204" class="l"><a href="#1204"> 1204: </a>
</span><span id="1205" class="l"><a href="#1205"> 1205: </a>        <span class="php-comment">/**
</span></span><span id="1206" class="l"><a href="#1206"> 1206: </a><span class="php-comment">         * If true enables disk caching.
</span></span><span id="1207" class="l"><a href="#1207"> 1207: </a><span class="php-comment">         * @access protected
</span></span><span id="1208" class="l"><a href="#1208"> 1208: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="1209" class="l"><a href="#1209"> 1209: </a><span class="php-comment">         */</span>
</span><span id="1210" class="l"><a href="#1210"> 1210: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$diskcache</span> = <span class="php-keyword1">false</span>;
</span><span id="1211" class="l"><a href="#1211"> 1211: </a>
</span><span id="1212" class="l"><a href="#1212"> 1212: </a>        <span class="php-comment">/**
</span></span><span id="1213" class="l"><a href="#1213"> 1213: </a><span class="php-comment">         * Counts the number of fonts.
</span></span><span id="1214" class="l"><a href="#1214"> 1214: </a><span class="php-comment">         * @access protected
</span></span><span id="1215" class="l"><a href="#1215"> 1215: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="1216" class="l"><a href="#1216"> 1216: </a><span class="php-comment">         */</span>
</span><span id="1217" class="l"><a href="#1217"> 1217: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$numfonts</span> = <span class="php-num">0</span>;
</span><span id="1218" class="l"><a href="#1218"> 1218: </a>
</span><span id="1219" class="l"><a href="#1219"> 1219: </a>        <span class="php-comment">/**
</span></span><span id="1220" class="l"><a href="#1220"> 1220: </a><span class="php-comment">         * Store the font keys.
</span></span><span id="1221" class="l"><a href="#1221"> 1221: </a><span class="php-comment">         * @access protected
</span></span><span id="1222" class="l"><a href="#1222"> 1222: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="1223" class="l"><a href="#1223"> 1223: </a><span class="php-comment">         */</span>
</span><span id="1224" class="l"><a href="#1224"> 1224: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$fontkeys</span> = <span class="php-keyword1">array</span>();
</span><span id="1225" class="l"><a href="#1225"> 1225: </a>
</span><span id="1226" class="l"><a href="#1226"> 1226: </a>        <span class="php-comment">/**
</span></span><span id="1227" class="l"><a href="#1227"> 1227: </a><span class="php-comment">         * Store the font object IDs.
</span></span><span id="1228" class="l"><a href="#1228"> 1228: </a><span class="php-comment">         * @access protected
</span></span><span id="1229" class="l"><a href="#1229"> 1229: </a><span class="php-comment">         * @since 4.8.001 (2009-09-09)
</span></span><span id="1230" class="l"><a href="#1230"> 1230: </a><span class="php-comment">         */</span>
</span><span id="1231" class="l"><a href="#1231"> 1231: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$font_obj_ids</span> = <span class="php-keyword1">array</span>();
</span><span id="1232" class="l"><a href="#1232"> 1232: </a>
</span><span id="1233" class="l"><a href="#1233"> 1233: </a>        <span class="php-comment">/**
</span></span><span id="1234" class="l"><a href="#1234"> 1234: </a><span class="php-comment">         * Store the fage status (true when opened, false when closed).
</span></span><span id="1235" class="l"><a href="#1235"> 1235: </a><span class="php-comment">         * @access protected
</span></span><span id="1236" class="l"><a href="#1236"> 1236: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="1237" class="l"><a href="#1237"> 1237: </a><span class="php-comment">         */</span>
</span><span id="1238" class="l"><a href="#1238"> 1238: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$pageopen</span> = <span class="php-keyword1">array</span>();
</span><span id="1239" class="l"><a href="#1239"> 1239: </a>
</span><span id="1240" class="l"><a href="#1240"> 1240: </a>        <span class="php-comment">/**
</span></span><span id="1241" class="l"><a href="#1241"> 1241: </a><span class="php-comment">         * Default monospaced font
</span></span><span id="1242" class="l"><a href="#1242"> 1242: </a><span class="php-comment">         * @access protected
</span></span><span id="1243" class="l"><a href="#1243"> 1243: </a><span class="php-comment">         * @since 4.5.025 (2009-03-10)
</span></span><span id="1244" class="l"><a href="#1244"> 1244: </a><span class="php-comment">         */</span>
</span><span id="1245" class="l"><a href="#1245"> 1245: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$default_monospaced_font</span> = <span class="php-quote">'courier'</span>;
</span><span id="1246" class="l"><a href="#1246"> 1246: </a>
</span><span id="1247" class="l"><a href="#1247"> 1247: </a>        <span class="php-comment">/**
</span></span><span id="1248" class="l"><a href="#1248"> 1248: </a><span class="php-comment">         * Used to store a cloned copy of the current class object
</span></span><span id="1249" class="l"><a href="#1249"> 1249: </a><span class="php-comment">         * @access protected
</span></span><span id="1250" class="l"><a href="#1250"> 1250: </a><span class="php-comment">         * @since 4.5.029 (2009-03-19)
</span></span><span id="1251" class="l"><a href="#1251"> 1251: </a><span class="php-comment">         */</span>
</span><span id="1252" class="l"><a href="#1252"> 1252: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$objcopy</span>;
</span><span id="1253" class="l"><a href="#1253"> 1253: </a>
</span><span id="1254" class="l"><a href="#1254"> 1254: </a>        <span class="php-comment">/**
</span></span><span id="1255" class="l"><a href="#1255"> 1255: </a><span class="php-comment">         * Array used to store the lengths of cache files
</span></span><span id="1256" class="l"><a href="#1256"> 1256: </a><span class="php-comment">         * @access protected
</span></span><span id="1257" class="l"><a href="#1257"> 1257: </a><span class="php-comment">         * @since 4.5.029 (2009-03-19)
</span></span><span id="1258" class="l"><a href="#1258"> 1258: </a><span class="php-comment">         */</span>
</span><span id="1259" class="l"><a href="#1259"> 1259: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$cache_file_length</span> = <span class="php-keyword1">array</span>();
</span><span id="1260" class="l"><a href="#1260"> 1260: </a>
</span><span id="1261" class="l"><a href="#1261"> 1261: </a>        <span class="php-comment">/**
</span></span><span id="1262" class="l"><a href="#1262"> 1262: </a><span class="php-comment">         * Table header content to be repeated on each new page
</span></span><span id="1263" class="l"><a href="#1263"> 1263: </a><span class="php-comment">         * @access protected
</span></span><span id="1264" class="l"><a href="#1264"> 1264: </a><span class="php-comment">         * @since 4.5.030 (2009-03-20)
</span></span><span id="1265" class="l"><a href="#1265"> 1265: </a><span class="php-comment">         */</span>
</span><span id="1266" class="l"><a href="#1266"> 1266: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$thead</span> = <span class="php-quote">''</span>;
</span><span id="1267" class="l"><a href="#1267"> 1267: </a>
</span><span id="1268" class="l"><a href="#1268"> 1268: </a>        <span class="php-comment">/**
</span></span><span id="1269" class="l"><a href="#1269"> 1269: </a><span class="php-comment">         * Margins used for table header.
</span></span><span id="1270" class="l"><a href="#1270"> 1270: </a><span class="php-comment">         * @access protected
</span></span><span id="1271" class="l"><a href="#1271"> 1271: </a><span class="php-comment">         * @since 4.5.030 (2009-03-20)
</span></span><span id="1272" class="l"><a href="#1272"> 1272: </a><span class="php-comment">         */</span>
</span><span id="1273" class="l"><a href="#1273"> 1273: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$theadMargins</span> = <span class="php-keyword1">array</span>();
</span><span id="1274" class="l"><a href="#1274"> 1274: </a>
</span><span id="1275" class="l"><a href="#1275"> 1275: </a>        <span class="php-comment">/**
</span></span><span id="1276" class="l"><a href="#1276"> 1276: </a><span class="php-comment">         * Cache array for UTF8StringToArray() method.
</span></span><span id="1277" class="l"><a href="#1277"> 1277: </a><span class="php-comment">         * @access protected
</span></span><span id="1278" class="l"><a href="#1278"> 1278: </a><span class="php-comment">         * @since 4.5.037 (2009-04-07)
</span></span><span id="1279" class="l"><a href="#1279"> 1279: </a><span class="php-comment">         */</span>
</span><span id="1280" class="l"><a href="#1280"> 1280: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$cache_UTF8StringToArray</span> = <span class="php-keyword1">array</span>();
</span><span id="1281" class="l"><a href="#1281"> 1281: </a>
</span><span id="1282" class="l"><a href="#1282"> 1282: </a>        <span class="php-comment">/**
</span></span><span id="1283" class="l"><a href="#1283"> 1283: </a><span class="php-comment">         * Maximum size of cache array used for UTF8StringToArray() method.
</span></span><span id="1284" class="l"><a href="#1284"> 1284: </a><span class="php-comment">         * @access protected
</span></span><span id="1285" class="l"><a href="#1285"> 1285: </a><span class="php-comment">         * @since 4.5.037 (2009-04-07)
</span></span><span id="1286" class="l"><a href="#1286"> 1286: </a><span class="php-comment">         */</span>
</span><span id="1287" class="l"><a href="#1287"> 1287: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$cache_maxsize_UTF8StringToArray</span> = <span class="php-num">8</span>;
</span><span id="1288" class="l"><a href="#1288"> 1288: </a>
</span><span id="1289" class="l"><a href="#1289"> 1289: </a>        <span class="php-comment">/**
</span></span><span id="1290" class="l"><a href="#1290"> 1290: </a><span class="php-comment">         * Current size of cache array used for UTF8StringToArray() method.
</span></span><span id="1291" class="l"><a href="#1291"> 1291: </a><span class="php-comment">         * @access protected
</span></span><span id="1292" class="l"><a href="#1292"> 1292: </a><span class="php-comment">         * @since 4.5.037 (2009-04-07)
</span></span><span id="1293" class="l"><a href="#1293"> 1293: </a><span class="php-comment">         */</span>
</span><span id="1294" class="l"><a href="#1294"> 1294: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$cache_size_UTF8StringToArray</span> = <span class="php-num">0</span>;
</span><span id="1295" class="l"><a href="#1295"> 1295: </a>
</span><span id="1296" class="l"><a href="#1296"> 1296: </a>        <span class="php-comment">/**
</span></span><span id="1297" class="l"><a href="#1297"> 1297: </a><span class="php-comment">         * If true enables document signing
</span></span><span id="1298" class="l"><a href="#1298"> 1298: </a><span class="php-comment">         * @access protected
</span></span><span id="1299" class="l"><a href="#1299"> 1299: </a><span class="php-comment">         * @since 4.6.005 (2009-04-24)
</span></span><span id="1300" class="l"><a href="#1300"> 1300: </a><span class="php-comment">         */</span>
</span><span id="1301" class="l"><a href="#1301"> 1301: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$sign</span> = <span class="php-keyword1">false</span>;
</span><span id="1302" class="l"><a href="#1302"> 1302: </a>
</span><span id="1303" class="l"><a href="#1303"> 1303: </a>        <span class="php-comment">/**
</span></span><span id="1304" class="l"><a href="#1304"> 1304: </a><span class="php-comment">         * Signature data
</span></span><span id="1305" class="l"><a href="#1305"> 1305: </a><span class="php-comment">         * @access protected
</span></span><span id="1306" class="l"><a href="#1306"> 1306: </a><span class="php-comment">         * @since 4.6.005 (2009-04-24)
</span></span><span id="1307" class="l"><a href="#1307"> 1307: </a><span class="php-comment">         */</span>
</span><span id="1308" class="l"><a href="#1308"> 1308: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$signature_data</span> = <span class="php-keyword1">array</span>();
</span><span id="1309" class="l"><a href="#1309"> 1309: </a>
</span><span id="1310" class="l"><a href="#1310"> 1310: </a>        <span class="php-comment">/**
</span></span><span id="1311" class="l"><a href="#1311"> 1311: </a><span class="php-comment">         * Signature max length
</span></span><span id="1312" class="l"><a href="#1312"> 1312: </a><span class="php-comment">         * @access protected
</span></span><span id="1313" class="l"><a href="#1313"> 1313: </a><span class="php-comment">         * @since 4.6.005 (2009-04-24)
</span></span><span id="1314" class="l"><a href="#1314"> 1314: </a><span class="php-comment">         */</span>
</span><span id="1315" class="l"><a href="#1315"> 1315: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$signature_max_length</span> = <span class="php-num">11742</span>;
</span><span id="1316" class="l"><a href="#1316"> 1316: </a>
</span><span id="1317" class="l"><a href="#1317"> 1317: </a>        <span class="php-comment">/**
</span></span><span id="1318" class="l"><a href="#1318"> 1318: </a><span class="php-comment">         * Regular expression used to find blank characters used for word-wrapping.
</span></span><span id="1319" class="l"><a href="#1319"> 1319: </a><span class="php-comment">         * @access protected
</span></span><span id="1320" class="l"><a href="#1320"> 1320: </a><span class="php-comment">         * @since 4.6.006 (2009-04-28)
</span></span><span id="1321" class="l"><a href="#1321"> 1321: </a><span class="php-comment">         */</span>
</span><span id="1322" class="l"><a href="#1322"> 1322: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$re_spaces</span> = <span class="php-quote">'/[\s]/'</span>;
</span><span id="1323" class="l"><a href="#1323"> 1323: </a>
</span><span id="1324" class="l"><a href="#1324"> 1324: </a>        <span class="php-comment">/**
</span></span><span id="1325" class="l"><a href="#1325"> 1325: </a><span class="php-comment">         * Signature object ID
</span></span><span id="1326" class="l"><a href="#1326"> 1326: </a><span class="php-comment">         * @access protected
</span></span><span id="1327" class="l"><a href="#1327"> 1327: </a><span class="php-comment">         * @since 4.6.022 (2009-06-23)
</span></span><span id="1328" class="l"><a href="#1328"> 1328: </a><span class="php-comment">         */</span>
</span><span id="1329" class="l"><a href="#1329"> 1329: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$sig_obj_id</span> = <span class="php-num">0</span>;
</span><span id="1330" class="l"><a href="#1330"> 1330: </a>
</span><span id="1331" class="l"><a href="#1331"> 1331: </a>        <span class="php-comment">/**
</span></span><span id="1332" class="l"><a href="#1332"> 1332: </a><span class="php-comment">         * ByteRange placemark used during signature process.
</span></span><span id="1333" class="l"><a href="#1333"> 1333: </a><span class="php-comment">         * @access protected
</span></span><span id="1334" class="l"><a href="#1334"> 1334: </a><span class="php-comment">         * @since 4.6.028 (2009-08-25)
</span></span><span id="1335" class="l"><a href="#1335"> 1335: </a><span class="php-comment">         */</span>
</span><span id="1336" class="l"><a href="#1336"> 1336: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$byterange_string</span> = <span class="php-quote">'/ByteRange[0 ********** ********** **********]'</span>;
</span><span id="1337" class="l"><a href="#1337"> 1337: </a>
</span><span id="1338" class="l"><a href="#1338"> 1338: </a>        <span class="php-comment">/**
</span></span><span id="1339" class="l"><a href="#1339"> 1339: </a><span class="php-comment">         * Placemark used during signature process.
</span></span><span id="1340" class="l"><a href="#1340"> 1340: </a><span class="php-comment">         * @access protected
</span></span><span id="1341" class="l"><a href="#1341"> 1341: </a><span class="php-comment">         * @since 4.6.028 (2009-08-25)
</span></span><span id="1342" class="l"><a href="#1342"> 1342: </a><span class="php-comment">         */</span>
</span><span id="1343" class="l"><a href="#1343"> 1343: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$sig_annot_ref</span> = <span class="php-quote">'***SIGANNREF*** 0 R'</span>;
</span><span id="1344" class="l"><a href="#1344"> 1344: </a>
</span><span id="1345" class="l"><a href="#1345"> 1345: </a>        <span class="php-comment">/**
</span></span><span id="1346" class="l"><a href="#1346"> 1346: </a><span class="php-comment">         * ID of page objects
</span></span><span id="1347" class="l"><a href="#1347"> 1347: </a><span class="php-comment">         * @access protected
</span></span><span id="1348" class="l"><a href="#1348"> 1348: </a><span class="php-comment">         * @since 4.7.000 (2009-08-29)
</span></span><span id="1349" class="l"><a href="#1349"> 1349: </a><span class="php-comment">         */</span>
</span><span id="1350" class="l"><a href="#1350"> 1350: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$page_obj_id</span> = <span class="php-keyword1">array</span>();
</span><span id="1351" class="l"><a href="#1351"> 1351: </a>
</span><span id="1352" class="l"><a href="#1352"> 1352: </a>        <span class="php-comment">/**
</span></span><span id="1353" class="l"><a href="#1353"> 1353: </a><span class="php-comment">         * Start ID for embedded file objects
</span></span><span id="1354" class="l"><a href="#1354"> 1354: </a><span class="php-comment">         * @access protected
</span></span><span id="1355" class="l"><a href="#1355"> 1355: </a><span class="php-comment">         * @since 4.7.000 (2009-08-29)
</span></span><span id="1356" class="l"><a href="#1356"> 1356: </a><span class="php-comment">         */</span>
</span><span id="1357" class="l"><a href="#1357"> 1357: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$embedded_start_obj_id</span> = <span class="php-num">100000</span>;
</span><span id="1358" class="l"><a href="#1358"> 1358: </a>
</span><span id="1359" class="l"><a href="#1359"> 1359: </a>        <span class="php-comment">/**
</span></span><span id="1360" class="l"><a href="#1360"> 1360: </a><span class="php-comment">         * Start ID for annotation objects
</span></span><span id="1361" class="l"><a href="#1361"> 1361: </a><span class="php-comment">         * @access protected
</span></span><span id="1362" class="l"><a href="#1362"> 1362: </a><span class="php-comment">         * @since 4.7.000 (2009-08-29)
</span></span><span id="1363" class="l"><a href="#1363"> 1363: </a><span class="php-comment">         */</span>
</span><span id="1364" class="l"><a href="#1364"> 1364: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$annots_start_obj_id</span> = <span class="php-num">200000</span>;
</span><span id="1365" class="l"><a href="#1365"> 1365: </a>
</span><span id="1366" class="l"><a href="#1366"> 1366: </a>        <span class="php-comment">/**
</span></span><span id="1367" class="l"><a href="#1367"> 1367: </a><span class="php-comment">         * Max ID of annotation object
</span></span><span id="1368" class="l"><a href="#1368"> 1368: </a><span class="php-comment">         * @access protected
</span></span><span id="1369" class="l"><a href="#1369"> 1369: </a><span class="php-comment">         * @since 4.7.000 (2009-08-29)
</span></span><span id="1370" class="l"><a href="#1370"> 1370: </a><span class="php-comment">         */</span>
</span><span id="1371" class="l"><a href="#1371"> 1371: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$annot_obj_id</span> = <span class="php-num">200000</span>;
</span><span id="1372" class="l"><a href="#1372"> 1372: </a>
</span><span id="1373" class="l"><a href="#1373"> 1373: </a>        <span class="php-comment">/**
</span></span><span id="1374" class="l"><a href="#1374"> 1374: </a><span class="php-comment">         * Current ID of annotation object
</span></span><span id="1375" class="l"><a href="#1375"> 1375: </a><span class="php-comment">         * @access protected
</span></span><span id="1376" class="l"><a href="#1376"> 1376: </a><span class="php-comment">         * @since 4.8.003 (2009-09-15)
</span></span><span id="1377" class="l"><a href="#1377"> 1377: </a><span class="php-comment">         */</span>
</span><span id="1378" class="l"><a href="#1378"> 1378: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$curr_annot_obj_id</span> = <span class="php-num">200000</span>;
</span><span id="1379" class="l"><a href="#1379"> 1379: </a>
</span><span id="1380" class="l"><a href="#1380"> 1380: </a>        <span class="php-comment">/**
</span></span><span id="1381" class="l"><a href="#1381"> 1381: </a><span class="php-comment">         * List of form annotations IDs
</span></span><span id="1382" class="l"><a href="#1382"> 1382: </a><span class="php-comment">         * @access protected
</span></span><span id="1383" class="l"><a href="#1383"> 1383: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1384" class="l"><a href="#1384"> 1384: </a><span class="php-comment">         */</span>
</span><span id="1385" class="l"><a href="#1385"> 1385: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$form_obj_id</span> = <span class="php-keyword1">array</span>();
</span><span id="1386" class="l"><a href="#1386"> 1386: </a>
</span><span id="1387" class="l"><a href="#1387"> 1387: </a>        <span class="php-comment">/**
</span></span><span id="1388" class="l"><a href="#1388"> 1388: </a><span class="php-comment">         * Deafult Javascript field properties. Possible values are described on official Javascript for Acrobat API reference. Annotation options can be directly specified using the 'aopt' entry.
</span></span><span id="1389" class="l"><a href="#1389"> 1389: </a><span class="php-comment">         * @access protected
</span></span><span id="1390" class="l"><a href="#1390"> 1390: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1391" class="l"><a href="#1391"> 1391: </a><span class="php-comment">         */</span>
</span><span id="1392" class="l"><a href="#1392"> 1392: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$default_form_prop</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'lineWidth'</span>=&gt;<span class="php-num">1</span>, <span class="php-quote">'borderStyle'</span>=&gt;<span class="php-quote">'solid'</span>, <span class="php-quote">'fillColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">255</span>, <span class="php-num">255</span>, <span class="php-num">255</span>), <span class="php-quote">'strokeColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">128</span>, <span class="php-num">128</span>, <span class="php-num">128</span>));
</span><span id="1393" class="l"><a href="#1393"> 1393: </a>
</span><span id="1394" class="l"><a href="#1394"> 1394: </a>        <span class="php-comment">/**
</span></span><span id="1395" class="l"><a href="#1395"> 1395: </a><span class="php-comment">         * Javascript objects array
</span></span><span id="1396" class="l"><a href="#1396"> 1396: </a><span class="php-comment">         * @access protected
</span></span><span id="1397" class="l"><a href="#1397"> 1397: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1398" class="l"><a href="#1398"> 1398: </a><span class="php-comment">         */</span>
</span><span id="1399" class="l"><a href="#1399"> 1399: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$js_objects</span> = <span class="php-keyword1">array</span>();
</span><span id="1400" class="l"><a href="#1400"> 1400: </a>
</span><span id="1401" class="l"><a href="#1401"> 1401: </a>        <span class="php-comment">/**
</span></span><span id="1402" class="l"><a href="#1402"> 1402: </a><span class="php-comment">         * Start ID for javascript objects
</span></span><span id="1403" class="l"><a href="#1403"> 1403: </a><span class="php-comment">         * @access protected
</span></span><span id="1404" class="l"><a href="#1404"> 1404: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1405" class="l"><a href="#1405"> 1405: </a><span class="php-comment">         */</span>
</span><span id="1406" class="l"><a href="#1406"> 1406: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$js_start_obj_id</span> = <span class="php-num">300000</span>;
</span><span id="1407" class="l"><a href="#1407"> 1407: </a>
</span><span id="1408" class="l"><a href="#1408"> 1408: </a>        <span class="php-comment">/**
</span></span><span id="1409" class="l"><a href="#1409"> 1409: </a><span class="php-comment">         * Current ID of javascript object
</span></span><span id="1410" class="l"><a href="#1410"> 1410: </a><span class="php-comment">         * @access protected
</span></span><span id="1411" class="l"><a href="#1411"> 1411: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1412" class="l"><a href="#1412"> 1412: </a><span class="php-comment">         */</span>
</span><span id="1413" class="l"><a href="#1413"> 1413: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$js_obj_id</span> = <span class="php-num">300000</span>;
</span><span id="1414" class="l"><a href="#1414"> 1414: </a>
</span><span id="1415" class="l"><a href="#1415"> 1415: </a>        <span class="php-comment">/**
</span></span><span id="1416" class="l"><a href="#1416"> 1416: </a><span class="php-comment">         * Current form action (used during XHTML rendering)
</span></span><span id="1417" class="l"><a href="#1417"> 1417: </a><span class="php-comment">         * @access protected
</span></span><span id="1418" class="l"><a href="#1418"> 1418: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1419" class="l"><a href="#1419"> 1419: </a><span class="php-comment">         */</span>
</span><span id="1420" class="l"><a href="#1420"> 1420: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$form_action</span> = <span class="php-quote">''</span>;
</span><span id="1421" class="l"><a href="#1421"> 1421: </a>
</span><span id="1422" class="l"><a href="#1422"> 1422: </a>        <span class="php-comment">/**
</span></span><span id="1423" class="l"><a href="#1423"> 1423: </a><span class="php-comment">         * Current form encryption type (used during XHTML rendering)
</span></span><span id="1424" class="l"><a href="#1424"> 1424: </a><span class="php-comment">         * @access protected
</span></span><span id="1425" class="l"><a href="#1425"> 1425: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1426" class="l"><a href="#1426"> 1426: </a><span class="php-comment">         */</span>
</span><span id="1427" class="l"><a href="#1427"> 1427: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$form_enctype</span> = <span class="php-quote">'application/x-www-form-urlencoded'</span>;
</span><span id="1428" class="l"><a href="#1428"> 1428: </a>
</span><span id="1429" class="l"><a href="#1429"> 1429: </a>        <span class="php-comment">/**
</span></span><span id="1430" class="l"><a href="#1430"> 1430: </a><span class="php-comment">         * Current method to submit forms.
</span></span><span id="1431" class="l"><a href="#1431"> 1431: </a><span class="php-comment">         * @access protected
</span></span><span id="1432" class="l"><a href="#1432"> 1432: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="1433" class="l"><a href="#1433"> 1433: </a><span class="php-comment">         */</span>
</span><span id="1434" class="l"><a href="#1434"> 1434: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$form_mode</span> = <span class="php-quote">'post'</span>;
</span><span id="1435" class="l"><a href="#1435"> 1435: </a>
</span><span id="1436" class="l"><a href="#1436"> 1436: </a>        <span class="php-comment">/**
</span></span><span id="1437" class="l"><a href="#1437"> 1437: </a><span class="php-comment">         * Start ID for appearance streams XObjects
</span></span><span id="1438" class="l"><a href="#1438"> 1438: </a><span class="php-comment">         * @access protected
</span></span><span id="1439" class="l"><a href="#1439"> 1439: </a><span class="php-comment">         * @since 4.8.001 (2009-09-09)
</span></span><span id="1440" class="l"><a href="#1440"> 1440: </a><span class="php-comment">         */</span>
</span><span id="1441" class="l"><a href="#1441"> 1441: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$apxo_start_obj_id</span> = <span class="php-num">400000</span>;
</span><span id="1442" class="l"><a href="#1442"> 1442: </a>
</span><span id="1443" class="l"><a href="#1443"> 1443: </a>        <span class="php-comment">/**
</span></span><span id="1444" class="l"><a href="#1444"> 1444: </a><span class="php-comment">         * Current ID of appearance streams XObjects
</span></span><span id="1445" class="l"><a href="#1445"> 1445: </a><span class="php-comment">         * @access protected
</span></span><span id="1446" class="l"><a href="#1446"> 1446: </a><span class="php-comment">         * @since 4.8.001 (2009-09-09)
</span></span><span id="1447" class="l"><a href="#1447"> 1447: </a><span class="php-comment">         */</span>
</span><span id="1448" class="l"><a href="#1448"> 1448: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$apxo_obj_id</span> = <span class="php-num">400000</span>;
</span><span id="1449" class="l"><a href="#1449"> 1449: </a>
</span><span id="1450" class="l"><a href="#1450"> 1450: </a>        <span class="php-comment">/**
</span></span><span id="1451" class="l"><a href="#1451"> 1451: </a><span class="php-comment">         * List of fonts used on form fields (fontname =&gt; fontkey).
</span></span><span id="1452" class="l"><a href="#1452"> 1452: </a><span class="php-comment">         * @access protected
</span></span><span id="1453" class="l"><a href="#1453"> 1453: </a><span class="php-comment">         * @since 4.8.001 (2009-09-09)
</span></span><span id="1454" class="l"><a href="#1454"> 1454: </a><span class="php-comment">         */</span>
</span><span id="1455" class="l"><a href="#1455"> 1455: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$annotation_fonts</span> = <span class="php-keyword1">array</span>();
</span><span id="1456" class="l"><a href="#1456"> 1456: </a>
</span><span id="1457" class="l"><a href="#1457"> 1457: </a>        <span class="php-comment">/**
</span></span><span id="1458" class="l"><a href="#1458"> 1458: </a><span class="php-comment">         * List of radio buttons parent objects.
</span></span><span id="1459" class="l"><a href="#1459"> 1459: </a><span class="php-comment">         * @access protected
</span></span><span id="1460" class="l"><a href="#1460"> 1460: </a><span class="php-comment">         * @since 4.8.001 (2009-09-09)
</span></span><span id="1461" class="l"><a href="#1461"> 1461: </a><span class="php-comment">         */</span>
</span><span id="1462" class="l"><a href="#1462"> 1462: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$radiobutton_groups</span> = <span class="php-keyword1">array</span>();
</span><span id="1463" class="l"><a href="#1463"> 1463: </a>
</span><span id="1464" class="l"><a href="#1464"> 1464: </a>        <span class="php-comment">/**
</span></span><span id="1465" class="l"><a href="#1465"> 1465: </a><span class="php-comment">         * List of radio group objects IDs
</span></span><span id="1466" class="l"><a href="#1466"> 1466: </a><span class="php-comment">         * @access protected
</span></span><span id="1467" class="l"><a href="#1467"> 1467: </a><span class="php-comment">         * @since 4.8.001 (2009-09-09)
</span></span><span id="1468" class="l"><a href="#1468"> 1468: </a><span class="php-comment">         */</span>
</span><span id="1469" class="l"><a href="#1469"> 1469: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$radio_groups</span> = <span class="php-keyword1">array</span>();
</span><span id="1470" class="l"><a href="#1470"> 1470: </a>
</span><span id="1471" class="l"><a href="#1471"> 1471: </a>        <span class="php-comment">/**
</span></span><span id="1472" class="l"><a href="#1472"> 1472: </a><span class="php-comment">         * Text indentation value (used for text-indent CSS attribute)
</span></span><span id="1473" class="l"><a href="#1473"> 1473: </a><span class="php-comment">         * @access protected
</span></span><span id="1474" class="l"><a href="#1474"> 1474: </a><span class="php-comment">         * @since 4.8.006 (2009-09-23)
</span></span><span id="1475" class="l"><a href="#1475"> 1475: </a><span class="php-comment">         */</span>
</span><span id="1476" class="l"><a href="#1476"> 1476: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$textindent</span> = <span class="php-num">0</span>;
</span><span id="1477" class="l"><a href="#1477"> 1477: </a>
</span><span id="1478" class="l"><a href="#1478"> 1478: </a>        <span class="php-comment">/**
</span></span><span id="1479" class="l"><a href="#1479"> 1479: </a><span class="php-comment">         * Store page number when startTransaction() is called.
</span></span><span id="1480" class="l"><a href="#1480"> 1480: </a><span class="php-comment">         * @access protected
</span></span><span id="1481" class="l"><a href="#1481"> 1481: </a><span class="php-comment">         * @since 4.8.006 (2009-09-23)
</span></span><span id="1482" class="l"><a href="#1482"> 1482: </a><span class="php-comment">         */</span>
</span><span id="1483" class="l"><a href="#1483"> 1483: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$start_transaction_page</span> = <span class="php-num">0</span>;
</span><span id="1484" class="l"><a href="#1484"> 1484: </a>
</span><span id="1485" class="l"><a href="#1485"> 1485: </a>        <span class="php-comment">/**
</span></span><span id="1486" class="l"><a href="#1486"> 1486: </a><span class="php-comment">         * Store Y position when startTransaction() is called.
</span></span><span id="1487" class="l"><a href="#1487"> 1487: </a><span class="php-comment">         * @access protected
</span></span><span id="1488" class="l"><a href="#1488"> 1488: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="1489" class="l"><a href="#1489"> 1489: </a><span class="php-comment">         */</span>
</span><span id="1490" class="l"><a href="#1490"> 1490: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$start_transaction_y</span> = <span class="php-num">0</span>;
</span><span id="1491" class="l"><a href="#1491"> 1491: </a>
</span><span id="1492" class="l"><a href="#1492"> 1492: </a>        <span class="php-comment">/**
</span></span><span id="1493" class="l"><a href="#1493"> 1493: </a><span class="php-comment">         * True when we are printing the thead section on a new page
</span></span><span id="1494" class="l"><a href="#1494"> 1494: </a><span class="php-comment">         * @access protected
</span></span><span id="1495" class="l"><a href="#1495"> 1495: </a><span class="php-comment">         * @since 4.8.027 (2010-01-25)
</span></span><span id="1496" class="l"><a href="#1496"> 1496: </a><span class="php-comment">         */</span>
</span><span id="1497" class="l"><a href="#1497"> 1497: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$inthead</span> = <span class="php-keyword1">false</span>;
</span><span id="1498" class="l"><a href="#1498"> 1498: </a>
</span><span id="1499" class="l"><a href="#1499"> 1499: </a>        <span class="php-comment">/**
</span></span><span id="1500" class="l"><a href="#1500"> 1500: </a><span class="php-comment">         * Array of column measures (width, space, starting Y position)
</span></span><span id="1501" class="l"><a href="#1501"> 1501: </a><span class="php-comment">         * @access protected
</span></span><span id="1502" class="l"><a href="#1502"> 1502: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="1503" class="l"><a href="#1503"> 1503: </a><span class="php-comment">         */</span>
</span><span id="1504" class="l"><a href="#1504"> 1504: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$columns</span> = <span class="php-keyword1">array</span>();
</span><span id="1505" class="l"><a href="#1505"> 1505: </a>
</span><span id="1506" class="l"><a href="#1506"> 1506: </a>        <span class="php-comment">/**
</span></span><span id="1507" class="l"><a href="#1507"> 1507: </a><span class="php-comment">         * Number of colums
</span></span><span id="1508" class="l"><a href="#1508"> 1508: </a><span class="php-comment">         * @access protected
</span></span><span id="1509" class="l"><a href="#1509"> 1509: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="1510" class="l"><a href="#1510"> 1510: </a><span class="php-comment">         */</span>
</span><span id="1511" class="l"><a href="#1511"> 1511: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$num_columns</span> = <span class="php-num">0</span>;
</span><span id="1512" class="l"><a href="#1512"> 1512: </a>
</span><span id="1513" class="l"><a href="#1513"> 1513: </a>        <span class="php-comment">/**
</span></span><span id="1514" class="l"><a href="#1514"> 1514: </a><span class="php-comment">         * Current column number
</span></span><span id="1515" class="l"><a href="#1515"> 1515: </a><span class="php-comment">         * @access protected
</span></span><span id="1516" class="l"><a href="#1516"> 1516: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="1517" class="l"><a href="#1517"> 1517: </a><span class="php-comment">         */</span>
</span><span id="1518" class="l"><a href="#1518"> 1518: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$current_column</span> = <span class="php-num">0</span>;
</span><span id="1519" class="l"><a href="#1519"> 1519: </a>
</span><span id="1520" class="l"><a href="#1520"> 1520: </a>        <span class="php-comment">/**
</span></span><span id="1521" class="l"><a href="#1521"> 1521: </a><span class="php-comment">         * Starting page for columns
</span></span><span id="1522" class="l"><a href="#1522"> 1522: </a><span class="php-comment">         * @access protected
</span></span><span id="1523" class="l"><a href="#1523"> 1523: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="1524" class="l"><a href="#1524"> 1524: </a><span class="php-comment">         */</span>
</span><span id="1525" class="l"><a href="#1525"> 1525: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$column_start_page</span> = <span class="php-num">0</span>;
</span><span id="1526" class="l"><a href="#1526"> 1526: </a>
</span><span id="1527" class="l"><a href="#1527"> 1527: </a>        <span class="php-comment">/**
</span></span><span id="1528" class="l"><a href="#1528"> 1528: </a><span class="php-comment">         * Text rendering mode: 0 = Fill text; 1 = Stroke text; 2 = Fill, then stroke text; 3 = Neither fill nor stroke text (invisible); 4 = Fill text and add to path for clipping; 5 = Stroke text and add to path for clipping; 6 = Fill, then stroke text and add to path for clipping; 7 = Add text to path for clipping.
</span></span><span id="1529" class="l"><a href="#1529"> 1529: </a><span class="php-comment">         * @access protected
</span></span><span id="1530" class="l"><a href="#1530"> 1530: </a><span class="php-comment">         * @since 4.9.008 (2010-04-03)
</span></span><span id="1531" class="l"><a href="#1531"> 1531: </a><span class="php-comment">         */</span>
</span><span id="1532" class="l"><a href="#1532"> 1532: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$textrendermode</span> = <span class="php-num">0</span>;
</span><span id="1533" class="l"><a href="#1533"> 1533: </a>
</span><span id="1534" class="l"><a href="#1534"> 1534: </a>        <span class="php-comment">/**
</span></span><span id="1535" class="l"><a href="#1535"> 1535: </a><span class="php-comment">         * Text stroke width in doc units
</span></span><span id="1536" class="l"><a href="#1536"> 1536: </a><span class="php-comment">         * @access protected
</span></span><span id="1537" class="l"><a href="#1537"> 1537: </a><span class="php-comment">         * @since 4.9.008 (2010-04-03)
</span></span><span id="1538" class="l"><a href="#1538"> 1538: </a><span class="php-comment">         */</span>
</span><span id="1539" class="l"><a href="#1539"> 1539: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$textstrokewidth</span> = <span class="php-num">0</span>;
</span><span id="1540" class="l"><a href="#1540"> 1540: </a>
</span><span id="1541" class="l"><a href="#1541"> 1541: </a>        <span class="php-comment">/**
</span></span><span id="1542" class="l"><a href="#1542"> 1542: </a><span class="php-comment">         * @var current stroke color
</span></span><span id="1543" class="l"><a href="#1543"> 1543: </a><span class="php-comment">         * @access protected
</span></span><span id="1544" class="l"><a href="#1544"> 1544: </a><span class="php-comment">         * @since 4.9.008 (2010-04-03)
</span></span><span id="1545" class="l"><a href="#1545"> 1545: </a><span class="php-comment">         */</span>
</span><span id="1546" class="l"><a href="#1546"> 1546: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$strokecolor</span>;
</span><span id="1547" class="l"><a href="#1547"> 1547: </a>
</span><span id="1548" class="l"><a href="#1548"> 1548: </a>        <span class="php-comment">/**
</span></span><span id="1549" class="l"><a href="#1549"> 1549: </a><span class="php-comment">         * @var default unit of measure for document
</span></span><span id="1550" class="l"><a href="#1550"> 1550: </a><span class="php-comment">         * @access protected
</span></span><span id="1551" class="l"><a href="#1551"> 1551: </a><span class="php-comment">         * @since 5.0.000 (2010-04-22)
</span></span><span id="1552" class="l"><a href="#1552"> 1552: </a><span class="php-comment">         */</span>
</span><span id="1553" class="l"><a href="#1553"> 1553: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$pdfunit</span> = <span class="php-quote">'mm'</span>;
</span><span id="1554" class="l"><a href="#1554"> 1554: </a>
</span><span id="1555" class="l"><a href="#1555"> 1555: </a>        <span class="php-comment">/**
</span></span><span id="1556" class="l"><a href="#1556"> 1556: </a><span class="php-comment">         * @var true when we are on TOC (Table Of Content) page
</span></span><span id="1557" class="l"><a href="#1557"> 1557: </a><span class="php-comment">         * @access protected
</span></span><span id="1558" class="l"><a href="#1558"> 1558: </a><span class="php-comment">         */</span>
</span><span id="1559" class="l"><a href="#1559"> 1559: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$tocpage</span> = <span class="php-keyword1">false</span>;
</span><span id="1560" class="l"><a href="#1560"> 1560: </a>
</span><span id="1561" class="l"><a href="#1561"> 1561: </a>        <span class="php-comment">/**
</span></span><span id="1562" class="l"><a href="#1562"> 1562: </a><span class="php-comment">         * @var If true convert vector images (SVG, EPS) to raster image using GD or ImageMagick library.
</span></span><span id="1563" class="l"><a href="#1563"> 1563: </a><span class="php-comment">         * @access protected
</span></span><span id="1564" class="l"><a href="#1564"> 1564: </a><span class="php-comment">         * @since 5.0.000 (2010-04-26)
</span></span><span id="1565" class="l"><a href="#1565"> 1565: </a><span class="php-comment">         */</span>
</span><span id="1566" class="l"><a href="#1566"> 1566: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$rasterize_vector_images</span> = <span class="php-keyword1">false</span>;
</span><span id="1567" class="l"><a href="#1567"> 1567: </a>
</span><span id="1568" class="l"><a href="#1568"> 1568: </a>        <span class="php-comment">/**
</span></span><span id="1569" class="l"><a href="#1569"> 1569: </a><span class="php-comment">         * @var directory used for the last SVG image
</span></span><span id="1570" class="l"><a href="#1570"> 1570: </a><span class="php-comment">         * @access protected
</span></span><span id="1571" class="l"><a href="#1571"> 1571: </a><span class="php-comment">         * @since 5.0.000 (2010-05-05)
</span></span><span id="1572" class="l"><a href="#1572"> 1572: </a><span class="php-comment">         */</span>
</span><span id="1573" class="l"><a href="#1573"> 1573: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgdir</span> = <span class="php-quote">''</span>;
</span><span id="1574" class="l"><a href="#1574"> 1574: </a>
</span><span id="1575" class="l"><a href="#1575"> 1575: </a>        <span class="php-comment">/**
</span></span><span id="1576" class="l"><a href="#1576"> 1576: </a><span class="php-comment">         * @var Deafult unit of measure for SVG
</span></span><span id="1577" class="l"><a href="#1577"> 1577: </a><span class="php-comment">         * @access protected
</span></span><span id="1578" class="l"><a href="#1578"> 1578: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1579" class="l"><a href="#1579"> 1579: </a><span class="php-comment">         */</span>
</span><span id="1580" class="l"><a href="#1580"> 1580: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgunit</span> = <span class="php-quote">'px'</span>;
</span><span id="1581" class="l"><a href="#1581"> 1581: </a>
</span><span id="1582" class="l"><a href="#1582"> 1582: </a>        <span class="php-comment">/**
</span></span><span id="1583" class="l"><a href="#1583"> 1583: </a><span class="php-comment">         * @var array of SVG gradients
</span></span><span id="1584" class="l"><a href="#1584"> 1584: </a><span class="php-comment">         * @access protected
</span></span><span id="1585" class="l"><a href="#1585"> 1585: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1586" class="l"><a href="#1586"> 1586: </a><span class="php-comment">         */</span>
</span><span id="1587" class="l"><a href="#1587"> 1587: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svggradients</span> = <span class="php-keyword1">array</span>();
</span><span id="1588" class="l"><a href="#1588"> 1588: </a>
</span><span id="1589" class="l"><a href="#1589"> 1589: </a>        <span class="php-comment">/**
</span></span><span id="1590" class="l"><a href="#1590"> 1590: </a><span class="php-comment">         * @var ID of last SVG gradient
</span></span><span id="1591" class="l"><a href="#1591"> 1591: </a><span class="php-comment">         * @access protected
</span></span><span id="1592" class="l"><a href="#1592"> 1592: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1593" class="l"><a href="#1593"> 1593: </a><span class="php-comment">         */</span>
</span><span id="1594" class="l"><a href="#1594"> 1594: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svggradientid</span> = <span class="php-num">0</span>;
</span><span id="1595" class="l"><a href="#1595"> 1595: </a>
</span><span id="1596" class="l"><a href="#1596"> 1596: </a>        <span class="php-comment">/**
</span></span><span id="1597" class="l"><a href="#1597"> 1597: </a><span class="php-comment">         * @var true when in SVG defs group
</span></span><span id="1598" class="l"><a href="#1598"> 1598: </a><span class="php-comment">         * @access protected
</span></span><span id="1599" class="l"><a href="#1599"> 1599: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1600" class="l"><a href="#1600"> 1600: </a><span class="php-comment">         */</span>
</span><span id="1601" class="l"><a href="#1601"> 1601: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgdefsmode</span> = <span class="php-keyword1">false</span>;
</span><span id="1602" class="l"><a href="#1602"> 1602: </a>
</span><span id="1603" class="l"><a href="#1603"> 1603: </a>        <span class="php-comment">/**
</span></span><span id="1604" class="l"><a href="#1604"> 1604: </a><span class="php-comment">         * @var array of SVG defs
</span></span><span id="1605" class="l"><a href="#1605"> 1605: </a><span class="php-comment">         * @access protected
</span></span><span id="1606" class="l"><a href="#1606"> 1606: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1607" class="l"><a href="#1607"> 1607: </a><span class="php-comment">         */</span>
</span><span id="1608" class="l"><a href="#1608"> 1608: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgdefs</span> = <span class="php-keyword1">array</span>();
</span><span id="1609" class="l"><a href="#1609"> 1609: </a>
</span><span id="1610" class="l"><a href="#1610"> 1610: </a>        <span class="php-comment">/**
</span></span><span id="1611" class="l"><a href="#1611"> 1611: </a><span class="php-comment">         * @var true when in SVG clipPath tag
</span></span><span id="1612" class="l"><a href="#1612"> 1612: </a><span class="php-comment">         * @access protected
</span></span><span id="1613" class="l"><a href="#1613"> 1613: </a><span class="php-comment">         * @since 5.0.000 (2010-04-26)
</span></span><span id="1614" class="l"><a href="#1614"> 1614: </a><span class="php-comment">         */</span>
</span><span id="1615" class="l"><a href="#1615"> 1615: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgclipmode</span> = <span class="php-keyword1">false</span>;
</span><span id="1616" class="l"><a href="#1616"> 1616: </a>
</span><span id="1617" class="l"><a href="#1617"> 1617: </a>        <span class="php-comment">/**
</span></span><span id="1618" class="l"><a href="#1618"> 1618: </a><span class="php-comment">         * @var array of SVG clipPath commands
</span></span><span id="1619" class="l"><a href="#1619"> 1619: </a><span class="php-comment">         * @access protected
</span></span><span id="1620" class="l"><a href="#1620"> 1620: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1621" class="l"><a href="#1621"> 1621: </a><span class="php-comment">         */</span>
</span><span id="1622" class="l"><a href="#1622"> 1622: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgclippaths</span> = <span class="php-keyword1">array</span>();
</span><span id="1623" class="l"><a href="#1623"> 1623: </a>
</span><span id="1624" class="l"><a href="#1624"> 1624: </a>        <span class="php-comment">/**
</span></span><span id="1625" class="l"><a href="#1625"> 1625: </a><span class="php-comment">         * @var ID of last SVG clipPath
</span></span><span id="1626" class="l"><a href="#1626"> 1626: </a><span class="php-comment">         * @access protected
</span></span><span id="1627" class="l"><a href="#1627"> 1627: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1628" class="l"><a href="#1628"> 1628: </a><span class="php-comment">         */</span>
</span><span id="1629" class="l"><a href="#1629"> 1629: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgclipid</span> = <span class="php-num">0</span>;
</span><span id="1630" class="l"><a href="#1630"> 1630: </a>
</span><span id="1631" class="l"><a href="#1631"> 1631: </a>        <span class="php-comment">/**
</span></span><span id="1632" class="l"><a href="#1632"> 1632: </a><span class="php-comment">         * @var svg text
</span></span><span id="1633" class="l"><a href="#1633"> 1633: </a><span class="php-comment">         * @access protected
</span></span><span id="1634" class="l"><a href="#1634"> 1634: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1635" class="l"><a href="#1635"> 1635: </a><span class="php-comment">         */</span>
</span><span id="1636" class="l"><a href="#1636"> 1636: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgtext</span> = <span class="php-quote">''</span>;
</span><span id="1637" class="l"><a href="#1637"> 1637: </a>
</span><span id="1638" class="l"><a href="#1638"> 1638: </a>        <span class="php-comment">/**
</span></span><span id="1639" class="l"><a href="#1639"> 1639: </a><span class="php-comment">         * @var array of hinheritable SVG properties
</span></span><span id="1640" class="l"><a href="#1640"> 1640: </a><span class="php-comment">         * @access protected
</span></span><span id="1641" class="l"><a href="#1641"> 1641: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1642" class="l"><a href="#1642"> 1642: </a><span class="php-comment">         */</span>
</span><span id="1643" class="l"><a href="#1643"> 1643: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svginheritprop</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'clip-rule'</span>, <span class="php-quote">'color'</span>, <span class="php-quote">'color-interpolation'</span>, <span class="php-quote">'color-interpolation-filters'</span>, <span class="php-quote">'color-profile'</span>, <span class="php-quote">'color-rendering'</span>, <span class="php-quote">'cursor'</span>, <span class="php-quote">'direction'</span>, <span class="php-quote">'fill'</span>, <span class="php-quote">'fill-opacity'</span>, <span class="php-quote">'fill-rule'</span>, <span class="php-quote">'font'</span>, <span class="php-quote">'font-family'</span>, <span class="php-quote">'font-size'</span>, <span class="php-quote">'font-size-adjust'</span>, <span class="php-quote">'font-stretch'</span>, <span class="php-quote">'font-style'</span>, <span class="php-quote">'font-variant'</span>, <span class="php-quote">'font-weight'</span>, <span class="php-quote">'glyph-orientation-horizontal'</span>, <span class="php-quote">'glyph-orientation-vertical'</span>, <span class="php-quote">'image-rendering'</span>, <span class="php-quote">'kerning'</span>, <span class="php-quote">'letter-spacing'</span>, <span class="php-quote">'marker'</span>, <span class="php-quote">'marker-end'</span>, <span class="php-quote">'marker-mid'</span>, <span class="php-quote">'marker-start'</span>, <span class="php-quote">'pointer-events'</span>, <span class="php-quote">'shape-rendering'</span>, <span class="php-quote">'stroke'</span>, <span class="php-quote">'stroke-dasharray'</span>, <span class="php-quote">'stroke-dashoffset'</span>, <span class="php-quote">'stroke-linecap'</span>, <span class="php-quote">'stroke-linejoin'</span>, <span class="php-quote">'stroke-miterlimit'</span>, <span class="php-quote">'stroke-opacity'</span>, <span class="php-quote">'stroke-width'</span>, <span class="php-quote">'text-anchor'</span>, <span class="php-quote">'text-rendering'</span>, <span class="php-quote">'visibility'</span>, <span class="php-quote">'word-spacing'</span>, <span class="php-quote">'writing-mode'</span>);
</span><span id="1644" class="l"><a href="#1644"> 1644: </a>
</span><span id="1645" class="l"><a href="#1645"> 1645: </a>        <span class="php-comment">/**
</span></span><span id="1646" class="l"><a href="#1646"> 1646: </a><span class="php-comment">         * @var array of SVG properties
</span></span><span id="1647" class="l"><a href="#1647"> 1647: </a><span class="php-comment">         * @access protected
</span></span><span id="1648" class="l"><a href="#1648"> 1648: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="1649" class="l"><a href="#1649"> 1649: </a><span class="php-comment">         */</span>
</span><span id="1650" class="l"><a href="#1650"> 1650: </a>        <span class="php-keyword1">protected</span> <span class="php-var">$svgstyles</span> = <span class="php-keyword1">array</span>(<span class="php-keyword1">array</span>(
</span><span id="1651" class="l"><a href="#1651"> 1651: </a>            <span class="php-quote">'alignment-baseline'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1652" class="l"><a href="#1652"> 1652: </a>            <span class="php-quote">'baseline-shift'</span> =&gt; <span class="php-quote">'baseline'</span>,
</span><span id="1653" class="l"><a href="#1653"> 1653: </a>            <span class="php-quote">'clip'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1654" class="l"><a href="#1654"> 1654: </a>            <span class="php-quote">'clip-path'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1655" class="l"><a href="#1655"> 1655: </a>            <span class="php-quote">'clip-rule'</span> =&gt; <span class="php-quote">'nonzero'</span>,
</span><span id="1656" class="l"><a href="#1656"> 1656: </a>            <span class="php-quote">'color'</span> =&gt; <span class="php-quote">'black'</span>,
</span><span id="1657" class="l"><a href="#1657"> 1657: </a>            <span class="php-quote">'color-interpolation'</span> =&gt; <span class="php-quote">'sRGB'</span>,
</span><span id="1658" class="l"><a href="#1658"> 1658: </a>            <span class="php-quote">'color-interpolation-filters'</span> =&gt; <span class="php-quote">'linearRGB'</span>,
</span><span id="1659" class="l"><a href="#1659"> 1659: </a>            <span class="php-quote">'color-profile'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1660" class="l"><a href="#1660"> 1660: </a>            <span class="php-quote">'color-rendering'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1661" class="l"><a href="#1661"> 1661: </a>            <span class="php-quote">'cursor'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1662" class="l"><a href="#1662"> 1662: </a>            <span class="php-quote">'direction'</span> =&gt; <span class="php-quote">'ltr'</span>,
</span><span id="1663" class="l"><a href="#1663"> 1663: </a>            <span class="php-quote">'display'</span> =&gt; <span class="php-quote">'inline'</span>,
</span><span id="1664" class="l"><a href="#1664"> 1664: </a>            <span class="php-quote">'dominant-baseline'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1665" class="l"><a href="#1665"> 1665: </a>            <span class="php-quote">'enable-background'</span> =&gt; <span class="php-quote">'accumulate'</span>,
</span><span id="1666" class="l"><a href="#1666"> 1666: </a>            <span class="php-quote">'fill'</span> =&gt; <span class="php-quote">'black'</span>,
</span><span id="1667" class="l"><a href="#1667"> 1667: </a>            <span class="php-quote">'fill-opacity'</span> =&gt; <span class="php-num">1</span>,
</span><span id="1668" class="l"><a href="#1668"> 1668: </a>            <span class="php-quote">'fill-rule'</span> =&gt; <span class="php-quote">'nonzero'</span>,
</span><span id="1669" class="l"><a href="#1669"> 1669: </a>            <span class="php-quote">'filter'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1670" class="l"><a href="#1670"> 1670: </a>            <span class="php-quote">'flood-color'</span> =&gt; <span class="php-quote">'black'</span>,
</span><span id="1671" class="l"><a href="#1671"> 1671: </a>            <span class="php-quote">'flood-opacity'</span> =&gt; <span class="php-num">1</span>,
</span><span id="1672" class="l"><a href="#1672"> 1672: </a>            <span class="php-quote">'font'</span> =&gt; <span class="php-quote">''</span>,
</span><span id="1673" class="l"><a href="#1673"> 1673: </a>            <span class="php-quote">'font-family'</span> =&gt; <span class="php-quote">'helvetica'</span>,
</span><span id="1674" class="l"><a href="#1674"> 1674: </a>            <span class="php-quote">'font-size'</span> =&gt; <span class="php-quote">'medium'</span>,
</span><span id="1675" class="l"><a href="#1675"> 1675: </a>            <span class="php-quote">'font-size-adjust'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1676" class="l"><a href="#1676"> 1676: </a>            <span class="php-quote">'font-stretch'</span> =&gt; <span class="php-quote">'normal'</span>,
</span><span id="1677" class="l"><a href="#1677"> 1677: </a>            <span class="php-quote">'font-style'</span> =&gt; <span class="php-quote">'normal'</span>,
</span><span id="1678" class="l"><a href="#1678"> 1678: </a>            <span class="php-quote">'font-variant'</span> =&gt; <span class="php-quote">'normal'</span>,
</span><span id="1679" class="l"><a href="#1679"> 1679: </a>            <span class="php-quote">'font-weight'</span> =&gt; <span class="php-quote">'normal'</span>,
</span><span id="1680" class="l"><a href="#1680"> 1680: </a>            <span class="php-quote">'glyph-orientation-horizontal'</span> =&gt; <span class="php-quote">'0deg'</span>,
</span><span id="1681" class="l"><a href="#1681"> 1681: </a>            <span class="php-quote">'glyph-orientation-vertical'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1682" class="l"><a href="#1682"> 1682: </a>            <span class="php-quote">'image-rendering'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1683" class="l"><a href="#1683"> 1683: </a>            <span class="php-quote">'kerning'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1684" class="l"><a href="#1684"> 1684: </a>            <span class="php-quote">'letter-spacing'</span> =&gt; <span class="php-quote">'normal'</span>,
</span><span id="1685" class="l"><a href="#1685"> 1685: </a>            <span class="php-quote">'lighting-color'</span> =&gt; <span class="php-quote">'white'</span>,
</span><span id="1686" class="l"><a href="#1686"> 1686: </a>            <span class="php-quote">'marker'</span> =&gt; <span class="php-quote">''</span>,
</span><span id="1687" class="l"><a href="#1687"> 1687: </a>            <span class="php-quote">'marker-end'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1688" class="l"><a href="#1688"> 1688: </a>            <span class="php-quote">'marker-mid'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1689" class="l"><a href="#1689"> 1689: </a>            <span class="php-quote">'marker-start'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1690" class="l"><a href="#1690"> 1690: </a>            <span class="php-quote">'mask'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1691" class="l"><a href="#1691"> 1691: </a>            <span class="php-quote">'opacity'</span> =&gt; <span class="php-num">1</span>,
</span><span id="1692" class="l"><a href="#1692"> 1692: </a>            <span class="php-quote">'overflow'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1693" class="l"><a href="#1693"> 1693: </a>            <span class="php-quote">'pointer-events'</span> =&gt; <span class="php-quote">'visiblePainted'</span>,
</span><span id="1694" class="l"><a href="#1694"> 1694: </a>            <span class="php-quote">'shape-rendering'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1695" class="l"><a href="#1695"> 1695: </a>            <span class="php-quote">'stop-color'</span> =&gt; <span class="php-quote">'black'</span>,
</span><span id="1696" class="l"><a href="#1696"> 1696: </a>            <span class="php-quote">'stop-opacity'</span> =&gt; <span class="php-num">1</span>,
</span><span id="1697" class="l"><a href="#1697"> 1697: </a>            <span class="php-quote">'stroke'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1698" class="l"><a href="#1698"> 1698: </a>            <span class="php-quote">'stroke-dasharray'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1699" class="l"><a href="#1699"> 1699: </a>            <span class="php-quote">'stroke-dashoffset'</span> =&gt; <span class="php-num">0</span>,
</span><span id="1700" class="l"><a href="#1700"> 1700: </a>            <span class="php-quote">'stroke-linecap'</span> =&gt; <span class="php-quote">'butt'</span>,
</span><span id="1701" class="l"><a href="#1701"> 1701: </a>            <span class="php-quote">'stroke-linejoin'</span> =&gt; <span class="php-quote">'miter'</span>,
</span><span id="1702" class="l"><a href="#1702"> 1702: </a>            <span class="php-quote">'stroke-miterlimit'</span> =&gt; <span class="php-num">4</span>,
</span><span id="1703" class="l"><a href="#1703"> 1703: </a>            <span class="php-quote">'stroke-opacity'</span> =&gt; <span class="php-num">1</span>,
</span><span id="1704" class="l"><a href="#1704"> 1704: </a>            <span class="php-quote">'stroke-width'</span> =&gt; <span class="php-num">1</span>,
</span><span id="1705" class="l"><a href="#1705"> 1705: </a>            <span class="php-quote">'text-anchor'</span> =&gt; <span class="php-quote">'start'</span>,
</span><span id="1706" class="l"><a href="#1706"> 1706: </a>            <span class="php-quote">'text-decoration'</span> =&gt; <span class="php-quote">'none'</span>,
</span><span id="1707" class="l"><a href="#1707"> 1707: </a>            <span class="php-quote">'text-rendering'</span> =&gt; <span class="php-quote">'auto'</span>,
</span><span id="1708" class="l"><a href="#1708"> 1708: </a>            <span class="php-quote">'unicode-bidi'</span> =&gt; <span class="php-quote">'normal'</span>,
</span><span id="1709" class="l"><a href="#1709"> 1709: </a>            <span class="php-quote">'visibility'</span> =&gt; <span class="php-quote">'visible'</span>,
</span><span id="1710" class="l"><a href="#1710"> 1710: </a>            <span class="php-quote">'word-spacing'</span> =&gt; <span class="php-quote">'normal'</span>,
</span><span id="1711" class="l"><a href="#1711"> 1711: </a>            <span class="php-quote">'writing-mode'</span> =&gt; <span class="php-quote">'lr-tb'</span>,
</span><span id="1712" class="l"><a href="#1712"> 1712: </a>            <span class="php-quote">'text-color'</span> =&gt; <span class="php-quote">'black'</span>,
</span><span id="1713" class="l"><a href="#1713"> 1713: </a>            <span class="php-quote">'transfmatrix'</span> =&gt; <span class="php-keyword1">array</span>(<span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>)
</span><span id="1714" class="l"><a href="#1714"> 1714: </a>            ));
</span><span id="1715" class="l"><a href="#1715"> 1715: </a>
</span><span id="1716" class="l"><a href="#1716"> 1716: </a>        <span class="php-comment">//------------------------------------------------------------</span>
</span><span id="1717" class="l"><a href="#1717"> 1717: </a>        <span class="php-comment">// METHODS</span>
</span><span id="1718" class="l"><a href="#1718"> 1718: </a>        <span class="php-comment">//------------------------------------------------------------</span>
</span><span id="1719" class="l"><a href="#1719"> 1719: </a>
</span><span id="1720" class="l"><a href="#1720"> 1720: </a>        <span class="php-comment">/**
</span></span><span id="1721" class="l"><a href="#1721"> 1721: </a><span class="php-comment">         * This is the class constructor.
</span></span><span id="1722" class="l"><a href="#1722"> 1722: </a><span class="php-comment">         * It allows to set up the page format, the orientation and
</span></span><span id="1723" class="l"><a href="#1723"> 1723: </a><span class="php-comment">         * the measure unit used in all the methods (except for the font sizes).
</span></span><span id="1724" class="l"><a href="#1724"> 1724: </a><span class="php-comment">         * @since 1.0
</span></span><span id="1725" class="l"><a href="#1725"> 1725: </a><span class="php-comment">         * @param string $orientation page orientation. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;P or Portrait (default)&lt;/li&gt;&lt;li&gt;L or Landscape&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="1726" class="l"><a href="#1726"> 1726: </a><span class="php-comment">         * @param string $unit User measure unit. Possible values are:&lt;ul&gt;&lt;li&gt;pt: point&lt;/li&gt;&lt;li&gt;mm: millimeter (default)&lt;/li&gt;&lt;li&gt;cm: centimeter&lt;/li&gt;&lt;li&gt;in: inch&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;A point equals 1/72 of inch, that is to say about 0.35 mm (an inch being 2.54 cm). This is a very common unit in typography; font sizes are expressed in that unit.
</span></span><span id="1727" class="l"><a href="#1727"> 1727: </a><span class="php-comment">         * @param mixed $format The format used for pages. It can be either one of the following values (case insensitive) or a custom format in the form of a two-element array containing the width and the height (expressed in the unit given by unit).&lt;ul&gt;&lt;li&gt;4A0&lt;/li&gt;&lt;li&gt;2A0&lt;/li&gt;&lt;li&gt;A0&lt;/li&gt;&lt;li&gt;A1&lt;/li&gt;&lt;li&gt;A2&lt;/li&gt;&lt;li&gt;A3&lt;/li&gt;&lt;li&gt;A4 (default)&lt;/li&gt;&lt;li&gt;A5&lt;/li&gt;&lt;li&gt;A6&lt;/li&gt;&lt;li&gt;A7&lt;/li&gt;&lt;li&gt;A8&lt;/li&gt;&lt;li&gt;A9&lt;/li&gt;&lt;li&gt;A10&lt;/li&gt;&lt;li&gt;B0&lt;/li&gt;&lt;li&gt;B1&lt;/li&gt;&lt;li&gt;B2&lt;/li&gt;&lt;li&gt;B3&lt;/li&gt;&lt;li&gt;B4&lt;/li&gt;&lt;li&gt;B5&lt;/li&gt;&lt;li&gt;B6&lt;/li&gt;&lt;li&gt;B7&lt;/li&gt;&lt;li&gt;B8&lt;/li&gt;&lt;li&gt;B9&lt;/li&gt;&lt;li&gt;B10&lt;/li&gt;&lt;li&gt;C0&lt;/li&gt;&lt;li&gt;C1&lt;/li&gt;&lt;li&gt;C2&lt;/li&gt;&lt;li&gt;C3&lt;/li&gt;&lt;li&gt;C4&lt;/li&gt;&lt;li&gt;C5&lt;/li&gt;&lt;li&gt;C6&lt;/li&gt;&lt;li&gt;C7&lt;/li&gt;&lt;li&gt;C8&lt;/li&gt;&lt;li&gt;C9&lt;/li&gt;&lt;li&gt;C10&lt;/li&gt;&lt;li&gt;RA0&lt;/li&gt;&lt;li&gt;RA1&lt;/li&gt;&lt;li&gt;RA2&lt;/li&gt;&lt;li&gt;RA3&lt;/li&gt;&lt;li&gt;RA4&lt;/li&gt;&lt;li&gt;SRA0&lt;/li&gt;&lt;li&gt;SRA1&lt;/li&gt;&lt;li&gt;SRA2&lt;/li&gt;&lt;li&gt;SRA3&lt;/li&gt;&lt;li&gt;SRA4&lt;/li&gt;&lt;li&gt;LETTER&lt;/li&gt;&lt;li&gt;LEGAL&lt;/li&gt;&lt;li&gt;EXECUTIVE&lt;/li&gt;&lt;li&gt;FOLIO&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="1728" class="l"><a href="#1728"> 1728: </a><span class="php-comment">         * @param boolean $unicode TRUE means that the input text is unicode (default = true)
</span></span><span id="1729" class="l"><a href="#1729"> 1729: </a><span class="php-comment">         * @param boolean $diskcache if TRUE reduce the RAM memory usage by caching temporary data on filesystem (slower).
</span></span><span id="1730" class="l"><a href="#1730"> 1730: </a><span class="php-comment">         * @param String $encoding charset encoding; default is UTF-8
</span></span><span id="1731" class="l"><a href="#1731"> 1731: </a><span class="php-comment">         * @access public
</span></span><span id="1732" class="l"><a href="#1732"> 1732: </a><span class="php-comment">         */</span>
</span><span id="1733" class="l"><a href="#1733"> 1733: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __construct(<span class="php-var">$orientation</span>=<span class="php-quote">'P'</span>, <span class="php-var">$unit</span>=<span class="php-quote">'mm'</span>, <span class="php-var">$format</span>=<span class="php-quote">'A4'</span>, <span class="php-var">$unicode</span>=<span class="php-keyword1">true</span>, <span class="php-var">$encoding</span>=<span class="php-quote">'UTF-8'</span>, <span class="php-var">$diskcache</span>=<span class="php-keyword1">false</span>) {
</span><span id="1734" class="l"><a href="#1734"> 1734: </a>            <span class="php-comment">/* Set internal character encoding to ASCII */</span>
</span><span id="1735" class="l"><a href="#1735"> 1735: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">function_exists</span>(<span class="php-quote">'mb_internal_encoding'</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">mb_internal_encoding</span>()) {
</span><span id="1736" class="l"><a href="#1736"> 1736: </a>                <span class="php-var">$this</span>-&gt;internal_encoding = <span class="php-keyword2">mb_internal_encoding</span>();
</span><span id="1737" class="l"><a href="#1737"> 1737: </a>                <span class="php-keyword2">mb_internal_encoding</span>(<span class="php-quote">'ASCII'</span>);
</span><span id="1738" class="l"><a href="#1738"> 1738: </a>            }
</span><span id="1739" class="l"><a href="#1739"> 1739: </a>            <span class="php-comment">// set disk caching</span>
</span><span id="1740" class="l"><a href="#1740"> 1740: </a>            <span class="php-var">$this</span>-&gt;diskcache = <span class="php-var">$diskcache</span> ? <span class="php-keyword1">true</span> : <span class="php-keyword1">false</span>;
</span><span id="1741" class="l"><a href="#1741"> 1741: </a>            <span class="php-comment">// set language direction</span>
</span><span id="1742" class="l"><a href="#1742"> 1742: </a>            <span class="php-var">$this</span>-&gt;rtl = <span class="php-keyword1">false</span>;
</span><span id="1743" class="l"><a href="#1743"> 1743: </a>            <span class="php-var">$this</span>-&gt;tmprtl = <span class="php-keyword1">false</span>;
</span><span id="1744" class="l"><a href="#1744"> 1744: </a>            <span class="php-comment">//Some checks</span>
</span><span id="1745" class="l"><a href="#1745"> 1745: </a>            <span class="php-var">$this</span>-&gt;_dochecks();
</span><span id="1746" class="l"><a href="#1746"> 1746: </a>            <span class="php-comment">//Initialization of properties</span>
</span><span id="1747" class="l"><a href="#1747"> 1747: </a>            <span class="php-var">$this</span>-&gt;isunicode = <span class="php-var">$unicode</span>;
</span><span id="1748" class="l"><a href="#1748"> 1748: </a>            <span class="php-var">$this</span>-&gt;page = <span class="php-num">0</span>;
</span><span id="1749" class="l"><a href="#1749"> 1749: </a>            <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-num">0</span>] = <span class="php-keyword1">array</span>();
</span><span id="1750" class="l"><a href="#1750"> 1750: </a>            <span class="php-var">$this</span>-&gt;pagedim = <span class="php-keyword1">array</span>();
</span><span id="1751" class="l"><a href="#1751"> 1751: </a>            <span class="php-var">$this</span>-&gt;n = <span class="php-num">2</span>;
</span><span id="1752" class="l"><a href="#1752"> 1752: </a>            <span class="php-var">$this</span>-&gt;buffer = <span class="php-quote">''</span>;
</span><span id="1753" class="l"><a href="#1753"> 1753: </a>            <span class="php-var">$this</span>-&gt;pages = <span class="php-keyword1">array</span>();
</span><span id="1754" class="l"><a href="#1754"> 1754: </a>            <span class="php-var">$this</span>-&gt;state = <span class="php-num">0</span>;
</span><span id="1755" class="l"><a href="#1755"> 1755: </a>            <span class="php-var">$this</span>-&gt;fonts = <span class="php-keyword1">array</span>();
</span><span id="1756" class="l"><a href="#1756"> 1756: </a>            <span class="php-var">$this</span>-&gt;FontFiles = <span class="php-keyword1">array</span>();
</span><span id="1757" class="l"><a href="#1757"> 1757: </a>            <span class="php-var">$this</span>-&gt;diffs = <span class="php-keyword1">array</span>();
</span><span id="1758" class="l"><a href="#1758"> 1758: </a>            <span class="php-var">$this</span>-&gt;images = <span class="php-keyword1">array</span>();
</span><span id="1759" class="l"><a href="#1759"> 1759: </a>            <span class="php-var">$this</span>-&gt;links = <span class="php-keyword1">array</span>();
</span><span id="1760" class="l"><a href="#1760"> 1760: </a>            <span class="php-var">$this</span>-&gt;gradients = <span class="php-keyword1">array</span>();
</span><span id="1761" class="l"><a href="#1761"> 1761: </a>            <span class="php-var">$this</span>-&gt;InFooter = <span class="php-keyword1">false</span>;
</span><span id="1762" class="l"><a href="#1762"> 1762: </a>            <span class="php-var">$this</span>-&gt;lasth = <span class="php-num">0</span>;
</span><span id="1763" class="l"><a href="#1763"> 1763: </a>            <span class="php-var">$this</span>-&gt;FontFamily = <span class="php-quote">'helvetica'</span>;
</span><span id="1764" class="l"><a href="#1764"> 1764: </a>            <span class="php-var">$this</span>-&gt;FontStyle = <span class="php-quote">''</span>;
</span><span id="1765" class="l"><a href="#1765"> 1765: </a>            <span class="php-var">$this</span>-&gt;FontSizePt = <span class="php-num">12</span>;
</span><span id="1766" class="l"><a href="#1766"> 1766: </a>            <span class="php-var">$this</span>-&gt;underline = <span class="php-keyword1">false</span>;
</span><span id="1767" class="l"><a href="#1767"> 1767: </a>            <span class="php-var">$this</span>-&gt;overline = <span class="php-keyword1">false</span>;
</span><span id="1768" class="l"><a href="#1768"> 1768: </a>            <span class="php-var">$this</span>-&gt;linethrough = <span class="php-keyword1">false</span>;
</span><span id="1769" class="l"><a href="#1769"> 1769: </a>            <span class="php-var">$this</span>-&gt;DrawColor = <span class="php-quote">'0 G'</span>;
</span><span id="1770" class="l"><a href="#1770"> 1770: </a>            <span class="php-var">$this</span>-&gt;FillColor = <span class="php-quote">'0 g'</span>;
</span><span id="1771" class="l"><a href="#1771"> 1771: </a>            <span class="php-var">$this</span>-&gt;TextColor = <span class="php-quote">'0 g'</span>;
</span><span id="1772" class="l"><a href="#1772"> 1772: </a>            <span class="php-var">$this</span>-&gt;ColorFlag = <span class="php-keyword1">false</span>;
</span><span id="1773" class="l"><a href="#1773"> 1773: </a>            <span class="php-comment">// encryption values</span>
</span><span id="1774" class="l"><a href="#1774"> 1774: </a>            <span class="php-var">$this</span>-&gt;encrypted = <span class="php-keyword1">false</span>;
</span><span id="1775" class="l"><a href="#1775"> 1775: </a>            <span class="php-var">$this</span>-&gt;last_rc4_key = <span class="php-quote">''</span>;
</span><span id="1776" class="l"><a href="#1776"> 1776: </a>            <span class="php-var">$this</span>-&gt;padding = <span class="php-quote">&quot;\x28\xBF\x4E\x5E\x4E\x75\x8A\x41\x64\x00\x4E\x56\xFF\xFA\x01\x08\x2E\x2E\x00\xB6\xD0\x68\x3E\x80\x2F\x0C\xA9\xFE\x64\x53\x69\x7A&quot;</span>;
</span><span id="1777" class="l"><a href="#1777"> 1777: </a>            <span class="php-comment">//Standard Unicode fonts</span>
</span><span id="1778" class="l"><a href="#1778"> 1778: </a>            <span class="php-var">$this</span>-&gt;CoreFonts = <span class="php-keyword1">array</span>(
</span><span id="1779" class="l"><a href="#1779"> 1779: </a>                <span class="php-quote">'courier'</span>=&gt;<span class="php-quote">'Courier'</span>,
</span><span id="1780" class="l"><a href="#1780"> 1780: </a>                <span class="php-quote">'courierB'</span>=&gt;<span class="php-quote">'Courier-Bold'</span>,
</span><span id="1781" class="l"><a href="#1781"> 1781: </a>                <span class="php-quote">'courierI'</span>=&gt;<span class="php-quote">'Courier-Oblique'</span>,
</span><span id="1782" class="l"><a href="#1782"> 1782: </a>                <span class="php-quote">'courierBI'</span>=&gt;<span class="php-quote">'Courier-BoldOblique'</span>,
</span><span id="1783" class="l"><a href="#1783"> 1783: </a>                <span class="php-quote">'helvetica'</span>=&gt;<span class="php-quote">'Helvetica'</span>,
</span><span id="1784" class="l"><a href="#1784"> 1784: </a>                <span class="php-quote">'helveticaB'</span>=&gt;<span class="php-quote">'Helvetica-Bold'</span>,
</span><span id="1785" class="l"><a href="#1785"> 1785: </a>                <span class="php-quote">'helveticaI'</span>=&gt;<span class="php-quote">'Helvetica-Oblique'</span>,
</span><span id="1786" class="l"><a href="#1786"> 1786: </a>                <span class="php-quote">'helveticaBI'</span>=&gt;<span class="php-quote">'Helvetica-BoldOblique'</span>,
</span><span id="1787" class="l"><a href="#1787"> 1787: </a>                <span class="php-quote">'times'</span>=&gt;<span class="php-quote">'Times-Roman'</span>,
</span><span id="1788" class="l"><a href="#1788"> 1788: </a>                <span class="php-quote">'timesB'</span>=&gt;<span class="php-quote">'Times-Bold'</span>,
</span><span id="1789" class="l"><a href="#1789"> 1789: </a>                <span class="php-quote">'timesI'</span>=&gt;<span class="php-quote">'Times-Italic'</span>,
</span><span id="1790" class="l"><a href="#1790"> 1790: </a>                <span class="php-quote">'timesBI'</span>=&gt;<span class="php-quote">'Times-BoldItalic'</span>,
</span><span id="1791" class="l"><a href="#1791"> 1791: </a>                <span class="php-quote">'symbol'</span>=&gt;<span class="php-quote">'Symbol'</span>,
</span><span id="1792" class="l"><a href="#1792"> 1792: </a>                <span class="php-quote">'zapfdingbats'</span>=&gt;<span class="php-quote">'ZapfDingbats'</span>
</span><span id="1793" class="l"><a href="#1793"> 1793: </a>            );
</span><span id="1794" class="l"><a href="#1794"> 1794: </a>            <span class="php-comment">//Set scale factor</span>
</span><span id="1795" class="l"><a href="#1795"> 1795: </a>            <span class="php-var">$this</span>-&gt;setPageUnit(<span class="php-var">$unit</span>);
</span><span id="1796" class="l"><a href="#1796"> 1796: </a>            <span class="php-comment">// set page format and orientation</span>
</span><span id="1797" class="l"><a href="#1797"> 1797: </a>            <span class="php-var">$this</span>-&gt;setPageFormat(<span class="php-var">$format</span>, <span class="php-var">$orientation</span>);
</span><span id="1798" class="l"><a href="#1798"> 1798: </a>            <span class="php-comment">//Page margins (1 cm)</span>
</span><span id="1799" class="l"><a href="#1799"> 1799: </a>            <span class="php-var">$margin</span> = <span class="php-num">28.35</span> / <span class="php-var">$this</span>-&gt;k;
</span><span id="1800" class="l"><a href="#1800"> 1800: </a>            <span class="php-var">$this</span>-&gt;SetMargins(<span class="php-var">$margin</span>, <span class="php-var">$margin</span>);
</span><span id="1801" class="l"><a href="#1801"> 1801: </a>            <span class="php-comment">//Interior cell margin</span>
</span><span id="1802" class="l"><a href="#1802"> 1802: </a>            <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$margin</span> / <span class="php-num">10</span>;
</span><span id="1803" class="l"><a href="#1803"> 1803: </a>            <span class="php-comment">//Line width (0.2 mm)</span>
</span><span id="1804" class="l"><a href="#1804"> 1804: </a>            <span class="php-var">$this</span>-&gt;LineWidth = <span class="php-num">0.57</span> / <span class="php-var">$this</span>-&gt;k;
</span><span id="1805" class="l"><a href="#1805"> 1805: </a>            <span class="php-var">$this</span>-&gt;linestyleWidth = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F w'</span>, (<span class="php-var">$this</span>-&gt;LineWidth * <span class="php-var">$this</span>-&gt;k));
</span><span id="1806" class="l"><a href="#1806"> 1806: </a>            <span class="php-var">$this</span>-&gt;linestyleCap = <span class="php-quote">'0 J'</span>;
</span><span id="1807" class="l"><a href="#1807"> 1807: </a>            <span class="php-var">$this</span>-&gt;linestyleJoin = <span class="php-quote">'0 j'</span>;
</span><span id="1808" class="l"><a href="#1808"> 1808: </a>            <span class="php-var">$this</span>-&gt;linestyleDash = <span class="php-quote">'[] 0 d'</span>;
</span><span id="1809" class="l"><a href="#1809"> 1809: </a>            <span class="php-comment">//Automatic page break</span>
</span><span id="1810" class="l"><a href="#1810"> 1810: </a>            <span class="php-var">$this</span>-&gt;SetAutoPageBreak(<span class="php-keyword1">true</span>, (<span class="php-num">2</span> * <span class="php-var">$margin</span>));
</span><span id="1811" class="l"><a href="#1811"> 1811: </a>            <span class="php-comment">//Full width display mode</span>
</span><span id="1812" class="l"><a href="#1812"> 1812: </a>            <span class="php-var">$this</span>-&gt;SetDisplayMode(<span class="php-quote">'fullwidth'</span>);
</span><span id="1813" class="l"><a href="#1813"> 1813: </a>            <span class="php-comment">//Compression</span>
</span><span id="1814" class="l"><a href="#1814"> 1814: </a>            <span class="php-var">$this</span>-&gt;SetCompression(<span class="php-keyword1">true</span>);
</span><span id="1815" class="l"><a href="#1815"> 1815: </a>            <span class="php-comment">//Set default PDF version number</span>
</span><span id="1816" class="l"><a href="#1816"> 1816: </a>            <span class="php-var">$this</span>-&gt;PDFVersion = <span class="php-quote">'1.7'</span>;
</span><span id="1817" class="l"><a href="#1817"> 1817: </a>            <span class="php-var">$this</span>-&gt;encoding = <span class="php-var">$encoding</span>;
</span><span id="1818" class="l"><a href="#1818"> 1818: </a>            <span class="php-var">$this</span>-&gt;HREF = <span class="php-keyword1">array</span>();
</span><span id="1819" class="l"><a href="#1819"> 1819: </a>            <span class="php-var">$this</span>-&gt;getFontsList();
</span><span id="1820" class="l"><a href="#1820"> 1820: </a>            <span class="php-var">$this</span>-&gt;fgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'R'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'G'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'B'</span> =&gt; <span class="php-num">0</span>);
</span><span id="1821" class="l"><a href="#1821"> 1821: </a>            <span class="php-var">$this</span>-&gt;strokecolor = <span class="php-keyword1">array</span>(<span class="php-quote">'R'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'G'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'B'</span> =&gt; <span class="php-num">0</span>);
</span><span id="1822" class="l"><a href="#1822"> 1822: </a>            <span class="php-var">$this</span>-&gt;bgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'R'</span> =&gt; <span class="php-num">255</span>, <span class="php-quote">'G'</span> =&gt; <span class="php-num">255</span>, <span class="php-quote">'B'</span> =&gt; <span class="php-num">255</span>);
</span><span id="1823" class="l"><a href="#1823"> 1823: </a>            <span class="php-var">$this</span>-&gt;extgstates = <span class="php-keyword1">array</span>();
</span><span id="1824" class="l"><a href="#1824"> 1824: </a>            <span class="php-comment">// user's rights</span>
</span><span id="1825" class="l"><a href="#1825"> 1825: </a>            <span class="php-var">$this</span>-&gt;sign = <span class="php-keyword1">false</span>;
</span><span id="1826" class="l"><a href="#1826"> 1826: </a>            <span class="php-var">$this</span>-&gt;ur = <span class="php-keyword1">false</span>;
</span><span id="1827" class="l"><a href="#1827"> 1827: </a>            <span class="php-var">$this</span>-&gt;ur_document = <span class="php-quote">'/FullSave'</span>;
</span><span id="1828" class="l"><a href="#1828"> 1828: </a>            <span class="php-var">$this</span>-&gt;ur_annots = <span class="php-quote">'/Create/Delete/Modify/Copy/Import/Export'</span>;
</span><span id="1829" class="l"><a href="#1829"> 1829: </a>            <span class="php-var">$this</span>-&gt;ur_form = <span class="php-quote">'/Add/Delete/FillIn/Import/Export/SubmitStandalone/SpawnTemplate'</span>;
</span><span id="1830" class="l"><a href="#1830"> 1830: </a>            <span class="php-var">$this</span>-&gt;ur_signature = <span class="php-quote">'/Modify'</span>;
</span><span id="1831" class="l"><a href="#1831"> 1831: </a>            <span class="php-comment">// set default JPEG quality</span>
</span><span id="1832" class="l"><a href="#1832"> 1832: </a>            <span class="php-var">$this</span>-&gt;jpeg_quality = <span class="php-num">75</span>;
</span><span id="1833" class="l"><a href="#1833"> 1833: </a>            <span class="php-comment">// initialize some settings</span>
</span><span id="1834" class="l"><a href="#1834"> 1834: </a>            <span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-keyword1">array</span>(<span class="php-quote">''</span>), <span class="php-quote">''</span>);
</span><span id="1835" class="l"><a href="#1835"> 1835: </a>            <span class="php-comment">// set default font</span>
</span><span id="1836" class="l"><a href="#1836"> 1836: </a>            <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$this</span>-&gt;FontFamily, <span class="php-var">$this</span>-&gt;FontStyle, <span class="php-var">$this</span>-&gt;FontSizePt);
</span><span id="1837" class="l"><a href="#1837"> 1837: </a>            <span class="php-comment">// check if PCRE Unicode support is enabled</span>
</span><span id="1838" class="l"><a href="#1838"> 1838: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode <span class="php-keyword1">AND</span> (@<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/\pL/u'</span>, <span class="php-quote">'a'</span>) == <span class="php-num">1</span>)) {
</span><span id="1839" class="l"><a href="#1839"> 1839: </a>                <span class="php-comment">// PCRE unicode support is turned ON</span>
</span><span id="1840" class="l"><a href="#1840"> 1840: </a>                <span class="php-comment">// \p{Z} or \p{Separator}: any kind of Unicode whitespace or invisible separator.</span>
</span><span id="1841" class="l"><a href="#1841"> 1841: </a>                <span class="php-comment">// \p{Lo} or \p{Other_Letter}: a Unicode letter or ideograph that does not have lowercase and uppercase variants.</span>
</span><span id="1842" class="l"><a href="#1842"> 1842: </a>                <span class="php-comment">// \p{Lo} is needed because Chinese characters are packed next to each other without spaces in between.</span>
</span><span id="1843" class="l"><a href="#1843"> 1843: </a>                <span class="php-comment">//$this-&gt;re_spaces = '/[\s\p{Z}\p{Lo}]/u';</span>
</span><span id="1844" class="l"><a href="#1844"> 1844: </a>                <span class="php-var">$this</span>-&gt;re_spaces = <span class="php-quote">'/[\s\p{Z}]/u'</span>;
</span><span id="1845" class="l"><a href="#1845"> 1845: </a>            } <span class="php-keyword1">else</span> {
</span><span id="1846" class="l"><a href="#1846"> 1846: </a>                <span class="php-comment">// PCRE unicode support is turned OFF</span>
</span><span id="1847" class="l"><a href="#1847"> 1847: </a>                <span class="php-var">$this</span>-&gt;re_spaces = <span class="php-quote">'/[\s]/'</span>;
</span><span id="1848" class="l"><a href="#1848"> 1848: </a>            }
</span><span id="1849" class="l"><a href="#1849"> 1849: </a>            <span class="php-var">$this</span>-&gt;annot_obj_id = <span class="php-var">$this</span>-&gt;annots_start_obj_id;
</span><span id="1850" class="l"><a href="#1850"> 1850: </a>            <span class="php-var">$this</span>-&gt;curr_annot_obj_id = <span class="php-var">$this</span>-&gt;annots_start_obj_id;
</span><span id="1851" class="l"><a href="#1851"> 1851: </a>            <span class="php-var">$this</span>-&gt;apxo_obj_id = <span class="php-var">$this</span>-&gt;apxo_start_obj_id;
</span><span id="1852" class="l"><a href="#1852"> 1852: </a>            <span class="php-var">$this</span>-&gt;js_obj_id = <span class="php-var">$this</span>-&gt;js_start_obj_id;
</span><span id="1853" class="l"><a href="#1853"> 1853: </a>            <span class="php-var">$this</span>-&gt;default_form_prop = <span class="php-keyword1">array</span>(<span class="php-quote">'lineWidth'</span>=&gt;<span class="php-num">1</span>, <span class="php-quote">'borderStyle'</span>=&gt;<span class="php-quote">'solid'</span>, <span class="php-quote">'fillColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">255</span>, <span class="php-num">255</span>, <span class="php-num">255</span>), <span class="php-quote">'strokeColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">128</span>, <span class="php-num">128</span>, <span class="php-num">128</span>));
</span><span id="1854" class="l"><a href="#1854"> 1854: </a>        }
</span><span id="1855" class="l"><a href="#1855"> 1855: </a>
</span><span id="1856" class="l"><a href="#1856"> 1856: </a>        <span class="php-comment">/**
</span></span><span id="1857" class="l"><a href="#1857"> 1857: </a><span class="php-comment">         * Default destructor.
</span></span><span id="1858" class="l"><a href="#1858"> 1858: </a><span class="php-comment">         * @access public
</span></span><span id="1859" class="l"><a href="#1859"> 1859: </a><span class="php-comment">         * @since 1.53.0.TC016
</span></span><span id="1860" class="l"><a href="#1860"> 1860: </a><span class="php-comment">         */</span>
</span><span id="1861" class="l"><a href="#1861"> 1861: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> __destruct() {
</span><span id="1862" class="l"><a href="#1862"> 1862: </a>            <span class="php-comment">// restore internal encoding</span>
</span><span id="1863" class="l"><a href="#1863"> 1863: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;internal_encoding) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;internal_encoding)) {
</span><span id="1864" class="l"><a href="#1864"> 1864: </a>                <span class="php-keyword2">mb_internal_encoding</span>(<span class="php-var">$this</span>-&gt;internal_encoding);
</span><span id="1865" class="l"><a href="#1865"> 1865: </a>            }
</span><span id="1866" class="l"><a href="#1866"> 1866: </a>            <span class="php-comment">// unset all class variables</span>
</span><span id="1867" class="l"><a href="#1867"> 1867: </a>            <span class="php-var">$this</span>-&gt;_destroy(<span class="php-keyword1">true</span>);
</span><span id="1868" class="l"><a href="#1868"> 1868: </a>        }
</span><span id="1869" class="l"><a href="#1869"> 1869: </a>
</span><span id="1870" class="l"><a href="#1870"> 1870: </a>        <span class="php-comment">/**
</span></span><span id="1871" class="l"><a href="#1871"> 1871: </a><span class="php-comment">         * Set the units of measure for the document.
</span></span><span id="1872" class="l"><a href="#1872"> 1872: </a><span class="php-comment">         * @param string $unit User measure unit. Possible values are:&lt;ul&gt;&lt;li&gt;pt: point&lt;/li&gt;&lt;li&gt;mm: millimeter (default)&lt;/li&gt;&lt;li&gt;cm: centimeter&lt;/li&gt;&lt;li&gt;in: inch&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;A point equals 1/72 of inch, that is to say about 0.35 mm (an inch being 2.54 cm). This is a very common unit in typography; font sizes are expressed in that unit.
</span></span><span id="1873" class="l"><a href="#1873"> 1873: </a><span class="php-comment">         * @access public
</span></span><span id="1874" class="l"><a href="#1874"> 1874: </a><span class="php-comment">         * @since 3.0.015 (2008-06-06)
</span></span><span id="1875" class="l"><a href="#1875"> 1875: </a><span class="php-comment">         */</span>
</span><span id="1876" class="l"><a href="#1876"> 1876: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPageUnit(<span class="php-var">$unit</span>) {
</span><span id="1877" class="l"><a href="#1877"> 1877: </a>            <span class="php-var">$unit</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$unit</span>);
</span><span id="1878" class="l"><a href="#1878"> 1878: </a>            <span class="php-comment">//Set scale factor</span>
</span><span id="1879" class="l"><a href="#1879"> 1879: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$unit</span>) {
</span><span id="1880" class="l"><a href="#1880"> 1880: </a>                <span class="php-comment">// points</span>
</span><span id="1881" class="l"><a href="#1881"> 1881: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'px'</span>:
</span><span id="1882" class="l"><a href="#1882"> 1882: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'pt'</span>: {
</span><span id="1883" class="l"><a href="#1883"> 1883: </a>                    <span class="php-var">$this</span>-&gt;k = <span class="php-num">1</span>;
</span><span id="1884" class="l"><a href="#1884"> 1884: </a>                    <span class="php-keyword1">break</span>;
</span><span id="1885" class="l"><a href="#1885"> 1885: </a>                }
</span><span id="1886" class="l"><a href="#1886"> 1886: </a>                <span class="php-comment">// millimeters</span>
</span><span id="1887" class="l"><a href="#1887"> 1887: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'mm'</span>: {
</span><span id="1888" class="l"><a href="#1888"> 1888: </a>                    <span class="php-var">$this</span>-&gt;k = <span class="php-var">$this</span>-&gt;dpi / <span class="php-num">25.4</span>;
</span><span id="1889" class="l"><a href="#1889"> 1889: </a>                    <span class="php-keyword1">break</span>;
</span><span id="1890" class="l"><a href="#1890"> 1890: </a>                }
</span><span id="1891" class="l"><a href="#1891"> 1891: </a>                <span class="php-comment">// centimeters</span>
</span><span id="1892" class="l"><a href="#1892"> 1892: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'cm'</span>: {
</span><span id="1893" class="l"><a href="#1893"> 1893: </a>                    <span class="php-var">$this</span>-&gt;k = <span class="php-var">$this</span>-&gt;dpi / <span class="php-num">2.54</span>;
</span><span id="1894" class="l"><a href="#1894"> 1894: </a>                    <span class="php-keyword1">break</span>;
</span><span id="1895" class="l"><a href="#1895"> 1895: </a>                }
</span><span id="1896" class="l"><a href="#1896"> 1896: </a>                <span class="php-comment">// inches</span>
</span><span id="1897" class="l"><a href="#1897"> 1897: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'in'</span>: {
</span><span id="1898" class="l"><a href="#1898"> 1898: </a>                    <span class="php-var">$this</span>-&gt;k = <span class="php-var">$this</span>-&gt;dpi;
</span><span id="1899" class="l"><a href="#1899"> 1899: </a>                    <span class="php-keyword1">break</span>;
</span><span id="1900" class="l"><a href="#1900"> 1900: </a>                }
</span><span id="1901" class="l"><a href="#1901"> 1901: </a>                <span class="php-comment">// unsupported unit</span>
</span><span id="1902" class="l"><a href="#1902"> 1902: </a>                <span class="php-keyword1">default</span> : {
</span><span id="1903" class="l"><a href="#1903"> 1903: </a>                    <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Incorrect unit: '</span>.<span class="php-var">$unit</span>);
</span><span id="1904" class="l"><a href="#1904"> 1904: </a>                    <span class="php-keyword1">break</span>;
</span><span id="1905" class="l"><a href="#1905"> 1905: </a>                }
</span><span id="1906" class="l"><a href="#1906"> 1906: </a>            }
</span><span id="1907" class="l"><a href="#1907"> 1907: </a>            <span class="php-var">$this</span>-&gt;pdfunit = <span class="php-var">$unit</span>;
</span><span id="1908" class="l"><a href="#1908"> 1908: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;CurOrientation)) {
</span><span id="1909" class="l"><a href="#1909"> 1909: </a>                    <span class="php-var">$this</span>-&gt;setPageOrientation(<span class="php-var">$this</span>-&gt;CurOrientation);
</span><span id="1910" class="l"><a href="#1910"> 1910: </a>            }
</span><span id="1911" class="l"><a href="#1911"> 1911: </a>        }
</span><span id="1912" class="l"><a href="#1912"> 1912: </a>
</span><span id="1913" class="l"><a href="#1913"> 1913: </a>        <span class="php-comment">/**
</span></span><span id="1914" class="l"><a href="#1914"> 1914: </a><span class="php-comment">         * Set the page format
</span></span><span id="1915" class="l"><a href="#1915"> 1915: </a><span class="php-comment">         * @param mixed $format The format used for pages. It can be either one of the following values (case insensitive) or a custom format in the form of a two-element array containing the width and the height (expressed in the unit given by unit).&lt;ul&gt;&lt;li&gt;4A0&lt;/li&gt;&lt;li&gt;2A0&lt;/li&gt;&lt;li&gt;A0&lt;/li&gt;&lt;li&gt;A1&lt;/li&gt;&lt;li&gt;A2&lt;/li&gt;&lt;li&gt;A3&lt;/li&gt;&lt;li&gt;A4 (default)&lt;/li&gt;&lt;li&gt;A5&lt;/li&gt;&lt;li&gt;A6&lt;/li&gt;&lt;li&gt;A7&lt;/li&gt;&lt;li&gt;A8&lt;/li&gt;&lt;li&gt;A9&lt;/li&gt;&lt;li&gt;A10&lt;/li&gt;&lt;li&gt;B0&lt;/li&gt;&lt;li&gt;B1&lt;/li&gt;&lt;li&gt;B2&lt;/li&gt;&lt;li&gt;B3&lt;/li&gt;&lt;li&gt;B4&lt;/li&gt;&lt;li&gt;B5&lt;/li&gt;&lt;li&gt;B6&lt;/li&gt;&lt;li&gt;B7&lt;/li&gt;&lt;li&gt;B8&lt;/li&gt;&lt;li&gt;B9&lt;/li&gt;&lt;li&gt;B10&lt;/li&gt;&lt;li&gt;C0&lt;/li&gt;&lt;li&gt;C1&lt;/li&gt;&lt;li&gt;C2&lt;/li&gt;&lt;li&gt;C3&lt;/li&gt;&lt;li&gt;C4&lt;/li&gt;&lt;li&gt;C5&lt;/li&gt;&lt;li&gt;C6&lt;/li&gt;&lt;li&gt;C7&lt;/li&gt;&lt;li&gt;C8&lt;/li&gt;&lt;li&gt;C9&lt;/li&gt;&lt;li&gt;C10&lt;/li&gt;&lt;li&gt;RA0&lt;/li&gt;&lt;li&gt;RA1&lt;/li&gt;&lt;li&gt;RA2&lt;/li&gt;&lt;li&gt;RA3&lt;/li&gt;&lt;li&gt;RA4&lt;/li&gt;&lt;li&gt;SRA0&lt;/li&gt;&lt;li&gt;SRA1&lt;/li&gt;&lt;li&gt;SRA2&lt;/li&gt;&lt;li&gt;SRA3&lt;/li&gt;&lt;li&gt;SRA4&lt;/li&gt;&lt;li&gt;LETTER&lt;/li&gt;&lt;li&gt;LEGAL&lt;/li&gt;&lt;li&gt;EXECUTIVE&lt;/li&gt;&lt;li&gt;FOLIO&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="1916" class="l"><a href="#1916"> 1916: </a><span class="php-comment">         * @param string $orientation page orientation. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;P or PORTRAIT (default)&lt;/li&gt;&lt;li&gt;L or LANDSCAPE&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="1917" class="l"><a href="#1917"> 1917: </a><span class="php-comment">         * @access public
</span></span><span id="1918" class="l"><a href="#1918"> 1918: </a><span class="php-comment">         * @since 3.0.015 (2008-06-06)
</span></span><span id="1919" class="l"><a href="#1919"> 1919: </a><span class="php-comment">         */</span>
</span><span id="1920" class="l"><a href="#1920"> 1920: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPageFormat(<span class="php-var">$format</span>, <span class="php-var">$orientation</span>=<span class="php-quote">'P'</span>) {
</span><span id="1921" class="l"><a href="#1921"> 1921: </a>            <span class="php-comment">//Page format</span>
</span><span id="1922" class="l"><a href="#1922"> 1922: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$format</span>)) {
</span><span id="1923" class="l"><a href="#1923"> 1923: </a>                <span class="php-comment">// Page formats (45 standard ISO paper formats and 4 american common formats).</span>
</span><span id="1924" class="l"><a href="#1924"> 1924: </a>                <span class="php-comment">// Paper cordinates are calculated in this way: (inches * 72) where (1 inch = 2.54 cm)</span>
</span><span id="1925" class="l"><a href="#1925"> 1925: </a>                <span class="php-keyword1">switch</span> (<span class="php-keyword2">strtoupper</span>(<span class="php-var">$format</span>)) {
</span><span id="1926" class="l"><a href="#1926"> 1926: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'4A0'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">4767.87</span>,<span class="php-num">6740.79</span>); <span class="php-keyword1">break</span>;}
</span><span id="1927" class="l"><a href="#1927"> 1927: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'2A0'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">3370.39</span>,<span class="php-num">4767.87</span>); <span class="php-keyword1">break</span>;}
</span><span id="1928" class="l"><a href="#1928"> 1928: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A0'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">2383.94</span>,<span class="php-num">3370.39</span>); <span class="php-keyword1">break</span>;}
</span><span id="1929" class="l"><a href="#1929"> 1929: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A1'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1683.78</span>,<span class="php-num">2383.94</span>); <span class="php-keyword1">break</span>;}
</span><span id="1930" class="l"><a href="#1930"> 1930: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A2'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1190.55</span>,<span class="php-num">1683.78</span>); <span class="php-keyword1">break</span>;}
</span><span id="1931" class="l"><a href="#1931"> 1931: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A3'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">841.89</span>,<span class="php-num">1190.55</span>); <span class="php-keyword1">break</span>;}
</span><span id="1932" class="l"><a href="#1932"> 1932: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A4'</span>: <span class="php-keyword1">default</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">595.28</span>,<span class="php-num">841.89</span>); <span class="php-keyword1">break</span>;}
</span><span id="1933" class="l"><a href="#1933"> 1933: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A5'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">419.53</span>,<span class="php-num">595.28</span>); <span class="php-keyword1">break</span>;}
</span><span id="1934" class="l"><a href="#1934"> 1934: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A6'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">297.64</span>,<span class="php-num">419.53</span>); <span class="php-keyword1">break</span>;}
</span><span id="1935" class="l"><a href="#1935"> 1935: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A7'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">209.76</span>,<span class="php-num">297.64</span>); <span class="php-keyword1">break</span>;}
</span><span id="1936" class="l"><a href="#1936"> 1936: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A8'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">147.40</span>,<span class="php-num">209.76</span>); <span class="php-keyword1">break</span>;}
</span><span id="1937" class="l"><a href="#1937"> 1937: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A9'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">104.88</span>,<span class="php-num">147.40</span>); <span class="php-keyword1">break</span>;}
</span><span id="1938" class="l"><a href="#1938"> 1938: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A10'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">73.70</span>,<span class="php-num">104.88</span>); <span class="php-keyword1">break</span>;}
</span><span id="1939" class="l"><a href="#1939"> 1939: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B0'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">2834.65</span>,<span class="php-num">4008.19</span>); <span class="php-keyword1">break</span>;}
</span><span id="1940" class="l"><a href="#1940"> 1940: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B1'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">2004.09</span>,<span class="php-num">2834.65</span>); <span class="php-keyword1">break</span>;}
</span><span id="1941" class="l"><a href="#1941"> 1941: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B2'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1417.32</span>,<span class="php-num">2004.09</span>); <span class="php-keyword1">break</span>;}
</span><span id="1942" class="l"><a href="#1942"> 1942: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B3'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1000.63</span>,<span class="php-num">1417.32</span>); <span class="php-keyword1">break</span>;}
</span><span id="1943" class="l"><a href="#1943"> 1943: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B4'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">708.66</span>,<span class="php-num">1000.63</span>); <span class="php-keyword1">break</span>;}
</span><span id="1944" class="l"><a href="#1944"> 1944: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B5'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">498.90</span>,<span class="php-num">708.66</span>); <span class="php-keyword1">break</span>;}
</span><span id="1945" class="l"><a href="#1945"> 1945: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B6'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">354.33</span>,<span class="php-num">498.90</span>); <span class="php-keyword1">break</span>;}
</span><span id="1946" class="l"><a href="#1946"> 1946: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B7'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">249.45</span>,<span class="php-num">354.33</span>); <span class="php-keyword1">break</span>;}
</span><span id="1947" class="l"><a href="#1947"> 1947: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B8'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">175.75</span>,<span class="php-num">249.45</span>); <span class="php-keyword1">break</span>;}
</span><span id="1948" class="l"><a href="#1948"> 1948: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B9'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">124.72</span>,<span class="php-num">175.75</span>); <span class="php-keyword1">break</span>;}
</span><span id="1949" class="l"><a href="#1949"> 1949: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B10'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">87.87</span>,<span class="php-num">124.72</span>); <span class="php-keyword1">break</span>;}
</span><span id="1950" class="l"><a href="#1950"> 1950: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C0'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">2599.37</span>,<span class="php-num">3676.54</span>); <span class="php-keyword1">break</span>;}
</span><span id="1951" class="l"><a href="#1951"> 1951: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C1'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1836.85</span>,<span class="php-num">2599.37</span>); <span class="php-keyword1">break</span>;}
</span><span id="1952" class="l"><a href="#1952"> 1952: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C2'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1298.27</span>,<span class="php-num">1836.85</span>); <span class="php-keyword1">break</span>;}
</span><span id="1953" class="l"><a href="#1953"> 1953: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C3'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">918.43</span>,<span class="php-num">1298.27</span>); <span class="php-keyword1">break</span>;}
</span><span id="1954" class="l"><a href="#1954"> 1954: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C4'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">649.13</span>,<span class="php-num">918.43</span>); <span class="php-keyword1">break</span>;}
</span><span id="1955" class="l"><a href="#1955"> 1955: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C5'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">459.21</span>,<span class="php-num">649.13</span>); <span class="php-keyword1">break</span>;}
</span><span id="1956" class="l"><a href="#1956"> 1956: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C6'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">323.15</span>,<span class="php-num">459.21</span>); <span class="php-keyword1">break</span>;}
</span><span id="1957" class="l"><a href="#1957"> 1957: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C7'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">229.61</span>,<span class="php-num">323.15</span>); <span class="php-keyword1">break</span>;}
</span><span id="1958" class="l"><a href="#1958"> 1958: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C8'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">161.57</span>,<span class="php-num">229.61</span>); <span class="php-keyword1">break</span>;}
</span><span id="1959" class="l"><a href="#1959"> 1959: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C9'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">113.39</span>,<span class="php-num">161.57</span>); <span class="php-keyword1">break</span>;}
</span><span id="1960" class="l"><a href="#1960"> 1960: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C10'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">79.37</span>,<span class="php-num">113.39</span>); <span class="php-keyword1">break</span>;}
</span><span id="1961" class="l"><a href="#1961"> 1961: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'RA0'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">2437.80</span>,<span class="php-num">3458.27</span>); <span class="php-keyword1">break</span>;}
</span><span id="1962" class="l"><a href="#1962"> 1962: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'RA1'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1729.13</span>,<span class="php-num">2437.80</span>); <span class="php-keyword1">break</span>;}
</span><span id="1963" class="l"><a href="#1963"> 1963: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'RA2'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1218.90</span>,<span class="php-num">1729.13</span>); <span class="php-keyword1">break</span>;}
</span><span id="1964" class="l"><a href="#1964"> 1964: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'RA3'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">864.57</span>,<span class="php-num">1218.90</span>); <span class="php-keyword1">break</span>;}
</span><span id="1965" class="l"><a href="#1965"> 1965: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'RA4'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">609.45</span>,<span class="php-num">864.57</span>); <span class="php-keyword1">break</span>;}
</span><span id="1966" class="l"><a href="#1966"> 1966: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'SRA0'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">2551.18</span>,<span class="php-num">3628.35</span>); <span class="php-keyword1">break</span>;}
</span><span id="1967" class="l"><a href="#1967"> 1967: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'SRA1'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1814.17</span>,<span class="php-num">2551.18</span>); <span class="php-keyword1">break</span>;}
</span><span id="1968" class="l"><a href="#1968"> 1968: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'SRA2'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">1275.59</span>,<span class="php-num">1814.17</span>); <span class="php-keyword1">break</span>;}
</span><span id="1969" class="l"><a href="#1969"> 1969: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'SRA3'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">907.09</span>,<span class="php-num">1275.59</span>); <span class="php-keyword1">break</span>;}
</span><span id="1970" class="l"><a href="#1970"> 1970: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'SRA4'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">637.80</span>,<span class="php-num">907.09</span>); <span class="php-keyword1">break</span>;}
</span><span id="1971" class="l"><a href="#1971"> 1971: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'LETTER'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">612.00</span>,<span class="php-num">792.00</span>); <span class="php-keyword1">break</span>;}
</span><span id="1972" class="l"><a href="#1972"> 1972: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'LEGAL'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">612.00</span>,<span class="php-num">1008.00</span>); <span class="php-keyword1">break</span>;}
</span><span id="1973" class="l"><a href="#1973"> 1973: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'EXECUTIVE'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">521.86</span>,<span class="php-num">756.00</span>); <span class="php-keyword1">break</span>;}
</span><span id="1974" class="l"><a href="#1974"> 1974: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'FOLIO'</span>: {<span class="php-var">$format</span> = <span class="php-keyword1">array</span>(<span class="php-num">612.00</span>,<span class="php-num">936.00</span>); <span class="php-keyword1">break</span>;}
</span><span id="1975" class="l"><a href="#1975"> 1975: </a>                }
</span><span id="1976" class="l"><a href="#1976"> 1976: </a>                <span class="php-var">$this</span>-&gt;fwPt = <span class="php-var">$format</span>[<span class="php-num">0</span>];
</span><span id="1977" class="l"><a href="#1977"> 1977: </a>                <span class="php-var">$this</span>-&gt;fhPt = <span class="php-var">$format</span>[<span class="php-num">1</span>];
</span><span id="1978" class="l"><a href="#1978"> 1978: </a>            } <span class="php-keyword1">else</span> {
</span><span id="1979" class="l"><a href="#1979"> 1979: </a>                <span class="php-var">$this</span>-&gt;fwPt = <span class="php-var">$format</span>[<span class="php-num">0</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="1980" class="l"><a href="#1980"> 1980: </a>                <span class="php-var">$this</span>-&gt;fhPt = <span class="php-var">$format</span>[<span class="php-num">1</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="1981" class="l"><a href="#1981"> 1981: </a>            }
</span><span id="1982" class="l"><a href="#1982"> 1982: </a>            <span class="php-var">$this</span>-&gt;setPageOrientation(<span class="php-var">$orientation</span>);
</span><span id="1983" class="l"><a href="#1983"> 1983: </a>        }
</span><span id="1984" class="l"><a href="#1984"> 1984: </a>
</span><span id="1985" class="l"><a href="#1985"> 1985: </a>        <span class="php-comment">/**
</span></span><span id="1986" class="l"><a href="#1986"> 1986: </a><span class="php-comment">         * Set page orientation.
</span></span><span id="1987" class="l"><a href="#1987"> 1987: </a><span class="php-comment">         * @param string $orientation page orientation. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;P or PORTRAIT (default)&lt;/li&gt;&lt;li&gt;L or LANDSCAPE&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="1988" class="l"><a href="#1988"> 1988: </a><span class="php-comment">         * @param boolean $autopagebreak Boolean indicating if auto-page-break mode should be on or off.
</span></span><span id="1989" class="l"><a href="#1989"> 1989: </a><span class="php-comment">         * @param float $bottommargin bottom margin of the page.
</span></span><span id="1990" class="l"><a href="#1990"> 1990: </a><span class="php-comment">         * @access public
</span></span><span id="1991" class="l"><a href="#1991"> 1991: </a><span class="php-comment">         * @since 3.0.015 (2008-06-06)
</span></span><span id="1992" class="l"><a href="#1992"> 1992: </a><span class="php-comment">         */</span>
</span><span id="1993" class="l"><a href="#1993"> 1993: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPageOrientation(<span class="php-var">$orientation</span>, <span class="php-var">$autopagebreak</span>=<span class="php-quote">''</span>, <span class="php-var">$bottommargin</span>=<span class="php-quote">''</span>) {
</span><span id="1994" class="l"><a href="#1994"> 1994: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;fwPt &gt; <span class="php-var">$this</span>-&gt;fhPt) {
</span><span id="1995" class="l"><a href="#1995"> 1995: </a>                <span class="php-comment">// landscape</span>
</span><span id="1996" class="l"><a href="#1996"> 1996: </a>                <span class="php-var">$default_orientation</span> = <span class="php-quote">'L'</span>;
</span><span id="1997" class="l"><a href="#1997"> 1997: </a>            } <span class="php-keyword1">else</span> {
</span><span id="1998" class="l"><a href="#1998"> 1998: </a>                <span class="php-comment">// portrait</span>
</span><span id="1999" class="l"><a href="#1999"> 1999: </a>                <span class="php-var">$default_orientation</span> = <span class="php-quote">'P'</span>;
</span><span id="2000" class="l"><a href="#2000"> 2000: </a>            }
</span><span id="2001" class="l"><a href="#2001"> 2001: </a>            <span class="php-var">$valid_orientations</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'P'</span>, <span class="php-quote">'L'</span>);
</span><span id="2002" class="l"><a href="#2002"> 2002: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$orientation</span>)) {
</span><span id="2003" class="l"><a href="#2003"> 2003: </a>                <span class="php-var">$orientation</span> = <span class="php-var">$default_orientation</span>;
</span><span id="2004" class="l"><a href="#2004"> 2004: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2005" class="l"><a href="#2005"> 2005: </a>                <span class="php-var">$orientation</span> = <span class="php-var">$orientation</span>{<span class="php-num">0</span>};
</span><span id="2006" class="l"><a href="#2006"> 2006: </a>                <span class="php-var">$orientation</span> = <span class="php-keyword2">strtoupper</span>(<span class="php-var">$orientation</span>);
</span><span id="2007" class="l"><a href="#2007"> 2007: </a>            }
</span><span id="2008" class="l"><a href="#2008"> 2008: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$orientation</span>, <span class="php-var">$valid_orientations</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$orientation</span> != <span class="php-var">$default_orientation</span>)) {
</span><span id="2009" class="l"><a href="#2009"> 2009: </a>                <span class="php-var">$this</span>-&gt;CurOrientation = <span class="php-var">$orientation</span>;
</span><span id="2010" class="l"><a href="#2010"> 2010: </a>                <span class="php-var">$this</span>-&gt;wPt = <span class="php-var">$this</span>-&gt;fhPt;
</span><span id="2011" class="l"><a href="#2011"> 2011: </a>                <span class="php-var">$this</span>-&gt;hPt = <span class="php-var">$this</span>-&gt;fwPt;
</span><span id="2012" class="l"><a href="#2012"> 2012: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2013" class="l"><a href="#2013"> 2013: </a>                <span class="php-var">$this</span>-&gt;CurOrientation = <span class="php-var">$default_orientation</span>;
</span><span id="2014" class="l"><a href="#2014"> 2014: </a>                <span class="php-var">$this</span>-&gt;wPt = <span class="php-var">$this</span>-&gt;fwPt;
</span><span id="2015" class="l"><a href="#2015"> 2015: </a>                <span class="php-var">$this</span>-&gt;hPt = <span class="php-var">$this</span>-&gt;fhPt;
</span><span id="2016" class="l"><a href="#2016"> 2016: </a>            }
</span><span id="2017" class="l"><a href="#2017"> 2017: </a>            <span class="php-var">$this</span>-&gt;w = <span class="php-var">$this</span>-&gt;wPt / <span class="php-var">$this</span>-&gt;k;
</span><span id="2018" class="l"><a href="#2018"> 2018: </a>            <span class="php-var">$this</span>-&gt;h = <span class="php-var">$this</span>-&gt;hPt / <span class="php-var">$this</span>-&gt;k;
</span><span id="2019" class="l"><a href="#2019"> 2019: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$autopagebreak</span>)) {
</span><span id="2020" class="l"><a href="#2020"> 2020: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;AutoPageBreak)) {
</span><span id="2021" class="l"><a href="#2021"> 2021: </a>                    <span class="php-var">$autopagebreak</span> = <span class="php-var">$this</span>-&gt;AutoPageBreak;
</span><span id="2022" class="l"><a href="#2022"> 2022: </a>                } <span class="php-keyword1">else</span> {
</span><span id="2023" class="l"><a href="#2023"> 2023: </a>                    <span class="php-var">$autopagebreak</span> = <span class="php-keyword1">true</span>;
</span><span id="2024" class="l"><a href="#2024"> 2024: </a>                }
</span><span id="2025" class="l"><a href="#2025"> 2025: </a>            }
</span><span id="2026" class="l"><a href="#2026"> 2026: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$bottommargin</span>)) {
</span><span id="2027" class="l"><a href="#2027"> 2027: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;bMargin)) {
</span><span id="2028" class="l"><a href="#2028"> 2028: </a>                    <span class="php-var">$bottommargin</span> = <span class="php-var">$this</span>-&gt;bMargin;
</span><span id="2029" class="l"><a href="#2029"> 2029: </a>                } <span class="php-keyword1">else</span> {
</span><span id="2030" class="l"><a href="#2030"> 2030: </a>                    <span class="php-comment">// default value = 2 cm</span>
</span><span id="2031" class="l"><a href="#2031"> 2031: </a>                    <span class="php-var">$bottommargin</span> = <span class="php-num">2</span> * <span class="php-num">28.35</span> / <span class="php-var">$this</span>-&gt;k;
</span><span id="2032" class="l"><a href="#2032"> 2032: </a>                }
</span><span id="2033" class="l"><a href="#2033"> 2033: </a>            }
</span><span id="2034" class="l"><a href="#2034"> 2034: </a>            <span class="php-var">$this</span>-&gt;SetAutoPageBreak(<span class="php-var">$autopagebreak</span>, <span class="php-var">$bottommargin</span>);
</span><span id="2035" class="l"><a href="#2035"> 2035: </a>            <span class="php-comment">// store page dimensions</span>
</span><span id="2036" class="l"><a href="#2036"> 2036: </a>            <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page] = <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span> =&gt; <span class="php-var">$this</span>-&gt;wPt, <span class="php-quote">'h'</span> =&gt; <span class="php-var">$this</span>-&gt;hPt, <span class="php-quote">'wk'</span> =&gt; <span class="php-var">$this</span>-&gt;w, <span class="php-quote">'hk'</span> =&gt; <span class="php-var">$this</span>-&gt;h, <span class="php-quote">'tm'</span> =&gt; <span class="php-var">$this</span>-&gt;tMargin, <span class="php-quote">'bm'</span> =&gt; <span class="php-var">$bottommargin</span>, <span class="php-quote">'lm'</span> =&gt; <span class="php-var">$this</span>-&gt;lMargin, <span class="php-quote">'rm'</span> =&gt; <span class="php-var">$this</span>-&gt;rMargin, <span class="php-quote">'pb'</span> =&gt; <span class="php-var">$autopagebreak</span>, <span class="php-quote">'or'</span> =&gt; <span class="php-var">$this</span>-&gt;CurOrientation, <span class="php-quote">'olm'</span> =&gt; <span class="php-var">$this</span>-&gt;original_lMargin, <span class="php-quote">'orm'</span> =&gt; <span class="php-var">$this</span>-&gt;original_rMargin);
</span><span id="2037" class="l"><a href="#2037"> 2037: </a>        }
</span><span id="2038" class="l"><a href="#2038"> 2038: </a>
</span><span id="2039" class="l"><a href="#2039"> 2039: </a>        <span class="php-comment">/**
</span></span><span id="2040" class="l"><a href="#2040"> 2040: </a><span class="php-comment">         * Set regular expression to detect withespaces or word separators.
</span></span><span id="2041" class="l"><a href="#2041"> 2041: </a><span class="php-comment">         * @param string $re regular expression (leave empty for default).
</span></span><span id="2042" class="l"><a href="#2042"> 2042: </a><span class="php-comment">         * @access public
</span></span><span id="2043" class="l"><a href="#2043"> 2043: </a><span class="php-comment">         * @since 4.6.016 (2009-06-15)
</span></span><span id="2044" class="l"><a href="#2044"> 2044: </a><span class="php-comment">         */</span>
</span><span id="2045" class="l"><a href="#2045"> 2045: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setSpacesRE(<span class="php-var">$re</span>=<span class="php-quote">'/[\s]/'</span>) {
</span><span id="2046" class="l"><a href="#2046"> 2046: </a>            <span class="php-comment">// if PCRE unicode support is turned ON:</span>
</span><span id="2047" class="l"><a href="#2047"> 2047: </a>            <span class="php-comment">//  \p{Z} or \p{Separator}: any kind of Unicode whitespace or invisible separator.</span>
</span><span id="2048" class="l"><a href="#2048"> 2048: </a>            <span class="php-comment">//  \p{Lo} or \p{Other_Letter}: a Unicode letter or ideograph that does not have lowercase and uppercase variants.</span>
</span><span id="2049" class="l"><a href="#2049"> 2049: </a>            <span class="php-comment">//  \p{Lo} is needed because Chinese characters are packed next to each other without spaces in between.</span>
</span><span id="2050" class="l"><a href="#2050"> 2050: </a>            <span class="php-var">$this</span>-&gt;re_spaces = <span class="php-var">$re</span>;
</span><span id="2051" class="l"><a href="#2051"> 2051: </a>        }
</span><span id="2052" class="l"><a href="#2052"> 2052: </a>
</span><span id="2053" class="l"><a href="#2053"> 2053: </a>        <span class="php-comment">/**
</span></span><span id="2054" class="l"><a href="#2054"> 2054: </a><span class="php-comment">         * Enable or disable Right-To-Left language mode
</span></span><span id="2055" class="l"><a href="#2055"> 2055: </a><span class="php-comment">         * @param Boolean $enable if true enable Right-To-Left language mode.
</span></span><span id="2056" class="l"><a href="#2056"> 2056: </a><span class="php-comment">         * @param Boolean $resetx if true reset the X position on direction change.
</span></span><span id="2057" class="l"><a href="#2057"> 2057: </a><span class="php-comment">         * @access public
</span></span><span id="2058" class="l"><a href="#2058"> 2058: </a><span class="php-comment">         * @since 2.0.000 (2008-01-03)
</span></span><span id="2059" class="l"><a href="#2059"> 2059: </a><span class="php-comment">         */</span>
</span><span id="2060" class="l"><a href="#2060"> 2060: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setRTL(<span class="php-var">$enable</span>, <span class="php-var">$resetx</span>=<span class="php-keyword1">true</span>) {
</span><span id="2061" class="l"><a href="#2061"> 2061: </a>            <span class="php-var">$enable</span> = <span class="php-var">$enable</span> ? <span class="php-keyword1">true</span> : <span class="php-keyword1">false</span>;
</span><span id="2062" class="l"><a href="#2062"> 2062: </a>            <span class="php-var">$resetx</span> = (<span class="php-var">$resetx</span> <span class="php-keyword1">AND</span> (<span class="php-var">$enable</span> != <span class="php-var">$this</span>-&gt;rtl));
</span><span id="2063" class="l"><a href="#2063"> 2063: </a>            <span class="php-var">$this</span>-&gt;rtl = <span class="php-var">$enable</span>;
</span><span id="2064" class="l"><a href="#2064"> 2064: </a>            <span class="php-var">$this</span>-&gt;tmprtl = <span class="php-keyword1">false</span>;
</span><span id="2065" class="l"><a href="#2065"> 2065: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$resetx</span>) {
</span><span id="2066" class="l"><a href="#2066"> 2066: </a>                <span class="php-var">$this</span>-&gt;Ln(<span class="php-num">0</span>);
</span><span id="2067" class="l"><a href="#2067"> 2067: </a>            }
</span><span id="2068" class="l"><a href="#2068"> 2068: </a>        }
</span><span id="2069" class="l"><a href="#2069"> 2069: </a>
</span><span id="2070" class="l"><a href="#2070"> 2070: </a>        <span class="php-comment">/**
</span></span><span id="2071" class="l"><a href="#2071"> 2071: </a><span class="php-comment">         * Return the RTL status
</span></span><span id="2072" class="l"><a href="#2072"> 2072: </a><span class="php-comment">         * @return boolean
</span></span><span id="2073" class="l"><a href="#2073"> 2073: </a><span class="php-comment">         * @access public
</span></span><span id="2074" class="l"><a href="#2074"> 2074: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="2075" class="l"><a href="#2075"> 2075: </a><span class="php-comment">         */</span>
</span><span id="2076" class="l"><a href="#2076"> 2076: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getRTL() {
</span><span id="2077" class="l"><a href="#2077"> 2077: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;rtl;
</span><span id="2078" class="l"><a href="#2078"> 2078: </a>        }
</span><span id="2079" class="l"><a href="#2079"> 2079: </a>
</span><span id="2080" class="l"><a href="#2080"> 2080: </a>        <span class="php-comment">/**
</span></span><span id="2081" class="l"><a href="#2081"> 2081: </a><span class="php-comment">         * Force temporary RTL language direction
</span></span><span id="2082" class="l"><a href="#2082"> 2082: </a><span class="php-comment">         * @param mixed $mode can be false, 'L' for LTR or 'R' for RTL
</span></span><span id="2083" class="l"><a href="#2083"> 2083: </a><span class="php-comment">         * @access public
</span></span><span id="2084" class="l"><a href="#2084"> 2084: </a><span class="php-comment">         * @since 2.1.000 (2008-01-09)
</span></span><span id="2085" class="l"><a href="#2085"> 2085: </a><span class="php-comment">         */</span>
</span><span id="2086" class="l"><a href="#2086"> 2086: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setTempRTL(<span class="php-var">$mode</span>) {
</span><span id="2087" class="l"><a href="#2087"> 2087: </a>            <span class="php-var">$newmode</span> = <span class="php-keyword1">false</span>;
</span><span id="2088" class="l"><a href="#2088"> 2088: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$mode</span>) {
</span><span id="2089" class="l"><a href="#2089"> 2089: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'ltr'</span>:
</span><span id="2090" class="l"><a href="#2090"> 2090: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'LTR'</span>:
</span><span id="2091" class="l"><a href="#2091"> 2091: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'L'</span>: {
</span><span id="2092" class="l"><a href="#2092"> 2092: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="2093" class="l"><a href="#2093"> 2093: </a>                        <span class="php-var">$newmode</span> = <span class="php-quote">'L'</span>;
</span><span id="2094" class="l"><a href="#2094"> 2094: </a>                    }
</span><span id="2095" class="l"><a href="#2095"> 2095: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2096" class="l"><a href="#2096"> 2096: </a>                }
</span><span id="2097" class="l"><a href="#2097"> 2097: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'rtl'</span>:
</span><span id="2098" class="l"><a href="#2098"> 2098: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'RTL'</span>:
</span><span id="2099" class="l"><a href="#2099"> 2099: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'R'</span>: {
</span><span id="2100" class="l"><a href="#2100"> 2100: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="2101" class="l"><a href="#2101"> 2101: </a>                        <span class="php-var">$newmode</span> = <span class="php-quote">'R'</span>;
</span><span id="2102" class="l"><a href="#2102"> 2102: </a>                    }
</span><span id="2103" class="l"><a href="#2103"> 2103: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2104" class="l"><a href="#2104"> 2104: </a>                }
</span><span id="2105" class="l"><a href="#2105"> 2105: </a>                <span class="php-keyword1">case</span> <span class="php-keyword1">false</span>:
</span><span id="2106" class="l"><a href="#2106"> 2106: </a>                <span class="php-keyword1">default</span>: {
</span><span id="2107" class="l"><a href="#2107"> 2107: </a>                    <span class="php-var">$newmode</span> = <span class="php-keyword1">false</span>;
</span><span id="2108" class="l"><a href="#2108"> 2108: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2109" class="l"><a href="#2109"> 2109: </a>                }
</span><span id="2110" class="l"><a href="#2110"> 2110: </a>            }
</span><span id="2111" class="l"><a href="#2111"> 2111: </a>            <span class="php-var">$this</span>-&gt;tmprtl = <span class="php-var">$newmode</span>;
</span><span id="2112" class="l"><a href="#2112"> 2112: </a>        }
</span><span id="2113" class="l"><a href="#2113"> 2113: </a>
</span><span id="2114" class="l"><a href="#2114"> 2114: </a>        <span class="php-comment">/**
</span></span><span id="2115" class="l"><a href="#2115"> 2115: </a><span class="php-comment">         * Return the current temporary RTL status
</span></span><span id="2116" class="l"><a href="#2116"> 2116: </a><span class="php-comment">         * @return boolean
</span></span><span id="2117" class="l"><a href="#2117"> 2117: </a><span class="php-comment">         * @access public
</span></span><span id="2118" class="l"><a href="#2118"> 2118: </a><span class="php-comment">         * @since 4.8.014 (2009-11-04)
</span></span><span id="2119" class="l"><a href="#2119"> 2119: </a><span class="php-comment">         */</span>
</span><span id="2120" class="l"><a href="#2120"> 2120: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> isRTLTextDir() {
</span><span id="2121" class="l"><a href="#2121"> 2121: </a>            <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;rtl <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;tmprtl == <span class="php-quote">'R'</span>));
</span><span id="2122" class="l"><a href="#2122"> 2122: </a>        }
</span><span id="2123" class="l"><a href="#2123"> 2123: </a>
</span><span id="2124" class="l"><a href="#2124"> 2124: </a>        <span class="php-comment">/**
</span></span><span id="2125" class="l"><a href="#2125"> 2125: </a><span class="php-comment">         * Set the last cell height.
</span></span><span id="2126" class="l"><a href="#2126"> 2126: </a><span class="php-comment">         * @param float $h cell height.
</span></span><span id="2127" class="l"><a href="#2127"> 2127: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2128" class="l"><a href="#2128"> 2128: </a><span class="php-comment">         * @access public
</span></span><span id="2129" class="l"><a href="#2129"> 2129: </a><span class="php-comment">         * @since 1.53.0.TC034
</span></span><span id="2130" class="l"><a href="#2130"> 2130: </a><span class="php-comment">         */</span>
</span><span id="2131" class="l"><a href="#2131"> 2131: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setLastH(<span class="php-var">$h</span>) {
</span><span id="2132" class="l"><a href="#2132"> 2132: </a>            <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$h</span>;
</span><span id="2133" class="l"><a href="#2133"> 2133: </a>        }
</span><span id="2134" class="l"><a href="#2134"> 2134: </a>
</span><span id="2135" class="l"><a href="#2135"> 2135: </a>        <span class="php-comment">/**
</span></span><span id="2136" class="l"><a href="#2136"> 2136: </a><span class="php-comment">         * Get the last cell height.
</span></span><span id="2137" class="l"><a href="#2137"> 2137: </a><span class="php-comment">         * @return last cell height
</span></span><span id="2138" class="l"><a href="#2138"> 2138: </a><span class="php-comment">         * @access public
</span></span><span id="2139" class="l"><a href="#2139"> 2139: </a><span class="php-comment">         * @since 4.0.017 (2008-08-05)
</span></span><span id="2140" class="l"><a href="#2140"> 2140: </a><span class="php-comment">         */</span>
</span><span id="2141" class="l"><a href="#2141"> 2141: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getLastH() {
</span><span id="2142" class="l"><a href="#2142"> 2142: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;lasth;
</span><span id="2143" class="l"><a href="#2143"> 2143: </a>        }
</span><span id="2144" class="l"><a href="#2144"> 2144: </a>
</span><span id="2145" class="l"><a href="#2145"> 2145: </a>        <span class="php-comment">/**
</span></span><span id="2146" class="l"><a href="#2146"> 2146: </a><span class="php-comment">         * Set the adjusting factor to convert pixels to user units.
</span></span><span id="2147" class="l"><a href="#2147"> 2147: </a><span class="php-comment">         * @param float $scale adjusting factor to convert pixels to user units.
</span></span><span id="2148" class="l"><a href="#2148"> 2148: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2149" class="l"><a href="#2149"> 2149: </a><span class="php-comment">         * @access public
</span></span><span id="2150" class="l"><a href="#2150"> 2150: </a><span class="php-comment">         * @since 1.5.2
</span></span><span id="2151" class="l"><a href="#2151"> 2151: </a><span class="php-comment">         */</span>
</span><span id="2152" class="l"><a href="#2152"> 2152: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setImageScale(<span class="php-var">$scale</span>) {
</span><span id="2153" class="l"><a href="#2153"> 2153: </a>            <span class="php-var">$this</span>-&gt;imgscale = <span class="php-var">$scale</span>;
</span><span id="2154" class="l"><a href="#2154"> 2154: </a>        }
</span><span id="2155" class="l"><a href="#2155"> 2155: </a>
</span><span id="2156" class="l"><a href="#2156"> 2156: </a>        <span class="php-comment">/**
</span></span><span id="2157" class="l"><a href="#2157"> 2157: </a><span class="php-comment">         * Returns the adjusting factor to convert pixels to user units.
</span></span><span id="2158" class="l"><a href="#2158"> 2158: </a><span class="php-comment">         * @return float adjusting factor to convert pixels to user units.
</span></span><span id="2159" class="l"><a href="#2159"> 2159: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2160" class="l"><a href="#2160"> 2160: </a><span class="php-comment">         * @access public
</span></span><span id="2161" class="l"><a href="#2161"> 2161: </a><span class="php-comment">         * @since 1.5.2
</span></span><span id="2162" class="l"><a href="#2162"> 2162: </a><span class="php-comment">         */</span>
</span><span id="2163" class="l"><a href="#2163"> 2163: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getImageScale() {
</span><span id="2164" class="l"><a href="#2164"> 2164: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;imgscale;
</span><span id="2165" class="l"><a href="#2165"> 2165: </a>        }
</span><span id="2166" class="l"><a href="#2166"> 2166: </a>
</span><span id="2167" class="l"><a href="#2167"> 2167: </a>        <span class="php-comment">/**
</span></span><span id="2168" class="l"><a href="#2168"> 2168: </a><span class="php-comment">         * Returns an array of page dimensions:
</span></span><span id="2169" class="l"><a href="#2169"> 2169: </a><span class="php-comment">         * &lt;ul&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['w'] =&gt; page_width_in_points&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['h'] =&gt; height in points&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['wk'] =&gt; page_width_in_points&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['hk'] =&gt; height&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['tm'] =&gt; top_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['bm'] =&gt; bottom_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['lm'] =&gt; left_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['rm'] =&gt; right_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['pb'] =&gt; auto_page_break&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['or'] =&gt; page_orientation&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['olm'] =&gt; original_left_margin&lt;/li&gt;&lt;li&gt;$this-&gt;pagedim[$this-&gt;page]['orm'] =&gt; original_right_margin&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2170" class="l"><a href="#2170"> 2170: </a><span class="php-comment">         * @param int $pagenum page number (empty = current page)
</span></span><span id="2171" class="l"><a href="#2171"> 2171: </a><span class="php-comment">         * @return array of page dimensions.
</span></span><span id="2172" class="l"><a href="#2172"> 2172: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2173" class="l"><a href="#2173"> 2173: </a><span class="php-comment">         * @access public
</span></span><span id="2174" class="l"><a href="#2174"> 2174: </a><span class="php-comment">         * @since 4.5.027 (2009-03-16)
</span></span><span id="2175" class="l"><a href="#2175"> 2175: </a><span class="php-comment">         */</span>
</span><span id="2176" class="l"><a href="#2176"> 2176: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getPageDimensions(<span class="php-var">$pagenum</span>=<span class="php-quote">''</span>) {
</span><span id="2177" class="l"><a href="#2177"> 2177: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$pagenum</span>)) {
</span><span id="2178" class="l"><a href="#2178"> 2178: </a>                <span class="php-var">$pagenum</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="2179" class="l"><a href="#2179"> 2179: </a>            }
</span><span id="2180" class="l"><a href="#2180"> 2180: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$pagenum</span>];
</span><span id="2181" class="l"><a href="#2181"> 2181: </a>        }
</span><span id="2182" class="l"><a href="#2182"> 2182: </a>
</span><span id="2183" class="l"><a href="#2183"> 2183: </a>        <span class="php-comment">/**
</span></span><span id="2184" class="l"><a href="#2184"> 2184: </a><span class="php-comment">         * Returns the page width in units.
</span></span><span id="2185" class="l"><a href="#2185"> 2185: </a><span class="php-comment">         * @param int $pagenum page number (empty = current page)
</span></span><span id="2186" class="l"><a href="#2186"> 2186: </a><span class="php-comment">         * @return int page width.
</span></span><span id="2187" class="l"><a href="#2187"> 2187: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2188" class="l"><a href="#2188"> 2188: </a><span class="php-comment">         * @access public
</span></span><span id="2189" class="l"><a href="#2189"> 2189: </a><span class="php-comment">         * @since 1.5.2
</span></span><span id="2190" class="l"><a href="#2190"> 2190: </a><span class="php-comment">         * @see getPageDimensions()
</span></span><span id="2191" class="l"><a href="#2191"> 2191: </a><span class="php-comment">         */</span>
</span><span id="2192" class="l"><a href="#2192"> 2192: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getPageWidth(<span class="php-var">$pagenum</span>=<span class="php-quote">''</span>) {
</span><span id="2193" class="l"><a href="#2193"> 2193: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$pagenum</span>)) {
</span><span id="2194" class="l"><a href="#2194"> 2194: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;w;
</span><span id="2195" class="l"><a href="#2195"> 2195: </a>            }
</span><span id="2196" class="l"><a href="#2196"> 2196: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$pagenum</span>][<span class="php-quote">'w'</span>];
</span><span id="2197" class="l"><a href="#2197"> 2197: </a>        }
</span><span id="2198" class="l"><a href="#2198"> 2198: </a>
</span><span id="2199" class="l"><a href="#2199"> 2199: </a>        <span class="php-comment">/**
</span></span><span id="2200" class="l"><a href="#2200"> 2200: </a><span class="php-comment">         * Returns the page height in units.
</span></span><span id="2201" class="l"><a href="#2201"> 2201: </a><span class="php-comment">         * @param int $pagenum page number (empty = current page)
</span></span><span id="2202" class="l"><a href="#2202"> 2202: </a><span class="php-comment">         * @return int page height.
</span></span><span id="2203" class="l"><a href="#2203"> 2203: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2204" class="l"><a href="#2204"> 2204: </a><span class="php-comment">         * @access public
</span></span><span id="2205" class="l"><a href="#2205"> 2205: </a><span class="php-comment">         * @since 1.5.2
</span></span><span id="2206" class="l"><a href="#2206"> 2206: </a><span class="php-comment">         * @see getPageDimensions()
</span></span><span id="2207" class="l"><a href="#2207"> 2207: </a><span class="php-comment">         */</span>
</span><span id="2208" class="l"><a href="#2208"> 2208: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getPageHeight(<span class="php-var">$pagenum</span>=<span class="php-quote">''</span>) {
</span><span id="2209" class="l"><a href="#2209"> 2209: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$pagenum</span>)) {
</span><span id="2210" class="l"><a href="#2210"> 2210: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;h;
</span><span id="2211" class="l"><a href="#2211"> 2211: </a>            }
</span><span id="2212" class="l"><a href="#2212"> 2212: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$pagenum</span>][<span class="php-quote">'h'</span>];
</span><span id="2213" class="l"><a href="#2213"> 2213: </a>        }
</span><span id="2214" class="l"><a href="#2214"> 2214: </a>
</span><span id="2215" class="l"><a href="#2215"> 2215: </a>        <span class="php-comment">/**
</span></span><span id="2216" class="l"><a href="#2216"> 2216: </a><span class="php-comment">         * Returns the page break margin.
</span></span><span id="2217" class="l"><a href="#2217"> 2217: </a><span class="php-comment">         * @param int $pagenum page number (empty = current page)
</span></span><span id="2218" class="l"><a href="#2218"> 2218: </a><span class="php-comment">         * @return int page break margin.
</span></span><span id="2219" class="l"><a href="#2219"> 2219: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2220" class="l"><a href="#2220"> 2220: </a><span class="php-comment">         * @access public
</span></span><span id="2221" class="l"><a href="#2221"> 2221: </a><span class="php-comment">         * @since 1.5.2
</span></span><span id="2222" class="l"><a href="#2222"> 2222: </a><span class="php-comment">         * @see getPageDimensions()
</span></span><span id="2223" class="l"><a href="#2223"> 2223: </a><span class="php-comment">         */</span>
</span><span id="2224" class="l"><a href="#2224"> 2224: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getBreakMargin(<span class="php-var">$pagenum</span>=<span class="php-quote">''</span>) {
</span><span id="2225" class="l"><a href="#2225"> 2225: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$pagenum</span>)) {
</span><span id="2226" class="l"><a href="#2226"> 2226: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;bMargin;
</span><span id="2227" class="l"><a href="#2227"> 2227: </a>            }
</span><span id="2228" class="l"><a href="#2228"> 2228: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$pagenum</span>][<span class="php-quote">'bm'</span>];
</span><span id="2229" class="l"><a href="#2229"> 2229: </a>        }
</span><span id="2230" class="l"><a href="#2230"> 2230: </a>
</span><span id="2231" class="l"><a href="#2231"> 2231: </a>        <span class="php-comment">/**
</span></span><span id="2232" class="l"><a href="#2232"> 2232: </a><span class="php-comment">         * Returns the scale factor (number of points in user unit).
</span></span><span id="2233" class="l"><a href="#2233"> 2233: </a><span class="php-comment">         * @return int scale factor.
</span></span><span id="2234" class="l"><a href="#2234"> 2234: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="2235" class="l"><a href="#2235"> 2235: </a><span class="php-comment">         * @access public
</span></span><span id="2236" class="l"><a href="#2236"> 2236: </a><span class="php-comment">         * @since 1.5.2
</span></span><span id="2237" class="l"><a href="#2237"> 2237: </a><span class="php-comment">         */</span>
</span><span id="2238" class="l"><a href="#2238"> 2238: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getScaleFactor() {
</span><span id="2239" class="l"><a href="#2239"> 2239: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;k;
</span><span id="2240" class="l"><a href="#2240"> 2240: </a>        }
</span><span id="2241" class="l"><a href="#2241"> 2241: </a>
</span><span id="2242" class="l"><a href="#2242"> 2242: </a>        <span class="php-comment">/**
</span></span><span id="2243" class="l"><a href="#2243"> 2243: </a><span class="php-comment">         * Defines the left, top and right margins.
</span></span><span id="2244" class="l"><a href="#2244"> 2244: </a><span class="php-comment">         * @param float $left Left margin.
</span></span><span id="2245" class="l"><a href="#2245"> 2245: </a><span class="php-comment">         * @param float $top Top margin.
</span></span><span id="2246" class="l"><a href="#2246"> 2246: </a><span class="php-comment">         * @param float $right Right margin. Default value is the left one.
</span></span><span id="2247" class="l"><a href="#2247"> 2247: </a><span class="php-comment">         * @param boolean $keepmargins if true overwrites the default page margins
</span></span><span id="2248" class="l"><a href="#2248"> 2248: </a><span class="php-comment">         * @access public
</span></span><span id="2249" class="l"><a href="#2249"> 2249: </a><span class="php-comment">         * @since 1.0
</span></span><span id="2250" class="l"><a href="#2250"> 2250: </a><span class="php-comment">         * @see SetLeftMargin(), SetTopMargin(), SetRightMargin(), SetAutoPageBreak()
</span></span><span id="2251" class="l"><a href="#2251"> 2251: </a><span class="php-comment">         */</span>
</span><span id="2252" class="l"><a href="#2252"> 2252: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetMargins(<span class="php-var">$left</span>, <span class="php-var">$top</span>, <span class="php-var">$right</span>=-<span class="php-num">1</span>, <span class="php-var">$keepmargins</span>=<span class="php-keyword1">false</span>) {
</span><span id="2253" class="l"><a href="#2253"> 2253: </a>            <span class="php-comment">//Set left, top and right margins</span>
</span><span id="2254" class="l"><a href="#2254"> 2254: </a>            <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$left</span>;
</span><span id="2255" class="l"><a href="#2255"> 2255: </a>            <span class="php-var">$this</span>-&gt;tMargin = <span class="php-var">$top</span>;
</span><span id="2256" class="l"><a href="#2256"> 2256: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$right</span> == -<span class="php-num">1</span>) {
</span><span id="2257" class="l"><a href="#2257"> 2257: </a>                <span class="php-var">$right</span> = <span class="php-var">$left</span>;
</span><span id="2258" class="l"><a href="#2258"> 2258: </a>            }
</span><span id="2259" class="l"><a href="#2259"> 2259: </a>            <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$right</span>;
</span><span id="2260" class="l"><a href="#2260"> 2260: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$keepmargins</span>) {
</span><span id="2261" class="l"><a href="#2261"> 2261: </a>                <span class="php-comment">// overwrite original values</span>
</span><span id="2262" class="l"><a href="#2262"> 2262: </a>                <span class="php-var">$this</span>-&gt;original_lMargin = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="2263" class="l"><a href="#2263"> 2263: </a>                <span class="php-var">$this</span>-&gt;original_rMargin = <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="2264" class="l"><a href="#2264"> 2264: </a>            }
</span><span id="2265" class="l"><a href="#2265"> 2265: </a>        }
</span><span id="2266" class="l"><a href="#2266"> 2266: </a>
</span><span id="2267" class="l"><a href="#2267"> 2267: </a>        <span class="php-comment">/**
</span></span><span id="2268" class="l"><a href="#2268"> 2268: </a><span class="php-comment">         * Defines the left margin. The method can be called before creating the first page. If the current abscissa gets out of page, it is brought back to the margin.
</span></span><span id="2269" class="l"><a href="#2269"> 2269: </a><span class="php-comment">         * @param float $margin The margin.
</span></span><span id="2270" class="l"><a href="#2270"> 2270: </a><span class="php-comment">         * @access public
</span></span><span id="2271" class="l"><a href="#2271"> 2271: </a><span class="php-comment">         * @since 1.4
</span></span><span id="2272" class="l"><a href="#2272"> 2272: </a><span class="php-comment">         * @see SetTopMargin(), SetRightMargin(), SetAutoPageBreak(), SetMargins()
</span></span><span id="2273" class="l"><a href="#2273"> 2273: </a><span class="php-comment">         */</span>
</span><span id="2274" class="l"><a href="#2274"> 2274: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetLeftMargin(<span class="php-var">$margin</span>) {
</span><span id="2275" class="l"><a href="#2275"> 2275: </a>            <span class="php-comment">//Set left margin</span>
</span><span id="2276" class="l"><a href="#2276"> 2276: </a>            <span class="php-var">$this</span>-&gt;lMargin=<span class="php-var">$margin</span>;
</span><span id="2277" class="l"><a href="#2277"> 2277: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;x &lt; <span class="php-var">$margin</span>)) {
</span><span id="2278" class="l"><a href="#2278"> 2278: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$margin</span>;
</span><span id="2279" class="l"><a href="#2279"> 2279: </a>            }
</span><span id="2280" class="l"><a href="#2280"> 2280: </a>        }
</span><span id="2281" class="l"><a href="#2281"> 2281: </a>
</span><span id="2282" class="l"><a href="#2282"> 2282: </a>        <span class="php-comment">/**
</span></span><span id="2283" class="l"><a href="#2283"> 2283: </a><span class="php-comment">         * Defines the top margin. The method can be called before creating the first page.
</span></span><span id="2284" class="l"><a href="#2284"> 2284: </a><span class="php-comment">         * @param float $margin The margin.
</span></span><span id="2285" class="l"><a href="#2285"> 2285: </a><span class="php-comment">         * @access public
</span></span><span id="2286" class="l"><a href="#2286"> 2286: </a><span class="php-comment">         * @since 1.5
</span></span><span id="2287" class="l"><a href="#2287"> 2287: </a><span class="php-comment">         * @see SetLeftMargin(), SetRightMargin(), SetAutoPageBreak(), SetMargins()
</span></span><span id="2288" class="l"><a href="#2288"> 2288: </a><span class="php-comment">         */</span>
</span><span id="2289" class="l"><a href="#2289"> 2289: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetTopMargin(<span class="php-var">$margin</span>) {
</span><span id="2290" class="l"><a href="#2290"> 2290: </a>            <span class="php-comment">//Set top margin</span>
</span><span id="2291" class="l"><a href="#2291"> 2291: </a>            <span class="php-var">$this</span>-&gt;tMargin=<span class="php-var">$margin</span>;
</span><span id="2292" class="l"><a href="#2292"> 2292: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$margin</span>)) {
</span><span id="2293" class="l"><a href="#2293"> 2293: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$margin</span>;
</span><span id="2294" class="l"><a href="#2294"> 2294: </a>            }
</span><span id="2295" class="l"><a href="#2295"> 2295: </a>        }
</span><span id="2296" class="l"><a href="#2296"> 2296: </a>
</span><span id="2297" class="l"><a href="#2297"> 2297: </a>        <span class="php-comment">/**
</span></span><span id="2298" class="l"><a href="#2298"> 2298: </a><span class="php-comment">         * Defines the right margin. The method can be called before creating the first page.
</span></span><span id="2299" class="l"><a href="#2299"> 2299: </a><span class="php-comment">         * @param float $margin The margin.
</span></span><span id="2300" class="l"><a href="#2300"> 2300: </a><span class="php-comment">         * @access public
</span></span><span id="2301" class="l"><a href="#2301"> 2301: </a><span class="php-comment">         * @since 1.5
</span></span><span id="2302" class="l"><a href="#2302"> 2302: </a><span class="php-comment">         * @see SetLeftMargin(), SetTopMargin(), SetAutoPageBreak(), SetMargins()
</span></span><span id="2303" class="l"><a href="#2303"> 2303: </a><span class="php-comment">         */</span>
</span><span id="2304" class="l"><a href="#2304"> 2304: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetRightMargin(<span class="php-var">$margin</span>) {
</span><span id="2305" class="l"><a href="#2305"> 2305: </a>            <span class="php-var">$this</span>-&gt;rMargin=<span class="php-var">$margin</span>;
</span><span id="2306" class="l"><a href="#2306"> 2306: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;x &gt; (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$margin</span>))) {
</span><span id="2307" class="l"><a href="#2307"> 2307: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$margin</span>;
</span><span id="2308" class="l"><a href="#2308"> 2308: </a>            }
</span><span id="2309" class="l"><a href="#2309"> 2309: </a>        }
</span><span id="2310" class="l"><a href="#2310"> 2310: </a>
</span><span id="2311" class="l"><a href="#2311"> 2311: </a>        <span class="php-comment">/**
</span></span><span id="2312" class="l"><a href="#2312"> 2312: </a><span class="php-comment">         * Set the internal Cell padding.
</span></span><span id="2313" class="l"><a href="#2313"> 2313: </a><span class="php-comment">         * @param float $pad internal padding.
</span></span><span id="2314" class="l"><a href="#2314"> 2314: </a><span class="php-comment">         * @access public
</span></span><span id="2315" class="l"><a href="#2315"> 2315: </a><span class="php-comment">         * @since 2.1.000 (2008-01-09)
</span></span><span id="2316" class="l"><a href="#2316"> 2316: </a><span class="php-comment">         * @see Cell(), SetLeftMargin(), SetTopMargin(), SetAutoPageBreak(), SetMargins()
</span></span><span id="2317" class="l"><a href="#2317"> 2317: </a><span class="php-comment">         */</span>
</span><span id="2318" class="l"><a href="#2318"> 2318: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetCellPadding(<span class="php-var">$pad</span>) {
</span><span id="2319" class="l"><a href="#2319"> 2319: </a>            <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$pad</span>;
</span><span id="2320" class="l"><a href="#2320"> 2320: </a>        }
</span><span id="2321" class="l"><a href="#2321"> 2321: </a>
</span><span id="2322" class="l"><a href="#2322"> 2322: </a>        <span class="php-comment">/**
</span></span><span id="2323" class="l"><a href="#2323"> 2323: </a><span class="php-comment">         * Enables or disables the automatic page breaking mode. When enabling, the second parameter is the distance from the bottom of the page that defines the triggering limit. By default, the mode is on and the margin is 2 cm.
</span></span><span id="2324" class="l"><a href="#2324"> 2324: </a><span class="php-comment">         * @param boolean $auto Boolean indicating if mode should be on or off.
</span></span><span id="2325" class="l"><a href="#2325"> 2325: </a><span class="php-comment">         * @param float $margin Distance from the bottom of the page.
</span></span><span id="2326" class="l"><a href="#2326"> 2326: </a><span class="php-comment">         * @access public
</span></span><span id="2327" class="l"><a href="#2327"> 2327: </a><span class="php-comment">         * @since 1.0
</span></span><span id="2328" class="l"><a href="#2328"> 2328: </a><span class="php-comment">         * @see Cell(), MultiCell(), AcceptPageBreak()
</span></span><span id="2329" class="l"><a href="#2329"> 2329: </a><span class="php-comment">         */</span>
</span><span id="2330" class="l"><a href="#2330"> 2330: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetAutoPageBreak(<span class="php-var">$auto</span>, <span class="php-var">$margin</span>=<span class="php-num">0</span>) {
</span><span id="2331" class="l"><a href="#2331"> 2331: </a>            <span class="php-comment">//Set auto page break mode and triggering margin</span>
</span><span id="2332" class="l"><a href="#2332"> 2332: </a>            <span class="php-var">$this</span>-&gt;AutoPageBreak = <span class="php-var">$auto</span>;
</span><span id="2333" class="l"><a href="#2333"> 2333: </a>            <span class="php-var">$this</span>-&gt;bMargin = <span class="php-var">$margin</span>;
</span><span id="2334" class="l"><a href="#2334"> 2334: </a>            <span class="php-var">$this</span>-&gt;PageBreakTrigger = <span class="php-var">$this</span>-&gt;h - <span class="php-var">$margin</span>;
</span><span id="2335" class="l"><a href="#2335"> 2335: </a>        }
</span><span id="2336" class="l"><a href="#2336"> 2336: </a>
</span><span id="2337" class="l"><a href="#2337"> 2337: </a>        <span class="php-comment">/**
</span></span><span id="2338" class="l"><a href="#2338"> 2338: </a><span class="php-comment">         * Defines the way the document is to be displayed by the viewer.
</span></span><span id="2339" class="l"><a href="#2339"> 2339: </a><span class="php-comment">         * @param mixed $zoom The zoom to use. It can be one of the following string values or a number indicating the zooming factor to use. &lt;ul&gt;&lt;li&gt;fullpage: displays the entire page on screen &lt;/li&gt;&lt;li&gt;fullwidth: uses maximum width of window&lt;/li&gt;&lt;li&gt;real: uses real size (equivalent to 100% zoom)&lt;/li&gt;&lt;li&gt;default: uses viewer default mode&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2340" class="l"><a href="#2340"> 2340: </a><span class="php-comment">         * @param string $layout The page layout. Possible values are:&lt;ul&gt;&lt;li&gt;SinglePage Display one page at a time&lt;/li&gt;&lt;li&gt;OneColumn Display the pages in one column&lt;/li&gt;&lt;li&gt;TwoColumnLeft Display the pages in two columns, with odd-numbered pages on the left&lt;/li&gt;&lt;li&gt;TwoColumnRight Display the pages in two columns, with odd-numbered pages on the right&lt;/li&gt;&lt;li&gt;TwoPageLeft (PDF 1.5) Display the pages two at a time, with odd-numbered pages on the left&lt;/li&gt;&lt;li&gt;TwoPageRight (PDF 1.5) Display the pages two at a time, with odd-numbered pages on the right&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2341" class="l"><a href="#2341"> 2341: </a><span class="php-comment">         * @param string $mode A name object specifying how the document should be displayed when opened:&lt;ul&gt;&lt;li&gt;UseNone Neither document outline nor thumbnail images visible&lt;/li&gt;&lt;li&gt;UseOutlines Document outline visible&lt;/li&gt;&lt;li&gt;UseThumbs Thumbnail images visible&lt;/li&gt;&lt;li&gt;FullScreen Full-screen mode, with no menu bar, window controls, or any other window visible&lt;/li&gt;&lt;li&gt;UseOC (PDF 1.5) Optional content group panel visible&lt;/li&gt;&lt;li&gt;UseAttachments (PDF 1.6) Attachments panel visible&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2342" class="l"><a href="#2342"> 2342: </a><span class="php-comment">         * @access public
</span></span><span id="2343" class="l"><a href="#2343"> 2343: </a><span class="php-comment">         * @since 1.2
</span></span><span id="2344" class="l"><a href="#2344"> 2344: </a><span class="php-comment">         */</span>
</span><span id="2345" class="l"><a href="#2345"> 2345: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetDisplayMode(<span class="php-var">$zoom</span>, <span class="php-var">$layout</span>=<span class="php-quote">'SinglePage'</span>, <span class="php-var">$mode</span>=<span class="php-quote">'UseNone'</span>) {
</span><span id="2346" class="l"><a href="#2346"> 2346: </a>            <span class="php-comment">//Set display mode in viewer</span>
</span><span id="2347" class="l"><a href="#2347"> 2347: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$zoom</span> == <span class="php-quote">'fullpage'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$zoom</span> == <span class="php-quote">'fullwidth'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$zoom</span> == <span class="php-quote">'real'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$zoom</span> == <span class="php-quote">'default'</span>) <span class="php-keyword1">OR</span> (!<span class="php-keyword2">is_string</span>(<span class="php-var">$zoom</span>))) {
</span><span id="2348" class="l"><a href="#2348"> 2348: </a>                <span class="php-var">$this</span>-&gt;ZoomMode = <span class="php-var">$zoom</span>;
</span><span id="2349" class="l"><a href="#2349"> 2349: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2350" class="l"><a href="#2350"> 2350: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Incorrect zoom display mode: '</span>.<span class="php-var">$zoom</span>);
</span><span id="2351" class="l"><a href="#2351"> 2351: </a>            }
</span><span id="2352" class="l"><a href="#2352"> 2352: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$layout</span>) {
</span><span id="2353" class="l"><a href="#2353"> 2353: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'default'</span>:
</span><span id="2354" class="l"><a href="#2354"> 2354: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'single'</span>:
</span><span id="2355" class="l"><a href="#2355"> 2355: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'SinglePage'</span>: {
</span><span id="2356" class="l"><a href="#2356"> 2356: </a>                    <span class="php-var">$this</span>-&gt;LayoutMode = <span class="php-quote">'SinglePage'</span>;
</span><span id="2357" class="l"><a href="#2357"> 2357: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2358" class="l"><a href="#2358"> 2358: </a>                }
</span><span id="2359" class="l"><a href="#2359"> 2359: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'continuous'</span>:
</span><span id="2360" class="l"><a href="#2360"> 2360: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'OneColumn'</span>: {
</span><span id="2361" class="l"><a href="#2361"> 2361: </a>                    <span class="php-var">$this</span>-&gt;LayoutMode = <span class="php-quote">'OneColumn'</span>;
</span><span id="2362" class="l"><a href="#2362"> 2362: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2363" class="l"><a href="#2363"> 2363: </a>                }
</span><span id="2364" class="l"><a href="#2364"> 2364: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'two'</span>:
</span><span id="2365" class="l"><a href="#2365"> 2365: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'TwoColumnLeft'</span>: {
</span><span id="2366" class="l"><a href="#2366"> 2366: </a>                    <span class="php-var">$this</span>-&gt;LayoutMode = <span class="php-quote">'TwoColumnLeft'</span>;
</span><span id="2367" class="l"><a href="#2367"> 2367: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2368" class="l"><a href="#2368"> 2368: </a>                }
</span><span id="2369" class="l"><a href="#2369"> 2369: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'TwoColumnRight'</span>: {
</span><span id="2370" class="l"><a href="#2370"> 2370: </a>                    <span class="php-var">$this</span>-&gt;LayoutMode = <span class="php-quote">'TwoColumnRight'</span>;
</span><span id="2371" class="l"><a href="#2371"> 2371: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2372" class="l"><a href="#2372"> 2372: </a>                }
</span><span id="2373" class="l"><a href="#2373"> 2373: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'TwoPageLeft'</span>: {
</span><span id="2374" class="l"><a href="#2374"> 2374: </a>                    <span class="php-var">$this</span>-&gt;LayoutMode = <span class="php-quote">'TwoPageLeft'</span>;
</span><span id="2375" class="l"><a href="#2375"> 2375: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2376" class="l"><a href="#2376"> 2376: </a>                }
</span><span id="2377" class="l"><a href="#2377"> 2377: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'TwoPageRight'</span>: {
</span><span id="2378" class="l"><a href="#2378"> 2378: </a>                    <span class="php-var">$this</span>-&gt;LayoutMode = <span class="php-quote">'TwoPageRight'</span>;
</span><span id="2379" class="l"><a href="#2379"> 2379: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2380" class="l"><a href="#2380"> 2380: </a>                }
</span><span id="2381" class="l"><a href="#2381"> 2381: </a>                <span class="php-keyword1">default</span>: {
</span><span id="2382" class="l"><a href="#2382"> 2382: </a>                    <span class="php-var">$this</span>-&gt;LayoutMode = <span class="php-quote">'SinglePage'</span>;
</span><span id="2383" class="l"><a href="#2383"> 2383: </a>                }
</span><span id="2384" class="l"><a href="#2384"> 2384: </a>            }
</span><span id="2385" class="l"><a href="#2385"> 2385: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$mode</span>) {
</span><span id="2386" class="l"><a href="#2386"> 2386: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'UseNone'</span>: {
</span><span id="2387" class="l"><a href="#2387"> 2387: </a>                    <span class="php-var">$this</span>-&gt;PageMode = <span class="php-quote">'UseNone'</span>;
</span><span id="2388" class="l"><a href="#2388"> 2388: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2389" class="l"><a href="#2389"> 2389: </a>                }
</span><span id="2390" class="l"><a href="#2390"> 2390: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'UseOutlines'</span>: {
</span><span id="2391" class="l"><a href="#2391"> 2391: </a>                    <span class="php-var">$this</span>-&gt;PageMode = <span class="php-quote">'UseOutlines'</span>;
</span><span id="2392" class="l"><a href="#2392"> 2392: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2393" class="l"><a href="#2393"> 2393: </a>                }
</span><span id="2394" class="l"><a href="#2394"> 2394: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'UseThumbs'</span>: {
</span><span id="2395" class="l"><a href="#2395"> 2395: </a>                    <span class="php-var">$this</span>-&gt;PageMode = <span class="php-quote">'UseThumbs'</span>;
</span><span id="2396" class="l"><a href="#2396"> 2396: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2397" class="l"><a href="#2397"> 2397: </a>                }
</span><span id="2398" class="l"><a href="#2398"> 2398: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'FullScreen'</span>: {
</span><span id="2399" class="l"><a href="#2399"> 2399: </a>                    <span class="php-var">$this</span>-&gt;PageMode = <span class="php-quote">'FullScreen'</span>;
</span><span id="2400" class="l"><a href="#2400"> 2400: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2401" class="l"><a href="#2401"> 2401: </a>                }
</span><span id="2402" class="l"><a href="#2402"> 2402: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'UseOC'</span>: {
</span><span id="2403" class="l"><a href="#2403"> 2403: </a>                    <span class="php-var">$this</span>-&gt;PageMode = <span class="php-quote">'UseOC'</span>;
</span><span id="2404" class="l"><a href="#2404"> 2404: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2405" class="l"><a href="#2405"> 2405: </a>                }
</span><span id="2406" class="l"><a href="#2406"> 2406: </a>                <span class="php-keyword1">case</span> <span class="php-quote">''</span>: {
</span><span id="2407" class="l"><a href="#2407"> 2407: </a>                    <span class="php-var">$this</span>-&gt;PageMode = <span class="php-quote">'UseAttachments'</span>;
</span><span id="2408" class="l"><a href="#2408"> 2408: </a>                    <span class="php-keyword1">break</span>;
</span><span id="2409" class="l"><a href="#2409"> 2409: </a>                }
</span><span id="2410" class="l"><a href="#2410"> 2410: </a>                <span class="php-keyword1">default</span>: {
</span><span id="2411" class="l"><a href="#2411"> 2411: </a>                    <span class="php-var">$this</span>-&gt;PageMode = <span class="php-quote">'UseNone'</span>;
</span><span id="2412" class="l"><a href="#2412"> 2412: </a>                }
</span><span id="2413" class="l"><a href="#2413"> 2413: </a>            }
</span><span id="2414" class="l"><a href="#2414"> 2414: </a>        }
</span><span id="2415" class="l"><a href="#2415"> 2415: </a>
</span><span id="2416" class="l"><a href="#2416"> 2416: </a>        <span class="php-comment">/**
</span></span><span id="2417" class="l"><a href="#2417"> 2417: </a><span class="php-comment">         * Activates or deactivates page compression. When activated, the internal representation of each page is compressed, which leads to a compression ratio of about 2 for the resulting document. Compression is on by default.
</span></span><span id="2418" class="l"><a href="#2418"> 2418: </a><span class="php-comment">         * Note: the Zlib extension is required for this feature. If not present, compression will be turned off.
</span></span><span id="2419" class="l"><a href="#2419"> 2419: </a><span class="php-comment">         * @param boolean $compress Boolean indicating if compression must be enabled.
</span></span><span id="2420" class="l"><a href="#2420"> 2420: </a><span class="php-comment">         * @access public
</span></span><span id="2421" class="l"><a href="#2421"> 2421: </a><span class="php-comment">         * @since 1.4
</span></span><span id="2422" class="l"><a href="#2422"> 2422: </a><span class="php-comment">         */</span>
</span><span id="2423" class="l"><a href="#2423"> 2423: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetCompression(<span class="php-var">$compress</span>) {
</span><span id="2424" class="l"><a href="#2424"> 2424: </a>            <span class="php-comment">//Set page compression</span>
</span><span id="2425" class="l"><a href="#2425"> 2425: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">function_exists</span>(<span class="php-quote">'gzcompress'</span>)) {
</span><span id="2426" class="l"><a href="#2426"> 2426: </a>                <span class="php-var">$this</span>-&gt;compress = <span class="php-var">$compress</span>;
</span><span id="2427" class="l"><a href="#2427"> 2427: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2428" class="l"><a href="#2428"> 2428: </a>                <span class="php-var">$this</span>-&gt;compress = <span class="php-keyword1">false</span>;
</span><span id="2429" class="l"><a href="#2429"> 2429: </a>            }
</span><span id="2430" class="l"><a href="#2430"> 2430: </a>        }
</span><span id="2431" class="l"><a href="#2431"> 2431: </a>
</span><span id="2432" class="l"><a href="#2432"> 2432: </a>        <span class="php-comment">/**
</span></span><span id="2433" class="l"><a href="#2433"> 2433: </a><span class="php-comment">         * Defines the title of the document.
</span></span><span id="2434" class="l"><a href="#2434"> 2434: </a><span class="php-comment">         * @param string $title The title.
</span></span><span id="2435" class="l"><a href="#2435"> 2435: </a><span class="php-comment">         * @access public
</span></span><span id="2436" class="l"><a href="#2436"> 2436: </a><span class="php-comment">         * @since 1.2
</span></span><span id="2437" class="l"><a href="#2437"> 2437: </a><span class="php-comment">         * @see SetAuthor(), SetCreator(), SetKeywords(), SetSubject()
</span></span><span id="2438" class="l"><a href="#2438"> 2438: </a><span class="php-comment">         */</span>
</span><span id="2439" class="l"><a href="#2439"> 2439: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetTitle(<span class="php-var">$title</span>) {
</span><span id="2440" class="l"><a href="#2440"> 2440: </a>            <span class="php-comment">//Title of document</span>
</span><span id="2441" class="l"><a href="#2441"> 2441: </a>            <span class="php-var">$this</span>-&gt;title = <span class="php-var">$title</span>;
</span><span id="2442" class="l"><a href="#2442"> 2442: </a>        }
</span><span id="2443" class="l"><a href="#2443"> 2443: </a>
</span><span id="2444" class="l"><a href="#2444"> 2444: </a>        <span class="php-comment">/**
</span></span><span id="2445" class="l"><a href="#2445"> 2445: </a><span class="php-comment">         * Defines the subject of the document.
</span></span><span id="2446" class="l"><a href="#2446"> 2446: </a><span class="php-comment">         * @param string $subject The subject.
</span></span><span id="2447" class="l"><a href="#2447"> 2447: </a><span class="php-comment">         * @access public
</span></span><span id="2448" class="l"><a href="#2448"> 2448: </a><span class="php-comment">         * @since 1.2
</span></span><span id="2449" class="l"><a href="#2449"> 2449: </a><span class="php-comment">         * @see SetAuthor(), SetCreator(), SetKeywords(), SetTitle()
</span></span><span id="2450" class="l"><a href="#2450"> 2450: </a><span class="php-comment">         */</span>
</span><span id="2451" class="l"><a href="#2451"> 2451: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetSubject(<span class="php-var">$subject</span>) {
</span><span id="2452" class="l"><a href="#2452"> 2452: </a>            <span class="php-comment">//Subject of document</span>
</span><span id="2453" class="l"><a href="#2453"> 2453: </a>            <span class="php-var">$this</span>-&gt;subject = <span class="php-var">$subject</span>;
</span><span id="2454" class="l"><a href="#2454"> 2454: </a>        }
</span><span id="2455" class="l"><a href="#2455"> 2455: </a>
</span><span id="2456" class="l"><a href="#2456"> 2456: </a>        <span class="php-comment">/**
</span></span><span id="2457" class="l"><a href="#2457"> 2457: </a><span class="php-comment">         * Defines the author of the document.
</span></span><span id="2458" class="l"><a href="#2458"> 2458: </a><span class="php-comment">         * @param string $author The name of the author.
</span></span><span id="2459" class="l"><a href="#2459"> 2459: </a><span class="php-comment">         * @access public
</span></span><span id="2460" class="l"><a href="#2460"> 2460: </a><span class="php-comment">         * @since 1.2
</span></span><span id="2461" class="l"><a href="#2461"> 2461: </a><span class="php-comment">         * @see SetCreator(), SetKeywords(), SetSubject(), SetTitle()
</span></span><span id="2462" class="l"><a href="#2462"> 2462: </a><span class="php-comment">         */</span>
</span><span id="2463" class="l"><a href="#2463"> 2463: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetAuthor(<span class="php-var">$author</span>) {
</span><span id="2464" class="l"><a href="#2464"> 2464: </a>            <span class="php-comment">//Author of document</span>
</span><span id="2465" class="l"><a href="#2465"> 2465: </a>            <span class="php-var">$this</span>-&gt;author = <span class="php-var">$author</span>;
</span><span id="2466" class="l"><a href="#2466"> 2466: </a>        }
</span><span id="2467" class="l"><a href="#2467"> 2467: </a>
</span><span id="2468" class="l"><a href="#2468"> 2468: </a>        <span class="php-comment">/**
</span></span><span id="2469" class="l"><a href="#2469"> 2469: </a><span class="php-comment">         * Associates keywords with the document, generally in the form 'keyword1 keyword2 ...'.
</span></span><span id="2470" class="l"><a href="#2470"> 2470: </a><span class="php-comment">         * @param string $keywords The list of keywords.
</span></span><span id="2471" class="l"><a href="#2471"> 2471: </a><span class="php-comment">         * @access public
</span></span><span id="2472" class="l"><a href="#2472"> 2472: </a><span class="php-comment">         * @since 1.2
</span></span><span id="2473" class="l"><a href="#2473"> 2473: </a><span class="php-comment">         * @see SetAuthor(), SetCreator(), SetSubject(), SetTitle()
</span></span><span id="2474" class="l"><a href="#2474"> 2474: </a><span class="php-comment">         */</span>
</span><span id="2475" class="l"><a href="#2475"> 2475: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetKeywords(<span class="php-var">$keywords</span>) {
</span><span id="2476" class="l"><a href="#2476"> 2476: </a>            <span class="php-comment">//Keywords of document</span>
</span><span id="2477" class="l"><a href="#2477"> 2477: </a>            <span class="php-var">$this</span>-&gt;keywords = <span class="php-var">$keywords</span>;
</span><span id="2478" class="l"><a href="#2478"> 2478: </a>        }
</span><span id="2479" class="l"><a href="#2479"> 2479: </a>
</span><span id="2480" class="l"><a href="#2480"> 2480: </a>        <span class="php-comment">/**
</span></span><span id="2481" class="l"><a href="#2481"> 2481: </a><span class="php-comment">         * Defines the creator of the document. This is typically the name of the application that generates the PDF.
</span></span><span id="2482" class="l"><a href="#2482"> 2482: </a><span class="php-comment">         * @param string $creator The name of the creator.
</span></span><span id="2483" class="l"><a href="#2483"> 2483: </a><span class="php-comment">         * @access public
</span></span><span id="2484" class="l"><a href="#2484"> 2484: </a><span class="php-comment">         * @since 1.2
</span></span><span id="2485" class="l"><a href="#2485"> 2485: </a><span class="php-comment">         * @see SetAuthor(), SetKeywords(), SetSubject(), SetTitle()
</span></span><span id="2486" class="l"><a href="#2486"> 2486: </a><span class="php-comment">         */</span>
</span><span id="2487" class="l"><a href="#2487"> 2487: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetCreator(<span class="php-var">$creator</span>) {
</span><span id="2488" class="l"><a href="#2488"> 2488: </a>            <span class="php-comment">//Creator of document</span>
</span><span id="2489" class="l"><a href="#2489"> 2489: </a>            <span class="php-var">$this</span>-&gt;creator = <span class="php-var">$creator</span>;
</span><span id="2490" class="l"><a href="#2490"> 2490: </a>        }
</span><span id="2491" class="l"><a href="#2491"> 2491: </a>
</span><span id="2492" class="l"><a href="#2492"> 2492: </a>        <span class="php-comment">/**
</span></span><span id="2493" class="l"><a href="#2493"> 2493: </a><span class="php-comment">         * This method is automatically called in case of fatal error; it simply outputs the message and halts the execution. An inherited class may override it to customize the error handling but should always halt the script, or the resulting document would probably be invalid.
</span></span><span id="2494" class="l"><a href="#2494"> 2494: </a><span class="php-comment">         * 2004-06-11 :: Nicola Asuni : changed bold tag with strong
</span></span><span id="2495" class="l"><a href="#2495"> 2495: </a><span class="php-comment">         * @param string $msg The error message
</span></span><span id="2496" class="l"><a href="#2496"> 2496: </a><span class="php-comment">         * @access public
</span></span><span id="2497" class="l"><a href="#2497"> 2497: </a><span class="php-comment">         * @since 1.0
</span></span><span id="2498" class="l"><a href="#2498"> 2498: </a><span class="php-comment">         */</span>
</span><span id="2499" class="l"><a href="#2499"> 2499: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Error(<span class="php-var">$msg</span>) {
</span><span id="2500" class="l"><a href="#2500"> 2500: </a>            <span class="php-comment">// unset all class variables</span>
</span><span id="2501" class="l"><a href="#2501"> 2501: </a>            <span class="php-var">$this</span>-&gt;_destroy(<span class="php-keyword1">true</span>);
</span><span id="2502" class="l"><a href="#2502"> 2502: </a>            <span class="php-comment">// exit program and print error</span>
</span><span id="2503" class="l"><a href="#2503"> 2503: </a>            <span class="php-keyword1">die</span>(<span class="php-quote">'&lt;strong&gt;TCPDF ERROR: &lt;/strong&gt;'</span>.<span class="php-var">$msg</span>);
</span><span id="2504" class="l"><a href="#2504"> 2504: </a>        }
</span><span id="2505" class="l"><a href="#2505"> 2505: </a>
</span><span id="2506" class="l"><a href="#2506"> 2506: </a>        <span class="php-comment">/**
</span></span><span id="2507" class="l"><a href="#2507"> 2507: </a><span class="php-comment">         * This method begins the generation of the PDF document.
</span></span><span id="2508" class="l"><a href="#2508"> 2508: </a><span class="php-comment">         * It is not necessary to call it explicitly because AddPage() does it automatically.
</span></span><span id="2509" class="l"><a href="#2509"> 2509: </a><span class="php-comment">         * Note: no page is created by this method
</span></span><span id="2510" class="l"><a href="#2510"> 2510: </a><span class="php-comment">         * @access public
</span></span><span id="2511" class="l"><a href="#2511"> 2511: </a><span class="php-comment">         * @since 1.0
</span></span><span id="2512" class="l"><a href="#2512"> 2512: </a><span class="php-comment">         * @see AddPage(), Close()
</span></span><span id="2513" class="l"><a href="#2513"> 2513: </a><span class="php-comment">         */</span>
</span><span id="2514" class="l"><a href="#2514"> 2514: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Open() {
</span><span id="2515" class="l"><a href="#2515"> 2515: </a>            <span class="php-comment">//Begin document</span>
</span><span id="2516" class="l"><a href="#2516"> 2516: </a>            <span class="php-var">$this</span>-&gt;state = <span class="php-num">1</span>;
</span><span id="2517" class="l"><a href="#2517"> 2517: </a>        }
</span><span id="2518" class="l"><a href="#2518"> 2518: </a>
</span><span id="2519" class="l"><a href="#2519"> 2519: </a>        <span class="php-comment">/**
</span></span><span id="2520" class="l"><a href="#2520"> 2520: </a><span class="php-comment">         * Terminates the PDF document.
</span></span><span id="2521" class="l"><a href="#2521"> 2521: </a><span class="php-comment">         * It is not necessary to call this method explicitly because Output() does it automatically.
</span></span><span id="2522" class="l"><a href="#2522"> 2522: </a><span class="php-comment">         * If the document contains no page, AddPage() is called to prevent from getting an invalid document.
</span></span><span id="2523" class="l"><a href="#2523"> 2523: </a><span class="php-comment">         * @access public
</span></span><span id="2524" class="l"><a href="#2524"> 2524: </a><span class="php-comment">         * @since 1.0
</span></span><span id="2525" class="l"><a href="#2525"> 2525: </a><span class="php-comment">         * @see Open(), Output()
</span></span><span id="2526" class="l"><a href="#2526"> 2526: </a><span class="php-comment">         */</span>
</span><span id="2527" class="l"><a href="#2527"> 2527: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Close() {
</span><span id="2528" class="l"><a href="#2528"> 2528: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;state == <span class="php-num">3</span>) {
</span><span id="2529" class="l"><a href="#2529"> 2529: </a>                <span class="php-keyword1">return</span>;
</span><span id="2530" class="l"><a href="#2530"> 2530: </a>            }
</span><span id="2531" class="l"><a href="#2531"> 2531: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page == <span class="php-num">0</span>) {
</span><span id="2532" class="l"><a href="#2532"> 2532: </a>                <span class="php-var">$this</span>-&gt;AddPage();
</span><span id="2533" class="l"><a href="#2533"> 2533: </a>            }
</span><span id="2534" class="l"><a href="#2534"> 2534: </a>            <span class="php-comment">// close page</span>
</span><span id="2535" class="l"><a href="#2535"> 2535: </a>            <span class="php-var">$this</span>-&gt;endPage();
</span><span id="2536" class="l"><a href="#2536"> 2536: </a>            <span class="php-comment">// close document</span>
</span><span id="2537" class="l"><a href="#2537"> 2537: </a>            <span class="php-var">$this</span>-&gt;_enddoc();
</span><span id="2538" class="l"><a href="#2538"> 2538: </a>            <span class="php-comment">// unset all class variables (except critical ones)</span>
</span><span id="2539" class="l"><a href="#2539"> 2539: </a>            <span class="php-var">$this</span>-&gt;_destroy(<span class="php-keyword1">false</span>);
</span><span id="2540" class="l"><a href="#2540"> 2540: </a>        }
</span><span id="2541" class="l"><a href="#2541"> 2541: </a>
</span><span id="2542" class="l"><a href="#2542"> 2542: </a>        <span class="php-comment">/**
</span></span><span id="2543" class="l"><a href="#2543"> 2543: </a><span class="php-comment">         * Move pointer at the specified document page and update page dimensions.
</span></span><span id="2544" class="l"><a href="#2544"> 2544: </a><span class="php-comment">         * @param int $pnum page number (1 ... numpages)
</span></span><span id="2545" class="l"><a href="#2545"> 2545: </a><span class="php-comment">         * @param boolean $resetmargins if true reset left, right, top margins and Y position.
</span></span><span id="2546" class="l"><a href="#2546"> 2546: </a><span class="php-comment">         * @access public
</span></span><span id="2547" class="l"><a href="#2547"> 2547: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="2548" class="l"><a href="#2548"> 2548: </a><span class="php-comment">         * @see getPage(), lastpage(), getNumPages()
</span></span><span id="2549" class="l"><a href="#2549"> 2549: </a><span class="php-comment">         */</span>
</span><span id="2550" class="l"><a href="#2550"> 2550: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPage(<span class="php-var">$pnum</span>, <span class="php-var">$resetmargins</span>=<span class="php-keyword1">false</span>) {
</span><span id="2551" class="l"><a href="#2551"> 2551: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$pnum</span> == <span class="php-var">$this</span>-&gt;page) {
</span><span id="2552" class="l"><a href="#2552"> 2552: </a>                <span class="php-keyword1">return</span>;
</span><span id="2553" class="l"><a href="#2553"> 2553: </a>            }
</span><span id="2554" class="l"><a href="#2554"> 2554: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$pnum</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pnum</span> &lt;= <span class="php-var">$this</span>-&gt;numpages)) {
</span><span id="2555" class="l"><a href="#2555"> 2555: </a>                <span class="php-var">$this</span>-&gt;state = <span class="php-num">2</span>;
</span><span id="2556" class="l"><a href="#2556"> 2556: </a>                <span class="php-comment">// save current graphic settings</span>
</span><span id="2557" class="l"><a href="#2557"> 2557: </a>                <span class="php-comment">//$gvars = $this-&gt;getGraphicVars();</span>
</span><span id="2558" class="l"><a href="#2558"> 2558: </a>                <span class="php-var">$oldpage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="2559" class="l"><a href="#2559"> 2559: </a>                <span class="php-var">$this</span>-&gt;page = <span class="php-var">$pnum</span>;
</span><span id="2560" class="l"><a href="#2560"> 2560: </a>                <span class="php-var">$this</span>-&gt;wPt = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'w'</span>];
</span><span id="2561" class="l"><a href="#2561"> 2561: </a>                <span class="php-var">$this</span>-&gt;hPt = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'h'</span>];
</span><span id="2562" class="l"><a href="#2562"> 2562: </a>                <span class="php-var">$this</span>-&gt;w = <span class="php-var">$this</span>-&gt;wPt / <span class="php-var">$this</span>-&gt;k;
</span><span id="2563" class="l"><a href="#2563"> 2563: </a>                <span class="php-var">$this</span>-&gt;h = <span class="php-var">$this</span>-&gt;hPt / <span class="php-var">$this</span>-&gt;k;
</span><span id="2564" class="l"><a href="#2564"> 2564: </a>                <span class="php-var">$this</span>-&gt;tMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'tm'</span>];
</span><span id="2565" class="l"><a href="#2565"> 2565: </a>                <span class="php-var">$this</span>-&gt;bMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'bm'</span>];
</span><span id="2566" class="l"><a href="#2566"> 2566: </a>                <span class="php-var">$this</span>-&gt;original_lMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>];
</span><span id="2567" class="l"><a href="#2567"> 2567: </a>                <span class="php-var">$this</span>-&gt;original_rMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>];
</span><span id="2568" class="l"><a href="#2568"> 2568: </a>                <span class="php-var">$this</span>-&gt;AutoPageBreak = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'pb'</span>];
</span><span id="2569" class="l"><a href="#2569"> 2569: </a>                <span class="php-var">$this</span>-&gt;CurOrientation = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'or'</span>];
</span><span id="2570" class="l"><a href="#2570"> 2570: </a>                <span class="php-var">$this</span>-&gt;SetAutoPageBreak(<span class="php-var">$this</span>-&gt;AutoPageBreak, <span class="php-var">$this</span>-&gt;bMargin);
</span><span id="2571" class="l"><a href="#2571"> 2571: </a>                <span class="php-comment">// restore graphic settings</span>
</span><span id="2572" class="l"><a href="#2572"> 2572: </a>                <span class="php-comment">//$this-&gt;setGraphicVars($gvars);</span>
</span><span id="2573" class="l"><a href="#2573"> 2573: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$resetmargins</span>) {
</span><span id="2574" class="l"><a href="#2574"> 2574: </a>                    <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>];
</span><span id="2575" class="l"><a href="#2575"> 2575: </a>                    <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>];
</span><span id="2576" class="l"><a href="#2576"> 2576: </a>                    <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$this</span>-&gt;tMargin);
</span><span id="2577" class="l"><a href="#2577"> 2577: </a>                } <span class="php-keyword1">else</span> {
</span><span id="2578" class="l"><a href="#2578"> 2578: </a>                    <span class="php-comment">// account for booklet mode</span>
</span><span id="2579" class="l"><a href="#2579"> 2579: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$oldpage</span>][<span class="php-quote">'olm'</span>]) {
</span><span id="2580" class="l"><a href="#2580"> 2580: </a>                        <span class="php-var">$deltam</span> = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>];
</span><span id="2581" class="l"><a href="#2581"> 2581: </a>                        <span class="php-var">$this</span>-&gt;lMargin += <span class="php-var">$deltam</span>;
</span><span id="2582" class="l"><a href="#2582"> 2582: </a>                        <span class="php-var">$this</span>-&gt;rMargin -= <span class="php-var">$deltam</span>;
</span><span id="2583" class="l"><a href="#2583"> 2583: </a>                    }
</span><span id="2584" class="l"><a href="#2584"> 2584: </a>                }
</span><span id="2585" class="l"><a href="#2585"> 2585: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2586" class="l"><a href="#2586"> 2586: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Wrong page number on setPage() function.'</span>);
</span><span id="2587" class="l"><a href="#2587"> 2587: </a>            }
</span><span id="2588" class="l"><a href="#2588"> 2588: </a>        }
</span><span id="2589" class="l"><a href="#2589"> 2589: </a>
</span><span id="2590" class="l"><a href="#2590"> 2590: </a>        <span class="php-comment">/**
</span></span><span id="2591" class="l"><a href="#2591"> 2591: </a><span class="php-comment">         * Reset pointer to the last document page.
</span></span><span id="2592" class="l"><a href="#2592"> 2592: </a><span class="php-comment">         * @param boolean $resetmargins if true reset left, right, top margins and Y position.
</span></span><span id="2593" class="l"><a href="#2593"> 2593: </a><span class="php-comment">         * @access public
</span></span><span id="2594" class="l"><a href="#2594"> 2594: </a><span class="php-comment">         * @since 2.0.000 (2008-01-04)
</span></span><span id="2595" class="l"><a href="#2595"> 2595: </a><span class="php-comment">         * @see setPage(), getPage(), getNumPages()
</span></span><span id="2596" class="l"><a href="#2596"> 2596: </a><span class="php-comment">         */</span>
</span><span id="2597" class="l"><a href="#2597"> 2597: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> lastPage(<span class="php-var">$resetmargins</span>=<span class="php-keyword1">false</span>) {
</span><span id="2598" class="l"><a href="#2598"> 2598: </a>            <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$this</span>-&gt;getNumPages(), <span class="php-var">$resetmargins</span>);
</span><span id="2599" class="l"><a href="#2599"> 2599: </a>        }
</span><span id="2600" class="l"><a href="#2600"> 2600: </a>
</span><span id="2601" class="l"><a href="#2601"> 2601: </a>        <span class="php-comment">/**
</span></span><span id="2602" class="l"><a href="#2602"> 2602: </a><span class="php-comment">         * Get current document page number.
</span></span><span id="2603" class="l"><a href="#2603"> 2603: </a><span class="php-comment">         * @return int page number
</span></span><span id="2604" class="l"><a href="#2604"> 2604: </a><span class="php-comment">         * @access public
</span></span><span id="2605" class="l"><a href="#2605"> 2605: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="2606" class="l"><a href="#2606"> 2606: </a><span class="php-comment">         * @see setPage(), lastpage(), getNumPages()
</span></span><span id="2607" class="l"><a href="#2607"> 2607: </a><span class="php-comment">         */</span>
</span><span id="2608" class="l"><a href="#2608"> 2608: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getPage() {
</span><span id="2609" class="l"><a href="#2609"> 2609: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;page;
</span><span id="2610" class="l"><a href="#2610"> 2610: </a>        }
</span><span id="2611" class="l"><a href="#2611"> 2611: </a>
</span><span id="2612" class="l"><a href="#2612"> 2612: </a>
</span><span id="2613" class="l"><a href="#2613"> 2613: </a>        <span class="php-comment">/**
</span></span><span id="2614" class="l"><a href="#2614"> 2614: </a><span class="php-comment">         * Get the total number of insered pages.
</span></span><span id="2615" class="l"><a href="#2615"> 2615: </a><span class="php-comment">         * @return int number of pages
</span></span><span id="2616" class="l"><a href="#2616"> 2616: </a><span class="php-comment">         * @access public
</span></span><span id="2617" class="l"><a href="#2617"> 2617: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="2618" class="l"><a href="#2618"> 2618: </a><span class="php-comment">         * @see setPage(), getPage(), lastpage()
</span></span><span id="2619" class="l"><a href="#2619"> 2619: </a><span class="php-comment">         */</span>
</span><span id="2620" class="l"><a href="#2620"> 2620: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getNumPages() {
</span><span id="2621" class="l"><a href="#2621"> 2621: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;numpages;
</span><span id="2622" class="l"><a href="#2622"> 2622: </a>        }
</span><span id="2623" class="l"><a href="#2623"> 2623: </a>
</span><span id="2624" class="l"><a href="#2624"> 2624: </a>        <span class="php-comment">/**
</span></span><span id="2625" class="l"><a href="#2625"> 2625: </a><span class="php-comment">         * Adds a new TOC (Table Of Content) page to the document.
</span></span><span id="2626" class="l"><a href="#2626"> 2626: </a><span class="php-comment">         * @param string $orientation page orientation.
</span></span><span id="2627" class="l"><a href="#2627"> 2627: </a><span class="php-comment">         * @param boolean $keepmargins if true overwrites the default page margins with the current margins
</span></span><span id="2628" class="l"><a href="#2628"> 2628: </a><span class="php-comment">         * @access public
</span></span><span id="2629" class="l"><a href="#2629"> 2629: </a><span class="php-comment">         * @since 5.0.001 (2010-05-06)
</span></span><span id="2630" class="l"><a href="#2630"> 2630: </a><span class="php-comment">         * @see AddPage(), startPage(), endPage(), endTOCPage()
</span></span><span id="2631" class="l"><a href="#2631"> 2631: </a><span class="php-comment">         */</span>
</span><span id="2632" class="l"><a href="#2632"> 2632: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> addTOCPage(<span class="php-var">$orientation</span>=<span class="php-quote">''</span>, <span class="php-var">$format</span>=<span class="php-quote">''</span>, <span class="php-var">$keepmargins</span>=<span class="php-keyword1">false</span>) {
</span><span id="2633" class="l"><a href="#2633"> 2633: </a>            <span class="php-var">$this</span>-&gt;AddPage(<span class="php-var">$orientation</span>, <span class="php-var">$format</span>, <span class="php-var">$keepmargins</span>, <span class="php-keyword1">true</span>);
</span><span id="2634" class="l"><a href="#2634"> 2634: </a>        }
</span><span id="2635" class="l"><a href="#2635"> 2635: </a>
</span><span id="2636" class="l"><a href="#2636"> 2636: </a>        <span class="php-comment">/**
</span></span><span id="2637" class="l"><a href="#2637"> 2637: </a><span class="php-comment">         * Terminate the current TOC (Table Of Content) page
</span></span><span id="2638" class="l"><a href="#2638"> 2638: </a><span class="php-comment">         * @access public
</span></span><span id="2639" class="l"><a href="#2639"> 2639: </a><span class="php-comment">         * @since 5.0.001 (2010-05-06)
</span></span><span id="2640" class="l"><a href="#2640"> 2640: </a><span class="php-comment">         * @see AddPage(), startPage(), endPage(), addTOCPage()
</span></span><span id="2641" class="l"><a href="#2641"> 2641: </a><span class="php-comment">         */</span>
</span><span id="2642" class="l"><a href="#2642"> 2642: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> endTOCPage() {
</span><span id="2643" class="l"><a href="#2643"> 2643: </a>            <span class="php-var">$this</span>-&gt;endPage(<span class="php-keyword1">true</span>);
</span><span id="2644" class="l"><a href="#2644"> 2644: </a>        }
</span><span id="2645" class="l"><a href="#2645"> 2645: </a>
</span><span id="2646" class="l"><a href="#2646"> 2646: </a>        <span class="php-comment">/**
</span></span><span id="2647" class="l"><a href="#2647"> 2647: </a><span class="php-comment">         * Adds a new page to the document. If a page is already present, the Footer() method is called first to output the footer (if enabled). Then the page is added, the current position set to the top-left corner according to the left and top margins (or top-right if in RTL mode), and Header() is called to display the header (if enabled).
</span></span><span id="2648" class="l"><a href="#2648"> 2648: </a><span class="php-comment">         * The origin of the coordinate system is at the top-left corner (or top-right for RTL) and increasing ordinates go downwards.
</span></span><span id="2649" class="l"><a href="#2649"> 2649: </a><span class="php-comment">         * @param string $orientation page orientation. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;P or PORTRAIT (default)&lt;/li&gt;&lt;li&gt;L or LANDSCAPE&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2650" class="l"><a href="#2650"> 2650: </a><span class="php-comment">         * @param mixed $format The format used for pages. It can be either one of the following values (case insensitive) or a custom format in the form of a two-element array containing the width and the height (expressed in the unit given by unit).&lt;ul&gt;&lt;li&gt;4A0&lt;/li&gt;&lt;li&gt;2A0&lt;/li&gt;&lt;li&gt;A0&lt;/li&gt;&lt;li&gt;A1&lt;/li&gt;&lt;li&gt;A2&lt;/li&gt;&lt;li&gt;A3&lt;/li&gt;&lt;li&gt;A4 (default)&lt;/li&gt;&lt;li&gt;A5&lt;/li&gt;&lt;li&gt;A6&lt;/li&gt;&lt;li&gt;A7&lt;/li&gt;&lt;li&gt;A8&lt;/li&gt;&lt;li&gt;A9&lt;/li&gt;&lt;li&gt;A10&lt;/li&gt;&lt;li&gt;B0&lt;/li&gt;&lt;li&gt;B1&lt;/li&gt;&lt;li&gt;B2&lt;/li&gt;&lt;li&gt;B3&lt;/li&gt;&lt;li&gt;B4&lt;/li&gt;&lt;li&gt;B5&lt;/li&gt;&lt;li&gt;B6&lt;/li&gt;&lt;li&gt;B7&lt;/li&gt;&lt;li&gt;B8&lt;/li&gt;&lt;li&gt;B9&lt;/li&gt;&lt;li&gt;B10&lt;/li&gt;&lt;li&gt;C0&lt;/li&gt;&lt;li&gt;C1&lt;/li&gt;&lt;li&gt;C2&lt;/li&gt;&lt;li&gt;C3&lt;/li&gt;&lt;li&gt;C4&lt;/li&gt;&lt;li&gt;C5&lt;/li&gt;&lt;li&gt;C6&lt;/li&gt;&lt;li&gt;C7&lt;/li&gt;&lt;li&gt;C8&lt;/li&gt;&lt;li&gt;C9&lt;/li&gt;&lt;li&gt;C10&lt;/li&gt;&lt;li&gt;RA0&lt;/li&gt;&lt;li&gt;RA1&lt;/li&gt;&lt;li&gt;RA2&lt;/li&gt;&lt;li&gt;RA3&lt;/li&gt;&lt;li&gt;RA4&lt;/li&gt;&lt;li&gt;SRA0&lt;/li&gt;&lt;li&gt;SRA1&lt;/li&gt;&lt;li&gt;SRA2&lt;/li&gt;&lt;li&gt;SRA3&lt;/li&gt;&lt;li&gt;SRA4&lt;/li&gt;&lt;li&gt;LETTER&lt;/li&gt;&lt;li&gt;LEGAL&lt;/li&gt;&lt;li&gt;EXECUTIVE&lt;/li&gt;&lt;li&gt;FOLIO&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2651" class="l"><a href="#2651"> 2651: </a><span class="php-comment">         * @param boolean $keepmargins if true overwrites the default page margins with the current margins
</span></span><span id="2652" class="l"><a href="#2652"> 2652: </a><span class="php-comment">         * @param boolean $tocpage if true set the tocpage state to true (the added page will be used to display Table Of Content).
</span></span><span id="2653" class="l"><a href="#2653"> 2653: </a><span class="php-comment">         * @access public
</span></span><span id="2654" class="l"><a href="#2654"> 2654: </a><span class="php-comment">         * @since 1.0
</span></span><span id="2655" class="l"><a href="#2655"> 2655: </a><span class="php-comment">         * @see startPage(), endPage(), addTOCPage(), endTOCPage()
</span></span><span id="2656" class="l"><a href="#2656"> 2656: </a><span class="php-comment">         */</span>
</span><span id="2657" class="l"><a href="#2657"> 2657: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> AddPage(<span class="php-var">$orientation</span>=<span class="php-quote">''</span>, <span class="php-var">$format</span>=<span class="php-quote">''</span>, <span class="php-var">$keepmargins</span>=<span class="php-keyword1">false</span>, <span class="php-var">$tocpage</span>=<span class="php-keyword1">false</span>) {
</span><span id="2658" class="l"><a href="#2658"> 2658: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;original_lMargin) <span class="php-keyword1">OR</span> <span class="php-var">$keepmargins</span>) {
</span><span id="2659" class="l"><a href="#2659"> 2659: </a>                <span class="php-var">$this</span>-&gt;original_lMargin = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="2660" class="l"><a href="#2660"> 2660: </a>            }
</span><span id="2661" class="l"><a href="#2661"> 2661: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;original_rMargin) <span class="php-keyword1">OR</span> <span class="php-var">$keepmargins</span>) {
</span><span id="2662" class="l"><a href="#2662"> 2662: </a>                <span class="php-var">$this</span>-&gt;original_rMargin = <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="2663" class="l"><a href="#2663"> 2663: </a>            }
</span><span id="2664" class="l"><a href="#2664"> 2664: </a>            <span class="php-comment">// terminate previous page</span>
</span><span id="2665" class="l"><a href="#2665"> 2665: </a>            <span class="php-var">$this</span>-&gt;endPage();
</span><span id="2666" class="l"><a href="#2666"> 2666: </a>            <span class="php-comment">// start new page</span>
</span><span id="2667" class="l"><a href="#2667"> 2667: </a>            <span class="php-var">$this</span>-&gt;startPage(<span class="php-var">$orientation</span>, <span class="php-var">$format</span>, <span class="php-var">$tocpage</span>);
</span><span id="2668" class="l"><a href="#2668"> 2668: </a>        }
</span><span id="2669" class="l"><a href="#2669"> 2669: </a>
</span><span id="2670" class="l"><a href="#2670"> 2670: </a>        <span class="php-comment">/**
</span></span><span id="2671" class="l"><a href="#2671"> 2671: </a><span class="php-comment">         * Terminate the current page
</span></span><span id="2672" class="l"><a href="#2672"> 2672: </a><span class="php-comment">         * @param boolean $tocpage if true set the tocpage state to false (end the page used to display Table Of Content).
</span></span><span id="2673" class="l"><a href="#2673"> 2673: </a><span class="php-comment">         * @access public
</span></span><span id="2674" class="l"><a href="#2674"> 2674: </a><span class="php-comment">         * @since 4.2.010 (2008-11-14)
</span></span><span id="2675" class="l"><a href="#2675"> 2675: </a><span class="php-comment">         * @see AddPage(), startPage(), addTOCPage(), endTOCPage()
</span></span><span id="2676" class="l"><a href="#2676"> 2676: </a><span class="php-comment">         */</span>
</span><span id="2677" class="l"><a href="#2677"> 2677: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> endPage(<span class="php-var">$tocpage</span>=<span class="php-keyword1">false</span>) {
</span><span id="2678" class="l"><a href="#2678"> 2678: </a>            <span class="php-comment">// check if page is already closed</span>
</span><span id="2679" class="l"><a href="#2679"> 2679: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;page == <span class="php-num">0</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;numpages &gt; <span class="php-var">$this</span>-&gt;page) <span class="php-keyword1">OR</span> (!<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="2680" class="l"><a href="#2680"> 2680: </a>                <span class="php-keyword1">return</span>;
</span><span id="2681" class="l"><a href="#2681"> 2681: </a>            }
</span><span id="2682" class="l"><a href="#2682"> 2682: </a>            <span class="php-var">$this</span>-&gt;InFooter = <span class="php-keyword1">true</span>;
</span><span id="2683" class="l"><a href="#2683"> 2683: </a>            <span class="php-comment">// print page footer</span>
</span><span id="2684" class="l"><a href="#2684"> 2684: </a>            <span class="php-var">$this</span>-&gt;setFooter();
</span><span id="2685" class="l"><a href="#2685"> 2685: </a>            <span class="php-comment">// close page</span>
</span><span id="2686" class="l"><a href="#2686"> 2686: </a>            <span class="php-var">$this</span>-&gt;_endpage();
</span><span id="2687" class="l"><a href="#2687"> 2687: </a>            <span class="php-comment">// mark page as closed</span>
</span><span id="2688" class="l"><a href="#2688"> 2688: </a>            <span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$this</span>-&gt;page] = <span class="php-keyword1">false</span>;
</span><span id="2689" class="l"><a href="#2689"> 2689: </a>            <span class="php-var">$this</span>-&gt;InFooter = <span class="php-keyword1">false</span>;
</span><span id="2690" class="l"><a href="#2690"> 2690: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$tocpage</span>) {
</span><span id="2691" class="l"><a href="#2691"> 2691: </a>                <span class="php-var">$this</span>-&gt;tocpage = <span class="php-keyword1">false</span>;
</span><span id="2692" class="l"><a href="#2692"> 2692: </a>            }
</span><span id="2693" class="l"><a href="#2693"> 2693: </a>        }
</span><span id="2694" class="l"><a href="#2694"> 2694: </a>
</span><span id="2695" class="l"><a href="#2695"> 2695: </a>        <span class="php-comment">/**
</span></span><span id="2696" class="l"><a href="#2696"> 2696: </a><span class="php-comment">         * Starts a new page to the document. The page must be closed using the endPage() function.
</span></span><span id="2697" class="l"><a href="#2697"> 2697: </a><span class="php-comment">         * The origin of the coordinate system is at the top-left corner and increasing ordinates go downwards.
</span></span><span id="2698" class="l"><a href="#2698"> 2698: </a><span class="php-comment">         * @param string $orientation page orientation. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;P or PORTRAIT (default)&lt;/li&gt;&lt;li&gt;L or LANDSCAPE&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2699" class="l"><a href="#2699"> 2699: </a><span class="php-comment">         * @param mixed $format The format used for pages. It can be either one of the following values (case insensitive) or a custom format in the form of a two-element array containing the width and the height (expressed in the unit given by unit).&lt;ul&gt;&lt;li&gt;4A0&lt;/li&gt;&lt;li&gt;2A0&lt;/li&gt;&lt;li&gt;A0&lt;/li&gt;&lt;li&gt;A1&lt;/li&gt;&lt;li&gt;A2&lt;/li&gt;&lt;li&gt;A3&lt;/li&gt;&lt;li&gt;A4 (default)&lt;/li&gt;&lt;li&gt;A5&lt;/li&gt;&lt;li&gt;A6&lt;/li&gt;&lt;li&gt;A7&lt;/li&gt;&lt;li&gt;A8&lt;/li&gt;&lt;li&gt;A9&lt;/li&gt;&lt;li&gt;A10&lt;/li&gt;&lt;li&gt;B0&lt;/li&gt;&lt;li&gt;B1&lt;/li&gt;&lt;li&gt;B2&lt;/li&gt;&lt;li&gt;B3&lt;/li&gt;&lt;li&gt;B4&lt;/li&gt;&lt;li&gt;B5&lt;/li&gt;&lt;li&gt;B6&lt;/li&gt;&lt;li&gt;B7&lt;/li&gt;&lt;li&gt;B8&lt;/li&gt;&lt;li&gt;B9&lt;/li&gt;&lt;li&gt;B10&lt;/li&gt;&lt;li&gt;C0&lt;/li&gt;&lt;li&gt;C1&lt;/li&gt;&lt;li&gt;C2&lt;/li&gt;&lt;li&gt;C3&lt;/li&gt;&lt;li&gt;C4&lt;/li&gt;&lt;li&gt;C5&lt;/li&gt;&lt;li&gt;C6&lt;/li&gt;&lt;li&gt;C7&lt;/li&gt;&lt;li&gt;C8&lt;/li&gt;&lt;li&gt;C9&lt;/li&gt;&lt;li&gt;C10&lt;/li&gt;&lt;li&gt;RA0&lt;/li&gt;&lt;li&gt;RA1&lt;/li&gt;&lt;li&gt;RA2&lt;/li&gt;&lt;li&gt;RA3&lt;/li&gt;&lt;li&gt;RA4&lt;/li&gt;&lt;li&gt;SRA0&lt;/li&gt;&lt;li&gt;SRA1&lt;/li&gt;&lt;li&gt;SRA2&lt;/li&gt;&lt;li&gt;SRA3&lt;/li&gt;&lt;li&gt;SRA4&lt;/li&gt;&lt;li&gt;LETTER&lt;/li&gt;&lt;li&gt;LEGAL&lt;/li&gt;&lt;li&gt;EXECUTIVE&lt;/li&gt;&lt;li&gt;FOLIO&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2700" class="l"><a href="#2700"> 2700: </a><span class="php-comment">         * @param boolean $tocpage if true set the tocpage state to true (the added page will be used to display Table of Content).
</span></span><span id="2701" class="l"><a href="#2701"> 2701: </a><span class="php-comment">         * @access public
</span></span><span id="2702" class="l"><a href="#2702"> 2702: </a><span class="php-comment">         * @since 4.2.010 (2008-11-14)
</span></span><span id="2703" class="l"><a href="#2703"> 2703: </a><span class="php-comment">         * @see AddPage(), endPage(), addTOCPage(), endTOCPage()
</span></span><span id="2704" class="l"><a href="#2704"> 2704: </a><span class="php-comment">         */</span>
</span><span id="2705" class="l"><a href="#2705"> 2705: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> startPage(<span class="php-var">$orientation</span>=<span class="php-quote">''</span>, <span class="php-var">$format</span>=<span class="php-quote">''</span>, <span class="php-var">$tocpage</span>=<span class="php-keyword1">false</span>) {
</span><span id="2706" class="l"><a href="#2706"> 2706: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$tocpage</span>) {
</span><span id="2707" class="l"><a href="#2707"> 2707: </a>                <span class="php-var">$this</span>-&gt;tocpage = <span class="php-keyword1">true</span>;
</span><span id="2708" class="l"><a href="#2708"> 2708: </a>            }
</span><span id="2709" class="l"><a href="#2709"> 2709: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;numpages &gt; <span class="php-var">$this</span>-&gt;page) {
</span><span id="2710" class="l"><a href="#2710"> 2710: </a>                <span class="php-comment">// this page has been already added</span>
</span><span id="2711" class="l"><a href="#2711"> 2711: </a>                <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$this</span>-&gt;page + <span class="php-num">1</span>);
</span><span id="2712" class="l"><a href="#2712"> 2712: </a>                <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$this</span>-&gt;tMargin);
</span><span id="2713" class="l"><a href="#2713"> 2713: </a>                <span class="php-keyword1">return</span>;
</span><span id="2714" class="l"><a href="#2714"> 2714: </a>            }
</span><span id="2715" class="l"><a href="#2715"> 2715: </a>            <span class="php-comment">// start a new page</span>
</span><span id="2716" class="l"><a href="#2716"> 2716: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;state == <span class="php-num">0</span>) {
</span><span id="2717" class="l"><a href="#2717"> 2717: </a>                <span class="php-var">$this</span>-&gt;Open();
</span><span id="2718" class="l"><a href="#2718"> 2718: </a>            }
</span><span id="2719" class="l"><a href="#2719"> 2719: </a>            ++<span class="php-var">$this</span>-&gt;numpages;
</span><span id="2720" class="l"><a href="#2720"> 2720: </a>            <span class="php-var">$this</span>-&gt;swapMargins(<span class="php-var">$this</span>-&gt;booklet);
</span><span id="2721" class="l"><a href="#2721"> 2721: </a>            <span class="php-comment">// save current graphic settings</span>
</span><span id="2722" class="l"><a href="#2722"> 2722: </a>            <span class="php-var">$gvars</span> = <span class="php-var">$this</span>-&gt;getGraphicVars();
</span><span id="2723" class="l"><a href="#2723"> 2723: </a>            <span class="php-comment">// start new page</span>
</span><span id="2724" class="l"><a href="#2724"> 2724: </a>            <span class="php-var">$this</span>-&gt;_beginpage(<span class="php-var">$orientation</span>, <span class="php-var">$format</span>);
</span><span id="2725" class="l"><a href="#2725"> 2725: </a>            <span class="php-comment">// mark page as open</span>
</span><span id="2726" class="l"><a href="#2726"> 2726: </a>            <span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$this</span>-&gt;page] = <span class="php-keyword1">true</span>;
</span><span id="2727" class="l"><a href="#2727"> 2727: </a>            <span class="php-comment">// restore graphic settings</span>
</span><span id="2728" class="l"><a href="#2728"> 2728: </a>            <span class="php-var">$this</span>-&gt;setGraphicVars(<span class="php-var">$gvars</span>);
</span><span id="2729" class="l"><a href="#2729"> 2729: </a>            <span class="php-comment">// mark this point</span>
</span><span id="2730" class="l"><a href="#2730"> 2730: </a>            <span class="php-var">$this</span>-&gt;setPageMark();
</span><span id="2731" class="l"><a href="#2731"> 2731: </a>            <span class="php-comment">// print page header</span>
</span><span id="2732" class="l"><a href="#2732"> 2732: </a>            <span class="php-var">$this</span>-&gt;setHeader();
</span><span id="2733" class="l"><a href="#2733"> 2733: </a>            <span class="php-comment">// restore graphic settings</span>
</span><span id="2734" class="l"><a href="#2734"> 2734: </a>            <span class="php-var">$this</span>-&gt;setGraphicVars(<span class="php-var">$gvars</span>);
</span><span id="2735" class="l"><a href="#2735"> 2735: </a>            <span class="php-comment">// mark this point</span>
</span><span id="2736" class="l"><a href="#2736"> 2736: </a>            <span class="php-var">$this</span>-&gt;setPageMark();
</span><span id="2737" class="l"><a href="#2737"> 2737: </a>            <span class="php-comment">// print table header (if any)</span>
</span><span id="2738" class="l"><a href="#2738"> 2738: </a>            <span class="php-var">$this</span>-&gt;setTableHeader();
</span><span id="2739" class="l"><a href="#2739"> 2739: </a>        }
</span><span id="2740" class="l"><a href="#2740"> 2740: </a>
</span><span id="2741" class="l"><a href="#2741"> 2741: </a>        <span class="php-comment">/**
</span></span><span id="2742" class="l"><a href="#2742"> 2742: </a><span class="php-comment">         * Set start-writing mark on current page stream used to put borders and fills.
</span></span><span id="2743" class="l"><a href="#2743"> 2743: </a><span class="php-comment">         * Borders and fills are always created after content and inserted on the position marked by this method.
</span></span><span id="2744" class="l"><a href="#2744"> 2744: </a><span class="php-comment">         * This function must be called after calling Image() function for a background image.
</span></span><span id="2745" class="l"><a href="#2745"> 2745: </a><span class="php-comment">         * Background images must be always inserted before calling Multicell() or WriteHTMLCell() or WriteHTML() functions.
</span></span><span id="2746" class="l"><a href="#2746"> 2746: </a><span class="php-comment">         * @access public
</span></span><span id="2747" class="l"><a href="#2747"> 2747: </a><span class="php-comment">         * @since 4.0.016 (2008-07-30)
</span></span><span id="2748" class="l"><a href="#2748"> 2748: </a><span class="php-comment">         */</span>
</span><span id="2749" class="l"><a href="#2749"> 2749: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPageMark() {
</span><span id="2750" class="l"><a href="#2750"> 2750: </a>            <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="2751" class="l"><a href="#2751"> 2751: </a>            <span class="php-var">$this</span>-&gt;setContentMark();
</span><span id="2752" class="l"><a href="#2752"> 2752: </a>        }
</span><span id="2753" class="l"><a href="#2753"> 2753: </a>
</span><span id="2754" class="l"><a href="#2754"> 2754: </a>        <span class="php-comment">/**
</span></span><span id="2755" class="l"><a href="#2755"> 2755: </a><span class="php-comment">         * Set start-writing mark on selected page.
</span></span><span id="2756" class="l"><a href="#2756"> 2756: </a><span class="php-comment">         * Borders and fills are always created after content and inserted on the position marked by this method.
</span></span><span id="2757" class="l"><a href="#2757"> 2757: </a><span class="php-comment">         * @param int $page page number (default is the current page)
</span></span><span id="2758" class="l"><a href="#2758"> 2758: </a><span class="php-comment">         * @access protected
</span></span><span id="2759" class="l"><a href="#2759"> 2759: </a><span class="php-comment">         * @since 4.6.021 (2009-07-20)
</span></span><span id="2760" class="l"><a href="#2760"> 2760: </a><span class="php-comment">         */</span>
</span><span id="2761" class="l"><a href="#2761"> 2761: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setContentMark(<span class="php-var">$page</span>=<span class="php-num">0</span>) {
</span><span id="2762" class="l"><a href="#2762"> 2762: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$page</span> &lt;= <span class="php-num">0</span>) {
</span><span id="2763" class="l"><a href="#2763"> 2763: </a>                <span class="php-var">$page</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="2764" class="l"><a href="#2764"> 2764: </a>            }
</span><span id="2765" class="l"><a href="#2765"> 2765: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$page</span>])) {
</span><span id="2766" class="l"><a href="#2766"> 2766: </a>                <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$page</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$page</span>] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$page</span>];
</span><span id="2767" class="l"><a href="#2767"> 2767: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2768" class="l"><a href="#2768"> 2768: </a>                <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$page</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$page</span>];
</span><span id="2769" class="l"><a href="#2769"> 2769: </a>            }
</span><span id="2770" class="l"><a href="#2770"> 2770: </a>        }
</span><span id="2771" class="l"><a href="#2771"> 2771: </a>
</span><span id="2772" class="l"><a href="#2772"> 2772: </a>        <span class="php-comment">/**
</span></span><span id="2773" class="l"><a href="#2773"> 2773: </a><span class="php-comment">         * Set header data.
</span></span><span id="2774" class="l"><a href="#2774"> 2774: </a><span class="php-comment">         * @param string $ln header image logo
</span></span><span id="2775" class="l"><a href="#2775"> 2775: </a><span class="php-comment">         * @param string $lw header image logo width in mm
</span></span><span id="2776" class="l"><a href="#2776"> 2776: </a><span class="php-comment">         * @param string $ht string to print as title on document header
</span></span><span id="2777" class="l"><a href="#2777"> 2777: </a><span class="php-comment">         * @param string $hs string to print on document header
</span></span><span id="2778" class="l"><a href="#2778"> 2778: </a><span class="php-comment">         * @access public
</span></span><span id="2779" class="l"><a href="#2779"> 2779: </a><span class="php-comment">         */</span>
</span><span id="2780" class="l"><a href="#2780"> 2780: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setHeaderData(<span class="php-var">$ln</span>=<span class="php-quote">''</span>, <span class="php-var">$lw</span>=<span class="php-num">0</span>, <span class="php-var">$ht</span>=<span class="php-quote">''</span>, <span class="php-var">$hs</span>=<span class="php-quote">''</span>) {
</span><span id="2781" class="l"><a href="#2781"> 2781: </a>            <span class="php-var">$this</span>-&gt;header_logo = <span class="php-var">$ln</span>;
</span><span id="2782" class="l"><a href="#2782"> 2782: </a>            <span class="php-var">$this</span>-&gt;header_logo_width = <span class="php-var">$lw</span>;
</span><span id="2783" class="l"><a href="#2783"> 2783: </a>            <span class="php-var">$this</span>-&gt;header_title = <span class="php-var">$ht</span>;
</span><span id="2784" class="l"><a href="#2784"> 2784: </a>            <span class="php-var">$this</span>-&gt;header_string = <span class="php-var">$hs</span>;
</span><span id="2785" class="l"><a href="#2785"> 2785: </a>        }
</span><span id="2786" class="l"><a href="#2786"> 2786: </a>
</span><span id="2787" class="l"><a href="#2787"> 2787: </a>        <span class="php-comment">/**
</span></span><span id="2788" class="l"><a href="#2788"> 2788: </a><span class="php-comment">         * Returns header data:
</span></span><span id="2789" class="l"><a href="#2789"> 2789: </a><span class="php-comment">         * &lt;ul&gt;&lt;li&gt;$ret['logo'] = logo image&lt;/li&gt;&lt;li&gt;$ret['logo_width'] = width of the image logo in user units&lt;/li&gt;&lt;li&gt;$ret['title'] = header title&lt;/li&gt;&lt;li&gt;$ret['string'] = header description string&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="2790" class="l"><a href="#2790"> 2790: </a><span class="php-comment">         * @return array()
</span></span><span id="2791" class="l"><a href="#2791"> 2791: </a><span class="php-comment">         * @access public
</span></span><span id="2792" class="l"><a href="#2792"> 2792: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="2793" class="l"><a href="#2793"> 2793: </a><span class="php-comment">         */</span>
</span><span id="2794" class="l"><a href="#2794"> 2794: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getHeaderData() {
</span><span id="2795" class="l"><a href="#2795"> 2795: </a>            <span class="php-var">$ret</span> = <span class="php-keyword1">array</span>();
</span><span id="2796" class="l"><a href="#2796"> 2796: </a>            <span class="php-var">$ret</span>[<span class="php-quote">'logo'</span>] = <span class="php-var">$this</span>-&gt;header_logo;
</span><span id="2797" class="l"><a href="#2797"> 2797: </a>            <span class="php-var">$ret</span>[<span class="php-quote">'logo_width'</span>] = <span class="php-var">$this</span>-&gt;header_logo_width;
</span><span id="2798" class="l"><a href="#2798"> 2798: </a>            <span class="php-var">$ret</span>[<span class="php-quote">'title'</span>] = <span class="php-var">$this</span>-&gt;header_title;
</span><span id="2799" class="l"><a href="#2799"> 2799: </a>            <span class="php-var">$ret</span>[<span class="php-quote">'string'</span>] = <span class="php-var">$this</span>-&gt;header_string;
</span><span id="2800" class="l"><a href="#2800"> 2800: </a>            <span class="php-keyword1">return</span> <span class="php-var">$ret</span>;
</span><span id="2801" class="l"><a href="#2801"> 2801: </a>        }
</span><span id="2802" class="l"><a href="#2802"> 2802: </a>
</span><span id="2803" class="l"><a href="#2803"> 2803: </a>        <span class="php-comment">/**
</span></span><span id="2804" class="l"><a href="#2804"> 2804: </a><span class="php-comment">         * Set header margin.
</span></span><span id="2805" class="l"><a href="#2805"> 2805: </a><span class="php-comment">         * (minimum distance between header and top page margin)
</span></span><span id="2806" class="l"><a href="#2806"> 2806: </a><span class="php-comment">         * @param int $hm distance in user units
</span></span><span id="2807" class="l"><a href="#2807"> 2807: </a><span class="php-comment">         * @access public
</span></span><span id="2808" class="l"><a href="#2808"> 2808: </a><span class="php-comment">         */</span>
</span><span id="2809" class="l"><a href="#2809"> 2809: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setHeaderMargin(<span class="php-var">$hm</span>=<span class="php-num">10</span>) {
</span><span id="2810" class="l"><a href="#2810"> 2810: </a>            <span class="php-var">$this</span>-&gt;header_margin = <span class="php-var">$hm</span>;
</span><span id="2811" class="l"><a href="#2811"> 2811: </a>        }
</span><span id="2812" class="l"><a href="#2812"> 2812: </a>
</span><span id="2813" class="l"><a href="#2813"> 2813: </a>        <span class="php-comment">/**
</span></span><span id="2814" class="l"><a href="#2814"> 2814: </a><span class="php-comment">         * Returns header margin in user units.
</span></span><span id="2815" class="l"><a href="#2815"> 2815: </a><span class="php-comment">         * @return float
</span></span><span id="2816" class="l"><a href="#2816"> 2816: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="2817" class="l"><a href="#2817"> 2817: </a><span class="php-comment">         * @access public
</span></span><span id="2818" class="l"><a href="#2818"> 2818: </a><span class="php-comment">         */</span>
</span><span id="2819" class="l"><a href="#2819"> 2819: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getHeaderMargin() {
</span><span id="2820" class="l"><a href="#2820"> 2820: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;header_margin;
</span><span id="2821" class="l"><a href="#2821"> 2821: </a>        }
</span><span id="2822" class="l"><a href="#2822"> 2822: </a>
</span><span id="2823" class="l"><a href="#2823"> 2823: </a>        <span class="php-comment">/**
</span></span><span id="2824" class="l"><a href="#2824"> 2824: </a><span class="php-comment">         * Set footer margin.
</span></span><span id="2825" class="l"><a href="#2825"> 2825: </a><span class="php-comment">         * (minimum distance between footer and bottom page margin)
</span></span><span id="2826" class="l"><a href="#2826"> 2826: </a><span class="php-comment">         * @param int $fm distance in user units
</span></span><span id="2827" class="l"><a href="#2827"> 2827: </a><span class="php-comment">         * @access public
</span></span><span id="2828" class="l"><a href="#2828"> 2828: </a><span class="php-comment">         */</span>
</span><span id="2829" class="l"><a href="#2829"> 2829: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setFooterMargin(<span class="php-var">$fm</span>=<span class="php-num">10</span>) {
</span><span id="2830" class="l"><a href="#2830"> 2830: </a>            <span class="php-var">$this</span>-&gt;footer_margin = <span class="php-var">$fm</span>;
</span><span id="2831" class="l"><a href="#2831"> 2831: </a>        }
</span><span id="2832" class="l"><a href="#2832"> 2832: </a>
</span><span id="2833" class="l"><a href="#2833"> 2833: </a>        <span class="php-comment">/**
</span></span><span id="2834" class="l"><a href="#2834"> 2834: </a><span class="php-comment">         * Returns footer margin in user units.
</span></span><span id="2835" class="l"><a href="#2835"> 2835: </a><span class="php-comment">         * @return float
</span></span><span id="2836" class="l"><a href="#2836"> 2836: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="2837" class="l"><a href="#2837"> 2837: </a><span class="php-comment">         * @access public
</span></span><span id="2838" class="l"><a href="#2838"> 2838: </a><span class="php-comment">         */</span>
</span><span id="2839" class="l"><a href="#2839"> 2839: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFooterMargin() {
</span><span id="2840" class="l"><a href="#2840"> 2840: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;footer_margin;
</span><span id="2841" class="l"><a href="#2841"> 2841: </a>        }
</span><span id="2842" class="l"><a href="#2842"> 2842: </a>        <span class="php-comment">/**
</span></span><span id="2843" class="l"><a href="#2843"> 2843: </a><span class="php-comment">         * Set a flag to print page header.
</span></span><span id="2844" class="l"><a href="#2844"> 2844: </a><span class="php-comment">         * @param boolean $val set to true to print the page header (default), false otherwise.
</span></span><span id="2845" class="l"><a href="#2845"> 2845: </a><span class="php-comment">         * @access public
</span></span><span id="2846" class="l"><a href="#2846"> 2846: </a><span class="php-comment">         */</span>
</span><span id="2847" class="l"><a href="#2847"> 2847: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPrintHeader(<span class="php-var">$val</span>=<span class="php-keyword1">true</span>) {
</span><span id="2848" class="l"><a href="#2848"> 2848: </a>            <span class="php-var">$this</span>-&gt;print_header = <span class="php-var">$val</span>;
</span><span id="2849" class="l"><a href="#2849"> 2849: </a>        }
</span><span id="2850" class="l"><a href="#2850"> 2850: </a>
</span><span id="2851" class="l"><a href="#2851"> 2851: </a>        <span class="php-comment">/**
</span></span><span id="2852" class="l"><a href="#2852"> 2852: </a><span class="php-comment">         * Set a flag to print page footer.
</span></span><span id="2853" class="l"><a href="#2853"> 2853: </a><span class="php-comment">         * @param boolean $value set to true to print the page footer (default), false otherwise.
</span></span><span id="2854" class="l"><a href="#2854"> 2854: </a><span class="php-comment">         * @access public
</span></span><span id="2855" class="l"><a href="#2855"> 2855: </a><span class="php-comment">         */</span>
</span><span id="2856" class="l"><a href="#2856"> 2856: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPrintFooter(<span class="php-var">$val</span>=<span class="php-keyword1">true</span>) {
</span><span id="2857" class="l"><a href="#2857"> 2857: </a>            <span class="php-var">$this</span>-&gt;print_footer = <span class="php-var">$val</span>;
</span><span id="2858" class="l"><a href="#2858"> 2858: </a>        }
</span><span id="2859" class="l"><a href="#2859"> 2859: </a>
</span><span id="2860" class="l"><a href="#2860"> 2860: </a>        <span class="php-comment">/**
</span></span><span id="2861" class="l"><a href="#2861"> 2861: </a><span class="php-comment">         * Return the right-bottom (or left-bottom for RTL) corner X coordinate of last inserted image
</span></span><span id="2862" class="l"><a href="#2862"> 2862: </a><span class="php-comment">         * @return float
</span></span><span id="2863" class="l"><a href="#2863"> 2863: </a><span class="php-comment">         * @access public
</span></span><span id="2864" class="l"><a href="#2864"> 2864: </a><span class="php-comment">         */</span>
</span><span id="2865" class="l"><a href="#2865"> 2865: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getImageRBX() {
</span><span id="2866" class="l"><a href="#2866"> 2866: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="2867" class="l"><a href="#2867"> 2867: </a>        }
</span><span id="2868" class="l"><a href="#2868"> 2868: </a>
</span><span id="2869" class="l"><a href="#2869"> 2869: </a>        <span class="php-comment">/**
</span></span><span id="2870" class="l"><a href="#2870"> 2870: </a><span class="php-comment">         * Return the right-bottom (or left-bottom for RTL) corner Y coordinate of last inserted image
</span></span><span id="2871" class="l"><a href="#2871"> 2871: </a><span class="php-comment">         * @return float
</span></span><span id="2872" class="l"><a href="#2872"> 2872: </a><span class="php-comment">         * @access public
</span></span><span id="2873" class="l"><a href="#2873"> 2873: </a><span class="php-comment">         */</span>
</span><span id="2874" class="l"><a href="#2874"> 2874: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getImageRBY() {
</span><span id="2875" class="l"><a href="#2875"> 2875: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;img_rb_y;
</span><span id="2876" class="l"><a href="#2876"> 2876: </a>        }
</span><span id="2877" class="l"><a href="#2877"> 2877: </a>
</span><span id="2878" class="l"><a href="#2878"> 2878: </a>        <span class="php-comment">/**
</span></span><span id="2879" class="l"><a href="#2879"> 2879: </a><span class="php-comment">         * This method is used to render the page header.
</span></span><span id="2880" class="l"><a href="#2880"> 2880: </a><span class="php-comment">         * It is automatically called by AddPage() and could be overwritten in your own inherited class.
</span></span><span id="2881" class="l"><a href="#2881"> 2881: </a><span class="php-comment">         * @access public
</span></span><span id="2882" class="l"><a href="#2882"> 2882: </a><span class="php-comment">         */</span>
</span><span id="2883" class="l"><a href="#2883"> 2883: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <span class="php-keyword2">Header</span>() {
</span><span id="2884" class="l"><a href="#2884"> 2884: </a>            <span class="php-var">$ormargins</span> = <span class="php-var">$this</span>-&gt;getOriginalMargins();
</span><span id="2885" class="l"><a href="#2885"> 2885: </a>            <span class="php-var">$headerfont</span> = <span class="php-var">$this</span>-&gt;getHeaderFont();
</span><span id="2886" class="l"><a href="#2886"> 2886: </a>            <span class="php-var">$headerdata</span> = <span class="php-var">$this</span>-&gt;getHeaderData();
</span><span id="2887" class="l"><a href="#2887"> 2887: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$headerdata</span>[<span class="php-quote">'logo'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$headerdata</span>[<span class="php-quote">'logo'</span>] != K_BLANK_IMAGE)) {
</span><span id="2888" class="l"><a href="#2888"> 2888: </a>                <span class="php-var">$this</span>-&gt;Image(K_PATH_IMAGES.<span class="php-var">$headerdata</span>[<span class="php-quote">'logo'</span>], <span class="php-var">$this</span>-&gt;GetX(), <span class="php-var">$this</span>-&gt;getHeaderMargin(), <span class="php-var">$headerdata</span>[<span class="php-quote">'logo_width'</span>]);
</span><span id="2889" class="l"><a href="#2889"> 2889: </a>                <span class="php-var">$imgy</span> = <span class="php-var">$this</span>-&gt;getImageRBY();
</span><span id="2890" class="l"><a href="#2890"> 2890: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2891" class="l"><a href="#2891"> 2891: </a>                <span class="php-var">$imgy</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="2892" class="l"><a href="#2892"> 2892: </a>            }
</span><span id="2893" class="l"><a href="#2893"> 2893: </a>            <span class="php-var">$cell_height</span> = <span class="php-keyword2">round</span>((<span class="php-var">$this</span>-&gt;getCellHeightRatio() * <span class="php-var">$headerfont</span>[<span class="php-num">2</span>]) / <span class="php-var">$this</span>-&gt;getScaleFactor(), <span class="php-num">2</span>);
</span><span id="2894" class="l"><a href="#2894"> 2894: </a>            <span class="php-comment">// set starting margin for text data cell</span>
</span><span id="2895" class="l"><a href="#2895"> 2895: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;getRTL()) {
</span><span id="2896" class="l"><a href="#2896"> 2896: </a>                <span class="php-var">$header_x</span> = <span class="php-var">$ormargins</span>[<span class="php-quote">'right'</span>] + (<span class="php-var">$headerdata</span>[<span class="php-quote">'logo_width'</span>] * <span class="php-num">1.1</span>);
</span><span id="2897" class="l"><a href="#2897"> 2897: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2898" class="l"><a href="#2898"> 2898: </a>                <span class="php-var">$header_x</span> = <span class="php-var">$ormargins</span>[<span class="php-quote">'left'</span>] + (<span class="php-var">$headerdata</span>[<span class="php-quote">'logo_width'</span>] * <span class="php-num">1.1</span>);
</span><span id="2899" class="l"><a href="#2899"> 2899: </a>            }
</span><span id="2900" class="l"><a href="#2900"> 2900: </a>            <span class="php-var">$this</span>-&gt;SetTextColor(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>);
</span><span id="2901" class="l"><a href="#2901"> 2901: </a>            <span class="php-comment">// header title</span>
</span><span id="2902" class="l"><a href="#2902"> 2902: </a>            <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$headerfont</span>[<span class="php-num">0</span>], <span class="php-quote">'B'</span>, <span class="php-var">$headerfont</span>[<span class="php-num">2</span>] + <span class="php-num">1</span>);
</span><span id="2903" class="l"><a href="#2903"> 2903: </a>            <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$header_x</span>);
</span><span id="2904" class="l"><a href="#2904"> 2904: </a>            <span class="php-var">$this</span>-&gt;Cell(<span class="php-num">0</span>, <span class="php-var">$cell_height</span>, <span class="php-var">$headerdata</span>[<span class="php-quote">'title'</span>], <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>);
</span><span id="2905" class="l"><a href="#2905"> 2905: </a>            <span class="php-comment">// header string</span>
</span><span id="2906" class="l"><a href="#2906"> 2906: </a>            <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$headerfont</span>[<span class="php-num">0</span>], <span class="php-var">$headerfont</span>[<span class="php-num">1</span>], <span class="php-var">$headerfont</span>[<span class="php-num">2</span>]);
</span><span id="2907" class="l"><a href="#2907"> 2907: </a>            <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$header_x</span>);
</span><span id="2908" class="l"><a href="#2908"> 2908: </a>            <span class="php-var">$this</span>-&gt;MultiCell(<span class="php-num">0</span>, <span class="php-var">$cell_height</span>, <span class="php-var">$headerdata</span>[<span class="php-quote">'string'</span>], <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">true</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>);
</span><span id="2909" class="l"><a href="#2909"> 2909: </a>            <span class="php-comment">// print an ending header line</span>
</span><span id="2910" class="l"><a href="#2910"> 2910: </a>            <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-keyword1">array</span>(<span class="php-quote">'width'</span> =&gt; <span class="php-num">0.85</span> / <span class="php-var">$this</span>-&gt;getScaleFactor(), <span class="php-quote">'cap'</span> =&gt; <span class="php-quote">'butt'</span>, <span class="php-quote">'join'</span> =&gt; <span class="php-quote">'miter'</span>, <span class="php-quote">'dash'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'color'</span> =&gt; <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>)));
</span><span id="2911" class="l"><a href="#2911"> 2911: </a>            <span class="php-var">$this</span>-&gt;SetY((<span class="php-num">2.835</span> / <span class="php-var">$this</span>-&gt;getScaleFactor()) + <span class="php-keyword2">max</span>(<span class="php-var">$imgy</span>, <span class="php-var">$this</span>-&gt;GetY()));
</span><span id="2912" class="l"><a href="#2912"> 2912: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;getRTL()) {
</span><span id="2913" class="l"><a href="#2913"> 2913: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$ormargins</span>[<span class="php-quote">'right'</span>]);
</span><span id="2914" class="l"><a href="#2914"> 2914: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2915" class="l"><a href="#2915"> 2915: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$ormargins</span>[<span class="php-quote">'left'</span>]);
</span><span id="2916" class="l"><a href="#2916"> 2916: </a>            }
</span><span id="2917" class="l"><a href="#2917"> 2917: </a>            <span class="php-var">$this</span>-&gt;Cell(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-quote">'T'</span>, <span class="php-num">0</span>, <span class="php-quote">'C'</span>);
</span><span id="2918" class="l"><a href="#2918"> 2918: </a>        }
</span><span id="2919" class="l"><a href="#2919"> 2919: </a>
</span><span id="2920" class="l"><a href="#2920"> 2920: </a>        <span class="php-comment">/**
</span></span><span id="2921" class="l"><a href="#2921"> 2921: </a><span class="php-comment">         * This method is used to render the page footer.
</span></span><span id="2922" class="l"><a href="#2922"> 2922: </a><span class="php-comment">         * It is automatically called by AddPage() and could be overwritten in your own inherited class.
</span></span><span id="2923" class="l"><a href="#2923"> 2923: </a><span class="php-comment">         * @access public
</span></span><span id="2924" class="l"><a href="#2924"> 2924: </a><span class="php-comment">         */</span>
</span><span id="2925" class="l"><a href="#2925"> 2925: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Footer() {
</span><span id="2926" class="l"><a href="#2926"> 2926: </a>            <span class="php-var">$cur_y</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="2927" class="l"><a href="#2927"> 2927: </a>            <span class="php-var">$ormargins</span> = <span class="php-var">$this</span>-&gt;getOriginalMargins();
</span><span id="2928" class="l"><a href="#2928"> 2928: </a>            <span class="php-var">$this</span>-&gt;SetTextColor(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>);
</span><span id="2929" class="l"><a href="#2929"> 2929: </a>            <span class="php-comment">//set style for cell border</span>
</span><span id="2930" class="l"><a href="#2930"> 2930: </a>            <span class="php-var">$line_width</span> = <span class="php-num">0.85</span> / <span class="php-var">$this</span>-&gt;getScaleFactor();
</span><span id="2931" class="l"><a href="#2931"> 2931: </a>            <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-keyword1">array</span>(<span class="php-quote">'width'</span> =&gt; <span class="php-var">$line_width</span>, <span class="php-quote">'cap'</span> =&gt; <span class="php-quote">'butt'</span>, <span class="php-quote">'join'</span> =&gt; <span class="php-quote">'miter'</span>, <span class="php-quote">'dash'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'color'</span> =&gt; <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>)));
</span><span id="2932" class="l"><a href="#2932"> 2932: </a>            <span class="php-comment">//print document barcode</span>
</span><span id="2933" class="l"><a href="#2933"> 2933: </a>            <span class="php-var">$barcode</span> = <span class="php-var">$this</span>-&gt;getBarcode();
</span><span id="2934" class="l"><a href="#2934"> 2934: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$barcode</span>)) {
</span><span id="2935" class="l"><a href="#2935"> 2935: </a>                <span class="php-var">$this</span>-&gt;Ln(<span class="php-var">$line_width</span>);
</span><span id="2936" class="l"><a href="#2936"> 2936: </a>                <span class="php-var">$barcode_width</span> = <span class="php-keyword2">round</span>((<span class="php-var">$this</span>-&gt;getPageWidth() - <span class="php-var">$ormargins</span>[<span class="php-quote">'left'</span>] - <span class="php-var">$ormargins</span>[<span class="php-quote">'right'</span>])/<span class="php-num">3</span>);
</span><span id="2937" class="l"><a href="#2937"> 2937: </a>                <span class="php-var">$this</span>-&gt;write1DBarcode(<span class="php-var">$barcode</span>, <span class="php-quote">'C128B'</span>, <span class="php-var">$this</span>-&gt;GetX(), <span class="php-var">$cur_y</span> + <span class="php-var">$line_width</span>, <span class="php-var">$barcode_width</span>, ((<span class="php-var">$this</span>-&gt;getFooterMargin() / <span class="php-num">3</span>) - <span class="php-var">$line_width</span>), <span class="php-num">0.3</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>);
</span><span id="2938" class="l"><a href="#2938"> 2938: </a>            }
</span><span id="2939" class="l"><a href="#2939"> 2939: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;pagegroups)) {
</span><span id="2940" class="l"><a href="#2940"> 2940: </a>                <span class="php-var">$pagenumtxt</span> = <span class="php-var">$this</span>-&gt;l[<span class="php-quote">'w_page'</span>].<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;getAliasNumPage().<span class="php-quote">' / '</span>.<span class="php-var">$this</span>-&gt;getAliasNbPages();
</span><span id="2941" class="l"><a href="#2941"> 2941: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2942" class="l"><a href="#2942"> 2942: </a>                <span class="php-var">$pagenumtxt</span> = <span class="php-var">$this</span>-&gt;l[<span class="php-quote">'w_page'</span>].<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;getPageNumGroupAlias().<span class="php-quote">' / '</span>.<span class="php-var">$this</span>-&gt;getPageGroupAlias();
</span><span id="2943" class="l"><a href="#2943"> 2943: </a>            }
</span><span id="2944" class="l"><a href="#2944"> 2944: </a>            <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$cur_y</span>);
</span><span id="2945" class="l"><a href="#2945"> 2945: </a>            <span class="php-comment">//Print page number</span>
</span><span id="2946" class="l"><a href="#2946"> 2946: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;getRTL()) {
</span><span id="2947" class="l"><a href="#2947"> 2947: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$ormargins</span>[<span class="php-quote">'right'</span>]);
</span><span id="2948" class="l"><a href="#2948"> 2948: </a>                <span class="php-var">$this</span>-&gt;Cell(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$pagenumtxt</span>, <span class="php-quote">'T'</span>, <span class="php-num">0</span>, <span class="php-quote">'L'</span>);
</span><span id="2949" class="l"><a href="#2949"> 2949: </a>            } <span class="php-keyword1">else</span> {
</span><span id="2950" class="l"><a href="#2950"> 2950: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$ormargins</span>[<span class="php-quote">'left'</span>]);
</span><span id="2951" class="l"><a href="#2951"> 2951: </a>                <span class="php-var">$this</span>-&gt;Cell(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$pagenumtxt</span>, <span class="php-quote">'T'</span>, <span class="php-num">0</span>, <span class="php-quote">'R'</span>);
</span><span id="2952" class="l"><a href="#2952"> 2952: </a>            }
</span><span id="2953" class="l"><a href="#2953"> 2953: </a>        }
</span><span id="2954" class="l"><a href="#2954"> 2954: </a>
</span><span id="2955" class="l"><a href="#2955"> 2955: </a>        <span class="php-comment">/**
</span></span><span id="2956" class="l"><a href="#2956"> 2956: </a><span class="php-comment">         * This method is used to render the page header.
</span></span><span id="2957" class="l"><a href="#2957"> 2957: </a><span class="php-comment">         * @access protected
</span></span><span id="2958" class="l"><a href="#2958"> 2958: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="2959" class="l"><a href="#2959"> 2959: </a><span class="php-comment">         */</span>
</span><span id="2960" class="l"><a href="#2960"> 2960: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setHeader() {
</span><span id="2961" class="l"><a href="#2961"> 2961: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;print_header) {
</span><span id="2962" class="l"><a href="#2962"> 2962: </a>                <span class="php-var">$temp_thead</span> = <span class="php-var">$this</span>-&gt;thead;
</span><span id="2963" class="l"><a href="#2963"> 2963: </a>                <span class="php-var">$temp_theadMargins</span> = <span class="php-var">$this</span>-&gt;theadMargins;
</span><span id="2964" class="l"><a href="#2964"> 2964: </a>                <span class="php-var">$lasth</span> = <span class="php-var">$this</span>-&gt;lasth;
</span><span id="2965" class="l"><a href="#2965"> 2965: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'q'</span>);
</span><span id="2966" class="l"><a href="#2966"> 2966: </a>                <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$this</span>-&gt;original_rMargin;
</span><span id="2967" class="l"><a href="#2967"> 2967: </a>                <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$this</span>-&gt;original_lMargin;
</span><span id="2968" class="l"><a href="#2968"> 2968: </a>                <span class="php-var">$this</span>-&gt;cMargin = <span class="php-num">0</span>;
</span><span id="2969" class="l"><a href="#2969"> 2969: </a>                <span class="php-comment">//set current position</span>
</span><span id="2970" class="l"><a href="#2970"> 2970: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="2971" class="l"><a href="#2971"> 2971: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_rMargin, <span class="php-var">$this</span>-&gt;header_margin);
</span><span id="2972" class="l"><a href="#2972"> 2972: </a>                } <span class="php-keyword1">else</span> {
</span><span id="2973" class="l"><a href="#2973"> 2973: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_lMargin, <span class="php-var">$this</span>-&gt;header_margin);
</span><span id="2974" class="l"><a href="#2974"> 2974: </a>                }
</span><span id="2975" class="l"><a href="#2975"> 2975: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$this</span>-&gt;header_font[<span class="php-num">0</span>], <span class="php-var">$this</span>-&gt;header_font[<span class="php-num">1</span>], <span class="php-var">$this</span>-&gt;header_font[<span class="php-num">2</span>]);
</span><span id="2976" class="l"><a href="#2976"> 2976: </a>                <span class="php-var">$this</span>-&gt;<span class="php-keyword2">Header</span>();
</span><span id="2977" class="l"><a href="#2977"> 2977: </a>                <span class="php-comment">//restore position</span>
</span><span id="2978" class="l"><a href="#2978"> 2978: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="2979" class="l"><a href="#2979"> 2979: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_rMargin, <span class="php-var">$this</span>-&gt;tMargin);
</span><span id="2980" class="l"><a href="#2980"> 2980: </a>                } <span class="php-keyword1">else</span> {
</span><span id="2981" class="l"><a href="#2981"> 2981: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_lMargin, <span class="php-var">$this</span>-&gt;tMargin);
</span><span id="2982" class="l"><a href="#2982"> 2982: </a>                }
</span><span id="2983" class="l"><a href="#2983"> 2983: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'Q'</span>);
</span><span id="2984" class="l"><a href="#2984"> 2984: </a>                <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$lasth</span>;
</span><span id="2985" class="l"><a href="#2985"> 2985: </a>                <span class="php-var">$this</span>-&gt;thead = <span class="php-var">$temp_thead</span>;
</span><span id="2986" class="l"><a href="#2986"> 2986: </a>                <span class="php-var">$this</span>-&gt;theadMargins = <span class="php-var">$temp_theadMargins</span>;
</span><span id="2987" class="l"><a href="#2987"> 2987: </a>                <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">false</span>;
</span><span id="2988" class="l"><a href="#2988"> 2988: </a>            }
</span><span id="2989" class="l"><a href="#2989"> 2989: </a>        }
</span><span id="2990" class="l"><a href="#2990"> 2990: </a>
</span><span id="2991" class="l"><a href="#2991"> 2991: </a>        <span class="php-comment">/**
</span></span><span id="2992" class="l"><a href="#2992"> 2992: </a><span class="php-comment">         * This method is used to render the page footer.
</span></span><span id="2993" class="l"><a href="#2993"> 2993: </a><span class="php-comment">         * @access protected
</span></span><span id="2994" class="l"><a href="#2994"> 2994: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="2995" class="l"><a href="#2995"> 2995: </a><span class="php-comment">         */</span>
</span><span id="2996" class="l"><a href="#2996"> 2996: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setFooter() {
</span><span id="2997" class="l"><a href="#2997"> 2997: </a>            <span class="php-comment">//Page footer</span>
</span><span id="2998" class="l"><a href="#2998"> 2998: </a>            <span class="php-comment">// save current graphic settings</span>
</span><span id="2999" class="l"><a href="#2999"> 2999: </a>            <span class="php-var">$gvars</span> = <span class="php-var">$this</span>-&gt;getGraphicVars();
</span><span id="3000" class="l"><a href="#3000"> 3000: </a>            <span class="php-comment">// mark this point</span>
</span><span id="3001" class="l"><a href="#3001"> 3001: </a>            <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="3002" class="l"><a href="#3002"> 3002: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="3003" class="l"><a href="#3003"> 3003: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;print_footer) {
</span><span id="3004" class="l"><a href="#3004"> 3004: </a>                <span class="php-var">$temp_thead</span> = <span class="php-var">$this</span>-&gt;thead;
</span><span id="3005" class="l"><a href="#3005"> 3005: </a>                <span class="php-var">$temp_theadMargins</span> = <span class="php-var">$this</span>-&gt;theadMargins;
</span><span id="3006" class="l"><a href="#3006"> 3006: </a>                <span class="php-var">$lasth</span> = <span class="php-var">$this</span>-&gt;lasth;
</span><span id="3007" class="l"><a href="#3007"> 3007: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'q'</span>);
</span><span id="3008" class="l"><a href="#3008"> 3008: </a>                <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$this</span>-&gt;original_rMargin;
</span><span id="3009" class="l"><a href="#3009"> 3009: </a>                <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$this</span>-&gt;original_lMargin;
</span><span id="3010" class="l"><a href="#3010"> 3010: </a>                <span class="php-var">$this</span>-&gt;cMargin = <span class="php-num">0</span>;
</span><span id="3011" class="l"><a href="#3011"> 3011: </a>                <span class="php-comment">//set current position</span>
</span><span id="3012" class="l"><a href="#3012"> 3012: </a>                <span class="php-var">$footer_y</span> = <span class="php-var">$this</span>-&gt;h - <span class="php-var">$this</span>-&gt;footer_margin;
</span><span id="3013" class="l"><a href="#3013"> 3013: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="3014" class="l"><a href="#3014"> 3014: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_rMargin, <span class="php-var">$footer_y</span>);
</span><span id="3015" class="l"><a href="#3015"> 3015: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3016" class="l"><a href="#3016"> 3016: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_lMargin, <span class="php-var">$footer_y</span>);
</span><span id="3017" class="l"><a href="#3017"> 3017: </a>                }
</span><span id="3018" class="l"><a href="#3018"> 3018: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$this</span>-&gt;footer_font[<span class="php-num">0</span>], <span class="php-var">$this</span>-&gt;footer_font[<span class="php-num">1</span>], <span class="php-var">$this</span>-&gt;footer_font[<span class="php-num">2</span>]);
</span><span id="3019" class="l"><a href="#3019"> 3019: </a>                <span class="php-var">$this</span>-&gt;Footer();
</span><span id="3020" class="l"><a href="#3020"> 3020: </a>                <span class="php-comment">//restore position</span>
</span><span id="3021" class="l"><a href="#3021"> 3021: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="3022" class="l"><a href="#3022"> 3022: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_rMargin, <span class="php-var">$this</span>-&gt;tMargin);
</span><span id="3023" class="l"><a href="#3023"> 3023: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3024" class="l"><a href="#3024"> 3024: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;original_lMargin, <span class="php-var">$this</span>-&gt;tMargin);
</span><span id="3025" class="l"><a href="#3025"> 3025: </a>                }
</span><span id="3026" class="l"><a href="#3026"> 3026: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'Q'</span>);
</span><span id="3027" class="l"><a href="#3027"> 3027: </a>                <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$lasth</span>;
</span><span id="3028" class="l"><a href="#3028"> 3028: </a>                <span class="php-var">$this</span>-&gt;thead = <span class="php-var">$temp_thead</span>;
</span><span id="3029" class="l"><a href="#3029"> 3029: </a>                <span class="php-var">$this</span>-&gt;theadMargins = <span class="php-var">$temp_theadMargins</span>;
</span><span id="3030" class="l"><a href="#3030"> 3030: </a>            }
</span><span id="3031" class="l"><a href="#3031"> 3031: </a>            <span class="php-comment">// restore graphic settings</span>
</span><span id="3032" class="l"><a href="#3032"> 3032: </a>            <span class="php-var">$this</span>-&gt;setGraphicVars(<span class="php-var">$gvars</span>);
</span><span id="3033" class="l"><a href="#3033"> 3033: </a>            <span class="php-comment">// calculate footer length</span>
</span><span id="3034" class="l"><a href="#3034"> 3034: </a>            <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page] - <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] + <span class="php-num">1</span>;
</span><span id="3035" class="l"><a href="#3035"> 3035: </a>        }
</span><span id="3036" class="l"><a href="#3036"> 3036: </a>
</span><span id="3037" class="l"><a href="#3037"> 3037: </a>        <span class="php-comment">/**
</span></span><span id="3038" class="l"><a href="#3038"> 3038: </a><span class="php-comment">         * This method is used to render the table header on new page (if any).
</span></span><span id="3039" class="l"><a href="#3039"> 3039: </a><span class="php-comment">         * @access protected
</span></span><span id="3040" class="l"><a href="#3040"> 3040: </a><span class="php-comment">         * @since 4.5.030 (2009-03-25)
</span></span><span id="3041" class="l"><a href="#3041"> 3041: </a><span class="php-comment">         */</span>
</span><span id="3042" class="l"><a href="#3042"> 3042: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setTableHeader() {
</span><span id="3043" class="l"><a href="#3043"> 3043: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;num_columns &gt; <span class="php-num">1</span>) {
</span><span id="3044" class="l"><a href="#3044"> 3044: </a>                <span class="php-comment">// multi column mode</span>
</span><span id="3045" class="l"><a href="#3045"> 3045: </a>                <span class="php-keyword1">return</span>;
</span><span id="3046" class="l"><a href="#3046"> 3046: </a>            }
</span><span id="3047" class="l"><a href="#3047"> 3047: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'top'</span>])) {
</span><span id="3048" class="l"><a href="#3048"> 3048: </a>                <span class="php-comment">// restore the original top-margin</span>
</span><span id="3049" class="l"><a href="#3049"> 3049: </a>                <span class="php-var">$this</span>-&gt;tMargin = <span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'top'</span>];
</span><span id="3050" class="l"><a href="#3050"> 3050: </a>                <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'tm'</span>] = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="3051" class="l"><a href="#3051"> 3051: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="3052" class="l"><a href="#3052"> 3052: </a>            }
</span><span id="3053" class="l"><a href="#3053"> 3053: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;thead) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;inthead)) {
</span><span id="3054" class="l"><a href="#3054"> 3054: </a>                <span class="php-comment">// set margins</span>
</span><span id="3055" class="l"><a href="#3055"> 3055: </a>                <span class="php-var">$prev_lMargin</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="3056" class="l"><a href="#3056"> 3056: </a>                <span class="php-var">$prev_rMargin</span> = <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="3057" class="l"><a href="#3057"> 3057: </a>                <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>];
</span><span id="3058" class="l"><a href="#3058"> 3058: </a>                <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>];
</span><span id="3059" class="l"><a href="#3059"> 3059: </a>                <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'cmargin'</span>];
</span><span id="3060" class="l"><a href="#3060"> 3060: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="3061" class="l"><a href="#3061"> 3061: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="3062" class="l"><a href="#3062"> 3062: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3063" class="l"><a href="#3063"> 3063: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="3064" class="l"><a href="#3064"> 3064: </a>                }
</span><span id="3065" class="l"><a href="#3065"> 3065: </a>                <span class="php-comment">// print table header</span>
</span><span id="3066" class="l"><a href="#3066"> 3066: </a>                <span class="php-var">$this</span>-&gt;writeHTML(<span class="php-var">$this</span>-&gt;thead, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-quote">''</span>);
</span><span id="3067" class="l"><a href="#3067"> 3067: </a>                <span class="php-comment">// set new top margin to skip the table headers</span>
</span><span id="3068" class="l"><a href="#3068"> 3068: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'top'</span>])) {
</span><span id="3069" class="l"><a href="#3069"> 3069: </a>                    <span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'top'</span>] = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="3070" class="l"><a href="#3070"> 3070: </a>                }
</span><span id="3071" class="l"><a href="#3071"> 3071: </a>                <span class="php-var">$this</span>-&gt;tMargin = <span class="php-var">$this</span>-&gt;y;
</span><span id="3072" class="l"><a href="#3072"> 3072: </a>                <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'tm'</span>] = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="3073" class="l"><a href="#3073"> 3073: </a>                <span class="php-var">$this</span>-&gt;lasth = <span class="php-num">0</span>;
</span><span id="3074" class="l"><a href="#3074"> 3074: </a>                <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$prev_lMargin</span>;
</span><span id="3075" class="l"><a href="#3075"> 3075: </a>                <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$prev_rMargin</span>;
</span><span id="3076" class="l"><a href="#3076"> 3076: </a>            }
</span><span id="3077" class="l"><a href="#3077"> 3077: </a>        }
</span><span id="3078" class="l"><a href="#3078"> 3078: </a>
</span><span id="3079" class="l"><a href="#3079"> 3079: </a>        <span class="php-comment">/**
</span></span><span id="3080" class="l"><a href="#3080"> 3080: </a><span class="php-comment">         * Returns the current page number.
</span></span><span id="3081" class="l"><a href="#3081"> 3081: </a><span class="php-comment">         * @return int page number
</span></span><span id="3082" class="l"><a href="#3082"> 3082: </a><span class="php-comment">         * @access public
</span></span><span id="3083" class="l"><a href="#3083"> 3083: </a><span class="php-comment">         * @since 1.0
</span></span><span id="3084" class="l"><a href="#3084"> 3084: </a><span class="php-comment">         * @see AliasNbPages(), getAliasNbPages()
</span></span><span id="3085" class="l"><a href="#3085"> 3085: </a><span class="php-comment">         */</span>
</span><span id="3086" class="l"><a href="#3086"> 3086: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> PageNo() {
</span><span id="3087" class="l"><a href="#3087"> 3087: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;page;
</span><span id="3088" class="l"><a href="#3088"> 3088: </a>        }
</span><span id="3089" class="l"><a href="#3089"> 3089: </a>
</span><span id="3090" class="l"><a href="#3090"> 3090: </a>        <span class="php-comment">/**
</span></span><span id="3091" class="l"><a href="#3091"> 3091: </a><span class="php-comment">         * Defines a new spot color.
</span></span><span id="3092" class="l"><a href="#3092"> 3092: </a><span class="php-comment">         * It can be expressed in RGB components or gray scale.
</span></span><span id="3093" class="l"><a href="#3093"> 3093: </a><span class="php-comment">         * The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="3094" class="l"><a href="#3094"> 3094: </a><span class="php-comment">         * @param int $c Cyan color for CMYK. Value between 0 and 255
</span></span><span id="3095" class="l"><a href="#3095"> 3095: </a><span class="php-comment">         * @param int $m Magenta color for CMYK. Value between 0 and 255
</span></span><span id="3096" class="l"><a href="#3096"> 3096: </a><span class="php-comment">         * @param int $y Yellow color for CMYK. Value between 0 and 255
</span></span><span id="3097" class="l"><a href="#3097"> 3097: </a><span class="php-comment">         * @param int $k Key (Black) color for CMYK. Value between 0 and 255
</span></span><span id="3098" class="l"><a href="#3098"> 3098: </a><span class="php-comment">         * @access public
</span></span><span id="3099" class="l"><a href="#3099"> 3099: </a><span class="php-comment">         * @since 4.0.024 (2008-09-12)
</span></span><span id="3100" class="l"><a href="#3100"> 3100: </a><span class="php-comment">         * @see SetDrawSpotColor(), SetFillSpotColor(), SetTextSpotColor()
</span></span><span id="3101" class="l"><a href="#3101"> 3101: </a><span class="php-comment">         */</span>
</span><span id="3102" class="l"><a href="#3102"> 3102: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> AddSpotColor(<span class="php-var">$name</span>, <span class="php-var">$c</span>, <span class="php-var">$m</span>, <span class="php-var">$y</span>, <span class="php-var">$k</span>) {
</span><span id="3103" class="l"><a href="#3103"> 3103: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>])) {
</span><span id="3104" class="l"><a href="#3104"> 3104: </a>                <span class="php-var">$i</span> = <span class="php-num">1</span> + <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;spot_colors);
</span><span id="3105" class="l"><a href="#3105"> 3105: </a>                <span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'i'</span> =&gt; <span class="php-var">$i</span>, <span class="php-quote">'c'</span> =&gt; <span class="php-var">$c</span>, <span class="php-quote">'m'</span> =&gt; <span class="php-var">$m</span>, <span class="php-quote">'y'</span> =&gt; <span class="php-var">$y</span>, <span class="php-quote">'k'</span> =&gt; <span class="php-var">$k</span>);
</span><span id="3106" class="l"><a href="#3106"> 3106: </a>            }
</span><span id="3107" class="l"><a href="#3107"> 3107: </a>        }
</span><span id="3108" class="l"><a href="#3108"> 3108: </a>
</span><span id="3109" class="l"><a href="#3109"> 3109: </a>        <span class="php-comment">/**
</span></span><span id="3110" class="l"><a href="#3110"> 3110: </a><span class="php-comment">         * Defines the color used for all drawing operations (lines, rectangles and cell borders).
</span></span><span id="3111" class="l"><a href="#3111"> 3111: </a><span class="php-comment">         * It can be expressed in RGB components or gray scale.
</span></span><span id="3112" class="l"><a href="#3112"> 3112: </a><span class="php-comment">         * The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="3113" class="l"><a href="#3113"> 3113: </a><span class="php-comment">         * @param array $color array of colors
</span></span><span id="3114" class="l"><a href="#3114"> 3114: </a><span class="php-comment">         * @access public
</span></span><span id="3115" class="l"><a href="#3115"> 3115: </a><span class="php-comment">         * @since 3.1.000 (2008-06-11)
</span></span><span id="3116" class="l"><a href="#3116"> 3116: </a><span class="php-comment">         * @see SetDrawColor()
</span></span><span id="3117" class="l"><a href="#3117"> 3117: </a><span class="php-comment">         */</span>
</span><span id="3118" class="l"><a href="#3118"> 3118: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetDrawColorArray(<span class="php-var">$color</span>) {
</span><span id="3119" class="l"><a href="#3119"> 3119: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$color</span>)) {
</span><span id="3120" class="l"><a href="#3120"> 3120: </a>                <span class="php-var">$color</span> = <span class="php-keyword2">array_values</span>(<span class="php-var">$color</span>);
</span><span id="3121" class="l"><a href="#3121"> 3121: </a>                <span class="php-var">$r</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">0</span>]) ? <span class="php-var">$color</span>[<span class="php-num">0</span>] : -<span class="php-num">1</span>;
</span><span id="3122" class="l"><a href="#3122"> 3122: </a>                <span class="php-var">$g</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">1</span>]) ? <span class="php-var">$color</span>[<span class="php-num">1</span>] : -<span class="php-num">1</span>;
</span><span id="3123" class="l"><a href="#3123"> 3123: </a>                <span class="php-var">$b</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">2</span>]) ? <span class="php-var">$color</span>[<span class="php-num">2</span>] : -<span class="php-num">1</span>;
</span><span id="3124" class="l"><a href="#3124"> 3124: </a>                <span class="php-var">$k</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">3</span>]) ? <span class="php-var">$color</span>[<span class="php-num">3</span>] : -<span class="php-num">1</span>;
</span><span id="3125" class="l"><a href="#3125"> 3125: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$r</span> &gt;= <span class="php-num">0</span>) {
</span><span id="3126" class="l"><a href="#3126"> 3126: </a>                    <span class="php-var">$this</span>-&gt;SetDrawColor(<span class="php-var">$r</span>, <span class="php-var">$g</span>, <span class="php-var">$b</span>, <span class="php-var">$k</span>);
</span><span id="3127" class="l"><a href="#3127"> 3127: </a>                }
</span><span id="3128" class="l"><a href="#3128"> 3128: </a>            }
</span><span id="3129" class="l"><a href="#3129"> 3129: </a>        }
</span><span id="3130" class="l"><a href="#3130"> 3130: </a>
</span><span id="3131" class="l"><a href="#3131"> 3131: </a>        <span class="php-comment">/**
</span></span><span id="3132" class="l"><a href="#3132"> 3132: </a><span class="php-comment">         * Defines the color used for all drawing operations (lines, rectangles and cell borders). It can be expressed in RGB components or gray scale. The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="3133" class="l"><a href="#3133"> 3133: </a><span class="php-comment">         * @param int $col1 Gray level for single color, or Red color for RGB, or Cyan color for CMYK. Value between 0 and 255
</span></span><span id="3134" class="l"><a href="#3134"> 3134: </a><span class="php-comment">         * @param int $col2 Green color for RGB, or Magenta color for CMYK. Value between 0 and 255
</span></span><span id="3135" class="l"><a href="#3135"> 3135: </a><span class="php-comment">         * @param int $col3 Blue color for RGB, or Yellow color for CMYK. Value between 0 and 255
</span></span><span id="3136" class="l"><a href="#3136"> 3136: </a><span class="php-comment">         * @param int $col4 Key (Black) color for CMYK. Value between 0 and 255
</span></span><span id="3137" class="l"><a href="#3137"> 3137: </a><span class="php-comment">         * @access public
</span></span><span id="3138" class="l"><a href="#3138"> 3138: </a><span class="php-comment">         * @since 1.3
</span></span><span id="3139" class="l"><a href="#3139"> 3139: </a><span class="php-comment">         * @see SetDrawColorArray(), SetFillColor(), SetTextColor(), Line(), Rect(), Cell(), MultiCell()
</span></span><span id="3140" class="l"><a href="#3140"> 3140: </a><span class="php-comment">         */</span>
</span><span id="3141" class="l"><a href="#3141"> 3141: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetDrawColor(<span class="php-var">$col1</span>=<span class="php-num">0</span>, <span class="php-var">$col2</span>=-<span class="php-num">1</span>, <span class="php-var">$col3</span>=-<span class="php-num">1</span>, <span class="php-var">$col4</span>=-<span class="php-num">1</span>) {
</span><span id="3142" class="l"><a href="#3142"> 3142: </a>            <span class="php-comment">// set default values</span>
</span><span id="3143" class="l"><a href="#3143"> 3143: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col1</span>)) {
</span><span id="3144" class="l"><a href="#3144"> 3144: </a>                <span class="php-var">$col1</span> = <span class="php-num">0</span>;
</span><span id="3145" class="l"><a href="#3145"> 3145: </a>            }
</span><span id="3146" class="l"><a href="#3146"> 3146: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col2</span>)) {
</span><span id="3147" class="l"><a href="#3147"> 3147: </a>                <span class="php-var">$col2</span> = -<span class="php-num">1</span>;
</span><span id="3148" class="l"><a href="#3148"> 3148: </a>            }
</span><span id="3149" class="l"><a href="#3149"> 3149: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col3</span>)) {
</span><span id="3150" class="l"><a href="#3150"> 3150: </a>                <span class="php-var">$col3</span> = -<span class="php-num">1</span>;
</span><span id="3151" class="l"><a href="#3151"> 3151: </a>            }
</span><span id="3152" class="l"><a href="#3152"> 3152: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col4</span>)) {
</span><span id="3153" class="l"><a href="#3153"> 3153: </a>                <span class="php-var">$col4</span> = -<span class="php-num">1</span>;
</span><span id="3154" class="l"><a href="#3154"> 3154: </a>            }
</span><span id="3155" class="l"><a href="#3155"> 3155: </a>            <span class="php-comment">//Set color for all stroking operations</span>
</span><span id="3156" class="l"><a href="#3156"> 3156: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$col2</span> == -<span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$col3</span> == -<span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$col4</span> == -<span class="php-num">1</span>)) {
</span><span id="3157" class="l"><a href="#3157"> 3157: </a>                <span class="php-comment">// Grey scale</span>
</span><span id="3158" class="l"><a href="#3158"> 3158: </a>                <span class="php-var">$this</span>-&gt;DrawColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F G'</span>, <span class="php-var">$col1</span>/<span class="php-num">255</span>);
</span><span id="3159" class="l"><a href="#3159"> 3159: </a>                <span class="php-var">$this</span>-&gt;strokecolor = <span class="php-keyword1">array</span>(<span class="php-quote">'G'</span> =&gt; <span class="php-var">$col1</span>);
</span><span id="3160" class="l"><a href="#3160"> 3160: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$col4</span> == -<span class="php-num">1</span>) {
</span><span id="3161" class="l"><a href="#3161"> 3161: </a>                <span class="php-comment">// RGB</span>
</span><span id="3162" class="l"><a href="#3162"> 3162: </a>                <span class="php-var">$this</span>-&gt;DrawColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F RG'</span>, <span class="php-var">$col1</span>/<span class="php-num">255</span>, <span class="php-var">$col2</span>/<span class="php-num">255</span>, <span class="php-var">$col3</span>/<span class="php-num">255</span>);
</span><span id="3163" class="l"><a href="#3163"> 3163: </a>                <span class="php-var">$this</span>-&gt;strokecolor = <span class="php-keyword1">array</span>(<span class="php-quote">'R'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'G'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'B'</span> =&gt; <span class="php-var">$col3</span>);
</span><span id="3164" class="l"><a href="#3164"> 3164: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3165" class="l"><a href="#3165"> 3165: </a>                <span class="php-comment">// CMYK</span>
</span><span id="3166" class="l"><a href="#3166"> 3166: </a>                <span class="php-var">$this</span>-&gt;DrawColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F K'</span>, <span class="php-var">$col1</span>/<span class="php-num">100</span>, <span class="php-var">$col2</span>/<span class="php-num">100</span>, <span class="php-var">$col3</span>/<span class="php-num">100</span>, <span class="php-var">$col4</span>/<span class="php-num">100</span>);
</span><span id="3167" class="l"><a href="#3167"> 3167: </a>                <span class="php-var">$this</span>-&gt;strokecolor = <span class="php-keyword1">array</span>(<span class="php-quote">'C'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'M'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'Y'</span> =&gt; <span class="php-var">$col3</span>, <span class="php-quote">'K'</span> =&gt; <span class="php-var">$col4</span>);
</span><span id="3168" class="l"><a href="#3168"> 3168: </a>            }
</span><span id="3169" class="l"><a href="#3169"> 3169: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) {
</span><span id="3170" class="l"><a href="#3170"> 3170: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;DrawColor);
</span><span id="3171" class="l"><a href="#3171"> 3171: </a>            }
</span><span id="3172" class="l"><a href="#3172"> 3172: </a>        }
</span><span id="3173" class="l"><a href="#3173"> 3173: </a>
</span><span id="3174" class="l"><a href="#3174"> 3174: </a>        <span class="php-comment">/**
</span></span><span id="3175" class="l"><a href="#3175"> 3175: </a><span class="php-comment">         * Defines the spot color used for all drawing operations (lines, rectangles and cell borders).
</span></span><span id="3176" class="l"><a href="#3176"> 3176: </a><span class="php-comment">         * @param string $name name of the spot color
</span></span><span id="3177" class="l"><a href="#3177"> 3177: </a><span class="php-comment">         * @param int $tint the intensity of the color (from 0 to 100 ; 100 = full intensity by default).
</span></span><span id="3178" class="l"><a href="#3178"> 3178: </a><span class="php-comment">         * @access public
</span></span><span id="3179" class="l"><a href="#3179"> 3179: </a><span class="php-comment">         * @since 4.0.024 (2008-09-12)
</span></span><span id="3180" class="l"><a href="#3180"> 3180: </a><span class="php-comment">         * @see AddSpotColor(), SetFillSpotColor(), SetTextSpotColor()
</span></span><span id="3181" class="l"><a href="#3181"> 3181: </a><span class="php-comment">         */</span>
</span><span id="3182" class="l"><a href="#3182"> 3182: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetDrawSpotColor(<span class="php-var">$name</span>, <span class="php-var">$tint</span>=<span class="php-num">100</span>) {
</span><span id="3183" class="l"><a href="#3183"> 3183: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>])) {
</span><span id="3184" class="l"><a href="#3184"> 3184: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Undefined spot color: '</span>.<span class="php-var">$name</span>);
</span><span id="3185" class="l"><a href="#3185"> 3185: </a>            }
</span><span id="3186" class="l"><a href="#3186"> 3186: </a>            <span class="php-var">$this</span>-&gt;DrawColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/CS%d CS %.3F SCN'</span>, <span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>][<span class="php-quote">'i'</span>], <span class="php-var">$tint</span>/<span class="php-num">100</span>);
</span><span id="3187" class="l"><a href="#3187"> 3187: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) {
</span><span id="3188" class="l"><a href="#3188"> 3188: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;DrawColor);
</span><span id="3189" class="l"><a href="#3189"> 3189: </a>            }
</span><span id="3190" class="l"><a href="#3190"> 3190: </a>        }
</span><span id="3191" class="l"><a href="#3191"> 3191: </a>
</span><span id="3192" class="l"><a href="#3192"> 3192: </a>        <span class="php-comment">/**
</span></span><span id="3193" class="l"><a href="#3193"> 3193: </a><span class="php-comment">         * Defines the color used for all filling operations (filled rectangles and cell backgrounds).
</span></span><span id="3194" class="l"><a href="#3194"> 3194: </a><span class="php-comment">         * It can be expressed in RGB components or gray scale.
</span></span><span id="3195" class="l"><a href="#3195"> 3195: </a><span class="php-comment">         * The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="3196" class="l"><a href="#3196"> 3196: </a><span class="php-comment">         * @param array $color array of colors
</span></span><span id="3197" class="l"><a href="#3197"> 3197: </a><span class="php-comment">         * @access public
</span></span><span id="3198" class="l"><a href="#3198"> 3198: </a><span class="php-comment">         * @since 3.1.000 (2008-6-11)
</span></span><span id="3199" class="l"><a href="#3199"> 3199: </a><span class="php-comment">         * @see SetFillColor()
</span></span><span id="3200" class="l"><a href="#3200"> 3200: </a><span class="php-comment">         */</span>
</span><span id="3201" class="l"><a href="#3201"> 3201: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetFillColorArray(<span class="php-var">$color</span>) {
</span><span id="3202" class="l"><a href="#3202"> 3202: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$color</span>)) {
</span><span id="3203" class="l"><a href="#3203"> 3203: </a>                <span class="php-var">$color</span> = <span class="php-keyword2">array_values</span>(<span class="php-var">$color</span>);
</span><span id="3204" class="l"><a href="#3204"> 3204: </a>                <span class="php-var">$r</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">0</span>]) ? <span class="php-var">$color</span>[<span class="php-num">0</span>] : -<span class="php-num">1</span>;
</span><span id="3205" class="l"><a href="#3205"> 3205: </a>                <span class="php-var">$g</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">1</span>]) ? <span class="php-var">$color</span>[<span class="php-num">1</span>] : -<span class="php-num">1</span>;
</span><span id="3206" class="l"><a href="#3206"> 3206: </a>                <span class="php-var">$b</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">2</span>]) ? <span class="php-var">$color</span>[<span class="php-num">2</span>] : -<span class="php-num">1</span>;
</span><span id="3207" class="l"><a href="#3207"> 3207: </a>                <span class="php-var">$k</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">3</span>]) ? <span class="php-var">$color</span>[<span class="php-num">3</span>] : -<span class="php-num">1</span>;
</span><span id="3208" class="l"><a href="#3208"> 3208: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$r</span> &gt;= <span class="php-num">0</span>) {
</span><span id="3209" class="l"><a href="#3209"> 3209: </a>                    <span class="php-var">$this</span>-&gt;SetFillColor(<span class="php-var">$r</span>, <span class="php-var">$g</span>, <span class="php-var">$b</span>, <span class="php-var">$k</span>);
</span><span id="3210" class="l"><a href="#3210"> 3210: </a>                }
</span><span id="3211" class="l"><a href="#3211"> 3211: </a>            }
</span><span id="3212" class="l"><a href="#3212"> 3212: </a>        }
</span><span id="3213" class="l"><a href="#3213"> 3213: </a>
</span><span id="3214" class="l"><a href="#3214"> 3214: </a>        <span class="php-comment">/**
</span></span><span id="3215" class="l"><a href="#3215"> 3215: </a><span class="php-comment">         * Defines the color used for all filling operations (filled rectangles and cell backgrounds). It can be expressed in RGB components or gray scale. The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="3216" class="l"><a href="#3216"> 3216: </a><span class="php-comment">         * @param int $col1 Gray level for single color, or Red color for RGB, or Cyan color for CMYK. Value between 0 and 255
</span></span><span id="3217" class="l"><a href="#3217"> 3217: </a><span class="php-comment">         * @param int $col2 Green color for RGB, or Magenta color for CMYK. Value between 0 and 255
</span></span><span id="3218" class="l"><a href="#3218"> 3218: </a><span class="php-comment">         * @param int $col3 Blue color for RGB, or Yellow color for CMYK. Value between 0 and 255
</span></span><span id="3219" class="l"><a href="#3219"> 3219: </a><span class="php-comment">         * @param int $col4 Key (Black) color for CMYK. Value between 0 and 255
</span></span><span id="3220" class="l"><a href="#3220"> 3220: </a><span class="php-comment">         * @access public
</span></span><span id="3221" class="l"><a href="#3221"> 3221: </a><span class="php-comment">         * @since 1.3
</span></span><span id="3222" class="l"><a href="#3222"> 3222: </a><span class="php-comment">         * @see SetFillColorArray(), SetDrawColor(), SetTextColor(), Rect(), Cell(), MultiCell()
</span></span><span id="3223" class="l"><a href="#3223"> 3223: </a><span class="php-comment">         */</span>
</span><span id="3224" class="l"><a href="#3224"> 3224: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetFillColor(<span class="php-var">$col1</span>=<span class="php-num">0</span>, <span class="php-var">$col2</span>=-<span class="php-num">1</span>, <span class="php-var">$col3</span>=-<span class="php-num">1</span>, <span class="php-var">$col4</span>=-<span class="php-num">1</span>) {
</span><span id="3225" class="l"><a href="#3225"> 3225: </a>            <span class="php-comment">// set default values</span>
</span><span id="3226" class="l"><a href="#3226"> 3226: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col1</span>)) {
</span><span id="3227" class="l"><a href="#3227"> 3227: </a>                <span class="php-var">$col1</span> = <span class="php-num">0</span>;
</span><span id="3228" class="l"><a href="#3228"> 3228: </a>            }
</span><span id="3229" class="l"><a href="#3229"> 3229: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col2</span>)) {
</span><span id="3230" class="l"><a href="#3230"> 3230: </a>                <span class="php-var">$col2</span> = -<span class="php-num">1</span>;
</span><span id="3231" class="l"><a href="#3231"> 3231: </a>            }
</span><span id="3232" class="l"><a href="#3232"> 3232: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col3</span>)) {
</span><span id="3233" class="l"><a href="#3233"> 3233: </a>                <span class="php-var">$col3</span> = -<span class="php-num">1</span>;
</span><span id="3234" class="l"><a href="#3234"> 3234: </a>            }
</span><span id="3235" class="l"><a href="#3235"> 3235: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col4</span>)) {
</span><span id="3236" class="l"><a href="#3236"> 3236: </a>                <span class="php-var">$col4</span> = -<span class="php-num">1</span>;
</span><span id="3237" class="l"><a href="#3237"> 3237: </a>            }
</span><span id="3238" class="l"><a href="#3238"> 3238: </a>            <span class="php-comment">//Set color for all filling operations</span>
</span><span id="3239" class="l"><a href="#3239"> 3239: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$col2</span> == -<span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$col3</span> == -<span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$col4</span> == -<span class="php-num">1</span>)) {
</span><span id="3240" class="l"><a href="#3240"> 3240: </a>                <span class="php-comment">// Grey scale</span>
</span><span id="3241" class="l"><a href="#3241"> 3241: </a>                <span class="php-var">$this</span>-&gt;FillColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F g'</span>, <span class="php-var">$col1</span>/<span class="php-num">255</span>);
</span><span id="3242" class="l"><a href="#3242"> 3242: </a>                <span class="php-var">$this</span>-&gt;bgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'G'</span> =&gt; <span class="php-var">$col1</span>);
</span><span id="3243" class="l"><a href="#3243"> 3243: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$col4</span> == -<span class="php-num">1</span>) {
</span><span id="3244" class="l"><a href="#3244"> 3244: </a>                <span class="php-comment">// RGB</span>
</span><span id="3245" class="l"><a href="#3245"> 3245: </a>                <span class="php-var">$this</span>-&gt;FillColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F rg'</span>, <span class="php-var">$col1</span>/<span class="php-num">255</span>, <span class="php-var">$col2</span>/<span class="php-num">255</span>, <span class="php-var">$col3</span>/<span class="php-num">255</span>);
</span><span id="3246" class="l"><a href="#3246"> 3246: </a>                <span class="php-var">$this</span>-&gt;bgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'R'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'G'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'B'</span> =&gt; <span class="php-var">$col3</span>);
</span><span id="3247" class="l"><a href="#3247"> 3247: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3248" class="l"><a href="#3248"> 3248: </a>                <span class="php-comment">// CMYK</span>
</span><span id="3249" class="l"><a href="#3249"> 3249: </a>                <span class="php-var">$this</span>-&gt;FillColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F k'</span>, <span class="php-var">$col1</span>/<span class="php-num">100</span>, <span class="php-var">$col2</span>/<span class="php-num">100</span>, <span class="php-var">$col3</span>/<span class="php-num">100</span>, <span class="php-var">$col4</span>/<span class="php-num">100</span>);
</span><span id="3250" class="l"><a href="#3250"> 3250: </a>                <span class="php-var">$this</span>-&gt;bgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'C'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'M'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'Y'</span> =&gt; <span class="php-var">$col3</span>, <span class="php-quote">'K'</span> =&gt; <span class="php-var">$col4</span>);
</span><span id="3251" class="l"><a href="#3251"> 3251: </a>            }
</span><span id="3252" class="l"><a href="#3252"> 3252: </a>            <span class="php-var">$this</span>-&gt;ColorFlag = (<span class="php-var">$this</span>-&gt;FillColor != <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="3253" class="l"><a href="#3253"> 3253: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) {
</span><span id="3254" class="l"><a href="#3254"> 3254: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;FillColor);
</span><span id="3255" class="l"><a href="#3255"> 3255: </a>            }
</span><span id="3256" class="l"><a href="#3256"> 3256: </a>        }
</span><span id="3257" class="l"><a href="#3257"> 3257: </a>
</span><span id="3258" class="l"><a href="#3258"> 3258: </a>        <span class="php-comment">/**
</span></span><span id="3259" class="l"><a href="#3259"> 3259: </a><span class="php-comment">         * Defines the spot color used for all filling operations (filled rectangles and cell backgrounds).
</span></span><span id="3260" class="l"><a href="#3260"> 3260: </a><span class="php-comment">         * @param string $name name of the spot color
</span></span><span id="3261" class="l"><a href="#3261"> 3261: </a><span class="php-comment">         * @param int $tint the intensity of the color (from 0 to 100 ; 100 = full intensity by default).
</span></span><span id="3262" class="l"><a href="#3262"> 3262: </a><span class="php-comment">         * @access public
</span></span><span id="3263" class="l"><a href="#3263"> 3263: </a><span class="php-comment">         * @since 4.0.024 (2008-09-12)
</span></span><span id="3264" class="l"><a href="#3264"> 3264: </a><span class="php-comment">         * @see AddSpotColor(), SetDrawSpotColor(), SetTextSpotColor()
</span></span><span id="3265" class="l"><a href="#3265"> 3265: </a><span class="php-comment">         */</span>
</span><span id="3266" class="l"><a href="#3266"> 3266: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetFillSpotColor(<span class="php-var">$name</span>, <span class="php-var">$tint</span>=<span class="php-num">100</span>) {
</span><span id="3267" class="l"><a href="#3267"> 3267: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>])) {
</span><span id="3268" class="l"><a href="#3268"> 3268: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Undefined spot color: '</span>.<span class="php-var">$name</span>);
</span><span id="3269" class="l"><a href="#3269"> 3269: </a>            }
</span><span id="3270" class="l"><a href="#3270"> 3270: </a>            <span class="php-var">$this</span>-&gt;FillColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/CS%d cs %.3F scn'</span>, <span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>][<span class="php-quote">'i'</span>], <span class="php-var">$tint</span>/<span class="php-num">100</span>);
</span><span id="3271" class="l"><a href="#3271"> 3271: </a>            <span class="php-var">$this</span>-&gt;ColorFlag = (<span class="php-var">$this</span>-&gt;FillColor != <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="3272" class="l"><a href="#3272"> 3272: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) {
</span><span id="3273" class="l"><a href="#3273"> 3273: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;FillColor);
</span><span id="3274" class="l"><a href="#3274"> 3274: </a>            }
</span><span id="3275" class="l"><a href="#3275"> 3275: </a>        }
</span><span id="3276" class="l"><a href="#3276"> 3276: </a>
</span><span id="3277" class="l"><a href="#3277"> 3277: </a>        <span class="php-comment">/**
</span></span><span id="3278" class="l"><a href="#3278"> 3278: </a><span class="php-comment">         * Defines the color used for text. It can be expressed in RGB components or gray scale.
</span></span><span id="3279" class="l"><a href="#3279"> 3279: </a><span class="php-comment">         * The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="3280" class="l"><a href="#3280"> 3280: </a><span class="php-comment">         * @param array $color array of colors
</span></span><span id="3281" class="l"><a href="#3281"> 3281: </a><span class="php-comment">         * @access public
</span></span><span id="3282" class="l"><a href="#3282"> 3282: </a><span class="php-comment">         * @since 3.1.000 (2008-6-11)
</span></span><span id="3283" class="l"><a href="#3283"> 3283: </a><span class="php-comment">         * @see SetFillColor()
</span></span><span id="3284" class="l"><a href="#3284"> 3284: </a><span class="php-comment">         */</span>
</span><span id="3285" class="l"><a href="#3285"> 3285: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetTextColorArray(<span class="php-var">$color</span>) {
</span><span id="3286" class="l"><a href="#3286"> 3286: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$color</span>)) {
</span><span id="3287" class="l"><a href="#3287"> 3287: </a>                <span class="php-var">$color</span> = <span class="php-keyword2">array_values</span>(<span class="php-var">$color</span>);
</span><span id="3288" class="l"><a href="#3288"> 3288: </a>                <span class="php-var">$r</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">0</span>]) ? <span class="php-var">$color</span>[<span class="php-num">0</span>] : -<span class="php-num">1</span>;
</span><span id="3289" class="l"><a href="#3289"> 3289: </a>                <span class="php-var">$g</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">1</span>]) ? <span class="php-var">$color</span>[<span class="php-num">1</span>] : -<span class="php-num">1</span>;
</span><span id="3290" class="l"><a href="#3290"> 3290: </a>                <span class="php-var">$b</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">2</span>]) ? <span class="php-var">$color</span>[<span class="php-num">2</span>] : -<span class="php-num">1</span>;
</span><span id="3291" class="l"><a href="#3291"> 3291: </a>                <span class="php-var">$k</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$color</span>[<span class="php-num">3</span>]) ? <span class="php-var">$color</span>[<span class="php-num">3</span>] : -<span class="php-num">1</span>;
</span><span id="3292" class="l"><a href="#3292"> 3292: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$r</span> &gt;= <span class="php-num">0</span>) {
</span><span id="3293" class="l"><a href="#3293"> 3293: </a>                    <span class="php-var">$this</span>-&gt;SetTextColor(<span class="php-var">$r</span>, <span class="php-var">$g</span>, <span class="php-var">$b</span>, <span class="php-var">$k</span>);
</span><span id="3294" class="l"><a href="#3294"> 3294: </a>                }
</span><span id="3295" class="l"><a href="#3295"> 3295: </a>            }
</span><span id="3296" class="l"><a href="#3296"> 3296: </a>        }
</span><span id="3297" class="l"><a href="#3297"> 3297: </a>
</span><span id="3298" class="l"><a href="#3298"> 3298: </a>        <span class="php-comment">/**
</span></span><span id="3299" class="l"><a href="#3299"> 3299: </a><span class="php-comment">         * Defines the color used for text. It can be expressed in RGB components or gray scale. The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="3300" class="l"><a href="#3300"> 3300: </a><span class="php-comment">         * @param int $col1 Gray level for single color, or Red color for RGB, or Cyan color for CMYK. Value between 0 and 255
</span></span><span id="3301" class="l"><a href="#3301"> 3301: </a><span class="php-comment">         * @param int $col2 Green color for RGB, or Magenta color for CMYK. Value between 0 and 255
</span></span><span id="3302" class="l"><a href="#3302"> 3302: </a><span class="php-comment">         * @param int $col3 Blue color for RGB, or Yellow color for CMYK. Value between 0 and 255
</span></span><span id="3303" class="l"><a href="#3303"> 3303: </a><span class="php-comment">         * @param int $col4 Key (Black) color for CMYK. Value between 0 and 255
</span></span><span id="3304" class="l"><a href="#3304"> 3304: </a><span class="php-comment">         * @access public
</span></span><span id="3305" class="l"><a href="#3305"> 3305: </a><span class="php-comment">         * @since 1.3
</span></span><span id="3306" class="l"><a href="#3306"> 3306: </a><span class="php-comment">         * @see SetTextColorArray(), SetDrawColor(), SetFillColor(), Text(), Cell(), MultiCell()
</span></span><span id="3307" class="l"><a href="#3307"> 3307: </a><span class="php-comment">         */</span>
</span><span id="3308" class="l"><a href="#3308"> 3308: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetTextColor(<span class="php-var">$col1</span>=<span class="php-num">0</span>, <span class="php-var">$col2</span>=-<span class="php-num">1</span>, <span class="php-var">$col3</span>=-<span class="php-num">1</span>, <span class="php-var">$col4</span>=-<span class="php-num">1</span>) {
</span><span id="3309" class="l"><a href="#3309"> 3309: </a>            <span class="php-comment">// set default values</span>
</span><span id="3310" class="l"><a href="#3310"> 3310: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col1</span>)) {
</span><span id="3311" class="l"><a href="#3311"> 3311: </a>                <span class="php-var">$col1</span> = <span class="php-num">0</span>;
</span><span id="3312" class="l"><a href="#3312"> 3312: </a>            }
</span><span id="3313" class="l"><a href="#3313"> 3313: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col2</span>)) {
</span><span id="3314" class="l"><a href="#3314"> 3314: </a>                <span class="php-var">$col2</span> = -<span class="php-num">1</span>;
</span><span id="3315" class="l"><a href="#3315"> 3315: </a>            }
</span><span id="3316" class="l"><a href="#3316"> 3316: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col3</span>)) {
</span><span id="3317" class="l"><a href="#3317"> 3317: </a>                <span class="php-var">$col3</span> = -<span class="php-num">1</span>;
</span><span id="3318" class="l"><a href="#3318"> 3318: </a>            }
</span><span id="3319" class="l"><a href="#3319"> 3319: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_numeric</span>(<span class="php-var">$col4</span>)) {
</span><span id="3320" class="l"><a href="#3320"> 3320: </a>                <span class="php-var">$col4</span> = -<span class="php-num">1</span>;
</span><span id="3321" class="l"><a href="#3321"> 3321: </a>            }
</span><span id="3322" class="l"><a href="#3322"> 3322: </a>            <span class="php-comment">//Set color for text</span>
</span><span id="3323" class="l"><a href="#3323"> 3323: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$col2</span> == -<span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$col3</span> == -<span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$col4</span> == -<span class="php-num">1</span>)) {
</span><span id="3324" class="l"><a href="#3324"> 3324: </a>                <span class="php-comment">// Grey scale</span>
</span><span id="3325" class="l"><a href="#3325"> 3325: </a>                <span class="php-var">$this</span>-&gt;TextColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F g'</span>, <span class="php-var">$col1</span>/<span class="php-num">255</span>);
</span><span id="3326" class="l"><a href="#3326"> 3326: </a>                <span class="php-var">$this</span>-&gt;fgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'G'</span> =&gt; <span class="php-var">$col1</span>);
</span><span id="3327" class="l"><a href="#3327"> 3327: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$col4</span> == -<span class="php-num">1</span>) {
</span><span id="3328" class="l"><a href="#3328"> 3328: </a>                <span class="php-comment">// RGB</span>
</span><span id="3329" class="l"><a href="#3329"> 3329: </a>                <span class="php-var">$this</span>-&gt;TextColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F rg'</span>, <span class="php-var">$col1</span>/<span class="php-num">255</span>, <span class="php-var">$col2</span>/<span class="php-num">255</span>, <span class="php-var">$col3</span>/<span class="php-num">255</span>);
</span><span id="3330" class="l"><a href="#3330"> 3330: </a>                <span class="php-var">$this</span>-&gt;fgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'R'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'G'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'B'</span> =&gt; <span class="php-var">$col3</span>);
</span><span id="3331" class="l"><a href="#3331"> 3331: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3332" class="l"><a href="#3332"> 3332: </a>                <span class="php-comment">// CMYK</span>
</span><span id="3333" class="l"><a href="#3333"> 3333: </a>                <span class="php-var">$this</span>-&gt;TextColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F k'</span>, <span class="php-var">$col1</span>/<span class="php-num">100</span>, <span class="php-var">$col2</span>/<span class="php-num">100</span>, <span class="php-var">$col3</span>/<span class="php-num">100</span>, <span class="php-var">$col4</span>/<span class="php-num">100</span>);
</span><span id="3334" class="l"><a href="#3334"> 3334: </a>                <span class="php-var">$this</span>-&gt;fgcolor = <span class="php-keyword1">array</span>(<span class="php-quote">'C'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'M'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'Y'</span> =&gt; <span class="php-var">$col3</span>, <span class="php-quote">'K'</span> =&gt; <span class="php-var">$col4</span>);
</span><span id="3335" class="l"><a href="#3335"> 3335: </a>            }
</span><span id="3336" class="l"><a href="#3336"> 3336: </a>            <span class="php-var">$this</span>-&gt;ColorFlag = (<span class="php-var">$this</span>-&gt;FillColor != <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="3337" class="l"><a href="#3337"> 3337: </a>        }
</span><span id="3338" class="l"><a href="#3338"> 3338: </a>
</span><span id="3339" class="l"><a href="#3339"> 3339: </a>        <span class="php-comment">/**
</span></span><span id="3340" class="l"><a href="#3340"> 3340: </a><span class="php-comment">         * Defines the spot color used for text.
</span></span><span id="3341" class="l"><a href="#3341"> 3341: </a><span class="php-comment">         * @param string $name name of the spot color
</span></span><span id="3342" class="l"><a href="#3342"> 3342: </a><span class="php-comment">         * @param int $tint the intensity of the color (from 0 to 100 ; 100 = full intensity by default).
</span></span><span id="3343" class="l"><a href="#3343"> 3343: </a><span class="php-comment">         * @access public
</span></span><span id="3344" class="l"><a href="#3344"> 3344: </a><span class="php-comment">         * @since 4.0.024 (2008-09-12)
</span></span><span id="3345" class="l"><a href="#3345"> 3345: </a><span class="php-comment">         * @see AddSpotColor(), SetDrawSpotColor(), SetFillSpotColor()
</span></span><span id="3346" class="l"><a href="#3346"> 3346: </a><span class="php-comment">         */</span>
</span><span id="3347" class="l"><a href="#3347"> 3347: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetTextSpotColor(<span class="php-var">$name</span>, <span class="php-var">$tint</span>=<span class="php-num">100</span>) {
</span><span id="3348" class="l"><a href="#3348"> 3348: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>])) {
</span><span id="3349" class="l"><a href="#3349"> 3349: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Undefined spot color: '</span>.<span class="php-var">$name</span>);
</span><span id="3350" class="l"><a href="#3350"> 3350: </a>            }
</span><span id="3351" class="l"><a href="#3351"> 3351: </a>            <span class="php-var">$this</span>-&gt;TextColor = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/CS%d cs %.3F scn'</span>, <span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>][<span class="php-quote">'i'</span>], <span class="php-var">$tint</span>/<span class="php-num">100</span>);
</span><span id="3352" class="l"><a href="#3352"> 3352: </a>            <span class="php-var">$this</span>-&gt;ColorFlag = (<span class="php-var">$this</span>-&gt;FillColor != <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="3353" class="l"><a href="#3353"> 3353: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) {
</span><span id="3354" class="l"><a href="#3354"> 3354: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;TextColor);
</span><span id="3355" class="l"><a href="#3355"> 3355: </a>            }
</span><span id="3356" class="l"><a href="#3356"> 3356: </a>        }
</span><span id="3357" class="l"><a href="#3357"> 3357: </a>
</span><span id="3358" class="l"><a href="#3358"> 3358: </a>        <span class="php-comment">/**
</span></span><span id="3359" class="l"><a href="#3359"> 3359: </a><span class="php-comment">         * Returns the length of a string in user unit. A font must be selected.&lt;br&gt;
</span></span><span id="3360" class="l"><a href="#3360"> 3360: </a><span class="php-comment">         * @param string $s The string whose length is to be computed
</span></span><span id="3361" class="l"><a href="#3361"> 3361: </a><span class="php-comment">         * @param string $fontname Family font. It can be either a name defined by AddFont() or one of the standard families. It is also possible to pass an empty string, in that case, the current family is retained.
</span></span><span id="3362" class="l"><a href="#3362"> 3362: </a><span class="php-comment">         * @param string $fontstyle Font style. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;empty string: regular&lt;/li&gt;&lt;li&gt;B: bold&lt;/li&gt;&lt;li&gt;I: italic&lt;/li&gt;&lt;li&gt;U: underline&lt;/li&gt;&lt;li&gt;D: line-trough&lt;/li&gt;&lt;li&gt;O: overline&lt;/li&gt;&lt;/ul&gt; or any combination. The default value is regular.
</span></span><span id="3363" class="l"><a href="#3363"> 3363: </a><span class="php-comment">         * @param float $fontsize Font size in points. The default value is the current size.
</span></span><span id="3364" class="l"><a href="#3364"> 3364: </a><span class="php-comment">         * @param boolean $getarray if true returns an array of characters widths, if false returns the total length.
</span></span><span id="3365" class="l"><a href="#3365"> 3365: </a><span class="php-comment">         * @return mixed int total string length or array of characted widths
</span></span><span id="3366" class="l"><a href="#3366"> 3366: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="3367" class="l"><a href="#3367"> 3367: </a><span class="php-comment">         * @access public
</span></span><span id="3368" class="l"><a href="#3368"> 3368: </a><span class="php-comment">         * @since 1.2
</span></span><span id="3369" class="l"><a href="#3369"> 3369: </a><span class="php-comment">         */</span>
</span><span id="3370" class="l"><a href="#3370"> 3370: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetStringWidth(<span class="php-var">$s</span>, <span class="php-var">$fontname</span>=<span class="php-quote">''</span>, <span class="php-var">$fontstyle</span>=<span class="php-quote">''</span>, <span class="php-var">$fontsize</span>=<span class="php-num">0</span>, <span class="php-var">$getarray</span>=<span class="php-keyword1">false</span>) {
</span><span id="3371" class="l"><a href="#3371"> 3371: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;GetArrStringWidth(<span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$s</span>), <span class="php-var">$s</span>, <span class="php-var">$this</span>-&gt;tmprtl), <span class="php-var">$fontname</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span>, <span class="php-var">$getarray</span>);
</span><span id="3372" class="l"><a href="#3372"> 3372: </a>        }
</span><span id="3373" class="l"><a href="#3373"> 3373: </a>
</span><span id="3374" class="l"><a href="#3374"> 3374: </a>        <span class="php-comment">/**
</span></span><span id="3375" class="l"><a href="#3375"> 3375: </a><span class="php-comment">         * Returns the string length of an array of chars in user unit or an array of characters widths. A font must be selected.&lt;br&gt;
</span></span><span id="3376" class="l"><a href="#3376"> 3376: </a><span class="php-comment">         * @param string $sa The array of chars whose total length is to be computed
</span></span><span id="3377" class="l"><a href="#3377"> 3377: </a><span class="php-comment">         * @param string $fontname Family font. It can be either a name defined by AddFont() or one of the standard families. It is also possible to pass an empty string, in that case, the current family is retained.
</span></span><span id="3378" class="l"><a href="#3378"> 3378: </a><span class="php-comment">         * @param string $fontstyle Font style. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;empty string: regular&lt;/li&gt;&lt;li&gt;B: bold&lt;/li&gt;&lt;li&gt;I: italic&lt;/li&gt;&lt;li&gt;U: underline&lt;/li&gt;&lt;li&gt;D: line trough&lt;/li&gt;&lt;li&gt;O: overline&lt;/li&gt;&lt;/ul&gt; or any combination. The default value is regular.
</span></span><span id="3379" class="l"><a href="#3379"> 3379: </a><span class="php-comment">         * @param float $fontsize Font size in points. The default value is the current size.
</span></span><span id="3380" class="l"><a href="#3380"> 3380: </a><span class="php-comment">         * @param boolean $getarray if true returns an array of characters widths, if false returns the total length.
</span></span><span id="3381" class="l"><a href="#3381"> 3381: </a><span class="php-comment">         * @return mixed int total string length or array of characted widths
</span></span><span id="3382" class="l"><a href="#3382"> 3382: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="3383" class="l"><a href="#3383"> 3383: </a><span class="php-comment">         * @access public
</span></span><span id="3384" class="l"><a href="#3384"> 3384: </a><span class="php-comment">         * @since 2.4.000 (2008-03-06)
</span></span><span id="3385" class="l"><a href="#3385"> 3385: </a><span class="php-comment">         */</span>
</span><span id="3386" class="l"><a href="#3386"> 3386: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetArrStringWidth(<span class="php-var">$sa</span>, <span class="php-var">$fontname</span>=<span class="php-quote">''</span>, <span class="php-var">$fontstyle</span>=<span class="php-quote">''</span>, <span class="php-var">$fontsize</span>=<span class="php-num">0</span>, <span class="php-var">$getarray</span>=<span class="php-keyword1">false</span>) {
</span><span id="3387" class="l"><a href="#3387"> 3387: </a>            <span class="php-comment">// store current values</span>
</span><span id="3388" class="l"><a href="#3388"> 3388: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fontname</span>)) {
</span><span id="3389" class="l"><a href="#3389"> 3389: </a>                <span class="php-var">$prev_FontFamily</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="3390" class="l"><a href="#3390"> 3390: </a>                <span class="php-var">$prev_FontStyle</span> = <span class="php-var">$this</span>-&gt;FontStyle;
</span><span id="3391" class="l"><a href="#3391"> 3391: </a>                <span class="php-var">$prev_FontSizePt</span> = <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="3392" class="l"><a href="#3392"> 3392: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$fontname</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span>);
</span><span id="3393" class="l"><a href="#3393"> 3393: </a>            }
</span><span id="3394" class="l"><a href="#3394"> 3394: </a>            <span class="php-comment">// convert UTF-8 array to Latin1 if required</span>
</span><span id="3395" class="l"><a href="#3395"> 3395: </a>            <span class="php-var">$sa</span> = <span class="php-var">$this</span>-&gt;UTF8ArrToLatin1(<span class="php-var">$sa</span>);
</span><span id="3396" class="l"><a href="#3396"> 3396: </a>            <span class="php-var">$w</span> = <span class="php-num">0</span>; <span class="php-comment">// total width</span>
</span><span id="3397" class="l"><a href="#3397"> 3397: </a>            <span class="php-var">$wa</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// array of characters widths</span>
</span><span id="3398" class="l"><a href="#3398"> 3398: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$sa</span> <span class="php-keyword1">as</span> <span class="php-var">$char</span>) {
</span><span id="3399" class="l"><a href="#3399"> 3399: </a>                <span class="php-comment">// character width</span>
</span><span id="3400" class="l"><a href="#3400"> 3400: </a>                <span class="php-var">$cw</span> = <span class="php-var">$this</span>-&gt;GetCharWidth(<span class="php-var">$char</span>);
</span><span id="3401" class="l"><a href="#3401"> 3401: </a>                <span class="php-var">$wa</span>[] = <span class="php-var">$cw</span>;
</span><span id="3402" class="l"><a href="#3402"> 3402: </a>                <span class="php-var">$w</span> += <span class="php-var">$cw</span>;
</span><span id="3403" class="l"><a href="#3403"> 3403: </a>            }
</span><span id="3404" class="l"><a href="#3404"> 3404: </a>            <span class="php-comment">// restore previous values</span>
</span><span id="3405" class="l"><a href="#3405"> 3405: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fontname</span>)) {
</span><span id="3406" class="l"><a href="#3406"> 3406: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$prev_FontFamily</span>, <span class="php-var">$prev_FontStyle</span>, <span class="php-var">$prev_FontSizePt</span>);
</span><span id="3407" class="l"><a href="#3407"> 3407: </a>            }
</span><span id="3408" class="l"><a href="#3408"> 3408: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$getarray</span>) {
</span><span id="3409" class="l"><a href="#3409"> 3409: </a>                <span class="php-keyword1">return</span> <span class="php-var">$wa</span>;
</span><span id="3410" class="l"><a href="#3410"> 3410: </a>            }
</span><span id="3411" class="l"><a href="#3411"> 3411: </a>            <span class="php-keyword1">return</span> <span class="php-var">$w</span>;
</span><span id="3412" class="l"><a href="#3412"> 3412: </a>        }
</span><span id="3413" class="l"><a href="#3413"> 3413: </a>
</span><span id="3414" class="l"><a href="#3414"> 3414: </a>        <span class="php-comment">/**
</span></span><span id="3415" class="l"><a href="#3415"> 3415: </a><span class="php-comment">         * Returns the length of the char in user unit for the current font.
</span></span><span id="3416" class="l"><a href="#3416"> 3416: </a><span class="php-comment">         * @param int $char The char code whose length is to be returned
</span></span><span id="3417" class="l"><a href="#3417"> 3417: </a><span class="php-comment">         * @return int char width
</span></span><span id="3418" class="l"><a href="#3418"> 3418: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="3419" class="l"><a href="#3419"> 3419: </a><span class="php-comment">         * @access public
</span></span><span id="3420" class="l"><a href="#3420"> 3420: </a><span class="php-comment">         * @since 2.4.000 (2008-03-06)
</span></span><span id="3421" class="l"><a href="#3421"> 3421: </a><span class="php-comment">         */</span>
</span><span id="3422" class="l"><a href="#3422"> 3422: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetCharWidth(<span class="php-var">$char</span>) {
</span><span id="3423" class="l"><a href="#3423"> 3423: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$char</span> == <span class="php-num">173</span>) {
</span><span id="3424" class="l"><a href="#3424"> 3424: </a>                <span class="php-comment">// SHY character will not be printed</span>
</span><span id="3425" class="l"><a href="#3425"> 3425: </a>                <span class="php-keyword1">return</span> (<span class="php-num">0</span>);
</span><span id="3426" class="l"><a href="#3426"> 3426: </a>            }
</span><span id="3427" class="l"><a href="#3427"> 3427: </a>            <span class="php-var">$cw</span> = &amp;<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'cw'</span>];
</span><span id="3428" class="l"><a href="#3428"> 3428: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cw</span>[<span class="php-var">$char</span>])) {
</span><span id="3429" class="l"><a href="#3429"> 3429: </a>                <span class="php-var">$w</span> = <span class="php-var">$cw</span>[<span class="php-var">$char</span>];
</span><span id="3430" class="l"><a href="#3430"> 3430: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'dw'</span>])) {
</span><span id="3431" class="l"><a href="#3431"> 3431: </a>                <span class="php-comment">// default width</span>
</span><span id="3432" class="l"><a href="#3432"> 3432: </a>                <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'dw'</span>];
</span><span id="3433" class="l"><a href="#3433"> 3433: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cw</span>[<span class="php-num">32</span>])) {
</span><span id="3434" class="l"><a href="#3434"> 3434: </a>                <span class="php-comment">// default width</span>
</span><span id="3435" class="l"><a href="#3435"> 3435: </a>                <span class="php-var">$w</span> = <span class="php-var">$cw</span>[<span class="php-num">32</span>];
</span><span id="3436" class="l"><a href="#3436"> 3436: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3437" class="l"><a href="#3437"> 3437: </a>                <span class="php-var">$w</span> = <span class="php-num">600</span>;
</span><span id="3438" class="l"><a href="#3438"> 3438: </a>            }
</span><span id="3439" class="l"><a href="#3439"> 3439: </a>            <span class="php-keyword1">return</span> (<span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;FontSize / <span class="php-num">1000</span>);
</span><span id="3440" class="l"><a href="#3440"> 3440: </a>        }
</span><span id="3441" class="l"><a href="#3441"> 3441: </a>
</span><span id="3442" class="l"><a href="#3442"> 3442: </a>        <span class="php-comment">/**
</span></span><span id="3443" class="l"><a href="#3443"> 3443: </a><span class="php-comment">         * Returns the numbero of characters in a string.
</span></span><span id="3444" class="l"><a href="#3444"> 3444: </a><span class="php-comment">         * @param string $s The input string.
</span></span><span id="3445" class="l"><a href="#3445"> 3445: </a><span class="php-comment">         * @return int number of characters
</span></span><span id="3446" class="l"><a href="#3446"> 3446: </a><span class="php-comment">         * @access public
</span></span><span id="3447" class="l"><a href="#3447"> 3447: </a><span class="php-comment">         * @since 2.0.0001 (2008-01-07)
</span></span><span id="3448" class="l"><a href="#3448"> 3448: </a><span class="php-comment">         */</span>
</span><span id="3449" class="l"><a href="#3449"> 3449: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetNumChars(<span class="php-var">$s</span>) {
</span><span id="3450" class="l"><a href="#3450"> 3450: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="3451" class="l"><a href="#3451"> 3451: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$s</span>));
</span><span id="3452" class="l"><a href="#3452"> 3452: </a>            }
</span><span id="3453" class="l"><a href="#3453"> 3453: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">strlen</span>(<span class="php-var">$s</span>);
</span><span id="3454" class="l"><a href="#3454"> 3454: </a>        }
</span><span id="3455" class="l"><a href="#3455"> 3455: </a>
</span><span id="3456" class="l"><a href="#3456"> 3456: </a>        <span class="php-comment">/**
</span></span><span id="3457" class="l"><a href="#3457"> 3457: </a><span class="php-comment">         * Fill the list of available fonts ($this-&gt;fontlist).
</span></span><span id="3458" class="l"><a href="#3458"> 3458: </a><span class="php-comment">         * @access protected
</span></span><span id="3459" class="l"><a href="#3459"> 3459: </a><span class="php-comment">         * @since 4.0.013 (2008-07-28)
</span></span><span id="3460" class="l"><a href="#3460"> 3460: </a><span class="php-comment">         */</span>
</span><span id="3461" class="l"><a href="#3461"> 3461: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getFontsList() {
</span><span id="3462" class="l"><a href="#3462"> 3462: </a>            <span class="php-var">$fontsdir</span> = <span class="php-keyword2">opendir</span>(<span class="php-var">$this</span>-&gt;_getfontpath());
</span><span id="3463" class="l"><a href="#3463"> 3463: </a>            <span class="php-keyword1">while</span> ((<span class="php-var">$file</span> = <span class="php-keyword2">readdir</span>(<span class="php-var">$fontsdir</span>)) !== <span class="php-keyword1">false</span>) {
</span><span id="3464" class="l"><a href="#3464"> 3464: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$file</span>, -<span class="php-num">4</span>) == <span class="php-quote">'.php'</span>) {
</span><span id="3465" class="l"><a href="#3465"> 3465: </a>                    <span class="php-keyword2">array_push</span>(<span class="php-var">$this</span>-&gt;fontlist, <span class="php-keyword2">strtolower</span>(<span class="php-keyword2">basename</span>(<span class="php-var">$file</span>, <span class="php-quote">'.php'</span>)));
</span><span id="3466" class="l"><a href="#3466"> 3466: </a>                }
</span><span id="3467" class="l"><a href="#3467"> 3467: </a>            }
</span><span id="3468" class="l"><a href="#3468"> 3468: </a>            <span class="php-keyword2">closedir</span>(<span class="php-var">$fontsdir</span>);
</span><span id="3469" class="l"><a href="#3469"> 3469: </a>        }
</span><span id="3470" class="l"><a href="#3470"> 3470: </a>
</span><span id="3471" class="l"><a href="#3471"> 3471: </a>        <span class="php-comment">/**
</span></span><span id="3472" class="l"><a href="#3472"> 3472: </a><span class="php-comment">         * Imports a TrueType, Type1, core, or CID0 font and makes it available.
</span></span><span id="3473" class="l"><a href="#3473"> 3473: </a><span class="php-comment">         * It is necessary to generate a font definition file first (read /fonts/utils/README.TXT).
</span></span><span id="3474" class="l"><a href="#3474"> 3474: </a><span class="php-comment">         * The definition file (and the font file itself when embedding) must be present either in the current directory or in the one indicated by K_PATH_FONTS if the constant is defined. If it could not be found, the error &quot;Could not include font definition file&quot; is generated.
</span></span><span id="3475" class="l"><a href="#3475"> 3475: </a><span class="php-comment">         * @param string $family Font family. The name can be chosen arbitrarily. If it is a standard family name, it will override the corresponding font.
</span></span><span id="3476" class="l"><a href="#3476"> 3476: </a><span class="php-comment">         * @param string $style Font style. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;empty string: regular (default)&lt;/li&gt;&lt;li&gt;B: bold&lt;/li&gt;&lt;li&gt;I: italic&lt;/li&gt;&lt;li&gt;BI or IB: bold italic&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="3477" class="l"><a href="#3477"> 3477: </a><span class="php-comment">         * @param string $fontfile The font definition file. By default, the name is built from the family and style, in lower case with no spaces.
</span></span><span id="3478" class="l"><a href="#3478"> 3478: </a><span class="php-comment">         * @return array containing the font data, or false in case of error.
</span></span><span id="3479" class="l"><a href="#3479"> 3479: </a><span class="php-comment">         * @access public
</span></span><span id="3480" class="l"><a href="#3480"> 3480: </a><span class="php-comment">         * @since 1.5
</span></span><span id="3481" class="l"><a href="#3481"> 3481: </a><span class="php-comment">         * @see SetFont()
</span></span><span id="3482" class="l"><a href="#3482"> 3482: </a><span class="php-comment">         */</span>
</span><span id="3483" class="l"><a href="#3483"> 3483: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> AddFont(<span class="php-var">$family</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$fontfile</span>=<span class="php-quote">''</span>) {
</span><span id="3484" class="l"><a href="#3484"> 3484: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$family</span>)) {
</span><span id="3485" class="l"><a href="#3485"> 3485: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;FontFamily)) {
</span><span id="3486" class="l"><a href="#3486"> 3486: </a>                    <span class="php-var">$family</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="3487" class="l"><a href="#3487"> 3487: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3488" class="l"><a href="#3488"> 3488: </a>                    <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Empty font family'</span>);
</span><span id="3489" class="l"><a href="#3489"> 3489: </a>                }
</span><span id="3490" class="l"><a href="#3490"> 3490: </a>            }
</span><span id="3491" class="l"><a href="#3491"> 3491: </a>            <span class="php-var">$family</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$family</span>);
</span><span id="3492" class="l"><a href="#3492"> 3492: </a>            <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;isunicode) <span class="php-keyword1">AND</span> (<span class="php-var">$family</span> == <span class="php-quote">'arial'</span>)) {
</span><span id="3493" class="l"><a href="#3493"> 3493: </a>                <span class="php-var">$family</span> = <span class="php-quote">'helvetica'</span>;
</span><span id="3494" class="l"><a href="#3494"> 3494: </a>            }
</span><span id="3495" class="l"><a href="#3495"> 3495: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$family</span> == <span class="php-quote">'symbol'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$family</span> == <span class="php-quote">'zapfdingbats'</span>)) {
</span><span id="3496" class="l"><a href="#3496"> 3496: </a>                <span class="php-var">$style</span> = <span class="php-quote">''</span>;
</span><span id="3497" class="l"><a href="#3497"> 3497: </a>            }
</span><span id="3498" class="l"><a href="#3498"> 3498: </a>            <span class="php-var">$tempstyle</span> = <span class="php-keyword2">strtoupper</span>(<span class="php-var">$style</span>);
</span><span id="3499" class="l"><a href="#3499"> 3499: </a>            <span class="php-var">$style</span> = <span class="php-quote">''</span>;
</span><span id="3500" class="l"><a href="#3500"> 3500: </a>            <span class="php-comment">// underline</span>
</span><span id="3501" class="l"><a href="#3501"> 3501: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$tempstyle</span>, <span class="php-quote">'U'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3502" class="l"><a href="#3502"> 3502: </a>                <span class="php-var">$this</span>-&gt;underline = <span class="php-keyword1">true</span>;
</span><span id="3503" class="l"><a href="#3503"> 3503: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3504" class="l"><a href="#3504"> 3504: </a>                <span class="php-var">$this</span>-&gt;underline = <span class="php-keyword1">false</span>;
</span><span id="3505" class="l"><a href="#3505"> 3505: </a>            }
</span><span id="3506" class="l"><a href="#3506"> 3506: </a>            <span class="php-comment">// line-through (deleted)</span>
</span><span id="3507" class="l"><a href="#3507"> 3507: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$tempstyle</span>, <span class="php-quote">'D'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3508" class="l"><a href="#3508"> 3508: </a>                <span class="php-var">$this</span>-&gt;linethrough = <span class="php-keyword1">true</span>;
</span><span id="3509" class="l"><a href="#3509"> 3509: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3510" class="l"><a href="#3510"> 3510: </a>                <span class="php-var">$this</span>-&gt;linethrough = <span class="php-keyword1">false</span>;
</span><span id="3511" class="l"><a href="#3511"> 3511: </a>            }
</span><span id="3512" class="l"><a href="#3512"> 3512: </a>            <span class="php-comment">// overline</span>
</span><span id="3513" class="l"><a href="#3513"> 3513: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$tempstyle</span>, <span class="php-quote">'O'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3514" class="l"><a href="#3514"> 3514: </a>                <span class="php-var">$this</span>-&gt;overline = <span class="php-keyword1">true</span>;
</span><span id="3515" class="l"><a href="#3515"> 3515: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3516" class="l"><a href="#3516"> 3516: </a>                <span class="php-var">$this</span>-&gt;overline = <span class="php-keyword1">false</span>;
</span><span id="3517" class="l"><a href="#3517"> 3517: </a>            }
</span><span id="3518" class="l"><a href="#3518"> 3518: </a>            <span class="php-comment">// bold</span>
</span><span id="3519" class="l"><a href="#3519"> 3519: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$tempstyle</span>, <span class="php-quote">'B'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3520" class="l"><a href="#3520"> 3520: </a>                <span class="php-var">$style</span> .= <span class="php-quote">'B'</span>;
</span><span id="3521" class="l"><a href="#3521"> 3521: </a>            }
</span><span id="3522" class="l"><a href="#3522"> 3522: </a>            <span class="php-comment">// oblique</span>
</span><span id="3523" class="l"><a href="#3523"> 3523: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$tempstyle</span>, <span class="php-quote">'I'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3524" class="l"><a href="#3524"> 3524: </a>                <span class="php-var">$style</span> .= <span class="php-quote">'I'</span>;
</span><span id="3525" class="l"><a href="#3525"> 3525: </a>            }
</span><span id="3526" class="l"><a href="#3526"> 3526: </a>            <span class="php-var">$bistyle</span> = <span class="php-var">$style</span>;
</span><span id="3527" class="l"><a href="#3527"> 3527: </a>            <span class="php-var">$fontkey</span> = <span class="php-var">$family</span>.<span class="php-var">$style</span>;
</span><span id="3528" class="l"><a href="#3528"> 3528: </a>            <span class="php-var">$font_style</span> = <span class="php-var">$style</span>.(<span class="php-var">$this</span>-&gt;underline ? <span class="php-quote">'U'</span> : <span class="php-quote">''</span>).(<span class="php-var">$this</span>-&gt;linethrough ? <span class="php-quote">'D'</span> : <span class="php-quote">''</span>).(<span class="php-var">$this</span>-&gt;overline ? <span class="php-quote">'O'</span> : <span class="php-quote">''</span>);
</span><span id="3529" class="l"><a href="#3529"> 3529: </a>            <span class="php-var">$fontdata</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'fontkey'</span> =&gt; <span class="php-var">$fontkey</span>, <span class="php-quote">'family'</span> =&gt; <span class="php-var">$family</span>, <span class="php-quote">'style'</span> =&gt; <span class="php-var">$font_style</span>);
</span><span id="3530" class="l"><a href="#3530"> 3530: </a>            <span class="php-comment">// check if the font has been already added</span>
</span><span id="3531" class="l"><a href="#3531"> 3531: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;getFontBuffer(<span class="php-var">$fontkey</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3532" class="l"><a href="#3532"> 3532: </a>                <span class="php-keyword1">return</span> <span class="php-var">$fontdata</span>;
</span><span id="3533" class="l"><a href="#3533"> 3533: </a>            }
</span><span id="3534" class="l"><a href="#3534"> 3534: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$type</span>)) {
</span><span id="3535" class="l"><a href="#3535"> 3535: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$type</span>);
</span><span id="3536" class="l"><a href="#3536"> 3536: </a>            }
</span><span id="3537" class="l"><a href="#3537"> 3537: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cw</span>)) {
</span><span id="3538" class="l"><a href="#3538"> 3538: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$cw</span>);
</span><span id="3539" class="l"><a href="#3539"> 3539: </a>            }
</span><span id="3540" class="l"><a href="#3540"> 3540: </a>            <span class="php-comment">// get specified font directory (if any)</span>
</span><span id="3541" class="l"><a href="#3541"> 3541: </a>            <span class="php-var">$fontdir</span> = <span class="php-keyword1">false</span>;
</span><span id="3542" class="l"><a href="#3542"> 3542: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fontfile</span>)) {
</span><span id="3543" class="l"><a href="#3543"> 3543: </a>                <span class="php-var">$fontdir</span> = <span class="php-keyword2">dirname</span>(<span class="php-var">$fontfile</span>);
</span><span id="3544" class="l"><a href="#3544"> 3544: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fontdir</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$fontdir</span> == <span class="php-quote">'.'</span>)) {
</span><span id="3545" class="l"><a href="#3545"> 3545: </a>                    <span class="php-var">$fontdir</span> = <span class="php-quote">''</span>;
</span><span id="3546" class="l"><a href="#3546"> 3546: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3547" class="l"><a href="#3547"> 3547: </a>                    <span class="php-var">$fontdir</span> .= <span class="php-quote">'/'</span>;
</span><span id="3548" class="l"><a href="#3548"> 3548: </a>                }
</span><span id="3549" class="l"><a href="#3549"> 3549: </a>            }
</span><span id="3550" class="l"><a href="#3550"> 3550: </a>            <span class="php-comment">// search and include font file</span>
</span><span id="3551" class="l"><a href="#3551"> 3551: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fontfile</span>) <span class="php-keyword1">OR</span> (!<span class="php-keyword2">file_exists</span>(<span class="php-var">$fontfile</span>))) {
</span><span id="3552" class="l"><a href="#3552"> 3552: </a>                <span class="php-comment">// build a standard filenames for specified font</span>
</span><span id="3553" class="l"><a href="#3553"> 3553: </a>                <span class="php-var">$fontfile1</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">' '</span>, <span class="php-quote">''</span>, <span class="php-var">$family</span>).<span class="php-keyword2">strtolower</span>(<span class="php-var">$style</span>).<span class="php-quote">'.php'</span>;
</span><span id="3554" class="l"><a href="#3554"> 3554: </a>                <span class="php-var">$fontfile2</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">' '</span>, <span class="php-quote">''</span>, <span class="php-var">$family</span>).<span class="php-quote">'.php'</span>;
</span><span id="3555" class="l"><a href="#3555"> 3555: </a>                <span class="php-comment">// search files on various directories</span>
</span><span id="3556" class="l"><a href="#3556"> 3556: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$fontdir</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$fontdir</span>.<span class="php-var">$fontfile1</span>)) {
</span><span id="3557" class="l"><a href="#3557"> 3557: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$fontdir</span>.<span class="php-var">$fontfile1</span>;
</span><span id="3558" class="l"><a href="#3558"> 3558: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$fontfile1</span>)) {
</span><span id="3559" class="l"><a href="#3559"> 3559: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$fontfile1</span>;
</span><span id="3560" class="l"><a href="#3560"> 3560: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$fontfile1</span>)) {
</span><span id="3561" class="l"><a href="#3561"> 3561: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$fontfile1</span>;
</span><span id="3562" class="l"><a href="#3562"> 3562: </a>                } <span class="php-keyword1">elseif</span> ((<span class="php-var">$fontdir</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$fontdir</span>.<span class="php-var">$fontfile2</span>)) {
</span><span id="3563" class="l"><a href="#3563"> 3563: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$fontdir</span>.<span class="php-var">$fontfile2</span>;
</span><span id="3564" class="l"><a href="#3564"> 3564: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$fontfile2</span>)) {
</span><span id="3565" class="l"><a href="#3565"> 3565: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$fontfile2</span>;
</span><span id="3566" class="l"><a href="#3566"> 3566: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3567" class="l"><a href="#3567"> 3567: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$fontfile2</span>;
</span><span id="3568" class="l"><a href="#3568"> 3568: </a>                }
</span><span id="3569" class="l"><a href="#3569"> 3569: </a>            }
</span><span id="3570" class="l"><a href="#3570"> 3570: </a>            <span class="php-comment">// include font file</span>
</span><span id="3571" class="l"><a href="#3571"> 3571: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$fontfile</span>)) {
</span><span id="3572" class="l"><a href="#3572"> 3572: </a>                <span class="php-keyword1">include</span>(<span class="php-var">$fontfile</span>);
</span><span id="3573" class="l"><a href="#3573"> 3573: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3574" class="l"><a href="#3574"> 3574: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Could not include font definition file: '</span>.<span class="php-var">$family</span>.<span class="php-quote">''</span>);
</span><span id="3575" class="l"><a href="#3575"> 3575: </a>            }
</span><span id="3576" class="l"><a href="#3576"> 3576: </a>            <span class="php-comment">// check font parameters</span>
</span><span id="3577" class="l"><a href="#3577"> 3577: </a>            <span class="php-keyword1">if</span> ((!<span class="php-keyword1">isset</span>(<span class="php-var">$type</span>)) <span class="php-keyword1">OR</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$cw</span>))) {
</span><span id="3578" class="l"><a href="#3578"> 3578: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'The font definition file has a bad format: '</span>.<span class="php-var">$fontfile</span>.<span class="php-quote">''</span>);
</span><span id="3579" class="l"><a href="#3579"> 3579: </a>            }
</span><span id="3580" class="l"><a href="#3580"> 3580: </a>            <span class="php-comment">// SET default parameters</span>
</span><span id="3581" class="l"><a href="#3581"> 3581: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$file</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$file</span>)) {
</span><span id="3582" class="l"><a href="#3582"> 3582: </a>                <span class="php-var">$file</span> = <span class="php-quote">''</span>;
</span><span id="3583" class="l"><a href="#3583"> 3583: </a>            }
</span><span id="3584" class="l"><a href="#3584"> 3584: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$enc</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$enc</span>)) {
</span><span id="3585" class="l"><a href="#3585"> 3585: </a>                <span class="php-var">$enc</span> = <span class="php-quote">''</span>;
</span><span id="3586" class="l"><a href="#3586"> 3586: </a>            }
</span><span id="3587" class="l"><a href="#3587"> 3587: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$cidinfo</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$cidinfo</span>)) {
</span><span id="3588" class="l"><a href="#3588"> 3588: </a>                <span class="php-var">$cidinfo</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Registry'</span>=&gt;<span class="php-quote">'Adobe'</span>,<span class="php-quote">'Ordering'</span>=&gt;<span class="php-quote">'Identity'</span>,<span class="php-quote">'Supplement'</span>=&gt;<span class="php-num">0</span>);
</span><span id="3589" class="l"><a href="#3589"> 3589: </a>                <span class="php-var">$cidinfo</span>[<span class="php-quote">'uni2cid'</span>] = <span class="php-keyword1">array</span>();
</span><span id="3590" class="l"><a href="#3590"> 3590: </a>            }
</span><span id="3591" class="l"><a href="#3591"> 3591: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$ctg</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$ctg</span>)) {
</span><span id="3592" class="l"><a href="#3592"> 3592: </a>                <span class="php-var">$ctg</span> = <span class="php-quote">''</span>;
</span><span id="3593" class="l"><a href="#3593"> 3593: </a>            }
</span><span id="3594" class="l"><a href="#3594"> 3594: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$desc</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$desc</span>)) {
</span><span id="3595" class="l"><a href="#3595"> 3595: </a>                <span class="php-var">$desc</span> = <span class="php-keyword1">array</span>();
</span><span id="3596" class="l"><a href="#3596"> 3596: </a>            }
</span><span id="3597" class="l"><a href="#3597"> 3597: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$up</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$up</span>)) {
</span><span id="3598" class="l"><a href="#3598"> 3598: </a>                <span class="php-var">$up</span> = -<span class="php-num">100</span>;
</span><span id="3599" class="l"><a href="#3599"> 3599: </a>            }
</span><span id="3600" class="l"><a href="#3600"> 3600: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$ut</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$ut</span>)) {
</span><span id="3601" class="l"><a href="#3601"> 3601: </a>                <span class="php-var">$ut</span> = <span class="php-num">50</span>;
</span><span id="3602" class="l"><a href="#3602"> 3602: </a>            }
</span><span id="3603" class="l"><a href="#3603"> 3603: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$cw</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$cw</span>)) {
</span><span id="3604" class="l"><a href="#3604"> 3604: </a>                <span class="php-var">$cw</span> = <span class="php-keyword1">array</span>();
</span><span id="3605" class="l"><a href="#3605"> 3605: </a>            }
</span><span id="3606" class="l"><a href="#3606"> 3606: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dw</span>) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dw</span>)) {
</span><span id="3607" class="l"><a href="#3607"> 3607: </a>                <span class="php-comment">// set default width</span>
</span><span id="3608" class="l"><a href="#3608"> 3608: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$desc</span>[<span class="php-quote">'MissingWidth'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$desc</span>[<span class="php-quote">'MissingWidth'</span>] &gt; <span class="php-num">0</span>)) {
</span><span id="3609" class="l"><a href="#3609"> 3609: </a>                    <span class="php-var">$dw</span> = <span class="php-var">$desc</span>[<span class="php-quote">'MissingWidth'</span>];
</span><span id="3610" class="l"><a href="#3610"> 3610: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cw</span>[<span class="php-num">32</span>])) {
</span><span id="3611" class="l"><a href="#3611"> 3611: </a>                    <span class="php-var">$dw</span> = <span class="php-var">$cw</span>[<span class="php-num">32</span>];
</span><span id="3612" class="l"><a href="#3612"> 3612: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3613" class="l"><a href="#3613"> 3613: </a>                    <span class="php-var">$dw</span> = <span class="php-num">600</span>;
</span><span id="3614" class="l"><a href="#3614"> 3614: </a>                }
</span><span id="3615" class="l"><a href="#3615"> 3615: </a>            }
</span><span id="3616" class="l"><a href="#3616"> 3616: </a>            ++<span class="php-var">$this</span>-&gt;numfonts;
</span><span id="3617" class="l"><a href="#3617"> 3617: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$type</span> == <span class="php-quote">'cidfont0'</span>) {
</span><span id="3618" class="l"><a href="#3618"> 3618: </a>                <span class="php-comment">// register CID font (all styles at once)</span>
</span><span id="3619" class="l"><a href="#3619"> 3619: </a>                <span class="php-var">$styles</span> = <span class="php-keyword1">array</span>(<span class="php-quote">''</span> =&gt; <span class="php-quote">''</span>, <span class="php-quote">'B'</span> =&gt; <span class="php-quote">',Bold'</span>, <span class="php-quote">'I'</span> =&gt; <span class="php-quote">',Italic'</span>, <span class="php-quote">'BI'</span> =&gt; <span class="php-quote">',BoldItalic'</span>);
</span><span id="3620" class="l"><a href="#3620"> 3620: </a>                <span class="php-var">$sname</span> = <span class="php-var">$name</span>.<span class="php-var">$styles</span>[<span class="php-var">$bistyle</span>];
</span><span id="3621" class="l"><a href="#3621"> 3621: </a>                <span class="php-comment">// artificial bold</span>
</span><span id="3622" class="l"><a href="#3622"> 3622: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$bistyle</span>, <span class="php-quote">'B'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3623" class="l"><a href="#3623"> 3623: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$desc</span>[<span class="php-quote">'StemV'</span>])) {
</span><span id="3624" class="l"><a href="#3624"> 3624: </a>                        <span class="php-var">$desc</span>[<span class="php-quote">'StemV'</span>] *= <span class="php-num">2</span>;
</span><span id="3625" class="l"><a href="#3625"> 3625: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="3626" class="l"><a href="#3626"> 3626: </a>                        <span class="php-var">$desc</span>[<span class="php-quote">'StemV'</span>] = <span class="php-num">120</span>;
</span><span id="3627" class="l"><a href="#3627"> 3627: </a>                    }
</span><span id="3628" class="l"><a href="#3628"> 3628: </a>                }
</span><span id="3629" class="l"><a href="#3629"> 3629: </a>                <span class="php-comment">// artificial italic</span>
</span><span id="3630" class="l"><a href="#3630"> 3630: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$bistyle</span>, <span class="php-quote">'I'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="3631" class="l"><a href="#3631"> 3631: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$desc</span>[<span class="php-quote">'ItalicAngle'</span>])) {
</span><span id="3632" class="l"><a href="#3632"> 3632: </a>                        <span class="php-var">$desc</span>[<span class="php-quote">'ItalicAngle'</span>] -= <span class="php-num">11</span>;
</span><span id="3633" class="l"><a href="#3633"> 3633: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="3634" class="l"><a href="#3634"> 3634: </a>                        <span class="php-var">$desc</span>[<span class="php-quote">'ItalicAngle'</span>] = -<span class="php-num">11</span>;
</span><span id="3635" class="l"><a href="#3635"> 3635: </a>                    }
</span><span id="3636" class="l"><a href="#3636"> 3636: </a>                }
</span><span id="3637" class="l"><a href="#3637"> 3637: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$type</span> == <span class="php-quote">'core'</span>) {
</span><span id="3638" class="l"><a href="#3638"> 3638: </a>                <span class="php-var">$name</span> = <span class="php-var">$this</span>-&gt;CoreFonts[<span class="php-var">$fontkey</span>];
</span><span id="3639" class="l"><a href="#3639"> 3639: </a>            } <span class="php-keyword1">elseif</span> ((<span class="php-var">$type</span> == <span class="php-quote">'TrueType'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$type</span> == <span class="php-quote">'Type1'</span>)) {
</span><span id="3640" class="l"><a href="#3640"> 3640: </a>                <span class="php-comment">// ...</span>
</span><span id="3641" class="l"><a href="#3641"> 3641: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$type</span> == <span class="php-quote">'TrueTypeUnicode'</span>) {
</span><span id="3642" class="l"><a href="#3642"> 3642: </a>                <span class="php-var">$enc</span> = <span class="php-quote">'Identity-H'</span>;
</span><span id="3643" class="l"><a href="#3643"> 3643: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3644" class="l"><a href="#3644"> 3644: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Unknow font type: '</span>.<span class="php-var">$type</span>.<span class="php-quote">''</span>);
</span><span id="3645" class="l"><a href="#3645"> 3645: </a>            }
</span><span id="3646" class="l"><a href="#3646"> 3646: </a>            <span class="php-var">$this</span>-&gt;setFontBuffer(<span class="php-var">$fontkey</span>, <span class="php-keyword1">array</span>(<span class="php-quote">'i'</span> =&gt; <span class="php-var">$this</span>-&gt;numfonts, <span class="php-quote">'type'</span> =&gt; <span class="php-var">$type</span>, <span class="php-quote">'name'</span> =&gt; <span class="php-var">$name</span>, <span class="php-quote">'desc'</span> =&gt; <span class="php-var">$desc</span>, <span class="php-quote">'up'</span> =&gt; <span class="php-var">$up</span>, <span class="php-quote">'ut'</span> =&gt; <span class="php-var">$ut</span>, <span class="php-quote">'cw'</span> =&gt; <span class="php-var">$cw</span>, <span class="php-quote">'dw'</span> =&gt; <span class="php-var">$dw</span>, <span class="php-quote">'enc'</span> =&gt; <span class="php-var">$enc</span>, <span class="php-quote">'cidinfo'</span> =&gt; <span class="php-var">$cidinfo</span>, <span class="php-quote">'file'</span> =&gt; <span class="php-var">$file</span>, <span class="php-quote">'ctg'</span> =&gt; <span class="php-var">$ctg</span>));
</span><span id="3647" class="l"><a href="#3647"> 3647: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$diff</span>) <span class="php-keyword1">AND</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$diff</span>))) {
</span><span id="3648" class="l"><a href="#3648"> 3648: </a>                <span class="php-comment">//Search existing encodings</span>
</span><span id="3649" class="l"><a href="#3649"> 3649: </a>                <span class="php-var">$d</span> = <span class="php-num">0</span>;
</span><span id="3650" class="l"><a href="#3650"> 3650: </a>                <span class="php-var">$nb</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;diffs);
</span><span id="3651" class="l"><a href="#3651"> 3651: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">1</span>; <span class="php-var">$i</span> &lt;= <span class="php-var">$nb</span>; ++<span class="php-var">$i</span>) {
</span><span id="3652" class="l"><a href="#3652"> 3652: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diffs[<span class="php-var">$i</span>] == <span class="php-var">$diff</span>) {
</span><span id="3653" class="l"><a href="#3653"> 3653: </a>                        <span class="php-var">$d</span> = <span class="php-var">$i</span>;
</span><span id="3654" class="l"><a href="#3654"> 3654: </a>                        <span class="php-keyword1">break</span>;
</span><span id="3655" class="l"><a href="#3655"> 3655: </a>                    }
</span><span id="3656" class="l"><a href="#3656"> 3656: </a>                }
</span><span id="3657" class="l"><a href="#3657"> 3657: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$d</span> == <span class="php-num">0</span>) {
</span><span id="3658" class="l"><a href="#3658"> 3658: </a>                    <span class="php-var">$d</span> = <span class="php-var">$nb</span> + <span class="php-num">1</span>;
</span><span id="3659" class="l"><a href="#3659"> 3659: </a>                    <span class="php-var">$this</span>-&gt;diffs[<span class="php-var">$d</span>] = <span class="php-var">$diff</span>;
</span><span id="3660" class="l"><a href="#3660"> 3660: </a>                }
</span><span id="3661" class="l"><a href="#3661"> 3661: </a>                <span class="php-var">$this</span>-&gt;setFontSubBuffer(<span class="php-var">$fontkey</span>, <span class="php-quote">'diff'</span>, <span class="php-var">$d</span>);
</span><span id="3662" class="l"><a href="#3662"> 3662: </a>            }
</span><span id="3663" class="l"><a href="#3663"> 3663: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$file</span>)) {
</span><span id="3664" class="l"><a href="#3664"> 3664: </a>                <span class="php-keyword1">if</span> ((<span class="php-keyword2">strcasecmp</span>(<span class="php-var">$type</span>,<span class="php-quote">'TrueType'</span>) == <span class="php-num">0</span>) <span class="php-keyword1">OR</span> (<span class="php-keyword2">strcasecmp</span>(<span class="php-var">$type</span>, <span class="php-quote">'TrueTypeUnicode'</span>) == <span class="php-num">0</span>)) {
</span><span id="3665" class="l"><a href="#3665"> 3665: </a>                    <span class="php-var">$this</span>-&gt;FontFiles[<span class="php-var">$file</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'length1'</span> =&gt; <span class="php-var">$originalsize</span>, <span class="php-quote">'fontdir'</span> =&gt; <span class="php-var">$fontdir</span>);
</span><span id="3666" class="l"><a href="#3666"> 3666: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$type</span> != <span class="php-quote">'core'</span>) {
</span><span id="3667" class="l"><a href="#3667"> 3667: </a>                    <span class="php-var">$this</span>-&gt;FontFiles[<span class="php-var">$file</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'length1'</span> =&gt; <span class="php-var">$size1</span>, <span class="php-quote">'length2'</span> =&gt; <span class="php-var">$size2</span>, <span class="php-quote">'fontdir'</span> =&gt; <span class="php-var">$fontdir</span>);
</span><span id="3668" class="l"><a href="#3668"> 3668: </a>                }
</span><span id="3669" class="l"><a href="#3669"> 3669: </a>            }
</span><span id="3670" class="l"><a href="#3670"> 3670: </a>            <span class="php-keyword1">return</span> <span class="php-var">$fontdata</span>;
</span><span id="3671" class="l"><a href="#3671"> 3671: </a>        }
</span><span id="3672" class="l"><a href="#3672"> 3672: </a>
</span><span id="3673" class="l"><a href="#3673"> 3673: </a>        <span class="php-comment">/**
</span></span><span id="3674" class="l"><a href="#3674"> 3674: </a><span class="php-comment">         * Sets the font used to print character strings.
</span></span><span id="3675" class="l"><a href="#3675"> 3675: </a><span class="php-comment">         * The font can be either a standard one or a font added via the AddFont() method. Standard fonts use Windows encoding cp1252 (Western Europe).
</span></span><span id="3676" class="l"><a href="#3676"> 3676: </a><span class="php-comment">         * The method can be called before the first page is created and the font is retained from page to page.
</span></span><span id="3677" class="l"><a href="#3677"> 3677: </a><span class="php-comment">         * If you just wish to change the current font size, it is simpler to call SetFontSize().
</span></span><span id="3678" class="l"><a href="#3678"> 3678: </a><span class="php-comment">         * Note: for the standard fonts, the font metric files must be accessible. There are three possibilities for this:&lt;ul&gt;&lt;li&gt;They are in the current directory (the one where the running script lies)&lt;/li&gt;&lt;li&gt;They are in one of the directories defined by the include_path parameter&lt;/li&gt;&lt;li&gt;They are in the directory defined by the K_PATH_FONTS constant&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;
</span></span><span id="3679" class="l"><a href="#3679"> 3679: </a><span class="php-comment">         * @param string $family Family font. It can be either a name defined by AddFont() or one of the standard Type1 families (case insensitive):&lt;ul&gt;&lt;li&gt;times (Times-Roman)&lt;/li&gt;&lt;li&gt;timesb (Times-Bold)&lt;/li&gt;&lt;li&gt;timesi (Times-Italic)&lt;/li&gt;&lt;li&gt;timesbi (Times-BoldItalic)&lt;/li&gt;&lt;li&gt;helvetica (Helvetica)&lt;/li&gt;&lt;li&gt;helveticab (Helvetica-Bold)&lt;/li&gt;&lt;li&gt;helveticai (Helvetica-Oblique)&lt;/li&gt;&lt;li&gt;helveticabi (Helvetica-BoldOblique)&lt;/li&gt;&lt;li&gt;courier (Courier)&lt;/li&gt;&lt;li&gt;courierb (Courier-Bold)&lt;/li&gt;&lt;li&gt;courieri (Courier-Oblique)&lt;/li&gt;&lt;li&gt;courierbi (Courier-BoldOblique)&lt;/li&gt;&lt;li&gt;symbol (Symbol)&lt;/li&gt;&lt;li&gt;zapfdingbats (ZapfDingbats)&lt;/li&gt;&lt;/ul&gt; It is also possible to pass an empty string. In that case, the current family is retained.
</span></span><span id="3680" class="l"><a href="#3680"> 3680: </a><span class="php-comment">         * @param string $style Font style. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;empty string: regular&lt;/li&gt;&lt;li&gt;B: bold&lt;/li&gt;&lt;li&gt;I: italic&lt;/li&gt;&lt;li&gt;U: underline&lt;/li&gt;&lt;li&gt;D: line trough&lt;/li&gt;&lt;li&gt;O: overline&lt;/li&gt;&lt;/ul&gt; or any combination. The default value is regular. Bold and italic styles do not apply to Symbol and ZapfDingbats basic fonts or other fonts when not defined.
</span></span><span id="3681" class="l"><a href="#3681"> 3681: </a><span class="php-comment">         * @param float $size Font size in points. The default value is the current size. If no size has been specified since the beginning of the document, the value taken is 12
</span></span><span id="3682" class="l"><a href="#3682"> 3682: </a><span class="php-comment">         * @param string $fontfile The font definition file. By default, the name is built from the family and style, in lower case with no spaces.
</span></span><span id="3683" class="l"><a href="#3683"> 3683: </a><span class="php-comment">         * @access public
</span></span><span id="3684" class="l"><a href="#3684"> 3684: </a><span class="php-comment">         * @since 1.0
</span></span><span id="3685" class="l"><a href="#3685"> 3685: </a><span class="php-comment">         * @see AddFont(), SetFontSize()
</span></span><span id="3686" class="l"><a href="#3686"> 3686: </a><span class="php-comment">         */</span>
</span><span id="3687" class="l"><a href="#3687"> 3687: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetFont(<span class="php-var">$family</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$size</span>=<span class="php-num">0</span>, <span class="php-var">$fontfile</span>=<span class="php-quote">''</span>) {
</span><span id="3688" class="l"><a href="#3688"> 3688: </a>            <span class="php-comment">//Select a font; size given in points</span>
</span><span id="3689" class="l"><a href="#3689"> 3689: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$size</span> == <span class="php-num">0</span>) {
</span><span id="3690" class="l"><a href="#3690"> 3690: </a>                <span class="php-var">$size</span> = <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="3691" class="l"><a href="#3691"> 3691: </a>            }
</span><span id="3692" class="l"><a href="#3692"> 3692: </a>            <span class="php-comment">// try to add font (if not already added)</span>
</span><span id="3693" class="l"><a href="#3693"> 3693: </a>            <span class="php-var">$fontdata</span> = <span class="php-var">$this</span>-&gt;AddFont(<span class="php-var">$family</span>, <span class="php-var">$style</span>, <span class="php-var">$fontfile</span>);
</span><span id="3694" class="l"><a href="#3694"> 3694: </a>            <span class="php-var">$this</span>-&gt;FontFamily = <span class="php-var">$fontdata</span>[<span class="php-quote">'family'</span>];
</span><span id="3695" class="l"><a href="#3695"> 3695: </a>            <span class="php-var">$this</span>-&gt;FontStyle = <span class="php-var">$fontdata</span>[<span class="php-quote">'style'</span>];
</span><span id="3696" class="l"><a href="#3696"> 3696: </a>            <span class="php-var">$this</span>-&gt;CurrentFont = <span class="php-var">$this</span>-&gt;getFontBuffer(<span class="php-var">$fontdata</span>[<span class="php-quote">'fontkey'</span>]);
</span><span id="3697" class="l"><a href="#3697"> 3697: </a>            <span class="php-var">$this</span>-&gt;SetFontSize(<span class="php-var">$size</span>);
</span><span id="3698" class="l"><a href="#3698"> 3698: </a>        }
</span><span id="3699" class="l"><a href="#3699"> 3699: </a>
</span><span id="3700" class="l"><a href="#3700"> 3700: </a>        <span class="php-comment">/**
</span></span><span id="3701" class="l"><a href="#3701"> 3701: </a><span class="php-comment">         * Defines the size of the current font.
</span></span><span id="3702" class="l"><a href="#3702"> 3702: </a><span class="php-comment">         * @param float $size The size (in points)
</span></span><span id="3703" class="l"><a href="#3703"> 3703: </a><span class="php-comment">         * @access public
</span></span><span id="3704" class="l"><a href="#3704"> 3704: </a><span class="php-comment">         * @since 1.0
</span></span><span id="3705" class="l"><a href="#3705"> 3705: </a><span class="php-comment">         * @see SetFont()
</span></span><span id="3706" class="l"><a href="#3706"> 3706: </a><span class="php-comment">         */</span>
</span><span id="3707" class="l"><a href="#3707"> 3707: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetFontSize(<span class="php-var">$size</span>) {
</span><span id="3708" class="l"><a href="#3708"> 3708: </a>            <span class="php-comment">//Set font size in points</span>
</span><span id="3709" class="l"><a href="#3709"> 3709: </a>            <span class="php-var">$this</span>-&gt;FontSizePt = <span class="php-var">$size</span>;
</span><span id="3710" class="l"><a href="#3710"> 3710: </a>            <span class="php-var">$this</span>-&gt;FontSize = <span class="php-var">$size</span> / <span class="php-var">$this</span>-&gt;k;
</span><span id="3711" class="l"><a href="#3711"> 3711: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'desc'</span>][<span class="php-quote">'Ascent'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'desc'</span>][<span class="php-quote">'Ascent'</span>] &gt; <span class="php-num">0</span>)) {
</span><span id="3712" class="l"><a href="#3712"> 3712: </a>                <span class="php-var">$this</span>-&gt;FontAscent = <span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'desc'</span>][<span class="php-quote">'Ascent'</span>] * <span class="php-var">$this</span>-&gt;FontSize / <span class="php-num">1000</span>;
</span><span id="3713" class="l"><a href="#3713"> 3713: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3714" class="l"><a href="#3714"> 3714: </a>                <span class="php-var">$this</span>-&gt;FontAscent = <span class="php-num">0.85</span> * <span class="php-var">$this</span>-&gt;FontSize;
</span><span id="3715" class="l"><a href="#3715"> 3715: </a>            }
</span><span id="3716" class="l"><a href="#3716"> 3716: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'desc'</span>][<span class="php-quote">'Descent'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'desc'</span>][<span class="php-quote">'Descent'</span>] &lt;= <span class="php-num">0</span>)) {
</span><span id="3717" class="l"><a href="#3717"> 3717: </a>                <span class="php-var">$this</span>-&gt;FontDescent = - <span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'desc'</span>][<span class="php-quote">'Descent'</span>] * <span class="php-var">$this</span>-&gt;FontSize / <span class="php-num">1000</span>;
</span><span id="3718" class="l"><a href="#3718"> 3718: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3719" class="l"><a href="#3719"> 3719: </a>                <span class="php-var">$this</span>-&gt;FontDescent = <span class="php-num">0.15</span> * <span class="php-var">$this</span>-&gt;FontSize;
</span><span id="3720" class="l"><a href="#3720"> 3720: </a>            }
</span><span id="3721" class="l"><a href="#3721"> 3721: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'i'</span>]))) {
</span><span id="3722" class="l"><a href="#3722"> 3722: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'BT /F%d %.2F Tf ET'</span>, <span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'i'</span>], <span class="php-var">$this</span>-&gt;FontSizePt));
</span><span id="3723" class="l"><a href="#3723"> 3723: </a>            }
</span><span id="3724" class="l"><a href="#3724"> 3724: </a>        }
</span><span id="3725" class="l"><a href="#3725"> 3725: </a>
</span><span id="3726" class="l"><a href="#3726"> 3726: </a>        <span class="php-comment">/**
</span></span><span id="3727" class="l"><a href="#3727"> 3727: </a><span class="php-comment">         * Return the font descent value
</span></span><span id="3728" class="l"><a href="#3728"> 3728: </a><span class="php-comment">         * @param string $font font name
</span></span><span id="3729" class="l"><a href="#3729"> 3729: </a><span class="php-comment">         * @param string $style font style
</span></span><span id="3730" class="l"><a href="#3730"> 3730: </a><span class="php-comment">         * @param float $size The size (in points)
</span></span><span id="3731" class="l"><a href="#3731"> 3731: </a><span class="php-comment">         * @return int font descent
</span></span><span id="3732" class="l"><a href="#3732"> 3732: </a><span class="php-comment">         * @access public
</span></span><span id="3733" class="l"><a href="#3733"> 3733: </a><span class="php-comment">         * @since 4.9.003 (2010-03-30)
</span></span><span id="3734" class="l"><a href="#3734"> 3734: </a><span class="php-comment">         */</span>
</span><span id="3735" class="l"><a href="#3735"> 3735: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFontDescent(<span class="php-var">$font</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$size</span>=<span class="php-num">0</span>) {
</span><span id="3736" class="l"><a href="#3736"> 3736: </a>            <span class="php-comment">//Set font size in points</span>
</span><span id="3737" class="l"><a href="#3737"> 3737: </a>            <span class="php-var">$sizek</span> = <span class="php-var">$size</span> / <span class="php-var">$this</span>-&gt;k;
</span><span id="3738" class="l"><a href="#3738"> 3738: </a>            <span class="php-var">$fontdata</span> = <span class="php-var">$this</span>-&gt;AddFont(<span class="php-var">$font</span>, <span class="php-var">$style</span>);
</span><span id="3739" class="l"><a href="#3739"> 3739: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$fontdata</span>[<span class="php-quote">'desc'</span>][<span class="php-quote">'Descent'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$fontdata</span>[<span class="php-quote">'desc'</span>][<span class="php-quote">'Descent'</span>] &lt;= <span class="php-num">0</span>)) {
</span><span id="3740" class="l"><a href="#3740"> 3740: </a>                <span class="php-var">$descent</span> = - <span class="php-var">$fontdata</span>[<span class="php-quote">'desc'</span>][<span class="php-quote">'Descent'</span>] * <span class="php-var">$sizek</span> / <span class="php-num">1000</span>;
</span><span id="3741" class="l"><a href="#3741"> 3741: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3742" class="l"><a href="#3742"> 3742: </a>                <span class="php-var">$descent</span> = <span class="php-num">0.15</span> * <span class="php-var">$sizek</span>;
</span><span id="3743" class="l"><a href="#3743"> 3743: </a>            }
</span><span id="3744" class="l"><a href="#3744"> 3744: </a>            <span class="php-keyword1">return</span> <span class="php-var">$descent</span>;
</span><span id="3745" class="l"><a href="#3745"> 3745: </a>        }
</span><span id="3746" class="l"><a href="#3746"> 3746: </a>
</span><span id="3747" class="l"><a href="#3747"> 3747: </a>        <span class="php-comment">/**
</span></span><span id="3748" class="l"><a href="#3748"> 3748: </a><span class="php-comment">         * Return the font ascent value
</span></span><span id="3749" class="l"><a href="#3749"> 3749: </a><span class="php-comment">         * @param string $font font name
</span></span><span id="3750" class="l"><a href="#3750"> 3750: </a><span class="php-comment">         * @param string $style font style
</span></span><span id="3751" class="l"><a href="#3751"> 3751: </a><span class="php-comment">         * @param float $size The size (in points)
</span></span><span id="3752" class="l"><a href="#3752"> 3752: </a><span class="php-comment">         * @return int font ascent
</span></span><span id="3753" class="l"><a href="#3753"> 3753: </a><span class="php-comment">         * @access public
</span></span><span id="3754" class="l"><a href="#3754"> 3754: </a><span class="php-comment">         * @since 4.9.003 (2010-03-30)
</span></span><span id="3755" class="l"><a href="#3755"> 3755: </a><span class="php-comment">         */</span>
</span><span id="3756" class="l"><a href="#3756"> 3756: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFontAscent(<span class="php-var">$font</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$size</span>=<span class="php-num">0</span>) {
</span><span id="3757" class="l"><a href="#3757"> 3757: </a>            <span class="php-comment">//Set font size in points</span>
</span><span id="3758" class="l"><a href="#3758"> 3758: </a>            <span class="php-var">$sizek</span> = <span class="php-var">$size</span> / <span class="php-var">$this</span>-&gt;k;
</span><span id="3759" class="l"><a href="#3759"> 3759: </a>            <span class="php-var">$fontdata</span> = <span class="php-var">$this</span>-&gt;AddFont(<span class="php-var">$font</span>, <span class="php-var">$style</span>);
</span><span id="3760" class="l"><a href="#3760"> 3760: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$fontdata</span>[<span class="php-quote">'desc'</span>][<span class="php-quote">'Ascent'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$fontdata</span>[<span class="php-quote">'desc'</span>][<span class="php-quote">'Ascent'</span>] &gt; <span class="php-num">0</span>)) {
</span><span id="3761" class="l"><a href="#3761"> 3761: </a>                <span class="php-var">$ascent</span> = <span class="php-var">$fontdata</span>[<span class="php-quote">'desc'</span>][<span class="php-quote">'Ascent'</span>] * <span class="php-var">$sizek</span> / <span class="php-num">1000</span>;
</span><span id="3762" class="l"><a href="#3762"> 3762: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3763" class="l"><a href="#3763"> 3763: </a>                <span class="php-var">$ascent</span> = <span class="php-num">0.85</span> * <span class="php-var">$sizek</span>;
</span><span id="3764" class="l"><a href="#3764"> 3764: </a>            }
</span><span id="3765" class="l"><a href="#3765"> 3765: </a>            <span class="php-keyword1">return</span> <span class="php-var">$ascent</span>;
</span><span id="3766" class="l"><a href="#3766"> 3766: </a>        }
</span><span id="3767" class="l"><a href="#3767"> 3767: </a>
</span><span id="3768" class="l"><a href="#3768"> 3768: </a>        <span class="php-comment">/**
</span></span><span id="3769" class="l"><a href="#3769"> 3769: </a><span class="php-comment">         * Defines the default monospaced font.
</span></span><span id="3770" class="l"><a href="#3770"> 3770: </a><span class="php-comment">         * @param string $font Font name.
</span></span><span id="3771" class="l"><a href="#3771"> 3771: </a><span class="php-comment">         * @access public
</span></span><span id="3772" class="l"><a href="#3772"> 3772: </a><span class="php-comment">         * @since 4.5.025
</span></span><span id="3773" class="l"><a href="#3773"> 3773: </a><span class="php-comment">         */</span>
</span><span id="3774" class="l"><a href="#3774"> 3774: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetDefaultMonospacedFont(<span class="php-var">$font</span>) {
</span><span id="3775" class="l"><a href="#3775"> 3775: </a>            <span class="php-var">$this</span>-&gt;default_monospaced_font = <span class="php-var">$font</span>;
</span><span id="3776" class="l"><a href="#3776"> 3776: </a>        }
</span><span id="3777" class="l"><a href="#3777"> 3777: </a>
</span><span id="3778" class="l"><a href="#3778"> 3778: </a>        <span class="php-comment">/**
</span></span><span id="3779" class="l"><a href="#3779"> 3779: </a><span class="php-comment">         * Creates a new internal link and returns its identifier. An internal link is a clickable area which directs to another place within the document.&lt;br /&gt;
</span></span><span id="3780" class="l"><a href="#3780"> 3780: </a><span class="php-comment">         * The identifier can then be passed to Cell(), Write(), Image() or Link(). The destination is defined with SetLink().
</span></span><span id="3781" class="l"><a href="#3781"> 3781: </a><span class="php-comment">         * @access public
</span></span><span id="3782" class="l"><a href="#3782"> 3782: </a><span class="php-comment">         * @since 1.5
</span></span><span id="3783" class="l"><a href="#3783"> 3783: </a><span class="php-comment">         * @see Cell(), Write(), Image(), Link(), SetLink()
</span></span><span id="3784" class="l"><a href="#3784"> 3784: </a><span class="php-comment">         */</span>
</span><span id="3785" class="l"><a href="#3785"> 3785: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> AddLink() {
</span><span id="3786" class="l"><a href="#3786"> 3786: </a>            <span class="php-comment">//Create a new internal link</span>
</span><span id="3787" class="l"><a href="#3787"> 3787: </a>            <span class="php-var">$n</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;links) + <span class="php-num">1</span>;
</span><span id="3788" class="l"><a href="#3788"> 3788: </a>            <span class="php-var">$this</span>-&gt;links[<span class="php-var">$n</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>);
</span><span id="3789" class="l"><a href="#3789"> 3789: </a>            <span class="php-keyword1">return</span> <span class="php-var">$n</span>;
</span><span id="3790" class="l"><a href="#3790"> 3790: </a>        }
</span><span id="3791" class="l"><a href="#3791"> 3791: </a>
</span><span id="3792" class="l"><a href="#3792"> 3792: </a>        <span class="php-comment">/**
</span></span><span id="3793" class="l"><a href="#3793"> 3793: </a><span class="php-comment">         * Defines the page and position a link points to.
</span></span><span id="3794" class="l"><a href="#3794"> 3794: </a><span class="php-comment">         * @param int $link The link identifier returned by AddLink()
</span></span><span id="3795" class="l"><a href="#3795"> 3795: </a><span class="php-comment">         * @param float $y Ordinate of target position; -1 indicates the current position. The default value is 0 (top of page)
</span></span><span id="3796" class="l"><a href="#3796"> 3796: </a><span class="php-comment">         * @param int $page Number of target page; -1 indicates the current page. This is the default value
</span></span><span id="3797" class="l"><a href="#3797"> 3797: </a><span class="php-comment">         * @access public
</span></span><span id="3798" class="l"><a href="#3798"> 3798: </a><span class="php-comment">         * @since 1.5
</span></span><span id="3799" class="l"><a href="#3799"> 3799: </a><span class="php-comment">         * @see AddLink()
</span></span><span id="3800" class="l"><a href="#3800"> 3800: </a><span class="php-comment">         */</span>
</span><span id="3801" class="l"><a href="#3801"> 3801: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetLink(<span class="php-var">$link</span>, <span class="php-var">$y</span>=<span class="php-num">0</span>, <span class="php-var">$page</span>=-<span class="php-num">1</span>) {
</span><span id="3802" class="l"><a href="#3802"> 3802: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> == -<span class="php-num">1</span>) {
</span><span id="3803" class="l"><a href="#3803"> 3803: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="3804" class="l"><a href="#3804"> 3804: </a>            }
</span><span id="3805" class="l"><a href="#3805"> 3805: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$page</span> == -<span class="php-num">1</span>) {
</span><span id="3806" class="l"><a href="#3806"> 3806: </a>                <span class="php-var">$page</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="3807" class="l"><a href="#3807"> 3807: </a>            }
</span><span id="3808" class="l"><a href="#3808"> 3808: </a>            <span class="php-var">$this</span>-&gt;links[<span class="php-var">$link</span>] = <span class="php-keyword1">array</span>(<span class="php-var">$page</span>, <span class="php-var">$y</span>);
</span><span id="3809" class="l"><a href="#3809"> 3809: </a>        }
</span><span id="3810" class="l"><a href="#3810"> 3810: </a>
</span><span id="3811" class="l"><a href="#3811"> 3811: </a>        <span class="php-comment">/**
</span></span><span id="3812" class="l"><a href="#3812"> 3812: </a><span class="php-comment">         * Puts a link on a rectangular area of the page.
</span></span><span id="3813" class="l"><a href="#3813"> 3813: </a><span class="php-comment">         * Text or image links are generally put via Cell(), Write() or Image(), but this method can be useful for instance to define a clickable area inside an image.
</span></span><span id="3814" class="l"><a href="#3814"> 3814: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="3815" class="l"><a href="#3815"> 3815: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="3816" class="l"><a href="#3816"> 3816: </a><span class="php-comment">         * @param float $w Width of the rectangle
</span></span><span id="3817" class="l"><a href="#3817"> 3817: </a><span class="php-comment">         * @param float $h Height of the rectangle
</span></span><span id="3818" class="l"><a href="#3818"> 3818: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink()
</span></span><span id="3819" class="l"><a href="#3819"> 3819: </a><span class="php-comment">         * @param int $spaces number of spaces on the text to link
</span></span><span id="3820" class="l"><a href="#3820"> 3820: </a><span class="php-comment">         * @access public
</span></span><span id="3821" class="l"><a href="#3821"> 3821: </a><span class="php-comment">         * @since 1.5
</span></span><span id="3822" class="l"><a href="#3822"> 3822: </a><span class="php-comment">         * @see AddLink(), Annotation(), Cell(), Write(), Image()
</span></span><span id="3823" class="l"><a href="#3823"> 3823: </a><span class="php-comment">         */</span>
</span><span id="3824" class="l"><a href="#3824"> 3824: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> <span class="php-keyword2">Link</span>(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$link</span>, <span class="php-var">$spaces</span>=<span class="php-num">0</span>) {
</span><span id="3825" class="l"><a href="#3825"> 3825: </a>            <span class="php-var">$this</span>-&gt;Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$link</span>, <span class="php-keyword1">array</span>(<span class="php-quote">'Subtype'</span>=&gt;<span class="php-quote">'Link'</span>), <span class="php-var">$spaces</span>);
</span><span id="3826" class="l"><a href="#3826"> 3826: </a>        }
</span><span id="3827" class="l"><a href="#3827"> 3827: </a>
</span><span id="3828" class="l"><a href="#3828"> 3828: </a>        <span class="php-comment">/**
</span></span><span id="3829" class="l"><a href="#3829"> 3829: </a><span class="php-comment">         * Puts a markup annotation on a rectangular area of the page.
</span></span><span id="3830" class="l"><a href="#3830"> 3830: </a><span class="php-comment">         * !!!!THE ANNOTATION SUPPORT IS NOT YET FULLY IMPLEMENTED !!!!
</span></span><span id="3831" class="l"><a href="#3831"> 3831: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="3832" class="l"><a href="#3832"> 3832: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="3833" class="l"><a href="#3833"> 3833: </a><span class="php-comment">         * @param float $w Width of the rectangle
</span></span><span id="3834" class="l"><a href="#3834"> 3834: </a><span class="php-comment">         * @param float $h Height of the rectangle
</span></span><span id="3835" class="l"><a href="#3835"> 3835: </a><span class="php-comment">         * @param string $text annotation text or alternate content
</span></span><span id="3836" class="l"><a href="#3836"> 3836: </a><span class="php-comment">         * @param array $opt array of options (see section 8.4 of PDF reference 1.7).
</span></span><span id="3837" class="l"><a href="#3837"> 3837: </a><span class="php-comment">         * @param int $spaces number of spaces on the text to link
</span></span><span id="3838" class="l"><a href="#3838"> 3838: </a><span class="php-comment">         * @access public
</span></span><span id="3839" class="l"><a href="#3839"> 3839: </a><span class="php-comment">         * @since 4.0.018 (2008-08-06)
</span></span><span id="3840" class="l"><a href="#3840"> 3840: </a><span class="php-comment">         */</span>
</span><span id="3841" class="l"><a href="#3841"> 3841: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$text</span>, <span class="php-var">$opt</span>=<span class="php-keyword1">array</span>(<span class="php-quote">'Subtype'</span>=&gt;<span class="php-quote">'Text'</span>), <span class="php-var">$spaces</span>=<span class="php-num">0</span>) {
</span><span id="3842" class="l"><a href="#3842"> 3842: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="3843" class="l"><a href="#3843"> 3843: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="3844" class="l"><a href="#3844"> 3844: </a>            }
</span><span id="3845" class="l"><a href="#3845"> 3845: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="3846" class="l"><a href="#3846"> 3846: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="3847" class="l"><a href="#3847"> 3847: </a>            }
</span><span id="3848" class="l"><a href="#3848"> 3848: </a>            <span class="php-comment">// recalculate coordinates to account for graphic transformations</span>
</span><span id="3849" class="l"><a href="#3849"> 3849: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmatrix)) {
</span><span id="3850" class="l"><a href="#3850"> 3850: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-var">$this</span>-&gt;transfmatrix_key; <span class="php-var">$i</span> &gt; <span class="php-num">0</span>; --<span class="php-var">$i</span>) {
</span><span id="3851" class="l"><a href="#3851"> 3851: </a>                    <span class="php-var">$maxid</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;transfmatrix[<span class="php-var">$i</span>]) - <span class="php-num">1</span>;
</span><span id="3852" class="l"><a href="#3852"> 3852: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$j</span>=<span class="php-var">$maxid</span>; <span class="php-var">$j</span> &gt;= <span class="php-num">0</span>; --<span class="php-var">$j</span>) {
</span><span id="3853" class="l"><a href="#3853"> 3853: </a>                        <span class="php-var">$ctm</span> = <span class="php-var">$this</span>-&gt;transfmatrix[<span class="php-var">$i</span>][<span class="php-var">$j</span>];
</span><span id="3854" class="l"><a href="#3854"> 3854: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$ctm</span>[<span class="php-quote">'a'</span>])) {
</span><span id="3855" class="l"><a href="#3855"> 3855: </a>                            <span class="php-var">$x</span> = <span class="php-var">$x</span> * <span class="php-var">$this</span>-&gt;k;
</span><span id="3856" class="l"><a href="#3856"> 3856: </a>                            <span class="php-var">$y</span> = (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="3857" class="l"><a href="#3857"> 3857: </a>                            <span class="php-var">$w</span> = <span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k;
</span><span id="3858" class="l"><a href="#3858"> 3858: </a>                            <span class="php-var">$h</span> = <span class="php-var">$h</span> * <span class="php-var">$this</span>-&gt;k;
</span><span id="3859" class="l"><a href="#3859"> 3859: </a>                            <span class="php-comment">// top left</span>
</span><span id="3860" class="l"><a href="#3860"> 3860: </a>                            <span class="php-var">$xt</span> = <span class="php-var">$x</span>;
</span><span id="3861" class="l"><a href="#3861"> 3861: </a>                            <span class="php-var">$yt</span> = <span class="php-var">$y</span>;
</span><span id="3862" class="l"><a href="#3862"> 3862: </a>                            <span class="php-var">$x1</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'a'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'c'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'e'</span>];
</span><span id="3863" class="l"><a href="#3863"> 3863: </a>                            <span class="php-var">$y1</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'b'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'d'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'f'</span>];
</span><span id="3864" class="l"><a href="#3864"> 3864: </a>                            <span class="php-comment">// top right</span>
</span><span id="3865" class="l"><a href="#3865"> 3865: </a>                            <span class="php-var">$xt</span> = <span class="php-var">$x</span> + <span class="php-var">$w</span>;
</span><span id="3866" class="l"><a href="#3866"> 3866: </a>                            <span class="php-var">$yt</span> = <span class="php-var">$y</span>;
</span><span id="3867" class="l"><a href="#3867"> 3867: </a>                            <span class="php-var">$x2</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'a'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'c'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'e'</span>];
</span><span id="3868" class="l"><a href="#3868"> 3868: </a>                            <span class="php-var">$y2</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'b'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'d'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'f'</span>];
</span><span id="3869" class="l"><a href="#3869"> 3869: </a>                            <span class="php-comment">// bottom left</span>
</span><span id="3870" class="l"><a href="#3870"> 3870: </a>                            <span class="php-var">$xt</span> = <span class="php-var">$x</span>;
</span><span id="3871" class="l"><a href="#3871"> 3871: </a>                            <span class="php-var">$yt</span> = <span class="php-var">$y</span> - <span class="php-var">$h</span>;
</span><span id="3872" class="l"><a href="#3872"> 3872: </a>                            <span class="php-var">$x3</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'a'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'c'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'e'</span>];
</span><span id="3873" class="l"><a href="#3873"> 3873: </a>                            <span class="php-var">$y3</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'b'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'d'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'f'</span>];
</span><span id="3874" class="l"><a href="#3874"> 3874: </a>                            <span class="php-comment">// bottom right</span>
</span><span id="3875" class="l"><a href="#3875"> 3875: </a>                            <span class="php-var">$xt</span> = <span class="php-var">$x</span> + <span class="php-var">$w</span>;
</span><span id="3876" class="l"><a href="#3876"> 3876: </a>                            <span class="php-var">$yt</span> = <span class="php-var">$y</span> - <span class="php-var">$h</span>;
</span><span id="3877" class="l"><a href="#3877"> 3877: </a>                            <span class="php-var">$x4</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'a'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'c'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'e'</span>];
</span><span id="3878" class="l"><a href="#3878"> 3878: </a>                            <span class="php-var">$y4</span> = (<span class="php-var">$ctm</span>[<span class="php-quote">'b'</span>] * <span class="php-var">$xt</span>) + (<span class="php-var">$ctm</span>[<span class="php-quote">'d'</span>] * <span class="php-var">$yt</span>) + <span class="php-var">$ctm</span>[<span class="php-quote">'f'</span>];
</span><span id="3879" class="l"><a href="#3879"> 3879: </a>                            <span class="php-comment">// new coordinates (rectangle area)</span>
</span><span id="3880" class="l"><a href="#3880"> 3880: </a>                            <span class="php-var">$x</span> = <span class="php-keyword2">min</span>(<span class="php-var">$x1</span>, <span class="php-var">$x2</span>, <span class="php-var">$x3</span>, <span class="php-var">$x4</span>);
</span><span id="3881" class="l"><a href="#3881"> 3881: </a>                            <span class="php-var">$y</span> = <span class="php-keyword2">max</span>(<span class="php-var">$y1</span>, <span class="php-var">$y2</span>, <span class="php-var">$y3</span>, <span class="php-var">$y4</span>);
</span><span id="3882" class="l"><a href="#3882"> 3882: </a>                            <span class="php-var">$w</span> = (<span class="php-keyword2">max</span>(<span class="php-var">$x1</span>, <span class="php-var">$x2</span>, <span class="php-var">$x3</span>, <span class="php-var">$x4</span>) - <span class="php-var">$x</span>) / <span class="php-var">$this</span>-&gt;k;
</span><span id="3883" class="l"><a href="#3883"> 3883: </a>                            <span class="php-var">$h</span> = (<span class="php-var">$y</span> - <span class="php-keyword2">min</span>(<span class="php-var">$y1</span>, <span class="php-var">$y2</span>, <span class="php-var">$y3</span>, <span class="php-var">$y4</span>)) / <span class="php-var">$this</span>-&gt;k;
</span><span id="3884" class="l"><a href="#3884"> 3884: </a>                            <span class="php-var">$x</span> = <span class="php-var">$x</span> / <span class="php-var">$this</span>-&gt;k;
</span><span id="3885" class="l"><a href="#3885"> 3885: </a>                            <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;h - (<span class="php-var">$y</span> / <span class="php-var">$this</span>-&gt;k);
</span><span id="3886" class="l"><a href="#3886"> 3886: </a>                        }
</span><span id="3887" class="l"><a href="#3887"> 3887: </a>                    }
</span><span id="3888" class="l"><a href="#3888"> 3888: </a>                }
</span><span id="3889" class="l"><a href="#3889"> 3889: </a>            }
</span><span id="3890" class="l"><a href="#3890"> 3890: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &lt;= <span class="php-num">0</span>) {
</span><span id="3891" class="l"><a href="#3891"> 3891: </a>                <span class="php-var">$page</span> = <span class="php-num">1</span>;
</span><span id="3892" class="l"><a href="#3892"> 3892: </a>            } <span class="php-keyword1">else</span> {
</span><span id="3893" class="l"><a href="#3893"> 3893: </a>                <span class="php-var">$page</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="3894" class="l"><a href="#3894"> 3894: </a>            }
</span><span id="3895" class="l"><a href="#3895"> 3895: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$page</span>])) {
</span><span id="3896" class="l"><a href="#3896"> 3896: </a>                <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$page</span>] = <span class="php-keyword1">array</span>();
</span><span id="3897" class="l"><a href="#3897"> 3897: </a>            }
</span><span id="3898" class="l"><a href="#3898"> 3898: </a>            <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$page</span>][] = <span class="php-keyword1">array</span>(<span class="php-quote">'x'</span> =&gt; <span class="php-var">$x</span>, <span class="php-quote">'y'</span> =&gt; <span class="php-var">$y</span>, <span class="php-quote">'w'</span> =&gt; <span class="php-var">$w</span>, <span class="php-quote">'h'</span> =&gt; <span class="php-var">$h</span>, <span class="php-quote">'txt'</span> =&gt; <span class="php-var">$text</span>, <span class="php-quote">'opt'</span> =&gt; <span class="php-var">$opt</span>, <span class="php-quote">'numspaces'</span> =&gt; <span class="php-var">$spaces</span>);
</span><span id="3899" class="l"><a href="#3899"> 3899: </a>            <span class="php-keyword1">if</span> (((<span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] == <span class="php-quote">'FileAttachment'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] == <span class="php-quote">'Sound'</span>)) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$opt</span>[<span class="php-quote">'FS'</span>])) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$opt</span>[<span class="php-quote">'FS'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;embeddedfiles[<span class="php-keyword2">basename</span>(<span class="php-var">$opt</span>[<span class="php-quote">'FS'</span>])]))) {
</span><span id="3900" class="l"><a href="#3900"> 3900: </a>                <span class="php-var">$this</span>-&gt;embeddedfiles[<span class="php-keyword2">basename</span>(<span class="php-var">$opt</span>[<span class="php-quote">'FS'</span>])] = <span class="php-keyword1">array</span>(<span class="php-quote">'file'</span> =&gt; <span class="php-var">$opt</span>[<span class="php-quote">'FS'</span>], <span class="php-quote">'n'</span> =&gt; (<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;embeddedfiles) + <span class="php-var">$this</span>-&gt;embedded_start_obj_id));
</span><span id="3901" class="l"><a href="#3901"> 3901: </a>            }
</span><span id="3902" class="l"><a href="#3902"> 3902: </a>            <span class="php-comment">// Add widgets annotation's icons</span>
</span><span id="3903" class="l"><a href="#3903"> 3903: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'i'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'i'</span>])) {
</span><span id="3904" class="l"><a href="#3904"> 3904: </a>                <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'i'</span>], <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-num">10</span>, <span class="php-num">10</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-num">300</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">true</span>);
</span><span id="3905" class="l"><a href="#3905"> 3905: </a>            }
</span><span id="3906" class="l"><a href="#3906"> 3906: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ri'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ri'</span>])) {
</span><span id="3907" class="l"><a href="#3907"> 3907: </a>                <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ri'</span>], <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-num">300</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">true</span>);
</span><span id="3908" class="l"><a href="#3908"> 3908: </a>            }
</span><span id="3909" class="l"><a href="#3909"> 3909: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ix'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ix'</span>])) {
</span><span id="3910" class="l"><a href="#3910"> 3910: </a>                <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ix'</span>], <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-num">300</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">true</span>);
</span><span id="3911" class="l"><a href="#3911"> 3911: </a>            }
</span><span id="3912" class="l"><a href="#3912"> 3912: </a>            ++<span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="3913" class="l"><a href="#3913"> 3913: </a>        }
</span><span id="3914" class="l"><a href="#3914"> 3914: </a>
</span><span id="3915" class="l"><a href="#3915"> 3915: </a>        <span class="php-comment">/**
</span></span><span id="3916" class="l"><a href="#3916"> 3916: </a><span class="php-comment">         * Embedd the attached files.
</span></span><span id="3917" class="l"><a href="#3917"> 3917: </a><span class="php-comment">         * @since 4.4.000 (2008-12-07)
</span></span><span id="3918" class="l"><a href="#3918"> 3918: </a><span class="php-comment">         * @access protected
</span></span><span id="3919" class="l"><a href="#3919"> 3919: </a><span class="php-comment">         * @see Annotation()
</span></span><span id="3920" class="l"><a href="#3920"> 3920: </a><span class="php-comment">         */</span>
</span><span id="3921" class="l"><a href="#3921"> 3921: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putEmbeddedFiles() {
</span><span id="3922" class="l"><a href="#3922"> 3922: </a>            <span class="php-keyword2">reset</span>(<span class="php-var">$this</span>-&gt;embeddedfiles);
</span><span id="3923" class="l"><a href="#3923"> 3923: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;embeddedfiles <span class="php-keyword1">as</span> <span class="php-var">$filename</span> =&gt; <span class="php-var">$filedata</span>) {
</span><span id="3924" class="l"><a href="#3924"> 3924: </a>                <span class="php-var">$data</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$filedata</span>[<span class="php-quote">'file'</span>]);
</span><span id="3925" class="l"><a href="#3925"> 3925: </a>                <span class="php-var">$filter</span> = <span class="php-quote">''</span>;
</span><span id="3926" class="l"><a href="#3926"> 3926: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;compress) {
</span><span id="3927" class="l"><a href="#3927"> 3927: </a>                    <span class="php-var">$data</span> = <span class="php-keyword2">gzcompress</span>(<span class="php-var">$data</span>);
</span><span id="3928" class="l"><a href="#3928"> 3928: </a>                    <span class="php-var">$filter</span> = <span class="php-quote">' /Filter /FlateDecode'</span>;
</span><span id="3929" class="l"><a href="#3929"> 3929: </a>                }
</span><span id="3930" class="l"><a href="#3930"> 3930: </a>                <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$filedata</span>[<span class="php-quote">'n'</span>]] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="3931" class="l"><a href="#3931"> 3931: </a>                <span class="php-var">$out</span> = <span class="php-var">$filedata</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 obj'</span>;
</span><span id="3932" class="l"><a href="#3932"> 3932: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &lt;&lt;/Type /EmbeddedFile'</span>.<span class="php-var">$filter</span>.<span class="php-quote">' /Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$data</span>).<span class="php-quote">' &gt;&gt;'</span>;
</span><span id="3933" class="l"><a href="#3933"> 3933: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$data</span>, <span class="php-var">$filedata</span>[<span class="php-quote">'n'</span>]);
</span><span id="3934" class="l"><a href="#3934"> 3934: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="3935" class="l"><a href="#3935"> 3935: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="3936" class="l"><a href="#3936"> 3936: </a>            }
</span><span id="3937" class="l"><a href="#3937"> 3937: </a>        }
</span><span id="3938" class="l"><a href="#3938"> 3938: </a>
</span><span id="3939" class="l"><a href="#3939"> 3939: </a>        <span class="php-comment">/**
</span></span><span id="3940" class="l"><a href="#3940"> 3940: </a><span class="php-comment">         * Prints a text cell at the specified position.
</span></span><span id="3941" class="l"><a href="#3941"> 3941: </a><span class="php-comment">         * The origin is on the left of the first charcter, on the baseline.
</span></span><span id="3942" class="l"><a href="#3942"> 3942: </a><span class="php-comment">         * This method allows to place a string precisely on the page.
</span></span><span id="3943" class="l"><a href="#3943"> 3943: </a><span class="php-comment">         * @param float $x Abscissa of the cell origin
</span></span><span id="3944" class="l"><a href="#3944"> 3944: </a><span class="php-comment">         * @param float $y Ordinate of the cell origin
</span></span><span id="3945" class="l"><a href="#3945"> 3945: </a><span class="php-comment">         * @param string $txt String to print
</span></span><span id="3946" class="l"><a href="#3946"> 3946: </a><span class="php-comment">         * @param int $fstroke outline size in user units (false = disable)
</span></span><span id="3947" class="l"><a href="#3947"> 3947: </a><span class="php-comment">         * @param boolean $fclip if true activate clipping mode (you must call StartTransform() before this function and StopTransform() to stop the clipping tranformation).
</span></span><span id="3948" class="l"><a href="#3948"> 3948: </a><span class="php-comment">         * @param boolean $ffill if true fills the text
</span></span><span id="3949" class="l"><a href="#3949"> 3949: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the cell. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="3950" class="l"><a href="#3950"> 3950: </a><span class="php-comment">         * @param int $ln Indicates where the current position should go after the call. Possible values are:&lt;ul&gt;&lt;li&gt;0: to the right (or left for RTL languages)&lt;/li&gt;&lt;li&gt;1: to the beginning of the next line&lt;/li&gt;&lt;li&gt;2: below&lt;/li&gt;&lt;/ul&gt;Putting 1 is equivalent to putting 0 and calling Ln() just after. Default value: 0.
</span></span><span id="3951" class="l"><a href="#3951"> 3951: </a><span class="php-comment">         * @param string $align Allows to center or align the text. Possible values are:&lt;ul&gt;&lt;li&gt;L or empty string: left align (default value)&lt;/li&gt;&lt;li&gt;C: center&lt;/li&gt;&lt;li&gt;R: right align&lt;/li&gt;&lt;li&gt;J: justify&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="3952" class="l"><a href="#3952"> 3952: </a><span class="php-comment">         * @param int $fill Indicates if the cell background must be painted (1) or transparent (0). Default value: 0.
</span></span><span id="3953" class="l"><a href="#3953"> 3953: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink().
</span></span><span id="3954" class="l"><a href="#3954"> 3954: </a><span class="php-comment">         * @param int $stretch stretch carachter mode: &lt;ul&gt;&lt;li&gt;0 = disabled&lt;/li&gt;&lt;li&gt;1 = horizontal scaling only if necessary&lt;/li&gt;&lt;li&gt;2 = forced horizontal scaling&lt;/li&gt;&lt;li&gt;3 = character spacing only if necessary&lt;/li&gt;&lt;li&gt;4 = forced character spacing&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="3955" class="l"><a href="#3955"> 3955: </a><span class="php-comment">         * @param boolean $ignore_min_height if true ignore automatic minimum height value.
</span></span><span id="3956" class="l"><a href="#3956"> 3956: </a><span class="php-comment">         * @param string $calign cell vertical alignment relative to the specified Y value. Possible values are:&lt;ul&gt;&lt;li&gt;T : cell top&lt;/li&gt;&lt;li&gt;A : font top&lt;/li&gt;&lt;li&gt;L : font baseline&lt;/li&gt;&lt;li&gt;D : font bottom&lt;/li&gt;&lt;li&gt;B : cell bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="3957" class="l"><a href="#3957"> 3957: </a><span class="php-comment">         * @param string $valign text vertical alignment inside the cell. Possible values are:&lt;ul&gt;&lt;li&gt;T : top&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;B : bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="3958" class="l"><a href="#3958"> 3958: </a><span class="php-comment">         * @param boolean $rtloff if true uses the page top-left corner as origin of axis for $x and $y initial position.
</span></span><span id="3959" class="l"><a href="#3959"> 3959: </a><span class="php-comment">         * @access public
</span></span><span id="3960" class="l"><a href="#3960"> 3960: </a><span class="php-comment">         * @since 1.0
</span></span><span id="3961" class="l"><a href="#3961"> 3961: </a><span class="php-comment">         * @see Cell(), Write(), MultiCell(), WriteHTML(), WriteHTMLCell()
</span></span><span id="3962" class="l"><a href="#3962"> 3962: </a><span class="php-comment">         */</span>
</span><span id="3963" class="l"><a href="#3963"> 3963: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Text(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$txt</span>, <span class="php-var">$fstroke</span>=<span class="php-keyword1">false</span>, <span class="php-var">$fclip</span>=<span class="php-keyword1">false</span>, <span class="php-var">$ffill</span>=<span class="php-keyword1">true</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$ln</span>=<span class="php-num">0</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$fill</span>=<span class="php-num">0</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$stretch</span>=<span class="php-num">0</span>, <span class="php-var">$ignore_min_height</span>=<span class="php-keyword1">false</span>, <span class="php-var">$calign</span>=<span class="php-quote">'T'</span>, <span class="php-var">$valign</span>=<span class="php-quote">'M'</span>, <span class="php-var">$rtloff</span>=<span class="php-keyword1">false</span>) {
</span><span id="3964" class="l"><a href="#3964"> 3964: </a>            <span class="php-var">$textrendermode</span> = <span class="php-var">$this</span>-&gt;textrendermode;
</span><span id="3965" class="l"><a href="#3965"> 3965: </a>            <span class="php-var">$textstrokewidth</span> = <span class="php-var">$this</span>-&gt;textstrokewidth;
</span><span id="3966" class="l"><a href="#3966"> 3966: </a>            <span class="php-var">$this</span>-&gt;setTextRenderingMode(<span class="php-var">$fstroke</span>, <span class="php-var">$ffill</span>, <span class="php-var">$fclip</span>);
</span><span id="3967" class="l"><a href="#3967"> 3967: </a>            <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$rtloff</span>);
</span><span id="3968" class="l"><a href="#3968"> 3968: </a>            <span class="php-var">$this</span>-&gt;Cell(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$txt</span>, <span class="php-var">$border</span>, <span class="php-var">$ln</span>, <span class="php-var">$align</span>, <span class="php-var">$fill</span>, <span class="php-var">$link</span>, <span class="php-var">$stretch</span>, <span class="php-var">$ignore_min_height</span>, <span class="php-var">$calign</span>, <span class="php-var">$valign</span>);
</span><span id="3969" class="l"><a href="#3969"> 3969: </a>            <span class="php-comment">// restore previous rendering mode</span>
</span><span id="3970" class="l"><a href="#3970"> 3970: </a>            <span class="php-var">$this</span>-&gt;textrendermode = <span class="php-var">$textrendermode</span>;
</span><span id="3971" class="l"><a href="#3971"> 3971: </a>            <span class="php-var">$this</span>-&gt;textstrokewidth = <span class="php-var">$textstrokewidth</span>;
</span><span id="3972" class="l"><a href="#3972"> 3972: </a>        }
</span><span id="3973" class="l"><a href="#3973"> 3973: </a>
</span><span id="3974" class="l"><a href="#3974"> 3974: </a>        <span class="php-comment">/**
</span></span><span id="3975" class="l"><a href="#3975"> 3975: </a><span class="php-comment">         * Whenever a page break condition is met, the method is called, and the break is issued or not depending on the returned value.
</span></span><span id="3976" class="l"><a href="#3976"> 3976: </a><span class="php-comment">         * The default implementation returns a value according to the mode selected by SetAutoPageBreak().&lt;br /&gt;
</span></span><span id="3977" class="l"><a href="#3977"> 3977: </a><span class="php-comment">         * This method is called automatically and should not be called directly by the application.
</span></span><span id="3978" class="l"><a href="#3978"> 3978: </a><span class="php-comment">         * @return boolean
</span></span><span id="3979" class="l"><a href="#3979"> 3979: </a><span class="php-comment">         * @access public
</span></span><span id="3980" class="l"><a href="#3980"> 3980: </a><span class="php-comment">         * @since 1.4
</span></span><span id="3981" class="l"><a href="#3981"> 3981: </a><span class="php-comment">         * @see SetAutoPageBreak()
</span></span><span id="3982" class="l"><a href="#3982"> 3982: </a><span class="php-comment">         */</span>
</span><span id="3983" class="l"><a href="#3983"> 3983: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> AcceptPageBreak() {
</span><span id="3984" class="l"><a href="#3984"> 3984: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;num_columns &gt; <span class="php-num">1</span>) {
</span><span id="3985" class="l"><a href="#3985"> 3985: </a>                <span class="php-comment">// multi column mode</span>
</span><span id="3986" class="l"><a href="#3986"> 3986: </a>                <span class="php-keyword1">if</span>(<span class="php-var">$this</span>-&gt;current_column &lt; (<span class="php-var">$this</span>-&gt;num_columns - <span class="php-num">1</span>)) {
</span><span id="3987" class="l"><a href="#3987"> 3987: </a>                    <span class="php-comment">// go to next column</span>
</span><span id="3988" class="l"><a href="#3988"> 3988: </a>                    <span class="php-var">$this</span>-&gt;selectColumn(<span class="php-var">$this</span>-&gt;current_column + <span class="php-num">1</span>);
</span><span id="3989" class="l"><a href="#3989"> 3989: </a>                } <span class="php-keyword1">else</span> {
</span><span id="3990" class="l"><a href="#3990"> 3990: </a>                    <span class="php-comment">// add a new page</span>
</span><span id="3991" class="l"><a href="#3991"> 3991: </a>                    <span class="php-var">$this</span>-&gt;AddPage();
</span><span id="3992" class="l"><a href="#3992"> 3992: </a>                    <span class="php-comment">// set first column</span>
</span><span id="3993" class="l"><a href="#3993"> 3993: </a>                    <span class="php-var">$this</span>-&gt;selectColumn(<span class="php-num">0</span>);
</span><span id="3994" class="l"><a href="#3994"> 3994: </a>                }
</span><span id="3995" class="l"><a href="#3995"> 3995: </a>                <span class="php-comment">// avoid page breaking from checkPageBreak()</span>
</span><span id="3996" class="l"><a href="#3996"> 3996: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="3997" class="l"><a href="#3997"> 3997: </a>            }
</span><span id="3998" class="l"><a href="#3998"> 3998: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;AutoPageBreak;
</span><span id="3999" class="l"><a href="#3999"> 3999: </a>        }
</span><span id="4000" class="l"><a href="#4000"> 4000: </a>
</span><span id="4001" class="l"><a href="#4001"> 4001: </a>        <span class="php-comment">/**
</span></span><span id="4002" class="l"><a href="#4002"> 4002: </a><span class="php-comment">         * Add page if needed.
</span></span><span id="4003" class="l"><a href="#4003"> 4003: </a><span class="php-comment">         * @param float $h Cell height. Default value: 0.
</span></span><span id="4004" class="l"><a href="#4004"> 4004: </a><span class="php-comment">         * @param mixed $y starting y position, leave empty for current position.
</span></span><span id="4005" class="l"><a href="#4005"> 4005: </a><span class="php-comment">         * @param boolean $addpage if true add a page, otherwise only return the true/false state
</span></span><span id="4006" class="l"><a href="#4006"> 4006: </a><span class="php-comment">         * @return boolean true in case of page break, false otherwise.
</span></span><span id="4007" class="l"><a href="#4007"> 4007: </a><span class="php-comment">         * @since 3.2.000 (2008-07-01)
</span></span><span id="4008" class="l"><a href="#4008"> 4008: </a><span class="php-comment">         * @access protected
</span></span><span id="4009" class="l"><a href="#4009"> 4009: </a><span class="php-comment">         */</span>
</span><span id="4010" class="l"><a href="#4010"> 4010: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> checkPageBreak(<span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$addpage</span>=<span class="php-keyword1">true</span>) {
</span><span id="4011" class="l"><a href="#4011"> 4011: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$y</span>)) {
</span><span id="4012" class="l"><a href="#4012"> 4012: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="4013" class="l"><a href="#4013"> 4013: </a>            }
</span><span id="4014" class="l"><a href="#4014"> 4014: </a>            <span class="php-keyword1">if</span> (((<span class="php-var">$y</span> + <span class="php-var">$h</span>) &gt; <span class="php-var">$this</span>-&gt;PageBreakTrigger) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;InFooter) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;AcceptPageBreak())) {
</span><span id="4015" class="l"><a href="#4015"> 4015: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$addpage</span>) {
</span><span id="4016" class="l"><a href="#4016"> 4016: </a>                    <span class="php-comment">//Automatic page break</span>
</span><span id="4017" class="l"><a href="#4017"> 4017: </a>                    <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="4018" class="l"><a href="#4018"> 4018: </a>                    <span class="php-var">$this</span>-&gt;AddPage(<span class="php-var">$this</span>-&gt;CurOrientation);
</span><span id="4019" class="l"><a href="#4019"> 4019: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="4020" class="l"><a href="#4020"> 4020: </a>                    <span class="php-var">$oldpage</span> = <span class="php-var">$this</span>-&gt;page - <span class="php-num">1</span>;
</span><span id="4021" class="l"><a href="#4021"> 4021: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4022" class="l"><a href="#4022"> 4022: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$oldpage</span>][<span class="php-quote">'orm'</span>]) {
</span><span id="4023" class="l"><a href="#4023"> 4023: </a>                            <span class="php-var">$this</span>-&gt;x = <span class="php-var">$x</span> - (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$oldpage</span>][<span class="php-quote">'orm'</span>]);
</span><span id="4024" class="l"><a href="#4024"> 4024: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4025" class="l"><a href="#4025"> 4025: </a>                            <span class="php-var">$this</span>-&gt;x = <span class="php-var">$x</span>;
</span><span id="4026" class="l"><a href="#4026"> 4026: </a>                        }
</span><span id="4027" class="l"><a href="#4027"> 4027: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4028" class="l"><a href="#4028"> 4028: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$oldpage</span>][<span class="php-quote">'olm'</span>]) {
</span><span id="4029" class="l"><a href="#4029"> 4029: </a>                            <span class="php-var">$this</span>-&gt;x = <span class="php-var">$x</span> + (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$oldpage</span>][<span class="php-quote">'olm'</span>]);
</span><span id="4030" class="l"><a href="#4030"> 4030: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4031" class="l"><a href="#4031"> 4031: </a>                            <span class="php-var">$this</span>-&gt;x = <span class="php-var">$x</span>;
</span><span id="4032" class="l"><a href="#4032"> 4032: </a>                        }
</span><span id="4033" class="l"><a href="#4033"> 4033: </a>                    }
</span><span id="4034" class="l"><a href="#4034"> 4034: </a>                }
</span><span id="4035" class="l"><a href="#4035"> 4035: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="4036" class="l"><a href="#4036"> 4036: </a>            }
</span><span id="4037" class="l"><a href="#4037"> 4037: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="4038" class="l"><a href="#4038"> 4038: </a>        }
</span><span id="4039" class="l"><a href="#4039"> 4039: </a>
</span><span id="4040" class="l"><a href="#4040"> 4040: </a>        <span class="php-comment">/**
</span></span><span id="4041" class="l"><a href="#4041"> 4041: </a><span class="php-comment">         * Prints a cell (rectangular area) with optional borders, background color and character string. The upper-left corner of the cell corresponds to the current position. The text can be aligned or centered. After the call, the current position moves to the right or to the next line. It is possible to put a link on the text.&lt;br /&gt;
</span></span><span id="4042" class="l"><a href="#4042"> 4042: </a><span class="php-comment">         * If automatic page breaking is enabled and the cell goes beyond the limit, a page break is done before outputting.
</span></span><span id="4043" class="l"><a href="#4043"> 4043: </a><span class="php-comment">         * @param float $w Cell width. If 0, the cell extends up to the right margin.
</span></span><span id="4044" class="l"><a href="#4044"> 4044: </a><span class="php-comment">         * @param float $h Cell height. Default value: 0.
</span></span><span id="4045" class="l"><a href="#4045"> 4045: </a><span class="php-comment">         * @param string $txt String to print. Default value: empty string.
</span></span><span id="4046" class="l"><a href="#4046"> 4046: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the cell. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4047" class="l"><a href="#4047"> 4047: </a><span class="php-comment">         * @param int $ln Indicates where the current position should go after the call. Possible values are:&lt;ul&gt;&lt;li&gt;0: to the right (or left for RTL languages)&lt;/li&gt;&lt;li&gt;1: to the beginning of the next line&lt;/li&gt;&lt;li&gt;2: below&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4048" class="l"><a href="#4048"> 4048: </a><span class="php-comment">        Putting 1 is equivalent to putting 0 and calling Ln() just after. Default value: 0.
</span></span><span id="4049" class="l"><a href="#4049"> 4049: </a><span class="php-comment">         * @param string $align Allows to center or align the text. Possible values are:&lt;ul&gt;&lt;li&gt;L or empty string: left align (default value)&lt;/li&gt;&lt;li&gt;C: center&lt;/li&gt;&lt;li&gt;R: right align&lt;/li&gt;&lt;li&gt;J: justify&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4050" class="l"><a href="#4050"> 4050: </a><span class="php-comment">         * @param int $fill Indicates if the cell background must be painted (1) or transparent (0). Default value: 0.
</span></span><span id="4051" class="l"><a href="#4051"> 4051: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink().
</span></span><span id="4052" class="l"><a href="#4052"> 4052: </a><span class="php-comment">         * @param int $stretch stretch carachter mode: &lt;ul&gt;&lt;li&gt;0 = disabled&lt;/li&gt;&lt;li&gt;1 = horizontal scaling only if necessary&lt;/li&gt;&lt;li&gt;2 = forced horizontal scaling&lt;/li&gt;&lt;li&gt;3 = character spacing only if necessary&lt;/li&gt;&lt;li&gt;4 = forced character spacing&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4053" class="l"><a href="#4053"> 4053: </a><span class="php-comment">         * @param boolean $ignore_min_height if true ignore automatic minimum height value.
</span></span><span id="4054" class="l"><a href="#4054"> 4054: </a><span class="php-comment">         * @param string $calign cell vertical alignment relative to the specified Y value. Possible values are:&lt;ul&gt;&lt;li&gt;T : cell top&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;B : cell bottom&lt;/li&gt;&lt;li&gt;A : font top&lt;/li&gt;&lt;li&gt;L : font baseline&lt;/li&gt;&lt;li&gt;D : font bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4055" class="l"><a href="#4055"> 4055: </a><span class="php-comment">         * @param string $valign text vertical alignment inside the cell. Possible values are:&lt;ul&gt;&lt;li&gt;T : top&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;B : bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4056" class="l"><a href="#4056"> 4056: </a><span class="php-comment">         * @access public
</span></span><span id="4057" class="l"><a href="#4057"> 4057: </a><span class="php-comment">         * @since 1.0
</span></span><span id="4058" class="l"><a href="#4058"> 4058: </a><span class="php-comment">         * @see SetFont(), SetDrawColor(), SetFillColor(), SetTextColor(), SetLineWidth(), AddLink(), Ln(), MultiCell(), Write(), SetAutoPageBreak()
</span></span><span id="4059" class="l"><a href="#4059"> 4059: </a><span class="php-comment">         */</span>
</span><span id="4060" class="l"><a href="#4060"> 4060: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$txt</span>=<span class="php-quote">''</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$ln</span>=<span class="php-num">0</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$fill</span>=<span class="php-num">0</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$stretch</span>=<span class="php-num">0</span>, <span class="php-var">$ignore_min_height</span>=<span class="php-keyword1">false</span>, <span class="php-var">$calign</span>=<span class="php-quote">'T'</span>, <span class="php-var">$valign</span>=<span class="php-quote">'M'</span>) {
</span><span id="4061" class="l"><a href="#4061"> 4061: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$ignore_min_height</span>) {
</span><span id="4062" class="l"><a href="#4062"> 4062: </a>                <span class="php-var">$min_cell_height</span> = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="4063" class="l"><a href="#4063"> 4063: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$h</span> &lt; <span class="php-var">$min_cell_height</span>) {
</span><span id="4064" class="l"><a href="#4064"> 4064: </a>                    <span class="php-var">$h</span> = <span class="php-var">$min_cell_height</span>;
</span><span id="4065" class="l"><a href="#4065"> 4065: </a>                }
</span><span id="4066" class="l"><a href="#4066"> 4066: </a>            }
</span><span id="4067" class="l"><a href="#4067"> 4067: </a>            <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$h</span>);
</span><span id="4068" class="l"><a href="#4068"> 4068: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;getCellCode(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$txt</span>, <span class="php-var">$border</span>, <span class="php-var">$ln</span>, <span class="php-var">$align</span>, <span class="php-var">$fill</span>, <span class="php-var">$link</span>, <span class="php-var">$stretch</span>, <span class="php-var">$ignore_min_height</span>, <span class="php-var">$calign</span>, <span class="php-var">$valign</span>));
</span><span id="4069" class="l"><a href="#4069"> 4069: </a>        }
</span><span id="4070" class="l"><a href="#4070"> 4070: </a>
</span><span id="4071" class="l"><a href="#4071"> 4071: </a>        <span class="php-comment">/**
</span></span><span id="4072" class="l"><a href="#4072"> 4072: </a><span class="php-comment">         * Removes SHY characters from text.
</span></span><span id="4073" class="l"><a href="#4073"> 4073: </a><span class="php-comment">         * @param string $txt input string
</span></span><span id="4074" class="l"><a href="#4074"> 4074: </a><span class="php-comment">         * @return string without SHY characters.
</span></span><span id="4075" class="l"><a href="#4075"> 4075: </a><span class="php-comment">         * @access public
</span></span><span id="4076" class="l"><a href="#4076"> 4076: </a><span class="php-comment">         * @since (4.5.019) 2009-02-28
</span></span><span id="4077" class="l"><a href="#4077"> 4077: </a><span class="php-comment">         */</span>
</span><span id="4078" class="l"><a href="#4078"> 4078: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> removeSHY(<span class="php-var">$txt</span>=<span class="php-quote">''</span>) {
</span><span id="4079" class="l"><a href="#4079"> 4079: </a>            <span class="php-comment">/*
</span></span><span id="4080" class="l"><a href="#4080"> 4080: </a><span class="php-comment">            * Unicode Data
</span></span><span id="4081" class="l"><a href="#4081"> 4081: </a><span class="php-comment">            * Name : SOFT HYPHEN, commonly abbreviated as SHY
</span></span><span id="4082" class="l"><a href="#4082"> 4082: </a><span class="php-comment">            * HTML Entity (decimal): &amp;#173;
</span></span><span id="4083" class="l"><a href="#4083"> 4083: </a><span class="php-comment">            * HTML Entity (hex): &amp;#xad;
</span></span><span id="4084" class="l"><a href="#4084"> 4084: </a><span class="php-comment">            * HTML Entity (named): &amp;shy;
</span></span><span id="4085" class="l"><a href="#4085"> 4085: </a><span class="php-comment">            * How to type in Microsoft Windows: [Alt +00AD] or [Alt 0173]
</span></span><span id="4086" class="l"><a href="#4086"> 4086: </a><span class="php-comment">            * UTF-8 (hex): 0xC2 0xAD (c2ad)
</span></span><span id="4087" class="l"><a href="#4087"> 4087: </a><span class="php-comment">            * UTF-8 character: chr(194).chr(173)
</span></span><span id="4088" class="l"><a href="#4088"> 4088: </a><span class="php-comment">            */</span>
</span><span id="4089" class="l"><a href="#4089"> 4089: </a>            <span class="php-var">$txt</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/([\\xc2]{1}[\\xad]{1})/'</span>, <span class="php-quote">''</span>, <span class="php-var">$txt</span>);
</span><span id="4090" class="l"><a href="#4090"> 4090: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="4091" class="l"><a href="#4091"> 4091: </a>                <span class="php-var">$txt</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/([\\xad]{1})/'</span>, <span class="php-quote">''</span>, <span class="php-var">$txt</span>);
</span><span id="4092" class="l"><a href="#4092"> 4092: </a>            }
</span><span id="4093" class="l"><a href="#4093"> 4093: </a>            <span class="php-keyword1">return</span> <span class="php-var">$txt</span>;
</span><span id="4094" class="l"><a href="#4094"> 4094: </a>        }
</span><span id="4095" class="l"><a href="#4095"> 4095: </a>
</span><span id="4096" class="l"><a href="#4096"> 4096: </a>        <span class="php-comment">/**
</span></span><span id="4097" class="l"><a href="#4097"> 4097: </a><span class="php-comment">         * Returns the PDF string code to print a cell (rectangular area) with optional borders, background color and character string. The upper-left corner of the cell corresponds to the current position. The text can be aligned or centered. After the call, the current position moves to the right or to the next line. It is possible to put a link on the text.&lt;br /&gt;
</span></span><span id="4098" class="l"><a href="#4098"> 4098: </a><span class="php-comment">         * If automatic page breaking is enabled and the cell goes beyond the limit, a page break is done before outputting.
</span></span><span id="4099" class="l"><a href="#4099"> 4099: </a><span class="php-comment">         * @param float $w Cell width. If 0, the cell extends up to the right margin.
</span></span><span id="4100" class="l"><a href="#4100"> 4100: </a><span class="php-comment">         * @param float $h Cell height. Default value: 0.
</span></span><span id="4101" class="l"><a href="#4101"> 4101: </a><span class="php-comment">         * @param string $txt String to print. Default value: empty string.
</span></span><span id="4102" class="l"><a href="#4102"> 4102: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the cell. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4103" class="l"><a href="#4103"> 4103: </a><span class="php-comment">         * @param int $ln Indicates where the current position should go after the call. Possible values are:&lt;ul&gt;&lt;li&gt;0: to the right (or left for RTL languages)&lt;/li&gt;&lt;li&gt;1: to the beginning of the next line&lt;/li&gt;&lt;li&gt;2: below&lt;/li&gt;&lt;/ul&gt;Putting 1 is equivalent to putting 0 and calling Ln() just after. Default value: 0.
</span></span><span id="4104" class="l"><a href="#4104"> 4104: </a><span class="php-comment">         * @param string $align Allows to center or align the text. Possible values are:&lt;ul&gt;&lt;li&gt;L or empty string: left align (default value)&lt;/li&gt;&lt;li&gt;C: center&lt;/li&gt;&lt;li&gt;R: right align&lt;/li&gt;&lt;li&gt;J: justify&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4105" class="l"><a href="#4105"> 4105: </a><span class="php-comment">         * @param int $fill Indicates if the cell background must be painted (1) or transparent (0). Default value: 0.
</span></span><span id="4106" class="l"><a href="#4106"> 4106: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink().
</span></span><span id="4107" class="l"><a href="#4107"> 4107: </a><span class="php-comment">         * @param int $stretch stretch carachter mode: &lt;ul&gt;&lt;li&gt;0 = disabled&lt;/li&gt;&lt;li&gt;1 = horizontal scaling only if necessary&lt;/li&gt;&lt;li&gt;2 = forced horizontal scaling&lt;/li&gt;&lt;li&gt;3 = character spacing only if necessary&lt;/li&gt;&lt;li&gt;4 = forced character spacing&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4108" class="l"><a href="#4108"> 4108: </a><span class="php-comment">         * @param boolean $ignore_min_height if true ignore automatic minimum height value.
</span></span><span id="4109" class="l"><a href="#4109"> 4109: </a><span class="php-comment">         * @param string $calign cell vertical alignment relative to the specified Y value. Possible values are:&lt;ul&gt;&lt;li&gt;T : cell top&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;B : cell bottom&lt;/li&gt;&lt;li&gt;A : font top&lt;/li&gt;&lt;li&gt;L : font baseline&lt;/li&gt;&lt;li&gt;D : font bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4110" class="l"><a href="#4110"> 4110: </a><span class="php-comment">         * @param string $valign text vertical alignment inside the cell. Possible values are:&lt;ul&gt;&lt;li&gt;T : top&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;B : bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4111" class="l"><a href="#4111"> 4111: </a><span class="php-comment">         * @access protected
</span></span><span id="4112" class="l"><a href="#4112"> 4112: </a><span class="php-comment">         * @since 1.0
</span></span><span id="4113" class="l"><a href="#4113"> 4113: </a><span class="php-comment">         * @see Cell()
</span></span><span id="4114" class="l"><a href="#4114"> 4114: </a><span class="php-comment">         */</span>
</span><span id="4115" class="l"><a href="#4115"> 4115: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getCellCode(<span class="php-var">$w</span>, <span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$txt</span>=<span class="php-quote">''</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$ln</span>=<span class="php-num">0</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$fill</span>=<span class="php-num">0</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$stretch</span>=<span class="php-num">0</span>, <span class="php-var">$ignore_min_height</span>=<span class="php-keyword1">false</span>, <span class="php-var">$calign</span>=<span class="php-quote">'T'</span>, <span class="php-var">$valign</span>=<span class="php-quote">'M'</span>) {
</span><span id="4116" class="l"><a href="#4116"> 4116: </a>            <span class="php-var">$txt</span> = <span class="php-var">$this</span>-&gt;removeSHY(<span class="php-var">$txt</span>);
</span><span id="4117" class="l"><a href="#4117"> 4117: </a>            <span class="php-var">$rs</span> = <span class="php-quote">''</span>; <span class="php-comment">//string to be returned</span>
</span><span id="4118" class="l"><a href="#4118"> 4118: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$ignore_min_height</span>) {
</span><span id="4119" class="l"><a href="#4119"> 4119: </a>                <span class="php-var">$min_cell_height</span> = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="4120" class="l"><a href="#4120"> 4120: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$h</span> &lt; <span class="php-var">$min_cell_height</span>) {
</span><span id="4121" class="l"><a href="#4121"> 4121: </a>                    <span class="php-var">$h</span> = <span class="php-var">$min_cell_height</span>;
</span><span id="4122" class="l"><a href="#4122"> 4122: </a>                }
</span><span id="4123" class="l"><a href="#4123"> 4123: </a>            }
</span><span id="4124" class="l"><a href="#4124"> 4124: </a>            <span class="php-var">$k</span> = <span class="php-var">$this</span>-&gt;k;
</span><span id="4125" class="l"><a href="#4125"> 4125: </a>            <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="4126" class="l"><a href="#4126"> 4126: </a>            <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="4127" class="l"><a href="#4127"> 4127: </a>            <span class="php-comment">// cell vertical alignment</span>
</span><span id="4128" class="l"><a href="#4128"> 4128: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$calign</span>) {
</span><span id="4129" class="l"><a href="#4129"> 4129: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'A'</span>: {
</span><span id="4130" class="l"><a href="#4130"> 4130: </a>                    <span class="php-comment">// font top</span>
</span><span id="4131" class="l"><a href="#4131"> 4131: </a>                    <span class="php-keyword1">switch</span> (<span class="php-var">$valign</span>) {
</span><span id="4132" class="l"><a href="#4132"> 4132: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: {
</span><span id="4133" class="l"><a href="#4133"> 4133: </a>                            <span class="php-comment">// top</span>
</span><span id="4134" class="l"><a href="#4134"> 4134: </a>                            <span class="php-var">$y</span> -= (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>);
</span><span id="4135" class="l"><a href="#4135"> 4135: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4136" class="l"><a href="#4136"> 4136: </a>                        }
</span><span id="4137" class="l"><a href="#4137"> 4137: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="4138" class="l"><a href="#4138"> 4138: </a>                            <span class="php-comment">// bottom</span>
</span><span id="4139" class="l"><a href="#4139"> 4139: </a>                            <span class="php-var">$y</span> -= (<span class="php-var">$h</span> - <span class="php-var">$this</span>-&gt;FontAscent - <span class="php-var">$this</span>-&gt;FontDescent - (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>));
</span><span id="4140" class="l"><a href="#4140"> 4140: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4141" class="l"><a href="#4141"> 4141: </a>                        }
</span><span id="4142" class="l"><a href="#4142"> 4142: </a>                        <span class="php-keyword1">default</span>:
</span><span id="4143" class="l"><a href="#4143"> 4143: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: {
</span><span id="4144" class="l"><a href="#4144"> 4144: </a>                            <span class="php-comment">// center</span>
</span><span id="4145" class="l"><a href="#4145"> 4145: </a>                            <span class="php-var">$y</span> -= ((<span class="php-var">$h</span> - <span class="php-var">$this</span>-&gt;FontAscent - <span class="php-var">$this</span>-&gt;FontDescent) / <span class="php-num">2</span>);
</span><span id="4146" class="l"><a href="#4146"> 4146: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4147" class="l"><a href="#4147"> 4147: </a>                        }
</span><span id="4148" class="l"><a href="#4148"> 4148: </a>                    }
</span><span id="4149" class="l"><a href="#4149"> 4149: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4150" class="l"><a href="#4150"> 4150: </a>                }
</span><span id="4151" class="l"><a href="#4151"> 4151: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'L'</span>: {
</span><span id="4152" class="l"><a href="#4152"> 4152: </a>                    <span class="php-comment">// font baseline</span>
</span><span id="4153" class="l"><a href="#4153"> 4153: </a>                    <span class="php-keyword1">switch</span> (<span class="php-var">$valign</span>) {
</span><span id="4154" class="l"><a href="#4154"> 4154: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: {
</span><span id="4155" class="l"><a href="#4155"> 4155: </a>                            <span class="php-comment">// top</span>
</span><span id="4156" class="l"><a href="#4156"> 4156: </a>                            <span class="php-var">$y</span> -= (<span class="php-var">$this</span>-&gt;FontAscent + (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>));
</span><span id="4157" class="l"><a href="#4157"> 4157: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4158" class="l"><a href="#4158"> 4158: </a>                        }
</span><span id="4159" class="l"><a href="#4159"> 4159: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="4160" class="l"><a href="#4160"> 4160: </a>                            <span class="php-comment">// bottom</span>
</span><span id="4161" class="l"><a href="#4161"> 4161: </a>                            <span class="php-var">$y</span> -= (<span class="php-var">$h</span> - <span class="php-var">$this</span>-&gt;FontDescent - (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>));
</span><span id="4162" class="l"><a href="#4162"> 4162: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4163" class="l"><a href="#4163"> 4163: </a>                        }
</span><span id="4164" class="l"><a href="#4164"> 4164: </a>                        <span class="php-keyword1">default</span>:
</span><span id="4165" class="l"><a href="#4165"> 4165: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: {
</span><span id="4166" class="l"><a href="#4166"> 4166: </a>                            <span class="php-comment">// center</span>
</span><span id="4167" class="l"><a href="#4167"> 4167: </a>                            <span class="php-var">$y</span> -= ((<span class="php-var">$h</span> + <span class="php-var">$this</span>-&gt;FontAscent - <span class="php-var">$this</span>-&gt;FontDescent) / <span class="php-num">2</span>);
</span><span id="4168" class="l"><a href="#4168"> 4168: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4169" class="l"><a href="#4169"> 4169: </a>                        }
</span><span id="4170" class="l"><a href="#4170"> 4170: </a>                    }
</span><span id="4171" class="l"><a href="#4171"> 4171: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4172" class="l"><a href="#4172"> 4172: </a>                }
</span><span id="4173" class="l"><a href="#4173"> 4173: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'D'</span>: {
</span><span id="4174" class="l"><a href="#4174"> 4174: </a>                    <span class="php-comment">// font bottom</span>
</span><span id="4175" class="l"><a href="#4175"> 4175: </a>                    <span class="php-keyword1">switch</span> (<span class="php-var">$valign</span>) {
</span><span id="4176" class="l"><a href="#4176"> 4176: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: {
</span><span id="4177" class="l"><a href="#4177"> 4177: </a>                            <span class="php-comment">// top</span>
</span><span id="4178" class="l"><a href="#4178"> 4178: </a>                            <span class="php-var">$y</span> -= (<span class="php-var">$this</span>-&gt;FontAscent + <span class="php-var">$this</span>-&gt;FontDescent + (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>));
</span><span id="4179" class="l"><a href="#4179"> 4179: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4180" class="l"><a href="#4180"> 4180: </a>                        }
</span><span id="4181" class="l"><a href="#4181"> 4181: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="4182" class="l"><a href="#4182"> 4182: </a>                            <span class="php-comment">// bottom</span>
</span><span id="4183" class="l"><a href="#4183"> 4183: </a>                            <span class="php-var">$y</span> -= (<span class="php-var">$h</span> - (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>));
</span><span id="4184" class="l"><a href="#4184"> 4184: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4185" class="l"><a href="#4185"> 4185: </a>                        }
</span><span id="4186" class="l"><a href="#4186"> 4186: </a>                        <span class="php-keyword1">default</span>:
</span><span id="4187" class="l"><a href="#4187"> 4187: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: {
</span><span id="4188" class="l"><a href="#4188"> 4188: </a>                            <span class="php-comment">// center</span>
</span><span id="4189" class="l"><a href="#4189"> 4189: </a>                            <span class="php-var">$y</span> -= ((<span class="php-var">$h</span> + <span class="php-var">$this</span>-&gt;FontAscent + <span class="php-var">$this</span>-&gt;FontDescent) / <span class="php-num">2</span>);
</span><span id="4190" class="l"><a href="#4190"> 4190: </a>                            <span class="php-keyword1">break</span>;
</span><span id="4191" class="l"><a href="#4191"> 4191: </a>                        }
</span><span id="4192" class="l"><a href="#4192"> 4192: </a>                    }
</span><span id="4193" class="l"><a href="#4193"> 4193: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4194" class="l"><a href="#4194"> 4194: </a>                }
</span><span id="4195" class="l"><a href="#4195"> 4195: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="4196" class="l"><a href="#4196"> 4196: </a>                    <span class="php-comment">// cell bottom</span>
</span><span id="4197" class="l"><a href="#4197"> 4197: </a>                    <span class="php-var">$y</span> -= <span class="php-var">$h</span>;
</span><span id="4198" class="l"><a href="#4198"> 4198: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4199" class="l"><a href="#4199"> 4199: </a>                }
</span><span id="4200" class="l"><a href="#4200"> 4200: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: {
</span><span id="4201" class="l"><a href="#4201"> 4201: </a>                    <span class="php-comment">// cell center</span>
</span><span id="4202" class="l"><a href="#4202"> 4202: </a>                    <span class="php-var">$y</span> -= (<span class="php-var">$h</span> / <span class="php-num">2</span>);
</span><span id="4203" class="l"><a href="#4203"> 4203: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4204" class="l"><a href="#4204"> 4204: </a>                }
</span><span id="4205" class="l"><a href="#4205"> 4205: </a>                <span class="php-keyword1">default</span>:
</span><span id="4206" class="l"><a href="#4206"> 4206: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: {
</span><span id="4207" class="l"><a href="#4207"> 4207: </a>                    <span class="php-comment">// cell top</span>
</span><span id="4208" class="l"><a href="#4208"> 4208: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4209" class="l"><a href="#4209"> 4209: </a>                }
</span><span id="4210" class="l"><a href="#4210"> 4210: </a>            }
</span><span id="4211" class="l"><a href="#4211"> 4211: </a>            <span class="php-comment">// text vertical alignment</span>
</span><span id="4212" class="l"><a href="#4212"> 4212: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$valign</span>) {
</span><span id="4213" class="l"><a href="#4213"> 4213: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: {
</span><span id="4214" class="l"><a href="#4214"> 4214: </a>                    <span class="php-comment">// top</span>
</span><span id="4215" class="l"><a href="#4215"> 4215: </a>                    <span class="php-var">$basefonty</span> = <span class="php-var">$y</span> + <span class="php-var">$this</span>-&gt;FontAscent + (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>);
</span><span id="4216" class="l"><a href="#4216"> 4216: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4217" class="l"><a href="#4217"> 4217: </a>                }
</span><span id="4218" class="l"><a href="#4218"> 4218: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="4219" class="l"><a href="#4219"> 4219: </a>                    <span class="php-comment">// bottom</span>
</span><span id="4220" class="l"><a href="#4220"> 4220: </a>                    <span class="php-var">$basefonty</span> = <span class="php-var">$y</span> + <span class="php-var">$h</span> - <span class="php-var">$this</span>-&gt;FontDescent - (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>);
</span><span id="4221" class="l"><a href="#4221"> 4221: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4222" class="l"><a href="#4222"> 4222: </a>                }
</span><span id="4223" class="l"><a href="#4223"> 4223: </a>                <span class="php-keyword1">default</span>:
</span><span id="4224" class="l"><a href="#4224"> 4224: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: {
</span><span id="4225" class="l"><a href="#4225"> 4225: </a>                    <span class="php-comment">// center</span>
</span><span id="4226" class="l"><a href="#4226"> 4226: </a>                    <span class="php-var">$basefonty</span> = <span class="php-var">$y</span> + ((<span class="php-var">$h</span> + <span class="php-var">$this</span>-&gt;FontAscent - <span class="php-var">$this</span>-&gt;FontDescent) / <span class="php-num">2</span>);
</span><span id="4227" class="l"><a href="#4227"> 4227: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4228" class="l"><a href="#4228"> 4228: </a>                }
</span><span id="4229" class="l"><a href="#4229"> 4229: </a>            }
</span><span id="4230" class="l"><a href="#4230"> 4230: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$w</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="4231" class="l"><a href="#4231"> 4231: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4232" class="l"><a href="#4232"> 4232: </a>                    <span class="php-var">$w</span> = <span class="php-var">$x</span> - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="4233" class="l"><a href="#4233"> 4233: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4234" class="l"><a href="#4234"> 4234: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$x</span>;
</span><span id="4235" class="l"><a href="#4235"> 4235: </a>                }
</span><span id="4236" class="l"><a href="#4236"> 4236: </a>            }
</span><span id="4237" class="l"><a href="#4237"> 4237: </a>            <span class="php-var">$s</span> = <span class="php-quote">''</span>;
</span><span id="4238" class="l"><a href="#4238"> 4238: </a>            <span class="php-comment">// fill and borders</span>
</span><span id="4239" class="l"><a href="#4239"> 4239: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$fill</span> == <span class="php-num">1</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$border</span> == <span class="php-num">1</span>)) {
</span><span id="4240" class="l"><a href="#4240"> 4240: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$fill</span> == <span class="php-num">1</span>) {
</span><span id="4241" class="l"><a href="#4241"> 4241: </a>                    <span class="php-var">$op</span> = (<span class="php-var">$border</span> == <span class="php-num">1</span>) ? <span class="php-quote">'B'</span> : <span class="php-quote">'f'</span>;
</span><span id="4242" class="l"><a href="#4242"> 4242: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4243" class="l"><a href="#4243"> 4243: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'S'</span>;
</span><span id="4244" class="l"><a href="#4244"> 4244: </a>                }
</span><span id="4245" class="l"><a href="#4245"> 4245: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4246" class="l"><a href="#4246"> 4246: </a>                    <span class="php-var">$xk</span> = ((<span class="php-var">$this</span>-&gt;x  - <span class="php-var">$w</span>) * <span class="php-var">$k</span>);
</span><span id="4247" class="l"><a href="#4247"> 4247: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4248" class="l"><a href="#4248"> 4248: </a>                    <span class="php-var">$xk</span> = (<span class="php-var">$this</span>-&gt;x * <span class="php-var">$k</span>);
</span><span id="4249" class="l"><a href="#4249"> 4249: </a>                }
</span><span id="4250" class="l"><a href="#4250"> 4250: </a>                <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F re %s '</span>, <span class="php-var">$xk</span>, ((<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$k</span>), (<span class="php-var">$w</span> * <span class="php-var">$k</span>), (-<span class="php-var">$h</span> * <span class="php-var">$k</span>), <span class="php-var">$op</span>);
</span><span id="4251" class="l"><a href="#4251"> 4251: </a>            }
</span><span id="4252" class="l"><a href="#4252"> 4252: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$border</span>)) {
</span><span id="4253" class="l"><a href="#4253"> 4253: </a>                <span class="php-var">$lm</span> = (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>);
</span><span id="4254" class="l"><a href="#4254"> 4254: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>,<span class="php-quote">'L'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="4255" class="l"><a href="#4255"> 4255: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4256" class="l"><a href="#4256"> 4256: </a>                        <span class="php-var">$xk</span> = (<span class="php-var">$x</span> - <span class="php-var">$w</span>) * <span class="php-var">$k</span>;
</span><span id="4257" class="l"><a href="#4257"> 4257: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4258" class="l"><a href="#4258"> 4258: </a>                        <span class="php-var">$xk</span> = <span class="php-var">$x</span> * <span class="php-var">$k</span>;
</span><span id="4259" class="l"><a href="#4259"> 4259: </a>                    }
</span><span id="4260" class="l"><a href="#4260"> 4260: </a>                    <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F m %.2F %.2F l S '</span>, <span class="php-var">$xk</span>, ((<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span> + <span class="php-var">$lm</span>) * <span class="php-var">$k</span>), <span class="php-var">$xk</span>, ((<span class="php-var">$this</span>-&gt;h - (<span class="php-var">$y</span> + <span class="php-var">$h</span> + <span class="php-var">$lm</span>)) * <span class="php-var">$k</span>));
</span><span id="4261" class="l"><a href="#4261"> 4261: </a>                }
</span><span id="4262" class="l"><a href="#4262"> 4262: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>,<span class="php-quote">'T'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="4263" class="l"><a href="#4263"> 4263: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4264" class="l"><a href="#4264"> 4264: </a>                        <span class="php-var">$xk</span> = (<span class="php-var">$x</span> - <span class="php-var">$w</span> + <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4265" class="l"><a href="#4265"> 4265: </a>                        <span class="php-var">$xwk</span> = (<span class="php-var">$x</span> - <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4266" class="l"><a href="#4266"> 4266: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4267" class="l"><a href="#4267"> 4267: </a>                        <span class="php-var">$xk</span> = (<span class="php-var">$x</span> - <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4268" class="l"><a href="#4268"> 4268: </a>                        <span class="php-var">$xwk</span> = (<span class="php-var">$x</span> + <span class="php-var">$w</span> + <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4269" class="l"><a href="#4269"> 4269: </a>                    }
</span><span id="4270" class="l"><a href="#4270"> 4270: </a>                    <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F m %.2F %.2F l S '</span>, <span class="php-var">$xk</span>, ((<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$k</span>), <span class="php-var">$xwk</span>, ((<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$k</span>));
</span><span id="4271" class="l"><a href="#4271"> 4271: </a>                }
</span><span id="4272" class="l"><a href="#4272"> 4272: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>,<span class="php-quote">'R'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="4273" class="l"><a href="#4273"> 4273: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4274" class="l"><a href="#4274"> 4274: </a>                        <span class="php-var">$xk</span> = <span class="php-var">$x</span> * <span class="php-var">$k</span>;
</span><span id="4275" class="l"><a href="#4275"> 4275: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4276" class="l"><a href="#4276"> 4276: </a>                        <span class="php-var">$xk</span> = (<span class="php-var">$x</span> + <span class="php-var">$w</span>) * <span class="php-var">$k</span>;
</span><span id="4277" class="l"><a href="#4277"> 4277: </a>                    }
</span><span id="4278" class="l"><a href="#4278"> 4278: </a>                    <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F m %.2F %.2F l S '</span>, <span class="php-var">$xk</span>, ((<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span> + <span class="php-var">$lm</span>) * <span class="php-var">$k</span>), <span class="php-var">$xk</span>, ((<span class="php-var">$this</span>-&gt;h - (<span class="php-var">$y</span> + <span class="php-var">$h</span> + <span class="php-var">$lm</span>))* <span class="php-var">$k</span>));
</span><span id="4279" class="l"><a href="#4279"> 4279: </a>                }
</span><span id="4280" class="l"><a href="#4280"> 4280: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>,<span class="php-quote">'B'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="4281" class="l"><a href="#4281"> 4281: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4282" class="l"><a href="#4282"> 4282: </a>                        <span class="php-var">$xk</span> = (<span class="php-var">$x</span> - <span class="php-var">$w</span> + <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4283" class="l"><a href="#4283"> 4283: </a>                        <span class="php-var">$xwk</span> = (<span class="php-var">$x</span> - <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4284" class="l"><a href="#4284"> 4284: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4285" class="l"><a href="#4285"> 4285: </a>                        <span class="php-var">$xk</span> = (<span class="php-var">$x</span> - <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4286" class="l"><a href="#4286"> 4286: </a>                        <span class="php-var">$xwk</span> = (<span class="php-var">$x</span> + <span class="php-var">$w</span> + <span class="php-var">$lm</span>) * <span class="php-var">$k</span>;
</span><span id="4287" class="l"><a href="#4287"> 4287: </a>                    }
</span><span id="4288" class="l"><a href="#4288"> 4288: </a>                    <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F m %.2F %.2F l S '</span>, <span class="php-var">$xk</span>, ((<span class="php-var">$this</span>-&gt;h - (<span class="php-var">$y</span> + <span class="php-var">$h</span>)) * <span class="php-var">$k</span>), <span class="php-var">$xwk</span>, ((<span class="php-var">$this</span>-&gt;h - (<span class="php-var">$y</span> + <span class="php-var">$h</span>)) * <span class="php-var">$k</span>));
</span><span id="4289" class="l"><a href="#4289"> 4289: </a>                }
</span><span id="4290" class="l"><a href="#4290"> 4290: </a>            }
</span><span id="4291" class="l"><a href="#4291"> 4291: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$txt</span> != <span class="php-quote">''</span>) {
</span><span id="4292" class="l"><a href="#4292"> 4292: </a>                <span class="php-var">$txt2</span> = <span class="php-var">$txt</span>;
</span><span id="4293" class="l"><a href="#4293"> 4293: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="4294" class="l"><a href="#4294"> 4294: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'core'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueType'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'Type1'</span>)) {
</span><span id="4295" class="l"><a href="#4295"> 4295: </a>                        <span class="php-var">$txt2</span> = <span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$txt2</span>);
</span><span id="4296" class="l"><a href="#4296"> 4296: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4297" class="l"><a href="#4297"> 4297: </a>                        <span class="php-var">$unicode</span> = <span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$txt</span>); <span class="php-comment">// array of UTF-8 unicode values</span>
</span><span id="4298" class="l"><a href="#4298"> 4298: </a>                        <span class="php-var">$unicode</span> = <span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-var">$unicode</span>, <span class="php-quote">''</span>, <span class="php-var">$this</span>-&gt;tmprtl);
</span><span id="4299" class="l"><a href="#4299"> 4299: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">defined</span>(<span class="php-quote">'K_THAI_TOPCHARS'</span>) <span class="php-keyword1">AND</span> (K_THAI_TOPCHARS == <span class="php-keyword1">true</span>)) {
</span><span id="4300" class="l"><a href="#4300"> 4300: </a>                            <span class="php-comment">// ---- Fix for bug #2977340 &quot;Incorrect Thai characters position arrangement&quot; ----</span>
</span><span id="4301" class="l"><a href="#4301"> 4301: </a>                            <span class="php-comment">// NOTE: this doesn't work with HTML justification</span>
</span><span id="4302" class="l"><a href="#4302"> 4302: </a>                            <span class="php-comment">// Symbols that could overlap on the font top (only works in LTR)</span>
</span><span id="4303" class="l"><a href="#4303"> 4303: </a>                            <span class="php-var">$topchar</span> = <span class="php-keyword1">array</span>(<span class="php-num">3611</span>, <span class="php-num">3613</span>, <span class="php-num">3615</span>, <span class="php-num">3650</span>, <span class="php-num">3651</span>, <span class="php-num">3652</span>); <span class="php-comment">// chars that extends on top</span>
</span><span id="4304" class="l"><a href="#4304"> 4304: </a>                            <span class="php-var">$topsym</span> = <span class="php-keyword1">array</span>(<span class="php-num">3633</span>, <span class="php-num">3636</span>, <span class="php-num">3637</span>, <span class="php-num">3638</span>, <span class="php-num">3639</span>, <span class="php-num">3655</span>, <span class="php-num">3656</span>, <span class="php-num">3657</span>, <span class="php-num">3658</span>, <span class="php-num">3659</span>, <span class="php-num">3660</span>, <span class="php-num">3661</span>, <span class="php-num">3662</span>); <span class="php-comment">// symbols with top position</span>
</span><span id="4305" class="l"><a href="#4305"> 4305: </a>                            <span class="php-var">$numchars</span> = <span class="php-keyword2">count</span>(<span class="php-var">$unicode</span>); <span class="php-comment">// number of chars</span>
</span><span id="4306" class="l"><a href="#4306"> 4306: </a>                            <span class="php-var">$unik</span> = <span class="php-num">0</span>;
</span><span id="4307" class="l"><a href="#4307"> 4307: </a>                            <span class="php-var">$uniblock</span> = <span class="php-keyword1">array</span>();
</span><span id="4308" class="l"><a href="#4308"> 4308: </a>                            <span class="php-var">$uniblock</span>[<span class="php-var">$unik</span>] = <span class="php-keyword1">array</span>();
</span><span id="4309" class="l"><a href="#4309"> 4309: </a>                            <span class="php-var">$uniblock</span>[<span class="php-var">$unik</span>][] = <span class="php-var">$unicode</span>[<span class="php-num">0</span>];
</span><span id="4310" class="l"><a href="#4310"> 4310: </a>                            <span class="php-comment">// resolve overlapping conflicts by splitting the string in several parts</span>
</span><span id="4311" class="l"><a href="#4311"> 4311: </a>                            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="4312" class="l"><a href="#4312"> 4312: </a>                                <span class="php-comment">// check if symbols overlaps at top</span>
</span><span id="4313" class="l"><a href="#4313"> 4313: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$unicode</span>[<span class="php-var">$i</span>], <span class="php-var">$topsym</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$unicode</span>[(<span class="php-var">$i</span> - <span class="php-num">1</span>)], <span class="php-var">$topsym</span>) <span class="php-keyword1">OR</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$unicode</span>[(<span class="php-var">$i</span> - <span class="php-num">1</span>)], <span class="php-var">$topchar</span>))) {
</span><span id="4314" class="l"><a href="#4314"> 4314: </a>                                    <span class="php-comment">// move symbols to another array</span>
</span><span id="4315" class="l"><a href="#4315"> 4315: </a>                                    ++<span class="php-var">$unik</span>;
</span><span id="4316" class="l"><a href="#4316"> 4316: </a>                                    <span class="php-var">$uniblock</span>[<span class="php-var">$unik</span>] = <span class="php-keyword1">array</span>();
</span><span id="4317" class="l"><a href="#4317"> 4317: </a>                                    <span class="php-var">$uniblock</span>[<span class="php-var">$unik</span>][] = <span class="php-var">$unicode</span>[<span class="php-var">$i</span>];
</span><span id="4318" class="l"><a href="#4318"> 4318: </a>                                    ++<span class="php-var">$unik</span>;
</span><span id="4319" class="l"><a href="#4319"> 4319: </a>                                    <span class="php-var">$uniblock</span>[<span class="php-var">$unik</span>] = <span class="php-keyword1">array</span>();
</span><span id="4320" class="l"><a href="#4320"> 4320: </a>                                    <span class="php-var">$unicode</span>[<span class="php-var">$i</span>] = <span class="php-num">8203</span>; <span class="php-comment">// Unicode Character 'ZERO WIDTH SPACE' (U+200B)</span>
</span><span id="4321" class="l"><a href="#4321"> 4321: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="4322" class="l"><a href="#4322"> 4322: </a>                                    <span class="php-var">$uniblock</span>[<span class="php-var">$unik</span>][] = <span class="php-var">$unicode</span>[<span class="php-var">$i</span>];
</span><span id="4323" class="l"><a href="#4323"> 4323: </a>                                }
</span><span id="4324" class="l"><a href="#4324"> 4324: </a>                            }
</span><span id="4325" class="l"><a href="#4325"> 4325: </a>                            <span class="php-comment">// ---- END OF Fix for bug #2977340</span>
</span><span id="4326" class="l"><a href="#4326"> 4326: </a>                        }
</span><span id="4327" class="l"><a href="#4327"> 4327: </a>                        <span class="php-var">$txt2</span> = <span class="php-var">$this</span>-&gt;arrUTF8ToUTF16BE(<span class="php-var">$unicode</span>, <span class="php-keyword1">false</span>);
</span><span id="4328" class="l"><a href="#4328"> 4328: </a>                    }
</span><span id="4329" class="l"><a href="#4329"> 4329: </a>                }
</span><span id="4330" class="l"><a href="#4330"> 4330: </a>                <span class="php-var">$txt2</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$txt2</span>);
</span><span id="4331" class="l"><a href="#4331"> 4331: </a>                <span class="php-comment">// text length</span>
</span><span id="4332" class="l"><a href="#4332"> 4332: </a>                <span class="php-var">$txwidth</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$txt</span>);
</span><span id="4333" class="l"><a href="#4333"> 4333: </a>                <span class="php-var">$width</span> = <span class="php-var">$txwidth</span>;
</span><span id="4334" class="l"><a href="#4334"> 4334: </a>                <span class="php-comment">// ratio between cell length and text length</span>
</span><span id="4335" class="l"><a href="#4335"> 4335: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$width</span> &lt;= <span class="php-num">0</span>) {
</span><span id="4336" class="l"><a href="#4336"> 4336: </a>                    <span class="php-var">$ratio</span> = <span class="php-num">1</span>;
</span><span id="4337" class="l"><a href="#4337"> 4337: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4338" class="l"><a href="#4338"> 4338: </a>                    <span class="php-var">$ratio</span> = (<span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin)) / <span class="php-var">$width</span>;
</span><span id="4339" class="l"><a href="#4339"> 4339: </a>                }
</span><span id="4340" class="l"><a href="#4340"> 4340: </a>                <span class="php-comment">// stretch text if required</span>
</span><span id="4341" class="l"><a href="#4341"> 4341: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$stretch</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$ratio</span> &lt; <span class="php-num">1</span>) <span class="php-keyword1">OR</span> ((<span class="php-var">$ratio</span> &gt; <span class="php-num">1</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$stretch</span> % <span class="php-num">2</span>) == <span class="php-num">0</span>)))) {
</span><span id="4342" class="l"><a href="#4342"> 4342: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$stretch</span> &gt; <span class="php-num">2</span>) {
</span><span id="4343" class="l"><a href="#4343"> 4343: </a>                        <span class="php-comment">// spacing</span>
</span><span id="4344" class="l"><a href="#4344"> 4344: </a>                        <span class="php-comment">//Calculate character spacing in points</span>
</span><span id="4345" class="l"><a href="#4345"> 4345: </a>                        <span class="php-var">$char_space</span> = ((<span class="php-var">$w</span> - <span class="php-var">$width</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin)) * <span class="php-var">$this</span>-&gt;k) / <span class="php-keyword2">max</span>(<span class="php-var">$this</span>-&gt;GetNumChars(<span class="php-var">$txt</span>)-<span class="php-num">1</span>,<span class="php-num">1</span>);
</span><span id="4346" class="l"><a href="#4346"> 4346: </a>                        <span class="php-comment">//Set character spacing</span>
</span><span id="4347" class="l"><a href="#4347"> 4347: </a>                        <span class="php-var">$rs</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'BT %.2F Tc ET '</span>, <span class="php-var">$char_space</span>);
</span><span id="4348" class="l"><a href="#4348"> 4348: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4349" class="l"><a href="#4349"> 4349: </a>                        <span class="php-comment">// scaling</span>
</span><span id="4350" class="l"><a href="#4350"> 4350: </a>                        <span class="php-comment">//Calculate horizontal scaling</span>
</span><span id="4351" class="l"><a href="#4351"> 4351: </a>                        <span class="php-var">$horiz_scale</span> = <span class="php-var">$ratio</span> * <span class="php-num">100.0</span>;
</span><span id="4352" class="l"><a href="#4352"> 4352: </a>                        <span class="php-comment">//Set horizontal scaling</span>
</span><span id="4353" class="l"><a href="#4353"> 4353: </a>                        <span class="php-var">$rs</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'BT %.2F Tz ET '</span>, <span class="php-var">$horiz_scale</span>);
</span><span id="4354" class="l"><a href="#4354"> 4354: </a>                    }
</span><span id="4355" class="l"><a href="#4355"> 4355: </a>                    <span class="php-var">$align</span> = <span class="php-quote">''</span>;
</span><span id="4356" class="l"><a href="#4356"> 4356: </a>                    <span class="php-var">$width</span> = <span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="4357" class="l"><a href="#4357"> 4357: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4358" class="l"><a href="#4358"> 4358: </a>                    <span class="php-var">$stretch</span> == <span class="php-num">0</span>;
</span><span id="4359" class="l"><a href="#4359"> 4359: </a>                }
</span><span id="4360" class="l"><a href="#4360"> 4360: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;ColorFlag) {
</span><span id="4361" class="l"><a href="#4361"> 4361: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">'q '</span>.<span class="php-var">$this</span>-&gt;TextColor.<span class="php-quote">' '</span>;
</span><span id="4362" class="l"><a href="#4362"> 4362: </a>                }
</span><span id="4363" class="l"><a href="#4363"> 4363: </a>                <span class="php-comment">// rendering mode</span>
</span><span id="4364" class="l"><a href="#4364"> 4364: </a>                <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'BT %d Tr %.2F w ET '</span>, <span class="php-var">$this</span>-&gt;textrendermode, <span class="php-var">$this</span>-&gt;textstrokewidth);
</span><span id="4365" class="l"><a href="#4365"> 4365: </a>                <span class="php-comment">// count number of spaces</span>
</span><span id="4366" class="l"><a href="#4366"> 4366: </a>                <span class="php-var">$ns</span> = <span class="php-keyword2">substr_count</span>(<span class="php-var">$txt</span>, <span class="php-quote">' '</span>);
</span><span id="4367" class="l"><a href="#4367"> 4367: </a>                <span class="php-comment">// Justification</span>
</span><span id="4368" class="l"><a href="#4368"> 4368: </a>                <span class="php-var">$spacewidth</span> = <span class="php-num">0</span>;
</span><span id="4369" class="l"><a href="#4369"> 4369: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$align</span> == <span class="php-quote">'J'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$ns</span> &gt; <span class="php-num">0</span>)) {
</span><span id="4370" class="l"><a href="#4370"> 4370: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="4371" class="l"><a href="#4371"> 4371: </a>                            <span class="php-comment">// get string width without spaces</span>
</span><span id="4372" class="l"><a href="#4372"> 4372: </a>                            <span class="php-var">$width</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">str_replace</span>(<span class="php-quote">' '</span>, <span class="php-quote">''</span>, <span class="php-var">$txt</span>));
</span><span id="4373" class="l"><a href="#4373"> 4373: </a>                            <span class="php-comment">// calculate average space width</span>
</span><span id="4374" class="l"><a href="#4374"> 4374: </a>                            <span class="php-var">$spacewidth</span> = -<span class="php-num">1000</span> * (<span class="php-var">$w</span> - <span class="php-var">$width</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin)) / (<span class="php-var">$ns</span>?<span class="php-var">$ns</span>:<span class="php-num">1</span>) / <span class="php-var">$this</span>-&gt;FontSize;
</span><span id="4375" class="l"><a href="#4375"> 4375: </a>                            <span class="php-comment">// set word position to be used with TJ operator</span>
</span><span id="4376" class="l"><a href="#4376"> 4376: </a>                            <span class="php-var">$txt2</span> = <span class="php-keyword2">str_replace</span>(<span class="php-keyword2">chr</span>(<span class="php-num">0</span>).<span class="php-keyword2">chr</span>(<span class="php-num">32</span>), <span class="php-quote">') '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F'</span>, <span class="php-var">$spacewidth</span>).<span class="php-quote">' ('</span>, <span class="php-var">$txt2</span>);
</span><span id="4377" class="l"><a href="#4377"> 4377: </a>                            <span class="php-var">$unicode_justification</span> = <span class="php-keyword1">true</span>;
</span><span id="4378" class="l"><a href="#4378"> 4378: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4379" class="l"><a href="#4379"> 4379: </a>                        <span class="php-comment">// get string width</span>
</span><span id="4380" class="l"><a href="#4380"> 4380: </a>                        <span class="php-var">$width</span> = <span class="php-var">$txwidth</span>;
</span><span id="4381" class="l"><a href="#4381"> 4381: </a>                        <span class="php-var">$spacewidth</span> = ((<span class="php-var">$w</span> - <span class="php-var">$width</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin)) / (<span class="php-var">$ns</span>?<span class="php-var">$ns</span>:<span class="php-num">1</span>)) * <span class="php-var">$this</span>-&gt;k;
</span><span id="4382" class="l"><a href="#4382"> 4382: </a>                        <span class="php-comment">// set word spacing</span>
</span><span id="4383" class="l"><a href="#4383"> 4383: </a>                        <span class="php-var">$rs</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'BT %.3F Tw ET '</span>, <span class="php-var">$spacewidth</span>);
</span><span id="4384" class="l"><a href="#4384"> 4384: </a>                    }
</span><span id="4385" class="l"><a href="#4385"> 4385: </a>                    <span class="php-var">$width</span> = <span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="4386" class="l"><a href="#4386"> 4386: </a>                }
</span><span id="4387" class="l"><a href="#4387"> 4387: </a>                <span class="php-comment">// replace carriage return characters</span>
</span><span id="4388" class="l"><a href="#4388"> 4388: </a>                <span class="php-var">$txt2</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">&quot;\r&quot;</span>, <span class="php-quote">' '</span>, <span class="php-var">$txt2</span>);
</span><span id="4389" class="l"><a href="#4389"> 4389: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$align</span>) {
</span><span id="4390" class="l"><a href="#4390"> 4390: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: {
</span><span id="4391" class="l"><a href="#4391"> 4391: </a>                        <span class="php-var">$dx</span> = (<span class="php-var">$w</span> - <span class="php-var">$width</span>) / <span class="php-num">2</span>;
</span><span id="4392" class="l"><a href="#4392"> 4392: </a>                        <span class="php-keyword1">break</span>;
</span><span id="4393" class="l"><a href="#4393"> 4393: </a>                    }
</span><span id="4394" class="l"><a href="#4394"> 4394: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'R'</span>: {
</span><span id="4395" class="l"><a href="#4395"> 4395: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4396" class="l"><a href="#4396"> 4396: </a>                            <span class="php-var">$dx</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4397" class="l"><a href="#4397"> 4397: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4398" class="l"><a href="#4398"> 4398: </a>                            <span class="php-var">$dx</span> = <span class="php-var">$w</span> - <span class="php-var">$width</span> - <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4399" class="l"><a href="#4399"> 4399: </a>                        }
</span><span id="4400" class="l"><a href="#4400"> 4400: </a>                        <span class="php-keyword1">break</span>;
</span><span id="4401" class="l"><a href="#4401"> 4401: </a>                    }
</span><span id="4402" class="l"><a href="#4402"> 4402: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'L'</span>: {
</span><span id="4403" class="l"><a href="#4403"> 4403: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4404" class="l"><a href="#4404"> 4404: </a>                            <span class="php-var">$dx</span> = <span class="php-var">$w</span> - <span class="php-var">$width</span> - <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4405" class="l"><a href="#4405"> 4405: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4406" class="l"><a href="#4406"> 4406: </a>                            <span class="php-var">$dx</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4407" class="l"><a href="#4407"> 4407: </a>                        }
</span><span id="4408" class="l"><a href="#4408"> 4408: </a>                        <span class="php-keyword1">break</span>;
</span><span id="4409" class="l"><a href="#4409"> 4409: </a>                    }
</span><span id="4410" class="l"><a href="#4410"> 4410: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'J'</span>:
</span><span id="4411" class="l"><a href="#4411"> 4411: </a>                    <span class="php-keyword1">default</span>: {
</span><span id="4412" class="l"><a href="#4412"> 4412: </a>                        <span class="php-var">$dx</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4413" class="l"><a href="#4413"> 4413: </a>                        <span class="php-keyword1">break</span>;
</span><span id="4414" class="l"><a href="#4414"> 4414: </a>                    }
</span><span id="4415" class="l"><a href="#4415"> 4415: </a>                }
</span><span id="4416" class="l"><a href="#4416"> 4416: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4417" class="l"><a href="#4417"> 4417: </a>                    <span class="php-var">$xdx</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$dx</span> - <span class="php-var">$width</span>;
</span><span id="4418" class="l"><a href="#4418"> 4418: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4419" class="l"><a href="#4419"> 4419: </a>                    <span class="php-var">$xdx</span> = <span class="php-var">$this</span>-&gt;x + <span class="php-var">$dx</span>;
</span><span id="4420" class="l"><a href="#4420"> 4420: </a>                }
</span><span id="4421" class="l"><a href="#4421"> 4421: </a>                <span class="php-var">$xdk</span> = <span class="php-var">$xdx</span> * <span class="php-var">$k</span>;
</span><span id="4422" class="l"><a href="#4422"> 4422: </a>                <span class="php-comment">// print text</span>
</span><span id="4423" class="l"><a href="#4423"> 4423: </a>                <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'BT %.2F %.2F Td [(%s)] TJ ET'</span>, <span class="php-var">$xdk</span>, ((<span class="php-var">$this</span>-&gt;h - <span class="php-var">$basefonty</span>) * <span class="php-var">$k</span>), <span class="php-var">$txt2</span>);
</span><span id="4424" class="l"><a href="#4424"> 4424: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$uniblock</span>)) {
</span><span id="4425" class="l"><a href="#4425"> 4425: </a>                    <span class="php-comment">// print overlapping characters as separate string</span>
</span><span id="4426" class="l"><a href="#4426"> 4426: </a>                    <span class="php-var">$xshift</span> = <span class="php-num">0</span>; <span class="php-comment">// horizontal shift</span>
</span><span id="4427" class="l"><a href="#4427"> 4427: </a>                    <span class="php-var">$ty</span> = ((<span class="php-var">$this</span>-&gt;h - <span class="php-var">$basefonty</span> + (<span class="php-num">0.2</span> * <span class="php-var">$this</span>-&gt;FontSize)) * <span class="php-var">$k</span>);
</span><span id="4428" class="l"><a href="#4428"> 4428: </a>                    <span class="php-var">$spw</span> = ((<span class="php-var">$w</span> - <span class="php-var">$txwidth</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin)) / (<span class="php-var">$ns</span>?<span class="php-var">$ns</span>:<span class="php-num">1</span>));
</span><span id="4429" class="l"><a href="#4429"> 4429: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$uniblock</span> <span class="php-keyword1">as</span> <span class="php-var">$uk</span> =&gt; <span class="php-var">$uniarr</span>) {
</span><span id="4430" class="l"><a href="#4430"> 4430: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$uk</span> % <span class="php-num">2</span>) == <span class="php-num">0</span>) {
</span><span id="4431" class="l"><a href="#4431"> 4431: </a>                            <span class="php-comment">// x space to skip</span>
</span><span id="4432" class="l"><a href="#4432"> 4432: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$spacewidth</span> != <span class="php-num">0</span>) {
</span><span id="4433" class="l"><a href="#4433"> 4433: </a>                                <span class="php-comment">// justification shift</span>
</span><span id="4434" class="l"><a href="#4434"> 4434: </a>                                <span class="php-var">$xshift</span> += (<span class="php-keyword2">count</span>(<span class="php-keyword2">array_keys</span>(<span class="php-var">$uniarr</span>, <span class="php-num">32</span>)) * <span class="php-var">$spw</span>);
</span><span id="4435" class="l"><a href="#4435"> 4435: </a>                            }
</span><span id="4436" class="l"><a href="#4436"> 4436: </a>                            <span class="php-var">$xshift</span> += <span class="php-var">$this</span>-&gt;GetArrStringWidth(<span class="php-var">$uniarr</span>); <span class="php-comment">// + shift justification</span>
</span><span id="4437" class="l"><a href="#4437"> 4437: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4438" class="l"><a href="#4438"> 4438: </a>                            <span class="php-comment">// character to print</span>
</span><span id="4439" class="l"><a href="#4439"> 4439: </a>                            <span class="php-var">$topchr</span> = <span class="php-var">$this</span>-&gt;arrUTF8ToUTF16BE(<span class="php-var">$uniarr</span>, <span class="php-keyword1">false</span>);
</span><span id="4440" class="l"><a href="#4440"> 4440: </a>                            <span class="php-var">$topchr</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$topchr</span>);
</span><span id="4441" class="l"><a href="#4441"> 4441: </a>                            <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' BT %.2F %.2F Td [(%s)] TJ ET'</span>, (<span class="php-var">$xdk</span> + (<span class="php-var">$xshift</span> * <span class="php-var">$k</span>)), <span class="php-var">$ty</span>, <span class="php-var">$topchr</span>);
</span><span id="4442" class="l"><a href="#4442"> 4442: </a>                        }
</span><span id="4443" class="l"><a href="#4443"> 4443: </a>                    }
</span><span id="4444" class="l"><a href="#4444"> 4444: </a>                }
</span><span id="4445" class="l"><a href="#4445"> 4445: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;underline)  {
</span><span id="4446" class="l"><a href="#4446"> 4446: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_dounderlinew(<span class="php-var">$xdx</span>, <span class="php-var">$basefonty</span>, <span class="php-var">$width</span>);
</span><span id="4447" class="l"><a href="#4447"> 4447: </a>                }
</span><span id="4448" class="l"><a href="#4448"> 4448: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;linethrough) {
</span><span id="4449" class="l"><a href="#4449"> 4449: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_dolinethroughw(<span class="php-var">$xdx</span>, <span class="php-var">$basefonty</span>, <span class="php-var">$width</span>);
</span><span id="4450" class="l"><a href="#4450"> 4450: </a>                }
</span><span id="4451" class="l"><a href="#4451"> 4451: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;overline)  {
</span><span id="4452" class="l"><a href="#4452"> 4452: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_dooverlinew(<span class="php-var">$xdx</span>, <span class="php-var">$basefonty</span>, <span class="php-var">$width</span>);
</span><span id="4453" class="l"><a href="#4453"> 4453: </a>                }
</span><span id="4454" class="l"><a href="#4454"> 4454: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;ColorFlag) {
</span><span id="4455" class="l"><a href="#4455"> 4455: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">' Q'</span>;
</span><span id="4456" class="l"><a href="#4456"> 4456: </a>                }
</span><span id="4457" class="l"><a href="#4457"> 4457: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$link</span>) {
</span><span id="4458" class="l"><a href="#4458"> 4458: </a>                    <span class="php-var">$this</span>-&gt;<span class="php-keyword2">Link</span>(<span class="php-var">$xdx</span>, <span class="php-var">$y</span> + ((<span class="php-var">$h</span> - <span class="php-var">$this</span>-&gt;FontSize)/<span class="php-num">2</span>), <span class="php-var">$width</span>, <span class="php-var">$this</span>-&gt;FontSize, <span class="php-var">$link</span>, <span class="php-var">$ns</span>);
</span><span id="4459" class="l"><a href="#4459"> 4459: </a>                }
</span><span id="4460" class="l"><a href="#4460"> 4460: </a>            }
</span><span id="4461" class="l"><a href="#4461"> 4461: </a>            <span class="php-comment">// output cell</span>
</span><span id="4462" class="l"><a href="#4462"> 4462: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$s</span>) {
</span><span id="4463" class="l"><a href="#4463"> 4463: </a>                <span class="php-comment">// output cell</span>
</span><span id="4464" class="l"><a href="#4464"> 4464: </a>                <span class="php-var">$rs</span> .= <span class="php-var">$s</span>;
</span><span id="4465" class="l"><a href="#4465"> 4465: </a>                <span class="php-comment">// reset text stretching</span>
</span><span id="4466" class="l"><a href="#4466"> 4466: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$stretch</span> &gt; <span class="php-num">2</span>) {
</span><span id="4467" class="l"><a href="#4467"> 4467: </a>                    <span class="php-comment">//Reset character horizontal spacing</span>
</span><span id="4468" class="l"><a href="#4468"> 4468: </a>                    <span class="php-var">$rs</span> .= <span class="php-quote">' BT 0 Tc ET'</span>;
</span><span id="4469" class="l"><a href="#4469"> 4469: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$stretch</span> &gt; <span class="php-num">0</span>) {
</span><span id="4470" class="l"><a href="#4470"> 4470: </a>                    <span class="php-comment">//Reset character horizontal scaling</span>
</span><span id="4471" class="l"><a href="#4471"> 4471: </a>                    <span class="php-var">$rs</span> .= <span class="php-quote">' BT 100 Tz ET'</span>;
</span><span id="4472" class="l"><a href="#4472"> 4472: </a>                }
</span><span id="4473" class="l"><a href="#4473"> 4473: </a>            }
</span><span id="4474" class="l"><a href="#4474"> 4474: </a>            <span class="php-comment">// reset word spacing</span>
</span><span id="4475" class="l"><a href="#4475"> 4475: </a>            <span class="php-keyword1">if</span> (!((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$align</span> == <span class="php-quote">'J'</span>)) {
</span><span id="4476" class="l"><a href="#4476"> 4476: </a>                <span class="php-var">$rs</span> .= <span class="php-quote">' BT 0 Tw ET'</span>;
</span><span id="4477" class="l"><a href="#4477"> 4477: </a>            }
</span><span id="4478" class="l"><a href="#4478"> 4478: </a>            <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$h</span>;
</span><span id="4479" class="l"><a href="#4479"> 4479: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$ln</span> &gt; <span class="php-num">0</span>) {
</span><span id="4480" class="l"><a href="#4480"> 4480: </a>                <span class="php-comment">//Go to the beginning of the next line</span>
</span><span id="4481" class="l"><a href="#4481"> 4481: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="4482" class="l"><a href="#4482"> 4482: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$ln</span> == <span class="php-num">1</span>) {
</span><span id="4483" class="l"><a href="#4483"> 4483: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4484" class="l"><a href="#4484"> 4484: </a>                        <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="4485" class="l"><a href="#4485"> 4485: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4486" class="l"><a href="#4486"> 4486: </a>                        <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="4487" class="l"><a href="#4487"> 4487: </a>                    }
</span><span id="4488" class="l"><a href="#4488"> 4488: </a>                }
</span><span id="4489" class="l"><a href="#4489"> 4489: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4490" class="l"><a href="#4490"> 4490: </a>                <span class="php-comment">// go left or right by case</span>
</span><span id="4491" class="l"><a href="#4491"> 4491: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4492" class="l"><a href="#4492"> 4492: </a>                    <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="4493" class="l"><a href="#4493"> 4493: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4494" class="l"><a href="#4494"> 4494: </a>                    <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="4495" class="l"><a href="#4495"> 4495: </a>                }
</span><span id="4496" class="l"><a href="#4496"> 4496: </a>            }
</span><span id="4497" class="l"><a href="#4497"> 4497: </a>            <span class="php-var">$gstyles</span> = <span class="php-quote">''</span>.<span class="php-var">$this</span>-&gt;linestyleWidth.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;linestyleCap.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;linestyleJoin.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;linestyleDash.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;DrawColor.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;FillColor.<span class="php-quote">&quot;\n&quot;</span>;
</span><span id="4498" class="l"><a href="#4498"> 4498: </a>            <span class="php-var">$rs</span> = <span class="php-var">$gstyles</span>.<span class="php-var">$rs</span>;
</span><span id="4499" class="l"><a href="#4499"> 4499: </a>            <span class="php-keyword1">return</span> <span class="php-var">$rs</span>;
</span><span id="4500" class="l"><a href="#4500"> 4500: </a>        }
</span><span id="4501" class="l"><a href="#4501"> 4501: </a>
</span><span id="4502" class="l"><a href="#4502"> 4502: </a>        <span class="php-comment">/**
</span></span><span id="4503" class="l"><a href="#4503"> 4503: </a><span class="php-comment">         * This method allows printing text with line breaks.
</span></span><span id="4504" class="l"><a href="#4504"> 4504: </a><span class="php-comment">         * They can be automatic (as soon as the text reaches the right border of the cell) or explicit (via the \n character). As many cells as necessary are output, one below the other.&lt;br /&gt;
</span></span><span id="4505" class="l"><a href="#4505"> 4505: </a><span class="php-comment">         * Text can be aligned, centered or justified. The cell block can be framed and the background painted.
</span></span><span id="4506" class="l"><a href="#4506"> 4506: </a><span class="php-comment">         * @param float $w Width of cells. If 0, they extend up to the right margin of the page.
</span></span><span id="4507" class="l"><a href="#4507"> 4507: </a><span class="php-comment">         * @param float $h Cell minimum height. The cell extends automatically if needed.
</span></span><span id="4508" class="l"><a href="#4508"> 4508: </a><span class="php-comment">         * @param string $txt String to print
</span></span><span id="4509" class="l"><a href="#4509"> 4509: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the cell block. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4510" class="l"><a href="#4510"> 4510: </a><span class="php-comment">         * @param string $align Allows to center or align the text. Possible values are:&lt;ul&gt;&lt;li&gt;L or empty string: left align&lt;/li&gt;&lt;li&gt;C: center&lt;/li&gt;&lt;li&gt;R: right align&lt;/li&gt;&lt;li&gt;J: justification (default value when $ishtml=false)&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4511" class="l"><a href="#4511"> 4511: </a><span class="php-comment">         * @param int $fill Indicates if the cell background must be painted (1) or transparent (0). Default value: 0.
</span></span><span id="4512" class="l"><a href="#4512"> 4512: </a><span class="php-comment">         * @param int $ln Indicates where the current position should go after the call. Possible values are:&lt;ul&gt;&lt;li&gt;0: to the right&lt;/li&gt;&lt;li&gt;1: to the beginning of the next line [DEFAULT]&lt;/li&gt;&lt;li&gt;2: below&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4513" class="l"><a href="#4513"> 4513: </a><span class="php-comment">         * @param float $x x position in user units
</span></span><span id="4514" class="l"><a href="#4514"> 4514: </a><span class="php-comment">         * @param float $y y position in user units
</span></span><span id="4515" class="l"><a href="#4515"> 4515: </a><span class="php-comment">         * @param boolean $reseth if true reset the last cell height (default true).
</span></span><span id="4516" class="l"><a href="#4516"> 4516: </a><span class="php-comment">         * @param int $stretch stretch carachter mode: &lt;ul&gt;&lt;li&gt;0 = disabled&lt;/li&gt;&lt;li&gt;1 = horizontal scaling only if necessary&lt;/li&gt;&lt;li&gt;2 = forced horizontal scaling&lt;/li&gt;&lt;li&gt;3 = character spacing only if necessary&lt;/li&gt;&lt;li&gt;4 = forced character spacing&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4517" class="l"><a href="#4517"> 4517: </a><span class="php-comment">         * @param boolean $ishtml set to true if $txt is HTML content (default = false).
</span></span><span id="4518" class="l"><a href="#4518"> 4518: </a><span class="php-comment">         * @param boolean $autopadding if true, uses internal padding and automatically adjust it to account for line width.
</span></span><span id="4519" class="l"><a href="#4519"> 4519: </a><span class="php-comment">         * @param float $maxh maximum height. It should be &gt;= $h and less then remaining space to the bottom of the page, or 0 for disable this feature. This feature works only when $ishtml=false.
</span></span><span id="4520" class="l"><a href="#4520"> 4520: </a><span class="php-comment">         * @return int Return the number of cells or 1 for html mode.
</span></span><span id="4521" class="l"><a href="#4521"> 4521: </a><span class="php-comment">         * @access public
</span></span><span id="4522" class="l"><a href="#4522"> 4522: </a><span class="php-comment">         * @since 1.3
</span></span><span id="4523" class="l"><a href="#4523"> 4523: </a><span class="php-comment">         * @see SetFont(), SetDrawColor(), SetFillColor(), SetTextColor(), SetLineWidth(), Cell(), Write(), SetAutoPageBreak()
</span></span><span id="4524" class="l"><a href="#4524"> 4524: </a><span class="php-comment">         */</span>
</span><span id="4525" class="l"><a href="#4525"> 4525: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> MultiCell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$txt</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$align</span>=<span class="php-quote">'J'</span>, <span class="php-var">$fill</span>=<span class="php-num">0</span>, <span class="php-var">$ln</span>=<span class="php-num">1</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$reseth</span>=<span class="php-keyword1">true</span>, <span class="php-var">$stretch</span>=<span class="php-num">0</span>, <span class="php-var">$ishtml</span>=<span class="php-keyword1">false</span>, <span class="php-var">$autopadding</span>=<span class="php-keyword1">true</span>, <span class="php-var">$maxh</span>=<span class="php-num">0</span>) {
</span><span id="4526" class="l"><a href="#4526"> 4526: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;lasth) <span class="php-keyword1">OR</span> <span class="php-var">$reseth</span>) {
</span><span id="4527" class="l"><a href="#4527"> 4527: </a>                <span class="php-comment">//set row height</span>
</span><span id="4528" class="l"><a href="#4528"> 4528: </a>                <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="4529" class="l"><a href="#4529"> 4529: </a>            }
</span><span id="4530" class="l"><a href="#4530"> 4530: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$y</span>)) {
</span><span id="4531" class="l"><a href="#4531"> 4531: </a>                <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$y</span>);
</span><span id="4532" class="l"><a href="#4532"> 4532: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4533" class="l"><a href="#4533"> 4533: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="4534" class="l"><a href="#4534"> 4534: </a>            }
</span><span id="4535" class="l"><a href="#4535"> 4535: </a>            <span class="php-comment">// check for page break</span>
</span><span id="4536" class="l"><a href="#4536"> 4536: </a>            <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$h</span>);
</span><span id="4537" class="l"><a href="#4537"> 4537: </a>            <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="4538" class="l"><a href="#4538"> 4538: </a>            <span class="php-comment">// get current page number</span>
</span><span id="4539" class="l"><a href="#4539"> 4539: </a>            <span class="php-var">$startpage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="4540" class="l"><a href="#4540"> 4540: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$x</span>)) {
</span><span id="4541" class="l"><a href="#4541"> 4541: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$x</span>);
</span><span id="4542" class="l"><a href="#4542"> 4542: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4543" class="l"><a href="#4543"> 4543: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;GetX();
</span><span id="4544" class="l"><a href="#4544"> 4544: </a>            }
</span><span id="4545" class="l"><a href="#4545"> 4545: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$w</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="4546" class="l"><a href="#4546"> 4546: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4547" class="l"><a href="#4547"> 4547: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="4548" class="l"><a href="#4548"> 4548: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4549" class="l"><a href="#4549"> 4549: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x;
</span><span id="4550" class="l"><a href="#4550"> 4550: </a>                }
</span><span id="4551" class="l"><a href="#4551"> 4551: </a>            }
</span><span id="4552" class="l"><a href="#4552"> 4552: </a>            <span class="php-comment">// store original margin values</span>
</span><span id="4553" class="l"><a href="#4553"> 4553: </a>            <span class="php-var">$lMargin</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="4554" class="l"><a href="#4554"> 4554: </a>            <span class="php-var">$rMargin</span> = <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="4555" class="l"><a href="#4555"> 4555: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4556" class="l"><a href="#4556"> 4556: </a>                <span class="php-var">$this</span>-&gt;SetRightMargin(<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;x);
</span><span id="4557" class="l"><a href="#4557"> 4557: </a>                <span class="php-var">$this</span>-&gt;SetLeftMargin(<span class="php-var">$this</span>-&gt;x - <span class="php-var">$w</span>);
</span><span id="4558" class="l"><a href="#4558"> 4558: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4559" class="l"><a href="#4559"> 4559: </a>                <span class="php-var">$this</span>-&gt;SetLeftMargin(<span class="php-var">$this</span>-&gt;x);
</span><span id="4560" class="l"><a href="#4560"> 4560: </a>                <span class="php-var">$this</span>-&gt;SetRightMargin(<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;x - <span class="php-var">$w</span>);
</span><span id="4561" class="l"><a href="#4561"> 4561: </a>            }
</span><span id="4562" class="l"><a href="#4562"> 4562: </a>            <span class="php-var">$starty</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="4563" class="l"><a href="#4563"> 4563: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$autopadding</span>) {
</span><span id="4564" class="l"><a href="#4564"> 4564: </a>                <span class="php-comment">// Adjust internal padding</span>
</span><span id="4565" class="l"><a href="#4565"> 4565: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;cMargin &lt; (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>)) {
</span><span id="4566" class="l"><a href="#4566"> 4566: </a>                    <span class="php-var">$this</span>-&gt;cMargin = (<span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>);
</span><span id="4567" class="l"><a href="#4567"> 4567: </a>                }
</span><span id="4568" class="l"><a href="#4568"> 4568: </a>                <span class="php-comment">// Add top space if needed</span>
</span><span id="4569" class="l"><a href="#4569"> 4569: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;lasth - <span class="php-var">$this</span>-&gt;FontSize) &lt; <span class="php-var">$this</span>-&gt;LineWidth) {
</span><span id="4570" class="l"><a href="#4570"> 4570: </a>                    <span class="php-var">$this</span>-&gt;y += <span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>;
</span><span id="4571" class="l"><a href="#4571"> 4571: </a>                }
</span><span id="4572" class="l"><a href="#4572"> 4572: </a>                <span class="php-comment">// add top padding</span>
</span><span id="4573" class="l"><a href="#4573"> 4573: </a>                <span class="php-var">$this</span>-&gt;y += <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4574" class="l"><a href="#4574"> 4574: </a>            }
</span><span id="4575" class="l"><a href="#4575"> 4575: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$ishtml</span>) {
</span><span id="4576" class="l"><a href="#4576"> 4576: </a>                <span class="php-comment">// ******* Write HTML text</span>
</span><span id="4577" class="l"><a href="#4577"> 4577: </a>                <span class="php-var">$this</span>-&gt;writeHTML(<span class="php-var">$txt</span>, <span class="php-keyword1">true</span>, <span class="php-num">0</span>, <span class="php-var">$reseth</span>, <span class="php-keyword1">true</span>, <span class="php-var">$align</span>);
</span><span id="4578" class="l"><a href="#4578"> 4578: </a>                <span class="php-var">$nl</span> = <span class="php-num">1</span>;
</span><span id="4579" class="l"><a href="#4579"> 4579: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4580" class="l"><a href="#4580"> 4580: </a>                <span class="php-comment">// ******* Write text</span>
</span><span id="4581" class="l"><a href="#4581"> 4581: </a>                <span class="php-var">$nl</span> = <span class="php-var">$this</span>-&gt;Write(<span class="php-var">$this</span>-&gt;lasth, <span class="php-var">$txt</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-var">$align</span>, <span class="php-keyword1">true</span>, <span class="php-var">$stretch</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">true</span>, <span class="php-var">$maxh</span>);
</span><span id="4582" class="l"><a href="#4582"> 4582: </a>            }
</span><span id="4583" class="l"><a href="#4583"> 4583: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$autopadding</span>) {
</span><span id="4584" class="l"><a href="#4584"> 4584: </a>                <span class="php-comment">// add bottom padding</span>
</span><span id="4585" class="l"><a href="#4585"> 4585: </a>                <span class="php-var">$this</span>-&gt;y += <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4586" class="l"><a href="#4586"> 4586: </a>                <span class="php-comment">// Add bottom space if needed</span>
</span><span id="4587" class="l"><a href="#4587"> 4587: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;lasth - <span class="php-var">$this</span>-&gt;FontSize) &lt; <span class="php-var">$this</span>-&gt;LineWidth) {
</span><span id="4588" class="l"><a href="#4588"> 4588: </a>                    <span class="php-var">$this</span>-&gt;y += <span class="php-var">$this</span>-&gt;LineWidth / <span class="php-num">2</span>;
</span><span id="4589" class="l"><a href="#4589"> 4589: </a>                }
</span><span id="4590" class="l"><a href="#4590"> 4590: </a>            }
</span><span id="4591" class="l"><a href="#4591"> 4591: </a>            <span class="php-comment">// Get end-of-text Y position</span>
</span><span id="4592" class="l"><a href="#4592"> 4592: </a>            <span class="php-var">$currentY</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="4593" class="l"><a href="#4593"> 4593: </a>            <span class="php-comment">// get latest page number</span>
</span><span id="4594" class="l"><a href="#4594"> 4594: </a>            <span class="php-var">$endpage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="4595" class="l"><a href="#4595"> 4595: </a>            <span class="php-comment">// check if a new page has been created</span>
</span><span id="4596" class="l"><a href="#4596"> 4596: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$endpage</span> &gt; <span class="php-var">$startpage</span>) {
</span><span id="4597" class="l"><a href="#4597"> 4597: </a>                <span class="php-comment">// design borders around HTML cells.</span>
</span><span id="4598" class="l"><a href="#4598"> 4598: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$page</span>=<span class="php-var">$startpage</span>; <span class="php-var">$page</span> &lt;= <span class="php-var">$endpage</span>; ++<span class="php-var">$page</span>) {
</span><span id="4599" class="l"><a href="#4599"> 4599: </a>                    <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$page</span>);
</span><span id="4600" class="l"><a href="#4600"> 4600: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$page</span> == <span class="php-var">$startpage</span>) {
</span><span id="4601" class="l"><a href="#4601"> 4601: </a>                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$starty</span>; <span class="php-comment">// put cursor at the beginning of cell on the first page</span>
</span><span id="4602" class="l"><a href="#4602"> 4602: </a>                        <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;getPageHeight() - <span class="php-var">$starty</span> - <span class="php-var">$this</span>-&gt;getBreakMargin();
</span><span id="4603" class="l"><a href="#4603"> 4603: </a>                        <span class="php-var">$cborder</span> = <span class="php-var">$this</span>-&gt;getBorderMode(<span class="php-var">$border</span>, <span class="php-var">$position</span>=<span class="php-quote">'start'</span>);
</span><span id="4604" class="l"><a href="#4604"> 4604: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$page</span> == <span class="php-var">$endpage</span>) {
</span><span id="4605" class="l"><a href="#4605"> 4605: </a>                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin; <span class="php-comment">// put cursor at the beginning of last page</span>
</span><span id="4606" class="l"><a href="#4606"> 4606: </a>                        <span class="php-var">$h</span> = <span class="php-var">$currentY</span> - <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="4607" class="l"><a href="#4607"> 4607: </a>                        <span class="php-var">$cborder</span> = <span class="php-var">$this</span>-&gt;getBorderMode(<span class="php-var">$border</span>, <span class="php-var">$position</span>=<span class="php-quote">'end'</span>);
</span><span id="4608" class="l"><a href="#4608"> 4608: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4609" class="l"><a href="#4609"> 4609: </a>                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin; <span class="php-comment">// put cursor at the beginning of the current page</span>
</span><span id="4610" class="l"><a href="#4610"> 4610: </a>                        <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;getPageHeight() - <span class="php-var">$this</span>-&gt;tMargin - <span class="php-var">$this</span>-&gt;getBreakMargin();
</span><span id="4611" class="l"><a href="#4611"> 4611: </a>                        <span class="php-var">$cborder</span> = <span class="php-var">$this</span>-&gt;getBorderMode(<span class="php-var">$border</span>, <span class="php-var">$position</span>=<span class="php-quote">'middle'</span>);
</span><span id="4612" class="l"><a href="#4612"> 4612: </a>                    }
</span><span id="4613" class="l"><a href="#4613"> 4613: </a>                    <span class="php-var">$nx</span> = <span class="php-var">$x</span>;
</span><span id="4614" class="l"><a href="#4614"> 4614: </a>                    <span class="php-comment">// account for margin changes</span>
</span><span id="4615" class="l"><a href="#4615"> 4615: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$page</span> &gt; <span class="php-var">$startpage</span>) {
</span><span id="4616" class="l"><a href="#4616"> 4616: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'orm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'orm'</span>])) {
</span><span id="4617" class="l"><a href="#4617"> 4617: </a>                            <span class="php-var">$nx</span> = <span class="php-var">$x</span> + (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'orm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'orm'</span>]);
</span><span id="4618" class="l"><a href="#4618"> 4618: </a>                        } <span class="php-keyword1">elseif</span> ((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'olm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'olm'</span>])) {
</span><span id="4619" class="l"><a href="#4619"> 4619: </a>                            <span class="php-var">$nx</span> = <span class="php-var">$x</span> + (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'olm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'olm'</span>]);
</span><span id="4620" class="l"><a href="#4620"> 4620: </a>                        }
</span><span id="4621" class="l"><a href="#4621"> 4621: </a>                    }
</span><span id="4622" class="l"><a href="#4622"> 4622: </a>                    <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$nx</span>);
</span><span id="4623" class="l"><a href="#4623"> 4623: </a>                    <span class="php-var">$ccode</span> = <span class="php-var">$this</span>-&gt;getCellCode(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">''</span>, <span class="php-var">$cborder</span>, <span class="php-num">1</span>, <span class="php-quote">''</span>, <span class="php-var">$fill</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>);
</span><span id="4624" class="l"><a href="#4624"> 4624: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$cborder</span> <span class="php-keyword1">OR</span> <span class="php-var">$fill</span>) {
</span><span id="4625" class="l"><a href="#4625"> 4625: </a>                        <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$this</span>-&gt;page);
</span><span id="4626" class="l"><a href="#4626"> 4626: </a>                        <span class="php-var">$pstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="4627" class="l"><a href="#4627"> 4627: </a>                        <span class="php-var">$pend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="4628" class="l"><a href="#4628"> 4628: </a>                        <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$pstart</span>.<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="4629" class="l"><a href="#4629"> 4629: </a>                        <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page] += <span class="php-keyword2">strlen</span>(<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="4630" class="l"><a href="#4630"> 4630: </a>                    }
</span><span id="4631" class="l"><a href="#4631"> 4631: </a>                }
</span><span id="4632" class="l"><a href="#4632"> 4632: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4633" class="l"><a href="#4633"> 4633: </a>                <span class="php-var">$h</span> = <span class="php-keyword2">max</span>(<span class="php-var">$h</span>, (<span class="php-var">$currentY</span> - <span class="php-var">$y</span>));
</span><span id="4634" class="l"><a href="#4634"> 4634: </a>                <span class="php-comment">// put cursor at the beginning of text</span>
</span><span id="4635" class="l"><a href="#4635"> 4635: </a>                <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$y</span>);
</span><span id="4636" class="l"><a href="#4636"> 4636: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$x</span>);
</span><span id="4637" class="l"><a href="#4637"> 4637: </a>                <span class="php-comment">// design a cell around the text</span>
</span><span id="4638" class="l"><a href="#4638"> 4638: </a>                <span class="php-var">$ccode</span> = <span class="php-var">$this</span>-&gt;getCellCode(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">''</span>, <span class="php-var">$border</span>, <span class="php-num">1</span>, <span class="php-quote">''</span>, <span class="php-var">$fill</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-keyword1">true</span>);
</span><span id="4639" class="l"><a href="#4639"> 4639: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$border</span> <span class="php-keyword1">OR</span> <span class="php-var">$fill</span>) {
</span><span id="4640" class="l"><a href="#4640"> 4640: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">end</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page]) !== <span class="php-keyword1">false</span>) {
</span><span id="4641" class="l"><a href="#4641"> 4641: </a>                        <span class="php-var">$pagemarkkey</span> = <span class="php-keyword2">key</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="4642" class="l"><a href="#4642"> 4642: </a>                        <span class="php-var">$pagemark</span> = &amp;<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pagemarkkey</span>];
</span><span id="4643" class="l"><a href="#4643"> 4643: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;InFooter) {
</span><span id="4644" class="l"><a href="#4644"> 4644: </a>                        <span class="php-var">$pagemark</span> = &amp;<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page];
</span><span id="4645" class="l"><a href="#4645"> 4645: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4646" class="l"><a href="#4646"> 4646: </a>                        <span class="php-var">$pagemark</span> = &amp;<span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page];
</span><span id="4647" class="l"><a href="#4647"> 4647: </a>                    }
</span><span id="4648" class="l"><a href="#4648"> 4648: </a>                    <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$this</span>-&gt;page);
</span><span id="4649" class="l"><a href="#4649"> 4649: </a>                    <span class="php-var">$pstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$pagemark</span>);
</span><span id="4650" class="l"><a href="#4650"> 4650: </a>                    <span class="php-var">$pend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$pagemark</span>);
</span><span id="4651" class="l"><a href="#4651"> 4651: </a>                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$pstart</span>.<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="4652" class="l"><a href="#4652"> 4652: </a>                    <span class="php-var">$pagemark</span> += <span class="php-keyword2">strlen</span>(<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="4653" class="l"><a href="#4653"> 4653: </a>                }
</span><span id="4654" class="l"><a href="#4654"> 4654: </a>            }
</span><span id="4655" class="l"><a href="#4655"> 4655: </a>            <span class="php-comment">// Get end-of-cell Y position</span>
</span><span id="4656" class="l"><a href="#4656"> 4656: </a>            <span class="php-var">$currentY</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="4657" class="l"><a href="#4657"> 4657: </a>            <span class="php-comment">// restore original margin values</span>
</span><span id="4658" class="l"><a href="#4658"> 4658: </a>            <span class="php-var">$this</span>-&gt;SetLeftMargin(<span class="php-var">$lMargin</span>);
</span><span id="4659" class="l"><a href="#4659"> 4659: </a>            <span class="php-var">$this</span>-&gt;SetRightMargin(<span class="php-var">$rMargin</span>);
</span><span id="4660" class="l"><a href="#4660"> 4660: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$ln</span> &gt; <span class="php-num">0</span>) {
</span><span id="4661" class="l"><a href="#4661"> 4661: </a>                <span class="php-comment">//Go to the beginning of the next line</span>
</span><span id="4662" class="l"><a href="#4662"> 4662: </a>                <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$currentY</span>);
</span><span id="4663" class="l"><a href="#4663"> 4663: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$ln</span> == <span class="php-num">2</span>) {
</span><span id="4664" class="l"><a href="#4664"> 4664: </a>                    <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$x</span> + <span class="php-var">$w</span>);
</span><span id="4665" class="l"><a href="#4665"> 4665: </a>                }
</span><span id="4666" class="l"><a href="#4666"> 4666: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4667" class="l"><a href="#4667"> 4667: </a>                <span class="php-comment">// go left or right by case</span>
</span><span id="4668" class="l"><a href="#4668"> 4668: </a>                <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$startpage</span>);
</span><span id="4669" class="l"><a href="#4669"> 4669: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="4670" class="l"><a href="#4670"> 4670: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$x</span> + <span class="php-var">$w</span>);
</span><span id="4671" class="l"><a href="#4671"> 4671: </a>            }
</span><span id="4672" class="l"><a href="#4672"> 4672: </a>            <span class="php-var">$this</span>-&gt;setContentMark();
</span><span id="4673" class="l"><a href="#4673"> 4673: </a>            <span class="php-keyword1">return</span> <span class="php-var">$nl</span>;
</span><span id="4674" class="l"><a href="#4674"> 4674: </a>        }
</span><span id="4675" class="l"><a href="#4675"> 4675: </a>
</span><span id="4676" class="l"><a href="#4676"> 4676: </a>        <span class="php-comment">/**
</span></span><span id="4677" class="l"><a href="#4677"> 4677: </a><span class="php-comment">         * Get the border mode accounting for multicell position (opens bottom side of multicell crossing pages)
</span></span><span id="4678" class="l"><a href="#4678"> 4678: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the cell block. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4679" class="l"><a href="#4679"> 4679: </a><span class="php-comment">         * @param string multicell position: 'start', 'middle', 'end'
</span></span><span id="4680" class="l"><a href="#4680"> 4680: </a><span class="php-comment">         * @return border mode
</span></span><span id="4681" class="l"><a href="#4681"> 4681: </a><span class="php-comment">         * @access protected
</span></span><span id="4682" class="l"><a href="#4682"> 4682: </a><span class="php-comment">         * @since 4.4.002 (2008-12-09)
</span></span><span id="4683" class="l"><a href="#4683"> 4683: </a><span class="php-comment">         */</span>
</span><span id="4684" class="l"><a href="#4684"> 4684: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getBorderMode(<span class="php-var">$border</span>, <span class="php-var">$position</span>=<span class="php-quote">'start'</span>) {
</span><span id="4685" class="l"><a href="#4685"> 4685: </a>            <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;opencell) <span class="php-keyword1">AND</span> (<span class="php-var">$border</span> == <span class="php-num">1</span>)) {
</span><span id="4686" class="l"><a href="#4686"> 4686: </a>                <span class="php-keyword1">return</span> <span class="php-num">1</span>;
</span><span id="4687" class="l"><a href="#4687"> 4687: </a>            }
</span><span id="4688" class="l"><a href="#4688"> 4688: </a>            <span class="php-var">$cborder</span> = <span class="php-quote">''</span>;
</span><span id="4689" class="l"><a href="#4689"> 4689: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$position</span>) {
</span><span id="4690" class="l"><a href="#4690"> 4690: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'start'</span>: {
</span><span id="4691" class="l"><a href="#4691"> 4691: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$border</span> == <span class="php-num">1</span>) {
</span><span id="4692" class="l"><a href="#4692"> 4692: </a>                        <span class="php-var">$cborder</span> = <span class="php-quote">'LTR'</span>;
</span><span id="4693" class="l"><a href="#4693"> 4693: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4694" class="l"><a href="#4694"> 4694: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'L'</span>))) {
</span><span id="4695" class="l"><a href="#4695"> 4695: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'L'</span>;
</span><span id="4696" class="l"><a href="#4696"> 4696: </a>                        }
</span><span id="4697" class="l"><a href="#4697"> 4697: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'T'</span>))) {
</span><span id="4698" class="l"><a href="#4698"> 4698: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'T'</span>;
</span><span id="4699" class="l"><a href="#4699"> 4699: </a>                        }
</span><span id="4700" class="l"><a href="#4700"> 4700: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'R'</span>))) {
</span><span id="4701" class="l"><a href="#4701"> 4701: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'R'</span>;
</span><span id="4702" class="l"><a href="#4702"> 4702: </a>                        }
</span><span id="4703" class="l"><a href="#4703"> 4703: </a>                        <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;opencell) <span class="php-keyword1">AND</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'B'</span>)))) {
</span><span id="4704" class="l"><a href="#4704"> 4704: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'B'</span>;
</span><span id="4705" class="l"><a href="#4705"> 4705: </a>                        }
</span><span id="4706" class="l"><a href="#4706"> 4706: </a>                    }
</span><span id="4707" class="l"><a href="#4707"> 4707: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4708" class="l"><a href="#4708"> 4708: </a>                }
</span><span id="4709" class="l"><a href="#4709"> 4709: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'middle'</span>: {
</span><span id="4710" class="l"><a href="#4710"> 4710: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$border</span> == <span class="php-num">1</span>) {
</span><span id="4711" class="l"><a href="#4711"> 4711: </a>                        <span class="php-var">$cborder</span> = <span class="php-quote">'LR'</span>;
</span><span id="4712" class="l"><a href="#4712"> 4712: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4713" class="l"><a href="#4713"> 4713: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'L'</span>))) {
</span><span id="4714" class="l"><a href="#4714"> 4714: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'L'</span>;
</span><span id="4715" class="l"><a href="#4715"> 4715: </a>                        }
</span><span id="4716" class="l"><a href="#4716"> 4716: </a>                        <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;opencell) <span class="php-keyword1">AND</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'T'</span>)))) {
</span><span id="4717" class="l"><a href="#4717"> 4717: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'T'</span>;
</span><span id="4718" class="l"><a href="#4718"> 4718: </a>                        }
</span><span id="4719" class="l"><a href="#4719"> 4719: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'R'</span>))) {
</span><span id="4720" class="l"><a href="#4720"> 4720: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'R'</span>;
</span><span id="4721" class="l"><a href="#4721"> 4721: </a>                        }
</span><span id="4722" class="l"><a href="#4722"> 4722: </a>                        <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;opencell) <span class="php-keyword1">AND</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'B'</span>)))) {
</span><span id="4723" class="l"><a href="#4723"> 4723: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'B'</span>;
</span><span id="4724" class="l"><a href="#4724"> 4724: </a>                        }
</span><span id="4725" class="l"><a href="#4725"> 4725: </a>                    }
</span><span id="4726" class="l"><a href="#4726"> 4726: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4727" class="l"><a href="#4727"> 4727: </a>                }
</span><span id="4728" class="l"><a href="#4728"> 4728: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'end'</span>: {
</span><span id="4729" class="l"><a href="#4729"> 4729: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$border</span> == <span class="php-num">1</span>) {
</span><span id="4730" class="l"><a href="#4730"> 4730: </a>                        <span class="php-var">$cborder</span> = <span class="php-quote">'LRB'</span>;
</span><span id="4731" class="l"><a href="#4731"> 4731: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4732" class="l"><a href="#4732"> 4732: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'L'</span>))) {
</span><span id="4733" class="l"><a href="#4733"> 4733: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'L'</span>;
</span><span id="4734" class="l"><a href="#4734"> 4734: </a>                        }
</span><span id="4735" class="l"><a href="#4735"> 4735: </a>                        <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;opencell) <span class="php-keyword1">AND</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'T'</span>)))) {
</span><span id="4736" class="l"><a href="#4736"> 4736: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'T'</span>;
</span><span id="4737" class="l"><a href="#4737"> 4737: </a>                        }
</span><span id="4738" class="l"><a href="#4738"> 4738: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'R'</span>))) {
</span><span id="4739" class="l"><a href="#4739"> 4739: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'R'</span>;
</span><span id="4740" class="l"><a href="#4740"> 4740: </a>                        }
</span><span id="4741" class="l"><a href="#4741"> 4741: </a>                        <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$border</span>, <span class="php-quote">'B'</span>))) {
</span><span id="4742" class="l"><a href="#4742"> 4742: </a>                            <span class="php-var">$cborder</span> .= <span class="php-quote">'B'</span>;
</span><span id="4743" class="l"><a href="#4743"> 4743: </a>                        }
</span><span id="4744" class="l"><a href="#4744"> 4744: </a>                    }
</span><span id="4745" class="l"><a href="#4745"> 4745: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4746" class="l"><a href="#4746"> 4746: </a>                }
</span><span id="4747" class="l"><a href="#4747"> 4747: </a>                <span class="php-keyword1">default</span>: {
</span><span id="4748" class="l"><a href="#4748"> 4748: </a>                    <span class="php-var">$cborder</span> = <span class="php-var">$border</span>;
</span><span id="4749" class="l"><a href="#4749"> 4749: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4750" class="l"><a href="#4750"> 4750: </a>                }
</span><span id="4751" class="l"><a href="#4751"> 4751: </a>            }
</span><span id="4752" class="l"><a href="#4752"> 4752: </a>            <span class="php-keyword1">return</span> <span class="php-var">$cborder</span>;
</span><span id="4753" class="l"><a href="#4753"> 4753: </a>        }
</span><span id="4754" class="l"><a href="#4754"> 4754: </a>
</span><span id="4755" class="l"><a href="#4755"> 4755: </a>        <span class="php-comment">/**
</span></span><span id="4756" class="l"><a href="#4756"> 4756: </a><span class="php-comment">         * This method returns the estimated number of lines required to print the text (not the real number just a quick estimation).
</span></span><span id="4757" class="l"><a href="#4757"> 4757: </a><span class="php-comment">         * If you want o know the exact number of lines you have to use the following technique:
</span></span><span id="4758" class="l"><a href="#4758"> 4758: </a><span class="php-comment">         * &lt;pre&gt;
</span></span><span id="4759" class="l"><a href="#4759"> 4759: </a><span class="php-comment">         *  // store current object
</span></span><span id="4760" class="l"><a href="#4760"> 4760: </a><span class="php-comment">         *  $pdf-&gt;startTransaction();
</span></span><span id="4761" class="l"><a href="#4761"> 4761: </a><span class="php-comment">         *  // get the number of lines for multicell
</span></span><span id="4762" class="l"><a href="#4762"> 4762: </a><span class="php-comment">         *  $lines = $pdf-&gt;MultiCell($w, 0, $txt, 0, 'L', 0, 0, '', '', true, 0, false, true, 0);
</span></span><span id="4763" class="l"><a href="#4763"> 4763: </a><span class="php-comment">         *  // restore previous object
</span></span><span id="4764" class="l"><a href="#4764"> 4764: </a><span class="php-comment">         *  $pdf = $pdf-&gt;rollbackTransaction();
</span></span><span id="4765" class="l"><a href="#4765"> 4765: </a><span class="php-comment">         * &lt;/pre&gt;
</span></span><span id="4766" class="l"><a href="#4766"> 4766: </a><span class="php-comment">         * @param string $txt text to print
</span></span><span id="4767" class="l"><a href="#4767"> 4767: </a><span class="php-comment">         * @param float $w width of cell. If 0, they extend up to the right margin of the page.
</span></span><span id="4768" class="l"><a href="#4768"> 4768: </a><span class="php-comment">         * @return int Return the estimated number of lines.
</span></span><span id="4769" class="l"><a href="#4769"> 4769: </a><span class="php-comment">         * @access public
</span></span><span id="4770" class="l"><a href="#4770"> 4770: </a><span class="php-comment">         * @since 4.5.011
</span></span><span id="4771" class="l"><a href="#4771"> 4771: </a><span class="php-comment">         */</span>
</span><span id="4772" class="l"><a href="#4772"> 4772: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getNumLines(<span class="php-var">$txt</span>, <span class="php-var">$w</span>=<span class="php-num">0</span>) {
</span><span id="4773" class="l"><a href="#4773"> 4773: </a>            <span class="php-var">$lines</span> = <span class="php-num">0</span>;
</span><span id="4774" class="l"><a href="#4774"> 4774: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$w</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="4775" class="l"><a href="#4775"> 4775: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4776" class="l"><a href="#4776"> 4776: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="4777" class="l"><a href="#4777"> 4777: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4778" class="l"><a href="#4778"> 4778: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x;
</span><span id="4779" class="l"><a href="#4779"> 4779: </a>                }
</span><span id="4780" class="l"><a href="#4780"> 4780: </a>            }
</span><span id="4781" class="l"><a href="#4781"> 4781: </a>            <span class="php-comment">// max column width</span>
</span><span id="4782" class="l"><a href="#4782"> 4782: </a>            <span class="php-var">$wmax</span> = <span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="4783" class="l"><a href="#4783"> 4783: </a>            <span class="php-comment">// remove carriage returns</span>
</span><span id="4784" class="l"><a href="#4784"> 4784: </a>            <span class="php-var">$txt</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">&quot;\r&quot;</span>, <span class="php-quote">''</span>, <span class="php-var">$txt</span>);
</span><span id="4785" class="l"><a href="#4785"> 4785: </a>            <span class="php-comment">// remove last newline (if any)</span>
</span><span id="4786" class="l"><a href="#4786"> 4786: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$txt</span>,-<span class="php-num">1</span>) == <span class="php-quote">&quot;\n&quot;</span>) {
</span><span id="4787" class="l"><a href="#4787"> 4787: </a>                <span class="php-var">$txt</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$txt</span>, <span class="php-num">0</span>, -<span class="php-num">1</span>);
</span><span id="4788" class="l"><a href="#4788"> 4788: </a>            }
</span><span id="4789" class="l"><a href="#4789"> 4789: </a>            <span class="php-comment">// divide text in blocks</span>
</span><span id="4790" class="l"><a href="#4790"> 4790: </a>            <span class="php-var">$txtblocks</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">&quot;\n&quot;</span>, <span class="php-var">$txt</span>);
</span><span id="4791" class="l"><a href="#4791"> 4791: </a>            <span class="php-comment">// for each text block</span>
</span><span id="4792" class="l"><a href="#4792"> 4792: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$txtblocks</span> <span class="php-keyword1">as</span> <span class="php-var">$block</span>) {
</span><span id="4793" class="l"><a href="#4793"> 4793: </a>                <span class="php-comment">// estimate the number of lines</span>
</span><span id="4794" class="l"><a href="#4794"> 4794: </a>                <span class="php-var">$lines</span> += <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$block</span>) ? <span class="php-num">1</span> : (<span class="php-keyword2">ceil</span>(<span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$block</span>) / <span class="php-var">$wmax</span>));
</span><span id="4795" class="l"><a href="#4795"> 4795: </a>            }
</span><span id="4796" class="l"><a href="#4796"> 4796: </a>            <span class="php-comment">// return the number of lines</span>
</span><span id="4797" class="l"><a href="#4797"> 4797: </a>            <span class="php-keyword1">return</span> <span class="php-var">$lines</span>;
</span><span id="4798" class="l"><a href="#4798"> 4798: </a>        }
</span><span id="4799" class="l"><a href="#4799"> 4799: </a>
</span><span id="4800" class="l"><a href="#4800"> 4800: </a>        <span class="php-comment">/**
</span></span><span id="4801" class="l"><a href="#4801"> 4801: </a><span class="php-comment">         * This method prints text from the current position.&lt;br /&gt;
</span></span><span id="4802" class="l"><a href="#4802"> 4802: </a><span class="php-comment">         * @param float $h Line height
</span></span><span id="4803" class="l"><a href="#4803"> 4803: </a><span class="php-comment">         * @param string $txt String to print
</span></span><span id="4804" class="l"><a href="#4804"> 4804: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink()
</span></span><span id="4805" class="l"><a href="#4805"> 4805: </a><span class="php-comment">         * @param int $fill Indicates if the background must be painted (1) or transparent (0). Default value: 0.
</span></span><span id="4806" class="l"><a href="#4806"> 4806: </a><span class="php-comment">         * @param string $align Allows to center or align the text. Possible values are:&lt;ul&gt;&lt;li&gt;L or empty string: left align (default value)&lt;/li&gt;&lt;li&gt;C: center&lt;/li&gt;&lt;li&gt;R: right align&lt;/li&gt;&lt;li&gt;J: justify&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4807" class="l"><a href="#4807"> 4807: </a><span class="php-comment">         * @param boolean $ln if true set cursor at the bottom of the line, otherwise set cursor at the top of the line.
</span></span><span id="4808" class="l"><a href="#4808"> 4808: </a><span class="php-comment">         * @param int $stretch stretch carachter mode: &lt;ul&gt;&lt;li&gt;0 = disabled&lt;/li&gt;&lt;li&gt;1 = horizontal scaling only if necessary&lt;/li&gt;&lt;li&gt;2 = forced horizontal scaling&lt;/li&gt;&lt;li&gt;3 = character spacing only if necessary&lt;/li&gt;&lt;li&gt;4 = forced character spacing&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="4809" class="l"><a href="#4809"> 4809: </a><span class="php-comment">         * @param boolean $firstline if true prints only the first line and return the remaining string.
</span></span><span id="4810" class="l"><a href="#4810"> 4810: </a><span class="php-comment">         * @param boolean $firstblock if true the string is the starting of a line.
</span></span><span id="4811" class="l"><a href="#4811"> 4811: </a><span class="php-comment">         * @param float $maxh maximum height. The remaining unprinted text will be returned. It should be &gt;= $h and less then remaining space to the bottom of the page, or 0 for disable this feature.
</span></span><span id="4812" class="l"><a href="#4812"> 4812: </a><span class="php-comment">         * @return mixed Return the number of cells or the remaining string if $firstline = true.
</span></span><span id="4813" class="l"><a href="#4813"> 4813: </a><span class="php-comment">         * @access public
</span></span><span id="4814" class="l"><a href="#4814"> 4814: </a><span class="php-comment">         * @since 1.5
</span></span><span id="4815" class="l"><a href="#4815"> 4815: </a><span class="php-comment">         */</span>
</span><span id="4816" class="l"><a href="#4816"> 4816: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Write(<span class="php-var">$h</span>, <span class="php-var">$txt</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$fill</span>=<span class="php-num">0</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$ln</span>=<span class="php-keyword1">false</span>, <span class="php-var">$stretch</span>=<span class="php-num">0</span>, <span class="php-var">$firstline</span>=<span class="php-keyword1">false</span>, <span class="php-var">$firstblock</span>=<span class="php-keyword1">false</span>, <span class="php-var">$maxh</span>=<span class="php-num">0</span>) {
</span><span id="4817" class="l"><a href="#4817"> 4817: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$txt</span>) == <span class="php-num">0</span>) {
</span><span id="4818" class="l"><a href="#4818"> 4818: </a>                <span class="php-var">$txt</span> = <span class="php-quote">' '</span>;
</span><span id="4819" class="l"><a href="#4819"> 4819: </a>            }
</span><span id="4820" class="l"><a href="#4820"> 4820: </a>            <span class="php-comment">// remove carriage returns</span>
</span><span id="4821" class="l"><a href="#4821"> 4821: </a>            <span class="php-var">$s</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">&quot;\r&quot;</span>, <span class="php-quote">''</span>, <span class="php-var">$txt</span>);
</span><span id="4822" class="l"><a href="#4822"> 4822: </a>            <span class="php-comment">// check if string contains arabic text</span>
</span><span id="4823" class="l"><a href="#4823"> 4823: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(K_RE_PATTERN_ARABIC, <span class="php-var">$s</span>)) {
</span><span id="4824" class="l"><a href="#4824"> 4824: </a>                <span class="php-var">$arabic</span> = <span class="php-keyword1">true</span>;
</span><span id="4825" class="l"><a href="#4825"> 4825: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4826" class="l"><a href="#4826"> 4826: </a>                <span class="php-var">$arabic</span> = <span class="php-keyword1">false</span>;
</span><span id="4827" class="l"><a href="#4827"> 4827: </a>            }
</span><span id="4828" class="l"><a href="#4828"> 4828: </a>            <span class="php-comment">// check if string contains RTL text</span>
</span><span id="4829" class="l"><a href="#4829"> 4829: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$arabic</span> <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;tmprtl == <span class="php-quote">'R'</span>) <span class="php-keyword1">OR</span> <span class="php-keyword2">preg_match</span>(K_RE_PATTERN_RTL, <span class="php-var">$txt</span>)) {
</span><span id="4830" class="l"><a href="#4830"> 4830: </a>                <span class="php-var">$rtlmode</span> = <span class="php-keyword1">true</span>;
</span><span id="4831" class="l"><a href="#4831"> 4831: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4832" class="l"><a href="#4832"> 4832: </a>                <span class="php-var">$rtlmode</span> = <span class="php-keyword1">false</span>;
</span><span id="4833" class="l"><a href="#4833"> 4833: </a>            }
</span><span id="4834" class="l"><a href="#4834"> 4834: </a>            <span class="php-comment">// get a char width</span>
</span><span id="4835" class="l"><a href="#4835"> 4835: </a>            <span class="php-var">$chrwidth</span> = <span class="php-var">$this</span>-&gt;GetCharWidth(<span class="php-quote">'.'</span>);
</span><span id="4836" class="l"><a href="#4836"> 4836: </a>            <span class="php-comment">// get array of unicode values</span>
</span><span id="4837" class="l"><a href="#4837"> 4837: </a>            <span class="php-var">$chars</span> = <span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$s</span>);
</span><span id="4838" class="l"><a href="#4838"> 4838: </a>            <span class="php-comment">// get array of chars</span>
</span><span id="4839" class="l"><a href="#4839"> 4839: </a>            <span class="php-var">$uchars</span> = <span class="php-var">$this</span>-&gt;UTF8ArrayToUniArray(<span class="php-var">$chars</span>);
</span><span id="4840" class="l"><a href="#4840"> 4840: </a>            <span class="php-comment">// get the number of characters</span>
</span><span id="4841" class="l"><a href="#4841"> 4841: </a>            <span class="php-var">$nb</span> = <span class="php-keyword2">count</span>(<span class="php-var">$chars</span>);
</span><span id="4842" class="l"><a href="#4842"> 4842: </a>            <span class="php-comment">// replacement for SHY character (minus symbol)</span>
</span><span id="4843" class="l"><a href="#4843"> 4843: </a>            <span class="php-var">$shy_replacement</span> = <span class="php-num">45</span>;
</span><span id="4844" class="l"><a href="#4844"> 4844: </a>            <span class="php-var">$shy_replacement_char</span> = <span class="php-var">$this</span>-&gt;unichr(<span class="php-var">$shy_replacement</span>);
</span><span id="4845" class="l"><a href="#4845"> 4845: </a>            <span class="php-comment">// widht for SHY replacement</span>
</span><span id="4846" class="l"><a href="#4846"> 4846: </a>            <span class="php-var">$shy_replacement_width</span> = <span class="php-var">$this</span>-&gt;GetCharWidth(<span class="php-var">$shy_replacement</span>);
</span><span id="4847" class="l"><a href="#4847"> 4847: </a>            <span class="php-comment">// store current position</span>
</span><span id="4848" class="l"><a href="#4848"> 4848: </a>            <span class="php-var">$prevx</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="4849" class="l"><a href="#4849"> 4849: </a>            <span class="php-var">$prevy</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="4850" class="l"><a href="#4850"> 4850: </a>            <span class="php-comment">// max Y</span>
</span><span id="4851" class="l"><a href="#4851"> 4851: </a>            <span class="php-var">$maxy</span> = <span class="php-var">$this</span>-&gt;y + <span class="php-var">$maxh</span> - <span class="php-var">$h</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="4852" class="l"><a href="#4852"> 4852: </a>            <span class="php-comment">// calculate remaining line width ($w)</span>
</span><span id="4853" class="l"><a href="#4853"> 4853: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4854" class="l"><a href="#4854"> 4854: </a>                <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="4855" class="l"><a href="#4855"> 4855: </a>            } <span class="php-keyword1">else</span> {
</span><span id="4856" class="l"><a href="#4856"> 4856: </a>                <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x;
</span><span id="4857" class="l"><a href="#4857"> 4857: </a>            }
</span><span id="4858" class="l"><a href="#4858"> 4858: </a>            <span class="php-comment">// max column width</span>
</span><span id="4859" class="l"><a href="#4859"> 4859: </a>            <span class="php-var">$wmax</span> = <span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="4860" class="l"><a href="#4860"> 4860: </a>            <span class="php-keyword1">if</span> ((!<span class="php-var">$firstline</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$chrwidth</span> &gt; <span class="php-var">$wmax</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;GetCharWidth(<span class="php-var">$chars</span>[<span class="php-num">0</span>]) &gt; <span class="php-var">$wmax</span>))) {
</span><span id="4861" class="l"><a href="#4861"> 4861: </a>                <span class="php-comment">// a single character do not fit on column</span>
</span><span id="4862" class="l"><a href="#4862"> 4862: </a>                <span class="php-keyword1">return</span> <span class="php-quote">''</span>;
</span><span id="4863" class="l"><a href="#4863"> 4863: </a>            }
</span><span id="4864" class="l"><a href="#4864"> 4864: </a>            <span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-comment">// character position</span>
</span><span id="4865" class="l"><a href="#4865"> 4865: </a>            <span class="php-var">$j</span> = <span class="php-num">0</span>; <span class="php-comment">// current starting position</span>
</span><span id="4866" class="l"><a href="#4866"> 4866: </a>            <span class="php-var">$sep</span> = -<span class="php-num">1</span>; <span class="php-comment">// position of the last blank space</span>
</span><span id="4867" class="l"><a href="#4867"> 4867: </a>            <span class="php-var">$shy</span> = <span class="php-keyword1">false</span>; <span class="php-comment">// true if the last blank is a soft hypen (SHY)</span>
</span><span id="4868" class="l"><a href="#4868"> 4868: </a>            <span class="php-var">$l</span> = <span class="php-num">0</span>; <span class="php-comment">// current string length</span>
</span><span id="4869" class="l"><a href="#4869"> 4869: </a>            <span class="php-var">$nl</span> = <span class="php-num">0</span>; <span class="php-comment">//number of lines</span>
</span><span id="4870" class="l"><a href="#4870"> 4870: </a>            <span class="php-var">$linebreak</span> = <span class="php-keyword1">false</span>;
</span><span id="4871" class="l"><a href="#4871"> 4871: </a>            <span class="php-var">$pc</span> = <span class="php-num">0</span>; <span class="php-comment">// previous character</span>
</span><span id="4872" class="l"><a href="#4872"> 4872: </a>            <span class="php-comment">// for each character</span>
</span><span id="4873" class="l"><a href="#4873"> 4873: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$i</span> &lt; <span class="php-var">$nb</span>) {
</span><span id="4874" class="l"><a href="#4874"> 4874: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$maxh</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;y &gt;= <span class="php-var">$maxy</span>) ) {
</span><span id="4875" class="l"><a href="#4875"> 4875: </a>                    <span class="php-keyword1">break</span>;
</span><span id="4876" class="l"><a href="#4876"> 4876: </a>                }
</span><span id="4877" class="l"><a href="#4877"> 4877: </a>                <span class="php-comment">//Get the current character</span>
</span><span id="4878" class="l"><a href="#4878"> 4878: </a>                <span class="php-var">$c</span> = <span class="php-var">$chars</span>[<span class="php-var">$i</span>];
</span><span id="4879" class="l"><a href="#4879"> 4879: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$c</span> == <span class="php-num">10</span>) { <span class="php-comment">// 10 = &quot;\n&quot; = new line</span>
</span><span id="4880" class="l"><a href="#4880"> 4880: </a>                    <span class="php-comment">//Explicit line break</span>
</span><span id="4881" class="l"><a href="#4881"> 4881: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$align</span> == <span class="php-quote">'J'</span>) {
</span><span id="4882" class="l"><a href="#4882"> 4882: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4883" class="l"><a href="#4883"> 4883: </a>                            <span class="php-var">$talign</span> = <span class="php-quote">'R'</span>;
</span><span id="4884" class="l"><a href="#4884"> 4884: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4885" class="l"><a href="#4885"> 4885: </a>                            <span class="php-var">$talign</span> = <span class="php-quote">'L'</span>;
</span><span id="4886" class="l"><a href="#4886"> 4886: </a>                        }
</span><span id="4887" class="l"><a href="#4887"> 4887: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4888" class="l"><a href="#4888"> 4888: </a>                        <span class="php-var">$talign</span> = <span class="php-var">$align</span>;
</span><span id="4889" class="l"><a href="#4889"> 4889: </a>                    }
</span><span id="4890" class="l"><a href="#4890"> 4890: </a>                    <span class="php-var">$tmpstr</span> = <span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$j</span>, <span class="php-var">$i</span>);
</span><span id="4891" class="l"><a href="#4891"> 4891: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="4892" class="l"><a href="#4892"> 4892: </a>                        <span class="php-var">$startx</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="4893" class="l"><a href="#4893"> 4893: </a>                        <span class="php-var">$tmparr</span> = <span class="php-keyword2">array_slice</span>(<span class="php-var">$chars</span>, <span class="php-var">$j</span>, (<span class="php-var">$i</span> - <span class="php-var">$j</span>));
</span><span id="4894" class="l"><a href="#4894"> 4894: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$rtlmode</span>) {
</span><span id="4895" class="l"><a href="#4895"> 4895: </a>                            <span class="php-var">$tmparr</span> = <span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-var">$tmparr</span>, <span class="php-var">$tmpstr</span>, <span class="php-var">$this</span>-&gt;tmprtl);
</span><span id="4896" class="l"><a href="#4896"> 4896: </a>                        }
</span><span id="4897" class="l"><a href="#4897"> 4897: </a>                        <span class="php-var">$linew</span> = <span class="php-var">$this</span>-&gt;GetArrStringWidth(<span class="php-var">$tmparr</span>);
</span><span id="4898" class="l"><a href="#4898"> 4898: </a>                        <span class="php-keyword1">unset</span>(<span class="php-var">$tmparr</span>);
</span><span id="4899" class="l"><a href="#4899"> 4899: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4900" class="l"><a href="#4900"> 4900: </a>                            <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> - <span class="php-var">$linew</span>;
</span><span id="4901" class="l"><a href="#4901"> 4901: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4902" class="l"><a href="#4902"> 4902: </a>                            <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> + <span class="php-var">$linew</span>;
</span><span id="4903" class="l"><a href="#4903"> 4903: </a>                        }
</span><span id="4904" class="l"><a href="#4904"> 4904: </a>                        <span class="php-var">$w</span> = <span class="php-var">$linew</span>;
</span><span id="4905" class="l"><a href="#4905"> 4905: </a>                        <span class="php-var">$tmpcmargin</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4906" class="l"><a href="#4906"> 4906: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$maxh</span> == <span class="php-num">0</span>) {
</span><span id="4907" class="l"><a href="#4907"> 4907: </a>                            <span class="php-var">$this</span>-&gt;cMargin = <span class="php-num">0</span>;
</span><span id="4908" class="l"><a href="#4908"> 4908: </a>                        }
</span><span id="4909" class="l"><a href="#4909"> 4909: </a>                    }
</span><span id="4910" class="l"><a href="#4910"> 4910: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$firstblock</span> <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="4911" class="l"><a href="#4911"> 4911: </a>                        <span class="php-var">$tmpstr</span> = <span class="php-keyword2">rtrim</span>(<span class="php-var">$tmpstr</span>);
</span><span id="4912" class="l"><a href="#4912"> 4912: </a>                    }
</span><span id="4913" class="l"><a href="#4913"> 4913: </a>                    <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$tmpstr</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-var">$talign</span>, <span class="php-var">$fill</span>, <span class="php-var">$link</span>, <span class="php-var">$stretch</span>);
</span><span id="4914" class="l"><a href="#4914"> 4914: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$tmpstr</span>);
</span><span id="4915" class="l"><a href="#4915"> 4915: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="4916" class="l"><a href="#4916"> 4916: </a>                        <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$tmpcmargin</span>;
</span><span id="4917" class="l"><a href="#4917"> 4917: </a>                        <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$i</span>));
</span><span id="4918" class="l"><a href="#4918"> 4918: </a>                    }
</span><span id="4919" class="l"><a href="#4919"> 4919: </a>                    ++<span class="php-var">$nl</span>;
</span><span id="4920" class="l"><a href="#4920"> 4920: </a>                    <span class="php-var">$j</span> = <span class="php-var">$i</span> + <span class="php-num">1</span>;
</span><span id="4921" class="l"><a href="#4921"> 4921: </a>                    <span class="php-var">$l</span> = <span class="php-num">0</span>;
</span><span id="4922" class="l"><a href="#4922"> 4922: </a>                    <span class="php-var">$sep</span> = -<span class="php-num">1</span>;
</span><span id="4923" class="l"><a href="#4923"> 4923: </a>                    <span class="php-var">$shy</span> = <span class="php-keyword1">false</span>;
</span><span id="4924" class="l"><a href="#4924"> 4924: </a>                    <span class="php-comment">// account for margin changes</span>
</span><span id="4925" class="l"><a href="#4925"> 4925: </a>                    <span class="php-keyword1">if</span> (((<span class="php-var">$this</span>-&gt;y + <span class="php-var">$this</span>-&gt;lasth) &gt; <span class="php-var">$this</span>-&gt;PageBreakTrigger) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;InFooter)) {
</span><span id="4926" class="l"><a href="#4926"> 4926: </a>                        <span class="php-comment">// AcceptPageBreak() may be overriden on extended classed to include margin changes</span>
</span><span id="4927" class="l"><a href="#4927"> 4927: </a>                        <span class="php-var">$this</span>-&gt;AcceptPageBreak();
</span><span id="4928" class="l"><a href="#4928"> 4928: </a>                    }
</span><span id="4929" class="l"><a href="#4929"> 4929: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;getRemainingWidth();
</span><span id="4930" class="l"><a href="#4930"> 4930: </a>                    <span class="php-var">$wmax</span> = <span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="4931" class="l"><a href="#4931"> 4931: </a>                } <span class="php-keyword1">else</span> {
</span><span id="4932" class="l"><a href="#4932"> 4932: </a>                    <span class="php-comment">// 160 is the non-breaking space.</span>
</span><span id="4933" class="l"><a href="#4933"> 4933: </a>                    <span class="php-comment">// 173 is SHY (Soft Hypen).</span>
</span><span id="4934" class="l"><a href="#4934"> 4934: </a>                    <span class="php-comment">// \p{Z} or \p{Separator}: any kind of Unicode whitespace or invisible separator.</span>
</span><span id="4935" class="l"><a href="#4935"> 4935: </a>                    <span class="php-comment">// \p{Lo} or \p{Other_Letter}: a Unicode letter or ideograph that does not have lowercase and uppercase variants.</span>
</span><span id="4936" class="l"><a href="#4936"> 4936: </a>                    <span class="php-comment">// \p{Lo} is needed because Chinese characters are packed next to each other without spaces in between.</span>
</span><span id="4937" class="l"><a href="#4937"> 4937: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$c</span> != <span class="php-num">160</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$c</span> == <span class="php-num">173</span>) <span class="php-keyword1">OR</span> <span class="php-keyword2">preg_match</span>(<span class="php-var">$this</span>-&gt;re_spaces, <span class="php-var">$this</span>-&gt;unichr(<span class="php-var">$c</span>)))) {
</span><span id="4938" class="l"><a href="#4938"> 4938: </a>                        <span class="php-comment">// update last blank space position</span>
</span><span id="4939" class="l"><a href="#4939"> 4939: </a>                        <span class="php-var">$sep</span> = <span class="php-var">$i</span>;
</span><span id="4940" class="l"><a href="#4940"> 4940: </a>                        <span class="php-comment">// check if is a SHY</span>
</span><span id="4941" class="l"><a href="#4941"> 4941: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$c</span> == <span class="php-num">173</span>) {
</span><span id="4942" class="l"><a href="#4942"> 4942: </a>                            <span class="php-var">$shy</span> = <span class="php-keyword1">true</span>;
</span><span id="4943" class="l"><a href="#4943"> 4943: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$pc</span> == <span class="php-num">45</span>) {
</span><span id="4944" class="l"><a href="#4944"> 4944: </a>                                <span class="php-var">$tmp_shy_replacement_width</span> = <span class="php-num">0</span>;
</span><span id="4945" class="l"><a href="#4945"> 4945: </a>                                <span class="php-var">$tmp_shy_replacement_char</span> = <span class="php-quote">''</span>;
</span><span id="4946" class="l"><a href="#4946"> 4946: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="4947" class="l"><a href="#4947"> 4947: </a>                                <span class="php-var">$tmp_shy_replacement_width</span> = <span class="php-var">$shy_replacement_width</span>;
</span><span id="4948" class="l"><a href="#4948"> 4948: </a>                                <span class="php-var">$tmp_shy_replacement_char</span> = <span class="php-var">$shy_replacement_char</span>;
</span><span id="4949" class="l"><a href="#4949"> 4949: </a>                            }
</span><span id="4950" class="l"><a href="#4950"> 4950: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="4951" class="l"><a href="#4951"> 4951: </a>                            <span class="php-var">$shy</span> = <span class="php-keyword1">false</span>;
</span><span id="4952" class="l"><a href="#4952"> 4952: </a>                        }
</span><span id="4953" class="l"><a href="#4953"> 4953: </a>                    }
</span><span id="4954" class="l"><a href="#4954"> 4954: </a>                    <span class="php-comment">// update string length</span>
</span><span id="4955" class="l"><a href="#4955"> 4955: </a>                    <span class="php-keyword1">if</span> (((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$arabic</span>)) {
</span><span id="4956" class="l"><a href="#4956"> 4956: </a>                        <span class="php-comment">// with bidirectional algorithm some chars may be changed affecting the line length</span>
</span><span id="4957" class="l"><a href="#4957"> 4957: </a>                        <span class="php-comment">// *** very slow ***</span>
</span><span id="4958" class="l"><a href="#4958"> 4958: </a>                        <span class="php-var">$l</span> = <span class="php-var">$this</span>-&gt;GetArrStringWidth(<span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-keyword2">array_slice</span>(<span class="php-var">$chars</span>, <span class="php-var">$j</span>, (<span class="php-var">$i</span> - <span class="php-var">$j</span>)), <span class="php-quote">''</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="4959" class="l"><a href="#4959"> 4959: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="4960" class="l"><a href="#4960"> 4960: </a>                        <span class="php-var">$l</span> += <span class="php-var">$this</span>-&gt;GetCharWidth(<span class="php-var">$c</span>);
</span><span id="4961" class="l"><a href="#4961"> 4961: </a>                    }
</span><span id="4962" class="l"><a href="#4962"> 4962: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$l</span> &gt; <span class="php-var">$wmax</span>) <span class="php-keyword1">OR</span> ((<span class="php-var">$c</span> == <span class="php-num">173</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$l</span> + <span class="php-var">$tmp_shy_replacement_width</span>) &gt; <span class="php-var">$wmax</span>)) ) {
</span><span id="4963" class="l"><a href="#4963"> 4963: </a>                        <span class="php-comment">// we have reached the end of column</span>
</span><span id="4964" class="l"><a href="#4964"> 4964: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$sep</span> == -<span class="php-num">1</span>) {
</span><span id="4965" class="l"><a href="#4965"> 4965: </a>                            <span class="php-comment">// check if the line was already started</span>
</span><span id="4966" class="l"><a href="#4966"> 4966: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;rtl <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;x &lt;= (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$chrwidth</span>)))
</span><span id="4967" class="l"><a href="#4967"> 4967: </a>                                <span class="php-keyword1">OR</span> ((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;x &gt;= (<span class="php-var">$this</span>-&gt;lMargin + <span class="php-var">$chrwidth</span>)))) {
</span><span id="4968" class="l"><a href="#4968"> 4968: </a>                                <span class="php-comment">// print a void cell and go to next line</span>
</span><span id="4969" class="l"><a href="#4969"> 4969: </a>                                <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-num">1</span>);
</span><span id="4970" class="l"><a href="#4970"> 4970: </a>                                <span class="php-var">$linebreak</span> = <span class="php-keyword1">true</span>;
</span><span id="4971" class="l"><a href="#4971"> 4971: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="4972" class="l"><a href="#4972"> 4972: </a>                                    <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$j</span>));
</span><span id="4973" class="l"><a href="#4973"> 4973: </a>                                }
</span><span id="4974" class="l"><a href="#4974"> 4974: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="4975" class="l"><a href="#4975"> 4975: </a>                                <span class="php-comment">// truncate the word because do not fit on column</span>
</span><span id="4976" class="l"><a href="#4976"> 4976: </a>                                <span class="php-var">$tmpstr</span> = <span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$j</span>, <span class="php-var">$i</span>);
</span><span id="4977" class="l"><a href="#4977"> 4977: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="4978" class="l"><a href="#4978"> 4978: </a>                                    <span class="php-var">$startx</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="4979" class="l"><a href="#4979"> 4979: </a>                                    <span class="php-var">$tmparr</span> = <span class="php-keyword2">array_slice</span>(<span class="php-var">$chars</span>, <span class="php-var">$j</span>, (<span class="php-var">$i</span> - <span class="php-var">$j</span>));
</span><span id="4980" class="l"><a href="#4980"> 4980: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$rtlmode</span>) {
</span><span id="4981" class="l"><a href="#4981"> 4981: </a>                                        <span class="php-var">$tmparr</span> = <span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-var">$tmparr</span>, <span class="php-var">$tmpstr</span>, <span class="php-var">$this</span>-&gt;tmprtl);
</span><span id="4982" class="l"><a href="#4982"> 4982: </a>                                    }
</span><span id="4983" class="l"><a href="#4983"> 4983: </a>                                    <span class="php-var">$linew</span> = <span class="php-var">$this</span>-&gt;GetArrStringWidth(<span class="php-var">$tmparr</span>);
</span><span id="4984" class="l"><a href="#4984"> 4984: </a>                                    <span class="php-keyword1">unset</span>(<span class="php-var">$tmparr</span>);
</span><span id="4985" class="l"><a href="#4985"> 4985: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="4986" class="l"><a href="#4986"> 4986: </a>                                        <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> - <span class="php-var">$linew</span>;
</span><span id="4987" class="l"><a href="#4987"> 4987: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="4988" class="l"><a href="#4988"> 4988: </a>                                        <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> + <span class="php-var">$linew</span>;
</span><span id="4989" class="l"><a href="#4989"> 4989: </a>                                    }
</span><span id="4990" class="l"><a href="#4990"> 4990: </a>                                    <span class="php-var">$w</span> = <span class="php-var">$linew</span>;
</span><span id="4991" class="l"><a href="#4991"> 4991: </a>                                    <span class="php-var">$tmpcmargin</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="4992" class="l"><a href="#4992"> 4992: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$maxh</span> == <span class="php-num">0</span>) {
</span><span id="4993" class="l"><a href="#4993"> 4993: </a>                                        <span class="php-var">$this</span>-&gt;cMargin = <span class="php-num">0</span>;
</span><span id="4994" class="l"><a href="#4994"> 4994: </a>                                    }
</span><span id="4995" class="l"><a href="#4995"> 4995: </a>                                }
</span><span id="4996" class="l"><a href="#4996"> 4996: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$firstblock</span> <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="4997" class="l"><a href="#4997"> 4997: </a>                                    <span class="php-var">$tmpstr</span> = <span class="php-keyword2">rtrim</span>(<span class="php-var">$tmpstr</span>);
</span><span id="4998" class="l"><a href="#4998"> 4998: </a>                                }
</span><span id="4999" class="l"><a href="#4999"> 4999: </a>                                <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$tmpstr</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-var">$align</span>, <span class="php-var">$fill</span>, <span class="php-var">$link</span>, <span class="php-var">$stretch</span>);
</span><span id="5000" class="l"><a href="#5000"> 5000: </a>                                <span class="php-keyword1">unset</span>(<span class="php-var">$tmpstr</span>);
</span><span id="5001" class="l"><a href="#5001"> 5001: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="5002" class="l"><a href="#5002"> 5002: </a>                                    <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$tmpcmargin</span>;
</span><span id="5003" class="l"><a href="#5003"> 5003: </a>                                    <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$i</span>));
</span><span id="5004" class="l"><a href="#5004"> 5004: </a>                                }
</span><span id="5005" class="l"><a href="#5005"> 5005: </a>                                <span class="php-var">$j</span> = <span class="php-var">$i</span>;
</span><span id="5006" class="l"><a href="#5006"> 5006: </a>                                --<span class="php-var">$i</span>;
</span><span id="5007" class="l"><a href="#5007"> 5007: </a>                            }
</span><span id="5008" class="l"><a href="#5008"> 5008: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="5009" class="l"><a href="#5009"> 5009: </a>                            <span class="php-comment">// word wrapping</span>
</span><span id="5010" class="l"><a href="#5010"> 5010: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl <span class="php-keyword1">AND</span> (!<span class="php-var">$firstblock</span>)) {
</span><span id="5011" class="l"><a href="#5011"> 5011: </a>                                <span class="php-var">$endspace</span> = <span class="php-num">1</span>;
</span><span id="5012" class="l"><a href="#5012"> 5012: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="5013" class="l"><a href="#5013"> 5013: </a>                                <span class="php-var">$endspace</span> = <span class="php-num">0</span>;
</span><span id="5014" class="l"><a href="#5014"> 5014: </a>                            }
</span><span id="5015" class="l"><a href="#5015"> 5015: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$shy</span>) {
</span><span id="5016" class="l"><a href="#5016"> 5016: </a>                                <span class="php-comment">// add hypen (minus symbol) at the end of the line</span>
</span><span id="5017" class="l"><a href="#5017"> 5017: </a>                                <span class="php-var">$shy_width</span> = <span class="php-var">$tmp_shy_replacement_width</span>;
</span><span id="5018" class="l"><a href="#5018"> 5018: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5019" class="l"><a href="#5019"> 5019: </a>                                    <span class="php-var">$shy_char_left</span> = <span class="php-var">$tmp_shy_replacement_char</span>;
</span><span id="5020" class="l"><a href="#5020"> 5020: </a>                                    <span class="php-var">$shy_char_right</span> = <span class="php-quote">''</span>;
</span><span id="5021" class="l"><a href="#5021"> 5021: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="5022" class="l"><a href="#5022"> 5022: </a>                                    <span class="php-var">$shy_char_left</span> = <span class="php-quote">''</span>;
</span><span id="5023" class="l"><a href="#5023"> 5023: </a>                                    <span class="php-var">$shy_char_right</span> = <span class="php-var">$tmp_shy_replacement_char</span>;
</span><span id="5024" class="l"><a href="#5024"> 5024: </a>                                }
</span><span id="5025" class="l"><a href="#5025"> 5025: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="5026" class="l"><a href="#5026"> 5026: </a>                                <span class="php-var">$shy_width</span> = <span class="php-num">0</span>;
</span><span id="5027" class="l"><a href="#5027"> 5027: </a>                                <span class="php-var">$shy_char_left</span> = <span class="php-quote">''</span>;
</span><span id="5028" class="l"><a href="#5028"> 5028: </a>                                <span class="php-var">$shy_char_right</span> = <span class="php-quote">''</span>;
</span><span id="5029" class="l"><a href="#5029"> 5029: </a>                            }
</span><span id="5030" class="l"><a href="#5030"> 5030: </a>                            <span class="php-var">$tmpstr</span> = <span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$j</span>, (<span class="php-var">$sep</span> + <span class="php-var">$endspace</span>));
</span><span id="5031" class="l"><a href="#5031"> 5031: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="5032" class="l"><a href="#5032"> 5032: </a>                                <span class="php-var">$startx</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="5033" class="l"><a href="#5033"> 5033: </a>                                <span class="php-var">$tmparr</span> = <span class="php-keyword2">array_slice</span>(<span class="php-var">$chars</span>, <span class="php-var">$j</span>, ((<span class="php-var">$sep</span> + <span class="php-var">$endspace</span>) - <span class="php-var">$j</span>));
</span><span id="5034" class="l"><a href="#5034"> 5034: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$rtlmode</span>) {
</span><span id="5035" class="l"><a href="#5035"> 5035: </a>                                    <span class="php-var">$tmparr</span> = <span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-var">$tmparr</span>, <span class="php-var">$tmpstr</span>, <span class="php-var">$this</span>-&gt;tmprtl);
</span><span id="5036" class="l"><a href="#5036"> 5036: </a>                                }
</span><span id="5037" class="l"><a href="#5037"> 5037: </a>                                <span class="php-var">$linew</span> = <span class="php-var">$this</span>-&gt;GetArrStringWidth(<span class="php-var">$tmparr</span>);
</span><span id="5038" class="l"><a href="#5038"> 5038: </a>                                <span class="php-keyword1">unset</span>(<span class="php-var">$tmparr</span>);
</span><span id="5039" class="l"><a href="#5039"> 5039: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5040" class="l"><a href="#5040"> 5040: </a>                                    <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> - <span class="php-var">$linew</span> - <span class="php-var">$shy_width</span>;
</span><span id="5041" class="l"><a href="#5041"> 5041: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="5042" class="l"><a href="#5042"> 5042: </a>                                    <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> + <span class="php-var">$linew</span> + <span class="php-var">$shy_width</span>;
</span><span id="5043" class="l"><a href="#5043"> 5043: </a>                                }
</span><span id="5044" class="l"><a href="#5044"> 5044: </a>                                <span class="php-var">$w</span> = <span class="php-var">$linew</span>;
</span><span id="5045" class="l"><a href="#5045"> 5045: </a>                                <span class="php-var">$tmpcmargin</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="5046" class="l"><a href="#5046"> 5046: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$maxh</span> == <span class="php-num">0</span>) {
</span><span id="5047" class="l"><a href="#5047"> 5047: </a>                                    <span class="php-var">$this</span>-&gt;cMargin = <span class="php-num">0</span>;
</span><span id="5048" class="l"><a href="#5048"> 5048: </a>                                }
</span><span id="5049" class="l"><a href="#5049"> 5049: </a>                            }
</span><span id="5050" class="l"><a href="#5050"> 5050: </a>                            <span class="php-comment">// print the line</span>
</span><span id="5051" class="l"><a href="#5051"> 5051: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$firstblock</span> <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="5052" class="l"><a href="#5052"> 5052: </a>                                <span class="php-var">$tmpstr</span> = <span class="php-keyword2">rtrim</span>(<span class="php-var">$tmpstr</span>);
</span><span id="5053" class="l"><a href="#5053"> 5053: </a>                            }
</span><span id="5054" class="l"><a href="#5054"> 5054: </a>                            <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$shy_char_left</span>.<span class="php-var">$tmpstr</span>.<span class="php-var">$shy_char_right</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-var">$align</span>, <span class="php-var">$fill</span>, <span class="php-var">$link</span>, <span class="php-var">$stretch</span>);
</span><span id="5055" class="l"><a href="#5055"> 5055: </a>                            <span class="php-keyword1">unset</span>(<span class="php-var">$tmpstr</span>);
</span><span id="5056" class="l"><a href="#5056"> 5056: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="5057" class="l"><a href="#5057"> 5057: </a>                                <span class="php-comment">// return the remaining text</span>
</span><span id="5058" class="l"><a href="#5058"> 5058: </a>                                <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$tmpcmargin</span>;
</span><span id="5059" class="l"><a href="#5059"> 5059: </a>                                <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, (<span class="php-var">$sep</span> + <span class="php-var">$endspace</span>)));
</span><span id="5060" class="l"><a href="#5060"> 5060: </a>                            }
</span><span id="5061" class="l"><a href="#5061"> 5061: </a>                            <span class="php-var">$i</span> = <span class="php-var">$sep</span>;
</span><span id="5062" class="l"><a href="#5062"> 5062: </a>                            <span class="php-var">$sep</span> = -<span class="php-num">1</span>;
</span><span id="5063" class="l"><a href="#5063"> 5063: </a>                            <span class="php-var">$shy</span> = <span class="php-keyword1">false</span>;
</span><span id="5064" class="l"><a href="#5064"> 5064: </a>                            <span class="php-var">$j</span> = (<span class="php-var">$i</span>+<span class="php-num">1</span>);
</span><span id="5065" class="l"><a href="#5065"> 5065: </a>                        }
</span><span id="5066" class="l"><a href="#5066"> 5066: </a>                        <span class="php-comment">// account for margin changes</span>
</span><span id="5067" class="l"><a href="#5067"> 5067: </a>                        <span class="php-keyword1">if</span> (((<span class="php-var">$this</span>-&gt;y + <span class="php-var">$this</span>-&gt;lasth) &gt; <span class="php-var">$this</span>-&gt;PageBreakTrigger) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;InFooter)) {
</span><span id="5068" class="l"><a href="#5068"> 5068: </a>                            <span class="php-comment">// AcceptPageBreak() may be overriden on extended classed to include margin changes</span>
</span><span id="5069" class="l"><a href="#5069"> 5069: </a>                            <span class="php-var">$this</span>-&gt;AcceptPageBreak();
</span><span id="5070" class="l"><a href="#5070"> 5070: </a>                        }
</span><span id="5071" class="l"><a href="#5071"> 5071: </a>                        <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;getRemainingWidth();
</span><span id="5072" class="l"><a href="#5072"> 5072: </a>                        <span class="php-var">$wmax</span> = <span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="5073" class="l"><a href="#5073"> 5073: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$linebreak</span>) {
</span><span id="5074" class="l"><a href="#5074"> 5074: </a>                            <span class="php-var">$linebreak</span> = <span class="php-keyword1">false</span>;
</span><span id="5075" class="l"><a href="#5075"> 5075: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="5076" class="l"><a href="#5076"> 5076: </a>                            ++<span class="php-var">$nl</span>;
</span><span id="5077" class="l"><a href="#5077"> 5077: </a>                            <span class="php-var">$l</span> = <span class="php-num">0</span>;
</span><span id="5078" class="l"><a href="#5078"> 5078: </a>                        }
</span><span id="5079" class="l"><a href="#5079"> 5079: </a>                    }
</span><span id="5080" class="l"><a href="#5080"> 5080: </a>                }
</span><span id="5081" class="l"><a href="#5081"> 5081: </a>                <span class="php-comment">// save last character</span>
</span><span id="5082" class="l"><a href="#5082"> 5082: </a>                <span class="php-var">$pc</span> = <span class="php-var">$c</span>;
</span><span id="5083" class="l"><a href="#5083"> 5083: </a>                ++<span class="php-var">$i</span>;
</span><span id="5084" class="l"><a href="#5084"> 5084: </a>            } <span class="php-comment">// end while i &lt; nb</span>
</span><span id="5085" class="l"><a href="#5085"> 5085: </a>            <span class="php-comment">// print last substring (if any)</span>
</span><span id="5086" class="l"><a href="#5086"> 5086: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$l</span> &gt; <span class="php-num">0</span>) {
</span><span id="5087" class="l"><a href="#5087"> 5087: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$align</span>) {
</span><span id="5088" class="l"><a href="#5088"> 5088: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'J'</span>:
</span><span id="5089" class="l"><a href="#5089"> 5089: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: {
</span><span id="5090" class="l"><a href="#5090"> 5090: </a>                        <span class="php-var">$w</span> = <span class="php-var">$w</span>;
</span><span id="5091" class="l"><a href="#5091"> 5091: </a>                        <span class="php-keyword1">break</span>;
</span><span id="5092" class="l"><a href="#5092"> 5092: </a>                    }
</span><span id="5093" class="l"><a href="#5093"> 5093: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'L'</span>: {
</span><span id="5094" class="l"><a href="#5094"> 5094: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5095" class="l"><a href="#5095"> 5095: </a>                            <span class="php-var">$w</span> = <span class="php-var">$w</span>;
</span><span id="5096" class="l"><a href="#5096"> 5096: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="5097" class="l"><a href="#5097"> 5097: </a>                            <span class="php-var">$w</span> = <span class="php-var">$l</span>;
</span><span id="5098" class="l"><a href="#5098"> 5098: </a>                        }
</span><span id="5099" class="l"><a href="#5099"> 5099: </a>                        <span class="php-keyword1">break</span>;
</span><span id="5100" class="l"><a href="#5100"> 5100: </a>                    }
</span><span id="5101" class="l"><a href="#5101"> 5101: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'R'</span>: {
</span><span id="5102" class="l"><a href="#5102"> 5102: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5103" class="l"><a href="#5103"> 5103: </a>                            <span class="php-var">$w</span> = <span class="php-var">$l</span>;
</span><span id="5104" class="l"><a href="#5104"> 5104: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="5105" class="l"><a href="#5105"> 5105: </a>                            <span class="php-var">$w</span> = <span class="php-var">$w</span>;
</span><span id="5106" class="l"><a href="#5106"> 5106: </a>                        }
</span><span id="5107" class="l"><a href="#5107"> 5107: </a>                        <span class="php-keyword1">break</span>;
</span><span id="5108" class="l"><a href="#5108"> 5108: </a>                    }
</span><span id="5109" class="l"><a href="#5109"> 5109: </a>                    <span class="php-keyword1">default</span>: {
</span><span id="5110" class="l"><a href="#5110"> 5110: </a>                        <span class="php-var">$w</span> = <span class="php-var">$l</span>;
</span><span id="5111" class="l"><a href="#5111"> 5111: </a>                        <span class="php-keyword1">break</span>;
</span><span id="5112" class="l"><a href="#5112"> 5112: </a>                    }
</span><span id="5113" class="l"><a href="#5113"> 5113: </a>                }
</span><span id="5114" class="l"><a href="#5114"> 5114: </a>                <span class="php-var">$tmpstr</span> = <span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$j</span>, <span class="php-var">$nb</span>);
</span><span id="5115" class="l"><a href="#5115"> 5115: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="5116" class="l"><a href="#5116"> 5116: </a>                    <span class="php-var">$startx</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="5117" class="l"><a href="#5117"> 5117: </a>                    <span class="php-var">$tmparr</span> = <span class="php-keyword2">array_slice</span>(<span class="php-var">$chars</span>, <span class="php-var">$j</span>, (<span class="php-var">$nb</span> - <span class="php-var">$j</span>));
</span><span id="5118" class="l"><a href="#5118"> 5118: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$rtlmode</span>) {
</span><span id="5119" class="l"><a href="#5119"> 5119: </a>                        <span class="php-var">$tmparr</span> = <span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-var">$tmparr</span>, <span class="php-var">$tmpstr</span>, <span class="php-var">$this</span>-&gt;tmprtl);
</span><span id="5120" class="l"><a href="#5120"> 5120: </a>                    }
</span><span id="5121" class="l"><a href="#5121"> 5121: </a>                    <span class="php-var">$linew</span> = <span class="php-var">$this</span>-&gt;GetArrStringWidth(<span class="php-var">$tmparr</span>);
</span><span id="5122" class="l"><a href="#5122"> 5122: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$tmparr</span>);
</span><span id="5123" class="l"><a href="#5123"> 5123: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5124" class="l"><a href="#5124"> 5124: </a>                        <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> - <span class="php-var">$linew</span>;
</span><span id="5125" class="l"><a href="#5125"> 5125: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="5126" class="l"><a href="#5126"> 5126: </a>                        <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$startx</span> + <span class="php-var">$linew</span>;
</span><span id="5127" class="l"><a href="#5127"> 5127: </a>                    }
</span><span id="5128" class="l"><a href="#5128"> 5128: </a>                    <span class="php-var">$w</span> = <span class="php-var">$linew</span>;
</span><span id="5129" class="l"><a href="#5129"> 5129: </a>                    <span class="php-var">$tmpcmargin</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="5130" class="l"><a href="#5130"> 5130: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$maxh</span> == <span class="php-num">0</span>) {
</span><span id="5131" class="l"><a href="#5131"> 5131: </a>                        <span class="php-var">$this</span>-&gt;cMargin = <span class="php-num">0</span>;
</span><span id="5132" class="l"><a href="#5132"> 5132: </a>                    }
</span><span id="5133" class="l"><a href="#5133"> 5133: </a>                }
</span><span id="5134" class="l"><a href="#5134"> 5134: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$firstblock</span> <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="5135" class="l"><a href="#5135"> 5135: </a>                    <span class="php-var">$tmpstr</span> = <span class="php-keyword2">rtrim</span>(<span class="php-var">$tmpstr</span>);
</span><span id="5136" class="l"><a href="#5136"> 5136: </a>                }
</span><span id="5137" class="l"><a href="#5137"> 5137: </a>                <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$tmpstr</span>, <span class="php-num">0</span>, <span class="php-var">$ln</span>, <span class="php-var">$align</span>, <span class="php-var">$fill</span>, <span class="php-var">$link</span>, <span class="php-var">$stretch</span>);
</span><span id="5138" class="l"><a href="#5138"> 5138: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$tmpstr</span>);
</span><span id="5139" class="l"><a href="#5139"> 5139: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="5140" class="l"><a href="#5140"> 5140: </a>                    <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$tmpcmargin</span>;
</span><span id="5141" class="l"><a href="#5141"> 5141: </a>                    <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;UniArrSubString(<span class="php-var">$uchars</span>, <span class="php-var">$nb</span>));
</span><span id="5142" class="l"><a href="#5142"> 5142: </a>                }
</span><span id="5143" class="l"><a href="#5143"> 5143: </a>                ++<span class="php-var">$nl</span>;
</span><span id="5144" class="l"><a href="#5144"> 5144: </a>            }
</span><span id="5145" class="l"><a href="#5145"> 5145: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$firstline</span>) {
</span><span id="5146" class="l"><a href="#5146"> 5146: </a>                <span class="php-keyword1">return</span> <span class="php-quote">''</span>;
</span><span id="5147" class="l"><a href="#5147"> 5147: </a>            }
</span><span id="5148" class="l"><a href="#5148"> 5148: </a>            <span class="php-keyword1">return</span> <span class="php-var">$nl</span>;
</span><span id="5149" class="l"><a href="#5149"> 5149: </a>        }
</span><span id="5150" class="l"><a href="#5150"> 5150: </a>
</span><span id="5151" class="l"><a href="#5151"> 5151: </a>        <span class="php-comment">/**
</span></span><span id="5152" class="l"><a href="#5152"> 5152: </a><span class="php-comment">         * Returns the remaining width between the current position and margins.
</span></span><span id="5153" class="l"><a href="#5153"> 5153: </a><span class="php-comment">         * @return int Return the remaining width
</span></span><span id="5154" class="l"><a href="#5154"> 5154: </a><span class="php-comment">         * @access protected
</span></span><span id="5155" class="l"><a href="#5155"> 5155: </a><span class="php-comment">         */</span>
</span><span id="5156" class="l"><a href="#5156"> 5156: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getRemainingWidth() {
</span><span id="5157" class="l"><a href="#5157"> 5157: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5158" class="l"><a href="#5158"> 5158: </a>                <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin);
</span><span id="5159" class="l"><a href="#5159"> 5159: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5160" class="l"><a href="#5160"> 5160: </a>                <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x);
</span><span id="5161" class="l"><a href="#5161"> 5161: </a>            }
</span><span id="5162" class="l"><a href="#5162"> 5162: </a>        }
</span><span id="5163" class="l"><a href="#5163"> 5163: </a>
</span><span id="5164" class="l"><a href="#5164"> 5164: </a>        <span class="php-comment">/**
</span></span><span id="5165" class="l"><a href="#5165"> 5165: </a><span class="php-comment">         * Extract a slice of the $strarr array and return it as string.
</span></span><span id="5166" class="l"><a href="#5166"> 5166: </a><span class="php-comment">         * @param string $strarr The input array of characters.
</span></span><span id="5167" class="l"><a href="#5167"> 5167: </a><span class="php-comment">         * @param int $start the starting element of $strarr.
</span></span><span id="5168" class="l"><a href="#5168"> 5168: </a><span class="php-comment">         * @param int $end first element that will not be returned.
</span></span><span id="5169" class="l"><a href="#5169"> 5169: </a><span class="php-comment">         * @return Return part of a string
</span></span><span id="5170" class="l"><a href="#5170"> 5170: </a><span class="php-comment">         * @access public
</span></span><span id="5171" class="l"><a href="#5171"> 5171: </a><span class="php-comment">         */</span>
</span><span id="5172" class="l"><a href="#5172"> 5172: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> UTF8ArrSubString(<span class="php-var">$strarr</span>, <span class="php-var">$start</span>=<span class="php-quote">''</span>, <span class="php-var">$end</span>=<span class="php-quote">''</span>) {
</span><span id="5173" class="l"><a href="#5173"> 5173: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$start</span>) == <span class="php-num">0</span>) {
</span><span id="5174" class="l"><a href="#5174"> 5174: </a>                <span class="php-var">$start</span> = <span class="php-num">0</span>;
</span><span id="5175" class="l"><a href="#5175"> 5175: </a>            }
</span><span id="5176" class="l"><a href="#5176"> 5176: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$end</span>) == <span class="php-num">0</span>) {
</span><span id="5177" class="l"><a href="#5177"> 5177: </a>                <span class="php-var">$end</span> = <span class="php-keyword2">count</span>(<span class="php-var">$strarr</span>);
</span><span id="5178" class="l"><a href="#5178"> 5178: </a>            }
</span><span id="5179" class="l"><a href="#5179"> 5179: </a>            <span class="php-var">$string</span> = <span class="php-quote">''</span>;
</span><span id="5180" class="l"><a href="#5180"> 5180: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-var">$start</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$end</span>; ++<span class="php-var">$i</span>) {
</span><span id="5181" class="l"><a href="#5181"> 5181: </a>                <span class="php-var">$string</span> .= <span class="php-var">$this</span>-&gt;unichr(<span class="php-var">$strarr</span>[<span class="php-var">$i</span>]);
</span><span id="5182" class="l"><a href="#5182"> 5182: </a>            }
</span><span id="5183" class="l"><a href="#5183"> 5183: </a>            <span class="php-keyword1">return</span> <span class="php-var">$string</span>;
</span><span id="5184" class="l"><a href="#5184"> 5184: </a>        }
</span><span id="5185" class="l"><a href="#5185"> 5185: </a>
</span><span id="5186" class="l"><a href="#5186"> 5186: </a>        <span class="php-comment">/**
</span></span><span id="5187" class="l"><a href="#5187"> 5187: </a><span class="php-comment">         * Extract a slice of the $uniarr array and return it as string.
</span></span><span id="5188" class="l"><a href="#5188"> 5188: </a><span class="php-comment">         * @param string $uniarr The input array of characters.
</span></span><span id="5189" class="l"><a href="#5189"> 5189: </a><span class="php-comment">         * @param int $start the starting element of $strarr.
</span></span><span id="5190" class="l"><a href="#5190"> 5190: </a><span class="php-comment">         * @param int $end first element that will not be returned.
</span></span><span id="5191" class="l"><a href="#5191"> 5191: </a><span class="php-comment">         * @return Return part of a string
</span></span><span id="5192" class="l"><a href="#5192"> 5192: </a><span class="php-comment">         * @access public
</span></span><span id="5193" class="l"><a href="#5193"> 5193: </a><span class="php-comment">         * @since 4.5.037 (2009-04-07)
</span></span><span id="5194" class="l"><a href="#5194"> 5194: </a><span class="php-comment">         */</span>
</span><span id="5195" class="l"><a href="#5195"> 5195: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> UniArrSubString(<span class="php-var">$uniarr</span>, <span class="php-var">$start</span>=<span class="php-quote">''</span>, <span class="php-var">$end</span>=<span class="php-quote">''</span>) {
</span><span id="5196" class="l"><a href="#5196"> 5196: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$start</span>) == <span class="php-num">0</span>) {
</span><span id="5197" class="l"><a href="#5197"> 5197: </a>                <span class="php-var">$start</span> = <span class="php-num">0</span>;
</span><span id="5198" class="l"><a href="#5198"> 5198: </a>            }
</span><span id="5199" class="l"><a href="#5199"> 5199: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$end</span>) == <span class="php-num">0</span>) {
</span><span id="5200" class="l"><a href="#5200"> 5200: </a>                <span class="php-var">$end</span> = <span class="php-keyword2">count</span>(<span class="php-var">$uniarr</span>);
</span><span id="5201" class="l"><a href="#5201"> 5201: </a>            }
</span><span id="5202" class="l"><a href="#5202"> 5202: </a>            <span class="php-var">$string</span> = <span class="php-quote">''</span>;
</span><span id="5203" class="l"><a href="#5203"> 5203: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-var">$start</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$end</span>; ++<span class="php-var">$i</span>) {
</span><span id="5204" class="l"><a href="#5204"> 5204: </a>                <span class="php-var">$string</span> .= <span class="php-var">$uniarr</span>[<span class="php-var">$i</span>];
</span><span id="5205" class="l"><a href="#5205"> 5205: </a>            }
</span><span id="5206" class="l"><a href="#5206"> 5206: </a>            <span class="php-keyword1">return</span> <span class="php-var">$string</span>;
</span><span id="5207" class="l"><a href="#5207"> 5207: </a>        }
</span><span id="5208" class="l"><a href="#5208"> 5208: </a>
</span><span id="5209" class="l"><a href="#5209"> 5209: </a>        <span class="php-comment">/**
</span></span><span id="5210" class="l"><a href="#5210"> 5210: </a><span class="php-comment">         * Convert an array of UTF8 values to array of unicode characters
</span></span><span id="5211" class="l"><a href="#5211"> 5211: </a><span class="php-comment">         * @param string $ta The input array of UTF8 values.
</span></span><span id="5212" class="l"><a href="#5212"> 5212: </a><span class="php-comment">         * @return Return array of unicode characters
</span></span><span id="5213" class="l"><a href="#5213"> 5213: </a><span class="php-comment">         * @access public
</span></span><span id="5214" class="l"><a href="#5214"> 5214: </a><span class="php-comment">         * @since 4.5.037 (2009-04-07)
</span></span><span id="5215" class="l"><a href="#5215"> 5215: </a><span class="php-comment">         */</span>
</span><span id="5216" class="l"><a href="#5216"> 5216: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> UTF8ArrayToUniArray(<span class="php-var">$ta</span>) {
</span><span id="5217" class="l"><a href="#5217"> 5217: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">array_map</span>(<span class="php-keyword1">array</span>(<span class="php-var">$this</span>, <span class="php-quote">'unichr'</span>), <span class="php-var">$ta</span>);
</span><span id="5218" class="l"><a href="#5218"> 5218: </a>        }
</span><span id="5219" class="l"><a href="#5219"> 5219: </a>
</span><span id="5220" class="l"><a href="#5220"> 5220: </a>        <span class="php-comment">/**
</span></span><span id="5221" class="l"><a href="#5221"> 5221: </a><span class="php-comment">         * Returns the unicode caracter specified by UTF-8 value
</span></span><span id="5222" class="l"><a href="#5222"> 5222: </a><span class="php-comment">         * @param int $c UTF-8 value
</span></span><span id="5223" class="l"><a href="#5223"> 5223: </a><span class="php-comment">         * @return Returns the specified character.
</span></span><span id="5224" class="l"><a href="#5224"> 5224: </a><span class="php-comment">         * @author Miguel Perez, Nicola Asuni
</span></span><span id="5225" class="l"><a href="#5225"> 5225: </a><span class="php-comment">         * @access public
</span></span><span id="5226" class="l"><a href="#5226"> 5226: </a><span class="php-comment">         * @since 2.3.000 (2008-03-05)
</span></span><span id="5227" class="l"><a href="#5227"> 5227: </a><span class="php-comment">         */</span>
</span><span id="5228" class="l"><a href="#5228"> 5228: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> unichr(<span class="php-var">$c</span>) {
</span><span id="5229" class="l"><a href="#5229"> 5229: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="5230" class="l"><a href="#5230"> 5230: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">chr</span>(<span class="php-var">$c</span>);
</span><span id="5231" class="l"><a href="#5231"> 5231: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$c</span> &lt;= <span class="php-num">0x7F</span>) {
</span><span id="5232" class="l"><a href="#5232"> 5232: </a>                <span class="php-comment">// one byte</span>
</span><span id="5233" class="l"><a href="#5233"> 5233: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">chr</span>(<span class="php-var">$c</span>);
</span><span id="5234" class="l"><a href="#5234"> 5234: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$c</span> &lt;= <span class="php-num">0x7FF</span>) {
</span><span id="5235" class="l"><a href="#5235"> 5235: </a>                <span class="php-comment">// two bytes</span>
</span><span id="5236" class="l"><a href="#5236"> 5236: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">chr</span>(<span class="php-num">0xC0</span> | <span class="php-var">$c</span> &gt;&gt; <span class="php-num">6</span>).<span class="php-keyword2">chr</span>(<span class="php-num">0x80</span> | <span class="php-var">$c</span> &amp; <span class="php-num">0x3F</span>);
</span><span id="5237" class="l"><a href="#5237"> 5237: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$c</span> &lt;= <span class="php-num">0xFFFF</span>) {
</span><span id="5238" class="l"><a href="#5238"> 5238: </a>                <span class="php-comment">// three bytes</span>
</span><span id="5239" class="l"><a href="#5239"> 5239: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">chr</span>(<span class="php-num">0xE0</span> | <span class="php-var">$c</span> &gt;&gt; <span class="php-num">12</span>).<span class="php-keyword2">chr</span>(<span class="php-num">0x80</span> | <span class="php-var">$c</span> &gt;&gt; <span class="php-num">6</span> &amp; <span class="php-num">0x3F</span>).<span class="php-keyword2">chr</span>(<span class="php-num">0x80</span> | <span class="php-var">$c</span> &amp; <span class="php-num">0x3F</span>);
</span><span id="5240" class="l"><a href="#5240"> 5240: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$c</span> &lt;= <span class="php-num">0x10FFFF</span>) {
</span><span id="5241" class="l"><a href="#5241"> 5241: </a>                <span class="php-comment">// four bytes</span>
</span><span id="5242" class="l"><a href="#5242"> 5242: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">chr</span>(<span class="php-num">0xF0</span> | <span class="php-var">$c</span> &gt;&gt; <span class="php-num">18</span>).<span class="php-keyword2">chr</span>(<span class="php-num">0x80</span> | <span class="php-var">$c</span> &gt;&gt; <span class="php-num">12</span> &amp; <span class="php-num">0x3F</span>).<span class="php-keyword2">chr</span>(<span class="php-num">0x80</span> | <span class="php-var">$c</span> &gt;&gt; <span class="php-num">6</span> &amp; <span class="php-num">0x3F</span>).<span class="php-keyword2">chr</span>(<span class="php-num">0x80</span> | <span class="php-var">$c</span> &amp; <span class="php-num">0x3F</span>);
</span><span id="5243" class="l"><a href="#5243"> 5243: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5244" class="l"><a href="#5244"> 5244: </a>                <span class="php-keyword1">return</span> <span class="php-quote">''</span>;
</span><span id="5245" class="l"><a href="#5245"> 5245: </a>            }
</span><span id="5246" class="l"><a href="#5246"> 5246: </a>        }
</span><span id="5247" class="l"><a href="#5247"> 5247: </a>
</span><span id="5248" class="l"><a href="#5248"> 5248: </a>        <span class="php-comment">/**
</span></span><span id="5249" class="l"><a href="#5249"> 5249: </a><span class="php-comment">         * Return the image type given the file name or array returned by getimagesize() function.
</span></span><span id="5250" class="l"><a href="#5250"> 5250: </a><span class="php-comment">         * @param string $imgfile image file name
</span></span><span id="5251" class="l"><a href="#5251"> 5251: </a><span class="php-comment">         * @param array $iminfo array of image information returned by getimagesize() function.
</span></span><span id="5252" class="l"><a href="#5252"> 5252: </a><span class="php-comment">         * @return string image type
</span></span><span id="5253" class="l"><a href="#5253"> 5253: </a><span class="php-comment">         * @since 4.8.017 (2009-11-27)
</span></span><span id="5254" class="l"><a href="#5254"> 5254: </a><span class="php-comment">         */</span>
</span><span id="5255" class="l"><a href="#5255"> 5255: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getImageFileType(<span class="php-var">$imgfile</span>, <span class="php-var">$iminfo</span>=<span class="php-keyword1">array</span>()) {
</span><span id="5256" class="l"><a href="#5256"> 5256: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$iminfo</span>[<span class="php-quote">'mime'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$iminfo</span>[<span class="php-quote">'mime'</span>])) {
</span><span id="5257" class="l"><a href="#5257"> 5257: </a>                <span class="php-var">$mime</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">'/'</span>, <span class="php-var">$iminfo</span>[<span class="php-quote">'mime'</span>]);
</span><span id="5258" class="l"><a href="#5258"> 5258: </a>                <span class="php-keyword1">if</span> ((<span class="php-keyword2">count</span>(<span class="php-var">$mime</span>) &gt; <span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$mime</span>[<span class="php-num">0</span>] == <span class="php-quote">'image'</span>) <span class="php-keyword1">AND</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$mime</span>[<span class="php-num">1</span>]))) {
</span><span id="5259" class="l"><a href="#5259"> 5259: </a>                    <span class="php-keyword1">return</span> <span class="php-keyword2">trim</span>(<span class="php-var">$mime</span>[<span class="php-num">1</span>]);
</span><span id="5260" class="l"><a href="#5260"> 5260: </a>                }
</span><span id="5261" class="l"><a href="#5261"> 5261: </a>            }
</span><span id="5262" class="l"><a href="#5262"> 5262: </a>            <span class="php-var">$type</span> = <span class="php-quote">''</span>;
</span><span id="5263" class="l"><a href="#5263"> 5263: </a>            <span class="php-var">$fileinfo</span> = <span class="php-keyword2">pathinfo</span>(<span class="php-var">$imgfile</span>);
</span><span id="5264" class="l"><a href="#5264"> 5264: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$fileinfo</span>[<span class="php-quote">'extension'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fileinfo</span>[<span class="php-quote">'extension'</span>]))) {
</span><span id="5265" class="l"><a href="#5265"> 5265: </a>                <span class="php-var">$type</span> = <span class="php-keyword2">strtolower</span>(<span class="php-keyword2">trim</span>(<span class="php-var">$fileinfo</span>[<span class="php-quote">'extension'</span>]));
</span><span id="5266" class="l"><a href="#5266"> 5266: </a>            }
</span><span id="5267" class="l"><a href="#5267"> 5267: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$type</span> == <span class="php-quote">'jpg'</span>) {
</span><span id="5268" class="l"><a href="#5268"> 5268: </a>                <span class="php-var">$type</span> = <span class="php-quote">'jpeg'</span>;
</span><span id="5269" class="l"><a href="#5269"> 5269: </a>            }
</span><span id="5270" class="l"><a href="#5270"> 5270: </a>            <span class="php-keyword1">return</span> <span class="php-var">$type</span>;
</span><span id="5271" class="l"><a href="#5271"> 5271: </a>        }
</span><span id="5272" class="l"><a href="#5272"> 5272: </a>
</span><span id="5273" class="l"><a href="#5273"> 5273: </a>        <span class="php-comment">/**
</span></span><span id="5274" class="l"><a href="#5274"> 5274: </a><span class="php-comment">         * Puts an image in the page.
</span></span><span id="5275" class="l"><a href="#5275"> 5275: </a><span class="php-comment">         * The upper-left corner must be given.
</span></span><span id="5276" class="l"><a href="#5276"> 5276: </a><span class="php-comment">         * The dimensions can be specified in different ways:&lt;ul&gt;
</span></span><span id="5277" class="l"><a href="#5277"> 5277: </a><span class="php-comment">         * &lt;li&gt;explicit width and height (expressed in user unit)&lt;/li&gt;
</span></span><span id="5278" class="l"><a href="#5278"> 5278: </a><span class="php-comment">         * &lt;li&gt;one explicit dimension, the other being calculated automatically in order to keep the original proportions&lt;/li&gt;
</span></span><span id="5279" class="l"><a href="#5279"> 5279: </a><span class="php-comment">         * &lt;li&gt;no explicit dimension, in which case the image is put at 72 dpi&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="5280" class="l"><a href="#5280"> 5280: </a><span class="php-comment">         * Supported formats are JPEG and PNG images whitout GD library and all images supported by GD: GD, GD2, GD2PART, GIF, JPEG, PNG, BMP, XBM, XPM;
</span></span><span id="5281" class="l"><a href="#5281"> 5281: </a><span class="php-comment">         * The format can be specified explicitly or inferred from the file extension.&lt;br /&gt;
</span></span><span id="5282" class="l"><a href="#5282"> 5282: </a><span class="php-comment">         * It is possible to put a link on the image.&lt;br /&gt;
</span></span><span id="5283" class="l"><a href="#5283"> 5283: </a><span class="php-comment">         * Remark: if an image is used several times, only one copy will be embedded in the file.&lt;br /&gt;
</span></span><span id="5284" class="l"><a href="#5284"> 5284: </a><span class="php-comment">         * @param string $file Name of the file containing the image.
</span></span><span id="5285" class="l"><a href="#5285"> 5285: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner.
</span></span><span id="5286" class="l"><a href="#5286"> 5286: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner.
</span></span><span id="5287" class="l"><a href="#5287"> 5287: </a><span class="php-comment">         * @param float $w Width of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="5288" class="l"><a href="#5288"> 5288: </a><span class="php-comment">         * @param float $h Height of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="5289" class="l"><a href="#5289"> 5289: </a><span class="php-comment">         * @param string $type Image format. Possible values are (case insensitive): JPEG and PNG (whitout GD library) and all images supported by GD: GD, GD2, GD2PART, GIF, JPEG, PNG, BMP, XBM, XPM;. If not specified, the type is inferred from the file extension.
</span></span><span id="5290" class="l"><a href="#5290"> 5290: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink().
</span></span><span id="5291" class="l"><a href="#5291"> 5291: </a><span class="php-comment">         * @param string $align Indicates the alignment of the pointer next to image insertion relative to image height. The value can be:&lt;ul&gt;&lt;li&gt;T: top-right for LTR or top-left for RTL&lt;/li&gt;&lt;li&gt;M: middle-right for LTR or middle-left for RTL&lt;/li&gt;&lt;li&gt;B: bottom-right for LTR or bottom-left for RTL&lt;/li&gt;&lt;li&gt;N: next line&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="5292" class="l"><a href="#5292"> 5292: </a><span class="php-comment">         * @param mixed $resize If true resize (reduce) the image to fit $w and $h (requires GD or ImageMagick library); if false do not resize; if 2 force resize in all cases (upscaling and downscaling).
</span></span><span id="5293" class="l"><a href="#5293"> 5293: </a><span class="php-comment">         * @param int $dpi dot-per-inch resolution used on resize
</span></span><span id="5294" class="l"><a href="#5294"> 5294: </a><span class="php-comment">         * @param string $palign Allows to center or align the image on the current line. Possible values are:&lt;ul&gt;&lt;li&gt;L : left align&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;R : right align&lt;/li&gt;&lt;li&gt;'' : empty string : left for LTR or right for RTL&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="5295" class="l"><a href="#5295"> 5295: </a><span class="php-comment">         * @param boolean $ismask true if this image is a mask, false otherwise
</span></span><span id="5296" class="l"><a href="#5296"> 5296: </a><span class="php-comment">         * @param mixed $imgmask image object returned by this function or false
</span></span><span id="5297" class="l"><a href="#5297"> 5297: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the image. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="5298" class="l"><a href="#5298"> 5298: </a><span class="php-comment">         * @param boolean $fitbox If true scale image dimensions proportionally to fit within the ($w, $h) box.
</span></span><span id="5299" class="l"><a href="#5299"> 5299: </a><span class="php-comment">         * @param boolean $hidden if true do not display the image.
</span></span><span id="5300" class="l"><a href="#5300"> 5300: </a><span class="php-comment">         * @param boolean $fitonpage if true the image is resized to not exceed page dimensions.
</span></span><span id="5301" class="l"><a href="#5301"> 5301: </a><span class="php-comment">         * @return image information
</span></span><span id="5302" class="l"><a href="#5302"> 5302: </a><span class="php-comment">         * @access public
</span></span><span id="5303" class="l"><a href="#5303"> 5303: </a><span class="php-comment">         * @since 1.1
</span></span><span id="5304" class="l"><a href="#5304"> 5304: </a><span class="php-comment">         */</span>
</span><span id="5305" class="l"><a href="#5305"> 5305: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Image(<span class="php-var">$file</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$w</span>=<span class="php-num">0</span>, <span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$type</span>=<span class="php-quote">''</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$resize</span>=<span class="php-keyword1">false</span>, <span class="php-var">$dpi</span>=<span class="php-num">300</span>, <span class="php-var">$palign</span>=<span class="php-quote">''</span>, <span class="php-var">$ismask</span>=<span class="php-keyword1">false</span>, <span class="php-var">$imgmask</span>=<span class="php-keyword1">false</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$fitbox</span>=<span class="php-keyword1">false</span>, <span class="php-var">$hidden</span>=<span class="php-keyword1">false</span>, <span class="php-var">$fitonpage</span>=<span class="php-keyword1">false</span>) {
</span><span id="5306" class="l"><a href="#5306"> 5306: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="5307" class="l"><a href="#5307"> 5307: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="5308" class="l"><a href="#5308"> 5308: </a>            }
</span><span id="5309" class="l"><a href="#5309"> 5309: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="5310" class="l"><a href="#5310"> 5310: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="5311" class="l"><a href="#5311"> 5311: </a>            }
</span><span id="5312" class="l"><a href="#5312"> 5312: </a>            <span class="php-comment">// get image dimensions</span>
</span><span id="5313" class="l"><a href="#5313"> 5313: </a>            <span class="php-var">$imsize</span> = @<span class="php-keyword2">getimagesize</span>(<span class="php-var">$file</span>);
</span><span id="5314" class="l"><a href="#5314"> 5314: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$imsize</span> === <span class="php-keyword1">FALSE</span>) {
</span><span id="5315" class="l"><a href="#5315"> 5315: </a>                <span class="php-comment">// encode spaces on filename</span>
</span><span id="5316" class="l"><a href="#5316"> 5316: </a>                <span class="php-var">$file</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">' '</span>, <span class="php-quote">'%20'</span>, <span class="php-var">$file</span>);
</span><span id="5317" class="l"><a href="#5317"> 5317: </a>                <span class="php-var">$imsize</span> = @<span class="php-keyword2">getimagesize</span>(<span class="php-var">$file</span>);
</span><span id="5318" class="l"><a href="#5318"> 5318: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$imsize</span> === <span class="php-keyword1">FALSE</span>) {
</span><span id="5319" class="l"><a href="#5319"> 5319: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$w</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$h</span> &gt; <span class="php-num">0</span>)) {
</span><span id="5320" class="l"><a href="#5320"> 5320: </a>                        <span class="php-var">$pw</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$w</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;pdfunit, <span class="php-keyword1">true</span>) * <span class="php-var">$this</span>-&gt;imgscale * <span class="php-var">$this</span>-&gt;k;
</span><span id="5321" class="l"><a href="#5321"> 5321: </a>                        <span class="php-var">$ph</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$h</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;pdfunit, <span class="php-keyword1">true</span>) * <span class="php-var">$this</span>-&gt;imgscale * <span class="php-var">$this</span>-&gt;k;
</span><span id="5322" class="l"><a href="#5322"> 5322: </a>                        <span class="php-var">$imsize</span> = <span class="php-keyword1">array</span>(<span class="php-var">$pw</span>, <span class="php-var">$ph</span>);
</span><span id="5323" class="l"><a href="#5323"> 5323: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="5324" class="l"><a href="#5324"> 5324: </a>                        <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'[Image] Unable to get image width and height: '</span>.<span class="php-var">$file</span>);
</span><span id="5325" class="l"><a href="#5325"> 5325: </a>                    }
</span><span id="5326" class="l"><a href="#5326"> 5326: </a>                }
</span><span id="5327" class="l"><a href="#5327"> 5327: </a>            }
</span><span id="5328" class="l"><a href="#5328"> 5328: </a>            <span class="php-comment">// get original image width and height in pixels</span>
</span><span id="5329" class="l"><a href="#5329"> 5329: </a>            <span class="php-keyword1">list</span>(<span class="php-var">$pixw</span>, <span class="php-var">$pixh</span>) = <span class="php-var">$imsize</span>;
</span><span id="5330" class="l"><a href="#5330"> 5330: </a>            <span class="php-comment">// calculate image width and height on document</span>
</span><span id="5331" class="l"><a href="#5331"> 5331: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="5332" class="l"><a href="#5332"> 5332: </a>                <span class="php-comment">// convert image size to document unit</span>
</span><span id="5333" class="l"><a href="#5333"> 5333: </a>                <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;pixelsToUnits(<span class="php-var">$pixw</span>);
</span><span id="5334" class="l"><a href="#5334"> 5334: </a>                <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;pixelsToUnits(<span class="php-var">$pixh</span>);
</span><span id="5335" class="l"><a href="#5335"> 5335: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>) {
</span><span id="5336" class="l"><a href="#5336"> 5336: </a>                <span class="php-var">$w</span> = <span class="php-var">$h</span> * <span class="php-var">$pixw</span> / <span class="php-var">$pixh</span>;
</span><span id="5337" class="l"><a href="#5337"> 5337: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>) {
</span><span id="5338" class="l"><a href="#5338"> 5338: </a>                <span class="php-var">$h</span> = <span class="php-var">$w</span> * <span class="php-var">$pixh</span> / <span class="php-var">$pixw</span>;
</span><span id="5339" class="l"><a href="#5339"> 5339: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$fitbox</span> <span class="php-keyword1">AND</span> (<span class="php-var">$w</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$h</span> &gt; <span class="php-num">0</span>)) {
</span><span id="5340" class="l"><a href="#5340"> 5340: </a>                <span class="php-comment">// scale image dimensions proportionally to fit within the ($w, $h) box</span>
</span><span id="5341" class="l"><a href="#5341"> 5341: </a>                <span class="php-keyword1">if</span> (((<span class="php-var">$w</span> * <span class="php-var">$pixh</span>) / (<span class="php-var">$h</span> * <span class="php-var">$pixw</span>)) &lt; <span class="php-num">1</span>) {
</span><span id="5342" class="l"><a href="#5342"> 5342: </a>                    <span class="php-var">$h</span> = <span class="php-var">$w</span> * <span class="php-var">$pixh</span> / <span class="php-var">$pixw</span>;
</span><span id="5343" class="l"><a href="#5343"> 5343: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5344" class="l"><a href="#5344"> 5344: </a>                    <span class="php-var">$w</span> = <span class="php-var">$h</span> * <span class="php-var">$pixw</span> / <span class="php-var">$pixh</span>;
</span><span id="5345" class="l"><a href="#5345"> 5345: </a>                }
</span><span id="5346" class="l"><a href="#5346"> 5346: </a>            }
</span><span id="5347" class="l"><a href="#5347"> 5347: </a>            <span class="php-comment">// Check whether we need a new page first as this does not fit</span>
</span><span id="5348" class="l"><a href="#5348"> 5348: </a>            <span class="php-var">$prev_x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="5349" class="l"><a href="#5349"> 5349: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$h</span>, <span class="php-var">$y</span>)) {
</span><span id="5350" class="l"><a href="#5350"> 5350: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="5351" class="l"><a href="#5351"> 5351: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5352" class="l"><a href="#5352"> 5352: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$prev_x</span> - <span class="php-var">$this</span>-&gt;x);
</span><span id="5353" class="l"><a href="#5353"> 5353: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5354" class="l"><a href="#5354"> 5354: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$this</span>-&gt;x - <span class="php-var">$prev_x</span>);
</span><span id="5355" class="l"><a href="#5355"> 5355: </a>                }
</span><span id="5356" class="l"><a href="#5356"> 5356: </a>            }
</span><span id="5357" class="l"><a href="#5357"> 5357: </a>            <span class="php-comment">// resize image to be contained on a single page</span>
</span><span id="5358" class="l"><a href="#5358"> 5358: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$fitonpage</span>) {
</span><span id="5359" class="l"><a href="#5359"> 5359: </a>                <span class="php-var">$ratio_wh</span> = <span class="php-var">$w</span> / <span class="php-var">$h</span>;
</span><span id="5360" class="l"><a href="#5360"> 5360: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$y</span> + <span class="php-var">$h</span>) &gt; <span class="php-var">$this</span>-&gt;PageBreakTrigger) {
</span><span id="5361" class="l"><a href="#5361"> 5361: </a>                    <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;PageBreakTrigger - <span class="php-var">$y</span>;
</span><span id="5362" class="l"><a href="#5362"> 5362: </a>                    <span class="php-var">$w</span> = <span class="php-var">$h</span> * <span class="php-var">$ratio_wh</span>;
</span><span id="5363" class="l"><a href="#5363"> 5363: </a>                }
</span><span id="5364" class="l"><a href="#5364"> 5364: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$x</span> + <span class="php-var">$w</span>) &gt; (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin)) {
</span><span id="5365" class="l"><a href="#5365"> 5365: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$x</span>;
</span><span id="5366" class="l"><a href="#5366"> 5366: </a>                    <span class="php-var">$h</span> = <span class="php-var">$w</span> / <span class="php-var">$ratio_wh</span>;
</span><span id="5367" class="l"><a href="#5367"> 5367: </a>                }
</span><span id="5368" class="l"><a href="#5368"> 5368: </a>            }
</span><span id="5369" class="l"><a href="#5369"> 5369: </a>            <span class="php-comment">// calculate new minimum dimensions in pixels</span>
</span><span id="5370" class="l"><a href="#5370"> 5370: </a>            <span class="php-var">$neww</span> = <span class="php-keyword2">round</span>(<span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k * <span class="php-var">$dpi</span> / <span class="php-var">$this</span>-&gt;dpi);
</span><span id="5371" class="l"><a href="#5371"> 5371: </a>            <span class="php-var">$newh</span> = <span class="php-keyword2">round</span>(<span class="php-var">$h</span> * <span class="php-var">$this</span>-&gt;k * <span class="php-var">$dpi</span> / <span class="php-var">$this</span>-&gt;dpi);
</span><span id="5372" class="l"><a href="#5372"> 5372: </a>            <span class="php-comment">// check if resize is necessary (resize is used only to reduce the image)</span>
</span><span id="5373" class="l"><a href="#5373"> 5373: </a>            <span class="php-var">$newsize</span> = (<span class="php-var">$neww</span> * <span class="php-var">$newh</span>);
</span><span id="5374" class="l"><a href="#5374"> 5374: </a>            <span class="php-var">$pixsize</span> = (<span class="php-var">$pixw</span> * <span class="php-var">$pixh</span>);
</span><span id="5375" class="l"><a href="#5375"> 5375: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">intval</span>(<span class="php-var">$resize</span>) == <span class="php-num">2</span>) {
</span><span id="5376" class="l"><a href="#5376"> 5376: </a>                <span class="php-var">$resize</span> = <span class="php-keyword1">true</span>;
</span><span id="5377" class="l"><a href="#5377"> 5377: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$newsize</span> &gt;= <span class="php-var">$pixsize</span>) {
</span><span id="5378" class="l"><a href="#5378"> 5378: </a>                <span class="php-var">$resize</span> = <span class="php-keyword1">false</span>;
</span><span id="5379" class="l"><a href="#5379"> 5379: </a>            }
</span><span id="5380" class="l"><a href="#5380"> 5380: </a>            <span class="php-comment">// check if image has been already added on document</span>
</span><span id="5381" class="l"><a href="#5381"> 5381: </a>            <span class="php-var">$newimage</span> = <span class="php-keyword1">true</span>;
</span><span id="5382" class="l"><a href="#5382"> 5382: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$file</span>, <span class="php-var">$this</span>-&gt;imagekeys)) {
</span><span id="5383" class="l"><a href="#5383"> 5383: </a>                <span class="php-var">$newimage</span> = <span class="php-keyword1">false</span>;
</span><span id="5384" class="l"><a href="#5384"> 5384: </a>                <span class="php-comment">// get existing image data</span>
</span><span id="5385" class="l"><a href="#5385"> 5385: </a>                <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;getImageBuffer(<span class="php-var">$file</span>);
</span><span id="5386" class="l"><a href="#5386"> 5386: </a>                <span class="php-comment">// check if the newer image is larger</span>
</span><span id="5387" class="l"><a href="#5387"> 5387: </a>                <span class="php-var">$oldsize</span> = (<span class="php-var">$info</span>[<span class="php-quote">'w'</span>] * <span class="php-var">$info</span>[<span class="php-quote">'h'</span>]);
</span><span id="5388" class="l"><a href="#5388"> 5388: </a>                <span class="php-keyword1">if</span> (((<span class="php-var">$oldsize</span> &lt; <span class="php-var">$newsize</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$resize</span>)) <span class="php-keyword1">OR</span> ((<span class="php-var">$oldsize</span> &lt; <span class="php-var">$pixsize</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$resize</span>))) {
</span><span id="5389" class="l"><a href="#5389"> 5389: </a>                    <span class="php-var">$newimage</span> = <span class="php-keyword1">true</span>;
</span><span id="5390" class="l"><a href="#5390"> 5390: </a>                }
</span><span id="5391" class="l"><a href="#5391"> 5391: </a>            }
</span><span id="5392" class="l"><a href="#5392"> 5392: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$newimage</span>) {
</span><span id="5393" class="l"><a href="#5393"> 5393: </a>                <span class="php-comment">//First use of image, get info</span>
</span><span id="5394" class="l"><a href="#5394"> 5394: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$type</span> == <span class="php-quote">''</span>) {
</span><span id="5395" class="l"><a href="#5395"> 5395: </a>                    <span class="php-var">$type</span> = <span class="php-var">$this</span>-&gt;getImageFileType(<span class="php-var">$file</span>, <span class="php-var">$imsize</span>);
</span><span id="5396" class="l"><a href="#5396"> 5396: </a>                }
</span><span id="5397" class="l"><a href="#5397"> 5397: </a>                <span class="php-var">$mqr</span> = <span class="php-var">$this</span>-&gt;get_mqr();
</span><span id="5398" class="l"><a href="#5398"> 5398: </a>                <span class="php-var">$this</span>-&gt;set_mqr(<span class="php-keyword1">false</span>);
</span><span id="5399" class="l"><a href="#5399"> 5399: </a>                <span class="php-comment">// Specific image handlers</span>
</span><span id="5400" class="l"><a href="#5400"> 5400: </a>                <span class="php-var">$mtd</span> = <span class="php-quote">'_parse'</span>.<span class="php-var">$type</span>;
</span><span id="5401" class="l"><a href="#5401"> 5401: </a>                <span class="php-comment">// GD image handler function</span>
</span><span id="5402" class="l"><a href="#5402"> 5402: </a>                <span class="php-var">$gdfunction</span> = <span class="php-quote">'imagecreatefrom'</span>.<span class="php-var">$type</span>;
</span><span id="5403" class="l"><a href="#5403"> 5403: </a>                <span class="php-var">$info</span> = <span class="php-keyword1">false</span>;
</span><span id="5404" class="l"><a href="#5404"> 5404: </a>                <span class="php-keyword1">if</span> ((<span class="php-keyword2">method_exists</span>(<span class="php-var">$this</span>, <span class="php-var">$mtd</span>)) <span class="php-keyword1">AND</span> (!(<span class="php-var">$resize</span> <span class="php-keyword1">AND</span> <span class="php-keyword2">function_exists</span>(<span class="php-var">$gdfunction</span>)))) {
</span><span id="5405" class="l"><a href="#5405"> 5405: </a>                    <span class="php-comment">// TCPDF image functions</span>
</span><span id="5406" class="l"><a href="#5406"> 5406: </a>                    <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;<span class="php-var">$mtd</span>(<span class="php-var">$file</span>);
</span><span id="5407" class="l"><a href="#5407"> 5407: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$info</span> == <span class="php-quote">'pngalpha'</span>) {
</span><span id="5408" class="l"><a href="#5408"> 5408: </a>                        <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;ImagePngAlpha(<span class="php-var">$file</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'PNG'</span>, <span class="php-var">$link</span>, <span class="php-var">$align</span>, <span class="php-var">$resize</span>, <span class="php-var">$dpi</span>, <span class="php-var">$palign</span>);
</span><span id="5409" class="l"><a href="#5409"> 5409: </a>                    }
</span><span id="5410" class="l"><a href="#5410"> 5410: </a>                }
</span><span id="5411" class="l"><a href="#5411"> 5411: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$info</span>) {
</span><span id="5412" class="l"><a href="#5412"> 5412: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">function_exists</span>(<span class="php-var">$gdfunction</span>)) {
</span><span id="5413" class="l"><a href="#5413"> 5413: </a>                        <span class="php-comment">// GD library</span>
</span><span id="5414" class="l"><a href="#5414"> 5414: </a>                        <span class="php-var">$img</span> = <span class="php-var">$gdfunction</span>(<span class="php-var">$file</span>);
</span><span id="5415" class="l"><a href="#5415"> 5415: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$resize</span>) {
</span><span id="5416" class="l"><a href="#5416"> 5416: </a>                            <span class="php-var">$imgr</span> = <span class="php-keyword2">imagecreatetruecolor</span>(<span class="php-var">$neww</span>, <span class="php-var">$newh</span>);
</span><span id="5417" class="l"><a href="#5417"> 5417: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$type</span> == <span class="php-quote">'gif'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$type</span> == <span class="php-quote">'png'</span>)) {
</span><span id="5418" class="l"><a href="#5418"> 5418: </a>                                <span class="php-var">$imgr</span> = <span class="php-var">$this</span>-&gt;_setGDImageTransparency(<span class="php-var">$imgr</span>, <span class="php-var">$img</span>);
</span><span id="5419" class="l"><a href="#5419"> 5419: </a>                            }
</span><span id="5420" class="l"><a href="#5420"> 5420: </a>                            <span class="php-keyword2">imagecopyresampled</span>(<span class="php-var">$imgr</span>, <span class="php-var">$img</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$neww</span>, <span class="php-var">$newh</span>, <span class="php-var">$pixw</span>, <span class="php-var">$pixh</span>);
</span><span id="5421" class="l"><a href="#5421"> 5421: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$type</span> == <span class="php-quote">'gif'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$type</span> == <span class="php-quote">'png'</span>)) {
</span><span id="5422" class="l"><a href="#5422"> 5422: </a>                                <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;_toPNG(<span class="php-var">$imgr</span>);
</span><span id="5423" class="l"><a href="#5423"> 5423: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="5424" class="l"><a href="#5424"> 5424: </a>                                <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;_toJPEG(<span class="php-var">$imgr</span>);
</span><span id="5425" class="l"><a href="#5425"> 5425: </a>                            }
</span><span id="5426" class="l"><a href="#5426"> 5426: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="5427" class="l"><a href="#5427"> 5427: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$type</span> == <span class="php-quote">'gif'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$type</span> == <span class="php-quote">'png'</span>)) {
</span><span id="5428" class="l"><a href="#5428"> 5428: </a>                                <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;_toPNG(<span class="php-var">$img</span>);
</span><span id="5429" class="l"><a href="#5429"> 5429: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="5430" class="l"><a href="#5430"> 5430: </a>                                <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;_toJPEG(<span class="php-var">$img</span>);
</span><span id="5431" class="l"><a href="#5431"> 5431: </a>                            }
</span><span id="5432" class="l"><a href="#5432"> 5432: </a>                        }
</span><span id="5433" class="l"><a href="#5433"> 5433: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">extension_loaded</span>(<span class="php-quote">'imagick'</span>)) {
</span><span id="5434" class="l"><a href="#5434"> 5434: </a>                        <span class="php-comment">// ImageMagick library</span>
</span><span id="5435" class="l"><a href="#5435"> 5435: </a>                        <span class="php-var">$img</span> = <span class="php-keyword1">new</span> Imagick();
</span><span id="5436" class="l"><a href="#5436"> 5436: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$type</span> == <span class="php-quote">'SVG'</span>) {
</span><span id="5437" class="l"><a href="#5437"> 5437: </a>                            <span class="php-comment">// get SBG file content</span>
</span><span id="5438" class="l"><a href="#5438"> 5438: </a>                            <span class="php-var">$svgimg</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$file</span>);
</span><span id="5439" class="l"><a href="#5439"> 5439: </a>                            <span class="php-comment">// get width and height</span>
</span><span id="5440" class="l"><a href="#5440"> 5440: </a>                            <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="5441" class="l"><a href="#5441"> 5441: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/&lt;svg([^\&gt;]*)&gt;/si'</span>, <span class="php-var">$svgimg</span>, <span class="php-var">$regs</span>)) {
</span><span id="5442" class="l"><a href="#5442"> 5442: </a>                                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="5443" class="l"><a href="#5443"> 5443: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+width[\s]*=[\s]*&quot;([^&quot;]*)&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="5444" class="l"><a href="#5444"> 5444: </a>                                    <span class="php-var">$ow</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tmp</span>[<span class="php-num">1</span>], <span class="php-num">1</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>) * <span class="php-var">$dpi</span> / <span class="php-num">72</span>;
</span><span id="5445" class="l"><a href="#5445"> 5445: </a>                                    <span class="php-var">$svgimg</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]+width[\s]*=[\s]*&quot;[^&quot;]*&quot;/si'</span>, <span class="php-quote">' width=&quot;'</span>.<span class="php-var">$ow</span>.<span class="php-var">$this</span>-&gt;pdfunit.<span class="php-quote">'&quot;'</span>, <span class="php-var">$svgimg</span>);
</span><span id="5446" class="l"><a href="#5446"> 5446: </a>                                }
</span><span id="5447" class="l"><a href="#5447"> 5447: </a>                                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="5448" class="l"><a href="#5448"> 5448: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+height[\s]*=[\s]*&quot;([^&quot;]*)&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="5449" class="l"><a href="#5449"> 5449: </a>                                    <span class="php-var">$oh</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tmp</span>[<span class="php-num">1</span>], <span class="php-num">1</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>) * <span class="php-var">$dpi</span> / <span class="php-num">72</span>;
</span><span id="5450" class="l"><a href="#5450"> 5450: </a>                                    <span class="php-var">$svgimg</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]+height[\s]*=[\s]*&quot;[^&quot;]*&quot;/si'</span>, <span class="php-quote">' height=&quot;'</span>.<span class="php-var">$oh</span>.<span class="php-var">$this</span>-&gt;pdfunit.<span class="php-quote">'&quot;'</span>, <span class="php-var">$svgimg</span>);
</span><span id="5451" class="l"><a href="#5451"> 5451: </a>                                }
</span><span id="5452" class="l"><a href="#5452"> 5452: </a>                                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="5453" class="l"><a href="#5453"> 5453: </a>                                <span class="php-keyword1">if</span> (!<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+viewBox[\s]*=[\s]*&quot;[\s]*([0-9\.]+)[\s]+([0-9\.]+)[\s]+([0-9\.]+)[\s]+([0-9\.]+)[\s]*&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="5454" class="l"><a href="#5454"> 5454: </a>                                    <span class="php-var">$vbw</span> = <span class="php-var">$ow</span> * (<span class="php-num">72</span> / <span class="php-var">$dpi</span>) * <span class="php-var">$this</span>-&gt;imgscale * <span class="php-var">$this</span>-&gt;k;
</span><span id="5455" class="l"><a href="#5455"> 5455: </a>                                    <span class="php-var">$vbh</span> = <span class="php-var">$oh</span> * (<span class="php-num">72</span> / <span class="php-var">$dpi</span>) * <span class="php-var">$this</span>-&gt;imgscale * <span class="php-var">$this</span>-&gt;k;
</span><span id="5456" class="l"><a href="#5456"> 5456: </a>                                    <span class="php-var">$svgimg</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;svg/si'</span>, <span class="php-quote">'&lt;svg viewBox=&quot;0 0 '</span>.<span class="php-var">$vbw</span>.<span class="php-quote">' '</span>.<span class="php-var">$vbh</span>.<span class="php-quote">'&quot;'</span>, <span class="php-var">$svgimg</span>);
</span><span id="5457" class="l"><a href="#5457"> 5457: </a>                                }
</span><span id="5458" class="l"><a href="#5458"> 5458: </a>                            }
</span><span id="5459" class="l"><a href="#5459"> 5459: </a>                            <span class="php-var">$img</span>-&gt;readImageBlob(<span class="php-var">$svgimg</span>);
</span><span id="5460" class="l"><a href="#5460"> 5460: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="5461" class="l"><a href="#5461"> 5461: </a>                            <span class="php-var">$img</span>-&gt;readImage(<span class="php-var">$file</span>);
</span><span id="5462" class="l"><a href="#5462"> 5462: </a>                        }
</span><span id="5463" class="l"><a href="#5463"> 5463: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$resize</span>) {
</span><span id="5464" class="l"><a href="#5464"> 5464: </a>                            <span class="php-var">$img</span>-&gt;resizeImage(<span class="php-var">$neww</span>, <span class="php-var">$newh</span>, <span class="php-num">10</span>, <span class="php-num">1</span>, <span class="php-keyword1">false</span>);
</span><span id="5465" class="l"><a href="#5465"> 5465: </a>                        }
</span><span id="5466" class="l"><a href="#5466"> 5466: </a>                        <span class="php-var">$img</span>-&gt;setCompressionQuality(<span class="php-var">$this</span>-&gt;jpeg_quality);
</span><span id="5467" class="l"><a href="#5467"> 5467: </a>                        <span class="php-var">$img</span>-&gt;setImageFormat(<span class="php-quote">'jpeg'</span>);
</span><span id="5468" class="l"><a href="#5468"> 5468: </a>                        <span class="php-var">$tempname</span> = <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-quote">'jpg_'</span>);
</span><span id="5469" class="l"><a href="#5469"> 5469: </a>                        <span class="php-var">$img</span>-&gt;writeImage(<span class="php-var">$tempname</span>);
</span><span id="5470" class="l"><a href="#5470"> 5470: </a>                        <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;_parsejpeg(<span class="php-var">$tempname</span>);
</span><span id="5471" class="l"><a href="#5471"> 5471: </a>                        <span class="php-keyword2">unlink</span>(<span class="php-var">$tempname</span>);
</span><span id="5472" class="l"><a href="#5472"> 5472: </a>                        <span class="php-var">$img</span>-&gt;destroy();
</span><span id="5473" class="l"><a href="#5473"> 5473: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="5474" class="l"><a href="#5474"> 5474: </a>                        <span class="php-keyword1">return</span>;
</span><span id="5475" class="l"><a href="#5475"> 5475: </a>                    }
</span><span id="5476" class="l"><a href="#5476"> 5476: </a>                }
</span><span id="5477" class="l"><a href="#5477"> 5477: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$info</span> === <span class="php-keyword1">false</span>) {
</span><span id="5478" class="l"><a href="#5478"> 5478: </a>                    <span class="php-comment">//If false, we cannot process image</span>
</span><span id="5479" class="l"><a href="#5479"> 5479: </a>                    <span class="php-keyword1">return</span>;
</span><span id="5480" class="l"><a href="#5480"> 5480: </a>                }
</span><span id="5481" class="l"><a href="#5481"> 5481: </a>                <span class="php-var">$this</span>-&gt;set_mqr(<span class="php-var">$mqr</span>);
</span><span id="5482" class="l"><a href="#5482"> 5482: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$ismask</span>) {
</span><span id="5483" class="l"><a href="#5483"> 5483: </a>                    <span class="php-comment">// force grayscale</span>
</span><span id="5484" class="l"><a href="#5484"> 5484: </a>                    <span class="php-var">$info</span>[<span class="php-quote">'cs'</span>] = <span class="php-quote">'DeviceGray'</span>;
</span><span id="5485" class="l"><a href="#5485"> 5485: </a>                }
</span><span id="5486" class="l"><a href="#5486"> 5486: </a>                <span class="php-var">$info</span>[<span class="php-quote">'i'</span>] = <span class="php-var">$this</span>-&gt;numimages;
</span><span id="5487" class="l"><a href="#5487"> 5487: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$file</span>, <span class="php-var">$this</span>-&gt;imagekeys)) {
</span><span id="5488" class="l"><a href="#5488"> 5488: </a>                    ++<span class="php-var">$info</span>[<span class="php-quote">'i'</span>];
</span><span id="5489" class="l"><a href="#5489"> 5489: </a>                }
</span><span id="5490" class="l"><a href="#5490"> 5490: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$imgmask</span> !== <span class="php-keyword1">false</span>) {
</span><span id="5491" class="l"><a href="#5491"> 5491: </a>                    <span class="php-var">$info</span>[<span class="php-quote">'masked'</span>] = <span class="php-var">$imgmask</span>;
</span><span id="5492" class="l"><a href="#5492"> 5492: </a>                }
</span><span id="5493" class="l"><a href="#5493"> 5493: </a>                <span class="php-comment">// add image to document</span>
</span><span id="5494" class="l"><a href="#5494"> 5494: </a>                <span class="php-var">$this</span>-&gt;setImageBuffer(<span class="php-var">$file</span>, <span class="php-var">$info</span>);
</span><span id="5495" class="l"><a href="#5495"> 5495: </a>            }
</span><span id="5496" class="l"><a href="#5496"> 5496: </a>            <span class="php-comment">// set alignment</span>
</span><span id="5497" class="l"><a href="#5497"> 5497: </a>            <span class="php-var">$this</span>-&gt;img_rb_y = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="5498" class="l"><a href="#5498"> 5498: </a>            <span class="php-comment">// set alignment</span>
</span><span id="5499" class="l"><a href="#5499"> 5499: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5500" class="l"><a href="#5500"> 5500: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$palign</span> == <span class="php-quote">'L'</span>) {
</span><span id="5501" class="l"><a href="#5501"> 5501: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="5502" class="l"><a href="#5502"> 5502: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'C'</span>) {
</span><span id="5503" class="l"><a href="#5503"> 5503: </a>                    <span class="php-var">$ximg</span> = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$w</span>) / <span class="php-num">2</span>;
</span><span id="5504" class="l"><a href="#5504"> 5504: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'R'</span>) {
</span><span id="5505" class="l"><a href="#5505"> 5505: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$w</span>;
</span><span id="5506" class="l"><a href="#5506"> 5506: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5507" class="l"><a href="#5507"> 5507: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="5508" class="l"><a href="#5508"> 5508: </a>                }
</span><span id="5509" class="l"><a href="#5509"> 5509: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$ximg</span>;
</span><span id="5510" class="l"><a href="#5510"> 5510: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5511" class="l"><a href="#5511"> 5511: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$palign</span> == <span class="php-quote">'L'</span>) {
</span><span id="5512" class="l"><a href="#5512"> 5512: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="5513" class="l"><a href="#5513"> 5513: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'C'</span>) {
</span><span id="5514" class="l"><a href="#5514"> 5514: </a>                    <span class="php-var">$ximg</span> = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$w</span>) / <span class="php-num">2</span>;
</span><span id="5515" class="l"><a href="#5515"> 5515: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'R'</span>) {
</span><span id="5516" class="l"><a href="#5516"> 5516: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$w</span>;
</span><span id="5517" class="l"><a href="#5517"> 5517: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5518" class="l"><a href="#5518"> 5518: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$x</span>;
</span><span id="5519" class="l"><a href="#5519"> 5519: </a>                }
</span><span id="5520" class="l"><a href="#5520"> 5520: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$ximg</span> + <span class="php-var">$w</span>;
</span><span id="5521" class="l"><a href="#5521"> 5521: </a>            }
</span><span id="5522" class="l"><a href="#5522"> 5522: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$ismask</span> <span class="php-keyword1">OR</span> <span class="php-var">$hidden</span>) {
</span><span id="5523" class="l"><a href="#5523"> 5523: </a>                <span class="php-comment">// image is not displayed</span>
</span><span id="5524" class="l"><a href="#5524"> 5524: </a>                <span class="php-keyword1">return</span> <span class="php-var">$info</span>[<span class="php-quote">'i'</span>];
</span><span id="5525" class="l"><a href="#5525"> 5525: </a>            }
</span><span id="5526" class="l"><a href="#5526"> 5526: </a>            <span class="php-var">$xkimg</span> = <span class="php-var">$ximg</span> * <span class="php-var">$this</span>-&gt;k;
</span><span id="5527" class="l"><a href="#5527"> 5527: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'q %.2F 0 0 %.2F %.2F %.2F cm /I%d Do Q'</span>, (<span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k), (<span class="php-var">$h</span> * <span class="php-var">$this</span>-&gt;k), <span class="php-var">$xkimg</span>, ((<span class="php-var">$this</span>-&gt;h - (<span class="php-var">$y</span> + <span class="php-var">$h</span>)) * <span class="php-var">$this</span>-&gt;k), <span class="php-var">$info</span>[<span class="php-quote">'i'</span>]));
</span><span id="5528" class="l"><a href="#5528"> 5528: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$border</span>)) {
</span><span id="5529" class="l"><a href="#5529"> 5529: </a>                <span class="php-var">$bx</span> = <span class="php-var">$x</span>;
</span><span id="5530" class="l"><a href="#5530"> 5530: </a>                <span class="php-var">$by</span> = <span class="php-var">$y</span>;
</span><span id="5531" class="l"><a href="#5531"> 5531: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$ximg</span>;
</span><span id="5532" class="l"><a href="#5532"> 5532: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5533" class="l"><a href="#5533"> 5533: </a>                    <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="5534" class="l"><a href="#5534"> 5534: </a>                }
</span><span id="5535" class="l"><a href="#5535"> 5535: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="5536" class="l"><a href="#5536"> 5536: </a>                <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">''</span>, <span class="php-var">$border</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>);
</span><span id="5537" class="l"><a href="#5537"> 5537: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$bx</span>;
</span><span id="5538" class="l"><a href="#5538"> 5538: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$by</span>;
</span><span id="5539" class="l"><a href="#5539"> 5539: </a>            }
</span><span id="5540" class="l"><a href="#5540"> 5540: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$link</span>) {
</span><span id="5541" class="l"><a href="#5541"> 5541: </a>                <span class="php-var">$this</span>-&gt;<span class="php-keyword2">Link</span>(<span class="php-var">$ximg</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$link</span>, <span class="php-num">0</span>);
</span><span id="5542" class="l"><a href="#5542"> 5542: </a>            }
</span><span id="5543" class="l"><a href="#5543"> 5543: </a>            <span class="php-comment">// set pointer to align the successive text/objects</span>
</span><span id="5544" class="l"><a href="#5544"> 5544: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$align</span>) {
</span><span id="5545" class="l"><a href="#5545"> 5545: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: {
</span><span id="5546" class="l"><a href="#5546"> 5546: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="5547" class="l"><a href="#5547"> 5547: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="5548" class="l"><a href="#5548"> 5548: </a>                    <span class="php-keyword1">break</span>;
</span><span id="5549" class="l"><a href="#5549"> 5549: </a>                }
</span><span id="5550" class="l"><a href="#5550"> 5550: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: {
</span><span id="5551" class="l"><a href="#5551"> 5551: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span> + <span class="php-keyword2">round</span>(<span class="php-var">$h</span>/<span class="php-num">2</span>);
</span><span id="5552" class="l"><a href="#5552"> 5552: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="5553" class="l"><a href="#5553"> 5553: </a>                    <span class="php-keyword1">break</span>;
</span><span id="5554" class="l"><a href="#5554"> 5554: </a>                }
</span><span id="5555" class="l"><a href="#5555"> 5555: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="5556" class="l"><a href="#5556"> 5556: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;img_rb_y;
</span><span id="5557" class="l"><a href="#5557"> 5557: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="5558" class="l"><a href="#5558"> 5558: </a>                    <span class="php-keyword1">break</span>;
</span><span id="5559" class="l"><a href="#5559"> 5559: </a>                }
</span><span id="5560" class="l"><a href="#5560"> 5560: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'N'</span>: {
</span><span id="5561" class="l"><a href="#5561"> 5561: </a>                    <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$this</span>-&gt;img_rb_y);
</span><span id="5562" class="l"><a href="#5562"> 5562: </a>                    <span class="php-keyword1">break</span>;
</span><span id="5563" class="l"><a href="#5563"> 5563: </a>                }
</span><span id="5564" class="l"><a href="#5564"> 5564: </a>                <span class="php-keyword1">default</span>:{
</span><span id="5565" class="l"><a href="#5565"> 5565: </a>                    <span class="php-keyword1">break</span>;
</span><span id="5566" class="l"><a href="#5566"> 5566: </a>                }
</span><span id="5567" class="l"><a href="#5567"> 5567: </a>            }
</span><span id="5568" class="l"><a href="#5568"> 5568: </a>            <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="5569" class="l"><a href="#5569"> 5569: </a>            <span class="php-keyword1">return</span> <span class="php-var">$info</span>[<span class="php-quote">'i'</span>];
</span><span id="5570" class="l"><a href="#5570"> 5570: </a>        }
</span><span id="5571" class="l"><a href="#5571"> 5571: </a>
</span><span id="5572" class="l"><a href="#5572"> 5572: </a>        <span class="php-comment">/**
</span></span><span id="5573" class="l"><a href="#5573"> 5573: </a><span class="php-comment">         * Sets the current active configuration setting of magic_quotes_runtime (if the set_magic_quotes_runtime function exist)
</span></span><span id="5574" class="l"><a href="#5574"> 5574: </a><span class="php-comment">         * @param boolean $mqr FALSE for off, TRUE for on.
</span></span><span id="5575" class="l"><a href="#5575"> 5575: </a><span class="php-comment">         * @since 4.6.025 (2009-08-17)
</span></span><span id="5576" class="l"><a href="#5576"> 5576: </a><span class="php-comment">         */</span>
</span><span id="5577" class="l"><a href="#5577"> 5577: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> set_mqr(<span class="php-var">$mqr</span>) {
</span><span id="5578" class="l"><a href="#5578"> 5578: </a>            <span class="php-keyword1">if</span>(!<span class="php-keyword2">defined</span>(<span class="php-quote">'PHP_VERSION_ID'</span>)) {
</span><span id="5579" class="l"><a href="#5579"> 5579: </a>                <span class="php-var">$version</span> = PHP_VERSION;
</span><span id="5580" class="l"><a href="#5580"> 5580: </a>                <span class="php-keyword2">define</span>(<span class="php-quote">'PHP_VERSION_ID'</span>, ((<span class="php-var">$version</span>{<span class="php-num">0</span>} * <span class="php-num">10000</span>) + (<span class="php-var">$version</span>{<span class="php-num">2</span>} * <span class="php-num">100</span>) + <span class="php-var">$version</span>{<span class="php-num">4</span>}));
</span><span id="5581" class="l"><a href="#5581"> 5581: </a>            }
</span><span id="5582" class="l"><a href="#5582"> 5582: </a>            <span class="php-keyword1">if</span> (PHP_VERSION_ID &lt; <span class="php-num">50300</span>) {
</span><span id="5583" class="l"><a href="#5583"> 5583: </a>                @<span class="php-keyword2">set_magic_quotes_runtime</span>(<span class="php-var">$mqr</span>);
</span><span id="5584" class="l"><a href="#5584"> 5584: </a>            }
</span><span id="5585" class="l"><a href="#5585"> 5585: </a>        }
</span><span id="5586" class="l"><a href="#5586"> 5586: </a>
</span><span id="5587" class="l"><a href="#5587"> 5587: </a>        <span class="php-comment">/**
</span></span><span id="5588" class="l"><a href="#5588"> 5588: </a><span class="php-comment">         * Gets the current active configuration setting of magic_quotes_runtime (if the get_magic_quotes_runtime function exist)
</span></span><span id="5589" class="l"><a href="#5589"> 5589: </a><span class="php-comment">         * @return Returns 0 if magic quotes runtime is off or get_magic_quotes_runtime doesn't exist, 1 otherwise.
</span></span><span id="5590" class="l"><a href="#5590"> 5590: </a><span class="php-comment">         * @since 4.6.025 (2009-08-17)
</span></span><span id="5591" class="l"><a href="#5591"> 5591: </a><span class="php-comment">         */</span>
</span><span id="5592" class="l"><a href="#5592"> 5592: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> get_mqr() {
</span><span id="5593" class="l"><a href="#5593"> 5593: </a>            <span class="php-keyword1">if</span>(!<span class="php-keyword2">defined</span>(<span class="php-quote">'PHP_VERSION_ID'</span>)) {
</span><span id="5594" class="l"><a href="#5594"> 5594: </a>                <span class="php-var">$version</span> = PHP_VERSION;
</span><span id="5595" class="l"><a href="#5595"> 5595: </a>                <span class="php-keyword2">define</span>(<span class="php-quote">'PHP_VERSION_ID'</span>, ((<span class="php-var">$version</span>{<span class="php-num">0</span>} * <span class="php-num">10000</span>) + (<span class="php-var">$version</span>{<span class="php-num">2</span>} * <span class="php-num">100</span>) + <span class="php-var">$version</span>{<span class="php-num">4</span>}));
</span><span id="5596" class="l"><a href="#5596"> 5596: </a>            }
</span><span id="5597" class="l"><a href="#5597"> 5597: </a>            <span class="php-keyword1">if</span> (PHP_VERSION_ID &lt; <span class="php-num">50300</span>) {
</span><span id="5598" class="l"><a href="#5598"> 5598: </a>                <span class="php-keyword1">return</span> @<span class="php-keyword2">get_magic_quotes_runtime</span>();
</span><span id="5599" class="l"><a href="#5599"> 5599: </a>            }
</span><span id="5600" class="l"><a href="#5600"> 5600: </a>            <span class="php-keyword1">return</span> <span class="php-num">0</span>;
</span><span id="5601" class="l"><a href="#5601"> 5601: </a>        }
</span><span id="5602" class="l"><a href="#5602"> 5602: </a>
</span><span id="5603" class="l"><a href="#5603"> 5603: </a>        <span class="php-comment">/**
</span></span><span id="5604" class="l"><a href="#5604"> 5604: </a><span class="php-comment">         * Convert the loaded image to a JPEG and then return a structure for the PDF creator.
</span></span><span id="5605" class="l"><a href="#5605"> 5605: </a><span class="php-comment">         * This function requires GD library and write access to the directory defined on K_PATH_CACHE constant.
</span></span><span id="5606" class="l"><a href="#5606"> 5606: </a><span class="php-comment">         * @param string $file Image file name.
</span></span><span id="5607" class="l"><a href="#5607"> 5607: </a><span class="php-comment">         * @param image $image Image object.
</span></span><span id="5608" class="l"><a href="#5608"> 5608: </a><span class="php-comment">         * return image JPEG image object.
</span></span><span id="5609" class="l"><a href="#5609"> 5609: </a><span class="php-comment">         * @access protected
</span></span><span id="5610" class="l"><a href="#5610"> 5610: </a><span class="php-comment">         */</span>
</span><span id="5611" class="l"><a href="#5611"> 5611: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _toJPEG(<span class="php-var">$image</span>) {
</span><span id="5612" class="l"><a href="#5612"> 5612: </a>            <span class="php-var">$tempname</span> = <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-quote">'jpg_'</span>);
</span><span id="5613" class="l"><a href="#5613"> 5613: </a>            <span class="php-keyword2">imagejpeg</span>(<span class="php-var">$image</span>, <span class="php-var">$tempname</span>, <span class="php-var">$this</span>-&gt;jpeg_quality);
</span><span id="5614" class="l"><a href="#5614"> 5614: </a>            <span class="php-keyword2">imagedestroy</span>(<span class="php-var">$image</span>);
</span><span id="5615" class="l"><a href="#5615"> 5615: </a>            <span class="php-var">$retvars</span> = <span class="php-var">$this</span>-&gt;_parsejpeg(<span class="php-var">$tempname</span>);
</span><span id="5616" class="l"><a href="#5616"> 5616: </a>            <span class="php-comment">// tidy up by removing temporary image</span>
</span><span id="5617" class="l"><a href="#5617"> 5617: </a>            <span class="php-keyword2">unlink</span>(<span class="php-var">$tempname</span>);
</span><span id="5618" class="l"><a href="#5618"> 5618: </a>            <span class="php-keyword1">return</span> <span class="php-var">$retvars</span>;
</span><span id="5619" class="l"><a href="#5619"> 5619: </a>        }
</span><span id="5620" class="l"><a href="#5620"> 5620: </a>
</span><span id="5621" class="l"><a href="#5621"> 5621: </a>        <span class="php-comment">/**
</span></span><span id="5622" class="l"><a href="#5622"> 5622: </a><span class="php-comment">         * Convert the loaded image to a PNG and then return a structure for the PDF creator.
</span></span><span id="5623" class="l"><a href="#5623"> 5623: </a><span class="php-comment">         * This function requires GD library and write access to the directory defined on K_PATH_CACHE constant.
</span></span><span id="5624" class="l"><a href="#5624"> 5624: </a><span class="php-comment">         * @param string $file Image file name.
</span></span><span id="5625" class="l"><a href="#5625"> 5625: </a><span class="php-comment">         * @param image $image Image object.
</span></span><span id="5626" class="l"><a href="#5626"> 5626: </a><span class="php-comment">         * return image PNG image object.
</span></span><span id="5627" class="l"><a href="#5627"> 5627: </a><span class="php-comment">         * @access protected
</span></span><span id="5628" class="l"><a href="#5628"> 5628: </a><span class="php-comment">         * @since 4.9.016 (2010-04-20)
</span></span><span id="5629" class="l"><a href="#5629"> 5629: </a><span class="php-comment">         */</span>
</span><span id="5630" class="l"><a href="#5630"> 5630: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _toPNG(<span class="php-var">$image</span>) {
</span><span id="5631" class="l"><a href="#5631"> 5631: </a>            <span class="php-var">$tempname</span> = <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-quote">'jpg_'</span>);
</span><span id="5632" class="l"><a href="#5632"> 5632: </a>            <span class="php-keyword2">imagepng</span>(<span class="php-var">$image</span>, <span class="php-var">$tempname</span>);
</span><span id="5633" class="l"><a href="#5633"> 5633: </a>            <span class="php-keyword2">imagedestroy</span>(<span class="php-var">$image</span>);
</span><span id="5634" class="l"><a href="#5634"> 5634: </a>            <span class="php-var">$retvars</span> = <span class="php-var">$this</span>-&gt;_parsepng(<span class="php-var">$tempname</span>);
</span><span id="5635" class="l"><a href="#5635"> 5635: </a>            <span class="php-comment">// tidy up by removing temporary image</span>
</span><span id="5636" class="l"><a href="#5636"> 5636: </a>            <span class="php-keyword2">unlink</span>(<span class="php-var">$tempname</span>);
</span><span id="5637" class="l"><a href="#5637"> 5637: </a>            <span class="php-keyword1">return</span> <span class="php-var">$retvars</span>;
</span><span id="5638" class="l"><a href="#5638"> 5638: </a>        }
</span><span id="5639" class="l"><a href="#5639"> 5639: </a>
</span><span id="5640" class="l"><a href="#5640"> 5640: </a>        <span class="php-comment">/**
</span></span><span id="5641" class="l"><a href="#5641"> 5641: </a><span class="php-comment">         * Set the transparency for the given GD image.
</span></span><span id="5642" class="l"><a href="#5642"> 5642: </a><span class="php-comment">         * @param image $new_image GD image object
</span></span><span id="5643" class="l"><a href="#5643"> 5643: </a><span class="php-comment">         * @param image $image GD image object.
</span></span><span id="5644" class="l"><a href="#5644"> 5644: </a><span class="php-comment">         * return GD image object.
</span></span><span id="5645" class="l"><a href="#5645"> 5645: </a><span class="php-comment">         * @access protected
</span></span><span id="5646" class="l"><a href="#5646"> 5646: </a><span class="php-comment">         * @since 4.9.016 (2010-04-20)
</span></span><span id="5647" class="l"><a href="#5647"> 5647: </a><span class="php-comment">         */</span>
</span><span id="5648" class="l"><a href="#5648"> 5648: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _setGDImageTransparency(<span class="php-var">$new_image</span>, <span class="php-var">$image</span>) {
</span><span id="5649" class="l"><a href="#5649"> 5649: </a>            <span class="php-comment">// transparency index</span>
</span><span id="5650" class="l"><a href="#5650"> 5650: </a>            <span class="php-var">$tid</span> = <span class="php-keyword2">imagecolortransparent</span>(<span class="php-var">$image</span>);
</span><span id="5651" class="l"><a href="#5651"> 5651: </a>            <span class="php-comment">// default transparency color</span>
</span><span id="5652" class="l"><a href="#5652"> 5652: </a>            <span class="php-var">$tcol</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'red'</span> =&gt; <span class="php-num">255</span>, <span class="php-quote">'green'</span> =&gt; <span class="php-num">255</span>, <span class="php-quote">'blue'</span> =&gt; <span class="php-num">255</span>);
</span><span id="5653" class="l"><a href="#5653"> 5653: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$tid</span> &gt;= <span class="php-num">0</span>) {
</span><span id="5654" class="l"><a href="#5654"> 5654: </a>                <span class="php-comment">// get the colors for the transparency index</span>
</span><span id="5655" class="l"><a href="#5655"> 5655: </a>                <span class="php-var">$tcol</span> = <span class="php-keyword2">imagecolorsforindex</span>(<span class="php-var">$image</span>, <span class="php-var">$tid</span>);
</span><span id="5656" class="l"><a href="#5656"> 5656: </a>            }
</span><span id="5657" class="l"><a href="#5657"> 5657: </a>            <span class="php-var">$tid</span> = <span class="php-keyword2">imagecolorallocate</span>(<span class="php-var">$new_image</span>, <span class="php-var">$tcol</span>[<span class="php-quote">'red'</span>], <span class="php-var">$tcol</span>[<span class="php-quote">'green'</span>], <span class="php-var">$tcol</span>[<span class="php-quote">'blue'</span>]);
</span><span id="5658" class="l"><a href="#5658"> 5658: </a>            <span class="php-keyword2">imagefill</span>(<span class="php-var">$new_image</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$tid</span>);
</span><span id="5659" class="l"><a href="#5659"> 5659: </a>            <span class="php-keyword2">imagecolortransparent</span>(<span class="php-var">$new_image</span>, <span class="php-var">$tid</span>);
</span><span id="5660" class="l"><a href="#5660"> 5660: </a>            <span class="php-keyword1">return</span> <span class="php-var">$new_image</span>;
</span><span id="5661" class="l"><a href="#5661"> 5661: </a>        }
</span><span id="5662" class="l"><a href="#5662"> 5662: </a>
</span><span id="5663" class="l"><a href="#5663"> 5663: </a>        <span class="php-comment">/**
</span></span><span id="5664" class="l"><a href="#5664"> 5664: </a><span class="php-comment">         * Extract info from a JPEG file without using the GD library.
</span></span><span id="5665" class="l"><a href="#5665"> 5665: </a><span class="php-comment">         * @param string $file image file to parse
</span></span><span id="5666" class="l"><a href="#5666"> 5666: </a><span class="php-comment">         * @return array structure containing the image data
</span></span><span id="5667" class="l"><a href="#5667"> 5667: </a><span class="php-comment">         * @access protected
</span></span><span id="5668" class="l"><a href="#5668"> 5668: </a><span class="php-comment">         */</span>
</span><span id="5669" class="l"><a href="#5669"> 5669: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _parsejpeg(<span class="php-var">$file</span>) {
</span><span id="5670" class="l"><a href="#5670"> 5670: </a>            <span class="php-var">$a</span> = <span class="php-keyword2">getimagesize</span>(<span class="php-var">$file</span>);
</span><span id="5671" class="l"><a href="#5671"> 5671: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$a</span>)) {
</span><span id="5672" class="l"><a href="#5672"> 5672: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Missing or incorrect image file: '</span>.<span class="php-var">$file</span>);
</span><span id="5673" class="l"><a href="#5673"> 5673: </a>            }
</span><span id="5674" class="l"><a href="#5674"> 5674: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$a</span>[<span class="php-num">2</span>] != <span class="php-num">2</span>) {
</span><span id="5675" class="l"><a href="#5675"> 5675: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Not a JPEG file: '</span>.<span class="php-var">$file</span>);
</span><span id="5676" class="l"><a href="#5676"> 5676: </a>            }
</span><span id="5677" class="l"><a href="#5677"> 5677: </a>            <span class="php-keyword1">if</span> ((!<span class="php-keyword1">isset</span>(<span class="php-var">$a</span>[<span class="php-quote">'channels'</span>])) <span class="php-keyword1">OR</span> (<span class="php-var">$a</span>[<span class="php-quote">'channels'</span>] == <span class="php-num">3</span>)) {
</span><span id="5678" class="l"><a href="#5678"> 5678: </a>                <span class="php-var">$colspace</span> = <span class="php-quote">'DeviceRGB'</span>;
</span><span id="5679" class="l"><a href="#5679"> 5679: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$a</span>[<span class="php-quote">'channels'</span>] == <span class="php-num">4</span>) {
</span><span id="5680" class="l"><a href="#5680"> 5680: </a>                <span class="php-var">$colspace</span> = <span class="php-quote">'DeviceCMYK'</span>;
</span><span id="5681" class="l"><a href="#5681"> 5681: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5682" class="l"><a href="#5682"> 5682: </a>                <span class="php-var">$colspace</span> = <span class="php-quote">'DeviceGray'</span>;
</span><span id="5683" class="l"><a href="#5683"> 5683: </a>            }
</span><span id="5684" class="l"><a href="#5684"> 5684: </a>            <span class="php-var">$bpc</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$a</span>[<span class="php-quote">'bits'</span>]) ? <span class="php-var">$a</span>[<span class="php-quote">'bits'</span>] : <span class="php-num">8</span>;
</span><span id="5685" class="l"><a href="#5685"> 5685: </a>            <span class="php-var">$data</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$file</span>);
</span><span id="5686" class="l"><a href="#5686"> 5686: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span> =&gt; <span class="php-var">$a</span>[<span class="php-num">0</span>], <span class="php-quote">'h'</span> =&gt; <span class="php-var">$a</span>[<span class="php-num">1</span>], <span class="php-quote">'cs'</span> =&gt; <span class="php-var">$colspace</span>, <span class="php-quote">'bpc'</span> =&gt; <span class="php-var">$bpc</span>, <span class="php-quote">'f'</span> =&gt; <span class="php-quote">'DCTDecode'</span>, <span class="php-quote">'data'</span> =&gt; <span class="php-var">$data</span>);
</span><span id="5687" class="l"><a href="#5687"> 5687: </a>        }
</span><span id="5688" class="l"><a href="#5688"> 5688: </a>
</span><span id="5689" class="l"><a href="#5689"> 5689: </a>        <span class="php-comment">/**
</span></span><span id="5690" class="l"><a href="#5690"> 5690: </a><span class="php-comment">         * Extract info from a PNG file without using the GD library.
</span></span><span id="5691" class="l"><a href="#5691"> 5691: </a><span class="php-comment">         * @param string $file image file to parse
</span></span><span id="5692" class="l"><a href="#5692"> 5692: </a><span class="php-comment">         * @return array structure containing the image data
</span></span><span id="5693" class="l"><a href="#5693"> 5693: </a><span class="php-comment">         * @access protected
</span></span><span id="5694" class="l"><a href="#5694"> 5694: </a><span class="php-comment">         */</span>
</span><span id="5695" class="l"><a href="#5695"> 5695: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _parsepng(<span class="php-var">$file</span>) {
</span><span id="5696" class="l"><a href="#5696"> 5696: </a>            <span class="php-var">$f</span> = <span class="php-keyword2">fopen</span>(<span class="php-var">$file</span>, <span class="php-quote">'rb'</span>);
</span><span id="5697" class="l"><a href="#5697"> 5697: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$f</span> === <span class="php-keyword1">false</span>) {
</span><span id="5698" class="l"><a href="#5698"> 5698: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Can\'t open image file: '</span>.<span class="php-var">$file</span>);
</span><span id="5699" class="l"><a href="#5699"> 5699: </a>            }
</span><span id="5700" class="l"><a href="#5700"> 5700: </a>            <span class="php-comment">//Check signature</span>
</span><span id="5701" class="l"><a href="#5701"> 5701: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">8</span>) != <span class="php-keyword2">chr</span>(<span class="php-num">137</span>).<span class="php-quote">'PNG'</span>.<span class="php-keyword2">chr</span>(<span class="php-num">13</span>).<span class="php-keyword2">chr</span>(<span class="php-num">10</span>).<span class="php-keyword2">chr</span>(<span class="php-num">26</span>).<span class="php-keyword2">chr</span>(<span class="php-num">10</span>)) {
</span><span id="5702" class="l"><a href="#5702"> 5702: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Not a PNG file: '</span>.<span class="php-var">$file</span>);
</span><span id="5703" class="l"><a href="#5703"> 5703: </a>            }
</span><span id="5704" class="l"><a href="#5704"> 5704: </a>            <span class="php-comment">//Read header chunk</span>
</span><span id="5705" class="l"><a href="#5705"> 5705: </a>            <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>);
</span><span id="5706" class="l"><a href="#5706"> 5706: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>) != <span class="php-quote">'IHDR'</span>) {
</span><span id="5707" class="l"><a href="#5707"> 5707: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Incorrect PNG file: '</span>.<span class="php-var">$file</span>);
</span><span id="5708" class="l"><a href="#5708"> 5708: </a>            }
</span><span id="5709" class="l"><a href="#5709"> 5709: </a>            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;_freadint(<span class="php-var">$f</span>);
</span><span id="5710" class="l"><a href="#5710"> 5710: </a>            <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;_freadint(<span class="php-var">$f</span>);
</span><span id="5711" class="l"><a href="#5711"> 5711: </a>            <span class="php-var">$bpc</span> = <span class="php-keyword2">ord</span>(<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">1</span>));
</span><span id="5712" class="l"><a href="#5712"> 5712: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$bpc</span> &gt; <span class="php-num">8</span>) {
</span><span id="5713" class="l"><a href="#5713"> 5713: </a>                <span class="php-comment">//$this-&gt;Error('16-bit depth not supported: '.$file);</span>
</span><span id="5714" class="l"><a href="#5714"> 5714: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="5715" class="l"><a href="#5715"> 5715: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="5716" class="l"><a href="#5716"> 5716: </a>            }
</span><span id="5717" class="l"><a href="#5717"> 5717: </a>            <span class="php-var">$ct</span> = <span class="php-keyword2">ord</span>(<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">1</span>));
</span><span id="5718" class="l"><a href="#5718"> 5718: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$ct</span> == <span class="php-num">0</span>) {
</span><span id="5719" class="l"><a href="#5719"> 5719: </a>                <span class="php-var">$colspace</span> = <span class="php-quote">'DeviceGray'</span>;
</span><span id="5720" class="l"><a href="#5720"> 5720: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$ct</span> == <span class="php-num">2</span>) {
</span><span id="5721" class="l"><a href="#5721"> 5721: </a>                <span class="php-var">$colspace</span> = <span class="php-quote">'DeviceRGB'</span>;
</span><span id="5722" class="l"><a href="#5722"> 5722: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$ct</span> == <span class="php-num">3</span>) {
</span><span id="5723" class="l"><a href="#5723"> 5723: </a>                <span class="php-var">$colspace</span> = <span class="php-quote">'Indexed'</span>;
</span><span id="5724" class="l"><a href="#5724"> 5724: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5725" class="l"><a href="#5725"> 5725: </a>                <span class="php-comment">// alpha channel</span>
</span><span id="5726" class="l"><a href="#5726"> 5726: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="5727" class="l"><a href="#5727"> 5727: </a>                <span class="php-keyword1">return</span> <span class="php-quote">'pngalpha'</span>;
</span><span id="5728" class="l"><a href="#5728"> 5728: </a>            }
</span><span id="5729" class="l"><a href="#5729"> 5729: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">ord</span>(<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">1</span>)) != <span class="php-num">0</span>) {
</span><span id="5730" class="l"><a href="#5730"> 5730: </a>                <span class="php-comment">//$this-&gt;Error('Unknown compression method: '.$file);</span>
</span><span id="5731" class="l"><a href="#5731"> 5731: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="5732" class="l"><a href="#5732"> 5732: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="5733" class="l"><a href="#5733"> 5733: </a>            }
</span><span id="5734" class="l"><a href="#5734"> 5734: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">ord</span>(<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">1</span>)) != <span class="php-num">0</span>) {
</span><span id="5735" class="l"><a href="#5735"> 5735: </a>                <span class="php-comment">//$this-&gt;Error('Unknown filter method: '.$file);</span>
</span><span id="5736" class="l"><a href="#5736"> 5736: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="5737" class="l"><a href="#5737"> 5737: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="5738" class="l"><a href="#5738"> 5738: </a>            }
</span><span id="5739" class="l"><a href="#5739"> 5739: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">ord</span>(<span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">1</span>)) != <span class="php-num">0</span>) {
</span><span id="5740" class="l"><a href="#5740"> 5740: </a>                <span class="php-comment">//$this-&gt;Error('Interlacing not supported: '.$file);</span>
</span><span id="5741" class="l"><a href="#5741"> 5741: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="5742" class="l"><a href="#5742"> 5742: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="5743" class="l"><a href="#5743"> 5743: </a>            }
</span><span id="5744" class="l"><a href="#5744"> 5744: </a>            <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>);
</span><span id="5745" class="l"><a href="#5745"> 5745: </a>            <span class="php-var">$parms</span> = <span class="php-quote">'/DecodeParms &lt;&lt;/Predictor 15 /Colors '</span>.(<span class="php-var">$ct</span>==<span class="php-num">2</span> ? <span class="php-num">3</span> : <span class="php-num">1</span>).<span class="php-quote">' /BitsPerComponent '</span>.<span class="php-var">$bpc</span>.<span class="php-quote">' /Columns '</span>.<span class="php-var">$w</span>.<span class="php-quote">'&gt;&gt;'</span>;
</span><span id="5746" class="l"><a href="#5746"> 5746: </a>            <span class="php-comment">//Scan chunks looking for palette, transparency and image data</span>
</span><span id="5747" class="l"><a href="#5747"> 5747: </a>            <span class="php-var">$pal</span> = <span class="php-quote">''</span>;
</span><span id="5748" class="l"><a href="#5748"> 5748: </a>            <span class="php-var">$trns</span> = <span class="php-quote">''</span>;
</span><span id="5749" class="l"><a href="#5749"> 5749: </a>            <span class="php-var">$data</span> = <span class="php-quote">''</span>;
</span><span id="5750" class="l"><a href="#5750"> 5750: </a>            <span class="php-keyword1">do</span> {
</span><span id="5751" class="l"><a href="#5751"> 5751: </a>                <span class="php-var">$n</span> = <span class="php-var">$this</span>-&gt;_freadint(<span class="php-var">$f</span>);
</span><span id="5752" class="l"><a href="#5752"> 5752: </a>                <span class="php-var">$type</span> = <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>);
</span><span id="5753" class="l"><a href="#5753"> 5753: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$type</span> == <span class="php-quote">'PLTE'</span>) {
</span><span id="5754" class="l"><a href="#5754"> 5754: </a>                    <span class="php-comment">//Read palette</span>
</span><span id="5755" class="l"><a href="#5755"> 5755: </a>                    <span class="php-var">$pal</span> = <span class="php-var">$this</span>-&gt;rfread(<span class="php-var">$f</span>, <span class="php-var">$n</span>);
</span><span id="5756" class="l"><a href="#5756"> 5756: </a>                    <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>);
</span><span id="5757" class="l"><a href="#5757"> 5757: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$type</span> == <span class="php-quote">'tRNS'</span>) {
</span><span id="5758" class="l"><a href="#5758"> 5758: </a>                    <span class="php-comment">//Read transparency info</span>
</span><span id="5759" class="l"><a href="#5759"> 5759: </a>                    <span class="php-var">$t</span> = <span class="php-var">$this</span>-&gt;rfread(<span class="php-var">$f</span>, <span class="php-var">$n</span>);
</span><span id="5760" class="l"><a href="#5760"> 5760: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$ct</span> == <span class="php-num">0</span>) {
</span><span id="5761" class="l"><a href="#5761"> 5761: </a>                        <span class="php-var">$trns</span> = <span class="php-keyword1">array</span>(<span class="php-keyword2">ord</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$t</span>, <span class="php-num">1</span>, <span class="php-num">1</span>)));
</span><span id="5762" class="l"><a href="#5762"> 5762: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$ct</span> == <span class="php-num">2</span>) {
</span><span id="5763" class="l"><a href="#5763"> 5763: </a>                        <span class="php-var">$trns</span> = <span class="php-keyword1">array</span>(<span class="php-keyword2">ord</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$t</span>, <span class="php-num">1</span>, <span class="php-num">1</span>)), <span class="php-keyword2">ord</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$t</span>, <span class="php-num">3</span>, <span class="php-num">1</span>)), <span class="php-keyword2">ord</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$t</span>, <span class="php-num">5</span>, <span class="php-num">1</span>)));
</span><span id="5764" class="l"><a href="#5764"> 5764: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="5765" class="l"><a href="#5765"> 5765: </a>                        <span class="php-var">$pos</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$t</span>, <span class="php-keyword2">chr</span>(<span class="php-num">0</span>));
</span><span id="5766" class="l"><a href="#5766"> 5766: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$pos</span> !== <span class="php-keyword1">false</span>) {
</span><span id="5767" class="l"><a href="#5767"> 5767: </a>                            <span class="php-var">$trns</span> = <span class="php-keyword1">array</span>(<span class="php-var">$pos</span>);
</span><span id="5768" class="l"><a href="#5768"> 5768: </a>                        }
</span><span id="5769" class="l"><a href="#5769"> 5769: </a>                    }
</span><span id="5770" class="l"><a href="#5770"> 5770: </a>                    <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>);
</span><span id="5771" class="l"><a href="#5771"> 5771: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$type</span> == <span class="php-quote">'IDAT'</span>) {
</span><span id="5772" class="l"><a href="#5772"> 5772: </a>                    <span class="php-comment">//Read image data block</span>
</span><span id="5773" class="l"><a href="#5773"> 5773: </a>                    <span class="php-var">$data</span> .= <span class="php-var">$this</span>-&gt;rfread(<span class="php-var">$f</span>, <span class="php-var">$n</span>);
</span><span id="5774" class="l"><a href="#5774"> 5774: </a>                    <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>);
</span><span id="5775" class="l"><a href="#5775"> 5775: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$type</span> == <span class="php-quote">'IEND'</span>) {
</span><span id="5776" class="l"><a href="#5776"> 5776: </a>                    <span class="php-keyword1">break</span>;
</span><span id="5777" class="l"><a href="#5777"> 5777: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5778" class="l"><a href="#5778"> 5778: </a>                    <span class="php-var">$this</span>-&gt;rfread(<span class="php-var">$f</span>, <span class="php-var">$n</span> + <span class="php-num">4</span>);
</span><span id="5779" class="l"><a href="#5779"> 5779: </a>                }
</span><span id="5780" class="l"><a href="#5780"> 5780: </a>            } <span class="php-keyword1">while</span> (<span class="php-var">$n</span>);
</span><span id="5781" class="l"><a href="#5781"> 5781: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$colspace</span> == <span class="php-quote">'Indexed'</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$pal</span>))) {
</span><span id="5782" class="l"><a href="#5782"> 5782: </a>                <span class="php-comment">//$this-&gt;Error('Missing palette in '.$file);</span>
</span><span id="5783" class="l"><a href="#5783"> 5783: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="5784" class="l"><a href="#5784"> 5784: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="5785" class="l"><a href="#5785"> 5785: </a>            }
</span><span id="5786" class="l"><a href="#5786"> 5786: </a>            <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="5787" class="l"><a href="#5787"> 5787: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span> =&gt; <span class="php-var">$w</span>, <span class="php-quote">'h'</span> =&gt; <span class="php-var">$h</span>, <span class="php-quote">'cs'</span> =&gt; <span class="php-var">$colspace</span>, <span class="php-quote">'bpc'</span> =&gt; <span class="php-var">$bpc</span>, <span class="php-quote">'f'</span> =&gt; <span class="php-quote">'FlateDecode'</span>, <span class="php-quote">'parms'</span> =&gt; <span class="php-var">$parms</span>, <span class="php-quote">'pal'</span> =&gt; <span class="php-var">$pal</span>, <span class="php-quote">'trns'</span> =&gt; <span class="php-var">$trns</span>, <span class="php-quote">'data'</span> =&gt; <span class="php-var">$data</span>);
</span><span id="5788" class="l"><a href="#5788"> 5788: </a>        }
</span><span id="5789" class="l"><a href="#5789"> 5789: </a>
</span><span id="5790" class="l"><a href="#5790"> 5790: </a>        <span class="php-comment">/**
</span></span><span id="5791" class="l"><a href="#5791"> 5791: </a><span class="php-comment">         * Binary-safe and URL-safe file read.
</span></span><span id="5792" class="l"><a href="#5792"> 5792: </a><span class="php-comment">         * Reads up to length  bytes from the file pointer referenced by handle. Reading stops as soon as one of the following conditions is met: length bytes have been read; EOF (end of file) is reached.
</span></span><span id="5793" class="l"><a href="#5793"> 5793: </a><span class="php-comment">         * @param resource $handle
</span></span><span id="5794" class="l"><a href="#5794"> 5794: </a><span class="php-comment">         * @param int $length
</span></span><span id="5795" class="l"><a href="#5795"> 5795: </a><span class="php-comment">         * @return Returns the read string or FALSE in case of error.
</span></span><span id="5796" class="l"><a href="#5796"> 5796: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="5797" class="l"><a href="#5797"> 5797: </a><span class="php-comment">         * @access protected
</span></span><span id="5798" class="l"><a href="#5798"> 5798: </a><span class="php-comment">         * @since 4.5.027 (2009-03-16)
</span></span><span id="5799" class="l"><a href="#5799"> 5799: </a><span class="php-comment">         */</span>
</span><span id="5800" class="l"><a href="#5800"> 5800: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> rfread(<span class="php-var">$handle</span>, <span class="php-var">$length</span>) {
</span><span id="5801" class="l"><a href="#5801"> 5801: </a>            <span class="php-var">$data</span> = <span class="php-keyword2">fread</span>(<span class="php-var">$handle</span>, <span class="php-var">$length</span>);
</span><span id="5802" class="l"><a href="#5802"> 5802: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$data</span> === <span class="php-keyword1">false</span>) {
</span><span id="5803" class="l"><a href="#5803"> 5803: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="5804" class="l"><a href="#5804"> 5804: </a>            }
</span><span id="5805" class="l"><a href="#5805"> 5805: </a>            <span class="php-var">$rest</span> = <span class="php-var">$length</span> - <span class="php-keyword2">strlen</span>(<span class="php-var">$data</span>);
</span><span id="5806" class="l"><a href="#5806"> 5806: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$rest</span> &gt; <span class="php-num">0</span>) {
</span><span id="5807" class="l"><a href="#5807"> 5807: </a>                <span class="php-var">$data</span> .= <span class="php-var">$this</span>-&gt;rfread(<span class="php-var">$handle</span>, <span class="php-var">$rest</span>);
</span><span id="5808" class="l"><a href="#5808"> 5808: </a>            }
</span><span id="5809" class="l"><a href="#5809"> 5809: </a>            <span class="php-keyword1">return</span> <span class="php-var">$data</span>;
</span><span id="5810" class="l"><a href="#5810"> 5810: </a>        }
</span><span id="5811" class="l"><a href="#5811"> 5811: </a>
</span><span id="5812" class="l"><a href="#5812"> 5812: </a>        <span class="php-comment">/**
</span></span><span id="5813" class="l"><a href="#5813"> 5813: </a><span class="php-comment">         * Extract info from a PNG image with alpha channel using the GD library.
</span></span><span id="5814" class="l"><a href="#5814"> 5814: </a><span class="php-comment">         * @param string $file Name of the file containing the image.
</span></span><span id="5815" class="l"><a href="#5815"> 5815: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner.
</span></span><span id="5816" class="l"><a href="#5816"> 5816: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner.
</span></span><span id="5817" class="l"><a href="#5817"> 5817: </a><span class="php-comment">         * @param float $w Width of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="5818" class="l"><a href="#5818"> 5818: </a><span class="php-comment">         * @param float $h Height of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="5819" class="l"><a href="#5819"> 5819: </a><span class="php-comment">         * @param string $type Image format. Possible values are (case insensitive): JPEG and PNG (whitout GD library) and all images supported by GD: GD, GD2, GD2PART, GIF, JPEG, PNG, BMP, XBM, XPM;. If not specified, the type is inferred from the file extension.
</span></span><span id="5820" class="l"><a href="#5820"> 5820: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink().
</span></span><span id="5821" class="l"><a href="#5821"> 5821: </a><span class="php-comment">         * @param string $align Indicates the alignment of the pointer next to image insertion relative to image height. The value can be:&lt;ul&gt;&lt;li&gt;T: top-right for LTR or top-left for RTL&lt;/li&gt;&lt;li&gt;M: middle-right for LTR or middle-left for RTL&lt;/li&gt;&lt;li&gt;B: bottom-right for LTR or bottom-left for RTL&lt;/li&gt;&lt;li&gt;N: next line&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="5822" class="l"><a href="#5822"> 5822: </a><span class="php-comment">         * @param boolean $resize If true resize (reduce) the image to fit $w and $h (requires GD library).
</span></span><span id="5823" class="l"><a href="#5823"> 5823: </a><span class="php-comment">         * @param int $dpi dot-per-inch resolution used on resize
</span></span><span id="5824" class="l"><a href="#5824"> 5824: </a><span class="php-comment">         * @param string $palign Allows to center or align the image on the current line. Possible values are:&lt;ul&gt;&lt;li&gt;L : left align&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;R : right align&lt;/li&gt;&lt;li&gt;'' : empty string : left for LTR or right for RTL&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="5825" class="l"><a href="#5825"> 5825: </a><span class="php-comment">         * @author Valentin Schmidt, Nicola Asuni
</span></span><span id="5826" class="l"><a href="#5826"> 5826: </a><span class="php-comment">         * @access protected
</span></span><span id="5827" class="l"><a href="#5827"> 5827: </a><span class="php-comment">         * @since 4.3.007 (2008-12-04)
</span></span><span id="5828" class="l"><a href="#5828"> 5828: </a><span class="php-comment">         * @see Image()
</span></span><span id="5829" class="l"><a href="#5829"> 5829: </a><span class="php-comment">         */</span>
</span><span id="5830" class="l"><a href="#5830"> 5830: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> ImagePngAlpha(<span class="php-var">$file</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$w</span>=<span class="php-num">0</span>, <span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$type</span>=<span class="php-quote">''</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$resize</span>=<span class="php-keyword1">false</span>, <span class="php-var">$dpi</span>=<span class="php-num">300</span>, <span class="php-var">$palign</span>=<span class="php-quote">''</span>) {
</span><span id="5831" class="l"><a href="#5831"> 5831: </a>            <span class="php-comment">// get image size</span>
</span><span id="5832" class="l"><a href="#5832"> 5832: </a>            <span class="php-keyword1">list</span>(<span class="php-var">$wpx</span>, <span class="php-var">$hpx</span>) = <span class="php-keyword2">getimagesize</span>(<span class="php-var">$file</span>);
</span><span id="5833" class="l"><a href="#5833"> 5833: </a>            <span class="php-comment">// generate images</span>
</span><span id="5834" class="l"><a href="#5834"> 5834: </a>            <span class="php-var">$img</span> = <span class="php-keyword2">imagecreatefrompng</span>(<span class="php-var">$file</span>);
</span><span id="5835" class="l"><a href="#5835"> 5835: </a>            <span class="php-var">$imgalpha</span> = <span class="php-keyword2">imagecreate</span>(<span class="php-var">$wpx</span>, <span class="php-var">$hpx</span>);
</span><span id="5836" class="l"><a href="#5836"> 5836: </a>            <span class="php-comment">// generate gray scale pallete</span>
</span><span id="5837" class="l"><a href="#5837"> 5837: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$c</span> = <span class="php-num">0</span>; <span class="php-var">$c</span> &lt; <span class="php-num">256</span>; ++<span class="php-var">$c</span>) {
</span><span id="5838" class="l"><a href="#5838"> 5838: </a>                <span class="php-keyword2">ImageColorAllocate</span>(<span class="php-var">$imgalpha</span>, <span class="php-var">$c</span>, <span class="php-var">$c</span>, <span class="php-var">$c</span>);
</span><span id="5839" class="l"><a href="#5839"> 5839: </a>            }
</span><span id="5840" class="l"><a href="#5840"> 5840: </a>            <span class="php-comment">// extract alpha channel</span>
</span><span id="5841" class="l"><a href="#5841"> 5841: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$xpx</span> = <span class="php-num">0</span>; <span class="php-var">$xpx</span> &lt; <span class="php-var">$wpx</span>; ++<span class="php-var">$xpx</span>) {
</span><span id="5842" class="l"><a href="#5842"> 5842: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$ypx</span> = <span class="php-num">0</span>; <span class="php-var">$ypx</span> &lt; <span class="php-var">$hpx</span>; ++<span class="php-var">$ypx</span>) {
</span><span id="5843" class="l"><a href="#5843"> 5843: </a>                    <span class="php-var">$colorindex</span> = <span class="php-keyword2">imagecolorat</span>(<span class="php-var">$img</span>, <span class="php-var">$xpx</span>, <span class="php-var">$ypx</span>);
</span><span id="5844" class="l"><a href="#5844"> 5844: </a>                    <span class="php-var">$col</span> = <span class="php-keyword2">imagecolorsforindex</span>(<span class="php-var">$img</span>, <span class="php-var">$colorindex</span>);
</span><span id="5845" class="l"><a href="#5845"> 5845: </a>                    <span class="php-keyword2">imagesetpixel</span>(<span class="php-var">$imgalpha</span>, <span class="php-var">$xpx</span>, <span class="php-var">$ypx</span>, <span class="php-var">$this</span>-&gt;getGDgamma((<span class="php-num">127</span> - <span class="php-var">$col</span>[<span class="php-quote">'alpha'</span>]) * <span class="php-num">255</span> / <span class="php-num">127</span>));
</span><span id="5846" class="l"><a href="#5846"> 5846: </a>                }
</span><span id="5847" class="l"><a href="#5847"> 5847: </a>            }
</span><span id="5848" class="l"><a href="#5848"> 5848: </a>            <span class="php-comment">// create temp alpha file</span>
</span><span id="5849" class="l"><a href="#5849"> 5849: </a>            <span class="php-var">$tempfile_alpha</span> = <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-quote">'mska_'</span>);
</span><span id="5850" class="l"><a href="#5850"> 5850: </a>            <span class="php-keyword2">imagepng</span>(<span class="php-var">$imgalpha</span>, <span class="php-var">$tempfile_alpha</span>);
</span><span id="5851" class="l"><a href="#5851"> 5851: </a>            <span class="php-keyword2">imagedestroy</span>(<span class="php-var">$imgalpha</span>);
</span><span id="5852" class="l"><a href="#5852"> 5852: </a>            <span class="php-comment">// extract image without alpha channel</span>
</span><span id="5853" class="l"><a href="#5853"> 5853: </a>            <span class="php-var">$imgplain</span> = <span class="php-keyword2">imagecreatetruecolor</span>(<span class="php-var">$wpx</span>, <span class="php-var">$hpx</span>);
</span><span id="5854" class="l"><a href="#5854"> 5854: </a>            <span class="php-keyword2">imagecopy</span>(<span class="php-var">$imgplain</span>, <span class="php-var">$img</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$wpx</span>, <span class="php-var">$hpx</span>);
</span><span id="5855" class="l"><a href="#5855"> 5855: </a>            <span class="php-comment">// create temp image file</span>
</span><span id="5856" class="l"><a href="#5856"> 5856: </a>            <span class="php-var">$tempfile_plain</span> = <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-quote">'mskp_'</span>);
</span><span id="5857" class="l"><a href="#5857"> 5857: </a>            <span class="php-keyword2">imagepng</span>(<span class="php-var">$imgplain</span>, <span class="php-var">$tempfile_plain</span>);
</span><span id="5858" class="l"><a href="#5858"> 5858: </a>            <span class="php-keyword2">imagedestroy</span>(<span class="php-var">$imgplain</span>);
</span><span id="5859" class="l"><a href="#5859"> 5859: </a>            <span class="php-comment">// embed mask image</span>
</span><span id="5860" class="l"><a href="#5860"> 5860: </a>            <span class="php-var">$imgmask</span> = <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$tempfile_alpha</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'PNG'</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-var">$resize</span>, <span class="php-var">$dpi</span>, <span class="php-quote">''</span>, <span class="php-keyword1">true</span>, <span class="php-keyword1">false</span>);
</span><span id="5861" class="l"><a href="#5861"> 5861: </a>            <span class="php-comment">// embed image, masked with previously embedded mask</span>
</span><span id="5862" class="l"><a href="#5862"> 5862: </a>            <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$tempfile_plain</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$type</span>, <span class="php-var">$link</span>, <span class="php-var">$align</span>, <span class="php-var">$resize</span>, <span class="php-var">$dpi</span>, <span class="php-var">$palign</span>, <span class="php-keyword1">false</span>, <span class="php-var">$imgmask</span>);
</span><span id="5863" class="l"><a href="#5863"> 5863: </a>            <span class="php-comment">// remove temp files</span>
</span><span id="5864" class="l"><a href="#5864"> 5864: </a>            <span class="php-keyword2">unlink</span>(<span class="php-var">$tempfile_alpha</span>);
</span><span id="5865" class="l"><a href="#5865"> 5865: </a>            <span class="php-keyword2">unlink</span>(<span class="php-var">$tempfile_plain</span>);
</span><span id="5866" class="l"><a href="#5866"> 5866: </a>        }
</span><span id="5867" class="l"><a href="#5867"> 5867: </a>
</span><span id="5868" class="l"><a href="#5868"> 5868: </a>        <span class="php-comment">/**
</span></span><span id="5869" class="l"><a href="#5869"> 5869: </a><span class="php-comment">         * Correct the gamma value to be used with GD library
</span></span><span id="5870" class="l"><a href="#5870"> 5870: </a><span class="php-comment">         * @param float $v the gamma value to be corrected
</span></span><span id="5871" class="l"><a href="#5871"> 5871: </a><span class="php-comment">         * @access protected
</span></span><span id="5872" class="l"><a href="#5872"> 5872: </a><span class="php-comment">         * @since 4.3.007 (2008-12-04)
</span></span><span id="5873" class="l"><a href="#5873"> 5873: </a><span class="php-comment">         */</span>
</span><span id="5874" class="l"><a href="#5874"> 5874: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getGDgamma(<span class="php-var">$v</span>) {
</span><span id="5875" class="l"><a href="#5875"> 5875: </a>            <span class="php-keyword1">return</span> (<span class="php-keyword2">pow</span>((<span class="php-var">$v</span> / <span class="php-num">255</span>), <span class="php-num">2.2</span>) * <span class="php-num">255</span>);
</span><span id="5876" class="l"><a href="#5876"> 5876: </a>        }
</span><span id="5877" class="l"><a href="#5877"> 5877: </a>
</span><span id="5878" class="l"><a href="#5878"> 5878: </a>        <span class="php-comment">/**
</span></span><span id="5879" class="l"><a href="#5879"> 5879: </a><span class="php-comment">         * Performs a line break.
</span></span><span id="5880" class="l"><a href="#5880"> 5880: </a><span class="php-comment">         * The current abscissa goes back to the left margin and the ordinate increases by the amount passed in parameter.
</span></span><span id="5881" class="l"><a href="#5881"> 5881: </a><span class="php-comment">         * @param float $h The height of the break. By default, the value equals the height of the last printed cell.
</span></span><span id="5882" class="l"><a href="#5882"> 5882: </a><span class="php-comment">         * @param boolean $cell if true add a cMargin to the x coordinate
</span></span><span id="5883" class="l"><a href="#5883"> 5883: </a><span class="php-comment">         * @access public
</span></span><span id="5884" class="l"><a href="#5884"> 5884: </a><span class="php-comment">         * @since 1.0
</span></span><span id="5885" class="l"><a href="#5885"> 5885: </a><span class="php-comment">         * @see Cell()
</span></span><span id="5886" class="l"><a href="#5886"> 5886: </a><span class="php-comment">         */</span>
</span><span id="5887" class="l"><a href="#5887"> 5887: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Ln(<span class="php-var">$h</span>=<span class="php-quote">''</span>, <span class="php-var">$cell</span>=<span class="php-keyword1">false</span>) {
</span><span id="5888" class="l"><a href="#5888"> 5888: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;num_columns &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;y == <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$this</span>-&gt;current_column][<span class="php-quote">'y'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;columns[<span class="php-var">$this</span>-&gt;current_column][<span class="php-quote">'x'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;x == <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$this</span>-&gt;current_column][<span class="php-quote">'x'</span>])) {
</span><span id="5889" class="l"><a href="#5889"> 5889: </a>                <span class="php-comment">// revove vertical space from the top of the column</span>
</span><span id="5890" class="l"><a href="#5890"> 5890: </a>                <span class="php-keyword1">return</span>;
</span><span id="5891" class="l"><a href="#5891"> 5891: </a>            }
</span><span id="5892" class="l"><a href="#5892"> 5892: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$cell</span>) {
</span><span id="5893" class="l"><a href="#5893"> 5893: </a>                <span class="php-var">$cellmargin</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="5894" class="l"><a href="#5894"> 5894: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5895" class="l"><a href="#5895"> 5895: </a>                <span class="php-var">$cellmargin</span> = <span class="php-num">0</span>;
</span><span id="5896" class="l"><a href="#5896"> 5896: </a>            }
</span><span id="5897" class="l"><a href="#5897"> 5897: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5898" class="l"><a href="#5898"> 5898: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$cellmargin</span>;
</span><span id="5899" class="l"><a href="#5899"> 5899: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5900" class="l"><a href="#5900"> 5900: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;lMargin + <span class="php-var">$cellmargin</span>;
</span><span id="5901" class="l"><a href="#5901"> 5901: </a>            }
</span><span id="5902" class="l"><a href="#5902"> 5902: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$h</span>)) {
</span><span id="5903" class="l"><a href="#5903"> 5903: </a>                <span class="php-var">$this</span>-&gt;y += <span class="php-var">$this</span>-&gt;lasth;
</span><span id="5904" class="l"><a href="#5904"> 5904: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5905" class="l"><a href="#5905"> 5905: </a>                <span class="php-var">$this</span>-&gt;y += <span class="php-var">$h</span>;
</span><span id="5906" class="l"><a href="#5906"> 5906: </a>            }
</span><span id="5907" class="l"><a href="#5907"> 5907: </a>            <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">true</span>;
</span><span id="5908" class="l"><a href="#5908"> 5908: </a>        }
</span><span id="5909" class="l"><a href="#5909"> 5909: </a>
</span><span id="5910" class="l"><a href="#5910"> 5910: </a>        <span class="php-comment">/**
</span></span><span id="5911" class="l"><a href="#5911"> 5911: </a><span class="php-comment">         * Returns the relative X value of current position.
</span></span><span id="5912" class="l"><a href="#5912"> 5912: </a><span class="php-comment">         * The value is relative to the left border for LTR languages and to the right border for RTL languages.
</span></span><span id="5913" class="l"><a href="#5913"> 5913: </a><span class="php-comment">         * @return float
</span></span><span id="5914" class="l"><a href="#5914"> 5914: </a><span class="php-comment">         * @access public
</span></span><span id="5915" class="l"><a href="#5915"> 5915: </a><span class="php-comment">         * @since 1.2
</span></span><span id="5916" class="l"><a href="#5916"> 5916: </a><span class="php-comment">         * @see SetX(), GetY(), SetY()
</span></span><span id="5917" class="l"><a href="#5917"> 5917: </a><span class="php-comment">         */</span>
</span><span id="5918" class="l"><a href="#5918"> 5918: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetX() {
</span><span id="5919" class="l"><a href="#5919"> 5919: </a>            <span class="php-comment">//Get x position</span>
</span><span id="5920" class="l"><a href="#5920"> 5920: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5921" class="l"><a href="#5921"> 5921: </a>                <span class="php-keyword1">return</span> (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;x);
</span><span id="5922" class="l"><a href="#5922"> 5922: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5923" class="l"><a href="#5923"> 5923: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;x;
</span><span id="5924" class="l"><a href="#5924"> 5924: </a>            }
</span><span id="5925" class="l"><a href="#5925"> 5925: </a>        }
</span><span id="5926" class="l"><a href="#5926"> 5926: </a>
</span><span id="5927" class="l"><a href="#5927"> 5927: </a>        <span class="php-comment">/**
</span></span><span id="5928" class="l"><a href="#5928"> 5928: </a><span class="php-comment">         * Returns the absolute X value of current position.
</span></span><span id="5929" class="l"><a href="#5929"> 5929: </a><span class="php-comment">         * @return float
</span></span><span id="5930" class="l"><a href="#5930"> 5930: </a><span class="php-comment">         * @access public
</span></span><span id="5931" class="l"><a href="#5931"> 5931: </a><span class="php-comment">         * @since 1.2
</span></span><span id="5932" class="l"><a href="#5932"> 5932: </a><span class="php-comment">         * @see SetX(), GetY(), SetY()
</span></span><span id="5933" class="l"><a href="#5933"> 5933: </a><span class="php-comment">         */</span>
</span><span id="5934" class="l"><a href="#5934"> 5934: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetAbsX() {
</span><span id="5935" class="l"><a href="#5935"> 5935: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;x;
</span><span id="5936" class="l"><a href="#5936"> 5936: </a>        }
</span><span id="5937" class="l"><a href="#5937"> 5937: </a>
</span><span id="5938" class="l"><a href="#5938"> 5938: </a>        <span class="php-comment">/**
</span></span><span id="5939" class="l"><a href="#5939"> 5939: </a><span class="php-comment">         * Returns the ordinate of the current position.
</span></span><span id="5940" class="l"><a href="#5940"> 5940: </a><span class="php-comment">         * @return float
</span></span><span id="5941" class="l"><a href="#5941"> 5941: </a><span class="php-comment">         * @access public
</span></span><span id="5942" class="l"><a href="#5942"> 5942: </a><span class="php-comment">         * @since 1.0
</span></span><span id="5943" class="l"><a href="#5943"> 5943: </a><span class="php-comment">         * @see SetY(), GetX(), SetX()
</span></span><span id="5944" class="l"><a href="#5944"> 5944: </a><span class="php-comment">         */</span>
</span><span id="5945" class="l"><a href="#5945"> 5945: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetY() {
</span><span id="5946" class="l"><a href="#5946"> 5946: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;y;
</span><span id="5947" class="l"><a href="#5947"> 5947: </a>        }
</span><span id="5948" class="l"><a href="#5948"> 5948: </a>
</span><span id="5949" class="l"><a href="#5949"> 5949: </a>        <span class="php-comment">/**
</span></span><span id="5950" class="l"><a href="#5950"> 5950: </a><span class="php-comment">         * Defines the abscissa of the current position.
</span></span><span id="5951" class="l"><a href="#5951"> 5951: </a><span class="php-comment">         * If the passed value is negative, it is relative to the right of the page (or left if language is RTL).
</span></span><span id="5952" class="l"><a href="#5952"> 5952: </a><span class="php-comment">         * @param float $x The value of the abscissa.
</span></span><span id="5953" class="l"><a href="#5953"> 5953: </a><span class="php-comment">         * @param boolean $rtloff if true always uses the page top-left corner as origin of axis.
</span></span><span id="5954" class="l"><a href="#5954"> 5954: </a><span class="php-comment">         * @access public
</span></span><span id="5955" class="l"><a href="#5955"> 5955: </a><span class="php-comment">         * @since 1.2
</span></span><span id="5956" class="l"><a href="#5956"> 5956: </a><span class="php-comment">         * @see GetX(), GetY(), SetY(), SetXY()
</span></span><span id="5957" class="l"><a href="#5957"> 5957: </a><span class="php-comment">         */</span>
</span><span id="5958" class="l"><a href="#5958"> 5958: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetX(<span class="php-var">$x</span>, <span class="php-var">$rtloff</span>=<span class="php-keyword1">false</span>) {
</span><span id="5959" class="l"><a href="#5959"> 5959: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$rtloff</span> <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5960" class="l"><a href="#5960"> 5960: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$x</span> &gt;= <span class="php-num">0</span>) {
</span><span id="5961" class="l"><a href="#5961"> 5961: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span>;
</span><span id="5962" class="l"><a href="#5962"> 5962: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5963" class="l"><a href="#5963"> 5963: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-keyword2">abs</span>(<span class="php-var">$x</span>);
</span><span id="5964" class="l"><a href="#5964"> 5964: </a>                }
</span><span id="5965" class="l"><a href="#5965"> 5965: </a>            } <span class="php-keyword1">else</span> {
</span><span id="5966" class="l"><a href="#5966"> 5966: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$x</span> &gt;= <span class="php-num">0</span>) {
</span><span id="5967" class="l"><a href="#5967"> 5967: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$x</span>;
</span><span id="5968" class="l"><a href="#5968"> 5968: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5969" class="l"><a href="#5969"> 5969: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w + <span class="php-var">$x</span>;
</span><span id="5970" class="l"><a href="#5970"> 5970: </a>                }
</span><span id="5971" class="l"><a href="#5971"> 5971: </a>            }
</span><span id="5972" class="l"><a href="#5972"> 5972: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;x &lt; <span class="php-num">0</span>) {
</span><span id="5973" class="l"><a href="#5973"> 5973: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-num">0</span>;
</span><span id="5974" class="l"><a href="#5974"> 5974: </a>            }
</span><span id="5975" class="l"><a href="#5975"> 5975: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;x &gt; <span class="php-var">$this</span>-&gt;w) {
</span><span id="5976" class="l"><a href="#5976"> 5976: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w;
</span><span id="5977" class="l"><a href="#5977"> 5977: </a>            }
</span><span id="5978" class="l"><a href="#5978"> 5978: </a>        }
</span><span id="5979" class="l"><a href="#5979"> 5979: </a>
</span><span id="5980" class="l"><a href="#5980"> 5980: </a>        <span class="php-comment">/**
</span></span><span id="5981" class="l"><a href="#5981"> 5981: </a><span class="php-comment">         * Moves the current abscissa back to the left margin and sets the ordinate.
</span></span><span id="5982" class="l"><a href="#5982"> 5982: </a><span class="php-comment">         * If the passed value is negative, it is relative to the bottom of the page.
</span></span><span id="5983" class="l"><a href="#5983"> 5983: </a><span class="php-comment">         * @param float $y The value of the ordinate.
</span></span><span id="5984" class="l"><a href="#5984"> 5984: </a><span class="php-comment">         * @param bool $resetx if true (default) reset the X position.
</span></span><span id="5985" class="l"><a href="#5985"> 5985: </a><span class="php-comment">         * @param boolean $rtloff if true always uses the page top-left corner as origin of axis.
</span></span><span id="5986" class="l"><a href="#5986"> 5986: </a><span class="php-comment">         * @access public
</span></span><span id="5987" class="l"><a href="#5987"> 5987: </a><span class="php-comment">         * @since 1.0
</span></span><span id="5988" class="l"><a href="#5988"> 5988: </a><span class="php-comment">         * @see GetX(), GetY(), SetY(), SetXY()
</span></span><span id="5989" class="l"><a href="#5989"> 5989: </a><span class="php-comment">         */</span>
</span><span id="5990" class="l"><a href="#5990"> 5990: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetY(<span class="php-var">$y</span>, <span class="php-var">$resetx</span>=<span class="php-keyword1">true</span>, <span class="php-var">$rtloff</span>=<span class="php-keyword1">false</span>) {
</span><span id="5991" class="l"><a href="#5991"> 5991: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$resetx</span>) {
</span><span id="5992" class="l"><a href="#5992"> 5992: </a>                <span class="php-comment">//reset x</span>
</span><span id="5993" class="l"><a href="#5993"> 5993: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$rtloff</span> <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;rtl) {
</span><span id="5994" class="l"><a href="#5994"> 5994: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="5995" class="l"><a href="#5995"> 5995: </a>                } <span class="php-keyword1">else</span> {
</span><span id="5996" class="l"><a href="#5996"> 5996: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="5997" class="l"><a href="#5997"> 5997: </a>                }
</span><span id="5998" class="l"><a href="#5998"> 5998: </a>            }
</span><span id="5999" class="l"><a href="#5999"> 5999: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> &gt;= <span class="php-num">0</span>) {
</span><span id="6000" class="l"><a href="#6000"> 6000: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="6001" class="l"><a href="#6001"> 6001: </a>            } <span class="php-keyword1">else</span> {
</span><span id="6002" class="l"><a href="#6002"> 6002: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;h + <span class="php-var">$y</span>;
</span><span id="6003" class="l"><a href="#6003"> 6003: </a>            }
</span><span id="6004" class="l"><a href="#6004"> 6004: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-num">0</span>) {
</span><span id="6005" class="l"><a href="#6005"> 6005: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-num">0</span>;
</span><span id="6006" class="l"><a href="#6006"> 6006: </a>            }
</span><span id="6007" class="l"><a href="#6007"> 6007: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;y &gt; <span class="php-var">$this</span>-&gt;h) {
</span><span id="6008" class="l"><a href="#6008"> 6008: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;h;
</span><span id="6009" class="l"><a href="#6009"> 6009: </a>            }
</span><span id="6010" class="l"><a href="#6010"> 6010: </a>        }
</span><span id="6011" class="l"><a href="#6011"> 6011: </a>
</span><span id="6012" class="l"><a href="#6012"> 6012: </a>        <span class="php-comment">/**
</span></span><span id="6013" class="l"><a href="#6013"> 6013: </a><span class="php-comment">         * Defines the abscissa and ordinate of the current position.
</span></span><span id="6014" class="l"><a href="#6014"> 6014: </a><span class="php-comment">         * If the passed values are negative, they are relative respectively to the right and bottom of the page.
</span></span><span id="6015" class="l"><a href="#6015"> 6015: </a><span class="php-comment">         * @param float $x The value of the abscissa.
</span></span><span id="6016" class="l"><a href="#6016"> 6016: </a><span class="php-comment">         * @param float $y The value of the ordinate.
</span></span><span id="6017" class="l"><a href="#6017"> 6017: </a><span class="php-comment">         * @param boolean $rtloff if true always uses the page top-left corner as origin of axis.
</span></span><span id="6018" class="l"><a href="#6018"> 6018: </a><span class="php-comment">         * @access public
</span></span><span id="6019" class="l"><a href="#6019"> 6019: </a><span class="php-comment">         * @since 1.2
</span></span><span id="6020" class="l"><a href="#6020"> 6020: </a><span class="php-comment">         * @see SetX(), SetY()
</span></span><span id="6021" class="l"><a href="#6021"> 6021: </a><span class="php-comment">         */</span>
</span><span id="6022" class="l"><a href="#6022"> 6022: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetXY(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$rtloff</span>=<span class="php-keyword1">false</span>) {
</span><span id="6023" class="l"><a href="#6023"> 6023: </a>            <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$y</span>, <span class="php-keyword1">false</span>, <span class="php-var">$rtloff</span>);
</span><span id="6024" class="l"><a href="#6024"> 6024: </a>            <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$x</span>, <span class="php-var">$rtloff</span>);
</span><span id="6025" class="l"><a href="#6025"> 6025: </a>        }
</span><span id="6026" class="l"><a href="#6026"> 6026: </a>
</span><span id="6027" class="l"><a href="#6027"> 6027: </a>        <span class="php-comment">/**
</span></span><span id="6028" class="l"><a href="#6028"> 6028: </a><span class="php-comment">         * Send the document to a given destination: string, local file or browser.
</span></span><span id="6029" class="l"><a href="#6029"> 6029: </a><span class="php-comment">         * In the last case, the plug-in may be used (if present) or a download (&quot;Save as&quot; dialog box) may be forced.&lt;br /&gt;
</span></span><span id="6030" class="l"><a href="#6030"> 6030: </a><span class="php-comment">         * The method first calls Close() if necessary to terminate the document.
</span></span><span id="6031" class="l"><a href="#6031"> 6031: </a><span class="php-comment">         * @param string $name The name of the file when saved. Note that special characters are removed and blanks characters are replaced with the underscore character.
</span></span><span id="6032" class="l"><a href="#6032"> 6032: </a><span class="php-comment">         * @param string $dest Destination where to send the document. It can take one of the following values:&lt;ul&gt;&lt;li&gt;I: send the file inline to the browser (default). The plug-in is used if available. The name given by name is used when one selects the &quot;Save as&quot; option on the link generating the PDF.&lt;/li&gt;&lt;li&gt;D: send to the browser and force a file download with the name given by name.&lt;/li&gt;&lt;li&gt;F: save to a local server file with the name given by name.&lt;/li&gt;&lt;li&gt;S: return the document as a string. name is ignored.&lt;/li&gt;&lt;li&gt;FI: equivalent to F + I option&lt;/li&gt;&lt;li&gt;FD: equivalent to F + D option&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="6033" class="l"><a href="#6033"> 6033: </a><span class="php-comment">         * @access public
</span></span><span id="6034" class="l"><a href="#6034"> 6034: </a><span class="php-comment">         * @since 1.0
</span></span><span id="6035" class="l"><a href="#6035"> 6035: </a><span class="php-comment">         * @see Close()
</span></span><span id="6036" class="l"><a href="#6036"> 6036: </a><span class="php-comment">         */</span>
</span><span id="6037" class="l"><a href="#6037"> 6037: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Output(<span class="php-var">$name</span>=<span class="php-quote">'doc.pdf'</span>, <span class="php-var">$dest</span>=<span class="php-quote">'I'</span>) {
</span><span id="6038" class="l"><a href="#6038"> 6038: </a>            <span class="php-comment">//Output PDF to some destination</span>
</span><span id="6039" class="l"><a href="#6039"> 6039: </a>            <span class="php-comment">//Finish document if necessary</span>
</span><span id="6040" class="l"><a href="#6040"> 6040: </a>            <span class="php-var">$this</span>-&gt;lastpage();
</span><span id="6041" class="l"><a href="#6041"> 6041: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;state &lt; <span class="php-num">3</span>) {
</span><span id="6042" class="l"><a href="#6042"> 6042: </a>                <span class="php-var">$this</span>-&gt;Close();
</span><span id="6043" class="l"><a href="#6043"> 6043: </a>            }
</span><span id="6044" class="l"><a href="#6044"> 6044: </a>            <span class="php-comment">//Normalize parameters</span>
</span><span id="6045" class="l"><a href="#6045"> 6045: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_bool</span>(<span class="php-var">$dest</span>)) {
</span><span id="6046" class="l"><a href="#6046"> 6046: </a>                <span class="php-var">$dest</span> = <span class="php-var">$dest</span> ? <span class="php-quote">'D'</span> : <span class="php-quote">'F'</span>;
</span><span id="6047" class="l"><a href="#6047"> 6047: </a>            }
</span><span id="6048" class="l"><a href="#6048"> 6048: </a>            <span class="php-var">$dest</span> = <span class="php-keyword2">strtoupper</span>(<span class="php-var">$dest</span>);
</span><span id="6049" class="l"><a href="#6049"> 6049: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$dest</span> != <span class="php-quote">'F'</span>) {
</span><span id="6050" class="l"><a href="#6050"> 6050: </a>                <span class="php-var">$name</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]+/'</span>, <span class="php-quote">'_'</span>, <span class="php-var">$name</span>);
</span><span id="6051" class="l"><a href="#6051"> 6051: </a>                <span class="php-var">$name</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[^a-zA-Z0-9_\.-]/'</span>, <span class="php-quote">''</span>, <span class="php-var">$name</span>);
</span><span id="6052" class="l"><a href="#6052"> 6052: </a>            }
</span><span id="6053" class="l"><a href="#6053"> 6053: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;sign) {
</span><span id="6054" class="l"><a href="#6054"> 6054: </a>                <span class="php-comment">// *** apply digital signature to the document ***</span>
</span><span id="6055" class="l"><a href="#6055"> 6055: </a>                <span class="php-comment">// get the document content</span>
</span><span id="6056" class="l"><a href="#6056"> 6056: </a>                <span class="php-var">$pdfdoc</span> = <span class="php-var">$this</span>-&gt;getBuffer();
</span><span id="6057" class="l"><a href="#6057"> 6057: </a>                <span class="php-comment">// remove last newline</span>
</span><span id="6058" class="l"><a href="#6058"> 6058: </a>                <span class="php-var">$pdfdoc</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pdfdoc</span>, <span class="php-num">0</span>, -<span class="php-num">1</span>);
</span><span id="6059" class="l"><a href="#6059"> 6059: </a>                <span class="php-comment">// Remove the original buffer</span>
</span><span id="6060" class="l"><a href="#6060"> 6060: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;diskcache) <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="6061" class="l"><a href="#6061"> 6061: </a>                    <span class="php-comment">// remove buffer file from cache</span>
</span><span id="6062" class="l"><a href="#6062"> 6062: </a>                    <span class="php-keyword2">unlink</span>(<span class="php-var">$this</span>-&gt;buffer);
</span><span id="6063" class="l"><a href="#6063"> 6063: </a>                }
</span><span id="6064" class="l"><a href="#6064"> 6064: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;buffer);
</span><span id="6065" class="l"><a href="#6065"> 6065: </a>                <span class="php-comment">// remove filler space</span>
</span><span id="6066" class="l"><a href="#6066"> 6066: </a>                <span class="php-var">$byterange_string_len</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$this</span>-&gt;byterange_string);
</span><span id="6067" class="l"><a href="#6067"> 6067: </a>                <span class="php-comment">// define the ByteRange</span>
</span><span id="6068" class="l"><a href="#6068"> 6068: </a>                <span class="php-var">$byte_range</span> = <span class="php-keyword1">array</span>();
</span><span id="6069" class="l"><a href="#6069"> 6069: </a>                <span class="php-var">$byte_range</span>[<span class="php-num">0</span>] = <span class="php-num">0</span>;
</span><span id="6070" class="l"><a href="#6070"> 6070: </a>                <span class="php-var">$byte_range</span>[<span class="php-num">1</span>] = <span class="php-keyword2">strpos</span>(<span class="php-var">$pdfdoc</span>, <span class="php-var">$this</span>-&gt;byterange_string) + <span class="php-var">$byterange_string_len</span> + <span class="php-num">10</span>;
</span><span id="6071" class="l"><a href="#6071"> 6071: </a>                <span class="php-var">$byte_range</span>[<span class="php-num">2</span>] = <span class="php-var">$byte_range</span>[<span class="php-num">1</span>] + <span class="php-var">$this</span>-&gt;signature_max_length + <span class="php-num">2</span>;
</span><span id="6072" class="l"><a href="#6072"> 6072: </a>                <span class="php-var">$byte_range</span>[<span class="php-num">3</span>] = <span class="php-keyword2">strlen</span>(<span class="php-var">$pdfdoc</span>) - <span class="php-var">$byte_range</span>[<span class="php-num">2</span>];
</span><span id="6073" class="l"><a href="#6073"> 6073: </a>                <span class="php-var">$pdfdoc</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pdfdoc</span>, <span class="php-num">0</span>, <span class="php-var">$byte_range</span>[<span class="php-num">1</span>]).<span class="php-keyword2">substr</span>(<span class="php-var">$pdfdoc</span>, <span class="php-var">$byte_range</span>[<span class="php-num">2</span>]);
</span><span id="6074" class="l"><a href="#6074"> 6074: </a>                <span class="php-comment">// replace the ByteRange</span>
</span><span id="6075" class="l"><a href="#6075"> 6075: </a>                <span class="php-var">$byterange</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/ByteRange[0 %u %u %u]'</span>, <span class="php-var">$byte_range</span>[<span class="php-num">1</span>], <span class="php-var">$byte_range</span>[<span class="php-num">2</span>], <span class="php-var">$byte_range</span>[<span class="php-num">3</span>]);
</span><span id="6076" class="l"><a href="#6076"> 6076: </a>                <span class="php-var">$byterange</span> .= <span class="php-keyword2">str_repeat</span>(<span class="php-quote">' '</span>, (<span class="php-var">$byterange_string_len</span> - <span class="php-keyword2">strlen</span>(<span class="php-var">$byterange</span>)));
</span><span id="6077" class="l"><a href="#6077"> 6077: </a>                <span class="php-var">$pdfdoc</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$this</span>-&gt;byterange_string, <span class="php-var">$byterange</span>, <span class="php-var">$pdfdoc</span>);
</span><span id="6078" class="l"><a href="#6078"> 6078: </a>                <span class="php-comment">// write the document to a temporary folder</span>
</span><span id="6079" class="l"><a href="#6079"> 6079: </a>                <span class="php-var">$tempdoc</span> = <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-quote">'tmppdf_'</span>);
</span><span id="6080" class="l"><a href="#6080"> 6080: </a>                <span class="php-var">$f</span> = <span class="php-keyword2">fopen</span>(<span class="php-var">$tempdoc</span>, <span class="php-quote">'wb'</span>);
</span><span id="6081" class="l"><a href="#6081"> 6081: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$f</span>) {
</span><span id="6082" class="l"><a href="#6082"> 6082: </a>                    <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Unable to create temporary file: '</span>.<span class="php-var">$tempdoc</span>);
</span><span id="6083" class="l"><a href="#6083"> 6083: </a>                }
</span><span id="6084" class="l"><a href="#6084"> 6084: </a>                <span class="php-var">$pdfdoc_length</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$pdfdoc</span>);
</span><span id="6085" class="l"><a href="#6085"> 6085: </a>                <span class="php-keyword2">fwrite</span>(<span class="php-var">$f</span>, <span class="php-var">$pdfdoc</span>, <span class="php-var">$pdfdoc_length</span>);
</span><span id="6086" class="l"><a href="#6086"> 6086: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="6087" class="l"><a href="#6087"> 6087: </a>                <span class="php-comment">// get digital signature via openssl library</span>
</span><span id="6088" class="l"><a href="#6088"> 6088: </a>                <span class="php-var">$tempsign</span> = <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-quote">'tmpsig_'</span>);
</span><span id="6089" class="l"><a href="#6089"> 6089: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'extracerts'</span>])) {
</span><span id="6090" class="l"><a href="#6090"> 6090: </a>                    <span class="php-keyword2">openssl_pkcs7_sign</span>(<span class="php-var">$tempdoc</span>, <span class="php-var">$tempsign</span>, <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'signcert'</span>], <span class="php-keyword1">array</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'privkey'</span>], <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'password'</span>]), <span class="php-keyword1">array</span>(), PKCS7_BINARY | PKCS7_DETACHED);
</span><span id="6091" class="l"><a href="#6091"> 6091: </a>                } <span class="php-keyword1">else</span> {
</span><span id="6092" class="l"><a href="#6092"> 6092: </a>                    <span class="php-keyword2">openssl_pkcs7_sign</span>(<span class="php-var">$tempdoc</span>, <span class="php-var">$tempsign</span>, <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'signcert'</span>], <span class="php-keyword1">array</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'privkey'</span>], <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'password'</span>]), <span class="php-keyword1">array</span>(), PKCS7_BINARY | PKCS7_DETACHED, <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'extracerts'</span>]);
</span><span id="6093" class="l"><a href="#6093"> 6093: </a>                }
</span><span id="6094" class="l"><a href="#6094"> 6094: </a>                <span class="php-keyword2">unlink</span>(<span class="php-var">$tempdoc</span>);
</span><span id="6095" class="l"><a href="#6095"> 6095: </a>                <span class="php-comment">// read signature</span>
</span><span id="6096" class="l"><a href="#6096"> 6096: </a>                <span class="php-var">$signature</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$tempsign</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">null</span>, <span class="php-var">$pdfdoc_length</span>);
</span><span id="6097" class="l"><a href="#6097"> 6097: </a>                <span class="php-keyword2">unlink</span>(<span class="php-var">$tempsign</span>);
</span><span id="6098" class="l"><a href="#6098"> 6098: </a>                <span class="php-comment">// extract signature</span>
</span><span id="6099" class="l"><a href="#6099"> 6099: </a>                <span class="php-var">$signature</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$signature</span>, (<span class="php-keyword2">strpos</span>(<span class="php-var">$signature</span>, <span class="php-quote">&quot;%%EOF\n\n------&quot;</span>) + <span class="php-num">13</span>));
</span><span id="6100" class="l"><a href="#6100"> 6100: </a>                <span class="php-var">$tmparr</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">&quot;\n\n&quot;</span>, <span class="php-var">$signature</span>);
</span><span id="6101" class="l"><a href="#6101"> 6101: </a>                <span class="php-var">$signature</span> = <span class="php-var">$tmparr</span>[<span class="php-num">1</span>];
</span><span id="6102" class="l"><a href="#6102"> 6102: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$tmparr</span>);
</span><span id="6103" class="l"><a href="#6103"> 6103: </a>                <span class="php-comment">// decode signature</span>
</span><span id="6104" class="l"><a href="#6104"> 6104: </a>                <span class="php-var">$signature</span> = <span class="php-keyword2">base64_decode</span>(<span class="php-keyword2">trim</span>(<span class="php-var">$signature</span>));
</span><span id="6105" class="l"><a href="#6105"> 6105: </a>                <span class="php-comment">// convert signature to hex</span>
</span><span id="6106" class="l"><a href="#6106"> 6106: </a>                <span class="php-var">$signature</span> = <span class="php-keyword2">current</span>(<span class="php-keyword2">unpack</span>(<span class="php-quote">'H*'</span>, <span class="php-var">$signature</span>));
</span><span id="6107" class="l"><a href="#6107"> 6107: </a>                <span class="php-var">$signature</span> = <span class="php-keyword2">str_pad</span>(<span class="php-var">$signature</span>, <span class="php-var">$this</span>-&gt;signature_max_length, <span class="php-quote">'0'</span>);
</span><span id="6108" class="l"><a href="#6108"> 6108: </a>                <span class="php-comment">// Add signature to the document</span>
</span><span id="6109" class="l"><a href="#6109"> 6109: </a>                <span class="php-var">$pdfdoc</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pdfdoc</span>, <span class="php-num">0</span>, <span class="php-var">$byte_range</span>[<span class="php-num">1</span>]).<span class="php-quote">'&lt;'</span>.<span class="php-var">$signature</span>.<span class="php-quote">'&gt;'</span>.<span class="php-keyword2">substr</span>(<span class="php-var">$pdfdoc</span>, (<span class="php-var">$byte_range</span>[<span class="php-num">1</span>]));
</span><span id="6110" class="l"><a href="#6110"> 6110: </a>                <span class="php-var">$this</span>-&gt;diskcache = <span class="php-keyword1">false</span>;
</span><span id="6111" class="l"><a href="#6111"> 6111: </a>                <span class="php-var">$this</span>-&gt;buffer = &amp;<span class="php-var">$pdfdoc</span>;
</span><span id="6112" class="l"><a href="#6112"> 6112: </a>                <span class="php-var">$this</span>-&gt;bufferlen = <span class="php-keyword2">strlen</span>(<span class="php-var">$pdfdoc</span>);
</span><span id="6113" class="l"><a href="#6113"> 6113: </a>            }
</span><span id="6114" class="l"><a href="#6114"> 6114: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$dest</span>) {
</span><span id="6115" class="l"><a href="#6115"> 6115: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'I'</span>: {
</span><span id="6116" class="l"><a href="#6116"> 6116: </a>                    <span class="php-comment">// Send PDF to the standard output</span>
</span><span id="6117" class="l"><a href="#6117"> 6117: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">ob_get_contents</span>()) {
</span><span id="6118" class="l"><a href="#6118"> 6118: </a>                        <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Some data has already been output, can\'t send PDF file'</span>);
</span><span id="6119" class="l"><a href="#6119"> 6119: </a>                    }
</span><span id="6120" class="l"><a href="#6120"> 6120: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">php_sapi_name</span>() != <span class="php-quote">'cli'</span>) {
</span><span id="6121" class="l"><a href="#6121"> 6121: </a>                        <span class="php-comment">//We send to a browser</span>
</span><span id="6122" class="l"><a href="#6122"> 6122: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/pdf'</span>);
</span><span id="6123" class="l"><a href="#6123"> 6123: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">headers_sent</span>()) {
</span><span id="6124" class="l"><a href="#6124"> 6124: </a>                            <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Some data has already been output to browser, can\'t send PDF file'</span>);
</span><span id="6125" class="l"><a href="#6125"> 6125: </a>                        }
</span><span id="6126" class="l"><a href="#6126"> 6126: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Cache-Control: public, must-revalidate, max-age=0'</span>); <span class="php-comment">// HTTP/1.1</span>
</span><span id="6127" class="l"><a href="#6127"> 6127: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Pragma: public'</span>);
</span><span id="6128" class="l"><a href="#6128"> 6128: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Expires: Sat, 26 Jul 1997 05:00:00 GMT'</span>); <span class="php-comment">// Date in the past</span>
</span><span id="6129" class="l"><a href="#6129"> 6129: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Last-Modified: '</span>.<span class="php-keyword2">gmdate</span>(<span class="php-quote">'D, d M Y H:i:s'</span>).<span class="php-quote">' GMT'</span>);
</span><span id="6130" class="l"><a href="#6130"> 6130: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Length: '</span>.<span class="php-var">$this</span>-&gt;bufferlen);
</span><span id="6131" class="l"><a href="#6131"> 6131: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Disposition: inline; filename=&quot;'</span>.<span class="php-keyword2">basename</span>(<span class="php-var">$name</span>).<span class="php-quote">'&quot;;'</span>);
</span><span id="6132" class="l"><a href="#6132"> 6132: </a>                    }
</span><span id="6133" class="l"><a href="#6133"> 6133: </a>                    <span class="php-keyword1">echo</span> <span class="php-var">$this</span>-&gt;getBuffer();
</span><span id="6134" class="l"><a href="#6134"> 6134: </a>                    <span class="php-keyword1">break</span>;
</span><span id="6135" class="l"><a href="#6135"> 6135: </a>                }
</span><span id="6136" class="l"><a href="#6136"> 6136: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'D'</span>: {
</span><span id="6137" class="l"><a href="#6137"> 6137: </a>                    <span class="php-comment">// Download PDF as file</span>
</span><span id="6138" class="l"><a href="#6138"> 6138: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">ob_get_contents</span>()) {
</span><span id="6139" class="l"><a href="#6139"> 6139: </a>                        <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Some data has already been output, can\'t send PDF file'</span>);
</span><span id="6140" class="l"><a href="#6140"> 6140: </a>                    }
</span><span id="6141" class="l"><a href="#6141"> 6141: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Description: File Transfer'</span>);
</span><span id="6142" class="l"><a href="#6142"> 6142: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">headers_sent</span>()) {
</span><span id="6143" class="l"><a href="#6143"> 6143: </a>                        <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Some data has already been output to browser, can\'t send PDF file'</span>);
</span><span id="6144" class="l"><a href="#6144"> 6144: </a>                    }
</span><span id="6145" class="l"><a href="#6145"> 6145: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Cache-Control: public, must-revalidate, max-age=0'</span>); <span class="php-comment">// HTTP/1.1</span>
</span><span id="6146" class="l"><a href="#6146"> 6146: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Pragma: public'</span>);
</span><span id="6147" class="l"><a href="#6147"> 6147: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Expires: Sat, 26 Jul 1997 05:00:00 GMT'</span>); <span class="php-comment">// Date in the past</span>
</span><span id="6148" class="l"><a href="#6148"> 6148: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Last-Modified: '</span>.<span class="php-keyword2">gmdate</span>(<span class="php-quote">'D, d M Y H:i:s'</span>).<span class="php-quote">' GMT'</span>);
</span><span id="6149" class="l"><a href="#6149"> 6149: </a>                    <span class="php-comment">// force download dialog</span>
</span><span id="6150" class="l"><a href="#6150"> 6150: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/force-download'</span>);
</span><span id="6151" class="l"><a href="#6151"> 6151: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/octet-stream'</span>, <span class="php-keyword1">false</span>);
</span><span id="6152" class="l"><a href="#6152"> 6152: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/download'</span>, <span class="php-keyword1">false</span>);
</span><span id="6153" class="l"><a href="#6153"> 6153: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/pdf'</span>, <span class="php-keyword1">false</span>);
</span><span id="6154" class="l"><a href="#6154"> 6154: </a>                    <span class="php-comment">// use the Content-Disposition header to supply a recommended filename</span>
</span><span id="6155" class="l"><a href="#6155"> 6155: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Disposition: attachment; filename=&quot;'</span>.<span class="php-keyword2">basename</span>(<span class="php-var">$name</span>).<span class="php-quote">'&quot;;'</span>);
</span><span id="6156" class="l"><a href="#6156"> 6156: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Transfer-Encoding: binary'</span>);
</span><span id="6157" class="l"><a href="#6157"> 6157: </a>                    <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Length: '</span>.<span class="php-var">$this</span>-&gt;bufferlen);
</span><span id="6158" class="l"><a href="#6158"> 6158: </a>                    <span class="php-keyword1">echo</span> <span class="php-var">$this</span>-&gt;getBuffer();
</span><span id="6159" class="l"><a href="#6159"> 6159: </a>                    <span class="php-keyword1">break</span>;
</span><span id="6160" class="l"><a href="#6160"> 6160: </a>                }
</span><span id="6161" class="l"><a href="#6161"> 6161: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'F'</span>:
</span><span id="6162" class="l"><a href="#6162"> 6162: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'FI'</span>:
</span><span id="6163" class="l"><a href="#6163"> 6163: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'FD'</span>: {
</span><span id="6164" class="l"><a href="#6164"> 6164: </a>                    <span class="php-comment">// Save PDF to a local file</span>
</span><span id="6165" class="l"><a href="#6165"> 6165: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="6166" class="l"><a href="#6166"> 6166: </a>                        <span class="php-keyword2">copy</span>(<span class="php-var">$this</span>-&gt;buffer, <span class="php-var">$name</span>);
</span><span id="6167" class="l"><a href="#6167"> 6167: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="6168" class="l"><a href="#6168"> 6168: </a>                        <span class="php-var">$f</span> = <span class="php-keyword2">fopen</span>(<span class="php-var">$name</span>, <span class="php-quote">'wb'</span>);
</span><span id="6169" class="l"><a href="#6169"> 6169: </a>                        <span class="php-keyword1">if</span> (!<span class="php-var">$f</span>) {
</span><span id="6170" class="l"><a href="#6170"> 6170: </a>                            <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Unable to create output file: '</span>.<span class="php-var">$name</span>);
</span><span id="6171" class="l"><a href="#6171"> 6171: </a>                        }
</span><span id="6172" class="l"><a href="#6172"> 6172: </a>                        <span class="php-keyword2">fwrite</span>(<span class="php-var">$f</span>, <span class="php-var">$this</span>-&gt;getBuffer(), <span class="php-var">$this</span>-&gt;bufferlen);
</span><span id="6173" class="l"><a href="#6173"> 6173: </a>                        <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="6174" class="l"><a href="#6174"> 6174: </a>                    }
</span><span id="6175" class="l"><a href="#6175"> 6175: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$dest</span> == <span class="php-quote">'FI'</span>) {
</span><span id="6176" class="l"><a href="#6176"> 6176: </a>                        <span class="php-comment">// send headers to browser</span>
</span><span id="6177" class="l"><a href="#6177"> 6177: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/pdf'</span>);
</span><span id="6178" class="l"><a href="#6178"> 6178: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Cache-Control: public, must-revalidate, max-age=0'</span>); <span class="php-comment">// HTTP/1.1</span>
</span><span id="6179" class="l"><a href="#6179"> 6179: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Pragma: public'</span>);
</span><span id="6180" class="l"><a href="#6180"> 6180: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Expires: Sat, 26 Jul 1997 05:00:00 GMT'</span>); <span class="php-comment">// Date in the past</span>
</span><span id="6181" class="l"><a href="#6181"> 6181: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Last-Modified: '</span>.<span class="php-keyword2">gmdate</span>(<span class="php-quote">'D, d M Y H:i:s'</span>).<span class="php-quote">' GMT'</span>);
</span><span id="6182" class="l"><a href="#6182"> 6182: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Length: '</span>.<span class="php-keyword2">filesize</span>(<span class="php-var">$name</span>));
</span><span id="6183" class="l"><a href="#6183"> 6183: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Disposition: inline; filename=&quot;'</span>.<span class="php-keyword2">basename</span>(<span class="php-var">$name</span>).<span class="php-quote">'&quot;;'</span>);
</span><span id="6184" class="l"><a href="#6184"> 6184: </a>                        <span class="php-comment">// send document to the browser</span>
</span><span id="6185" class="l"><a href="#6185"> 6185: </a>                        <span class="php-keyword1">echo</span> <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$name</span>);
</span><span id="6186" class="l"><a href="#6186"> 6186: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$dest</span> == <span class="php-quote">'FD'</span>) {
</span><span id="6187" class="l"><a href="#6187"> 6187: </a>                        <span class="php-comment">// send headers to browser</span>
</span><span id="6188" class="l"><a href="#6188"> 6188: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">ob_get_contents</span>()) {
</span><span id="6189" class="l"><a href="#6189"> 6189: </a>                            <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Some data has already been output, can\'t send PDF file'</span>);
</span><span id="6190" class="l"><a href="#6190"> 6190: </a>                        }
</span><span id="6191" class="l"><a href="#6191"> 6191: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Description: File Transfer'</span>);
</span><span id="6192" class="l"><a href="#6192"> 6192: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">headers_sent</span>()) {
</span><span id="6193" class="l"><a href="#6193"> 6193: </a>                            <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Some data has already been output to browser, can\'t send PDF file'</span>);
</span><span id="6194" class="l"><a href="#6194"> 6194: </a>                        }
</span><span id="6195" class="l"><a href="#6195"> 6195: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Cache-Control: public, must-revalidate, max-age=0'</span>); <span class="php-comment">// HTTP/1.1</span>
</span><span id="6196" class="l"><a href="#6196"> 6196: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Pragma: public'</span>);
</span><span id="6197" class="l"><a href="#6197"> 6197: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Expires: Sat, 26 Jul 1997 05:00:00 GMT'</span>); <span class="php-comment">// Date in the past</span>
</span><span id="6198" class="l"><a href="#6198"> 6198: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Last-Modified: '</span>.<span class="php-keyword2">gmdate</span>(<span class="php-quote">'D, d M Y H:i:s'</span>).<span class="php-quote">' GMT'</span>);
</span><span id="6199" class="l"><a href="#6199"> 6199: </a>                        <span class="php-comment">// force download dialog</span>
</span><span id="6200" class="l"><a href="#6200"> 6200: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/force-download'</span>);
</span><span id="6201" class="l"><a href="#6201"> 6201: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/octet-stream'</span>, <span class="php-keyword1">false</span>);
</span><span id="6202" class="l"><a href="#6202"> 6202: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/download'</span>, <span class="php-keyword1">false</span>);
</span><span id="6203" class="l"><a href="#6203"> 6203: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Type: application/pdf'</span>, <span class="php-keyword1">false</span>);
</span><span id="6204" class="l"><a href="#6204"> 6204: </a>                        <span class="php-comment">// use the Content-Disposition header to supply a recommended filename</span>
</span><span id="6205" class="l"><a href="#6205"> 6205: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Disposition: attachment; filename=&quot;'</span>.<span class="php-keyword2">basename</span>(<span class="php-var">$name</span>).<span class="php-quote">'&quot;;'</span>);
</span><span id="6206" class="l"><a href="#6206"> 6206: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Transfer-Encoding: binary'</span>);
</span><span id="6207" class="l"><a href="#6207"> 6207: </a>                        <span class="php-keyword2">header</span>(<span class="php-quote">'Content-Length: '</span>.<span class="php-keyword2">filesize</span>(<span class="php-var">$name</span>));
</span><span id="6208" class="l"><a href="#6208"> 6208: </a>                        <span class="php-comment">// send document to the browser</span>
</span><span id="6209" class="l"><a href="#6209"> 6209: </a>                        <span class="php-keyword1">echo</span> <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$name</span>);
</span><span id="6210" class="l"><a href="#6210"> 6210: </a>                    }
</span><span id="6211" class="l"><a href="#6211"> 6211: </a>                    <span class="php-keyword1">break</span>;
</span><span id="6212" class="l"><a href="#6212"> 6212: </a>                }
</span><span id="6213" class="l"><a href="#6213"> 6213: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'S'</span>: {
</span><span id="6214" class="l"><a href="#6214"> 6214: </a>                    <span class="php-comment">// Returns PDF as a string</span>
</span><span id="6215" class="l"><a href="#6215"> 6215: </a>                    <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;getBuffer();
</span><span id="6216" class="l"><a href="#6216"> 6216: </a>                }
</span><span id="6217" class="l"><a href="#6217"> 6217: </a>                <span class="php-keyword1">default</span>: {
</span><span id="6218" class="l"><a href="#6218"> 6218: </a>                    <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Incorrect output destination: '</span>.<span class="php-var">$dest</span>);
</span><span id="6219" class="l"><a href="#6219"> 6219: </a>                }
</span><span id="6220" class="l"><a href="#6220"> 6220: </a>            }
</span><span id="6221" class="l"><a href="#6221"> 6221: </a>            <span class="php-keyword1">return</span> <span class="php-quote">''</span>;
</span><span id="6222" class="l"><a href="#6222"> 6222: </a>        }
</span><span id="6223" class="l"><a href="#6223"> 6223: </a>
</span><span id="6224" class="l"><a href="#6224"> 6224: </a>        <span class="php-comment">/**
</span></span><span id="6225" class="l"><a href="#6225"> 6225: </a><span class="php-comment">         * Unset all class variables except the following critical variables: internal_encoding, state, bufferlen, buffer and diskcache.
</span></span><span id="6226" class="l"><a href="#6226"> 6226: </a><span class="php-comment">         * @param boolean $destroyall if true destroys all class variables, otherwise preserves critical variables.
</span></span><span id="6227" class="l"><a href="#6227"> 6227: </a><span class="php-comment">         * @param boolean $preserve_objcopy if true preserves the objcopy variable
</span></span><span id="6228" class="l"><a href="#6228"> 6228: </a><span class="php-comment">         * @access public
</span></span><span id="6229" class="l"><a href="#6229"> 6229: </a><span class="php-comment">         * @since 4.5.016 (2009-02-24)
</span></span><span id="6230" class="l"><a href="#6230"> 6230: </a><span class="php-comment">         */</span>
</span><span id="6231" class="l"><a href="#6231"> 6231: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> _destroy(<span class="php-var">$destroyall</span>=<span class="php-keyword1">false</span>, <span class="php-var">$preserve_objcopy</span>=<span class="php-keyword1">false</span>) {
</span><span id="6232" class="l"><a href="#6232"> 6232: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$destroyall</span> <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;diskcache) <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;diskcache <span class="php-keyword1">AND</span> (!<span class="php-var">$preserve_objcopy</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;buffer))) {
</span><span id="6233" class="l"><a href="#6233"> 6233: </a>                <span class="php-comment">// remove buffer file from cache</span>
</span><span id="6234" class="l"><a href="#6234"> 6234: </a>                <span class="php-keyword2">unlink</span>(<span class="php-var">$this</span>-&gt;buffer);
</span><span id="6235" class="l"><a href="#6235"> 6235: </a>            }
</span><span id="6236" class="l"><a href="#6236"> 6236: </a>            <span class="php-keyword1">foreach</span> (<span class="php-keyword2">array_keys</span>(<span class="php-keyword2">get_object_vars</span>(<span class="php-var">$this</span>)) <span class="php-keyword1">as</span> <span class="php-var">$val</span>) {
</span><span id="6237" class="l"><a href="#6237"> 6237: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$destroyall</span> <span class="php-keyword1">OR</span> (
</span><span id="6238" class="l"><a href="#6238"> 6238: </a>                    (<span class="php-var">$val</span> != <span class="php-quote">'internal_encoding'</span>)
</span><span id="6239" class="l"><a href="#6239"> 6239: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'state'</span>)
</span><span id="6240" class="l"><a href="#6240"> 6240: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'bufferlen'</span>)
</span><span id="6241" class="l"><a href="#6241"> 6241: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'buffer'</span>)
</span><span id="6242" class="l"><a href="#6242"> 6242: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'diskcache'</span>)
</span><span id="6243" class="l"><a href="#6243"> 6243: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'sign'</span>)
</span><span id="6244" class="l"><a href="#6244"> 6244: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'signature_data'</span>)
</span><span id="6245" class="l"><a href="#6245"> 6245: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'signature_max_length'</span>)
</span><span id="6246" class="l"><a href="#6246"> 6246: </a>                    <span class="php-keyword1">AND</span> (<span class="php-var">$val</span> != <span class="php-quote">'byterange_string'</span>)
</span><span id="6247" class="l"><a href="#6247"> 6247: </a>                    )) {
</span><span id="6248" class="l"><a href="#6248"> 6248: </a>                    <span class="php-keyword1">if</span> ((!<span class="php-var">$preserve_objcopy</span> <span class="php-keyword1">OR</span> (<span class="php-var">$val</span> != <span class="php-quote">'objcopy'</span>)) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;<span class="php-var">$val</span>)) {
</span><span id="6249" class="l"><a href="#6249"> 6249: </a>                        <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;<span class="php-var">$val</span>);
</span><span id="6250" class="l"><a href="#6250"> 6250: </a>                    }
</span><span id="6251" class="l"><a href="#6251"> 6251: </a>                }
</span><span id="6252" class="l"><a href="#6252"> 6252: </a>            }
</span><span id="6253" class="l"><a href="#6253"> 6253: </a>        }
</span><span id="6254" class="l"><a href="#6254"> 6254: </a>
</span><span id="6255" class="l"><a href="#6255"> 6255: </a>        <span class="php-comment">/**
</span></span><span id="6256" class="l"><a href="#6256"> 6256: </a><span class="php-comment">         * Check for locale-related bug
</span></span><span id="6257" class="l"><a href="#6257"> 6257: </a><span class="php-comment">         * @access protected
</span></span><span id="6258" class="l"><a href="#6258"> 6258: </a><span class="php-comment">         */</span>
</span><span id="6259" class="l"><a href="#6259"> 6259: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dochecks() {
</span><span id="6260" class="l"><a href="#6260"> 6260: </a>            <span class="php-comment">//Check for locale-related bug</span>
</span><span id="6261" class="l"><a href="#6261"> 6261: </a>            <span class="php-keyword1">if</span> (<span class="php-num">1.1</span> == <span class="php-num">1</span>) {
</span><span id="6262" class="l"><a href="#6262"> 6262: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Don\'t alter the locale before including class file'</span>);
</span><span id="6263" class="l"><a href="#6263"> 6263: </a>            }
</span><span id="6264" class="l"><a href="#6264"> 6264: </a>            <span class="php-comment">//Check for decimal separator</span>
</span><span id="6265" class="l"><a href="#6265"> 6265: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.1F'</span>, <span class="php-num">1.0</span>) != <span class="php-quote">'1.0'</span>) {
</span><span id="6266" class="l"><a href="#6266"> 6266: </a>                <span class="php-keyword2">setlocale</span>(LC_NUMERIC, <span class="php-quote">'C'</span>);
</span><span id="6267" class="l"><a href="#6267"> 6267: </a>            }
</span><span id="6268" class="l"><a href="#6268"> 6268: </a>        }
</span><span id="6269" class="l"><a href="#6269"> 6269: </a>
</span><span id="6270" class="l"><a href="#6270"> 6270: </a>        <span class="php-comment">/**
</span></span><span id="6271" class="l"><a href="#6271"> 6271: </a><span class="php-comment">         * Return fonts path
</span></span><span id="6272" class="l"><a href="#6272"> 6272: </a><span class="php-comment">         * @return string
</span></span><span id="6273" class="l"><a href="#6273"> 6273: </a><span class="php-comment">         * @access protected
</span></span><span id="6274" class="l"><a href="#6274"> 6274: </a><span class="php-comment">         */</span>
</span><span id="6275" class="l"><a href="#6275"> 6275: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _getfontpath() {
</span><span id="6276" class="l"><a href="#6276"> 6276: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">defined</span>(<span class="php-quote">'K_PATH_FONTS'</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_dir</span>(<span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/fonts'</span>)) {
</span><span id="6277" class="l"><a href="#6277"> 6277: </a>                <span class="php-keyword2">define</span>(<span class="php-quote">'K_PATH_FONTS'</span>, <span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/fonts/'</span>);
</span><span id="6278" class="l"><a href="#6278"> 6278: </a>            }
</span><span id="6279" class="l"><a href="#6279"> 6279: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">defined</span>(<span class="php-quote">'K_PATH_FONTS'</span>) ? K_PATH_FONTS : <span class="php-quote">''</span>;
</span><span id="6280" class="l"><a href="#6280"> 6280: </a>        }
</span><span id="6281" class="l"><a href="#6281"> 6281: </a>
</span><span id="6282" class="l"><a href="#6282"> 6282: </a>        <span class="php-comment">/**
</span></span><span id="6283" class="l"><a href="#6283"> 6283: </a><span class="php-comment">         * Output pages.
</span></span><span id="6284" class="l"><a href="#6284"> 6284: </a><span class="php-comment">         * @access protected
</span></span><span id="6285" class="l"><a href="#6285"> 6285: </a><span class="php-comment">         */</span>
</span><span id="6286" class="l"><a href="#6286"> 6286: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putpages() {
</span><span id="6287" class="l"><a href="#6287"> 6287: </a>            <span class="php-var">$nb</span> = <span class="php-var">$this</span>-&gt;numpages;
</span><span id="6288" class="l"><a href="#6288"> 6288: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;AliasNbPages)) {
</span><span id="6289" class="l"><a href="#6289"> 6289: </a>                <span class="php-var">$nbs</span> = <span class="php-var">$this</span>-&gt;formatPageNumber(<span class="php-var">$nb</span>);
</span><span id="6290" class="l"><a href="#6290"> 6290: </a>                <span class="php-var">$nbu</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$nbs</span>, <span class="php-keyword1">false</span>); <span class="php-comment">// replacement for unicode font</span>
</span><span id="6291" class="l"><a href="#6291"> 6291: </a>                <span class="php-var">$alias_a</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;AliasNbPages);
</span><span id="6292" class="l"><a href="#6292"> 6292: </a>                <span class="php-var">$alias_au</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNbPages.<span class="php-quote">'}'</span>);
</span><span id="6293" class="l"><a href="#6293"> 6293: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6294" class="l"><a href="#6294"> 6294: </a>                    <span class="php-var">$alias_b</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$this</span>-&gt;AliasNbPages));
</span><span id="6295" class="l"><a href="#6295"> 6295: </a>                    <span class="php-var">$alias_bu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNbPages.<span class="php-quote">'}'</span>));
</span><span id="6296" class="l"><a href="#6296"> 6296: </a>                    <span class="php-var">$alias_c</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$this</span>-&gt;AliasNbPages, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6297" class="l"><a href="#6297"> 6297: </a>                    <span class="php-var">$alias_cu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNbPages.<span class="php-quote">'}'</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6298" class="l"><a href="#6298"> 6298: </a>                }
</span><span id="6299" class="l"><a href="#6299"> 6299: </a>            }
</span><span id="6300" class="l"><a href="#6300"> 6300: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;AliasNumPage)) {
</span><span id="6301" class="l"><a href="#6301"> 6301: </a>                <span class="php-var">$alias_pa</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;AliasNumPage);
</span><span id="6302" class="l"><a href="#6302"> 6302: </a>                <span class="php-var">$alias_pau</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNumPage.<span class="php-quote">'}'</span>);
</span><span id="6303" class="l"><a href="#6303"> 6303: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6304" class="l"><a href="#6304"> 6304: </a>                    <span class="php-var">$alias_pb</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$this</span>-&gt;AliasNumPage));
</span><span id="6305" class="l"><a href="#6305"> 6305: </a>                    <span class="php-var">$alias_pbu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNumPage.<span class="php-quote">'}'</span>));
</span><span id="6306" class="l"><a href="#6306"> 6306: </a>                    <span class="php-var">$alias_pc</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$this</span>-&gt;AliasNumPage, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6307" class="l"><a href="#6307"> 6307: </a>                    <span class="php-var">$alias_pcu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNumPage.<span class="php-quote">'}'</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6308" class="l"><a href="#6308"> 6308: </a>                }
</span><span id="6309" class="l"><a href="#6309"> 6309: </a>            }
</span><span id="6310" class="l"><a href="#6310"> 6310: </a>            <span class="php-var">$pagegroupnum</span> = <span class="php-num">0</span>;
</span><span id="6311" class="l"><a href="#6311"> 6311: </a>            <span class="php-var">$filter</span> = (<span class="php-var">$this</span>-&gt;compress) ? <span class="php-quote">'/Filter /FlateDecode '</span> : <span class="php-quote">''</span>;
</span><span id="6312" class="l"><a href="#6312"> 6312: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$n</span>=<span class="php-num">1</span>; <span class="php-var">$n</span> &lt;= <span class="php-var">$nb</span>; ++<span class="php-var">$n</span>) {
</span><span id="6313" class="l"><a href="#6313"> 6313: </a>                <span class="php-var">$temppage</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$n</span>);
</span><span id="6314" class="l"><a href="#6314"> 6314: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;pagegroups)) {
</span><span id="6315" class="l"><a href="#6315"> 6315: </a>                    <span class="php-keyword1">if</span>(<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$n</span>])) {
</span><span id="6316" class="l"><a href="#6316"> 6316: </a>                        <span class="php-var">$pagegroupnum</span> = <span class="php-num">0</span>;
</span><span id="6317" class="l"><a href="#6317"> 6317: </a>                    }
</span><span id="6318" class="l"><a href="#6318"> 6318: </a>                    ++<span class="php-var">$pagegroupnum</span>;
</span><span id="6319" class="l"><a href="#6319"> 6319: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;pagegroups <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$v</span>) {
</span><span id="6320" class="l"><a href="#6320"> 6320: </a>                        <span class="php-comment">// replace total pages group numbers</span>
</span><span id="6321" class="l"><a href="#6321"> 6321: </a>                        <span class="php-var">$vs</span> = <span class="php-var">$this</span>-&gt;formatPageNumber(<span class="php-var">$v</span>);
</span><span id="6322" class="l"><a href="#6322"> 6322: </a>                        <span class="php-var">$vu</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$vs</span>, <span class="php-keyword1">false</span>);
</span><span id="6323" class="l"><a href="#6323"> 6323: </a>                        <span class="php-var">$alias_ga</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$k</span>);
</span><span id="6324" class="l"><a href="#6324"> 6324: </a>                        <span class="php-var">$alias_gau</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-quote">'{'</span>.<span class="php-var">$k</span>.<span class="php-quote">'}'</span>);
</span><span id="6325" class="l"><a href="#6325"> 6325: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6326" class="l"><a href="#6326"> 6326: </a>                            <span class="php-var">$alias_gb</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$k</span>));
</span><span id="6327" class="l"><a href="#6327"> 6327: </a>                            <span class="php-var">$alias_gbu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-quote">'{'</span>.<span class="php-var">$k</span>.<span class="php-quote">'}'</span>));
</span><span id="6328" class="l"><a href="#6328"> 6328: </a>                            <span class="php-var">$alias_gc</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$k</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6329" class="l"><a href="#6329"> 6329: </a>                            <span class="php-var">$alias_gcu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-quote">'{'</span>.<span class="php-var">$k</span>.<span class="php-quote">'}'</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6330" class="l"><a href="#6330"> 6330: </a>                        }
</span><span id="6331" class="l"><a href="#6331"> 6331: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_gau</span>, <span class="php-var">$vu</span>, <span class="php-var">$temppage</span>);
</span><span id="6332" class="l"><a href="#6332"> 6332: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6333" class="l"><a href="#6333"> 6333: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_gbu</span>, <span class="php-var">$vu</span>, <span class="php-var">$temppage</span>);
</span><span id="6334" class="l"><a href="#6334"> 6334: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_gcu</span>, <span class="php-var">$vu</span>, <span class="php-var">$temppage</span>);
</span><span id="6335" class="l"><a href="#6335"> 6335: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_gb</span>, <span class="php-var">$vs</span>, <span class="php-var">$temppage</span>);
</span><span id="6336" class="l"><a href="#6336"> 6336: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_gc</span>, <span class="php-var">$vs</span>, <span class="php-var">$temppage</span>);
</span><span id="6337" class="l"><a href="#6337"> 6337: </a>                        }
</span><span id="6338" class="l"><a href="#6338"> 6338: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_ga</span>, <span class="php-var">$vs</span>, <span class="php-var">$temppage</span>);
</span><span id="6339" class="l"><a href="#6339"> 6339: </a>                        <span class="php-comment">// replace page group numbers</span>
</span><span id="6340" class="l"><a href="#6340"> 6340: </a>                        <span class="php-var">$pvs</span> = <span class="php-var">$this</span>-&gt;formatPageNumber(<span class="php-var">$pagegroupnum</span>);
</span><span id="6341" class="l"><a href="#6341"> 6341: </a>                        <span class="php-var">$pvu</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$pvs</span>, <span class="php-keyword1">false</span>);
</span><span id="6342" class="l"><a href="#6342"> 6342: </a>                        <span class="php-var">$pk</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'{nb'</span>, <span class="php-quote">'{pnb'</span>, <span class="php-var">$k</span>);
</span><span id="6343" class="l"><a href="#6343"> 6343: </a>                        <span class="php-var">$alias_pga</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$pk</span>);
</span><span id="6344" class="l"><a href="#6344"> 6344: </a>                        <span class="php-var">$alias_pgau</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-quote">'{'</span>.<span class="php-var">$pk</span>.<span class="php-quote">'}'</span>);
</span><span id="6345" class="l"><a href="#6345"> 6345: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6346" class="l"><a href="#6346"> 6346: </a>                            <span class="php-var">$alias_pgb</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$pk</span>));
</span><span id="6347" class="l"><a href="#6347"> 6347: </a>                            <span class="php-var">$alias_pgbu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-quote">'{'</span>.<span class="php-var">$pk</span>.<span class="php-quote">'}'</span>));
</span><span id="6348" class="l"><a href="#6348"> 6348: </a>                            <span class="php-var">$alias_pgc</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$pk</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6349" class="l"><a href="#6349"> 6349: </a>                            <span class="php-var">$alias_pgcu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-quote">'{'</span>.<span class="php-var">$pk</span>.<span class="php-quote">'}'</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="6350" class="l"><a href="#6350"> 6350: </a>                        }
</span><span id="6351" class="l"><a href="#6351"> 6351: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pgau</span>, <span class="php-var">$pvu</span>, <span class="php-var">$temppage</span>);
</span><span id="6352" class="l"><a href="#6352"> 6352: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6353" class="l"><a href="#6353"> 6353: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pgbu</span>, <span class="php-var">$pvu</span>, <span class="php-var">$temppage</span>);
</span><span id="6354" class="l"><a href="#6354"> 6354: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pgcu</span>, <span class="php-var">$pvu</span>, <span class="php-var">$temppage</span>);
</span><span id="6355" class="l"><a href="#6355"> 6355: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pgb</span>, <span class="php-var">$pvs</span>, <span class="php-var">$temppage</span>);
</span><span id="6356" class="l"><a href="#6356"> 6356: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pgc</span>, <span class="php-var">$pvs</span>, <span class="php-var">$temppage</span>);
</span><span id="6357" class="l"><a href="#6357"> 6357: </a>                        }
</span><span id="6358" class="l"><a href="#6358"> 6358: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pga</span>, <span class="php-var">$pvs</span>, <span class="php-var">$temppage</span>);
</span><span id="6359" class="l"><a href="#6359"> 6359: </a>                    }
</span><span id="6360" class="l"><a href="#6360"> 6360: </a>                }
</span><span id="6361" class="l"><a href="#6361"> 6361: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;AliasNbPages)) {
</span><span id="6362" class="l"><a href="#6362"> 6362: </a>                    <span class="php-comment">// replace total pages number</span>
</span><span id="6363" class="l"><a href="#6363"> 6363: </a>                    <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_au</span>, <span class="php-var">$nbu</span>, <span class="php-var">$temppage</span>);
</span><span id="6364" class="l"><a href="#6364"> 6364: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6365" class="l"><a href="#6365"> 6365: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_bu</span>, <span class="php-var">$nbu</span>, <span class="php-var">$temppage</span>);
</span><span id="6366" class="l"><a href="#6366"> 6366: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_cu</span>, <span class="php-var">$nbu</span>, <span class="php-var">$temppage</span>);
</span><span id="6367" class="l"><a href="#6367"> 6367: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_b</span>, <span class="php-var">$nbs</span>, <span class="php-var">$temppage</span>);
</span><span id="6368" class="l"><a href="#6368"> 6368: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_c</span>, <span class="php-var">$nbs</span>, <span class="php-var">$temppage</span>);
</span><span id="6369" class="l"><a href="#6369"> 6369: </a>                    }
</span><span id="6370" class="l"><a href="#6370"> 6370: </a>                    <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_a</span>, <span class="php-var">$nbs</span>, <span class="php-var">$temppage</span>);
</span><span id="6371" class="l"><a href="#6371"> 6371: </a>                }
</span><span id="6372" class="l"><a href="#6372"> 6372: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;AliasNumPage)) {
</span><span id="6373" class="l"><a href="#6373"> 6373: </a>                    <span class="php-comment">// replace page number</span>
</span><span id="6374" class="l"><a href="#6374"> 6374: </a>                    <span class="php-var">$pnbs</span> = <span class="php-var">$this</span>-&gt;formatPageNumber(<span class="php-var">$n</span>);
</span><span id="6375" class="l"><a href="#6375"> 6375: </a>                    <span class="php-var">$pnbu</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$pnbs</span>, <span class="php-keyword1">false</span>); <span class="php-comment">// replacement for unicode font</span>
</span><span id="6376" class="l"><a href="#6376"> 6376: </a>                    <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pau</span>, <span class="php-var">$pnbu</span>, <span class="php-var">$temppage</span>);
</span><span id="6377" class="l"><a href="#6377"> 6377: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="6378" class="l"><a href="#6378"> 6378: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pbu</span>, <span class="php-var">$pnbu</span>, <span class="php-var">$temppage</span>);
</span><span id="6379" class="l"><a href="#6379"> 6379: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pcu</span>, <span class="php-var">$pnbu</span>, <span class="php-var">$temppage</span>);
</span><span id="6380" class="l"><a href="#6380"> 6380: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pb</span>, <span class="php-var">$pnbs</span>, <span class="php-var">$temppage</span>);
</span><span id="6381" class="l"><a href="#6381"> 6381: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pc</span>, <span class="php-var">$pnbs</span>, <span class="php-var">$temppage</span>);
</span><span id="6382" class="l"><a href="#6382"> 6382: </a>                    }
</span><span id="6383" class="l"><a href="#6383"> 6383: </a>                    <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_pa</span>, <span class="php-var">$pnbs</span>, <span class="php-var">$temppage</span>);
</span><span id="6384" class="l"><a href="#6384"> 6384: </a>                }
</span><span id="6385" class="l"><a href="#6385"> 6385: </a>                <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$this</span>-&gt;epsmarker, <span class="php-quote">''</span>, <span class="php-var">$temppage</span>);
</span><span id="6386" class="l"><a href="#6386"> 6386: </a>                <span class="php-comment">//Page</span>
</span><span id="6387" class="l"><a href="#6387"> 6387: </a>                <span class="php-var">$this</span>-&gt;page_obj_id[<span class="php-var">$n</span>] = <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="6388" class="l"><a href="#6388"> 6388: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /Page'</span>;
</span><span id="6389" class="l"><a href="#6389"> 6389: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Parent 1 0 R'</span>;
</span><span id="6390" class="l"><a href="#6390"> 6390: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'/MediaBox [0 0 %.2F %.2F]'</span>, <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$n</span>][<span class="php-quote">'w'</span>], <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$n</span>][<span class="php-quote">'h'</span>]);
</span><span id="6391" class="l"><a href="#6391"> 6391: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Group &lt;&lt; /Type /Group /S /Transparency /CS /DeviceRGB &gt;&gt;'</span>;
</span><span id="6392" class="l"><a href="#6392"> 6392: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Resources 2 0 R'</span>;
</span><span id="6393" class="l"><a href="#6393"> 6393: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="6394" class="l"><a href="#6394"> 6394: </a>                <span class="php-var">$this</span>-&gt;_putannotsrefs(<span class="php-var">$n</span>);
</span><span id="6395" class="l"><a href="#6395"> 6395: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'/Contents '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R&gt;&gt; endobj'</span>);
</span><span id="6396" class="l"><a href="#6396"> 6396: </a>                <span class="php-comment">//Page content</span>
</span><span id="6397" class="l"><a href="#6397"> 6397: </a>                <span class="php-var">$p</span> = (<span class="php-var">$this</span>-&gt;compress) ? <span class="php-keyword2">gzcompress</span>(<span class="php-var">$temppage</span>) : <span class="php-var">$temppage</span>;
</span><span id="6398" class="l"><a href="#6398"> 6398: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="6399" class="l"><a href="#6399"> 6399: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'&lt;&lt;'</span>.<span class="php-var">$filter</span>.<span class="php-quote">'/Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$p</span>).<span class="php-quote">'&gt;&gt; '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$p</span>).<span class="php-quote">' endobj'</span>);
</span><span id="6400" class="l"><a href="#6400"> 6400: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="6401" class="l"><a href="#6401"> 6401: </a>                    <span class="php-comment">// remove temporary files</span>
</span><span id="6402" class="l"><a href="#6402"> 6402: </a>                    <span class="php-keyword2">unlink</span>(<span class="php-var">$this</span>-&gt;pages[<span class="php-var">$n</span>]);
</span><span id="6403" class="l"><a href="#6403"> 6403: </a>                }
</span><span id="6404" class="l"><a href="#6404"> 6404: </a>            }
</span><span id="6405" class="l"><a href="#6405"> 6405: </a>            <span class="php-comment">//Pages root</span>
</span><span id="6406" class="l"><a href="#6406"> 6406: </a>            <span class="php-var">$this</span>-&gt;offsets[<span class="php-num">1</span>] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="6407" class="l"><a href="#6407"> 6407: </a>            <span class="php-var">$out</span> = <span class="php-quote">'1 0 obj &lt;&lt;/Type /Pages  /Kids ['</span>;
</span><span id="6408" class="l"><a href="#6408"> 6408: </a>            <span class="php-keyword1">foreach</span>(<span class="php-var">$this</span>-&gt;page_obj_id <span class="php-keyword1">as</span> <span class="php-var">$page_obj</span>) {
</span><span id="6409" class="l"><a href="#6409"> 6409: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$page_obj</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="6410" class="l"><a href="#6410"> 6410: </a>            }
</span><span id="6411" class="l"><a href="#6411"> 6411: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' ] /Count '</span>.<span class="php-var">$nb</span>.<span class="php-quote">' &gt;&gt;  endobj'</span>;
</span><span id="6412" class="l"><a href="#6412"> 6412: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="6413" class="l"><a href="#6413"> 6413: </a>        }
</span><span id="6414" class="l"><a href="#6414"> 6414: </a>
</span><span id="6415" class="l"><a href="#6415"> 6415: </a>        <span class="php-comment">/**
</span></span><span id="6416" class="l"><a href="#6416"> 6416: </a><span class="php-comment">         * Output references to page annotations
</span></span><span id="6417" class="l"><a href="#6417"> 6417: </a><span class="php-comment">         * @param int $n page number
</span></span><span id="6418" class="l"><a href="#6418"> 6418: </a><span class="php-comment">         * @access protected
</span></span><span id="6419" class="l"><a href="#6419"> 6419: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="6420" class="l"><a href="#6420"> 6420: </a><span class="php-comment">         * @since 4.7.000 (2008-08-29)
</span></span><span id="6421" class="l"><a href="#6421"> 6421: </a><span class="php-comment">         */</span>
</span><span id="6422" class="l"><a href="#6422"> 6422: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putannotsrefs(<span class="php-var">$n</span>) {
</span><span id="6423" class="l"><a href="#6423"> 6423: </a>            <span class="php-keyword1">if</span> (!(<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$n</span>]) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;sign <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>])))) {
</span><span id="6424" class="l"><a href="#6424"> 6424: </a>                <span class="php-keyword1">return</span>;
</span><span id="6425" class="l"><a href="#6425"> 6425: </a>            }
</span><span id="6426" class="l"><a href="#6426"> 6426: </a>            <span class="php-var">$out</span> = <span class="php-quote">'/Annots ['</span>;
</span><span id="6427" class="l"><a href="#6427"> 6427: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$n</span>])) {
</span><span id="6428" class="l"><a href="#6428"> 6428: </a>                <span class="php-var">$num_annots</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$n</span>]);
</span><span id="6429" class="l"><a href="#6429"> 6429: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$num_annots</span>; ++<span class="php-var">$i</span>) {
</span><span id="6430" class="l"><a href="#6430"> 6430: </a>                    ++<span class="php-var">$this</span>-&gt;curr_annot_obj_id;
</span><span id="6431" class="l"><a href="#6431"> 6431: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$this</span>-&gt;curr_annot_obj_id, <span class="php-var">$this</span>-&gt;radio_groups)) {
</span><span id="6432" class="l"><a href="#6432"> 6432: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;curr_annot_obj_id.<span class="php-quote">' 0 R'</span>;
</span><span id="6433" class="l"><a href="#6433"> 6433: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="6434" class="l"><a href="#6434"> 6434: </a>                        ++<span class="php-var">$num_annots</span>;
</span><span id="6435" class="l"><a href="#6435"> 6435: </a>                    }
</span><span id="6436" class="l"><a href="#6436"> 6436: </a>                }
</span><span id="6437" class="l"><a href="#6437"> 6437: </a>            }
</span><span id="6438" class="l"><a href="#6438"> 6438: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$n</span>==<span class="php-num">1</span>) <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;sign <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>])) {
</span><span id="6439" class="l"><a href="#6439"> 6439: </a>                <span class="php-comment">// set reference for signature object</span>
</span><span id="6440" class="l"><a href="#6440"> 6440: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;sig_annot_ref;
</span><span id="6441" class="l"><a href="#6441"> 6441: </a>            }
</span><span id="6442" class="l"><a href="#6442"> 6442: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' ]'</span>;
</span><span id="6443" class="l"><a href="#6443"> 6443: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="6444" class="l"><a href="#6444"> 6444: </a>        }
</span><span id="6445" class="l"><a href="#6445"> 6445: </a>
</span><span id="6446" class="l"><a href="#6446"> 6446: </a>        <span class="php-comment">/**
</span></span><span id="6447" class="l"><a href="#6447"> 6447: </a><span class="php-comment">         * Output annotations objects for all pages.
</span></span><span id="6448" class="l"><a href="#6448"> 6448: </a><span class="php-comment">         * !!! THIS METHOD IS NOT YET COMPLETED !!!
</span></span><span id="6449" class="l"><a href="#6449"> 6449: </a><span class="php-comment">         * See section 12.5 of PDF 32000_2008 reference.
</span></span><span id="6450" class="l"><a href="#6450"> 6450: </a><span class="php-comment">         * @access protected
</span></span><span id="6451" class="l"><a href="#6451"> 6451: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="6452" class="l"><a href="#6452"> 6452: </a><span class="php-comment">         * @since 4.0.018 (2008-08-06)
</span></span><span id="6453" class="l"><a href="#6453"> 6453: </a><span class="php-comment">         */</span>
</span><span id="6454" class="l"><a href="#6454"> 6454: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putannotsobjs() {
</span><span id="6455" class="l"><a href="#6455"> 6455: </a>            <span class="php-comment">// reset object counter</span>
</span><span id="6456" class="l"><a href="#6456"> 6456: </a>            <span class="php-var">$this</span>-&gt;annot_obj_id = <span class="php-var">$this</span>-&gt;annots_start_obj_id;
</span><span id="6457" class="l"><a href="#6457"> 6457: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$n</span>=<span class="php-num">1</span>; <span class="php-var">$n</span> &lt;= <span class="php-var">$this</span>-&gt;numpages; ++<span class="php-var">$n</span>) {
</span><span id="6458" class="l"><a href="#6458"> 6458: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$n</span>])) {
</span><span id="6459" class="l"><a href="#6459"> 6459: </a>                    <span class="php-comment">// set page annotations</span>
</span><span id="6460" class="l"><a href="#6460"> 6460: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$n</span>] <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$pl</span>) {
</span><span id="6461" class="l"><a href="#6461"> 6461: </a>                        <span class="php-comment">// create annotation object for grouping radiobuttons</span>
</span><span id="6462" class="l"><a href="#6462"> 6462: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$n</span>][<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$n</span>][<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]])) {
</span><span id="6463" class="l"><a href="#6463"> 6463: </a>                            <span class="php-var">$annots</span> = <span class="php-quote">'&lt;&lt;'</span>;
</span><span id="6464" class="l"><a href="#6464"> 6464: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /Type /Annot'</span>;
</span><span id="6465" class="l"><a href="#6465"> 6465: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /Subtype /Widget'</span>;
</span><span id="6466" class="l"><a href="#6466"> 6466: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /T '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]);
</span><span id="6467" class="l"><a href="#6467"> 6467: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /FT /Btn'</span>;
</span><span id="6468" class="l"><a href="#6468"> 6468: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /Ff 49152'</span>;
</span><span id="6469" class="l"><a href="#6469"> 6469: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /Kids ['</span>;
</span><span id="6470" class="l"><a href="#6470"> 6470: </a>                            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$n</span>][<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]] <span class="php-keyword1">as</span> <span class="php-var">$data</span>) {
</span><span id="6471" class="l"><a href="#6471"> 6471: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$data</span>[<span class="php-quote">'kid'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="6472" class="l"><a href="#6472"> 6472: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$data</span>[<span class="php-quote">'def'</span>] !== <span class="php-quote">'Off'</span>) {
</span><span id="6473" class="l"><a href="#6473"> 6473: </a>                                    <span class="php-var">$defval</span> = <span class="php-var">$data</span>[<span class="php-quote">'def'</span>];
</span><span id="6474" class="l"><a href="#6474"> 6474: </a>                                }
</span><span id="6475" class="l"><a href="#6475"> 6475: </a>                            }
</span><span id="6476" class="l"><a href="#6476"> 6476: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' ]'</span>;
</span><span id="6477" class="l"><a href="#6477"> 6477: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$defval</span>)) {
</span><span id="6478" class="l"><a href="#6478"> 6478: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /V /'</span>.<span class="php-var">$defval</span>;
</span><span id="6479" class="l"><a href="#6479"> 6479: </a>                            }
</span><span id="6480" class="l"><a href="#6480"> 6480: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="6481" class="l"><a href="#6481"> 6481: </a>                            ++<span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="6482" class="l"><a href="#6482"> 6482: </a>                            <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$this</span>-&gt;annot_obj_id] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="6483" class="l"><a href="#6483"> 6483: </a>                            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;annot_obj_id.<span class="php-quote">' 0 obj '</span>.<span class="php-var">$annots</span>.<span class="php-quote">' endobj'</span>);
</span><span id="6484" class="l"><a href="#6484"> 6484: </a>                            <span class="php-var">$this</span>-&gt;form_obj_id[] = <span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="6485" class="l"><a href="#6485"> 6485: </a>                            <span class="php-comment">// store object id to be used on Parent entry of Kids</span>
</span><span id="6486" class="l"><a href="#6486"> 6486: </a>                            <span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$n</span>][<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]] = <span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="6487" class="l"><a href="#6487"> 6487: </a>                        }
</span><span id="6488" class="l"><a href="#6488"> 6488: </a>                        <span class="php-var">$formfield</span> = <span class="php-keyword1">false</span>;
</span><span id="6489" class="l"><a href="#6489"> 6489: </a>                        <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>] = <span class="php-keyword2">array_change_key_case</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>], CASE_LOWER);
</span><span id="6490" class="l"><a href="#6490"> 6490: </a>                        <span class="php-var">$a</span> = <span class="php-var">$pl</span>[<span class="php-quote">'x'</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="6491" class="l"><a href="#6491"> 6491: </a>                        <span class="php-var">$b</span> = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$n</span>][<span class="php-quote">'h'</span>] - ((<span class="php-var">$pl</span>[<span class="php-quote">'y'</span>] + <span class="php-var">$pl</span>[<span class="php-quote">'h'</span>])  * <span class="php-var">$this</span>-&gt;k);
</span><span id="6492" class="l"><a href="#6492"> 6492: </a>                        <span class="php-var">$c</span> = <span class="php-var">$pl</span>[<span class="php-quote">'w'</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="6493" class="l"><a href="#6493"> 6493: </a>                        <span class="php-var">$d</span> = <span class="php-var">$pl</span>[<span class="php-quote">'h'</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="6494" class="l"><a href="#6494"> 6494: </a>                        <span class="php-var">$rect</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F'</span>, <span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-var">$a</span>+<span class="php-var">$c</span>, <span class="php-var">$b</span>+<span class="php-var">$d</span>);
</span><span id="6495" class="l"><a href="#6495"> 6495: </a>                        <span class="php-comment">// create new annotation object</span>
</span><span id="6496" class="l"><a href="#6496"> 6496: </a>                        <span class="php-var">$annots</span> = <span class="php-quote">'&lt;&lt;/Type /Annot'</span>;
</span><span id="6497" class="l"><a href="#6497"> 6497: </a>                        <span class="php-var">$annots</span> .= <span class="php-quote">' /Subtype /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'subtype'</span>];
</span><span id="6498" class="l"><a href="#6498"> 6498: </a>                        <span class="php-var">$annots</span> .= <span class="php-quote">' /Rect ['</span>.<span class="php-var">$rect</span>.<span class="php-quote">']'</span>;
</span><span id="6499" class="l"><a href="#6499"> 6499: </a>                        <span class="php-var">$ft</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Btn'</span>, <span class="php-quote">'Tx'</span>, <span class="php-quote">'Ch'</span>, <span class="php-quote">'Sig'</span>);
</span><span id="6500" class="l"><a href="#6500"> 6500: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ft'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ft'</span>], <span class="php-var">$ft</span>)) {
</span><span id="6501" class="l"><a href="#6501"> 6501: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /FT /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ft'</span>];
</span><span id="6502" class="l"><a href="#6502"> 6502: </a>                            <span class="php-var">$formfield</span> = <span class="php-keyword1">true</span>;
</span><span id="6503" class="l"><a href="#6503"> 6503: </a>                        }
</span><span id="6504" class="l"><a href="#6504"> 6504: </a>                        <span class="php-var">$annots</span> .= <span class="php-quote">' /Contents '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]);
</span><span id="6505" class="l"><a href="#6505"> 6505: </a>                        <span class="php-var">$annots</span> .= <span class="php-quote">' /P '</span>.<span class="php-var">$this</span>-&gt;page_obj_id[<span class="php-var">$n</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="6506" class="l"><a href="#6506"> 6506: </a>                        <span class="php-var">$annots</span> .= <span class="php-quote">' /NM '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%04u-%04u'</span>, <span class="php-var">$n</span>, <span class="php-var">$key</span>));
</span><span id="6507" class="l"><a href="#6507"> 6507: </a>                        <span class="php-var">$annots</span> .= <span class="php-quote">' /M '</span>.<span class="php-var">$this</span>-&gt;_datestring();
</span><span id="6508" class="l"><a href="#6508"> 6508: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'f'</span>])) {
</span><span id="6509" class="l"><a href="#6509"> 6509: </a>                            <span class="php-var">$val</span> = <span class="php-num">0</span>;
</span><span id="6510" class="l"><a href="#6510"> 6510: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'f'</span>])) {
</span><span id="6511" class="l"><a href="#6511"> 6511: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'f'</span>] <span class="php-keyword1">as</span> <span class="php-var">$f</span>) {
</span><span id="6512" class="l"><a href="#6512"> 6512: </a>                                    <span class="php-keyword1">switch</span> (<span class="php-keyword2">strtolower</span>(<span class="php-var">$f</span>)) {
</span><span id="6513" class="l"><a href="#6513"> 6513: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'invisible'</span>: {
</span><span id="6514" class="l"><a href="#6514"> 6514: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">0</span>;
</span><span id="6515" class="l"><a href="#6515"> 6515: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6516" class="l"><a href="#6516"> 6516: </a>                                        }
</span><span id="6517" class="l"><a href="#6517"> 6517: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'hidden'</span>: {
</span><span id="6518" class="l"><a href="#6518"> 6518: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">1</span>;
</span><span id="6519" class="l"><a href="#6519"> 6519: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6520" class="l"><a href="#6520"> 6520: </a>                                        }
</span><span id="6521" class="l"><a href="#6521"> 6521: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'print'</span>: {
</span><span id="6522" class="l"><a href="#6522"> 6522: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">2</span>;
</span><span id="6523" class="l"><a href="#6523"> 6523: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6524" class="l"><a href="#6524"> 6524: </a>                                        }
</span><span id="6525" class="l"><a href="#6525"> 6525: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'nozoom'</span>: {
</span><span id="6526" class="l"><a href="#6526"> 6526: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">3</span>;
</span><span id="6527" class="l"><a href="#6527"> 6527: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6528" class="l"><a href="#6528"> 6528: </a>                                        }
</span><span id="6529" class="l"><a href="#6529"> 6529: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'norotate'</span>: {
</span><span id="6530" class="l"><a href="#6530"> 6530: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">4</span>;
</span><span id="6531" class="l"><a href="#6531"> 6531: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6532" class="l"><a href="#6532"> 6532: </a>                                        }
</span><span id="6533" class="l"><a href="#6533"> 6533: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'noview'</span>: {
</span><span id="6534" class="l"><a href="#6534"> 6534: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">5</span>;
</span><span id="6535" class="l"><a href="#6535"> 6535: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6536" class="l"><a href="#6536"> 6536: </a>                                        }
</span><span id="6537" class="l"><a href="#6537"> 6537: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'readonly'</span>: {
</span><span id="6538" class="l"><a href="#6538"> 6538: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">6</span>;
</span><span id="6539" class="l"><a href="#6539"> 6539: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6540" class="l"><a href="#6540"> 6540: </a>                                        }
</span><span id="6541" class="l"><a href="#6541"> 6541: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'locked'</span>: {
</span><span id="6542" class="l"><a href="#6542"> 6542: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">8</span>;
</span><span id="6543" class="l"><a href="#6543"> 6543: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6544" class="l"><a href="#6544"> 6544: </a>                                        }
</span><span id="6545" class="l"><a href="#6545"> 6545: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'togglenoview'</span>: {
</span><span id="6546" class="l"><a href="#6546"> 6546: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">9</span>;
</span><span id="6547" class="l"><a href="#6547"> 6547: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6548" class="l"><a href="#6548"> 6548: </a>                                        }
</span><span id="6549" class="l"><a href="#6549"> 6549: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'lockedcontents'</span>: {
</span><span id="6550" class="l"><a href="#6550"> 6550: </a>                                            <span class="php-var">$val</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">10</span>;
</span><span id="6551" class="l"><a href="#6551"> 6551: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6552" class="l"><a href="#6552"> 6552: </a>                                        }
</span><span id="6553" class="l"><a href="#6553"> 6553: </a>                                        <span class="php-keyword1">default</span>: {
</span><span id="6554" class="l"><a href="#6554"> 6554: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="6555" class="l"><a href="#6555"> 6555: </a>                                        }
</span><span id="6556" class="l"><a href="#6556"> 6556: </a>                                    }
</span><span id="6557" class="l"><a href="#6557"> 6557: </a>                                }
</span><span id="6558" class="l"><a href="#6558"> 6558: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="6559" class="l"><a href="#6559"> 6559: </a>                                <span class="php-var">$val</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'f'</span>]);
</span><span id="6560" class="l"><a href="#6560"> 6560: </a>                            }
</span><span id="6561" class="l"><a href="#6561"> 6561: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /F '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$val</span>);
</span><span id="6562" class="l"><a href="#6562"> 6562: </a>                        }
</span><span id="6563" class="l"><a href="#6563"> 6563: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'as'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_string</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'as'</span>])) {
</span><span id="6564" class="l"><a href="#6564"> 6564: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /AS /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'as'</span>];
</span><span id="6565" class="l"><a href="#6565"> 6565: </a>                        }
</span><span id="6566" class="l"><a href="#6566"> 6566: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ap'</span>])) {
</span><span id="6567" class="l"><a href="#6567"> 6567: </a>                            <span class="php-comment">// appearance stream</span>
</span><span id="6568" class="l"><a href="#6568"> 6568: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /AP &lt;&lt;'</span>;
</span><span id="6569" class="l"><a href="#6569"> 6569: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ap'</span>])) {
</span><span id="6570" class="l"><a href="#6570"> 6570: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ap'</span>] <span class="php-keyword1">as</span> <span class="php-var">$apmode</span> =&gt; <span class="php-var">$apdef</span>) {
</span><span id="6571" class="l"><a href="#6571"> 6571: </a>                                    <span class="php-comment">// $apmode can be: n = normal; r = rollover; d = down;</span>
</span><span id="6572" class="l"><a href="#6572"> 6572: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /'</span>.<span class="php-keyword2">strtoupper</span>(<span class="php-var">$apmode</span>);
</span><span id="6573" class="l"><a href="#6573"> 6573: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$apdef</span>)) {
</span><span id="6574" class="l"><a href="#6574"> 6574: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' &lt;&lt;'</span>;
</span><span id="6575" class="l"><a href="#6575"> 6575: </a>                                        <span class="php-keyword1">foreach</span> (<span class="php-var">$apdef</span> <span class="php-keyword1">as</span> <span class="php-var">$apstate</span> =&gt; <span class="php-var">$stream</span>) {
</span><span id="6576" class="l"><a href="#6576"> 6576: </a>                                            <span class="php-comment">// reference to XObject that define the appearance for this mode-state</span>
</span><span id="6577" class="l"><a href="#6577"> 6577: </a>                                            <span class="php-var">$apsobjid</span> = <span class="php-var">$this</span>-&gt;_putAPXObject(<span class="php-var">$c</span>, <span class="php-var">$d</span>, <span class="php-var">$stream</span>);
</span><span id="6578" class="l"><a href="#6578"> 6578: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' /'</span>.<span class="php-var">$apstate</span>.<span class="php-quote">' '</span>.<span class="php-var">$apsobjid</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="6579" class="l"><a href="#6579"> 6579: </a>                                        }
</span><span id="6580" class="l"><a href="#6580"> 6580: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="6581" class="l"><a href="#6581"> 6581: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6582" class="l"><a href="#6582"> 6582: </a>                                        <span class="php-comment">// reference to XObject that define the appearance for this mode</span>
</span><span id="6583" class="l"><a href="#6583"> 6583: </a>                                        <span class="php-var">$apsobjid</span> = <span class="php-var">$this</span>-&gt;_putAPXObject(<span class="php-var">$c</span>, <span class="php-var">$d</span>, <span class="php-var">$apdef</span>);
</span><span id="6584" class="l"><a href="#6584"> 6584: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$apsobjid</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="6585" class="l"><a href="#6585"> 6585: </a>                                    }
</span><span id="6586" class="l"><a href="#6586"> 6586: </a>                                }
</span><span id="6587" class="l"><a href="#6587"> 6587: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="6588" class="l"><a href="#6588"> 6588: </a>                                <span class="php-var">$annots</span> .= <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ap'</span>];
</span><span id="6589" class="l"><a href="#6589"> 6589: </a>                            }
</span><span id="6590" class="l"><a href="#6590"> 6590: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="6591" class="l"><a href="#6591"> 6591: </a>                        }
</span><span id="6592" class="l"><a href="#6592"> 6592: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>]))) {
</span><span id="6593" class="l"><a href="#6593"> 6593: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /BS &lt;&lt;'</span>;
</span><span id="6594" class="l"><a href="#6594"> 6594: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /Type /Border'</span>;
</span><span id="6595" class="l"><a href="#6595"> 6595: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'w'</span>])) {
</span><span id="6596" class="l"><a href="#6596"> 6596: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /W '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'w'</span>]);
</span><span id="6597" class="l"><a href="#6597"> 6597: </a>                            }
</span><span id="6598" class="l"><a href="#6598"> 6598: </a>                            <span class="php-var">$bstyles</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'S'</span>, <span class="php-quote">'D'</span>, <span class="php-quote">'B'</span>, <span class="php-quote">'I'</span>, <span class="php-quote">'U'</span>);
</span><span id="6599" class="l"><a href="#6599"> 6599: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'s'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'s'</span>], <span class="php-var">$bstyles</span>)) {
</span><span id="6600" class="l"><a href="#6600"> 6600: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /S /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'s'</span>];
</span><span id="6601" class="l"><a href="#6601"> 6601: </a>                            }
</span><span id="6602" class="l"><a href="#6602"> 6602: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'d'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'d'</span>]))) {
</span><span id="6603" class="l"><a href="#6603"> 6603: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /D ['</span>;
</span><span id="6604" class="l"><a href="#6604"> 6604: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'d'</span>] <span class="php-keyword1">as</span> <span class="php-var">$cord</span>) {
</span><span id="6605" class="l"><a href="#6605"> 6605: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$cord</span>);
</span><span id="6606" class="l"><a href="#6606"> 6606: </a>                                }
</span><span id="6607" class="l"><a href="#6607"> 6607: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="6608" class="l"><a href="#6608"> 6608: </a>                            }
</span><span id="6609" class="l"><a href="#6609"> 6609: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="6610" class="l"><a href="#6610"> 6610: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="6611" class="l"><a href="#6611"> 6611: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /Border ['</span>;
</span><span id="6612" class="l"><a href="#6612"> 6612: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">count</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>]) &gt;= <span class="php-num">3</span>)) {
</span><span id="6613" class="l"><a href="#6613"> 6613: </a>                                <span class="php-var">$annots</span> .= <span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>][<span class="php-num">0</span>]).<span class="php-quote">' '</span>;
</span><span id="6614" class="l"><a href="#6614"> 6614: </a>                                <span class="php-var">$annots</span> .= <span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>][<span class="php-num">1</span>]).<span class="php-quote">' '</span>;
</span><span id="6615" class="l"><a href="#6615"> 6615: </a>                                <span class="php-var">$annots</span> .= <span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>][<span class="php-num">2</span>]);
</span><span id="6616" class="l"><a href="#6616"> 6616: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>][<span class="php-num">3</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>][<span class="php-num">3</span>])) {
</span><span id="6617" class="l"><a href="#6617"> 6617: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' ['</span>;
</span><span id="6618" class="l"><a href="#6618"> 6618: </a>                                    <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'border'</span>][<span class="php-num">3</span>] <span class="php-keyword1">as</span> <span class="php-var">$dash</span>) {
</span><span id="6619" class="l"><a href="#6619"> 6619: </a>                                        <span class="php-var">$annots</span> .= <span class="php-keyword2">intval</span>(<span class="php-var">$dash</span>).<span class="php-quote">' '</span>;
</span><span id="6620" class="l"><a href="#6620"> 6620: </a>                                    }
</span><span id="6621" class="l"><a href="#6621"> 6621: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="6622" class="l"><a href="#6622"> 6622: </a>                                }
</span><span id="6623" class="l"><a href="#6623"> 6623: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="6624" class="l"><a href="#6624"> 6624: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">'0 0 0'</span>;
</span><span id="6625" class="l"><a href="#6625"> 6625: </a>                            }
</span><span id="6626" class="l"><a href="#6626"> 6626: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="6627" class="l"><a href="#6627"> 6627: </a>                        }
</span><span id="6628" class="l"><a href="#6628"> 6628: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>]))) {
</span><span id="6629" class="l"><a href="#6629"> 6629: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /BE &lt;&lt;'</span>;
</span><span id="6630" class="l"><a href="#6630"> 6630: </a>                            <span class="php-var">$bstyles</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'S'</span>, <span class="php-quote">'C'</span>);
</span><span id="6631" class="l"><a href="#6631"> 6631: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>][<span class="php-quote">'s'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>][<span class="php-quote">'s'</span>], <span class="php-var">$markups</span>)) {
</span><span id="6632" class="l"><a href="#6632"> 6632: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /S /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'bs'</span>][<span class="php-quote">'s'</span>];
</span><span id="6633" class="l"><a href="#6633"> 6633: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="6634" class="l"><a href="#6634"> 6634: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /S /S'</span>;
</span><span id="6635" class="l"><a href="#6635"> 6635: </a>                            }
</span><span id="6636" class="l"><a href="#6636"> 6636: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>][<span class="php-quote">'i'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>][<span class="php-quote">'i'</span>] &gt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>][<span class="php-quote">'i'</span>] &lt;= <span class="php-num">2</span>)) {
</span><span id="6637" class="l"><a href="#6637"> 6637: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /I '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">' %.4F'</span>, <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'be'</span>][<span class="php-quote">'i'</span>]);
</span><span id="6638" class="l"><a href="#6638"> 6638: </a>                            }
</span><span id="6639" class="l"><a href="#6639"> 6639: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">'&gt;&gt;'</span>;
</span><span id="6640" class="l"><a href="#6640"> 6640: </a>                        }
</span><span id="6641" class="l"><a href="#6641"> 6641: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'c'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'c'</span>])) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'c'</span>])) {
</span><span id="6642" class="l"><a href="#6642"> 6642: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /C ['</span>;
</span><span id="6643" class="l"><a href="#6643"> 6643: </a>                            <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'c'</span>] <span class="php-keyword1">as</span> <span class="php-var">$col</span>) {
</span><span id="6644" class="l"><a href="#6644"> 6644: </a>                                <span class="php-var">$col</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$col</span>);
</span><span id="6645" class="l"><a href="#6645"> 6645: </a>                                <span class="php-var">$color</span> = <span class="php-var">$col</span> &lt;= <span class="php-num">0</span> ? <span class="php-num">0</span> : (<span class="php-var">$col</span> &gt;= <span class="php-num">255</span> ? <span class="php-num">1</span> : <span class="php-var">$col</span> / <span class="php-num">255</span>);
</span><span id="6646" class="l"><a href="#6646"> 6646: </a>                                <span class="php-var">$annots</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' %.4F'</span>, <span class="php-var">$color</span>);
</span><span id="6647" class="l"><a href="#6647"> 6647: </a>                            }
</span><span id="6648" class="l"><a href="#6648"> 6648: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="6649" class="l"><a href="#6649"> 6649: </a>                        }
</span><span id="6650" class="l"><a href="#6650"> 6650: </a>                        <span class="php-comment">//$annots .= ' /StructParent ';</span>
</span><span id="6651" class="l"><a href="#6651"> 6651: </a>                        <span class="php-comment">//$annots .= ' /OC ';</span>
</span><span id="6652" class="l"><a href="#6652"> 6652: </a>                        <span class="php-var">$markups</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'text'</span>, <span class="php-quote">'freetext'</span>, <span class="php-quote">'line'</span>, <span class="php-quote">'square'</span>, <span class="php-quote">'circle'</span>, <span class="php-quote">'polygon'</span>, <span class="php-quote">'polyline'</span>, <span class="php-quote">'highlight'</span>, <span class="php-quote">'underline'</span>, <span class="php-quote">'squiggly'</span>, <span class="php-quote">'strikeout'</span>, <span class="php-quote">'stamp'</span>, <span class="php-quote">'caret'</span>, <span class="php-quote">'ink'</span>, <span class="php-quote">'fileattachment'</span>, <span class="php-quote">'sound'</span>);
</span><span id="6653" class="l"><a href="#6653"> 6653: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-keyword2">strtolower</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'subtype'</span>]), <span class="php-var">$markups</span>)) {
</span><span id="6654" class="l"><a href="#6654"> 6654: </a>                            <span class="php-comment">// this is a markup type</span>
</span><span id="6655" class="l"><a href="#6655"> 6655: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'t'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_string</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'t'</span>])) {
</span><span id="6656" class="l"><a href="#6656"> 6656: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /T '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'t'</span>]);
</span><span id="6657" class="l"><a href="#6657"> 6657: </a>                            }
</span><span id="6658" class="l"><a href="#6658"> 6658: </a>                            <span class="php-comment">//$annots .= ' /Popup ';</span>
</span><span id="6659" class="l"><a href="#6659"> 6659: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ca'</span>])) {
</span><span id="6660" class="l"><a href="#6660"> 6660: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /CA '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.4F'</span>, <span class="php-keyword2">floatval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ca'</span>]));
</span><span id="6661" class="l"><a href="#6661"> 6661: </a>                            }
</span><span id="6662" class="l"><a href="#6662"> 6662: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rc'</span>])) {
</span><span id="6663" class="l"><a href="#6663"> 6663: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /RC '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rc'</span>]);
</span><span id="6664" class="l"><a href="#6664"> 6664: </a>                            }
</span><span id="6665" class="l"><a href="#6665"> 6665: </a>                            <span class="php-var">$annots</span> .= <span class="php-quote">' /CreationDate '</span>.<span class="php-var">$this</span>-&gt;_datestring();
</span><span id="6666" class="l"><a href="#6666"> 6666: </a>                            <span class="php-comment">//$annots .= ' /IRT ';</span>
</span><span id="6667" class="l"><a href="#6667"> 6667: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'subj'</span>])) {
</span><span id="6668" class="l"><a href="#6668"> 6668: </a>                                <span class="php-var">$annots</span> .= <span class="php-quote">' /Subj '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'subj'</span>]);
</span><span id="6669" class="l"><a href="#6669"> 6669: </a>                            }
</span><span id="6670" class="l"><a href="#6670"> 6670: </a>                            <span class="php-comment">//$annots .= ' /RT ';</span>
</span><span id="6671" class="l"><a href="#6671"> 6671: </a>                            <span class="php-comment">//$annots .= ' /IT ';</span>
</span><span id="6672" class="l"><a href="#6672"> 6672: </a>                            <span class="php-comment">//$annots .= ' /ExData ';</span>
</span><span id="6673" class="l"><a href="#6673"> 6673: </a>                        }
</span><span id="6674" class="l"><a href="#6674"> 6674: </a>                        <span class="php-var">$lineendings</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Square'</span>, <span class="php-quote">'Circle'</span>, <span class="php-quote">'Diamond'</span>, <span class="php-quote">'OpenArrow'</span>, <span class="php-quote">'ClosedArrow'</span>, <span class="php-quote">'None'</span>, <span class="php-quote">'Butt'</span>, <span class="php-quote">'ROpenArrow'</span>, <span class="php-quote">'RClosedArrow'</span>, <span class="php-quote">'Slash'</span>);
</span><span id="6675" class="l"><a href="#6675"> 6675: </a>                        <span class="php-keyword1">switch</span> (<span class="php-keyword2">strtolower</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'subtype'</span>])) {
</span><span id="6676" class="l"><a href="#6676"> 6676: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'text'</span>: {
</span><span id="6677" class="l"><a href="#6677"> 6677: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'open'</span>])) {
</span><span id="6678" class="l"><a href="#6678"> 6678: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Open '</span>. (<span class="php-keyword2">strtolower</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'open'</span>]) == <span class="php-quote">'true'</span> ? <span class="php-quote">'true'</span> : <span class="php-quote">'false'</span>);
</span><span id="6679" class="l"><a href="#6679"> 6679: </a>                                }
</span><span id="6680" class="l"><a href="#6680"> 6680: </a>                                <span class="php-var">$iconsapp</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Comment'</span>, <span class="php-quote">'Help'</span>, <span class="php-quote">'Insert'</span>, <span class="php-quote">'Key'</span>, <span class="php-quote">'NewParagraph'</span>, <span class="php-quote">'Note'</span>, <span class="php-quote">'Paragraph'</span>);
</span><span id="6681" class="l"><a href="#6681"> 6681: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>], <span class="php-var">$iconsapp</span>)) {
</span><span id="6682" class="l"><a href="#6682"> 6682: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Name /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>];
</span><span id="6683" class="l"><a href="#6683"> 6683: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="6684" class="l"><a href="#6684"> 6684: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Name /Note'</span>;
</span><span id="6685" class="l"><a href="#6685"> 6685: </a>                                }
</span><span id="6686" class="l"><a href="#6686"> 6686: </a>                                <span class="php-var">$statemodels</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Marked'</span>, <span class="php-quote">'Review'</span>);
</span><span id="6687" class="l"><a href="#6687"> 6687: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'statemodel'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'statemodel'</span>], <span class="php-var">$statemodels</span>)) {
</span><span id="6688" class="l"><a href="#6688"> 6688: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /StateModel /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'statemodel'</span>];
</span><span id="6689" class="l"><a href="#6689"> 6689: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="6690" class="l"><a href="#6690"> 6690: </a>                                    <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'statemodel'</span>] = <span class="php-quote">'Marked'</span>;
</span><span id="6691" class="l"><a href="#6691"> 6691: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /StateModel /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'statemodel'</span>];
</span><span id="6692" class="l"><a href="#6692"> 6692: </a>                                }
</span><span id="6693" class="l"><a href="#6693"> 6693: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'statemodel'</span>] == <span class="php-quote">'Marked'</span>) {
</span><span id="6694" class="l"><a href="#6694"> 6694: </a>                                    <span class="php-var">$states</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Accepted'</span>, <span class="php-quote">'Unmarked'</span>);
</span><span id="6695" class="l"><a href="#6695"> 6695: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="6696" class="l"><a href="#6696"> 6696: </a>                                    <span class="php-var">$states</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Accepted'</span>, <span class="php-quote">'Rejected'</span>, <span class="php-quote">'Cancelled'</span>, <span class="php-quote">'Completed'</span>, <span class="php-quote">'None'</span>);
</span><span id="6697" class="l"><a href="#6697"> 6697: </a>                                }
</span><span id="6698" class="l"><a href="#6698"> 6698: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'state'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'state'</span>], <span class="php-var">$states</span>)) {
</span><span id="6699" class="l"><a href="#6699"> 6699: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /State /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'state'</span>];
</span><span id="6700" class="l"><a href="#6700"> 6700: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="6701" class="l"><a href="#6701"> 6701: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'statemodel'</span>] == <span class="php-quote">'Marked'</span>) {
</span><span id="6702" class="l"><a href="#6702"> 6702: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /State /Unmarked'</span>;
</span><span id="6703" class="l"><a href="#6703"> 6703: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6704" class="l"><a href="#6704"> 6704: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /State /None'</span>;
</span><span id="6705" class="l"><a href="#6705"> 6705: </a>                                    }
</span><span id="6706" class="l"><a href="#6706"> 6706: </a>                                }
</span><span id="6707" class="l"><a href="#6707"> 6707: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6708" class="l"><a href="#6708"> 6708: </a>                            }
</span><span id="6709" class="l"><a href="#6709"> 6709: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'link'</span>: {
</span><span id="6710" class="l"><a href="#6710"> 6710: </a>                                <span class="php-keyword1">if</span>(<span class="php-keyword2">is_string</span>(<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>])) {
</span><span id="6711" class="l"><a href="#6711"> 6711: </a>                                    <span class="php-comment">// external URI link</span>
</span><span id="6712" class="l"><a href="#6712"> 6712: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /A &lt;&lt;/S /URI /URI '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$this</span>-&gt;unhtmlentities(<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>])).<span class="php-quote">'&gt;&gt;'</span>;
</span><span id="6713" class="l"><a href="#6713"> 6713: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="6714" class="l"><a href="#6714"> 6714: </a>                                    <span class="php-comment">// internal link</span>
</span><span id="6715" class="l"><a href="#6715"> 6715: </a>                                    <span class="php-var">$l</span> = <span class="php-var">$this</span>-&gt;links[<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]];
</span><span id="6716" class="l"><a href="#6716"> 6716: </a>                                    <span class="php-var">$annots</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' /Dest [%d 0 R /XYZ 0 %.2F null]'</span>, (<span class="php-num">1</span> + (<span class="php-num">2</span> * <span class="php-var">$l</span>[<span class="php-num">0</span>])), (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$l</span>[<span class="php-num">0</span>]][<span class="php-quote">'h'</span>] - (<span class="php-var">$l</span>[<span class="php-num">1</span>] * <span class="php-var">$this</span>-&gt;k)));
</span><span id="6717" class="l"><a href="#6717"> 6717: </a>                                }
</span><span id="6718" class="l"><a href="#6718"> 6718: </a>                                <span class="php-var">$hmodes</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'N'</span>, <span class="php-quote">'I'</span>, <span class="php-quote">'O'</span>, <span class="php-quote">'P'</span>);
</span><span id="6719" class="l"><a href="#6719"> 6719: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'h'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'h'</span>], <span class="php-var">$hmodes</span>)) {
</span><span id="6720" class="l"><a href="#6720"> 6720: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /H /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'h'</span>];
</span><span id="6721" class="l"><a href="#6721"> 6721: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="6722" class="l"><a href="#6722"> 6722: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /H /I'</span>;
</span><span id="6723" class="l"><a href="#6723"> 6723: </a>                                }
</span><span id="6724" class="l"><a href="#6724"> 6724: </a>                                <span class="php-comment">//$annots .= ' /PA ';</span>
</span><span id="6725" class="l"><a href="#6725"> 6725: </a>                                <span class="php-comment">//$annots .= ' /Quadpoints ';</span>
</span><span id="6726" class="l"><a href="#6726"> 6726: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6727" class="l"><a href="#6727"> 6727: </a>                            }
</span><span id="6728" class="l"><a href="#6728"> 6728: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'freetext'</span>: {
</span><span id="6729" class="l"><a href="#6729"> 6729: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'da'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'da'</span>])) {
</span><span id="6730" class="l"><a href="#6730"> 6730: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /DA ('</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'da'</span>].<span class="php-quote">')'</span>;
</span><span id="6731" class="l"><a href="#6731"> 6731: </a>                                }
</span><span id="6732" class="l"><a href="#6732"> 6732: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>] &gt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>] &lt;= <span class="php-num">2</span>)) {
</span><span id="6733" class="l"><a href="#6733"> 6733: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Q '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>]);
</span><span id="6734" class="l"><a href="#6734"> 6734: </a>                                }
</span><span id="6735" class="l"><a href="#6735"> 6735: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rc'</span>])) {
</span><span id="6736" class="l"><a href="#6736"> 6736: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /RC '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rc'</span>]);
</span><span id="6737" class="l"><a href="#6737"> 6737: </a>                                }
</span><span id="6738" class="l"><a href="#6738"> 6738: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ds'</span>])) {
</span><span id="6739" class="l"><a href="#6739"> 6739: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /DS '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ds'</span>]);
</span><span id="6740" class="l"><a href="#6740"> 6740: </a>                                }
</span><span id="6741" class="l"><a href="#6741"> 6741: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'cl'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'cl'</span>])) {
</span><span id="6742" class="l"><a href="#6742"> 6742: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /CL ['</span>;
</span><span id="6743" class="l"><a href="#6743"> 6743: </a>                                    <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'cl'</span>] <span class="php-keyword1">as</span> <span class="php-var">$cl</span>) {
</span><span id="6744" class="l"><a href="#6744"> 6744: </a>                                        <span class="php-var">$annots</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.4F '</span>, <span class="php-var">$cl</span> * <span class="php-var">$this</span>-&gt;k);
</span><span id="6745" class="l"><a href="#6745"> 6745: </a>                                    }
</span><span id="6746" class="l"><a href="#6746"> 6746: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="6747" class="l"><a href="#6747"> 6747: </a>                                }
</span><span id="6748" class="l"><a href="#6748"> 6748: </a>                                <span class="php-var">$tfit</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'FreeText'</span>, <span class="php-quote">'FreeTextCallout'</span>, <span class="php-quote">'FreeTextTypeWriter'</span>);
</span><span id="6749" class="l"><a href="#6749"> 6749: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'it'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'it'</span>], <span class="php-var">$tfit</span>)) {
</span><span id="6750" class="l"><a href="#6750"> 6750: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /IT '</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'it'</span>];
</span><span id="6751" class="l"><a href="#6751"> 6751: </a>                                }
</span><span id="6752" class="l"><a href="#6752"> 6752: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rd'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rd'</span>])) {
</span><span id="6753" class="l"><a href="#6753"> 6753: </a>                                    <span class="php-var">$l</span> = <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rd'</span>][<span class="php-num">0</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="6754" class="l"><a href="#6754"> 6754: </a>                                    <span class="php-var">$r</span> = <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rd'</span>][<span class="php-num">1</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="6755" class="l"><a href="#6755"> 6755: </a>                                    <span class="php-var">$t</span> = <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rd'</span>][<span class="php-num">2</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="6756" class="l"><a href="#6756"> 6756: </a>                                    <span class="php-var">$b</span> = <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rd'</span>][<span class="php-num">3</span>] * <span class="php-var">$this</span>-&gt;k;
</span><span id="6757" class="l"><a href="#6757"> 6757: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /RD ['</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F'</span>, <span class="php-var">$l</span>, <span class="php-var">$r</span>, <span class="php-var">$t</span>, <span class="php-var">$b</span>).<span class="php-quote">']'</span>;
</span><span id="6758" class="l"><a href="#6758"> 6758: </a>                                }
</span><span id="6759" class="l"><a href="#6759"> 6759: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'le'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'le'</span>], <span class="php-var">$lineendings</span>)) {
</span><span id="6760" class="l"><a href="#6760"> 6760: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /LE /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'le'</span>];
</span><span id="6761" class="l"><a href="#6761"> 6761: </a>                                }
</span><span id="6762" class="l"><a href="#6762"> 6762: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6763" class="l"><a href="#6763"> 6763: </a>                            }
</span><span id="6764" class="l"><a href="#6764"> 6764: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'line'</span>: {
</span><span id="6765" class="l"><a href="#6765"> 6765: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6766" class="l"><a href="#6766"> 6766: </a>                            }
</span><span id="6767" class="l"><a href="#6767"> 6767: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'square'</span>: {
</span><span id="6768" class="l"><a href="#6768"> 6768: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6769" class="l"><a href="#6769"> 6769: </a>                            }
</span><span id="6770" class="l"><a href="#6770"> 6770: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'circle'</span>: {
</span><span id="6771" class="l"><a href="#6771"> 6771: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6772" class="l"><a href="#6772"> 6772: </a>                            }
</span><span id="6773" class="l"><a href="#6773"> 6773: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'polygon'</span>: {
</span><span id="6774" class="l"><a href="#6774"> 6774: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6775" class="l"><a href="#6775"> 6775: </a>                            }
</span><span id="6776" class="l"><a href="#6776"> 6776: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'polyline'</span>: {
</span><span id="6777" class="l"><a href="#6777"> 6777: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6778" class="l"><a href="#6778"> 6778: </a>                            }
</span><span id="6779" class="l"><a href="#6779"> 6779: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'highlight'</span>: {
</span><span id="6780" class="l"><a href="#6780"> 6780: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6781" class="l"><a href="#6781"> 6781: </a>                            }
</span><span id="6782" class="l"><a href="#6782"> 6782: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'underline'</span>: {
</span><span id="6783" class="l"><a href="#6783"> 6783: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6784" class="l"><a href="#6784"> 6784: </a>                            }
</span><span id="6785" class="l"><a href="#6785"> 6785: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'squiggly'</span>: {
</span><span id="6786" class="l"><a href="#6786"> 6786: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6787" class="l"><a href="#6787"> 6787: </a>                            }
</span><span id="6788" class="l"><a href="#6788"> 6788: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'strikeout'</span>: {
</span><span id="6789" class="l"><a href="#6789"> 6789: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6790" class="l"><a href="#6790"> 6790: </a>                            }
</span><span id="6791" class="l"><a href="#6791"> 6791: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'stamp'</span>: {
</span><span id="6792" class="l"><a href="#6792"> 6792: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6793" class="l"><a href="#6793"> 6793: </a>                            }
</span><span id="6794" class="l"><a href="#6794"> 6794: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'caret'</span>: {
</span><span id="6795" class="l"><a href="#6795"> 6795: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6796" class="l"><a href="#6796"> 6796: </a>                            }
</span><span id="6797" class="l"><a href="#6797"> 6797: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'ink'</span>: {
</span><span id="6798" class="l"><a href="#6798"> 6798: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6799" class="l"><a href="#6799"> 6799: </a>                            }
</span><span id="6800" class="l"><a href="#6800"> 6800: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'popup'</span>: {
</span><span id="6801" class="l"><a href="#6801"> 6801: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6802" class="l"><a href="#6802"> 6802: </a>                            }
</span><span id="6803" class="l"><a href="#6803"> 6803: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'fileattachment'</span>: {
</span><span id="6804" class="l"><a href="#6804"> 6804: </a>                                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'fs'</span>])) {
</span><span id="6805" class="l"><a href="#6805"> 6805: </a>                                    <span class="php-keyword1">break</span>;
</span><span id="6806" class="l"><a href="#6806"> 6806: </a>                                }
</span><span id="6807" class="l"><a href="#6807"> 6807: </a>                                <span class="php-var">$filename</span> = <span class="php-keyword2">basename</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'fs'</span>]);
</span><span id="6808" class="l"><a href="#6808"> 6808: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;embeddedfiles[<span class="php-var">$filename</span>][<span class="php-quote">'n'</span>])) {
</span><span id="6809" class="l"><a href="#6809"> 6809: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /FS &lt;&lt;/Type /Filespec /F '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$filename</span>).<span class="php-quote">' /EF &lt;&lt;/F '</span>.<span class="php-var">$this</span>-&gt;embeddedfiles[<span class="php-var">$filename</span>][<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R&gt;&gt; &gt;&gt;'</span>;
</span><span id="6810" class="l"><a href="#6810"> 6810: </a>                                    <span class="php-var">$iconsapp</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Graph'</span>, <span class="php-quote">'Paperclip'</span>, <span class="php-quote">'PushPin'</span>, <span class="php-quote">'Tag'</span>);
</span><span id="6811" class="l"><a href="#6811"> 6811: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>], <span class="php-var">$iconsapp</span>)) {
</span><span id="6812" class="l"><a href="#6812"> 6812: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /Name /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>];
</span><span id="6813" class="l"><a href="#6813"> 6813: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6814" class="l"><a href="#6814"> 6814: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /Name /PushPin'</span>;
</span><span id="6815" class="l"><a href="#6815"> 6815: </a>                                    }
</span><span id="6816" class="l"><a href="#6816"> 6816: </a>                                }
</span><span id="6817" class="l"><a href="#6817"> 6817: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6818" class="l"><a href="#6818"> 6818: </a>                            }
</span><span id="6819" class="l"><a href="#6819"> 6819: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'sound'</span>: {
</span><span id="6820" class="l"><a href="#6820"> 6820: </a>                                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'fs'</span>])) {
</span><span id="6821" class="l"><a href="#6821"> 6821: </a>                                    <span class="php-keyword1">break</span>;
</span><span id="6822" class="l"><a href="#6822"> 6822: </a>                                }
</span><span id="6823" class="l"><a href="#6823"> 6823: </a>                                <span class="php-var">$filename</span> = <span class="php-keyword2">basename</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'fs'</span>]);
</span><span id="6824" class="l"><a href="#6824"> 6824: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;embeddedfiles[<span class="php-var">$filename</span>][<span class="php-quote">'n'</span>])) {
</span><span id="6825" class="l"><a href="#6825"> 6825: </a>                                    <span class="php-comment">// ... TO BE COMPLETED ...</span>
</span><span id="6826" class="l"><a href="#6826"> 6826: </a>                                    <span class="php-comment">// /R /C /B /E /CO /CP</span>
</span><span id="6827" class="l"><a href="#6827"> 6827: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Sound &lt;&lt;/Type /Filespec /F '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$filename</span>).<span class="php-quote">' /EF &lt;&lt;/F '</span>.<span class="php-var">$this</span>-&gt;embeddedfiles[<span class="php-var">$filename</span>][<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R&gt;&gt; &gt;&gt;'</span>;
</span><span id="6828" class="l"><a href="#6828"> 6828: </a>                                    <span class="php-var">$iconsapp</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'Speaker'</span>, <span class="php-quote">'Mic'</span>);
</span><span id="6829" class="l"><a href="#6829"> 6829: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>], <span class="php-var">$iconsapp</span>)) {
</span><span id="6830" class="l"><a href="#6830"> 6830: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /Name /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'name'</span>];
</span><span id="6831" class="l"><a href="#6831"> 6831: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6832" class="l"><a href="#6832"> 6832: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /Name /Speaker'</span>;
</span><span id="6833" class="l"><a href="#6833"> 6833: </a>                                    }
</span><span id="6834" class="l"><a href="#6834"> 6834: </a>                                }
</span><span id="6835" class="l"><a href="#6835"> 6835: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6836" class="l"><a href="#6836"> 6836: </a>                            }
</span><span id="6837" class="l"><a href="#6837"> 6837: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'movie'</span>: {
</span><span id="6838" class="l"><a href="#6838"> 6838: </a>                                <span class="php-keyword1">break</span>;
</span><span id="6839" class="l"><a href="#6839"> 6839: </a>                            }
</span><span id="6840" class="l"><a href="#6840"> 6840: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'widget'</span>: {
</span><span id="6841" class="l"><a href="#6841"> 6841: </a>                                <span class="php-var">$hmode</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'N'</span>, <span class="php-quote">'I'</span>, <span class="php-quote">'O'</span>, <span class="php-quote">'P'</span>, <span class="php-quote">'T'</span>);
</span><span id="6842" class="l"><a href="#6842"> 6842: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'h'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'h'</span>], <span class="php-var">$hmode</span>)) {
</span><span id="6843" class="l"><a href="#6843"> 6843: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /H /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'h'</span>];
</span><span id="6844" class="l"><a href="#6844"> 6844: </a>                                }
</span><span id="6845" class="l"><a href="#6845"> 6845: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>])) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>])) {
</span><span id="6846" class="l"><a href="#6846"> 6846: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /MK &lt;&lt;'</span>;
</span><span id="6847" class="l"><a href="#6847"> 6847: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'r'</span>])) {
</span><span id="6848" class="l"><a href="#6848"> 6848: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /R '</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'r'</span>];
</span><span id="6849" class="l"><a href="#6849"> 6849: </a>                                    }
</span><span id="6850" class="l"><a href="#6850"> 6850: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'bc'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'bc'</span>]))) {
</span><span id="6851" class="l"><a href="#6851"> 6851: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /BC ['</span>;
</span><span id="6852" class="l"><a href="#6852"> 6852: </a>                                        <span class="php-keyword1">foreach</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'bc'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$col</span>) {
</span><span id="6853" class="l"><a href="#6853"> 6853: </a>                                            <span class="php-var">$col</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$col</span>);
</span><span id="6854" class="l"><a href="#6854"> 6854: </a>                                            <span class="php-var">$color</span> = <span class="php-var">$col</span> &lt;= <span class="php-num">0</span> ? <span class="php-num">0</span> : (<span class="php-var">$col</span> &gt;= <span class="php-num">255</span> ? <span class="php-num">1</span> : <span class="php-var">$col</span> / <span class="php-num">255</span>);
</span><span id="6855" class="l"><a href="#6855"> 6855: </a>                                            <span class="php-var">$annots</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' %.2F'</span>, <span class="php-var">$color</span>);
</span><span id="6856" class="l"><a href="#6856"> 6856: </a>                                        }
</span><span id="6857" class="l"><a href="#6857"> 6857: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="6858" class="l"><a href="#6858"> 6858: </a>                                    }
</span><span id="6859" class="l"><a href="#6859"> 6859: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'bg'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'bg'</span>]))) {
</span><span id="6860" class="l"><a href="#6860"> 6860: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /BG ['</span>;
</span><span id="6861" class="l"><a href="#6861"> 6861: </a>                                        <span class="php-keyword1">foreach</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'bg'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$col</span>) {
</span><span id="6862" class="l"><a href="#6862"> 6862: </a>                                            <span class="php-var">$col</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$col</span>);
</span><span id="6863" class="l"><a href="#6863"> 6863: </a>                                            <span class="php-var">$color</span> = <span class="php-var">$col</span> &lt;= <span class="php-num">0</span> ? <span class="php-num">0</span> : (<span class="php-var">$col</span> &gt;= <span class="php-num">255</span> ? <span class="php-num">1</span> : <span class="php-var">$col</span> / <span class="php-num">255</span>);
</span><span id="6864" class="l"><a href="#6864"> 6864: </a>                                            <span class="php-var">$annots</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' %.2F'</span>, <span class="php-var">$color</span>);
</span><span id="6865" class="l"><a href="#6865"> 6865: </a>                                        }
</span><span id="6866" class="l"><a href="#6866"> 6866: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="6867" class="l"><a href="#6867"> 6867: </a>                                    }
</span><span id="6868" class="l"><a href="#6868"> 6868: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ca'</span>])) {
</span><span id="6869" class="l"><a href="#6869"> 6869: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /CA '</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ca'</span>].<span class="php-quote">''</span>;
</span><span id="6870" class="l"><a href="#6870"> 6870: </a>                                    }
</span><span id="6871" class="l"><a href="#6871"> 6871: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'rc'</span>])) {
</span><span id="6872" class="l"><a href="#6872"> 6872: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /RC '</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ca'</span>].<span class="php-quote">''</span>;
</span><span id="6873" class="l"><a href="#6873"> 6873: </a>                                    }
</span><span id="6874" class="l"><a href="#6874"> 6874: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ac'</span>])) {
</span><span id="6875" class="l"><a href="#6875"> 6875: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /AC '</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ca'</span>].<span class="php-quote">''</span>;
</span><span id="6876" class="l"><a href="#6876"> 6876: </a>                                    }
</span><span id="6877" class="l"><a href="#6877"> 6877: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'i'</span>])) {
</span><span id="6878" class="l"><a href="#6878"> 6878: </a>                                        <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;getImageBuffer(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'i'</span>]);
</span><span id="6879" class="l"><a href="#6879"> 6879: </a>                                        <span class="php-keyword1">if</span> (<span class="php-var">$info</span> !== <span class="php-keyword1">false</span>) {
</span><span id="6880" class="l"><a href="#6880"> 6880: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' /I '</span>.<span class="php-var">$info</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="6881" class="l"><a href="#6881"> 6881: </a>                                        }
</span><span id="6882" class="l"><a href="#6882"> 6882: </a>                                    }
</span><span id="6883" class="l"><a href="#6883"> 6883: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ri'</span>])) {
</span><span id="6884" class="l"><a href="#6884"> 6884: </a>                                        <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;getImageBuffer(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ri'</span>]);
</span><span id="6885" class="l"><a href="#6885"> 6885: </a>                                        <span class="php-keyword1">if</span> (<span class="php-var">$info</span> !== <span class="php-keyword1">false</span>) {
</span><span id="6886" class="l"><a href="#6886"> 6886: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' /RI '</span>.<span class="php-var">$info</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="6887" class="l"><a href="#6887"> 6887: </a>                                        }
</span><span id="6888" class="l"><a href="#6888"> 6888: </a>                                    }
</span><span id="6889" class="l"><a href="#6889"> 6889: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ix'</span>])) {
</span><span id="6890" class="l"><a href="#6890"> 6890: </a>                                        <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;getImageBuffer(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'ix'</span>]);
</span><span id="6891" class="l"><a href="#6891"> 6891: </a>                                        <span class="php-keyword1">if</span> (<span class="php-var">$info</span> !== <span class="php-keyword1">false</span>) {
</span><span id="6892" class="l"><a href="#6892"> 6892: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' /IX '</span>.<span class="php-var">$info</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="6893" class="l"><a href="#6893"> 6893: </a>                                        }
</span><span id="6894" class="l"><a href="#6894"> 6894: </a>                                    }
</span><span id="6895" class="l"><a href="#6895"> 6895: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>])) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>])) {
</span><span id="6896" class="l"><a href="#6896"> 6896: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /IF &lt;&lt;'</span>;
</span><span id="6897" class="l"><a href="#6897"> 6897: </a>                                        <span class="php-var">$if_sw</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'A'</span>, <span class="php-quote">'B'</span>, <span class="php-quote">'S'</span>, <span class="php-quote">'N'</span>);
</span><span id="6898" class="l"><a href="#6898"> 6898: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'sw'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'sw'</span>], <span class="php-var">$if_sw</span>)) {
</span><span id="6899" class="l"><a href="#6899"> 6899: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' /SW /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'sw'</span>];
</span><span id="6900" class="l"><a href="#6900"> 6900: </a>                                        }
</span><span id="6901" class="l"><a href="#6901"> 6901: </a>                                        <span class="php-var">$if_s</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'A'</span>, <span class="php-quote">'P'</span>);
</span><span id="6902" class="l"><a href="#6902"> 6902: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'s'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'s'</span>], <span class="php-var">$if_s</span>)) {
</span><span id="6903" class="l"><a href="#6903"> 6903: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' /S /'</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'s'</span>];
</span><span id="6904" class="l"><a href="#6904"> 6904: </a>                                        }
</span><span id="6905" class="l"><a href="#6905"> 6905: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>])) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>])) {
</span><span id="6906" class="l"><a href="#6906"> 6906: </a>                                            <span class="php-var">$annots</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' /A [%.2F  %.2F]'</span>, <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>][<span class="php-num">0</span>], <span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>][<span class="php-num">1</span>]);
</span><span id="6907" class="l"><a href="#6907"> 6907: </a>                                        }
</span><span id="6908" class="l"><a href="#6908"> 6908: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'fb'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'fb'</span>])) {
</span><span id="6909" class="l"><a href="#6909"> 6909: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' /FB true'</span>;
</span><span id="6910" class="l"><a href="#6910"> 6910: </a>                                        }
</span><span id="6911" class="l"><a href="#6911"> 6911: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">'&gt;&gt;'</span>;
</span><span id="6912" class="l"><a href="#6912"> 6912: </a>                                    }
</span><span id="6913" class="l"><a href="#6913"> 6913: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] &gt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] &lt;= <span class="php-num">6</span>)) {
</span><span id="6914" class="l"><a href="#6914"> 6914: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /TP '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>]);
</span><span id="6915" class="l"><a href="#6915"> 6915: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6916" class="l"><a href="#6916"> 6916: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' /TP 0'</span>;
</span><span id="6917" class="l"><a href="#6917"> 6917: </a>                                    }
</span><span id="6918" class="l"><a href="#6918"> 6918: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">'&gt;&gt;'</span>;
</span><span id="6919" class="l"><a href="#6919"> 6919: </a>                                } <span class="php-comment">// end MK</span>
</span><span id="6920" class="l"><a href="#6920"> 6920: </a>                                <span class="php-comment">// --- Entries for field dictionaries ---</span>
</span><span id="6921" class="l"><a href="#6921"> 6921: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$n</span>][<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]])) {
</span><span id="6922" class="l"><a href="#6922"> 6922: </a>                                    <span class="php-comment">// set parent</span>
</span><span id="6923" class="l"><a href="#6923"> 6923: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Parent '</span>.<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$n</span>][<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]].<span class="php-quote">' 0 R'</span>;
</span><span id="6924" class="l"><a href="#6924"> 6924: </a>                                }
</span><span id="6925" class="l"><a href="#6925"> 6925: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'t'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_string</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'t'</span>])) {
</span><span id="6926" class="l"><a href="#6926"> 6926: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /T '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'t'</span>]);
</span><span id="6927" class="l"><a href="#6927"> 6927: </a>                                }
</span><span id="6928" class="l"><a href="#6928"> 6928: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'tu'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_string</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'tu'</span>])) {
</span><span id="6929" class="l"><a href="#6929"> 6929: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /TU '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'tu'</span>]);
</span><span id="6930" class="l"><a href="#6930"> 6930: </a>                                }
</span><span id="6931" class="l"><a href="#6931"> 6931: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'tm'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_string</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'tm'</span>])) {
</span><span id="6932" class="l"><a href="#6932"> 6932: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /TM '</span>.<span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'tm'</span>]);
</span><span id="6933" class="l"><a href="#6933"> 6933: </a>                                }
</span><span id="6934" class="l"><a href="#6934"> 6934: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ff'</span>])) {
</span><span id="6935" class="l"><a href="#6935"> 6935: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ff'</span>])) {
</span><span id="6936" class="l"><a href="#6936"> 6936: </a>                                        <span class="php-comment">// array of bit settings</span>
</span><span id="6937" class="l"><a href="#6937"> 6937: </a>                                        <span class="php-var">$flag</span> = <span class="php-num">0</span>;
</span><span id="6938" class="l"><a href="#6938"> 6938: </a>                                        <span class="php-keyword1">foreach</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ff'</span>] <span class="php-keyword1">as</span> <span class="php-var">$val</span>) {
</span><span id="6939" class="l"><a href="#6939"> 6939: </a>                                            <span class="php-var">$flag</span> += <span class="php-num">1</span> &lt;&lt; (<span class="php-var">$val</span> - <span class="php-num">1</span>);
</span><span id="6940" class="l"><a href="#6940"> 6940: </a>                                        }
</span><span id="6941" class="l"><a href="#6941"> 6941: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6942" class="l"><a href="#6942"> 6942: </a>                                        <span class="php-var">$flag</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ff'</span>]);
</span><span id="6943" class="l"><a href="#6943"> 6943: </a>                                    }
</span><span id="6944" class="l"><a href="#6944"> 6944: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Ff '</span>.<span class="php-var">$flag</span>;
</span><span id="6945" class="l"><a href="#6945"> 6945: </a>                                }
</span><span id="6946" class="l"><a href="#6946"> 6946: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'maxlen'</span>])) {
</span><span id="6947" class="l"><a href="#6947"> 6947: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /MaxLen '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'maxlen'</span>]);
</span><span id="6948" class="l"><a href="#6948"> 6948: </a>                                }
</span><span id="6949" class="l"><a href="#6949"> 6949: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'v'</span>])) {
</span><span id="6950" class="l"><a href="#6950"> 6950: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /V'</span>;
</span><span id="6951" class="l"><a href="#6951"> 6951: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'v'</span>])) {
</span><span id="6952" class="l"><a href="#6952"> 6952: </a>                                        <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'v'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$optval</span>) {
</span><span id="6953" class="l"><a href="#6953"> 6953: </a>                                            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_float</span>(<span class="php-var">$optval</span>)) {
</span><span id="6954" class="l"><a href="#6954"> 6954: </a>                                                <span class="php-var">$optval</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F'</span>, <span class="php-var">$optval</span>);
</span><span id="6955" class="l"><a href="#6955"> 6955: </a>                                            }
</span><span id="6956" class="l"><a href="#6956"> 6956: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$optval</span>;
</span><span id="6957" class="l"><a href="#6957"> 6957: </a>                                        }
</span><span id="6958" class="l"><a href="#6958"> 6958: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6959" class="l"><a href="#6959"> 6959: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'v'</span>]);
</span><span id="6960" class="l"><a href="#6960"> 6960: </a>                                    }
</span><span id="6961" class="l"><a href="#6961"> 6961: </a>                                }
</span><span id="6962" class="l"><a href="#6962"> 6962: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'dv'</span>])) {
</span><span id="6963" class="l"><a href="#6963"> 6963: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /DV'</span>;
</span><span id="6964" class="l"><a href="#6964"> 6964: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'dv'</span>])) {
</span><span id="6965" class="l"><a href="#6965"> 6965: </a>                                        <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'dv'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$optval</span>) {
</span><span id="6966" class="l"><a href="#6966"> 6966: </a>                                            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_float</span>(<span class="php-var">$optval</span>)) {
</span><span id="6967" class="l"><a href="#6967"> 6967: </a>                                                <span class="php-var">$optval</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F'</span>, <span class="php-var">$optval</span>);
</span><span id="6968" class="l"><a href="#6968"> 6968: </a>                                            }
</span><span id="6969" class="l"><a href="#6969"> 6969: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$optval</span>;
</span><span id="6970" class="l"><a href="#6970"> 6970: </a>                                        }
</span><span id="6971" class="l"><a href="#6971"> 6971: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6972" class="l"><a href="#6972"> 6972: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'dv'</span>]);
</span><span id="6973" class="l"><a href="#6973"> 6973: </a>                                    }
</span><span id="6974" class="l"><a href="#6974"> 6974: </a>                                }
</span><span id="6975" class="l"><a href="#6975"> 6975: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rv'</span>])) {
</span><span id="6976" class="l"><a href="#6976"> 6976: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /RV'</span>;
</span><span id="6977" class="l"><a href="#6977"> 6977: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rv'</span>])) {
</span><span id="6978" class="l"><a href="#6978"> 6978: </a>                                        <span class="php-keyword1">foreach</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rv'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$optval</span>) {
</span><span id="6979" class="l"><a href="#6979"> 6979: </a>                                            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_float</span>(<span class="php-var">$optval</span>)) {
</span><span id="6980" class="l"><a href="#6980"> 6980: </a>                                                <span class="php-var">$optval</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F'</span>, <span class="php-var">$optval</span>);
</span><span id="6981" class="l"><a href="#6981"> 6981: </a>                                            }
</span><span id="6982" class="l"><a href="#6982"> 6982: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$optval</span>;
</span><span id="6983" class="l"><a href="#6983"> 6983: </a>                                        }
</span><span id="6984" class="l"><a href="#6984"> 6984: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="6985" class="l"><a href="#6985"> 6985: </a>                                        <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'rv'</span>]);
</span><span id="6986" class="l"><a href="#6986"> 6986: </a>                                    }
</span><span id="6987" class="l"><a href="#6987"> 6987: </a>                                }
</span><span id="6988" class="l"><a href="#6988"> 6988: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'a'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'a'</span>])) {
</span><span id="6989" class="l"><a href="#6989"> 6989: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /A &lt;&lt; '</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'a'</span>].<span class="php-quote">' &gt;&gt;'</span>;
</span><span id="6990" class="l"><a href="#6990"> 6990: </a>                                }
</span><span id="6991" class="l"><a href="#6991"> 6991: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'aa'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'aa'</span>])) {
</span><span id="6992" class="l"><a href="#6992"> 6992: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /AA &lt;&lt; '</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'aa'</span>].<span class="php-quote">' &gt;&gt;'</span>;
</span><span id="6993" class="l"><a href="#6993"> 6993: </a>                                }
</span><span id="6994" class="l"><a href="#6994"> 6994: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'da'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'da'</span>])) {
</span><span id="6995" class="l"><a href="#6995"> 6995: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /DA ('</span>.<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'da'</span>].<span class="php-quote">')'</span>;
</span><span id="6996" class="l"><a href="#6996"> 6996: </a>                                }
</span><span id="6997" class="l"><a href="#6997"> 6997: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>] &gt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>] &lt;= <span class="php-num">2</span>)) {
</span><span id="6998" class="l"><a href="#6998"> 6998: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Q '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'q'</span>]);
</span><span id="6999" class="l"><a href="#6999"> 6999: </a>                                }
</span><span id="7000" class="l"><a href="#7000"> 7000: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'opt'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'opt'</span>])) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'opt'</span>])) {
</span><span id="7001" class="l"><a href="#7001"> 7001: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /Opt ['</span>;
</span><span id="7002" class="l"><a href="#7002"> 7002: </a>                                    <span class="php-keyword1">foreach</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'opt'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$copt</span>) {
</span><span id="7003" class="l"><a href="#7003"> 7003: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$copt</span>)) {
</span><span id="7004" class="l"><a href="#7004"> 7004: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' ['</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$copt</span>[<span class="php-num">0</span>]).<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$copt</span>[<span class="php-num">1</span>]).<span class="php-quote">']'</span>;
</span><span id="7005" class="l"><a href="#7005"> 7005: </a>                                        } <span class="php-keyword1">else</span> {
</span><span id="7006" class="l"><a href="#7006"> 7006: </a>                                            <span class="php-var">$annots</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_textannobjstring(<span class="php-var">$copt</span>);
</span><span id="7007" class="l"><a href="#7007"> 7007: </a>                                        }
</span><span id="7008" class="l"><a href="#7008"> 7008: </a>                                    }
</span><span id="7009" class="l"><a href="#7009"> 7009: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="7010" class="l"><a href="#7010"> 7010: </a>                                }
</span><span id="7011" class="l"><a href="#7011"> 7011: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ti'</span>])) {
</span><span id="7012" class="l"><a href="#7012"> 7012: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /TI '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'ti'</span>]);
</span><span id="7013" class="l"><a href="#7013"> 7013: </a>                                }
</span><span id="7014" class="l"><a href="#7014"> 7014: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'i'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'i'</span>])) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'i'</span>])) {
</span><span id="7015" class="l"><a href="#7015"> 7015: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">' /I ['</span>;
</span><span id="7016" class="l"><a href="#7016"> 7016: </a>                                    <span class="php-keyword1">foreach</span>(<span class="php-var">$pl</span>[<span class="php-quote">'opt'</span>][<span class="php-quote">'i'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$copt</span>) {
</span><span id="7017" class="l"><a href="#7017"> 7017: </a>                                        <span class="php-var">$annots</span> .= <span class="php-keyword2">intval</span>(<span class="php-var">$copt</span>).<span class="php-quote">' '</span>;
</span><span id="7018" class="l"><a href="#7018"> 7018: </a>                                    }
</span><span id="7019" class="l"><a href="#7019"> 7019: </a>                                    <span class="php-var">$annots</span> .= <span class="php-quote">']'</span>;
</span><span id="7020" class="l"><a href="#7020"> 7020: </a>                                }
</span><span id="7021" class="l"><a href="#7021"> 7021: </a>                                <span class="php-keyword1">break</span>;
</span><span id="7022" class="l"><a href="#7022"> 7022: </a>                            }
</span><span id="7023" class="l"><a href="#7023"> 7023: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'screen'</span>: {
</span><span id="7024" class="l"><a href="#7024"> 7024: </a>                                <span class="php-keyword1">break</span>;
</span><span id="7025" class="l"><a href="#7025"> 7025: </a>                            }
</span><span id="7026" class="l"><a href="#7026"> 7026: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'printermark'</span>: {
</span><span id="7027" class="l"><a href="#7027"> 7027: </a>                                <span class="php-keyword1">break</span>;
</span><span id="7028" class="l"><a href="#7028"> 7028: </a>                            }
</span><span id="7029" class="l"><a href="#7029"> 7029: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'trapnet'</span>: {
</span><span id="7030" class="l"><a href="#7030"> 7030: </a>                                <span class="php-keyword1">break</span>;
</span><span id="7031" class="l"><a href="#7031"> 7031: </a>                            }
</span><span id="7032" class="l"><a href="#7032"> 7032: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'watermark'</span>: {
</span><span id="7033" class="l"><a href="#7033"> 7033: </a>                                <span class="php-keyword1">break</span>;
</span><span id="7034" class="l"><a href="#7034"> 7034: </a>                            }
</span><span id="7035" class="l"><a href="#7035"> 7035: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'3d'</span>: {
</span><span id="7036" class="l"><a href="#7036"> 7036: </a>                                <span class="php-keyword1">break</span>;
</span><span id="7037" class="l"><a href="#7037"> 7037: </a>                            }
</span><span id="7038" class="l"><a href="#7038"> 7038: </a>                            <span class="php-keyword1">default</span>: {
</span><span id="7039" class="l"><a href="#7039"> 7039: </a>                                <span class="php-keyword1">break</span>;
</span><span id="7040" class="l"><a href="#7040"> 7040: </a>                            }
</span><span id="7041" class="l"><a href="#7041"> 7041: </a>                        }
</span><span id="7042" class="l"><a href="#7042"> 7042: </a>                        <span class="php-var">$annots</span> .= <span class="php-quote">'&gt;&gt;'</span>;
</span><span id="7043" class="l"><a href="#7043"> 7043: </a>                        <span class="php-comment">// create new annotation object</span>
</span><span id="7044" class="l"><a href="#7044"> 7044: </a>                        ++<span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="7045" class="l"><a href="#7045"> 7045: </a>                        <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$this</span>-&gt;annot_obj_id] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="7046" class="l"><a href="#7046"> 7046: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;annot_obj_id.<span class="php-quote">' 0 obj '</span>.<span class="php-var">$annots</span>.<span class="php-quote">' endobj'</span>);
</span><span id="7047" class="l"><a href="#7047"> 7047: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$formfield</span> <span class="php-keyword1">AND</span> ! <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$n</span>][<span class="php-var">$pl</span>[<span class="php-quote">'txt'</span>]])) {
</span><span id="7048" class="l"><a href="#7048"> 7048: </a>                            <span class="php-comment">// store reference of form object</span>
</span><span id="7049" class="l"><a href="#7049"> 7049: </a>                            <span class="php-var">$this</span>-&gt;form_obj_id[] = <span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="7050" class="l"><a href="#7050"> 7050: </a>                        }
</span><span id="7051" class="l"><a href="#7051"> 7051: </a>                    }
</span><span id="7052" class="l"><a href="#7052"> 7052: </a>                }
</span><span id="7053" class="l"><a href="#7053"> 7053: </a>            } <span class="php-comment">// end for each page</span>
</span><span id="7054" class="l"><a href="#7054"> 7054: </a>        }
</span><span id="7055" class="l"><a href="#7055"> 7055: </a>
</span><span id="7056" class="l"><a href="#7056"> 7056: </a>        <span class="php-comment">/**
</span></span><span id="7057" class="l"><a href="#7057"> 7057: </a><span class="php-comment">         * Put appearance streams XObject used to define annotation's appearance states
</span></span><span id="7058" class="l"><a href="#7058"> 7058: </a><span class="php-comment">         * @param int $w annotation width
</span></span><span id="7059" class="l"><a href="#7059"> 7059: </a><span class="php-comment">         * @param int $h annotation height
</span></span><span id="7060" class="l"><a href="#7060"> 7060: </a><span class="php-comment">         * @param string $stream appearance stream
</span></span><span id="7061" class="l"><a href="#7061"> 7061: </a><span class="php-comment">         * @return int object ID
</span></span><span id="7062" class="l"><a href="#7062"> 7062: </a><span class="php-comment">         * @access protected
</span></span><span id="7063" class="l"><a href="#7063"> 7063: </a><span class="php-comment">         * @since 4.8.001 (2009-09-09)
</span></span><span id="7064" class="l"><a href="#7064"> 7064: </a><span class="php-comment">         */</span>
</span><span id="7065" class="l"><a href="#7065"> 7065: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putAPXObject(<span class="php-var">$w</span>=<span class="php-num">0</span>, <span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$stream</span>=<span class="php-quote">''</span>) {
</span><span id="7066" class="l"><a href="#7066"> 7066: </a>            <span class="php-var">$stream</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$stream</span>);
</span><span id="7067" class="l"><a href="#7067"> 7067: </a>            ++<span class="php-var">$this</span>-&gt;apxo_obj_id;
</span><span id="7068" class="l"><a href="#7068"> 7068: </a>            <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$this</span>-&gt;apxo_obj_id] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="7069" class="l"><a href="#7069"> 7069: </a>            <span class="php-var">$out</span> = <span class="php-var">$this</span>-&gt;apxo_obj_id.<span class="php-quote">' 0 obj'</span>;
</span><span id="7070" class="l"><a href="#7070"> 7070: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &lt;&lt;'</span>;
</span><span id="7071" class="l"><a href="#7071"> 7071: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Type /XObject'</span>;
</span><span id="7072" class="l"><a href="#7072"> 7072: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /Form'</span>;
</span><span id="7073" class="l"><a href="#7073"> 7073: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /FormType 1'</span>;
</span><span id="7074" class="l"><a href="#7074"> 7074: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;compress) {
</span><span id="7075" class="l"><a href="#7075"> 7075: </a>                <span class="php-var">$stream</span> = <span class="php-keyword2">gzcompress</span>(<span class="php-var">$stream</span>);
</span><span id="7076" class="l"><a href="#7076"> 7076: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Filter /FlateDecode'</span>;
</span><span id="7077" class="l"><a href="#7077"> 7077: </a>            }
</span><span id="7078" class="l"><a href="#7078"> 7078: </a>            <span class="php-var">$rect</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F'</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>);
</span><span id="7079" class="l"><a href="#7079"> 7079: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /BBox [0 0 '</span>.<span class="php-var">$rect</span>.<span class="php-quote">']'</span>;
</span><span id="7080" class="l"><a href="#7080"> 7080: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Matrix [1 0 0 1 0 0]'</span>;
</span><span id="7081" class="l"><a href="#7081"> 7081: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Resources &lt;&lt;/ProcSet [/PDF]&gt;&gt;'</span>;
</span><span id="7082" class="l"><a href="#7082"> 7082: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$stream</span>);
</span><span id="7083" class="l"><a href="#7083"> 7083: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7084" class="l"><a href="#7084"> 7084: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$stream</span>);
</span><span id="7085" class="l"><a href="#7085"> 7085: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="7086" class="l"><a href="#7086"> 7086: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7087" class="l"><a href="#7087"> 7087: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;apxo_obj_id;
</span><span id="7088" class="l"><a href="#7088"> 7088: </a>        }
</span><span id="7089" class="l"><a href="#7089"> 7089: </a>
</span><span id="7090" class="l"><a href="#7090"> 7090: </a>        <span class="php-comment">/**
</span></span><span id="7091" class="l"><a href="#7091"> 7091: </a><span class="php-comment">         * Output fonts.
</span></span><span id="7092" class="l"><a href="#7092"> 7092: </a><span class="php-comment">         * @access protected
</span></span><span id="7093" class="l"><a href="#7093"> 7093: </a><span class="php-comment">         */</span>
</span><span id="7094" class="l"><a href="#7094"> 7094: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putfonts() {
</span><span id="7095" class="l"><a href="#7095"> 7095: </a>            <span class="php-var">$nf</span> = <span class="php-var">$this</span>-&gt;n;
</span><span id="7096" class="l"><a href="#7096"> 7096: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;diffs <span class="php-keyword1">as</span> <span class="php-var">$diff</span>) {
</span><span id="7097" class="l"><a href="#7097"> 7097: </a>                <span class="php-comment">//Encodings</span>
</span><span id="7098" class="l"><a href="#7098"> 7098: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7099" class="l"><a href="#7099"> 7099: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'&lt;&lt;/Type /Encoding /BaseEncoding /WinAnsiEncoding /Differences ['</span>.<span class="php-var">$diff</span>.<span class="php-quote">']&gt;&gt; endobj'</span>);
</span><span id="7100" class="l"><a href="#7100"> 7100: </a>            }
</span><span id="7101" class="l"><a href="#7101"> 7101: </a>            <span class="php-var">$mqr</span> = <span class="php-var">$this</span>-&gt;get_mqr();
</span><span id="7102" class="l"><a href="#7102"> 7102: </a>            <span class="php-var">$this</span>-&gt;set_mqr(<span class="php-keyword1">false</span>);
</span><span id="7103" class="l"><a href="#7103"> 7103: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;FontFiles <span class="php-keyword1">as</span> <span class="php-var">$file</span> =&gt; <span class="php-var">$info</span>) {
</span><span id="7104" class="l"><a href="#7104"> 7104: </a>                <span class="php-comment">// search and get font file to embedd</span>
</span><span id="7105" class="l"><a href="#7105"> 7105: </a>                <span class="php-var">$fontdir</span> = <span class="php-var">$info</span>[<span class="php-quote">'fontdir'</span>];
</span><span id="7106" class="l"><a href="#7106"> 7106: </a>                <span class="php-var">$file</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$file</span>);
</span><span id="7107" class="l"><a href="#7107"> 7107: </a>                <span class="php-var">$fontfile</span> = <span class="php-quote">''</span>;
</span><span id="7108" class="l"><a href="#7108"> 7108: </a>                <span class="php-comment">// search files on various directories</span>
</span><span id="7109" class="l"><a href="#7109"> 7109: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$fontdir</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$fontdir</span>.<span class="php-var">$file</span>)) {
</span><span id="7110" class="l"><a href="#7110"> 7110: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$fontdir</span>.<span class="php-var">$file</span>;
</span><span id="7111" class="l"><a href="#7111"> 7111: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$file</span>)) {
</span><span id="7112" class="l"><a href="#7112"> 7112: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$file</span>;
</span><span id="7113" class="l"><a href="#7113"> 7113: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$file</span>)) {
</span><span id="7114" class="l"><a href="#7114"> 7114: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$file</span>;
</span><span id="7115" class="l"><a href="#7115"> 7115: </a>                }
</span><span id="7116" class="l"><a href="#7116"> 7116: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fontfile</span>)) {
</span><span id="7117" class="l"><a href="#7117"> 7117: </a>                    <span class="php-var">$font</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$fontfile</span>);
</span><span id="7118" class="l"><a href="#7118"> 7118: </a>                    <span class="php-var">$compressed</span> = (<span class="php-keyword2">substr</span>(<span class="php-var">$file</span>, -<span class="php-num">2</span>) == <span class="php-quote">'.z'</span>);
</span><span id="7119" class="l"><a href="#7119"> 7119: </a>                    <span class="php-keyword1">if</span> ((!<span class="php-var">$compressed</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$info</span>[<span class="php-quote">'length2'</span>]))) {
</span><span id="7120" class="l"><a href="#7120"> 7120: </a>                        <span class="php-var">$header</span> = (<span class="php-keyword2">ord</span>(<span class="php-var">$font</span>{<span class="php-num">0</span>}) == <span class="php-num">128</span>);
</span><span id="7121" class="l"><a href="#7121"> 7121: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$header</span>) {
</span><span id="7122" class="l"><a href="#7122"> 7122: </a>                            <span class="php-comment">//Strip first binary header</span>
</span><span id="7123" class="l"><a href="#7123"> 7123: </a>                            <span class="php-var">$font</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$font</span>, <span class="php-num">6</span>);
</span><span id="7124" class="l"><a href="#7124"> 7124: </a>                        }
</span><span id="7125" class="l"><a href="#7125"> 7125: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$header</span> <span class="php-keyword1">AND</span> (<span class="php-keyword2">ord</span>(<span class="php-var">$font</span>{<span class="php-var">$info</span>[<span class="php-quote">'length1'</span>]}) == <span class="php-num">128</span>)) {
</span><span id="7126" class="l"><a href="#7126"> 7126: </a>                            <span class="php-comment">//Strip second binary header</span>
</span><span id="7127" class="l"><a href="#7127"> 7127: </a>                            <span class="php-var">$font</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$font</span>, <span class="php-num">0</span>, <span class="php-var">$info</span>[<span class="php-quote">'length1'</span>]).<span class="php-keyword2">substr</span>(<span class="php-var">$font</span>, (<span class="php-var">$info</span>[<span class="php-quote">'length1'</span>] + <span class="php-num">6</span>));
</span><span id="7128" class="l"><a href="#7128"> 7128: </a>                        }
</span><span id="7129" class="l"><a href="#7129"> 7129: </a>                    }
</span><span id="7130" class="l"><a href="#7130"> 7130: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7131" class="l"><a href="#7131"> 7131: </a>                    <span class="php-var">$this</span>-&gt;FontFiles[<span class="php-var">$file</span>][<span class="php-quote">'n'</span>] = <span class="php-var">$this</span>-&gt;n;
</span><span id="7132" class="l"><a href="#7132"> 7132: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$font</span>);
</span><span id="7133" class="l"><a href="#7133"> 7133: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$compressed</span>) {
</span><span id="7134" class="l"><a href="#7134"> 7134: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Filter /FlateDecode'</span>;
</span><span id="7135" class="l"><a href="#7135"> 7135: </a>                    }
</span><span id="7136" class="l"><a href="#7136"> 7136: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Length1 '</span>.<span class="php-var">$info</span>[<span class="php-quote">'length1'</span>];
</span><span id="7137" class="l"><a href="#7137"> 7137: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$info</span>[<span class="php-quote">'length2'</span>])) {
</span><span id="7138" class="l"><a href="#7138"> 7138: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Length2 '</span>.<span class="php-var">$info</span>[<span class="php-quote">'length2'</span>].<span class="php-quote">' /Length3 0'</span>;
</span><span id="7139" class="l"><a href="#7139"> 7139: </a>                    }
</span><span id="7140" class="l"><a href="#7140"> 7140: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7141" class="l"><a href="#7141"> 7141: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$font</span>);
</span><span id="7142" class="l"><a href="#7142"> 7142: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="7143" class="l"><a href="#7143"> 7143: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7144" class="l"><a href="#7144"> 7144: </a>                }
</span><span id="7145" class="l"><a href="#7145"> 7145: </a>            }
</span><span id="7146" class="l"><a href="#7146"> 7146: </a>            <span class="php-var">$this</span>-&gt;set_mqr(<span class="php-var">$mqr</span>);
</span><span id="7147" class="l"><a href="#7147"> 7147: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;fontkeys <span class="php-keyword1">as</span> <span class="php-var">$k</span>) {
</span><span id="7148" class="l"><a href="#7148"> 7148: </a>                <span class="php-comment">//Font objects</span>
</span><span id="7149" class="l"><a href="#7149"> 7149: </a>                <span class="php-var">$this</span>-&gt;setFontSubBuffer(<span class="php-var">$k</span>, <span class="php-quote">'n'</span>, <span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>);
</span><span id="7150" class="l"><a href="#7150"> 7150: </a>                <span class="php-var">$font</span> = <span class="php-var">$this</span>-&gt;getFontBuffer(<span class="php-var">$k</span>);
</span><span id="7151" class="l"><a href="#7151"> 7151: </a>                <span class="php-var">$type</span> = <span class="php-var">$font</span>[<span class="php-quote">'type'</span>];
</span><span id="7152" class="l"><a href="#7152"> 7152: </a>                <span class="php-var">$name</span> = <span class="php-var">$font</span>[<span class="php-quote">'name'</span>];
</span><span id="7153" class="l"><a href="#7153"> 7153: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$type</span> == <span class="php-quote">'core'</span>) {
</span><span id="7154" class="l"><a href="#7154"> 7154: </a>                    <span class="php-comment">//Standard font</span>
</span><span id="7155" class="l"><a href="#7155"> 7155: </a>                    <span class="php-var">$obj_id</span> = <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7156" class="l"><a href="#7156"> 7156: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /Font'</span>;
</span><span id="7157" class="l"><a href="#7157"> 7157: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /Type1'</span>;
</span><span id="7158" class="l"><a href="#7158"> 7158: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /BaseFont /'</span>.<span class="php-var">$name</span>;
</span><span id="7159" class="l"><a href="#7159"> 7159: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Name /F'</span>.<span class="php-var">$font</span>[<span class="php-quote">'i'</span>];
</span><span id="7160" class="l"><a href="#7160"> 7160: </a>                    <span class="php-keyword1">if</span> ((<span class="php-keyword2">strtolower</span>(<span class="php-var">$name</span>) != <span class="php-quote">'symbol'</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">strtolower</span>(<span class="php-var">$name</span>) != <span class="php-quote">'zapfdingbats'</span>)) {
</span><span id="7161" class="l"><a href="#7161"> 7161: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Encoding /WinAnsiEncoding'</span>;
</span><span id="7162" class="l"><a href="#7162"> 7162: </a>                    }
</span><span id="7163" class="l"><a href="#7163"> 7163: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">strtolower</span>(<span class="php-var">$name</span>) == <span class="php-quote">'helvetica'</span>) {
</span><span id="7164" class="l"><a href="#7164"> 7164: </a>                        <span class="php-comment">// add default font for annotations</span>
</span><span id="7165" class="l"><a href="#7165"> 7165: </a>                        <span class="php-var">$this</span>-&gt;annotation_fonts[<span class="php-quote">'helvetica'</span>] = <span class="php-var">$k</span>;
</span><span id="7166" class="l"><a href="#7166"> 7166: </a>                    }
</span><span id="7167" class="l"><a href="#7167"> 7167: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7168" class="l"><a href="#7168"> 7168: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7169" class="l"><a href="#7169"> 7169: </a>                } <span class="php-keyword1">elseif</span> ((<span class="php-var">$type</span> == <span class="php-quote">'Type1'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$type</span> == <span class="php-quote">'TrueType'</span>)) {
</span><span id="7170" class="l"><a href="#7170"> 7170: </a>                    <span class="php-comment">//Additional Type1 or TrueType font</span>
</span><span id="7171" class="l"><a href="#7171"> 7171: </a>                    <span class="php-var">$obj_id</span> = <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7172" class="l"><a href="#7172"> 7172: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /Font'</span>;
</span><span id="7173" class="l"><a href="#7173"> 7173: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /'</span>.<span class="php-var">$type</span>;
</span><span id="7174" class="l"><a href="#7174"> 7174: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /BaseFont /'</span>.<span class="php-var">$name</span>;
</span><span id="7175" class="l"><a href="#7175"> 7175: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Name /F'</span>.<span class="php-var">$font</span>[<span class="php-quote">'i'</span>];
</span><span id="7176" class="l"><a href="#7176"> 7176: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /FirstChar 32 /LastChar 255'</span>;
</span><span id="7177" class="l"><a href="#7177"> 7177: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Widths '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="7178" class="l"><a href="#7178"> 7178: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /FontDescriptor '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">2</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="7179" class="l"><a href="#7179"> 7179: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$font</span>[<span class="php-quote">'enc'</span>]) {
</span><span id="7180" class="l"><a href="#7180"> 7180: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$font</span>[<span class="php-quote">'diff'</span>])) {
</span><span id="7181" class="l"><a href="#7181"> 7181: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' /Encoding '</span>.(<span class="php-var">$nf</span> + <span class="php-var">$font</span>[<span class="php-quote">'diff'</span>]).<span class="php-quote">' 0 R'</span>;
</span><span id="7182" class="l"><a href="#7182"> 7182: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="7183" class="l"><a href="#7183"> 7183: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' /Encoding /WinAnsiEncoding'</span>;
</span><span id="7184" class="l"><a href="#7184"> 7184: </a>                        }
</span><span id="7185" class="l"><a href="#7185"> 7185: </a>                    }
</span><span id="7186" class="l"><a href="#7186"> 7186: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7187" class="l"><a href="#7187"> 7187: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7188" class="l"><a href="#7188"> 7188: </a>                    <span class="php-comment">// Widths</span>
</span><span id="7189" class="l"><a href="#7189"> 7189: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7190" class="l"><a href="#7190"> 7190: </a>                    <span class="php-var">$cw</span> = &amp;<span class="php-var">$font</span>[<span class="php-quote">'cw'</span>];
</span><span id="7191" class="l"><a href="#7191"> 7191: </a>                    <span class="php-var">$s</span> = <span class="php-quote">'['</span>;
</span><span id="7192" class="l"><a href="#7192"> 7192: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">32</span>; <span class="php-var">$i</span> &lt; <span class="php-num">256</span>; ++<span class="php-var">$i</span>) {
</span><span id="7193" class="l"><a href="#7193"> 7193: </a>                        <span class="php-var">$s</span> .= <span class="php-var">$cw</span>[<span class="php-var">$i</span>].<span class="php-quote">' '</span>;
</span><span id="7194" class="l"><a href="#7194"> 7194: </a>                    }
</span><span id="7195" class="l"><a href="#7195"> 7195: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$s</span>.<span class="php-quote">'] endobj'</span>);
</span><span id="7196" class="l"><a href="#7196"> 7196: </a>                    <span class="php-comment">//Descriptor</span>
</span><span id="7197" class="l"><a href="#7197"> 7197: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7198" class="l"><a href="#7198"> 7198: </a>                    <span class="php-var">$s</span> = <span class="php-quote">'&lt;&lt;/Type /FontDescriptor /FontName /'</span>.<span class="php-var">$name</span>;
</span><span id="7199" class="l"><a href="#7199"> 7199: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$font</span>[<span class="php-quote">'desc'</span>] <span class="php-keyword1">as</span> <span class="php-var">$fdk</span> =&gt; <span class="php-var">$fdv</span>) {
</span><span id="7200" class="l"><a href="#7200"> 7200: </a>                        <span class="php-keyword1">if</span>(<span class="php-keyword2">is_float</span>(<span class="php-var">$fdv</span>)) {
</span><span id="7201" class="l"><a href="#7201"> 7201: </a>                            <span class="php-var">$fdv</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F'</span>, <span class="php-var">$fdv</span>);
</span><span id="7202" class="l"><a href="#7202"> 7202: </a>                        }
</span><span id="7203" class="l"><a href="#7203"> 7203: </a>                        <span class="php-var">$s</span> .= <span class="php-quote">' /'</span>.<span class="php-var">$fdk</span>.<span class="php-quote">' '</span>.<span class="php-var">$fdv</span>.<span class="php-quote">''</span>;
</span><span id="7204" class="l"><a href="#7204"> 7204: </a>                    }
</span><span id="7205" class="l"><a href="#7205"> 7205: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$font</span>[<span class="php-quote">'file'</span>])) {
</span><span id="7206" class="l"><a href="#7206"> 7206: </a>                        <span class="php-var">$s</span> .= <span class="php-quote">' /FontFile'</span>.(<span class="php-var">$type</span> == <span class="php-quote">'Type1'</span> ? <span class="php-quote">''</span> : <span class="php-quote">'2'</span>).<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;FontFiles[<span class="php-var">$font</span>[<span class="php-quote">'file'</span>]][<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7207" class="l"><a href="#7207"> 7207: </a>                    }
</span><span id="7208" class="l"><a href="#7208"> 7208: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$s</span>.<span class="php-quote">'&gt;&gt; endobj'</span>);
</span><span id="7209" class="l"><a href="#7209"> 7209: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7210" class="l"><a href="#7210"> 7210: </a>                    <span class="php-comment">//Allow for additional types</span>
</span><span id="7211" class="l"><a href="#7211"> 7211: </a>                    <span class="php-var">$mtd</span> = <span class="php-quote">'_put'</span>.<span class="php-keyword2">strtolower</span>(<span class="php-var">$type</span>);
</span><span id="7212" class="l"><a href="#7212"> 7212: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword2">method_exists</span>(<span class="php-var">$this</span>, <span class="php-var">$mtd</span>)) {
</span><span id="7213" class="l"><a href="#7213"> 7213: </a>                        <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Unsupported font type: '</span>.<span class="php-var">$type</span>);
</span><span id="7214" class="l"><a href="#7214"> 7214: </a>                    }
</span><span id="7215" class="l"><a href="#7215"> 7215: </a>                    <span class="php-var">$obj_id</span> = <span class="php-var">$this</span>-&gt;<span class="php-var">$mtd</span>(<span class="php-var">$font</span>);
</span><span id="7216" class="l"><a href="#7216"> 7216: </a>                }
</span><span id="7217" class="l"><a href="#7217"> 7217: </a>                <span class="php-comment">// store object ID for current font</span>
</span><span id="7218" class="l"><a href="#7218"> 7218: </a>                <span class="php-var">$this</span>-&gt;font_obj_ids[<span class="php-var">$k</span>] = <span class="php-var">$obj_id</span>;
</span><span id="7219" class="l"><a href="#7219"> 7219: </a>            }
</span><span id="7220" class="l"><a href="#7220"> 7220: </a>        }
</span><span id="7221" class="l"><a href="#7221"> 7221: </a>
</span><span id="7222" class="l"><a href="#7222"> 7222: </a>        <span class="php-comment">/**
</span></span><span id="7223" class="l"><a href="#7223"> 7223: </a><span class="php-comment">         * Outputs font widths
</span></span><span id="7224" class="l"><a href="#7224"> 7224: </a><span class="php-comment">         * @parameter array $font font data
</span></span><span id="7225" class="l"><a href="#7225"> 7225: </a><span class="php-comment">         * @parameter int $cidoffset offset for CID values
</span></span><span id="7226" class="l"><a href="#7226"> 7226: </a><span class="php-comment">         * @return PDF command string for font widths
</span></span><span id="7227" class="l"><a href="#7227"> 7227: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="7228" class="l"><a href="#7228"> 7228: </a><span class="php-comment">         * @access protected
</span></span><span id="7229" class="l"><a href="#7229"> 7229: </a><span class="php-comment">         * @since 4.4.000 (2008-12-07)
</span></span><span id="7230" class="l"><a href="#7230"> 7230: </a><span class="php-comment">         */</span>
</span><span id="7231" class="l"><a href="#7231"> 7231: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putfontwidths(<span class="php-var">$font</span>, <span class="php-var">$cidoffset</span>=<span class="php-num">0</span>) {
</span><span id="7232" class="l"><a href="#7232"> 7232: </a>            <span class="php-keyword2">ksort</span>(<span class="php-var">$font</span>[<span class="php-quote">'cw'</span>]);
</span><span id="7233" class="l"><a href="#7233"> 7233: </a>            <span class="php-var">$rangeid</span> = <span class="php-num">0</span>;
</span><span id="7234" class="l"><a href="#7234"> 7234: </a>            <span class="php-var">$range</span> = <span class="php-keyword1">array</span>();
</span><span id="7235" class="l"><a href="#7235"> 7235: </a>            <span class="php-var">$prevcid</span> = -<span class="php-num">2</span>;
</span><span id="7236" class="l"><a href="#7236"> 7236: </a>            <span class="php-var">$prevwidth</span> = -<span class="php-num">1</span>;
</span><span id="7237" class="l"><a href="#7237"> 7237: </a>            <span class="php-var">$interval</span> = <span class="php-keyword1">false</span>;
</span><span id="7238" class="l"><a href="#7238"> 7238: </a>            <span class="php-comment">// for each character</span>
</span><span id="7239" class="l"><a href="#7239"> 7239: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$font</span>[<span class="php-quote">'cw'</span>] <span class="php-keyword1">as</span> <span class="php-var">$cid</span> =&gt; <span class="php-var">$width</span>) {
</span><span id="7240" class="l"><a href="#7240"> 7240: </a>                <span class="php-var">$cid</span> -= <span class="php-var">$cidoffset</span>;
</span><span id="7241" class="l"><a href="#7241"> 7241: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$width</span> != <span class="php-var">$font</span>[<span class="php-quote">'dw'</span>]) {
</span><span id="7242" class="l"><a href="#7242"> 7242: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$cid</span> == (<span class="php-var">$prevcid</span> + <span class="php-num">1</span>)) {
</span><span id="7243" class="l"><a href="#7243"> 7243: </a>                        <span class="php-comment">// consecutive CID</span>
</span><span id="7244" class="l"><a href="#7244"> 7244: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$width</span> == <span class="php-var">$prevwidth</span>) {
</span><span id="7245" class="l"><a href="#7245"> 7245: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$width</span> == <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][<span class="php-num">0</span>]) {
</span><span id="7246" class="l"><a href="#7246"> 7246: </a>                                <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][] = <span class="php-var">$width</span>;
</span><span id="7247" class="l"><a href="#7247"> 7247: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="7248" class="l"><a href="#7248"> 7248: </a>                                <span class="php-keyword2">array_pop</span>(<span class="php-var">$range</span>[<span class="php-var">$rangeid</span>]);
</span><span id="7249" class="l"><a href="#7249"> 7249: </a>                                <span class="php-comment">// new range</span>
</span><span id="7250" class="l"><a href="#7250"> 7250: </a>                                <span class="php-var">$rangeid</span> = <span class="php-var">$prevcid</span>;
</span><span id="7251" class="l"><a href="#7251"> 7251: </a>                                <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>] = <span class="php-keyword1">array</span>();
</span><span id="7252" class="l"><a href="#7252"> 7252: </a>                                <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][] = <span class="php-var">$prevwidth</span>;
</span><span id="7253" class="l"><a href="#7253"> 7253: </a>                                <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][] = <span class="php-var">$width</span>;
</span><span id="7254" class="l"><a href="#7254"> 7254: </a>                            }
</span><span id="7255" class="l"><a href="#7255"> 7255: </a>                            <span class="php-var">$interval</span> = <span class="php-keyword1">true</span>;
</span><span id="7256" class="l"><a href="#7256"> 7256: </a>                            <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][<span class="php-quote">'interval'</span>] = <span class="php-keyword1">true</span>;
</span><span id="7257" class="l"><a href="#7257"> 7257: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="7258" class="l"><a href="#7258"> 7258: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$interval</span>) {
</span><span id="7259" class="l"><a href="#7259"> 7259: </a>                                <span class="php-comment">// new range</span>
</span><span id="7260" class="l"><a href="#7260"> 7260: </a>                                <span class="php-var">$rangeid</span> = <span class="php-var">$cid</span>;
</span><span id="7261" class="l"><a href="#7261"> 7261: </a>                                <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>] = <span class="php-keyword1">array</span>();
</span><span id="7262" class="l"><a href="#7262"> 7262: </a>                                <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][] = <span class="php-var">$width</span>;
</span><span id="7263" class="l"><a href="#7263"> 7263: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="7264" class="l"><a href="#7264"> 7264: </a>                                <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][] = <span class="php-var">$width</span>;
</span><span id="7265" class="l"><a href="#7265"> 7265: </a>                            }
</span><span id="7266" class="l"><a href="#7266"> 7266: </a>                            <span class="php-var">$interval</span> = <span class="php-keyword1">false</span>;
</span><span id="7267" class="l"><a href="#7267"> 7267: </a>                        }
</span><span id="7268" class="l"><a href="#7268"> 7268: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="7269" class="l"><a href="#7269"> 7269: </a>                        <span class="php-comment">// new range</span>
</span><span id="7270" class="l"><a href="#7270"> 7270: </a>                        <span class="php-var">$rangeid</span> = <span class="php-var">$cid</span>;
</span><span id="7271" class="l"><a href="#7271"> 7271: </a>                        <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>] = <span class="php-keyword1">array</span>();
</span><span id="7272" class="l"><a href="#7272"> 7272: </a>                        <span class="php-var">$range</span>[<span class="php-var">$rangeid</span>][] = <span class="php-var">$width</span>;
</span><span id="7273" class="l"><a href="#7273"> 7273: </a>                        <span class="php-var">$interval</span> = <span class="php-keyword1">false</span>;
</span><span id="7274" class="l"><a href="#7274"> 7274: </a>                    }
</span><span id="7275" class="l"><a href="#7275"> 7275: </a>                    <span class="php-var">$prevcid</span> = <span class="php-var">$cid</span>;
</span><span id="7276" class="l"><a href="#7276"> 7276: </a>                    <span class="php-var">$prevwidth</span> = <span class="php-var">$width</span>;
</span><span id="7277" class="l"><a href="#7277"> 7277: </a>                }
</span><span id="7278" class="l"><a href="#7278"> 7278: </a>            }
</span><span id="7279" class="l"><a href="#7279"> 7279: </a>            <span class="php-comment">// optimize ranges</span>
</span><span id="7280" class="l"><a href="#7280"> 7280: </a>            <span class="php-var">$prevk</span> = -<span class="php-num">1</span>;
</span><span id="7281" class="l"><a href="#7281"> 7281: </a>            <span class="php-var">$nextk</span> = -<span class="php-num">1</span>;
</span><span id="7282" class="l"><a href="#7282"> 7282: </a>            <span class="php-var">$prevint</span> = <span class="php-keyword1">false</span>;
</span><span id="7283" class="l"><a href="#7283"> 7283: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$range</span> <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$ws</span>) {
</span><span id="7284" class="l"><a href="#7284"> 7284: </a>                <span class="php-var">$cws</span> = <span class="php-keyword2">count</span>(<span class="php-var">$ws</span>);
</span><span id="7285" class="l"><a href="#7285"> 7285: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$k</span> == <span class="php-var">$nextk</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$prevint</span>) <span class="php-keyword1">AND</span> ((!<span class="php-keyword1">isset</span>(<span class="php-var">$ws</span>[<span class="php-quote">'interval'</span>])) <span class="php-keyword1">OR</span> (<span class="php-var">$cws</span> &lt; <span class="php-num">4</span>))) {
</span><span id="7286" class="l"><a href="#7286"> 7286: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$range</span>[<span class="php-var">$k</span>][<span class="php-quote">'interval'</span>])) {
</span><span id="7287" class="l"><a href="#7287"> 7287: </a>                        <span class="php-keyword1">unset</span>(<span class="php-var">$range</span>[<span class="php-var">$k</span>][<span class="php-quote">'interval'</span>]);
</span><span id="7288" class="l"><a href="#7288"> 7288: </a>                    }
</span><span id="7289" class="l"><a href="#7289"> 7289: </a>                    <span class="php-var">$range</span>[<span class="php-var">$prevk</span>] = <span class="php-keyword2">array_merge</span>(<span class="php-var">$range</span>[<span class="php-var">$prevk</span>], <span class="php-var">$range</span>[<span class="php-var">$k</span>]);
</span><span id="7290" class="l"><a href="#7290"> 7290: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$range</span>[<span class="php-var">$k</span>]);
</span><span id="7291" class="l"><a href="#7291"> 7291: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7292" class="l"><a href="#7292"> 7292: </a>                    <span class="php-var">$prevk</span> = <span class="php-var">$k</span>;
</span><span id="7293" class="l"><a href="#7293"> 7293: </a>                }
</span><span id="7294" class="l"><a href="#7294"> 7294: </a>                <span class="php-var">$nextk</span> = <span class="php-var">$k</span> + <span class="php-var">$cws</span>;
</span><span id="7295" class="l"><a href="#7295"> 7295: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$ws</span>[<span class="php-quote">'interval'</span>])) {
</span><span id="7296" class="l"><a href="#7296"> 7296: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$cws</span> &gt; <span class="php-num">3</span>) {
</span><span id="7297" class="l"><a href="#7297"> 7297: </a>                        <span class="php-var">$prevint</span> = <span class="php-keyword1">true</span>;
</span><span id="7298" class="l"><a href="#7298"> 7298: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="7299" class="l"><a href="#7299"> 7299: </a>                        <span class="php-var">$prevint</span> = <span class="php-keyword1">false</span>;
</span><span id="7300" class="l"><a href="#7300"> 7300: </a>                    }
</span><span id="7301" class="l"><a href="#7301"> 7301: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$range</span>[<span class="php-var">$k</span>][<span class="php-quote">'interval'</span>]);
</span><span id="7302" class="l"><a href="#7302"> 7302: </a>                    --<span class="php-var">$nextk</span>;
</span><span id="7303" class="l"><a href="#7303"> 7303: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7304" class="l"><a href="#7304"> 7304: </a>                    <span class="php-var">$prevint</span> = <span class="php-keyword1">false</span>;
</span><span id="7305" class="l"><a href="#7305"> 7305: </a>                }
</span><span id="7306" class="l"><a href="#7306"> 7306: </a>            }
</span><span id="7307" class="l"><a href="#7307"> 7307: </a>            <span class="php-comment">// output data</span>
</span><span id="7308" class="l"><a href="#7308"> 7308: </a>            <span class="php-var">$w</span> = <span class="php-quote">''</span>;
</span><span id="7309" class="l"><a href="#7309"> 7309: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$range</span> <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$ws</span>) {
</span><span id="7310" class="l"><a href="#7310"> 7310: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-keyword2">array_count_values</span>(<span class="php-var">$ws</span>)) == <span class="php-num">1</span>) {
</span><span id="7311" class="l"><a href="#7311"> 7311: </a>                    <span class="php-comment">// interval mode is more compact</span>
</span><span id="7312" class="l"><a href="#7312"> 7312: </a>                    <span class="php-var">$w</span> .= <span class="php-quote">' '</span>.<span class="php-var">$k</span>.<span class="php-quote">' '</span>.(<span class="php-var">$k</span> + <span class="php-keyword2">count</span>(<span class="php-var">$ws</span>) - <span class="php-num">1</span>).<span class="php-quote">' '</span>.<span class="php-var">$ws</span>[<span class="php-num">0</span>];
</span><span id="7313" class="l"><a href="#7313"> 7313: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7314" class="l"><a href="#7314"> 7314: </a>                    <span class="php-comment">// range mode</span>
</span><span id="7315" class="l"><a href="#7315"> 7315: </a>                    <span class="php-var">$w</span> .= <span class="php-quote">' '</span>.<span class="php-var">$k</span>.<span class="php-quote">' [ '</span>.<span class="php-keyword2">implode</span>(<span class="php-quote">' '</span>, <span class="php-var">$ws</span>).<span class="php-quote">' ]'</span>;
</span><span id="7316" class="l"><a href="#7316"> 7316: </a>                }
</span><span id="7317" class="l"><a href="#7317"> 7317: </a>            }
</span><span id="7318" class="l"><a href="#7318"> 7318: </a>            <span class="php-keyword1">return</span> <span class="php-quote">'/W ['</span>.<span class="php-var">$w</span>.<span class="php-quote">' ]'</span>;
</span><span id="7319" class="l"><a href="#7319"> 7319: </a>        }
</span><span id="7320" class="l"><a href="#7320"> 7320: </a>
</span><span id="7321" class="l"><a href="#7321"> 7321: </a>        <span class="php-comment">/**
</span></span><span id="7322" class="l"><a href="#7322"> 7322: </a><span class="php-comment">         * Adds unicode fonts.&lt;br&gt;
</span></span><span id="7323" class="l"><a href="#7323"> 7323: </a><span class="php-comment">         * Based on PDF Reference 1.3 (section 5)
</span></span><span id="7324" class="l"><a href="#7324"> 7324: </a><span class="php-comment">         * @parameter array $font font data
</span></span><span id="7325" class="l"><a href="#7325"> 7325: </a><span class="php-comment">         * @return int font object ID
</span></span><span id="7326" class="l"><a href="#7326"> 7326: </a><span class="php-comment">         * @access protected
</span></span><span id="7327" class="l"><a href="#7327"> 7327: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="7328" class="l"><a href="#7328"> 7328: </a><span class="php-comment">         * @since 1.52.0.TC005 (2005-01-05)
</span></span><span id="7329" class="l"><a href="#7329"> 7329: </a><span class="php-comment">         */</span>
</span><span id="7330" class="l"><a href="#7330"> 7330: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _puttruetypeunicode(<span class="php-var">$font</span>) {
</span><span id="7331" class="l"><a href="#7331"> 7331: </a>            <span class="php-comment">// Type0 Font</span>
</span><span id="7332" class="l"><a href="#7332"> 7332: </a>            <span class="php-comment">// A composite font composed of other fonts, organized hierarchically</span>
</span><span id="7333" class="l"><a href="#7333"> 7333: </a>            <span class="php-var">$obj_id</span> = <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7334" class="l"><a href="#7334"> 7334: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /Font'</span>;
</span><span id="7335" class="l"><a href="#7335"> 7335: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /Type0'</span>;
</span><span id="7336" class="l"><a href="#7336"> 7336: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /BaseFont /'</span>.<span class="php-var">$font</span>[<span class="php-quote">'name'</span>].<span class="php-quote">''</span>;
</span><span id="7337" class="l"><a href="#7337"> 7337: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Name /F'</span>.<span class="php-var">$font</span>[<span class="php-quote">'i'</span>];
</span><span id="7338" class="l"><a href="#7338"> 7338: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Encoding /'</span>.<span class="php-var">$font</span>[<span class="php-quote">'enc'</span>];
</span><span id="7339" class="l"><a href="#7339"> 7339: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /ToUnicode /Identity-H'</span>;
</span><span id="7340" class="l"><a href="#7340"> 7340: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /DescendantFonts ['</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R]'</span>;
</span><span id="7341" class="l"><a href="#7341"> 7341: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7342" class="l"><a href="#7342"> 7342: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="7343" class="l"><a href="#7343"> 7343: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7344" class="l"><a href="#7344"> 7344: </a>            <span class="php-comment">// CIDFontType2</span>
</span><span id="7345" class="l"><a href="#7345"> 7345: </a>            <span class="php-comment">// A CIDFont whose glyph descriptions are based on TrueType font technology</span>
</span><span id="7346" class="l"><a href="#7346"> 7346: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7347" class="l"><a href="#7347"> 7347: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /Font'</span>;
</span><span id="7348" class="l"><a href="#7348"> 7348: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /CIDFontType2'</span>;
</span><span id="7349" class="l"><a href="#7349"> 7349: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /BaseFont /'</span>.<span class="php-var">$font</span>[<span class="php-quote">'name'</span>];
</span><span id="7350" class="l"><a href="#7350"> 7350: </a>            <span class="php-comment">// A dictionary containing entries that define the character collection of the CIDFont.</span>
</span><span id="7351" class="l"><a href="#7351"> 7351: </a>            <span class="php-var">$cidinfo</span> = <span class="php-quote">'/Registry '</span>.<span class="php-var">$this</span>-&gt;_datastring(<span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'Registry'</span>]);
</span><span id="7352" class="l"><a href="#7352"> 7352: </a>            <span class="php-var">$cidinfo</span> .= <span class="php-quote">' /Ordering '</span>.<span class="php-var">$this</span>-&gt;_datastring(<span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'Ordering'</span>]);
</span><span id="7353" class="l"><a href="#7353"> 7353: </a>            <span class="php-var">$cidinfo</span> .= <span class="php-quote">' /Supplement '</span>.<span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'Supplement'</span>];
</span><span id="7354" class="l"><a href="#7354"> 7354: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /CIDSystemInfo &lt;&lt;'</span>.<span class="php-var">$cidinfo</span>.<span class="php-quote">'&gt;&gt;'</span>;
</span><span id="7355" class="l"><a href="#7355"> 7355: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /FontDescriptor '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="7356" class="l"><a href="#7356"> 7356: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /DW '</span>.<span class="php-var">$font</span>[<span class="php-quote">'dw'</span>]; <span class="php-comment">// default width</span>
</span><span id="7357" class="l"><a href="#7357"> 7357: </a>            <span class="php-var">$out</span> .= <span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$this</span>-&gt;_putfontwidths(<span class="php-var">$font</span>, <span class="php-num">0</span>);
</span><span id="7358" class="l"><a href="#7358"> 7358: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /CIDToGIDMap '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">2</span>).<span class="php-quote">' 0 R &gt;&gt; endobj'</span>;
</span><span id="7359" class="l"><a href="#7359"> 7359: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7360" class="l"><a href="#7360"> 7360: </a>            <span class="php-comment">// Font descriptor</span>
</span><span id="7361" class="l"><a href="#7361"> 7361: </a>            <span class="php-comment">// A font descriptor describing the CIDFont default metrics other than its glyph widths</span>
</span><span id="7362" class="l"><a href="#7362"> 7362: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7363" class="l"><a href="#7363"> 7363: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /FontDescriptor'</span>;
</span><span id="7364" class="l"><a href="#7364"> 7364: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /FontName /'</span>.<span class="php-var">$font</span>[<span class="php-quote">'name'</span>];
</span><span id="7365" class="l"><a href="#7365"> 7365: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$font</span>[<span class="php-quote">'desc'</span>] <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>) {
</span><span id="7366" class="l"><a href="#7366"> 7366: </a>                <span class="php-keyword1">if</span>(<span class="php-keyword2">is_float</span>(<span class="php-var">$value</span>)) {
</span><span id="7367" class="l"><a href="#7367"> 7367: </a>                    <span class="php-var">$value</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F'</span>, <span class="php-var">$value</span>);
</span><span id="7368" class="l"><a href="#7368"> 7368: </a>                }
</span><span id="7369" class="l"><a href="#7369"> 7369: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /'</span>.<span class="php-var">$key</span>.<span class="php-quote">' '</span>.<span class="php-var">$value</span>;
</span><span id="7370" class="l"><a href="#7370"> 7370: </a>            }
</span><span id="7371" class="l"><a href="#7371"> 7371: </a>            <span class="php-var">$fontdir</span> = <span class="php-keyword1">false</span>;
</span><span id="7372" class="l"><a href="#7372"> 7372: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$font</span>[<span class="php-quote">'file'</span>])) {
</span><span id="7373" class="l"><a href="#7373"> 7373: </a>                <span class="php-comment">// A stream containing a TrueType font</span>
</span><span id="7374" class="l"><a href="#7374"> 7374: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /FontFile2 '</span>.<span class="php-var">$this</span>-&gt;FontFiles[<span class="php-var">$font</span>[<span class="php-quote">'file'</span>]][<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7375" class="l"><a href="#7375"> 7375: </a>                <span class="php-var">$fontdir</span> = <span class="php-var">$this</span>-&gt;FontFiles[<span class="php-var">$font</span>[<span class="php-quote">'file'</span>]][<span class="php-quote">'fontdir'</span>];
</span><span id="7376" class="l"><a href="#7376"> 7376: </a>            }
</span><span id="7377" class="l"><a href="#7377"> 7377: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7378" class="l"><a href="#7378"> 7378: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7379" class="l"><a href="#7379"> 7379: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$font</span>[<span class="php-quote">'ctg'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$font</span>[<span class="php-quote">'ctg'</span>]))) {
</span><span id="7380" class="l"><a href="#7380"> 7380: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7381" class="l"><a href="#7381"> 7381: </a>                <span class="php-comment">// Embed CIDToGIDMap</span>
</span><span id="7382" class="l"><a href="#7382"> 7382: </a>                <span class="php-comment">// A specification of the mapping from CIDs to glyph indices</span>
</span><span id="7383" class="l"><a href="#7383"> 7383: </a>                <span class="php-comment">// search and get CTG font file to embedd</span>
</span><span id="7384" class="l"><a href="#7384"> 7384: </a>                <span class="php-var">$ctgfile</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$font</span>[<span class="php-quote">'ctg'</span>]);
</span><span id="7385" class="l"><a href="#7385"> 7385: </a>                <span class="php-comment">// search and get ctg font file to embedd</span>
</span><span id="7386" class="l"><a href="#7386"> 7386: </a>                <span class="php-var">$fontfile</span> = <span class="php-quote">''</span>;
</span><span id="7387" class="l"><a href="#7387"> 7387: </a>                <span class="php-comment">// search files on various directories</span>
</span><span id="7388" class="l"><a href="#7388"> 7388: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$fontdir</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">file_exists</span>(<span class="php-var">$fontdir</span>.<span class="php-var">$ctgfile</span>)) {
</span><span id="7389" class="l"><a href="#7389"> 7389: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$fontdir</span>.<span class="php-var">$ctgfile</span>;
</span><span id="7390" class="l"><a href="#7390"> 7390: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$ctgfile</span>)) {
</span><span id="7391" class="l"><a href="#7391"> 7391: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$this</span>-&gt;_getfontpath().<span class="php-var">$ctgfile</span>;
</span><span id="7392" class="l"><a href="#7392"> 7392: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">file_exists</span>(<span class="php-var">$ctgfile</span>)) {
</span><span id="7393" class="l"><a href="#7393"> 7393: </a>                    <span class="php-var">$fontfile</span> = <span class="php-var">$ctgfile</span>;
</span><span id="7394" class="l"><a href="#7394"> 7394: </a>                }
</span><span id="7395" class="l"><a href="#7395"> 7395: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$fontfile</span>)) {
</span><span id="7396" class="l"><a href="#7396"> 7396: </a>                    <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Font file not found: '</span>.<span class="php-var">$ctgfile</span>);
</span><span id="7397" class="l"><a href="#7397"> 7397: </a>                }
</span><span id="7398" class="l"><a href="#7398"> 7398: </a>                <span class="php-var">$size</span> = <span class="php-keyword2">filesize</span>(<span class="php-var">$fontfile</span>);
</span><span id="7399" class="l"><a href="#7399"> 7399: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Length '</span>.<span class="php-var">$size</span>.<span class="php-quote">''</span>;
</span><span id="7400" class="l"><a href="#7400"> 7400: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$fontfile</span>, -<span class="php-num">2</span>) == <span class="php-quote">'.z'</span>) { <span class="php-comment">// check file extension</span>
</span><span id="7401" class="l"><a href="#7401"> 7401: </a>                    <span class="php-comment">// Decompresses data encoded using the public-domain</span>
</span><span id="7402" class="l"><a href="#7402"> 7402: </a>                    <span class="php-comment">// zlib/deflate compression method, reproducing the</span>
</span><span id="7403" class="l"><a href="#7403"> 7403: </a>                    <span class="php-comment">// original text or binary data</span>
</span><span id="7404" class="l"><a href="#7404"> 7404: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Filter /FlateDecode'</span>;
</span><span id="7405" class="l"><a href="#7405"> 7405: </a>                }
</span><span id="7406" class="l"><a href="#7406"> 7406: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7407" class="l"><a href="#7407"> 7407: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-keyword2">file_get_contents</span>(<span class="php-var">$fontfile</span>));
</span><span id="7408" class="l"><a href="#7408"> 7408: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="7409" class="l"><a href="#7409"> 7409: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7410" class="l"><a href="#7410"> 7410: </a>            }
</span><span id="7411" class="l"><a href="#7411"> 7411: </a>            <span class="php-keyword1">return</span> <span class="php-var">$obj_id</span>;
</span><span id="7412" class="l"><a href="#7412"> 7412: </a>        }
</span><span id="7413" class="l"><a href="#7413"> 7413: </a>
</span><span id="7414" class="l"><a href="#7414"> 7414: </a>        <span class="php-comment">/**
</span></span><span id="7415" class="l"><a href="#7415"> 7415: </a><span class="php-comment">         * Output CID-0 fonts.
</span></span><span id="7416" class="l"><a href="#7416"> 7416: </a><span class="php-comment">         * A Type 0 CIDFont contains glyph descriptions based on the Adobe Type 1 font format
</span></span><span id="7417" class="l"><a href="#7417"> 7417: </a><span class="php-comment">         * @param array $font font data
</span></span><span id="7418" class="l"><a href="#7418"> 7418: </a><span class="php-comment">         * @return int font object ID
</span></span><span id="7419" class="l"><a href="#7419"> 7419: </a><span class="php-comment">         * @access protected
</span></span><span id="7420" class="l"><a href="#7420"> 7420: </a><span class="php-comment">         * @author Andrew Whitehead, Nicola Asuni, Yukihiro Nakadaira
</span></span><span id="7421" class="l"><a href="#7421"> 7421: </a><span class="php-comment">         * @since 3.2.000 (2008-06-23)
</span></span><span id="7422" class="l"><a href="#7422"> 7422: </a><span class="php-comment">         */</span>
</span><span id="7423" class="l"><a href="#7423"> 7423: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putcidfont0(<span class="php-var">$font</span>) {
</span><span id="7424" class="l"><a href="#7424"> 7424: </a>            <span class="php-var">$cidoffset</span> = <span class="php-num">0</span>;
</span><span id="7425" class="l"><a href="#7425"> 7425: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$font</span>[<span class="php-quote">'cw'</span>][<span class="php-num">1</span>])) {
</span><span id="7426" class="l"><a href="#7426"> 7426: </a>                <span class="php-var">$cidoffset</span> = <span class="php-num">31</span>;
</span><span id="7427" class="l"><a href="#7427"> 7427: </a>            }
</span><span id="7428" class="l"><a href="#7428"> 7428: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'uni2cid'</span>])) {
</span><span id="7429" class="l"><a href="#7429"> 7429: </a>                <span class="php-comment">// convert unicode to cid.</span>
</span><span id="7430" class="l"><a href="#7430"> 7430: </a>                <span class="php-var">$uni2cid</span> = <span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'uni2cid'</span>];
</span><span id="7431" class="l"><a href="#7431"> 7431: </a>                <span class="php-var">$cw</span> = <span class="php-keyword1">array</span>();
</span><span id="7432" class="l"><a href="#7432"> 7432: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$font</span>[<span class="php-quote">'cw'</span>] <span class="php-keyword1">as</span> <span class="php-var">$uni</span> =&gt; <span class="php-var">$width</span>) {
</span><span id="7433" class="l"><a href="#7433"> 7433: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$uni2cid</span>[<span class="php-var">$uni</span>])) {
</span><span id="7434" class="l"><a href="#7434"> 7434: </a>                        <span class="php-var">$cw</span>[(<span class="php-var">$uni2cid</span>[<span class="php-var">$uni</span>] + <span class="php-var">$cidoffset</span>)] = <span class="php-var">$width</span>;
</span><span id="7435" class="l"><a href="#7435"> 7435: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$uni</span> &lt; <span class="php-num">256</span>) {
</span><span id="7436" class="l"><a href="#7436"> 7436: </a>                        <span class="php-var">$cw</span>[<span class="php-var">$uni</span>] = <span class="php-var">$width</span>;
</span><span id="7437" class="l"><a href="#7437"> 7437: </a>                    } <span class="php-comment">// else unknown character</span>
</span><span id="7438" class="l"><a href="#7438"> 7438: </a>                }
</span><span id="7439" class="l"><a href="#7439"> 7439: </a>                <span class="php-var">$font</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$font</span>, <span class="php-keyword1">array</span>(<span class="php-quote">'cw'</span> =&gt; <span class="php-var">$cw</span>));
</span><span id="7440" class="l"><a href="#7440"> 7440: </a>            }
</span><span id="7441" class="l"><a href="#7441"> 7441: </a>            <span class="php-var">$name</span> = <span class="php-var">$font</span>[<span class="php-quote">'name'</span>];
</span><span id="7442" class="l"><a href="#7442"> 7442: </a>            <span class="php-var">$enc</span> = <span class="php-var">$font</span>[<span class="php-quote">'enc'</span>];
</span><span id="7443" class="l"><a href="#7443"> 7443: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$enc</span>) {
</span><span id="7444" class="l"><a href="#7444"> 7444: </a>                <span class="php-var">$longname</span> = <span class="php-var">$name</span>.<span class="php-quote">'-'</span>.<span class="php-var">$enc</span>;
</span><span id="7445" class="l"><a href="#7445"> 7445: </a>            } <span class="php-keyword1">else</span> {
</span><span id="7446" class="l"><a href="#7446"> 7446: </a>                <span class="php-var">$longname</span> = <span class="php-var">$name</span>;
</span><span id="7447" class="l"><a href="#7447"> 7447: </a>            }
</span><span id="7448" class="l"><a href="#7448"> 7448: </a>            <span class="php-var">$obj_id</span> = <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7449" class="l"><a href="#7449"> 7449: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /Font'</span>;
</span><span id="7450" class="l"><a href="#7450"> 7450: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /Type0'</span>;
</span><span id="7451" class="l"><a href="#7451"> 7451: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /BaseFont /'</span>.<span class="php-var">$longname</span>;
</span><span id="7452" class="l"><a href="#7452"> 7452: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Name /F'</span>.<span class="php-var">$font</span>[<span class="php-quote">'i'</span>];
</span><span id="7453" class="l"><a href="#7453"> 7453: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$enc</span>) {
</span><span id="7454" class="l"><a href="#7454"> 7454: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Encoding /'</span>.<span class="php-var">$enc</span>;
</span><span id="7455" class="l"><a href="#7455"> 7455: </a>            }
</span><span id="7456" class="l"><a href="#7456"> 7456: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /DescendantFonts ['</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R]'</span>;
</span><span id="7457" class="l"><a href="#7457"> 7457: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7458" class="l"><a href="#7458"> 7458: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7459" class="l"><a href="#7459"> 7459: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7460" class="l"><a href="#7460"> 7460: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /Font'</span>;
</span><span id="7461" class="l"><a href="#7461"> 7461: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /CIDFontType0'</span>;
</span><span id="7462" class="l"><a href="#7462"> 7462: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /BaseFont /'</span>.<span class="php-var">$name</span>;
</span><span id="7463" class="l"><a href="#7463"> 7463: </a>            <span class="php-var">$cidinfo</span> = <span class="php-quote">'/Registry '</span>.<span class="php-var">$this</span>-&gt;_datastring(<span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'Registry'</span>]);
</span><span id="7464" class="l"><a href="#7464"> 7464: </a>            <span class="php-var">$cidinfo</span> .= <span class="php-quote">' /Ordering '</span>.<span class="php-var">$this</span>-&gt;_datastring(<span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'Ordering'</span>]);
</span><span id="7465" class="l"><a href="#7465"> 7465: </a>            <span class="php-var">$cidinfo</span> .= <span class="php-quote">' /Supplement '</span>.<span class="php-var">$font</span>[<span class="php-quote">'cidinfo'</span>][<span class="php-quote">'Supplement'</span>];
</span><span id="7466" class="l"><a href="#7466"> 7466: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /CIDSystemInfo &lt;&lt;'</span>.<span class="php-var">$cidinfo</span>.<span class="php-quote">'&gt;&gt;'</span>;
</span><span id="7467" class="l"><a href="#7467"> 7467: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /FontDescriptor '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="7468" class="l"><a href="#7468"> 7468: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /DW '</span>.<span class="php-var">$font</span>[<span class="php-quote">'dw'</span>];
</span><span id="7469" class="l"><a href="#7469"> 7469: </a>            <span class="php-var">$out</span> .= <span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$this</span>-&gt;_putfontwidths(<span class="php-var">$font</span>, <span class="php-var">$cidoffset</span>);
</span><span id="7470" class="l"><a href="#7470"> 7470: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7471" class="l"><a href="#7471"> 7471: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7472" class="l"><a href="#7472"> 7472: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7473" class="l"><a href="#7473"> 7473: </a>            <span class="php-var">$s</span> = <span class="php-quote">'&lt;&lt;/Type /FontDescriptor /FontName /'</span>.<span class="php-var">$name</span>;
</span><span id="7474" class="l"><a href="#7474"> 7474: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$font</span>[<span class="php-quote">'desc'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$v</span>) {
</span><span id="7475" class="l"><a href="#7475"> 7475: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$k</span> != <span class="php-quote">'Style'</span>) {
</span><span id="7476" class="l"><a href="#7476"> 7476: </a>                    <span class="php-keyword1">if</span>(<span class="php-keyword2">is_float</span>(<span class="php-var">$v</span>)) {
</span><span id="7477" class="l"><a href="#7477"> 7477: </a>                        <span class="php-var">$v</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F'</span>, <span class="php-var">$v</span>);
</span><span id="7478" class="l"><a href="#7478"> 7478: </a>                    }
</span><span id="7479" class="l"><a href="#7479"> 7479: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">' /'</span>.<span class="php-var">$k</span>.<span class="php-quote">' '</span>.<span class="php-var">$v</span>.<span class="php-quote">''</span>;
</span><span id="7480" class="l"><a href="#7480"> 7480: </a>                }
</span><span id="7481" class="l"><a href="#7481"> 7481: </a>            }
</span><span id="7482" class="l"><a href="#7482"> 7482: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$s</span>.<span class="php-quote">'&gt;&gt; endobj'</span>);
</span><span id="7483" class="l"><a href="#7483"> 7483: </a>            <span class="php-keyword1">return</span> <span class="php-var">$obj_id</span>;
</span><span id="7484" class="l"><a href="#7484"> 7484: </a>        }
</span><span id="7485" class="l"><a href="#7485"> 7485: </a>
</span><span id="7486" class="l"><a href="#7486"> 7486: </a>        <span class="php-comment">/**
</span></span><span id="7487" class="l"><a href="#7487"> 7487: </a><span class="php-comment">         * Output images.
</span></span><span id="7488" class="l"><a href="#7488"> 7488: </a><span class="php-comment">         * @access protected
</span></span><span id="7489" class="l"><a href="#7489"> 7489: </a><span class="php-comment">         */</span>
</span><span id="7490" class="l"><a href="#7490"> 7490: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putimages() {
</span><span id="7491" class="l"><a href="#7491"> 7491: </a>            <span class="php-var">$filter</span> = (<span class="php-var">$this</span>-&gt;compress) ? <span class="php-quote">'/Filter /FlateDecode '</span> : <span class="php-quote">''</span>;
</span><span id="7492" class="l"><a href="#7492"> 7492: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;imagekeys <span class="php-keyword1">as</span> <span class="php-var">$file</span>) {
</span><span id="7493" class="l"><a href="#7493"> 7493: </a>                <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;getImageBuffer(<span class="php-var">$file</span>);
</span><span id="7494" class="l"><a href="#7494"> 7494: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7495" class="l"><a href="#7495"> 7495: </a>                <span class="php-var">$this</span>-&gt;setImageSubBuffer(<span class="php-var">$file</span>, <span class="php-quote">'n'</span>, <span class="php-var">$this</span>-&gt;n);
</span><span id="7496" class="l"><a href="#7496"> 7496: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Type /XObject'</span>;
</span><span id="7497" class="l"><a href="#7497"> 7497: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Subtype /Image'</span>;
</span><span id="7498" class="l"><a href="#7498"> 7498: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Width '</span>.<span class="php-var">$info</span>[<span class="php-quote">'w'</span>];
</span><span id="7499" class="l"><a href="#7499"> 7499: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Height '</span>.<span class="php-var">$info</span>[<span class="php-quote">'h'</span>];
</span><span id="7500" class="l"><a href="#7500"> 7500: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">array_key_exists</span>(<span class="php-quote">'masked'</span>, <span class="php-var">$info</span>)) {
</span><span id="7501" class="l"><a href="#7501"> 7501: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /SMask '</span>.(<span class="php-var">$this</span>-&gt;n - <span class="php-num">1</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="7502" class="l"><a href="#7502"> 7502: </a>                }
</span><span id="7503" class="l"><a href="#7503"> 7503: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$info</span>[<span class="php-quote">'cs'</span>] == <span class="php-quote">'Indexed'</span>) {
</span><span id="7504" class="l"><a href="#7504"> 7504: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /ColorSpace [/Indexed /DeviceRGB '</span>.((<span class="php-keyword2">strlen</span>(<span class="php-var">$info</span>[<span class="php-quote">'pal'</span>]) / <span class="php-num">3</span>) - <span class="php-num">1</span>).<span class="php-quote">' '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R]'</span>;
</span><span id="7505" class="l"><a href="#7505"> 7505: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7506" class="l"><a href="#7506"> 7506: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /ColorSpace /'</span>.<span class="php-var">$info</span>[<span class="php-quote">'cs'</span>];
</span><span id="7507" class="l"><a href="#7507"> 7507: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$info</span>[<span class="php-quote">'cs'</span>] == <span class="php-quote">'DeviceCMYK'</span>) {
</span><span id="7508" class="l"><a href="#7508"> 7508: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Decode [1 0 1 0 1 0 1 0]'</span>;
</span><span id="7509" class="l"><a href="#7509"> 7509: </a>                    }
</span><span id="7510" class="l"><a href="#7510"> 7510: </a>                }
</span><span id="7511" class="l"><a href="#7511"> 7511: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /BitsPerComponent '</span>.<span class="php-var">$info</span>[<span class="php-quote">'bpc'</span>];
</span><span id="7512" class="l"><a href="#7512"> 7512: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$info</span>[<span class="php-quote">'f'</span>])) {
</span><span id="7513" class="l"><a href="#7513"> 7513: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Filter /'</span>.<span class="php-var">$info</span>[<span class="php-quote">'f'</span>];
</span><span id="7514" class="l"><a href="#7514"> 7514: </a>                }
</span><span id="7515" class="l"><a href="#7515"> 7515: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$info</span>[<span class="php-quote">'parms'</span>])) {
</span><span id="7516" class="l"><a href="#7516"> 7516: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$info</span>[<span class="php-quote">'parms'</span>];
</span><span id="7517" class="l"><a href="#7517"> 7517: </a>                }
</span><span id="7518" class="l"><a href="#7518"> 7518: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$info</span>[<span class="php-quote">'trns'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$info</span>[<span class="php-quote">'trns'</span>])) {
</span><span id="7519" class="l"><a href="#7519"> 7519: </a>                    <span class="php-var">$trns</span>=<span class="php-quote">''</span>;
</span><span id="7520" class="l"><a href="#7520"> 7520: </a>                    <span class="php-var">$count_info</span> = <span class="php-keyword2">count</span>(<span class="php-var">$info</span>[<span class="php-quote">'trns'</span>]);
</span><span id="7521" class="l"><a href="#7521"> 7521: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$count_info</span>; ++<span class="php-var">$i</span>) {
</span><span id="7522" class="l"><a href="#7522"> 7522: </a>                        <span class="php-var">$trns</span> .= <span class="php-var">$info</span>[<span class="php-quote">'trns'</span>][<span class="php-var">$i</span>].<span class="php-quote">' '</span>.<span class="php-var">$info</span>[<span class="php-quote">'trns'</span>][<span class="php-var">$i</span>].<span class="php-quote">' '</span>;
</span><span id="7523" class="l"><a href="#7523"> 7523: </a>                    }
</span><span id="7524" class="l"><a href="#7524"> 7524: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Mask ['</span>.<span class="php-var">$trns</span>.<span class="php-quote">']'</span>;
</span><span id="7525" class="l"><a href="#7525"> 7525: </a>                }
</span><span id="7526" class="l"><a href="#7526"> 7526: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$info</span>[<span class="php-quote">'data'</span>]).<span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7527" class="l"><a href="#7527"> 7527: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$info</span>[<span class="php-quote">'data'</span>]);
</span><span id="7528" class="l"><a href="#7528"> 7528: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="7529" class="l"><a href="#7529"> 7529: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7530" class="l"><a href="#7530"> 7530: </a>                <span class="php-comment">//Palette</span>
</span><span id="7531" class="l"><a href="#7531"> 7531: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$info</span>[<span class="php-quote">'cs'</span>] == <span class="php-quote">'Indexed'</span>) {
</span><span id="7532" class="l"><a href="#7532"> 7532: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7533" class="l"><a href="#7533"> 7533: </a>                    <span class="php-var">$pal</span> = (<span class="php-var">$this</span>-&gt;compress) ? <span class="php-keyword2">gzcompress</span>(<span class="php-var">$info</span>[<span class="php-quote">'pal'</span>]) : <span class="php-var">$info</span>[<span class="php-quote">'pal'</span>];
</span><span id="7534" class="l"><a href="#7534"> 7534: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'&lt;&lt;'</span>.<span class="php-var">$filter</span>.<span class="php-quote">'/Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$pal</span>).<span class="php-quote">'&gt;&gt; '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$pal</span>).<span class="php-quote">' endobj'</span>);
</span><span id="7535" class="l"><a href="#7535"> 7535: </a>                }
</span><span id="7536" class="l"><a href="#7536"> 7536: </a>            }
</span><span id="7537" class="l"><a href="#7537"> 7537: </a>        }
</span><span id="7538" class="l"><a href="#7538"> 7538: </a>
</span><span id="7539" class="l"><a href="#7539"> 7539: </a>        <span class="php-comment">/**
</span></span><span id="7540" class="l"><a href="#7540"> 7540: </a><span class="php-comment">         * Output Spot Colors Resources.
</span></span><span id="7541" class="l"><a href="#7541"> 7541: </a><span class="php-comment">         * @access protected
</span></span><span id="7542" class="l"><a href="#7542"> 7542: </a><span class="php-comment">         * @since 4.0.024 (2008-09-12)
</span></span><span id="7543" class="l"><a href="#7543"> 7543: </a><span class="php-comment">         */</span>
</span><span id="7544" class="l"><a href="#7544"> 7544: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putspotcolors() {
</span><span id="7545" class="l"><a href="#7545"> 7545: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;spot_colors <span class="php-keyword1">as</span> <span class="php-var">$name</span> =&gt; <span class="php-var">$color</span>) {
</span><span id="7546" class="l"><a href="#7546"> 7546: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7547" class="l"><a href="#7547"> 7547: </a>                <span class="php-var">$this</span>-&gt;spot_colors[<span class="php-var">$name</span>][<span class="php-quote">'n'</span>] = <span class="php-var">$this</span>-&gt;n;
</span><span id="7548" class="l"><a href="#7548"> 7548: </a>                <span class="php-var">$out</span> = <span class="php-quote">'[/Separation /'</span>.<span class="php-keyword2">str_replace</span>(<span class="php-quote">' '</span>, <span class="php-quote">'#20'</span>, <span class="php-var">$name</span>);
</span><span id="7549" class="l"><a href="#7549"> 7549: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /DeviceCMYK &lt;&lt;'</span>;
</span><span id="7550" class="l"><a href="#7550"> 7550: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Range [0 1 0 1 0 1 0 1] /C0 [0 0 0 0]'</span>;
</span><span id="7551" class="l"><a href="#7551"> 7551: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'/C1 [%.4F %.4F %.4F %.4F] '</span>, <span class="php-var">$color</span>[<span class="php-quote">'c'</span>]/<span class="php-num">100</span>, <span class="php-var">$color</span>[<span class="php-quote">'m'</span>]/<span class="php-num">100</span>, <span class="php-var">$color</span>[<span class="php-quote">'y'</span>]/<span class="php-num">100</span>, <span class="php-var">$color</span>[<span class="php-quote">'k'</span>]/<span class="php-num">100</span>);
</span><span id="7552" class="l"><a href="#7552"> 7552: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /FunctionType 2 /Domain [0 1] /N 1&gt;&gt;]'</span>;
</span><span id="7553" class="l"><a href="#7553"> 7553: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="7554" class="l"><a href="#7554"> 7554: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7555" class="l"><a href="#7555"> 7555: </a>            }
</span><span id="7556" class="l"><a href="#7556"> 7556: </a>        }
</span><span id="7557" class="l"><a href="#7557"> 7557: </a>
</span><span id="7558" class="l"><a href="#7558"> 7558: </a>        <span class="php-comment">/**
</span></span><span id="7559" class="l"><a href="#7559"> 7559: </a><span class="php-comment">         * Output Resources Dictionary.
</span></span><span id="7560" class="l"><a href="#7560"> 7560: </a><span class="php-comment">         * @access protected
</span></span><span id="7561" class="l"><a href="#7561"> 7561: </a><span class="php-comment">         */</span>
</span><span id="7562" class="l"><a href="#7562"> 7562: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putresourcedict() {
</span><span id="7563" class="l"><a href="#7563"> 7563: </a>            <span class="php-var">$out</span> = <span class="php-quote">'2 0 obj'</span>;
</span><span id="7564" class="l"><a href="#7564"> 7564: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &lt;&lt; /ProcSet [/PDF /Text /ImageB /ImageC /ImageI]'</span>;
</span><span id="7565" class="l"><a href="#7565"> 7565: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Font &lt;&lt;'</span>;
</span><span id="7566" class="l"><a href="#7566"> 7566: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;fontkeys <span class="php-keyword1">as</span> <span class="php-var">$fontkey</span>) {
</span><span id="7567" class="l"><a href="#7567"> 7567: </a>                <span class="php-var">$font</span> = <span class="php-var">$this</span>-&gt;getFontBuffer(<span class="php-var">$fontkey</span>);
</span><span id="7568" class="l"><a href="#7568"> 7568: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /F'</span>.<span class="php-var">$font</span>[<span class="php-quote">'i'</span>].<span class="php-quote">' '</span>.<span class="php-var">$font</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7569" class="l"><a href="#7569"> 7569: </a>            }
</span><span id="7570" class="l"><a href="#7570"> 7570: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7571" class="l"><a href="#7571"> 7571: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /XObject &lt;&lt;'</span>;
</span><span id="7572" class="l"><a href="#7572"> 7572: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;imagekeys <span class="php-keyword1">as</span> <span class="php-var">$file</span>) {
</span><span id="7573" class="l"><a href="#7573"> 7573: </a>                <span class="php-var">$info</span> = <span class="php-var">$this</span>-&gt;getImageBuffer(<span class="php-var">$file</span>);
</span><span id="7574" class="l"><a href="#7574"> 7574: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /I'</span>.<span class="php-var">$info</span>[<span class="php-quote">'i'</span>].<span class="php-quote">' '</span>.<span class="php-var">$info</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7575" class="l"><a href="#7575"> 7575: </a>            }
</span><span id="7576" class="l"><a href="#7576"> 7576: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7577" class="l"><a href="#7577"> 7577: </a>            <span class="php-comment">// visibility</span>
</span><span id="7578" class="l"><a href="#7578"> 7578: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Properties &lt;&lt;/OC1 '</span>.<span class="php-var">$this</span>-&gt;n_ocg_print.<span class="php-quote">' 0 R /OC2 '</span>.<span class="php-var">$this</span>-&gt;n_ocg_view.<span class="php-quote">' 0 R&gt;&gt;'</span>;
</span><span id="7579" class="l"><a href="#7579"> 7579: </a>            <span class="php-comment">// transparency</span>
</span><span id="7580" class="l"><a href="#7580"> 7580: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /ExtGState &lt;&lt;'</span>;
</span><span id="7581" class="l"><a href="#7581"> 7581: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;extgstates <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$extgstate</span>) {
</span><span id="7582" class="l"><a href="#7582"> 7582: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$extgstate</span>[<span class="php-quote">'name'</span>])) {
</span><span id="7583" class="l"><a href="#7583"> 7583: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /'</span>.<span class="php-var">$extgstate</span>[<span class="php-quote">'name'</span>];
</span><span id="7584" class="l"><a href="#7584"> 7584: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7585" class="l"><a href="#7585"> 7585: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /GS'</span>.<span class="php-var">$k</span>;
</span><span id="7586" class="l"><a href="#7586"> 7586: </a>                }
</span><span id="7587" class="l"><a href="#7587"> 7587: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$extgstate</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7588" class="l"><a href="#7588"> 7588: </a>            }
</span><span id="7589" class="l"><a href="#7589"> 7589: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7590" class="l"><a href="#7590"> 7590: </a>            <span class="php-comment">// gradient patterns</span>
</span><span id="7591" class="l"><a href="#7591"> 7591: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;gradients) <span class="php-keyword1">AND</span> (<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;gradients) &gt; <span class="php-num">0</span>)) {
</span><span id="7592" class="l"><a href="#7592"> 7592: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Pattern &lt;&lt;'</span>;
</span><span id="7593" class="l"><a href="#7593"> 7593: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;gradients <span class="php-keyword1">as</span> <span class="php-var">$id</span> =&gt; <span class="php-var">$grad</span>) {
</span><span id="7594" class="l"><a href="#7594"> 7594: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /p'</span>.<span class="php-var">$id</span>.<span class="php-quote">' '</span>.<span class="php-var">$grad</span>[<span class="php-quote">'pattern'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7595" class="l"><a href="#7595"> 7595: </a>                }
</span><span id="7596" class="l"><a href="#7596"> 7596: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7597" class="l"><a href="#7597"> 7597: </a>            }
</span><span id="7598" class="l"><a href="#7598"> 7598: </a>            <span class="php-comment">// gradient shadings</span>
</span><span id="7599" class="l"><a href="#7599"> 7599: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;gradients) <span class="php-keyword1">AND</span> (<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;gradients) &gt; <span class="php-num">0</span>)) {
</span><span id="7600" class="l"><a href="#7600"> 7600: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Shading &lt;&lt;'</span>;
</span><span id="7601" class="l"><a href="#7601"> 7601: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;gradients <span class="php-keyword1">as</span> <span class="php-var">$id</span> =&gt; <span class="php-var">$grad</span>) {
</span><span id="7602" class="l"><a href="#7602"> 7602: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Sh'</span>.<span class="php-var">$id</span>.<span class="php-quote">' '</span>.<span class="php-var">$grad</span>[<span class="php-quote">'id'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7603" class="l"><a href="#7603"> 7603: </a>                }
</span><span id="7604" class="l"><a href="#7604"> 7604: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7605" class="l"><a href="#7605"> 7605: </a>            }
</span><span id="7606" class="l"><a href="#7606"> 7606: </a>            <span class="php-comment">// spot colors</span>
</span><span id="7607" class="l"><a href="#7607"> 7607: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;spot_colors) <span class="php-keyword1">AND</span> (<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;spot_colors) &gt; <span class="php-num">0</span>)) {
</span><span id="7608" class="l"><a href="#7608"> 7608: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /ColorSpace &lt;&lt;'</span>;
</span><span id="7609" class="l"><a href="#7609"> 7609: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;spot_colors <span class="php-keyword1">as</span> <span class="php-var">$color</span>) {
</span><span id="7610" class="l"><a href="#7610"> 7610: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /CS'</span>.<span class="php-var">$color</span>[<span class="php-quote">'i'</span>].<span class="php-quote">' '</span>.<span class="php-var">$color</span>[<span class="php-quote">'n'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7611" class="l"><a href="#7611"> 7611: </a>                }
</span><span id="7612" class="l"><a href="#7612"> 7612: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7613" class="l"><a href="#7613"> 7613: </a>            }
</span><span id="7614" class="l"><a href="#7614"> 7614: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7615" class="l"><a href="#7615"> 7615: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7616" class="l"><a href="#7616"> 7616: </a>        }
</span><span id="7617" class="l"><a href="#7617"> 7617: </a>
</span><span id="7618" class="l"><a href="#7618"> 7618: </a>        <span class="php-comment">/**
</span></span><span id="7619" class="l"><a href="#7619"> 7619: </a><span class="php-comment">         * Output Resources.
</span></span><span id="7620" class="l"><a href="#7620"> 7620: </a><span class="php-comment">         * @access protected
</span></span><span id="7621" class="l"><a href="#7621"> 7621: </a><span class="php-comment">         */</span>
</span><span id="7622" class="l"><a href="#7622"> 7622: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putresources() {
</span><span id="7623" class="l"><a href="#7623"> 7623: </a>            <span class="php-var">$this</span>-&gt;_putextgstates();
</span><span id="7624" class="l"><a href="#7624"> 7624: </a>            <span class="php-var">$this</span>-&gt;_putocg();
</span><span id="7625" class="l"><a href="#7625"> 7625: </a>            <span class="php-var">$this</span>-&gt;_putfonts();
</span><span id="7626" class="l"><a href="#7626"> 7626: </a>            <span class="php-var">$this</span>-&gt;_putimages();
</span><span id="7627" class="l"><a href="#7627"> 7627: </a>            <span class="php-var">$this</span>-&gt;_putspotcolors();
</span><span id="7628" class="l"><a href="#7628"> 7628: </a>            <span class="php-var">$this</span>-&gt;_putshaders();
</span><span id="7629" class="l"><a href="#7629"> 7629: </a>            <span class="php-comment">//Resource dictionary</span>
</span><span id="7630" class="l"><a href="#7630"> 7630: </a>            <span class="php-var">$this</span>-&gt;offsets[<span class="php-num">2</span>] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="7631" class="l"><a href="#7631"> 7631: </a>            <span class="php-var">$this</span>-&gt;_putresourcedict();
</span><span id="7632" class="l"><a href="#7632"> 7632: </a>            <span class="php-var">$this</span>-&gt;_putbookmarks();
</span><span id="7633" class="l"><a href="#7633"> 7633: </a>            <span class="php-var">$this</span>-&gt;_putEmbeddedFiles();
</span><span id="7634" class="l"><a href="#7634"> 7634: </a>            <span class="php-var">$this</span>-&gt;_putannotsobjs();
</span><span id="7635" class="l"><a href="#7635"> 7635: </a>            <span class="php-var">$this</span>-&gt;_putjavascript();
</span><span id="7636" class="l"><a href="#7636"> 7636: </a>            <span class="php-comment">// encryption</span>
</span><span id="7637" class="l"><a href="#7637"> 7637: </a>            <span class="php-var">$this</span>-&gt;_putencryption();
</span><span id="7638" class="l"><a href="#7638"> 7638: </a>        }
</span><span id="7639" class="l"><a href="#7639"> 7639: </a>
</span><span id="7640" class="l"><a href="#7640"> 7640: </a>        <span class="php-comment">/**
</span></span><span id="7641" class="l"><a href="#7641"> 7641: </a><span class="php-comment">         * Adds some Metadata information (Document Information Dictionary)
</span></span><span id="7642" class="l"><a href="#7642"> 7642: </a><span class="php-comment">         * (see Chapter 14.3.3 Document Information Dictionary of PDF32000_2008.pdf Reference)
</span></span><span id="7643" class="l"><a href="#7643"> 7643: </a><span class="php-comment">         * @access protected
</span></span><span id="7644" class="l"><a href="#7644"> 7644: </a><span class="php-comment">         */</span>
</span><span id="7645" class="l"><a href="#7645"> 7645: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putinfo() {
</span><span id="7646" class="l"><a href="#7646"> 7646: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7647" class="l"><a href="#7647"> 7647: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;'</span>;
</span><span id="7648" class="l"><a href="#7648"> 7648: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;title)) {
</span><span id="7649" class="l"><a href="#7649"> 7649: </a>                <span class="php-comment">// The document's title.</span>
</span><span id="7650" class="l"><a href="#7650"> 7650: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Title '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;title);
</span><span id="7651" class="l"><a href="#7651"> 7651: </a>            }
</span><span id="7652" class="l"><a href="#7652"> 7652: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;author)) {
</span><span id="7653" class="l"><a href="#7653"> 7653: </a>                <span class="php-comment">// The name of the person who created the document.</span>
</span><span id="7654" class="l"><a href="#7654"> 7654: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Author '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;author);
</span><span id="7655" class="l"><a href="#7655"> 7655: </a>            }
</span><span id="7656" class="l"><a href="#7656"> 7656: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;subject)) {
</span><span id="7657" class="l"><a href="#7657"> 7657: </a>                <span class="php-comment">// The subject of the document.</span>
</span><span id="7658" class="l"><a href="#7658"> 7658: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Subject '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;subject);
</span><span id="7659" class="l"><a href="#7659"> 7659: </a>            }
</span><span id="7660" class="l"><a href="#7660"> 7660: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;keywords)) {
</span><span id="7661" class="l"><a href="#7661"> 7661: </a>                <span class="php-comment">// Keywords associated with the document.</span>
</span><span id="7662" class="l"><a href="#7662"> 7662: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Keywords '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;keywords.<span class="php-quote">' TCP'</span>.<span class="php-quote">'DF'</span>);
</span><span id="7663" class="l"><a href="#7663"> 7663: </a>            }
</span><span id="7664" class="l"><a href="#7664"> 7664: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;creator)) {
</span><span id="7665" class="l"><a href="#7665"> 7665: </a>                <span class="php-comment">// If the document was converted to PDF from another format, the name of the conforming product that created the original document from which it was converted.</span>
</span><span id="7666" class="l"><a href="#7666"> 7666: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Creator '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;creator);
</span><span id="7667" class="l"><a href="#7667"> 7667: </a>            }
</span><span id="7668" class="l"><a href="#7668"> 7668: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">defined</span>(<span class="php-quote">'PDF_PRODUCER'</span>)) {
</span><span id="7669" class="l"><a href="#7669"> 7669: </a>                <span class="php-comment">// If the document was converted to PDF from another format, the name of the conforming product that converted it to PDF.</span>
</span><span id="7670" class="l"><a href="#7670"> 7670: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Producer '</span>.<span class="php-var">$this</span>-&gt;_textstring(PDF_PRODUCER.<span class="php-quote">' (TCP'</span>.<span class="php-quote">'DF)'</span>);
</span><span id="7671" class="l"><a href="#7671"> 7671: </a>            } <span class="php-keyword1">else</span> {
</span><span id="7672" class="l"><a href="#7672"> 7672: </a>                <span class="php-comment">// default producer</span>
</span><span id="7673" class="l"><a href="#7673"> 7673: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Producer '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-quote">'TCP'</span>.<span class="php-quote">'DF'</span>);
</span><span id="7674" class="l"><a href="#7674"> 7674: </a>            }
</span><span id="7675" class="l"><a href="#7675"> 7675: </a>            <span class="php-comment">// The date and time the document was created, in human-readable form</span>
</span><span id="7676" class="l"><a href="#7676"> 7676: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /CreationDate '</span>.<span class="php-var">$this</span>-&gt;_datestring();
</span><span id="7677" class="l"><a href="#7677"> 7677: </a>            <span class="php-comment">// The date and time the document was most recently modified, in human-readable form</span>
</span><span id="7678" class="l"><a href="#7678"> 7678: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /ModDate '</span>.<span class="php-var">$this</span>-&gt;_datestring();
</span><span id="7679" class="l"><a href="#7679"> 7679: </a>            <span class="php-comment">// A name object indicating whether the document has been modified to include trapping information</span>
</span><span id="7680" class="l"><a href="#7680"> 7680: </a>            <span class="php-comment">//$out .= ' /Trapped /False');</span>
</span><span id="7681" class="l"><a href="#7681"> 7681: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7682" class="l"><a href="#7682"> 7682: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7683" class="l"><a href="#7683"> 7683: </a>        }
</span><span id="7684" class="l"><a href="#7684"> 7684: </a>
</span><span id="7685" class="l"><a href="#7685"> 7685: </a>        <span class="php-comment">/**
</span></span><span id="7686" class="l"><a href="#7686"> 7686: </a><span class="php-comment">         * Output Catalog.
</span></span><span id="7687" class="l"><a href="#7687"> 7687: </a><span class="php-comment">         * @access protected
</span></span><span id="7688" class="l"><a href="#7688"> 7688: </a><span class="php-comment">         */</span>
</span><span id="7689" class="l"><a href="#7689"> 7689: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putcatalog() {
</span><span id="7690" class="l"><a href="#7690"> 7690: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7691" class="l"><a href="#7691"> 7691: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /Catalog'</span>;
</span><span id="7692" class="l"><a href="#7692"> 7692: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Pages 1 0 R'</span>;
</span><span id="7693" class="l"><a href="#7693"> 7693: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;ZoomMode == <span class="php-quote">'fullpage'</span>) {
</span><span id="7694" class="l"><a href="#7694"> 7694: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /OpenAction [3 0 R /Fit]'</span>;
</span><span id="7695" class="l"><a href="#7695"> 7695: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;ZoomMode == <span class="php-quote">'fullwidth'</span>) {
</span><span id="7696" class="l"><a href="#7696"> 7696: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /OpenAction [3 0 R /FitH null]'</span>;
</span><span id="7697" class="l"><a href="#7697"> 7697: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;ZoomMode == <span class="php-quote">'real'</span>) {
</span><span id="7698" class="l"><a href="#7698"> 7698: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /OpenAction [3 0 R /XYZ null null 1]'</span>;
</span><span id="7699" class="l"><a href="#7699"> 7699: </a>            } <span class="php-keyword1">elseif</span> (!<span class="php-keyword2">is_string</span>(<span class="php-var">$this</span>-&gt;ZoomMode)) {
</span><span id="7700" class="l"><a href="#7700"> 7700: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /OpenAction [3 0 R /XYZ null null '</span>.(<span class="php-var">$this</span>-&gt;ZoomMode / <span class="php-num">100</span>).<span class="php-quote">']'</span>;
</span><span id="7701" class="l"><a href="#7701"> 7701: </a>            }
</span><span id="7702" class="l"><a href="#7702"> 7702: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;LayoutMode) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;LayoutMode))) {
</span><span id="7703" class="l"><a href="#7703"> 7703: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /PageLayout /'</span>.<span class="php-var">$this</span>-&gt;LayoutMode;
</span><span id="7704" class="l"><a href="#7704"> 7704: </a>            }
</span><span id="7705" class="l"><a href="#7705"> 7705: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageMode) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;PageMode))) {
</span><span id="7706" class="l"><a href="#7706"> 7706: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /PageMode /'</span>.<span class="php-var">$this</span>-&gt;PageMode;
</span><span id="7707" class="l"><a href="#7707"> 7707: </a>            }
</span><span id="7708" class="l"><a href="#7708"> 7708: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;l[<span class="php-quote">'a_meta_language'</span>])) {
</span><span id="7709" class="l"><a href="#7709"> 7709: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Lang /'</span>.<span class="php-var">$this</span>-&gt;l[<span class="php-quote">'a_meta_language'</span>];
</span><span id="7710" class="l"><a href="#7710"> 7710: </a>            }
</span><span id="7711" class="l"><a href="#7711"> 7711: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Names &lt;&lt;'</span>;
</span><span id="7712" class="l"><a href="#7712"> 7712: </a>            <span class="php-keyword1">if</span> ((!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;javascript)) <span class="php-keyword1">OR</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;js_objects))) {
</span><span id="7713" class="l"><a href="#7713"> 7713: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /JavaScript '</span>.(<span class="php-var">$this</span>-&gt;n_js).<span class="php-quote">' 0 R'</span>;
</span><span id="7714" class="l"><a href="#7714"> 7714: </a>            }
</span><span id="7715" class="l"><a href="#7715"> 7715: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7716" class="l"><a href="#7716"> 7716: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;outlines) &gt; <span class="php-num">0</span>) {
</span><span id="7717" class="l"><a href="#7717"> 7717: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Outlines '</span>.<span class="php-var">$this</span>-&gt;OutlineRoot.<span class="php-quote">' 0 R'</span>;
</span><span id="7718" class="l"><a href="#7718"> 7718: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /PageMode /UseOutlines'</span>;
</span><span id="7719" class="l"><a href="#7719"> 7719: </a>            }
</span><span id="7720" class="l"><a href="#7720"> 7720: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_putviewerpreferences();
</span><span id="7721" class="l"><a href="#7721"> 7721: </a>            <span class="php-var">$p</span> = <span class="php-var">$this</span>-&gt;n_ocg_print.<span class="php-quote">' 0 R'</span>;
</span><span id="7722" class="l"><a href="#7722"> 7722: </a>            <span class="php-var">$v</span> = <span class="php-var">$this</span>-&gt;n_ocg_view.<span class="php-quote">' 0 R'</span>;
</span><span id="7723" class="l"><a href="#7723"> 7723: </a>            <span class="php-var">$as</span> = <span class="php-quote">'&lt;&lt;/Event /Print /OCGs ['</span>.<span class="php-var">$p</span>.<span class="php-quote">' '</span>.<span class="php-var">$v</span>.<span class="php-quote">'] /Category [/Print]&gt;&gt; &lt;&lt;/Event /View /OCGs ['</span>.<span class="php-var">$p</span>.<span class="php-quote">' '</span>.<span class="php-var">$v</span>.<span class="php-quote">'] /Category [/View]&gt;&gt;'</span>;
</span><span id="7724" class="l"><a href="#7724"> 7724: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /OCProperties &lt;&lt;/OCGs ['</span>.<span class="php-var">$p</span>.<span class="php-quote">' '</span>.<span class="php-var">$v</span>.<span class="php-quote">'] /D &lt;&lt;/ON ['</span>.<span class="php-var">$p</span>.<span class="php-quote">'] /OFF ['</span>.<span class="php-var">$v</span>.<span class="php-quote">'] /AS ['</span>.<span class="php-var">$as</span>.<span class="php-quote">']&gt;&gt;&gt;&gt;'</span>;
</span><span id="7725" class="l"><a href="#7725"> 7725: </a>            <span class="php-comment">// AcroForm</span>
</span><span id="7726" class="l"><a href="#7726"> 7726: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;form_obj_id) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;sign <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>]))) {
</span><span id="7727" class="l"><a href="#7727"> 7727: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /AcroForm&lt;&lt;'</span>;
</span><span id="7728" class="l"><a href="#7728"> 7728: </a>                <span class="php-var">$objrefs</span> = <span class="php-quote">''</span>;
</span><span id="7729" class="l"><a href="#7729"> 7729: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;sign <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>])) {
</span><span id="7730" class="l"><a href="#7730"> 7730: </a>                    <span class="php-var">$objrefs</span> .= <span class="php-var">$this</span>-&gt;sig_obj_id.<span class="php-quote">' 0 R'</span>;
</span><span id="7731" class="l"><a href="#7731"> 7731: </a>                }
</span><span id="7732" class="l"><a href="#7732"> 7732: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;form_obj_id)) {
</span><span id="7733" class="l"><a href="#7733"> 7733: </a>                    <span class="php-keyword1">foreach</span>(<span class="php-var">$this</span>-&gt;form_obj_id <span class="php-keyword1">as</span> <span class="php-var">$objid</span>) {
</span><span id="7734" class="l"><a href="#7734"> 7734: </a>                        <span class="php-var">$objrefs</span> .= <span class="php-quote">' '</span>.<span class="php-var">$objid</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="7735" class="l"><a href="#7735"> 7735: </a>                    }
</span><span id="7736" class="l"><a href="#7736"> 7736: </a>                }
</span><span id="7737" class="l"><a href="#7737"> 7737: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Fields ['</span>.<span class="php-var">$objrefs</span>.<span class="php-quote">']'</span>;
</span><span id="7738" class="l"><a href="#7738"> 7738: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /NeedAppearances '</span>.(<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;form_obj_id)?<span class="php-quote">'false'</span>:<span class="php-quote">'true'</span>);
</span><span id="7739" class="l"><a href="#7739"> 7739: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;sign <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>])) {
</span><span id="7740" class="l"><a href="#7740"> 7740: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /SigFlags 3'</span>;
</span><span id="7741" class="l"><a href="#7741"> 7741: </a>                }
</span><span id="7742" class="l"><a href="#7742"> 7742: </a>                <span class="php-comment">//$out .= ' /CO ';</span>
</span><span id="7743" class="l"><a href="#7743"> 7743: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;annotation_fonts) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;annotation_fonts)) {
</span><span id="7744" class="l"><a href="#7744"> 7744: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /DR &lt;&lt;'</span>;
</span><span id="7745" class="l"><a href="#7745"> 7745: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Font &lt;&lt;'</span>;
</span><span id="7746" class="l"><a href="#7746"> 7746: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;annotation_fonts <span class="php-keyword1">as</span> <span class="php-var">$font</span> =&gt; <span class="php-var">$fontkey</span>) {
</span><span id="7747" class="l"><a href="#7747"> 7747: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /F'</span>.(<span class="php-var">$fontkey</span> + <span class="php-num">1</span>).<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;font_obj_ids[<span class="php-var">$font</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="7748" class="l"><a href="#7748"> 7748: </a>                    }
</span><span id="7749" class="l"><a href="#7749"> 7749: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; &gt;&gt;'</span>;
</span><span id="7750" class="l"><a href="#7750"> 7750: </a>                }
</span><span id="7751" class="l"><a href="#7751"> 7751: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /DA (/F'</span>.(<span class="php-keyword2">array_search</span>(<span class="php-quote">'helvetica'</span>, <span class="php-var">$this</span>-&gt;fontkeys) + <span class="php-num">1</span>).<span class="php-quote">' 0 Tf 0 g)'</span>;
</span><span id="7752" class="l"><a href="#7752"> 7752: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Q '</span>.((<span class="php-var">$this</span>-&gt;rtl)?<span class="php-quote">'2'</span>:<span class="php-quote">'0'</span>);
</span><span id="7753" class="l"><a href="#7753"> 7753: </a>                <span class="php-comment">//$out .= ' /XFA ';</span>
</span><span id="7754" class="l"><a href="#7754"> 7754: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7755" class="l"><a href="#7755"> 7755: </a>                <span class="php-comment">// signatures</span>
</span><span id="7756" class="l"><a href="#7756"> 7756: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;sign <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>])) {
</span><span id="7757" class="l"><a href="#7757"> 7757: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>] &gt; <span class="php-num">0</span>) {
</span><span id="7758" class="l"><a href="#7758"> 7758: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Perms&lt;&lt;/DocMDP '</span>.(<span class="php-var">$this</span>-&gt;sig_obj_id + <span class="php-num">1</span>).<span class="php-quote">' 0 R&gt;&gt;'</span>;
</span><span id="7759" class="l"><a href="#7759"> 7759: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="7760" class="l"><a href="#7760"> 7760: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Perms&lt;&lt;/UR3 '</span>.(<span class="php-var">$this</span>-&gt;sig_obj_id + <span class="php-num">1</span>).<span class="php-quote">' 0 R&gt;&gt;'</span>;
</span><span id="7761" class="l"><a href="#7761"> 7761: </a>                    }
</span><span id="7762" class="l"><a href="#7762"> 7762: </a>                }
</span><span id="7763" class="l"><a href="#7763"> 7763: </a>            }
</span><span id="7764" class="l"><a href="#7764"> 7764: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7765" class="l"><a href="#7765"> 7765: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7766" class="l"><a href="#7766"> 7766: </a>        }
</span><span id="7767" class="l"><a href="#7767"> 7767: </a>
</span><span id="7768" class="l"><a href="#7768"> 7768: </a>        <span class="php-comment">/**
</span></span><span id="7769" class="l"><a href="#7769"> 7769: </a><span class="php-comment">         * Output viewer preferences.
</span></span><span id="7770" class="l"><a href="#7770"> 7770: </a><span class="php-comment">         * @return string for viewer preferences
</span></span><span id="7771" class="l"><a href="#7771"> 7771: </a><span class="php-comment">         * @author Nicola asuni
</span></span><span id="7772" class="l"><a href="#7772"> 7772: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="7773" class="l"><a href="#7773"> 7773: </a><span class="php-comment">         * @access protected
</span></span><span id="7774" class="l"><a href="#7774"> 7774: </a><span class="php-comment">         */</span>
</span><span id="7775" class="l"><a href="#7775"> 7775: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putviewerpreferences() {
</span><span id="7776" class="l"><a href="#7776"> 7776: </a>            <span class="php-var">$out</span> = <span class="php-quote">'/ViewerPreferences &lt;&lt;'</span>;
</span><span id="7777" class="l"><a href="#7777"> 7777: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="7778" class="l"><a href="#7778"> 7778: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Direction /R2L'</span>;
</span><span id="7779" class="l"><a href="#7779"> 7779: </a>            } <span class="php-keyword1">else</span> {
</span><span id="7780" class="l"><a href="#7780"> 7780: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Direction /L2R'</span>;
</span><span id="7781" class="l"><a href="#7781"> 7781: </a>            }
</span><span id="7782" class="l"><a href="#7782"> 7782: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'HideToolbar'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'HideToolbar'</span>])) {
</span><span id="7783" class="l"><a href="#7783"> 7783: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /HideToolbar true'</span>;
</span><span id="7784" class="l"><a href="#7784"> 7784: </a>            }
</span><span id="7785" class="l"><a href="#7785"> 7785: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'HideMenubar'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'HideMenubar'</span>])) {
</span><span id="7786" class="l"><a href="#7786"> 7786: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /HideMenubar true'</span>;
</span><span id="7787" class="l"><a href="#7787"> 7787: </a>            }
</span><span id="7788" class="l"><a href="#7788"> 7788: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'HideWindowUI'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'HideWindowUI'</span>])) {
</span><span id="7789" class="l"><a href="#7789"> 7789: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /HideWindowUI true'</span>;
</span><span id="7790" class="l"><a href="#7790"> 7790: </a>            }
</span><span id="7791" class="l"><a href="#7791"> 7791: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'FitWindow'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'FitWindow'</span>])) {
</span><span id="7792" class="l"><a href="#7792"> 7792: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /FitWindow true'</span>;
</span><span id="7793" class="l"><a href="#7793"> 7793: </a>            }
</span><span id="7794" class="l"><a href="#7794"> 7794: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'CenterWindow'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'CenterWindow'</span>])) {
</span><span id="7795" class="l"><a href="#7795"> 7795: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /CenterWindow true'</span>;
</span><span id="7796" class="l"><a href="#7796"> 7796: </a>            }
</span><span id="7797" class="l"><a href="#7797"> 7797: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'DisplayDocTitle'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'DisplayDocTitle'</span>])) {
</span><span id="7798" class="l"><a href="#7798"> 7798: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /DisplayDocTitle true'</span>;
</span><span id="7799" class="l"><a href="#7799"> 7799: </a>            }
</span><span id="7800" class="l"><a href="#7800"> 7800: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'NonFullScreenPageMode'</span>])) {
</span><span id="7801" class="l"><a href="#7801"> 7801: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /NonFullScreenPageMode /'</span>.<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'NonFullScreenPageMode'</span>];
</span><span id="7802" class="l"><a href="#7802"> 7802: </a>            }
</span><span id="7803" class="l"><a href="#7803"> 7803: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'ViewArea'</span>])) {
</span><span id="7804" class="l"><a href="#7804"> 7804: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /ViewArea /'</span>.<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'ViewArea'</span>];
</span><span id="7805" class="l"><a href="#7805"> 7805: </a>            }
</span><span id="7806" class="l"><a href="#7806"> 7806: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'ViewClip'</span>])) {
</span><span id="7807" class="l"><a href="#7807"> 7807: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /ViewClip /'</span>.<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'ViewClip'</span>];
</span><span id="7808" class="l"><a href="#7808"> 7808: </a>            }
</span><span id="7809" class="l"><a href="#7809"> 7809: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintArea'</span>])) {
</span><span id="7810" class="l"><a href="#7810"> 7810: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /PrintArea /'</span>.<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintArea'</span>];
</span><span id="7811" class="l"><a href="#7811"> 7811: </a>            }
</span><span id="7812" class="l"><a href="#7812"> 7812: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintClip'</span>])) {
</span><span id="7813" class="l"><a href="#7813"> 7813: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /PrintClip /'</span>.<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintClip'</span>];
</span><span id="7814" class="l"><a href="#7814"> 7814: </a>            }
</span><span id="7815" class="l"><a href="#7815"> 7815: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintScaling'</span>])) {
</span><span id="7816" class="l"><a href="#7816"> 7816: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /PrintScaling /'</span>.<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintScaling'</span>];
</span><span id="7817" class="l"><a href="#7817"> 7817: </a>            }
</span><span id="7818" class="l"><a href="#7818"> 7818: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'Duplex'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'Duplex'</span>]))) {
</span><span id="7819" class="l"><a href="#7819"> 7819: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Duplex /'</span>.<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'Duplex'</span>];
</span><span id="7820" class="l"><a href="#7820"> 7820: </a>            }
</span><span id="7821" class="l"><a href="#7821"> 7821: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PickTrayByPDFSize'</span>])) {
</span><span id="7822" class="l"><a href="#7822"> 7822: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PickTrayByPDFSize'</span>]) {
</span><span id="7823" class="l"><a href="#7823"> 7823: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /PickTrayByPDFSize true'</span>;
</span><span id="7824" class="l"><a href="#7824"> 7824: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7825" class="l"><a href="#7825"> 7825: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /PickTrayByPDFSize false'</span>;
</span><span id="7826" class="l"><a href="#7826"> 7826: </a>                }
</span><span id="7827" class="l"><a href="#7827"> 7827: </a>            }
</span><span id="7828" class="l"><a href="#7828"> 7828: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintPageRange'</span>])) {
</span><span id="7829" class="l"><a href="#7829"> 7829: </a>                <span class="php-var">$PrintPageRangeNum</span> = <span class="php-quote">''</span>;
</span><span id="7830" class="l"><a href="#7830"> 7830: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'PrintPageRange'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$v</span>) {
</span><span id="7831" class="l"><a href="#7831"> 7831: </a>                    <span class="php-var">$PrintPageRangeNum</span> .= <span class="php-quote">' '</span>.(<span class="php-var">$v</span> - <span class="php-num">1</span>).<span class="php-quote">''</span>;
</span><span id="7832" class="l"><a href="#7832"> 7832: </a>                }
</span><span id="7833" class="l"><a href="#7833"> 7833: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /PrintPageRange ['</span>.<span class="php-keyword2">substr</span>(<span class="php-var">$PrintPageRangeNum</span>,<span class="php-num">1</span>).<span class="php-quote">']'</span>;
</span><span id="7834" class="l"><a href="#7834"> 7834: </a>            }
</span><span id="7835" class="l"><a href="#7835"> 7835: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'NumCopies'</span>])) {
</span><span id="7836" class="l"><a href="#7836"> 7836: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /NumCopies '</span>.<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;viewer_preferences[<span class="php-quote">'NumCopies'</span>]);
</span><span id="7837" class="l"><a href="#7837"> 7837: </a>            }
</span><span id="7838" class="l"><a href="#7838"> 7838: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7839" class="l"><a href="#7839"> 7839: </a>            <span class="php-keyword1">return</span> <span class="php-var">$out</span>;
</span><span id="7840" class="l"><a href="#7840"> 7840: </a>        }
</span><span id="7841" class="l"><a href="#7841"> 7841: </a>
</span><span id="7842" class="l"><a href="#7842"> 7842: </a>        <span class="php-comment">/**
</span></span><span id="7843" class="l"><a href="#7843"> 7843: </a><span class="php-comment">         * Output trailer.
</span></span><span id="7844" class="l"><a href="#7844"> 7844: </a><span class="php-comment">         * @access protected
</span></span><span id="7845" class="l"><a href="#7845"> 7845: </a><span class="php-comment">         */</span>
</span><span id="7846" class="l"><a href="#7846"> 7846: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _puttrailer() {
</span><span id="7847" class="l"><a href="#7847"> 7847: </a>            <span class="php-var">$out</span> = <span class="php-quote">'trailer &lt;&lt;'</span>;
</span><span id="7848" class="l"><a href="#7848"> 7848: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Size '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>);
</span><span id="7849" class="l"><a href="#7849"> 7849: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Root '</span>.<span class="php-var">$this</span>-&gt;n.<span class="php-quote">' 0 R'</span>;
</span><span id="7850" class="l"><a href="#7850"> 7850: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Info '</span>.(<span class="php-var">$this</span>-&gt;n - <span class="php-num">1</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="7851" class="l"><a href="#7851"> 7851: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;encrypted) {
</span><span id="7852" class="l"><a href="#7852"> 7852: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Encrypt '</span>.<span class="php-var">$this</span>-&gt;enc_obj_id.<span class="php-quote">' 0 R'</span>;
</span><span id="7853" class="l"><a href="#7853"> 7853: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /ID [()()]'</span>;
</span><span id="7854" class="l"><a href="#7854"> 7854: </a>            }
</span><span id="7855" class="l"><a href="#7855"> 7855: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="7856" class="l"><a href="#7856"> 7856: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7857" class="l"><a href="#7857"> 7857: </a>        }
</span><span id="7858" class="l"><a href="#7858"> 7858: </a>
</span><span id="7859" class="l"><a href="#7859"> 7859: </a>        <span class="php-comment">/**
</span></span><span id="7860" class="l"><a href="#7860"> 7860: </a><span class="php-comment">         * Output PDF header.
</span></span><span id="7861" class="l"><a href="#7861"> 7861: </a><span class="php-comment">         * @access protected
</span></span><span id="7862" class="l"><a href="#7862"> 7862: </a><span class="php-comment">         */</span>
</span><span id="7863" class="l"><a href="#7863"> 7863: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putheader() {
</span><span id="7864" class="l"><a href="#7864"> 7864: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'%PDF-'</span>.<span class="php-var">$this</span>-&gt;PDFVersion);
</span><span id="7865" class="l"><a href="#7865"> 7865: </a>        }
</span><span id="7866" class="l"><a href="#7866"> 7866: </a>
</span><span id="7867" class="l"><a href="#7867"> 7867: </a>        <span class="php-comment">/**
</span></span><span id="7868" class="l"><a href="#7868"> 7868: </a><span class="php-comment">         * Output end of document (EOF).
</span></span><span id="7869" class="l"><a href="#7869"> 7869: </a><span class="php-comment">         * @access protected
</span></span><span id="7870" class="l"><a href="#7870"> 7870: </a><span class="php-comment">         */</span>
</span><span id="7871" class="l"><a href="#7871"> 7871: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _enddoc() {
</span><span id="7872" class="l"><a href="#7872"> 7872: </a>            <span class="php-var">$this</span>-&gt;state = <span class="php-num">1</span>;
</span><span id="7873" class="l"><a href="#7873"> 7873: </a>            <span class="php-var">$this</span>-&gt;_putheader();
</span><span id="7874" class="l"><a href="#7874"> 7874: </a>            <span class="php-var">$this</span>-&gt;_putpages();
</span><span id="7875" class="l"><a href="#7875"> 7875: </a>            <span class="php-var">$this</span>-&gt;_putresources();
</span><span id="7876" class="l"><a href="#7876"> 7876: </a>            <span class="php-comment">// Signature</span>
</span><span id="7877" class="l"><a href="#7877"> 7877: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;sign <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>])) {
</span><span id="7878" class="l"><a href="#7878"> 7878: </a>                <span class="php-comment">// widget annotation for signature</span>
</span><span id="7879" class="l"><a href="#7879"> 7879: </a>                <span class="php-var">$this</span>-&gt;sig_obj_id = <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="7880" class="l"><a href="#7880"> 7880: </a>                <span class="php-comment">// --- replace signature ID on the first page ---</span>
</span><span id="7881" class="l"><a href="#7881"> 7881: </a>                <span class="php-comment">// get the document content</span>
</span><span id="7882" class="l"><a href="#7882"> 7882: </a>                <span class="php-var">$pdfdoc</span> = <span class="php-var">$this</span>-&gt;getBuffer();
</span><span id="7883" class="l"><a href="#7883"> 7883: </a>                <span class="php-comment">// Remove the original buffer</span>
</span><span id="7884" class="l"><a href="#7884"> 7884: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;diskcache) <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="7885" class="l"><a href="#7885"> 7885: </a>                    <span class="php-comment">// remove buffer file from cache</span>
</span><span id="7886" class="l"><a href="#7886"> 7886: </a>                    <span class="php-keyword2">unlink</span>(<span class="php-var">$this</span>-&gt;buffer);
</span><span id="7887" class="l"><a href="#7887"> 7887: </a>                }
</span><span id="7888" class="l"><a href="#7888"> 7888: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;buffer);
</span><span id="7889" class="l"><a href="#7889"> 7889: </a>                <span class="php-var">$signature_widget_ref</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%u 0 R'</span>, <span class="php-var">$this</span>-&gt;sig_obj_id);
</span><span id="7890" class="l"><a href="#7890"> 7890: </a>                <span class="php-var">$signature_widget_ref</span> .= <span class="php-keyword2">str_repeat</span>(<span class="php-quote">' '</span>, (<span class="php-keyword2">strlen</span>(<span class="php-var">$this</span>-&gt;sig_annot_ref) - <span class="php-keyword2">strlen</span>(<span class="php-var">$signature_widget_ref</span>)));
</span><span id="7891" class="l"><a href="#7891"> 7891: </a>                <span class="php-var">$pdfdoc</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$this</span>-&gt;sig_annot_ref, <span class="php-var">$signature_widget_ref</span>, <span class="php-var">$pdfdoc</span>);
</span><span id="7892" class="l"><a href="#7892"> 7892: </a>                <span class="php-var">$this</span>-&gt;diskcache = <span class="php-keyword1">false</span>;
</span><span id="7893" class="l"><a href="#7893"> 7893: </a>                <span class="php-var">$this</span>-&gt;buffer = &amp;<span class="php-var">$pdfdoc</span>;
</span><span id="7894" class="l"><a href="#7894"> 7894: </a>                <span class="php-var">$this</span>-&gt;bufferlen = <span class="php-keyword2">strlen</span>(<span class="php-var">$pdfdoc</span>);
</span><span id="7895" class="l"><a href="#7895"> 7895: </a>                <span class="php-comment">// ---</span>
</span><span id="7896" class="l"><a href="#7896"> 7896: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /Annot /Subtype /Widget /Rect [0 0 0 0]'</span>;
</span><span id="7897" class="l"><a href="#7897"> 7897: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /P 3 0 R'</span>; <span class="php-comment">// link to first page object</span>
</span><span id="7898" class="l"><a href="#7898"> 7898: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /FT /Sig'</span>;
</span><span id="7899" class="l"><a href="#7899"> 7899: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /T '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-quote">'Signature'</span>);
</span><span id="7900" class="l"><a href="#7900"> 7900: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Ff 0'</span>;
</span><span id="7901" class="l"><a href="#7901"> 7901: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /V '</span>.(<span class="php-var">$this</span>-&gt;sig_obj_id + <span class="php-num">1</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="7902" class="l"><a href="#7902"> 7902: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="7903" class="l"><a href="#7903"> 7903: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="7904" class="l"><a href="#7904"> 7904: </a>                <span class="php-comment">// signature</span>
</span><span id="7905" class="l"><a href="#7905"> 7905: </a>                <span class="php-var">$this</span>-&gt;_putsignature();
</span><span id="7906" class="l"><a href="#7906"> 7906: </a>            }
</span><span id="7907" class="l"><a href="#7907"> 7907: </a>            <span class="php-comment">// Info</span>
</span><span id="7908" class="l"><a href="#7908"> 7908: </a>            <span class="php-var">$this</span>-&gt;_putinfo();
</span><span id="7909" class="l"><a href="#7909"> 7909: </a>            <span class="php-comment">// Catalog</span>
</span><span id="7910" class="l"><a href="#7910"> 7910: </a>            <span class="php-var">$this</span>-&gt;_putcatalog();
</span><span id="7911" class="l"><a href="#7911"> 7911: </a>            <span class="php-comment">// Cross-ref</span>
</span><span id="7912" class="l"><a href="#7912"> 7912: </a>            <span class="php-var">$o</span> = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="7913" class="l"><a href="#7913"> 7913: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'xref'</span>);
</span><span id="7914" class="l"><a href="#7914"> 7914: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'0 '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>));
</span><span id="7915" class="l"><a href="#7915"> 7915: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'0000000000 65535 f '</span>);
</span><span id="7916" class="l"><a href="#7916"> 7916: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">1</span>; <span class="php-var">$i</span> &lt;= <span class="php-var">$this</span>-&gt;n; ++<span class="php-var">$i</span>) {
</span><span id="7917" class="l"><a href="#7917"> 7917: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%010d 00000 n '</span>, <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$i</span>]));
</span><span id="7918" class="l"><a href="#7918"> 7918: </a>            }
</span><span id="7919" class="l"><a href="#7919"> 7919: </a>            <span class="php-comment">// Embedded Files</span>
</span><span id="7920" class="l"><a href="#7920"> 7920: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;embeddedfiles) <span class="php-keyword1">AND</span> <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;embeddedfiles) &gt; <span class="php-num">0</span>) {
</span><span id="7921" class="l"><a href="#7921"> 7921: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;embedded_start_obj_id.<span class="php-quote">' '</span>.<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;embeddedfiles));
</span><span id="7922" class="l"><a href="#7922"> 7922: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;embeddedfiles <span class="php-keyword1">as</span> <span class="php-var">$filename</span> =&gt; <span class="php-var">$filedata</span>) {
</span><span id="7923" class="l"><a href="#7923"> 7923: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%010d 00000 n '</span>, <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$filedata</span>[<span class="php-quote">'n'</span>]]));
</span><span id="7924" class="l"><a href="#7924"> 7924: </a>                }
</span><span id="7925" class="l"><a href="#7925"> 7925: </a>            }
</span><span id="7926" class="l"><a href="#7926"> 7926: </a>            <span class="php-comment">// Annotation Objects</span>
</span><span id="7927" class="l"><a href="#7927"> 7927: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;annot_obj_id &gt; <span class="php-var">$this</span>-&gt;annots_start_obj_id) {
</span><span id="7928" class="l"><a href="#7928"> 7928: </a>                <span class="php-var">$this</span>-&gt;_out((<span class="php-var">$this</span>-&gt;annots_start_obj_id + <span class="php-num">1</span>).<span class="php-quote">' '</span>.(<span class="php-var">$this</span>-&gt;annot_obj_id - <span class="php-var">$this</span>-&gt;annots_start_obj_id));
</span><span id="7929" class="l"><a href="#7929"> 7929: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = (<span class="php-var">$this</span>-&gt;annots_start_obj_id + <span class="php-num">1</span>); <span class="php-var">$i</span> &lt;= <span class="php-var">$this</span>-&gt;annot_obj_id; ++<span class="php-var">$i</span>) {
</span><span id="7930" class="l"><a href="#7930"> 7930: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%010d 00000 n '</span>, <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$i</span>]));
</span><span id="7931" class="l"><a href="#7931"> 7931: </a>                }
</span><span id="7932" class="l"><a href="#7932"> 7932: </a>            }
</span><span id="7933" class="l"><a href="#7933"> 7933: </a>            <span class="php-comment">// Javascript Objects</span>
</span><span id="7934" class="l"><a href="#7934"> 7934: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;js_obj_id &gt; <span class="php-var">$this</span>-&gt;js_start_obj_id) {
</span><span id="7935" class="l"><a href="#7935"> 7935: </a>                <span class="php-var">$this</span>-&gt;_out((<span class="php-var">$this</span>-&gt;js_start_obj_id + <span class="php-num">1</span>).<span class="php-quote">' '</span>.(<span class="php-var">$this</span>-&gt;js_obj_id - <span class="php-var">$this</span>-&gt;js_start_obj_id));
</span><span id="7936" class="l"><a href="#7936"> 7936: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = (<span class="php-var">$this</span>-&gt;js_start_obj_id + <span class="php-num">1</span>); <span class="php-var">$i</span> &lt;= <span class="php-var">$this</span>-&gt;js_obj_id; ++<span class="php-var">$i</span>) {
</span><span id="7937" class="l"><a href="#7937"> 7937: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%010d 00000 n '</span>, <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$i</span>]));
</span><span id="7938" class="l"><a href="#7938"> 7938: </a>                }
</span><span id="7939" class="l"><a href="#7939"> 7939: </a>            }
</span><span id="7940" class="l"><a href="#7940"> 7940: </a>            <span class="php-comment">// Appearance streams XObjects</span>
</span><span id="7941" class="l"><a href="#7941"> 7941: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;apxo_obj_id &gt; <span class="php-var">$this</span>-&gt;apxo_start_obj_id) {
</span><span id="7942" class="l"><a href="#7942"> 7942: </a>                <span class="php-var">$this</span>-&gt;_out((<span class="php-var">$this</span>-&gt;apxo_start_obj_id + <span class="php-num">1</span>).<span class="php-quote">' '</span>.(<span class="php-var">$this</span>-&gt;apxo_obj_id - <span class="php-var">$this</span>-&gt;apxo_start_obj_id));
</span><span id="7943" class="l"><a href="#7943"> 7943: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = (<span class="php-var">$this</span>-&gt;apxo_start_obj_id + <span class="php-num">1</span>); <span class="php-var">$i</span> &lt;= <span class="php-var">$this</span>-&gt;apxo_obj_id; ++<span class="php-var">$i</span>) {
</span><span id="7944" class="l"><a href="#7944"> 7944: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%010d 00000 n '</span>, <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$i</span>]));
</span><span id="7945" class="l"><a href="#7945"> 7945: </a>                }
</span><span id="7946" class="l"><a href="#7946"> 7946: </a>            }
</span><span id="7947" class="l"><a href="#7947"> 7947: </a>            <span class="php-comment">//Trailer</span>
</span><span id="7948" class="l"><a href="#7948"> 7948: </a>            <span class="php-var">$this</span>-&gt;_puttrailer();
</span><span id="7949" class="l"><a href="#7949"> 7949: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'startxref'</span>);
</span><span id="7950" class="l"><a href="#7950"> 7950: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$o</span>);
</span><span id="7951" class="l"><a href="#7951"> 7951: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'%%EOF'</span>);
</span><span id="7952" class="l"><a href="#7952"> 7952: </a>            <span class="php-var">$this</span>-&gt;state = <span class="php-num">3</span>; <span class="php-comment">// end-of-doc</span>
</span><span id="7953" class="l"><a href="#7953"> 7953: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="7954" class="l"><a href="#7954"> 7954: </a>                <span class="php-comment">// remove temporary files used for images</span>
</span><span id="7955" class="l"><a href="#7955"> 7955: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;imagekeys <span class="php-keyword1">as</span> <span class="php-var">$key</span>) {
</span><span id="7956" class="l"><a href="#7956"> 7956: </a>                    <span class="php-comment">// remove temporary files</span>
</span><span id="7957" class="l"><a href="#7957"> 7957: </a>                    <span class="php-keyword2">unlink</span>(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$key</span>]);
</span><span id="7958" class="l"><a href="#7958"> 7958: </a>                }
</span><span id="7959" class="l"><a href="#7959"> 7959: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;fontkeys <span class="php-keyword1">as</span> <span class="php-var">$key</span>) {
</span><span id="7960" class="l"><a href="#7960"> 7960: </a>                    <span class="php-comment">// remove temporary files</span>
</span><span id="7961" class="l"><a href="#7961"> 7961: </a>                    <span class="php-keyword2">unlink</span>(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$key</span>]);
</span><span id="7962" class="l"><a href="#7962"> 7962: </a>                }
</span><span id="7963" class="l"><a href="#7963"> 7963: </a>            }
</span><span id="7964" class="l"><a href="#7964"> 7964: </a>        }
</span><span id="7965" class="l"><a href="#7965"> 7965: </a>
</span><span id="7966" class="l"><a href="#7966"> 7966: </a>        <span class="php-comment">/**
</span></span><span id="7967" class="l"><a href="#7967"> 7967: </a><span class="php-comment">         * Initialize a new page.
</span></span><span id="7968" class="l"><a href="#7968"> 7968: </a><span class="php-comment">         * @param string $orientation page orientation. Possible values are (case insensitive):&lt;ul&gt;&lt;li&gt;P or PORTRAIT (default)&lt;/li&gt;&lt;li&gt;L or LANDSCAPE&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="7969" class="l"><a href="#7969"> 7969: </a><span class="php-comment">         * @param mixed $format The format used for pages. It can be either one of the following values (case insensitive) or a custom format in the form of a two-element array containing the width and the height (expressed in the unit given by unit).&lt;ul&gt;&lt;li&gt;4A0&lt;/li&gt;&lt;li&gt;2A0&lt;/li&gt;&lt;li&gt;A0&lt;/li&gt;&lt;li&gt;A1&lt;/li&gt;&lt;li&gt;A2&lt;/li&gt;&lt;li&gt;A3&lt;/li&gt;&lt;li&gt;A4 (default)&lt;/li&gt;&lt;li&gt;A5&lt;/li&gt;&lt;li&gt;A6&lt;/li&gt;&lt;li&gt;A7&lt;/li&gt;&lt;li&gt;A8&lt;/li&gt;&lt;li&gt;A9&lt;/li&gt;&lt;li&gt;A10&lt;/li&gt;&lt;li&gt;B0&lt;/li&gt;&lt;li&gt;B1&lt;/li&gt;&lt;li&gt;B2&lt;/li&gt;&lt;li&gt;B3&lt;/li&gt;&lt;li&gt;B4&lt;/li&gt;&lt;li&gt;B5&lt;/li&gt;&lt;li&gt;B6&lt;/li&gt;&lt;li&gt;B7&lt;/li&gt;&lt;li&gt;B8&lt;/li&gt;&lt;li&gt;B9&lt;/li&gt;&lt;li&gt;B10&lt;/li&gt;&lt;li&gt;C0&lt;/li&gt;&lt;li&gt;C1&lt;/li&gt;&lt;li&gt;C2&lt;/li&gt;&lt;li&gt;C3&lt;/li&gt;&lt;li&gt;C4&lt;/li&gt;&lt;li&gt;C5&lt;/li&gt;&lt;li&gt;C6&lt;/li&gt;&lt;li&gt;C7&lt;/li&gt;&lt;li&gt;C8&lt;/li&gt;&lt;li&gt;C9&lt;/li&gt;&lt;li&gt;C10&lt;/li&gt;&lt;li&gt;RA0&lt;/li&gt;&lt;li&gt;RA1&lt;/li&gt;&lt;li&gt;RA2&lt;/li&gt;&lt;li&gt;RA3&lt;/li&gt;&lt;li&gt;RA4&lt;/li&gt;&lt;li&gt;SRA0&lt;/li&gt;&lt;li&gt;SRA1&lt;/li&gt;&lt;li&gt;SRA2&lt;/li&gt;&lt;li&gt;SRA3&lt;/li&gt;&lt;li&gt;SRA4&lt;/li&gt;&lt;li&gt;LETTER&lt;/li&gt;&lt;li&gt;LEGAL&lt;/li&gt;&lt;li&gt;EXECUTIVE&lt;/li&gt;&lt;li&gt;FOLIO&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="7970" class="l"><a href="#7970"> 7970: </a><span class="php-comment">         * @access protected
</span></span><span id="7971" class="l"><a href="#7971"> 7971: </a><span class="php-comment">         */</span>
</span><span id="7972" class="l"><a href="#7972"> 7972: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _beginpage(<span class="php-var">$orientation</span>=<span class="php-quote">''</span>, <span class="php-var">$format</span>=<span class="php-quote">''</span>) {
</span><span id="7973" class="l"><a href="#7973"> 7973: </a>            ++<span class="php-var">$this</span>-&gt;page;
</span><span id="7974" class="l"><a href="#7974"> 7974: </a>            <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-quote">''</span>);
</span><span id="7975" class="l"><a href="#7975"> 7975: </a>            <span class="php-comment">// initialize array for graphics tranformation positions inside a page buffer</span>
</span><span id="7976" class="l"><a href="#7976"> 7976: </a>            <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page] = <span class="php-keyword1">array</span>();
</span><span id="7977" class="l"><a href="#7977"> 7977: </a>            <span class="php-var">$this</span>-&gt;state = <span class="php-num">2</span>;
</span><span id="7978" class="l"><a href="#7978"> 7978: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$orientation</span>)) {
</span><span id="7979" class="l"><a href="#7979"> 7979: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;CurOrientation)) {
</span><span id="7980" class="l"><a href="#7980"> 7980: </a>                    <span class="php-var">$orientation</span> = <span class="php-var">$this</span>-&gt;CurOrientation;
</span><span id="7981" class="l"><a href="#7981"> 7981: </a>                } <span class="php-keyword1">else</span> {
</span><span id="7982" class="l"><a href="#7982"> 7982: </a>                    <span class="php-var">$orientation</span> = <span class="php-quote">'P'</span>;
</span><span id="7983" class="l"><a href="#7983"> 7983: </a>                }
</span><span id="7984" class="l"><a href="#7984"> 7984: </a>            }
</span><span id="7985" class="l"><a href="#7985"> 7985: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$format</span>)) {
</span><span id="7986" class="l"><a href="#7986"> 7986: </a>                <span class="php-var">$this</span>-&gt;setPageOrientation(<span class="php-var">$orientation</span>);
</span><span id="7987" class="l"><a href="#7987"> 7987: </a>            } <span class="php-keyword1">else</span> {
</span><span id="7988" class="l"><a href="#7988"> 7988: </a>                <span class="php-var">$this</span>-&gt;setPageFormat(<span class="php-var">$format</span>, <span class="php-var">$orientation</span>);
</span><span id="7989" class="l"><a href="#7989"> 7989: </a>            }
</span><span id="7990" class="l"><a href="#7990"> 7990: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="7991" class="l"><a href="#7991"> 7991: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="7992" class="l"><a href="#7992"> 7992: </a>            } <span class="php-keyword1">else</span> {
</span><span id="7993" class="l"><a href="#7993"> 7993: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="7994" class="l"><a href="#7994"> 7994: </a>            }
</span><span id="7995" class="l"><a href="#7995"> 7995: </a>            <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="7996" class="l"><a href="#7996"> 7996: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="7997" class="l"><a href="#7997"> 7997: </a>                <span class="php-comment">// start a new group</span>
</span><span id="7998" class="l"><a href="#7998"> 7998: </a>                <span class="php-var">$n</span> = <span class="php-keyword2">sizeof</span>(<span class="php-var">$this</span>-&gt;pagegroups) + <span class="php-num">1</span>;
</span><span id="7999" class="l"><a href="#7999"> 7999: </a>                <span class="php-var">$alias</span> = <span class="php-quote">'{nb'</span>.<span class="php-var">$n</span>.<span class="php-quote">'}'</span>;
</span><span id="8000" class="l"><a href="#8000"> 8000: </a>                <span class="php-var">$this</span>-&gt;pagegroups[<span class="php-var">$alias</span>] = <span class="php-num">1</span>;
</span><span id="8001" class="l"><a href="#8001"> 8001: </a>                <span class="php-var">$this</span>-&gt;currpagegroup = <span class="php-var">$alias</span>;
</span><span id="8002" class="l"><a href="#8002"> 8002: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;currpagegroup) {
</span><span id="8003" class="l"><a href="#8003"> 8003: </a>                ++<span class="php-var">$this</span>-&gt;pagegroups[<span class="php-var">$this</span>-&gt;currpagegroup];
</span><span id="8004" class="l"><a href="#8004"> 8004: </a>            }
</span><span id="8005" class="l"><a href="#8005"> 8005: </a>        }
</span><span id="8006" class="l"><a href="#8006"> 8006: </a>
</span><span id="8007" class="l"><a href="#8007"> 8007: </a>        <span class="php-comment">/**
</span></span><span id="8008" class="l"><a href="#8008"> 8008: </a><span class="php-comment">         * Mark end of page.
</span></span><span id="8009" class="l"><a href="#8009"> 8009: </a><span class="php-comment">         * @access protected
</span></span><span id="8010" class="l"><a href="#8010"> 8010: </a><span class="php-comment">         */</span>
</span><span id="8011" class="l"><a href="#8011"> 8011: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _endpage() {
</span><span id="8012" class="l"><a href="#8012"> 8012: </a>            <span class="php-var">$this</span>-&gt;setVisibility(<span class="php-quote">'all'</span>);
</span><span id="8013" class="l"><a href="#8013"> 8013: </a>            <span class="php-var">$this</span>-&gt;state = <span class="php-num">1</span>;
</span><span id="8014" class="l"><a href="#8014"> 8014: </a>        }
</span><span id="8015" class="l"><a href="#8015"> 8015: </a>
</span><span id="8016" class="l"><a href="#8016"> 8016: </a>        <span class="php-comment">/**
</span></span><span id="8017" class="l"><a href="#8017"> 8017: </a><span class="php-comment">         * Begin a new object and return the object number.
</span></span><span id="8018" class="l"><a href="#8018"> 8018: </a><span class="php-comment">         * @return int object number
</span></span><span id="8019" class="l"><a href="#8019"> 8019: </a><span class="php-comment">         * @access protected
</span></span><span id="8020" class="l"><a href="#8020"> 8020: </a><span class="php-comment">         */</span>
</span><span id="8021" class="l"><a href="#8021"> 8021: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _newobj() {
</span><span id="8022" class="l"><a href="#8022"> 8022: </a>            ++<span class="php-var">$this</span>-&gt;n;
</span><span id="8023" class="l"><a href="#8023"> 8023: </a>            <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$this</span>-&gt;n] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="8024" class="l"><a href="#8024"> 8024: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;n.<span class="php-quote">' 0 obj'</span>);
</span><span id="8025" class="l"><a href="#8025"> 8025: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;n;
</span><span id="8026" class="l"><a href="#8026"> 8026: </a>        }
</span><span id="8027" class="l"><a href="#8027"> 8027: </a>
</span><span id="8028" class="l"><a href="#8028"> 8028: </a>        <span class="php-comment">/**
</span></span><span id="8029" class="l"><a href="#8029"> 8029: </a><span class="php-comment">         * Underline text.
</span></span><span id="8030" class="l"><a href="#8030"> 8030: </a><span class="php-comment">         * @param int $x X coordinate
</span></span><span id="8031" class="l"><a href="#8031"> 8031: </a><span class="php-comment">         * @param int $y Y coordinate
</span></span><span id="8032" class="l"><a href="#8032"> 8032: </a><span class="php-comment">         * @param string $txt text to underline
</span></span><span id="8033" class="l"><a href="#8033"> 8033: </a><span class="php-comment">         * @access protected
</span></span><span id="8034" class="l"><a href="#8034"> 8034: </a><span class="php-comment">         */</span>
</span><span id="8035" class="l"><a href="#8035"> 8035: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dounderline(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$txt</span>) {
</span><span id="8036" class="l"><a href="#8036"> 8036: </a>            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$txt</span>);
</span><span id="8037" class="l"><a href="#8037"> 8037: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_dounderlinew(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>);
</span><span id="8038" class="l"><a href="#8038"> 8038: </a>        }
</span><span id="8039" class="l"><a href="#8039"> 8039: </a>
</span><span id="8040" class="l"><a href="#8040"> 8040: </a>        <span class="php-comment">/**
</span></span><span id="8041" class="l"><a href="#8041"> 8041: </a><span class="php-comment">         * Underline for rectangular text area.
</span></span><span id="8042" class="l"><a href="#8042"> 8042: </a><span class="php-comment">         * @param int $x X coordinate
</span></span><span id="8043" class="l"><a href="#8043"> 8043: </a><span class="php-comment">         * @param int $y Y coordinate
</span></span><span id="8044" class="l"><a href="#8044"> 8044: </a><span class="php-comment">         * @param int $w width to underline
</span></span><span id="8045" class="l"><a href="#8045"> 8045: </a><span class="php-comment">         * @access protected
</span></span><span id="8046" class="l"><a href="#8046"> 8046: </a><span class="php-comment">         * @since 4.8.008 (2009-09-29)
</span></span><span id="8047" class="l"><a href="#8047"> 8047: </a><span class="php-comment">         */</span>
</span><span id="8048" class="l"><a href="#8048"> 8048: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dounderlinew(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>) {
</span><span id="8049" class="l"><a href="#8049"> 8049: </a>            <span class="php-var">$linew</span> = - <span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'ut'</span>] / <span class="php-num">1000</span> * <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="8050" class="l"><a href="#8050"> 8050: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F re f'</span>, <span class="php-var">$x</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span> + (<span class="php-var">$linew</span> / <span class="php-num">2</span>)) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$linew</span>);
</span><span id="8051" class="l"><a href="#8051"> 8051: </a>        }
</span><span id="8052" class="l"><a href="#8052"> 8052: </a>
</span><span id="8053" class="l"><a href="#8053"> 8053: </a>        <span class="php-comment">/**
</span></span><span id="8054" class="l"><a href="#8054"> 8054: </a><span class="php-comment">         * Line through text.
</span></span><span id="8055" class="l"><a href="#8055"> 8055: </a><span class="php-comment">         * @param int $x X coordinate
</span></span><span id="8056" class="l"><a href="#8056"> 8056: </a><span class="php-comment">         * @param int $y Y coordinate
</span></span><span id="8057" class="l"><a href="#8057"> 8057: </a><span class="php-comment">         * @param string $txt text to linethrough
</span></span><span id="8058" class="l"><a href="#8058"> 8058: </a><span class="php-comment">         * @access protected
</span></span><span id="8059" class="l"><a href="#8059"> 8059: </a><span class="php-comment">         */</span>
</span><span id="8060" class="l"><a href="#8060"> 8060: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dolinethrough(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$txt</span>) {
</span><span id="8061" class="l"><a href="#8061"> 8061: </a>            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$txt</span>);
</span><span id="8062" class="l"><a href="#8062"> 8062: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_dolinethroughw(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>);
</span><span id="8063" class="l"><a href="#8063"> 8063: </a>        }
</span><span id="8064" class="l"><a href="#8064"> 8064: </a>
</span><span id="8065" class="l"><a href="#8065"> 8065: </a>        <span class="php-comment">/**
</span></span><span id="8066" class="l"><a href="#8066"> 8066: </a><span class="php-comment">         * Line through for rectangular text area.
</span></span><span id="8067" class="l"><a href="#8067"> 8067: </a><span class="php-comment">         * @param int $x X coordinate
</span></span><span id="8068" class="l"><a href="#8068"> 8068: </a><span class="php-comment">         * @param int $y Y coordinate
</span></span><span id="8069" class="l"><a href="#8069"> 8069: </a><span class="php-comment">         * @param string $txt text to linethrough
</span></span><span id="8070" class="l"><a href="#8070"> 8070: </a><span class="php-comment">         * @access protected
</span></span><span id="8071" class="l"><a href="#8071"> 8071: </a><span class="php-comment">         * @since 4.9.008 (2009-09-29)
</span></span><span id="8072" class="l"><a href="#8072"> 8072: </a><span class="php-comment">         */</span>
</span><span id="8073" class="l"><a href="#8073"> 8073: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dolinethroughw(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>) {
</span><span id="8074" class="l"><a href="#8074"> 8074: </a>            <span class="php-var">$linew</span> = - <span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'ut'</span>] / <span class="php-num">1000</span> * <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="8075" class="l"><a href="#8075"> 8075: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F re f'</span>, <span class="php-var">$x</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span> + (<span class="php-var">$this</span>-&gt;FontSize / <span class="php-num">3</span>) + (<span class="php-var">$linew</span> / <span class="php-num">2</span>)) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$linew</span>);
</span><span id="8076" class="l"><a href="#8076"> 8076: </a>        }
</span><span id="8077" class="l"><a href="#8077"> 8077: </a>
</span><span id="8078" class="l"><a href="#8078"> 8078: </a>        <span class="php-comment">/**
</span></span><span id="8079" class="l"><a href="#8079"> 8079: </a><span class="php-comment">         * Overline text.
</span></span><span id="8080" class="l"><a href="#8080"> 8080: </a><span class="php-comment">         * @param int $x X coordinate
</span></span><span id="8081" class="l"><a href="#8081"> 8081: </a><span class="php-comment">         * @param int $y Y coordinate
</span></span><span id="8082" class="l"><a href="#8082"> 8082: </a><span class="php-comment">         * @param string $txt text to overline
</span></span><span id="8083" class="l"><a href="#8083"> 8083: </a><span class="php-comment">         * @access protected
</span></span><span id="8084" class="l"><a href="#8084"> 8084: </a><span class="php-comment">         * @since 4.9.015 (2010-04-19)
</span></span><span id="8085" class="l"><a href="#8085"> 8085: </a><span class="php-comment">         */</span>
</span><span id="8086" class="l"><a href="#8086"> 8086: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dooverline(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$txt</span>) {
</span><span id="8087" class="l"><a href="#8087"> 8087: </a>            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$txt</span>);
</span><span id="8088" class="l"><a href="#8088"> 8088: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_dooverlinew(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>);
</span><span id="8089" class="l"><a href="#8089"> 8089: </a>        }
</span><span id="8090" class="l"><a href="#8090"> 8090: </a>
</span><span id="8091" class="l"><a href="#8091"> 8091: </a>        <span class="php-comment">/**
</span></span><span id="8092" class="l"><a href="#8092"> 8092: </a><span class="php-comment">         * Overline for rectangular text area.
</span></span><span id="8093" class="l"><a href="#8093"> 8093: </a><span class="php-comment">         * @param int $x X coordinate
</span></span><span id="8094" class="l"><a href="#8094"> 8094: </a><span class="php-comment">         * @param int $y Y coordinate
</span></span><span id="8095" class="l"><a href="#8095"> 8095: </a><span class="php-comment">         * @param int $w width to overline
</span></span><span id="8096" class="l"><a href="#8096"> 8096: </a><span class="php-comment">         * @access protected
</span></span><span id="8097" class="l"><a href="#8097"> 8097: </a><span class="php-comment">         * @since 4.9.015 (2010-04-19)
</span></span><span id="8098" class="l"><a href="#8098"> 8098: </a><span class="php-comment">         */</span>
</span><span id="8099" class="l"><a href="#8099"> 8099: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dooverlinew(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>) {
</span><span id="8100" class="l"><a href="#8100"> 8100: </a>            <span class="php-var">$linew</span> = - <span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'ut'</span>] / <span class="php-num">1000</span> * <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="8101" class="l"><a href="#8101"> 8101: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F re f'</span>, <span class="php-var">$x</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span> + <span class="php-var">$this</span>-&gt;FontAscent - (<span class="php-var">$linew</span> / <span class="php-num">2</span>)) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$linew</span>);
</span><span id="8102" class="l"><a href="#8102"> 8102: </a>
</span><span id="8103" class="l"><a href="#8103"> 8103: </a>        }
</span><span id="8104" class="l"><a href="#8104"> 8104: </a>
</span><span id="8105" class="l"><a href="#8105"> 8105: </a>        <span class="php-comment">/**
</span></span><span id="8106" class="l"><a href="#8106"> 8106: </a><span class="php-comment">         * Read a 4-byte integer from file.
</span></span><span id="8107" class="l"><a href="#8107"> 8107: </a><span class="php-comment">         * @param string $f file name.
</span></span><span id="8108" class="l"><a href="#8108"> 8108: </a><span class="php-comment">         * @return 4-byte integer
</span></span><span id="8109" class="l"><a href="#8109"> 8109: </a><span class="php-comment">         * @access protected
</span></span><span id="8110" class="l"><a href="#8110"> 8110: </a><span class="php-comment">         */</span>
</span><span id="8111" class="l"><a href="#8111"> 8111: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _freadint(<span class="php-var">$f</span>) {
</span><span id="8112" class="l"><a href="#8112"> 8112: </a>            <span class="php-var">$a</span> = <span class="php-keyword2">unpack</span>(<span class="php-quote">'Ni'</span>, <span class="php-keyword2">fread</span>(<span class="php-var">$f</span>, <span class="php-num">4</span>));
</span><span id="8113" class="l"><a href="#8113"> 8113: </a>            <span class="php-keyword1">return</span> <span class="php-var">$a</span>[<span class="php-quote">'i'</span>];
</span><span id="8114" class="l"><a href="#8114"> 8114: </a>        }
</span><span id="8115" class="l"><a href="#8115"> 8115: </a>
</span><span id="8116" class="l"><a href="#8116"> 8116: </a>        <span class="php-comment">/**
</span></span><span id="8117" class="l"><a href="#8117"> 8117: </a><span class="php-comment">         * Add &quot;\&quot; before &quot;\&quot;, &quot;(&quot; and &quot;)&quot;
</span></span><span id="8118" class="l"><a href="#8118"> 8118: </a><span class="php-comment">         * @param string $s string to escape.
</span></span><span id="8119" class="l"><a href="#8119"> 8119: </a><span class="php-comment">         * @return string escaped string.
</span></span><span id="8120" class="l"><a href="#8120"> 8120: </a><span class="php-comment">         * @access protected
</span></span><span id="8121" class="l"><a href="#8121"> 8121: </a><span class="php-comment">         */</span>
</span><span id="8122" class="l"><a href="#8122"> 8122: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _escape(<span class="php-var">$s</span>) {
</span><span id="8123" class="l"><a href="#8123"> 8123: </a>            <span class="php-comment">// the chr(13) substitution fixes the Bugs item #1421290.</span>
</span><span id="8124" class="l"><a href="#8124"> 8124: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">strtr</span>(<span class="php-var">$s</span>, <span class="php-keyword1">array</span>(<span class="php-quote">')'</span> =&gt; <span class="php-quote">'\\)'</span>, <span class="php-quote">'('</span> =&gt; <span class="php-quote">'\\('</span>, <span class="php-quote">'\\'</span> =&gt; <span class="php-quote">'\\\\'</span>, <span class="php-keyword2">chr</span>(<span class="php-num">13</span>) =&gt; <span class="php-quote">'\r'</span>));
</span><span id="8125" class="l"><a href="#8125"> 8125: </a>        }
</span><span id="8126" class="l"><a href="#8126"> 8126: </a>
</span><span id="8127" class="l"><a href="#8127"> 8127: </a>        <span class="php-comment">/**
</span></span><span id="8128" class="l"><a href="#8128"> 8128: </a><span class="php-comment">         * Format a data string for meta information
</span></span><span id="8129" class="l"><a href="#8129"> 8129: </a><span class="php-comment">         * @param string $s data string to escape.
</span></span><span id="8130" class="l"><a href="#8130"> 8130: </a><span class="php-comment">         * @return string escaped string.
</span></span><span id="8131" class="l"><a href="#8131"> 8131: </a><span class="php-comment">         * @access protected
</span></span><span id="8132" class="l"><a href="#8132"> 8132: </a><span class="php-comment">         */</span>
</span><span id="8133" class="l"><a href="#8133"> 8133: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _datastring(<span class="php-var">$s</span>) {
</span><span id="8134" class="l"><a href="#8134"> 8134: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;encrypted) {
</span><span id="8135" class="l"><a href="#8135"> 8135: </a>                <span class="php-var">$s</span> = <span class="php-var">$this</span>-&gt;_RC4(<span class="php-var">$this</span>-&gt;_objectkey(<span class="php-var">$this</span>-&gt;n), <span class="php-var">$s</span>);
</span><span id="8136" class="l"><a href="#8136"> 8136: </a>            }
</span><span id="8137" class="l"><a href="#8137"> 8137: </a>            <span class="php-keyword1">return</span> <span class="php-quote">'('</span>. <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$s</span>).<span class="php-quote">')'</span>;
</span><span id="8138" class="l"><a href="#8138"> 8138: </a>        }
</span><span id="8139" class="l"><a href="#8139"> 8139: </a>
</span><span id="8140" class="l"><a href="#8140"> 8140: </a>        <span class="php-comment">/**
</span></span><span id="8141" class="l"><a href="#8141"> 8141: </a><span class="php-comment">         * Format a data string for annotation objects
</span></span><span id="8142" class="l"><a href="#8142"> 8142: </a><span class="php-comment">         * @param string $s data string to escape.
</span></span><span id="8143" class="l"><a href="#8143"> 8143: </a><span class="php-comment">         * @return string escaped string.
</span></span><span id="8144" class="l"><a href="#8144"> 8144: </a><span class="php-comment">         * @access protected
</span></span><span id="8145" class="l"><a href="#8145"> 8145: </a><span class="php-comment">         */</span>
</span><span id="8146" class="l"><a href="#8146"> 8146: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _dataannobjstring(<span class="php-var">$s</span>) {
</span><span id="8147" class="l"><a href="#8147"> 8147: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;encrypted) {
</span><span id="8148" class="l"><a href="#8148"> 8148: </a>                <span class="php-var">$s</span> = <span class="php-var">$this</span>-&gt;_RC4(<span class="php-var">$this</span>-&gt;_objectkey(<span class="php-var">$this</span>-&gt;annot_obj_id + <span class="php-num">1</span>), <span class="php-var">$s</span>);
</span><span id="8149" class="l"><a href="#8149"> 8149: </a>            }
</span><span id="8150" class="l"><a href="#8150"> 8150: </a>            <span class="php-keyword1">return</span> <span class="php-quote">'('</span>. <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$s</span>).<span class="php-quote">')'</span>;
</span><span id="8151" class="l"><a href="#8151"> 8151: </a>        }
</span><span id="8152" class="l"><a href="#8152"> 8152: </a>
</span><span id="8153" class="l"><a href="#8153"> 8153: </a>        <span class="php-comment">/**
</span></span><span id="8154" class="l"><a href="#8154"> 8154: </a><span class="php-comment">         * Returns a formatted date for meta information
</span></span><span id="8155" class="l"><a href="#8155"> 8155: </a><span class="php-comment">         * @return string escaped date string.
</span></span><span id="8156" class="l"><a href="#8156"> 8156: </a><span class="php-comment">         * @access protected
</span></span><span id="8157" class="l"><a href="#8157"> 8157: </a><span class="php-comment">         * @since 4.6.028 (2009-08-25)
</span></span><span id="8158" class="l"><a href="#8158"> 8158: </a><span class="php-comment">         */</span>
</span><span id="8159" class="l"><a href="#8159"> 8159: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _datestring() {
</span><span id="8160" class="l"><a href="#8160"> 8160: </a>            <span class="php-var">$current_time</span> = <span class="php-keyword2">substr_replace</span>(<span class="php-keyword2">date</span>(<span class="php-quote">'YmdHisO'</span>), <span class="php-quote">'\''</span>, (<span class="php-num">0</span> - <span class="php-num">2</span>), <span class="php-num">0</span>).<span class="php-quote">'\''</span>;
</span><span id="8161" class="l"><a href="#8161"> 8161: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_datastring(<span class="php-quote">'D:'</span>.<span class="php-var">$current_time</span>);
</span><span id="8162" class="l"><a href="#8162"> 8162: </a>        }
</span><span id="8163" class="l"><a href="#8163"> 8163: </a>
</span><span id="8164" class="l"><a href="#8164"> 8164: </a>        <span class="php-comment">/**
</span></span><span id="8165" class="l"><a href="#8165"> 8165: </a><span class="php-comment">         * Format a text string for meta information
</span></span><span id="8166" class="l"><a href="#8166"> 8166: </a><span class="php-comment">         * @param string $s string to escape.
</span></span><span id="8167" class="l"><a href="#8167"> 8167: </a><span class="php-comment">         * @return string escaped string.
</span></span><span id="8168" class="l"><a href="#8168"> 8168: </a><span class="php-comment">         * @access protected
</span></span><span id="8169" class="l"><a href="#8169"> 8169: </a><span class="php-comment">         */</span>
</span><span id="8170" class="l"><a href="#8170"> 8170: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _textstring(<span class="php-var">$s</span>) {
</span><span id="8171" class="l"><a href="#8171"> 8171: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="8172" class="l"><a href="#8172"> 8172: </a>                <span class="php-comment">//Convert string to UTF-16BE</span>
</span><span id="8173" class="l"><a href="#8173"> 8173: </a>                <span class="php-var">$s</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$s</span>, <span class="php-keyword1">true</span>);
</span><span id="8174" class="l"><a href="#8174"> 8174: </a>            }
</span><span id="8175" class="l"><a href="#8175"> 8175: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_datastring(<span class="php-var">$s</span>);
</span><span id="8176" class="l"><a href="#8176"> 8176: </a>        }
</span><span id="8177" class="l"><a href="#8177"> 8177: </a>
</span><span id="8178" class="l"><a href="#8178"> 8178: </a>        <span class="php-comment">/**
</span></span><span id="8179" class="l"><a href="#8179"> 8179: </a><span class="php-comment">         * Format a UTF-8 text string for meta information on annotations
</span></span><span id="8180" class="l"><a href="#8180"> 8180: </a><span class="php-comment">         * @param string $s string to escape.
</span></span><span id="8181" class="l"><a href="#8181"> 8181: </a><span class="php-comment">         * @return string escaped string.
</span></span><span id="8182" class="l"><a href="#8182"> 8182: </a><span class="php-comment">         * @access protected
</span></span><span id="8183" class="l"><a href="#8183"> 8183: </a><span class="php-comment">         */</span>
</span><span id="8184" class="l"><a href="#8184"> 8184: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _textannobjstring(<span class="php-var">$s</span>) {
</span><span id="8185" class="l"><a href="#8185"> 8185: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="8186" class="l"><a href="#8186"> 8186: </a>                <span class="php-comment">//Convert string to UTF-16BE</span>
</span><span id="8187" class="l"><a href="#8187"> 8187: </a>                <span class="php-var">$s</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$s</span>, <span class="php-keyword1">true</span>);
</span><span id="8188" class="l"><a href="#8188"> 8188: </a>            }
</span><span id="8189" class="l"><a href="#8189"> 8189: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_dataannobjstring(<span class="php-var">$s</span>);
</span><span id="8190" class="l"><a href="#8190"> 8190: </a>        }
</span><span id="8191" class="l"><a href="#8191"> 8191: </a>
</span><span id="8192" class="l"><a href="#8192"> 8192: </a>        <span class="php-comment">/**
</span></span><span id="8193" class="l"><a href="#8193"> 8193: </a><span class="php-comment">         * Format a text string
</span></span><span id="8194" class="l"><a href="#8194"> 8194: </a><span class="php-comment">         * @param string $s string to escape.
</span></span><span id="8195" class="l"><a href="#8195"> 8195: </a><span class="php-comment">         * @return string escaped string.
</span></span><span id="8196" class="l"><a href="#8196"> 8196: </a><span class="php-comment">         * @access protected
</span></span><span id="8197" class="l"><a href="#8197"> 8197: </a><span class="php-comment">         */</span>
</span><span id="8198" class="l"><a href="#8198"> 8198: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _escapetext(<span class="php-var">$s</span>) {
</span><span id="8199" class="l"><a href="#8199"> 8199: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="8200" class="l"><a href="#8200"> 8200: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'core'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueType'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'Type1'</span>)) {
</span><span id="8201" class="l"><a href="#8201"> 8201: </a>                    <span class="php-var">$s</span> = <span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$s</span>);
</span><span id="8202" class="l"><a href="#8202"> 8202: </a>                } <span class="php-keyword1">else</span> {
</span><span id="8203" class="l"><a href="#8203"> 8203: </a>                    <span class="php-comment">//Convert string to UTF-16BE and reverse RTL language</span>
</span><span id="8204" class="l"><a href="#8204"> 8204: </a>                    <span class="php-var">$s</span> = <span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$s</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl);
</span><span id="8205" class="l"><a href="#8205"> 8205: </a>                }
</span><span id="8206" class="l"><a href="#8206"> 8206: </a>            }
</span><span id="8207" class="l"><a href="#8207"> 8207: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$s</span>);
</span><span id="8208" class="l"><a href="#8208"> 8208: </a>        }
</span><span id="8209" class="l"><a href="#8209"> 8209: </a>
</span><span id="8210" class="l"><a href="#8210"> 8210: </a>        <span class="php-comment">/**
</span></span><span id="8211" class="l"><a href="#8211"> 8211: </a><span class="php-comment">         * Format output stream.
</span></span><span id="8212" class="l"><a href="#8212"> 8212: </a><span class="php-comment">         * @param string $s string to output.
</span></span><span id="8213" class="l"><a href="#8213"> 8213: </a><span class="php-comment">         * @param int $n object reference for encryption mode
</span></span><span id="8214" class="l"><a href="#8214"> 8214: </a><span class="php-comment">         * @access protected
</span></span><span id="8215" class="l"><a href="#8215"> 8215: </a><span class="php-comment">         */</span>
</span><span id="8216" class="l"><a href="#8216"> 8216: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _getstream(<span class="php-var">$s</span>, <span class="php-var">$n</span>=<span class="php-num">0</span>) {
</span><span id="8217" class="l"><a href="#8217"> 8217: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;encrypted) {
</span><span id="8218" class="l"><a href="#8218"> 8218: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$n</span> &lt;= <span class="php-num">0</span>) {
</span><span id="8219" class="l"><a href="#8219"> 8219: </a>                    <span class="php-comment">// default to current object</span>
</span><span id="8220" class="l"><a href="#8220"> 8220: </a>                    <span class="php-var">$n</span> = <span class="php-var">$this</span>-&gt;n;
</span><span id="8221" class="l"><a href="#8221"> 8221: </a>                }
</span><span id="8222" class="l"><a href="#8222"> 8222: </a>                <span class="php-var">$s</span> = <span class="php-var">$this</span>-&gt;_RC4(<span class="php-var">$this</span>-&gt;_objectkey(<span class="php-var">$n</span>), <span class="php-var">$s</span>);
</span><span id="8223" class="l"><a href="#8223"> 8223: </a>            }
</span><span id="8224" class="l"><a href="#8224"> 8224: </a>            <span class="php-keyword1">return</span> <span class="php-quote">&quot;stream\n&quot;</span>.<span class="php-var">$s</span>.<span class="php-quote">&quot;\nendstream&quot;</span>;
</span><span id="8225" class="l"><a href="#8225"> 8225: </a>        }
</span><span id="8226" class="l"><a href="#8226"> 8226: </a>
</span><span id="8227" class="l"><a href="#8227"> 8227: </a>        <span class="php-comment">/**
</span></span><span id="8228" class="l"><a href="#8228"> 8228: </a><span class="php-comment">         * Output a stream.
</span></span><span id="8229" class="l"><a href="#8229"> 8229: </a><span class="php-comment">         * @param string $s string to output.
</span></span><span id="8230" class="l"><a href="#8230"> 8230: </a><span class="php-comment">         * @param int $n object reference for encryption mode
</span></span><span id="8231" class="l"><a href="#8231"> 8231: </a><span class="php-comment">         * @access protected
</span></span><span id="8232" class="l"><a href="#8232"> 8232: </a><span class="php-comment">         */</span>
</span><span id="8233" class="l"><a href="#8233"> 8233: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putstream(<span class="php-var">$s</span>, <span class="php-var">$n</span>=<span class="php-num">0</span>) {
</span><span id="8234" class="l"><a href="#8234"> 8234: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$s</span>, <span class="php-var">$n</span>));
</span><span id="8235" class="l"><a href="#8235"> 8235: </a>        }
</span><span id="8236" class="l"><a href="#8236"> 8236: </a>
</span><span id="8237" class="l"><a href="#8237"> 8237: </a>        <span class="php-comment">/**
</span></span><span id="8238" class="l"><a href="#8238"> 8238: </a><span class="php-comment">         * Output a string to the document.
</span></span><span id="8239" class="l"><a href="#8239"> 8239: </a><span class="php-comment">         * @param string $s string to output.
</span></span><span id="8240" class="l"><a href="#8240"> 8240: </a><span class="php-comment">         * @access protected
</span></span><span id="8241" class="l"><a href="#8241"> 8241: </a><span class="php-comment">         */</span>
</span><span id="8242" class="l"><a href="#8242"> 8242: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _out(<span class="php-var">$s</span>) {
</span><span id="8243" class="l"><a href="#8243"> 8243: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;state == <span class="php-num">2</span>) {
</span><span id="8244" class="l"><a href="#8244"> 8244: </a>                <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;InFooter) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page] &gt; <span class="php-num">0</span>)) {
</span><span id="8245" class="l"><a href="#8245"> 8245: </a>                    <span class="php-comment">// puts data before page footer</span>
</span><span id="8246" class="l"><a href="#8246"> 8246: </a>                    <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$this</span>-&gt;page);
</span><span id="8247" class="l"><a href="#8247"> 8247: </a>                    <span class="php-var">$page</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, -<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page]);
</span><span id="8248" class="l"><a href="#8248"> 8248: </a>                    <span class="php-var">$footer</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, -<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page]);
</span><span id="8249" class="l"><a href="#8249"> 8249: </a>                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$page</span>.<span class="php-var">$s</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$footer</span>);
</span><span id="8250" class="l"><a href="#8250"> 8250: </a>                    <span class="php-comment">// update footer position</span>
</span><span id="8251" class="l"><a href="#8251"> 8251: </a>                    <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] += <span class="php-keyword2">strlen</span>(<span class="php-var">$s</span>.<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="8252" class="l"><a href="#8252"> 8252: </a>                } <span class="php-keyword1">else</span> {
</span><span id="8253" class="l"><a href="#8253"> 8253: </a>                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$s</span>.<span class="php-quote">&quot;\n&quot;</span>, <span class="php-keyword1">true</span>);
</span><span id="8254" class="l"><a href="#8254"> 8254: </a>                }
</span><span id="8255" class="l"><a href="#8255"> 8255: </a>            } <span class="php-keyword1">else</span> {
</span><span id="8256" class="l"><a href="#8256"> 8256: </a>                <span class="php-var">$this</span>-&gt;setBuffer(<span class="php-var">$s</span>.<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="8257" class="l"><a href="#8257"> 8257: </a>            }
</span><span id="8258" class="l"><a href="#8258"> 8258: </a>        }
</span><span id="8259" class="l"><a href="#8259"> 8259: </a>
</span><span id="8260" class="l"><a href="#8260"> 8260: </a>        <span class="php-comment">/**
</span></span><span id="8261" class="l"><a href="#8261"> 8261: </a><span class="php-comment">         * Converts UTF-8 strings to codepoints array.&lt;br&gt;
</span></span><span id="8262" class="l"><a href="#8262"> 8262: </a><span class="php-comment">         * Invalid byte sequences will be replaced with 0xFFFD (replacement character)&lt;br&gt;
</span></span><span id="8263" class="l"><a href="#8263"> 8263: </a><span class="php-comment">         * Based on: http://www.faqs.org/rfcs/rfc3629.html
</span></span><span id="8264" class="l"><a href="#8264"> 8264: </a><span class="php-comment">         * &lt;pre&gt;
</span></span><span id="8265" class="l"><a href="#8265"> 8265: </a><span class="php-comment">         *    Char. number range  |        UTF-8 octet sequence
</span></span><span id="8266" class="l"><a href="#8266"> 8266: </a><span class="php-comment">         *       (hexadecimal)    |              (binary)
</span></span><span id="8267" class="l"><a href="#8267"> 8267: </a><span class="php-comment">         *    --------------------+-----------------------------------------------
</span></span><span id="8268" class="l"><a href="#8268"> 8268: </a><span class="php-comment">         *    0000 0000-0000 007F | 0xxxxxxx
</span></span><span id="8269" class="l"><a href="#8269"> 8269: </a><span class="php-comment">         *    0000 0080-0000 07FF | 110xxxxx 10xxxxxx
</span></span><span id="8270" class="l"><a href="#8270"> 8270: </a><span class="php-comment">         *    0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
</span></span><span id="8271" class="l"><a href="#8271"> 8271: </a><span class="php-comment">         *    0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
</span></span><span id="8272" class="l"><a href="#8272"> 8272: </a><span class="php-comment">         *    ---------------------------------------------------------------------
</span></span><span id="8273" class="l"><a href="#8273"> 8273: </a><span class="php-comment">         *
</span></span><span id="8274" class="l"><a href="#8274"> 8274: </a><span class="php-comment">         *   ABFN notation:
</span></span><span id="8275" class="l"><a href="#8275"> 8275: </a><span class="php-comment">         *   ---------------------------------------------------------------------
</span></span><span id="8276" class="l"><a href="#8276"> 8276: </a><span class="php-comment">         *   UTF8-octets = *( UTF8-char )
</span></span><span id="8277" class="l"><a href="#8277"> 8277: </a><span class="php-comment">         *   UTF8-char   = UTF8-1 / UTF8-2 / UTF8-3 / UTF8-4
</span></span><span id="8278" class="l"><a href="#8278"> 8278: </a><span class="php-comment">         *   UTF8-1      = %x00-7F
</span></span><span id="8279" class="l"><a href="#8279"> 8279: </a><span class="php-comment">         *   UTF8-2      = %xC2-DF UTF8-tail
</span></span><span id="8280" class="l"><a href="#8280"> 8280: </a><span class="php-comment">         *
</span></span><span id="8281" class="l"><a href="#8281"> 8281: </a><span class="php-comment">         *   UTF8-3      = %xE0 %xA0-BF UTF8-tail / %xE1-EC 2( UTF8-tail ) /
</span></span><span id="8282" class="l"><a href="#8282"> 8282: </a><span class="php-comment">         *                 %xED %x80-9F UTF8-tail / %xEE-EF 2( UTF8-tail )
</span></span><span id="8283" class="l"><a href="#8283"> 8283: </a><span class="php-comment">         *   UTF8-4      = %xF0 %x90-BF 2( UTF8-tail ) / %xF1-F3 3( UTF8-tail ) /
</span></span><span id="8284" class="l"><a href="#8284"> 8284: </a><span class="php-comment">         *                 %xF4 %x80-8F 2( UTF8-tail )
</span></span><span id="8285" class="l"><a href="#8285"> 8285: </a><span class="php-comment">         *   UTF8-tail   = %x80-BF
</span></span><span id="8286" class="l"><a href="#8286"> 8286: </a><span class="php-comment">         *   ---------------------------------------------------------------------
</span></span><span id="8287" class="l"><a href="#8287"> 8287: </a><span class="php-comment">         * &lt;/pre&gt;
</span></span><span id="8288" class="l"><a href="#8288"> 8288: </a><span class="php-comment">         * @param string $str string to process.
</span></span><span id="8289" class="l"><a href="#8289"> 8289: </a><span class="php-comment">         * @return array containing codepoints (UTF-8 characters values)
</span></span><span id="8290" class="l"><a href="#8290"> 8290: </a><span class="php-comment">         * @access protected
</span></span><span id="8291" class="l"><a href="#8291"> 8291: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="8292" class="l"><a href="#8292"> 8292: </a><span class="php-comment">         * @since 1.53.0.TC005 (2005-01-05)
</span></span><span id="8293" class="l"><a href="#8293"> 8293: </a><span class="php-comment">         */</span>
</span><span id="8294" class="l"><a href="#8294"> 8294: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> UTF8StringToArray(<span class="php-var">$str</span>) {
</span><span id="8295" class="l"><a href="#8295"> 8295: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;cache_UTF8StringToArray[<span class="php-quote">'_'</span>.<span class="php-var">$str</span>])) {
</span><span id="8296" class="l"><a href="#8296"> 8296: </a>                <span class="php-comment">// return cached value</span>
</span><span id="8297" class="l"><a href="#8297"> 8297: </a>                <span class="php-keyword1">return</span>(<span class="php-var">$this</span>-&gt;cache_UTF8StringToArray[<span class="php-quote">'_'</span>.<span class="php-var">$str</span>]);
</span><span id="8298" class="l"><a href="#8298"> 8298: </a>            }
</span><span id="8299" class="l"><a href="#8299"> 8299: </a>            <span class="php-comment">// check cache size</span>
</span><span id="8300" class="l"><a href="#8300"> 8300: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;cache_size_UTF8StringToArray &gt;= <span class="php-var">$this</span>-&gt;cache_maxsize_UTF8StringToArray) {
</span><span id="8301" class="l"><a href="#8301"> 8301: </a>                <span class="php-comment">// remove first element</span>
</span><span id="8302" class="l"><a href="#8302"> 8302: </a>                <span class="php-keyword2">array_shift</span>(<span class="php-var">$this</span>-&gt;cache_UTF8StringToArray);
</span><span id="8303" class="l"><a href="#8303"> 8303: </a>            }
</span><span id="8304" class="l"><a href="#8304"> 8304: </a>            ++<span class="php-var">$this</span>-&gt;cache_size_UTF8StringToArray;
</span><span id="8305" class="l"><a href="#8305"> 8305: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="8306" class="l"><a href="#8306"> 8306: </a>                <span class="php-comment">// split string into array of equivalent codes</span>
</span><span id="8307" class="l"><a href="#8307"> 8307: </a>                <span class="php-var">$strarr</span> = <span class="php-keyword1">array</span>();
</span><span id="8308" class="l"><a href="#8308"> 8308: </a>                <span class="php-var">$strlen</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$str</span>);
</span><span id="8309" class="l"><a href="#8309"> 8309: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$strlen</span>; ++<span class="php-var">$i</span>) {
</span><span id="8310" class="l"><a href="#8310"> 8310: </a>                    <span class="php-var">$strarr</span>[] = <span class="php-keyword2">ord</span>(<span class="php-var">$str</span>{<span class="php-var">$i</span>});
</span><span id="8311" class="l"><a href="#8311"> 8311: </a>                }
</span><span id="8312" class="l"><a href="#8312"> 8312: </a>                <span class="php-comment">// insert new value on cache</span>
</span><span id="8313" class="l"><a href="#8313"> 8313: </a>                <span class="php-var">$this</span>-&gt;cache_UTF8StringToArray[<span class="php-quote">'_'</span>.<span class="php-var">$str</span>] = <span class="php-var">$strarr</span>;
</span><span id="8314" class="l"><a href="#8314"> 8314: </a>                <span class="php-keyword1">return</span> <span class="php-var">$strarr</span>;
</span><span id="8315" class="l"><a href="#8315"> 8315: </a>            }
</span><span id="8316" class="l"><a href="#8316"> 8316: </a>            <span class="php-var">$unicode</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// array containing unicode values</span>
</span><span id="8317" class="l"><a href="#8317"> 8317: </a>            <span class="php-var">$bytes</span>  = <span class="php-keyword1">array</span>(); <span class="php-comment">// array containing single character byte sequences</span>
</span><span id="8318" class="l"><a href="#8318"> 8318: </a>            <span class="php-var">$numbytes</span>  = <span class="php-num">1</span>; <span class="php-comment">// number of octetc needed to represent the UTF-8 character</span>
</span><span id="8319" class="l"><a href="#8319"> 8319: </a>            <span class="php-var">$str</span> .= <span class="php-quote">''</span>; <span class="php-comment">// force $str to be a string</span>
</span><span id="8320" class="l"><a href="#8320"> 8320: </a>            <span class="php-var">$length</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$str</span>);
</span><span id="8321" class="l"><a href="#8321"> 8321: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$length</span>; ++<span class="php-var">$i</span>) {
</span><span id="8322" class="l"><a href="#8322"> 8322: </a>                <span class="php-var">$char</span> = <span class="php-keyword2">ord</span>(<span class="php-var">$str</span>{<span class="php-var">$i</span>}); <span class="php-comment">// get one string character at time</span>
</span><span id="8323" class="l"><a href="#8323"> 8323: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$bytes</span>) == <span class="php-num">0</span>) { <span class="php-comment">// get starting octect</span>
</span><span id="8324" class="l"><a href="#8324"> 8324: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$char</span> &lt;= <span class="php-num">0x7F</span>) {
</span><span id="8325" class="l"><a href="#8325"> 8325: </a>                        <span class="php-var">$unicode</span>[] = <span class="php-var">$char</span>; <span class="php-comment">// use the character &quot;as is&quot; because is ASCII</span>
</span><span id="8326" class="l"><a href="#8326"> 8326: </a>                        <span class="php-var">$numbytes</span> = <span class="php-num">1</span>;
</span><span id="8327" class="l"><a href="#8327"> 8327: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$char</span> &gt;&gt; <span class="php-num">0x05</span>) == <span class="php-num">0x06</span>) { <span class="php-comment">// 2 bytes character (0x06 = 110 BIN)</span>
</span><span id="8328" class="l"><a href="#8328"> 8328: </a>                        <span class="php-var">$bytes</span>[] = (<span class="php-var">$char</span> - <span class="php-num">0xC0</span>) &lt;&lt; <span class="php-num">0x06</span>;
</span><span id="8329" class="l"><a href="#8329"> 8329: </a>                        <span class="php-var">$numbytes</span> = <span class="php-num">2</span>;
</span><span id="8330" class="l"><a href="#8330"> 8330: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$char</span> &gt;&gt; <span class="php-num">0x04</span>) == <span class="php-num">0x0E</span>) { <span class="php-comment">// 3 bytes character (0x0E = 1110 BIN)</span>
</span><span id="8331" class="l"><a href="#8331"> 8331: </a>                        <span class="php-var">$bytes</span>[] = (<span class="php-var">$char</span> - <span class="php-num">0xE0</span>) &lt;&lt; <span class="php-num">0x0C</span>;
</span><span id="8332" class="l"><a href="#8332"> 8332: </a>                        <span class="php-var">$numbytes</span> = <span class="php-num">3</span>;
</span><span id="8333" class="l"><a href="#8333"> 8333: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$char</span> &gt;&gt; <span class="php-num">0x03</span>) == <span class="php-num">0x1E</span>) { <span class="php-comment">// 4 bytes character (0x1E = 11110 BIN)</span>
</span><span id="8334" class="l"><a href="#8334"> 8334: </a>                        <span class="php-var">$bytes</span>[] = (<span class="php-var">$char</span> - <span class="php-num">0xF0</span>) &lt;&lt; <span class="php-num">0x12</span>;
</span><span id="8335" class="l"><a href="#8335"> 8335: </a>                        <span class="php-var">$numbytes</span> = <span class="php-num">4</span>;
</span><span id="8336" class="l"><a href="#8336"> 8336: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="8337" class="l"><a href="#8337"> 8337: </a>                        <span class="php-comment">// use replacement character for other invalid sequences</span>
</span><span id="8338" class="l"><a href="#8338"> 8338: </a>                        <span class="php-var">$unicode</span>[] = <span class="php-num">0xFFFD</span>;
</span><span id="8339" class="l"><a href="#8339"> 8339: </a>                        <span class="php-var">$bytes</span> = <span class="php-keyword1">array</span>();
</span><span id="8340" class="l"><a href="#8340"> 8340: </a>                        <span class="php-var">$numbytes</span> = <span class="php-num">1</span>;
</span><span id="8341" class="l"><a href="#8341"> 8341: </a>                    }
</span><span id="8342" class="l"><a href="#8342"> 8342: </a>                } <span class="php-keyword1">elseif</span> ((<span class="php-var">$char</span> &gt;&gt; <span class="php-num">0x06</span>) == <span class="php-num">0x02</span>) { <span class="php-comment">// bytes 2, 3 and 4 must start with 0x02 = 10 BIN</span>
</span><span id="8343" class="l"><a href="#8343"> 8343: </a>                    <span class="php-var">$bytes</span>[] = <span class="php-var">$char</span> - <span class="php-num">0x80</span>;
</span><span id="8344" class="l"><a href="#8344"> 8344: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$bytes</span>) == <span class="php-var">$numbytes</span>) {
</span><span id="8345" class="l"><a href="#8345"> 8345: </a>                        <span class="php-comment">// compose UTF-8 bytes to a single unicode value</span>
</span><span id="8346" class="l"><a href="#8346"> 8346: </a>                        <span class="php-var">$char</span> = <span class="php-var">$bytes</span>[<span class="php-num">0</span>];
</span><span id="8347" class="l"><a href="#8347"> 8347: </a>                        <span class="php-keyword1">for</span> (<span class="php-var">$j</span> = <span class="php-num">1</span>; <span class="php-var">$j</span> &lt; <span class="php-var">$numbytes</span>; ++<span class="php-var">$j</span>) {
</span><span id="8348" class="l"><a href="#8348"> 8348: </a>                            <span class="php-var">$char</span> += (<span class="php-var">$bytes</span>[<span class="php-var">$j</span>] &lt;&lt; ((<span class="php-var">$numbytes</span> - <span class="php-var">$j</span> - <span class="php-num">1</span>) * <span class="php-num">0x06</span>));
</span><span id="8349" class="l"><a href="#8349"> 8349: </a>                        }
</span><span id="8350" class="l"><a href="#8350"> 8350: </a>                        <span class="php-keyword1">if</span> (((<span class="php-var">$char</span> &gt;= <span class="php-num">0xD800</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$char</span> &lt;= <span class="php-num">0xDFFF</span>)) <span class="php-keyword1">OR</span> (<span class="php-var">$char</span> &gt;= <span class="php-num">0x10FFFF</span>)) {
</span><span id="8351" class="l"><a href="#8351"> 8351: </a>                            <span class="php-comment">/* The definition of UTF-8 prohibits encoding character numbers between
</span></span><span id="8352" class="l"><a href="#8352"> 8352: </a><span class="php-comment">                            U+D800 and U+DFFF, which are reserved for use with the UTF-16
</span></span><span id="8353" class="l"><a href="#8353"> 8353: </a><span class="php-comment">                            encoding form (as surrogate pairs) and do not directly represent
</span></span><span id="8354" class="l"><a href="#8354"> 8354: </a><span class="php-comment">                            characters. */</span>
</span><span id="8355" class="l"><a href="#8355"> 8355: </a>                            <span class="php-var">$unicode</span>[] = <span class="php-num">0xFFFD</span>; <span class="php-comment">// use replacement character</span>
</span><span id="8356" class="l"><a href="#8356"> 8356: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="8357" class="l"><a href="#8357"> 8357: </a>                            <span class="php-var">$unicode</span>[] = <span class="php-var">$char</span>; <span class="php-comment">// add char to array</span>
</span><span id="8358" class="l"><a href="#8358"> 8358: </a>                        }
</span><span id="8359" class="l"><a href="#8359"> 8359: </a>                        <span class="php-comment">// reset data for next char</span>
</span><span id="8360" class="l"><a href="#8360"> 8360: </a>                        <span class="php-var">$bytes</span> = <span class="php-keyword1">array</span>();
</span><span id="8361" class="l"><a href="#8361"> 8361: </a>                        <span class="php-var">$numbytes</span> = <span class="php-num">1</span>;
</span><span id="8362" class="l"><a href="#8362"> 8362: </a>                    }
</span><span id="8363" class="l"><a href="#8363"> 8363: </a>                } <span class="php-keyword1">else</span> {
</span><span id="8364" class="l"><a href="#8364"> 8364: </a>                    <span class="php-comment">// use replacement character for other invalid sequences</span>
</span><span id="8365" class="l"><a href="#8365"> 8365: </a>                    <span class="php-var">$unicode</span>[] = <span class="php-num">0xFFFD</span>;
</span><span id="8366" class="l"><a href="#8366"> 8366: </a>                    <span class="php-var">$bytes</span> = <span class="php-keyword1">array</span>();
</span><span id="8367" class="l"><a href="#8367"> 8367: </a>                    <span class="php-var">$numbytes</span> = <span class="php-num">1</span>;
</span><span id="8368" class="l"><a href="#8368"> 8368: </a>                }
</span><span id="8369" class="l"><a href="#8369"> 8369: </a>            }
</span><span id="8370" class="l"><a href="#8370"> 8370: </a>            <span class="php-comment">// insert new value on cache</span>
</span><span id="8371" class="l"><a href="#8371"> 8371: </a>            <span class="php-var">$this</span>-&gt;cache_UTF8StringToArray[<span class="php-quote">'_'</span>.<span class="php-var">$str</span>] = <span class="php-var">$unicode</span>;
</span><span id="8372" class="l"><a href="#8372"> 8372: </a>            <span class="php-keyword1">return</span> <span class="php-var">$unicode</span>;
</span><span id="8373" class="l"><a href="#8373"> 8373: </a>        }
</span><span id="8374" class="l"><a href="#8374"> 8374: </a>
</span><span id="8375" class="l"><a href="#8375"> 8375: </a>        <span class="php-comment">/**
</span></span><span id="8376" class="l"><a href="#8376"> 8376: </a><span class="php-comment">         * Converts UTF-8 strings to UTF16-BE.&lt;br&gt;
</span></span><span id="8377" class="l"><a href="#8377"> 8377: </a><span class="php-comment">         * @param string $str string to process.
</span></span><span id="8378" class="l"><a href="#8378"> 8378: </a><span class="php-comment">         * @param boolean $setbom if true set the Byte Order Mark (BOM = 0xFEFF)
</span></span><span id="8379" class="l"><a href="#8379"> 8379: </a><span class="php-comment">         * @return string
</span></span><span id="8380" class="l"><a href="#8380"> 8380: </a><span class="php-comment">         * @access protected
</span></span><span id="8381" class="l"><a href="#8381"> 8381: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="8382" class="l"><a href="#8382"> 8382: </a><span class="php-comment">         * @since 1.53.0.TC005 (2005-01-05)
</span></span><span id="8383" class="l"><a href="#8383"> 8383: </a><span class="php-comment">         * @uses UTF8StringToArray(), arrUTF8ToUTF16BE()
</span></span><span id="8384" class="l"><a href="#8384"> 8384: </a><span class="php-comment">         */</span>
</span><span id="8385" class="l"><a href="#8385"> 8385: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> UTF8ToUTF16BE(<span class="php-var">$str</span>, <span class="php-var">$setbom</span>=<span class="php-keyword1">true</span>) {
</span><span id="8386" class="l"><a href="#8386"> 8386: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="8387" class="l"><a href="#8387"> 8387: </a>                <span class="php-keyword1">return</span> <span class="php-var">$str</span>; <span class="php-comment">// string is not in unicode</span>
</span><span id="8388" class="l"><a href="#8388"> 8388: </a>            }
</span><span id="8389" class="l"><a href="#8389"> 8389: </a>            <span class="php-var">$unicode</span> = <span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$str</span>); <span class="php-comment">// array containing UTF-8 unicode values</span>
</span><span id="8390" class="l"><a href="#8390"> 8390: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;arrUTF8ToUTF16BE(<span class="php-var">$unicode</span>, <span class="php-var">$setbom</span>);
</span><span id="8391" class="l"><a href="#8391"> 8391: </a>        }
</span><span id="8392" class="l"><a href="#8392"> 8392: </a>
</span><span id="8393" class="l"><a href="#8393"> 8393: </a>        <span class="php-comment">/**
</span></span><span id="8394" class="l"><a href="#8394"> 8394: </a><span class="php-comment">         * Converts UTF-8 strings to Latin1 when using the standard 14 core fonts.&lt;br&gt;
</span></span><span id="8395" class="l"><a href="#8395"> 8395: </a><span class="php-comment">         * @param string $str string to process.
</span></span><span id="8396" class="l"><a href="#8396"> 8396: </a><span class="php-comment">         * @return string
</span></span><span id="8397" class="l"><a href="#8397"> 8397: </a><span class="php-comment">         * @author Andrew Whitehead, Nicola Asuni
</span></span><span id="8398" class="l"><a href="#8398"> 8398: </a><span class="php-comment">         * @access protected
</span></span><span id="8399" class="l"><a href="#8399"> 8399: </a><span class="php-comment">         * @since 3.2.000 (2008-06-23)
</span></span><span id="8400" class="l"><a href="#8400"> 8400: </a><span class="php-comment">         */</span>
</span><span id="8401" class="l"><a href="#8401"> 8401: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> UTF8ToLatin1(<span class="php-var">$str</span>) {
</span><span id="8402" class="l"><a href="#8402"> 8402: </a>            <span class="php-keyword1">global</span> <span class="php-var">$utf8tolatin</span>;
</span><span id="8403" class="l"><a href="#8403"> 8403: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="8404" class="l"><a href="#8404"> 8404: </a>                <span class="php-keyword1">return</span> <span class="php-var">$str</span>; <span class="php-comment">// string is not in unicode</span>
</span><span id="8405" class="l"><a href="#8405"> 8405: </a>            }
</span><span id="8406" class="l"><a href="#8406"> 8406: </a>            <span class="php-var">$outstr</span> = <span class="php-quote">''</span>; <span class="php-comment">// string to be returned</span>
</span><span id="8407" class="l"><a href="#8407"> 8407: </a>            <span class="php-var">$unicode</span> = <span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$str</span>); <span class="php-comment">// array containing UTF-8 unicode values</span>
</span><span id="8408" class="l"><a href="#8408"> 8408: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$unicode</span> <span class="php-keyword1">as</span> <span class="php-var">$char</span>) {
</span><span id="8409" class="l"><a href="#8409"> 8409: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$char</span> &lt; <span class="php-num">256</span>) {
</span><span id="8410" class="l"><a href="#8410"> 8410: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$char</span>);
</span><span id="8411" class="l"><a href="#8411"> 8411: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">array_key_exists</span>(<span class="php-var">$char</span>, <span class="php-var">$utf8tolatin</span>)) {
</span><span id="8412" class="l"><a href="#8412"> 8412: </a>                    <span class="php-comment">// map from UTF-8</span>
</span><span id="8413" class="l"><a href="#8413"> 8413: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$utf8tolatin</span>[<span class="php-var">$char</span>]);
</span><span id="8414" class="l"><a href="#8414"> 8414: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$char</span> == <span class="php-num">0xFFFD</span>) {
</span><span id="8415" class="l"><a href="#8415"> 8415: </a>                    <span class="php-comment">// skip</span>
</span><span id="8416" class="l"><a href="#8416"> 8416: </a>                } <span class="php-keyword1">else</span> {
</span><span id="8417" class="l"><a href="#8417"> 8417: </a>                    <span class="php-var">$outstr</span> .= <span class="php-quote">'?'</span>;
</span><span id="8418" class="l"><a href="#8418"> 8418: </a>                }
</span><span id="8419" class="l"><a href="#8419"> 8419: </a>            }
</span><span id="8420" class="l"><a href="#8420"> 8420: </a>            <span class="php-keyword1">return</span> <span class="php-var">$outstr</span>;
</span><span id="8421" class="l"><a href="#8421"> 8421: </a>        }
</span><span id="8422" class="l"><a href="#8422"> 8422: </a>
</span><span id="8423" class="l"><a href="#8423"> 8423: </a>        <span class="php-comment">/**
</span></span><span id="8424" class="l"><a href="#8424"> 8424: </a><span class="php-comment">         * Converts UTF-8 characters array to array of Latin1 characters&lt;br&gt;
</span></span><span id="8425" class="l"><a href="#8425"> 8425: </a><span class="php-comment">         * @param array $unicode array containing UTF-8 unicode values
</span></span><span id="8426" class="l"><a href="#8426"> 8426: </a><span class="php-comment">         * @return array
</span></span><span id="8427" class="l"><a href="#8427"> 8427: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="8428" class="l"><a href="#8428"> 8428: </a><span class="php-comment">         * @access protected
</span></span><span id="8429" class="l"><a href="#8429"> 8429: </a><span class="php-comment">         * @since 4.8.023 (2010-01-15)
</span></span><span id="8430" class="l"><a href="#8430"> 8430: </a><span class="php-comment">         */</span>
</span><span id="8431" class="l"><a href="#8431"> 8431: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> UTF8ArrToLatin1(<span class="php-var">$unicode</span>) {
</span><span id="8432" class="l"><a href="#8432"> 8432: </a>            <span class="php-keyword1">global</span> <span class="php-var">$utf8tolatin</span>;
</span><span id="8433" class="l"><a href="#8433"> 8433: </a>            <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;isunicode) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="8434" class="l"><a href="#8434"> 8434: </a>                <span class="php-keyword1">return</span> <span class="php-var">$unicode</span>; <span class="php-comment">// string is not in unicode</span>
</span><span id="8435" class="l"><a href="#8435"> 8435: </a>            }
</span><span id="8436" class="l"><a href="#8436"> 8436: </a>            <span class="php-var">$outarr</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// array to be returned</span>
</span><span id="8437" class="l"><a href="#8437"> 8437: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$unicode</span> <span class="php-keyword1">as</span> <span class="php-var">$char</span>) {
</span><span id="8438" class="l"><a href="#8438"> 8438: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$char</span> &lt; <span class="php-num">256</span>) {
</span><span id="8439" class="l"><a href="#8439"> 8439: </a>                    <span class="php-var">$outarr</span>[] = <span class="php-var">$char</span>;
</span><span id="8440" class="l"><a href="#8440"> 8440: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">array_key_exists</span>(<span class="php-var">$char</span>, <span class="php-var">$utf8tolatin</span>)) {
</span><span id="8441" class="l"><a href="#8441"> 8441: </a>                    <span class="php-comment">// map from UTF-8</span>
</span><span id="8442" class="l"><a href="#8442"> 8442: </a>                    <span class="php-var">$outarr</span>[] = <span class="php-var">$utf8tolatin</span>[<span class="php-var">$char</span>];
</span><span id="8443" class="l"><a href="#8443"> 8443: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$char</span> == <span class="php-num">0xFFFD</span>) {
</span><span id="8444" class="l"><a href="#8444"> 8444: </a>                    <span class="php-comment">// skip</span>
</span><span id="8445" class="l"><a href="#8445"> 8445: </a>                } <span class="php-keyword1">else</span> {
</span><span id="8446" class="l"><a href="#8446"> 8446: </a>                    <span class="php-var">$outarr</span>[] = <span class="php-num">63</span>; <span class="php-comment">// '?' character</span>
</span><span id="8447" class="l"><a href="#8447"> 8447: </a>                }
</span><span id="8448" class="l"><a href="#8448"> 8448: </a>            }
</span><span id="8449" class="l"><a href="#8449"> 8449: </a>            <span class="php-keyword1">return</span> <span class="php-var">$outarr</span>;
</span><span id="8450" class="l"><a href="#8450"> 8450: </a>        }
</span><span id="8451" class="l"><a href="#8451"> 8451: </a>
</span><span id="8452" class="l"><a href="#8452"> 8452: </a>        <span class="php-comment">/**
</span></span><span id="8453" class="l"><a href="#8453"> 8453: </a><span class="php-comment">         * Converts array of UTF-8 characters to UTF16-BE string.&lt;br&gt;
</span></span><span id="8454" class="l"><a href="#8454"> 8454: </a><span class="php-comment">         * Based on: http://www.faqs.org/rfcs/rfc2781.html
</span></span><span id="8455" class="l"><a href="#8455"> 8455: </a><span class="php-comment">         * &lt;pre&gt;
</span></span><span id="8456" class="l"><a href="#8456"> 8456: </a><span class="php-comment">         *   Encoding UTF-16:
</span></span><span id="8457" class="l"><a href="#8457"> 8457: </a><span class="php-comment">         *
</span></span><span id="8458" class="l"><a href="#8458"> 8458: </a><span class="php-comment">         *   Encoding of a single character from an ISO 10646 character value to
</span></span><span id="8459" class="l"><a href="#8459"> 8459: </a><span class="php-comment">         *    UTF-16 proceeds as follows. Let U be the character number, no greater
</span></span><span id="8460" class="l"><a href="#8460"> 8460: </a><span class="php-comment">         *    than 0x10FFFF.
</span></span><span id="8461" class="l"><a href="#8461"> 8461: </a><span class="php-comment">         *
</span></span><span id="8462" class="l"><a href="#8462"> 8462: </a><span class="php-comment">         *    1) If U &lt; 0x10000, encode U as a 16-bit unsigned integer and
</span></span><span id="8463" class="l"><a href="#8463"> 8463: </a><span class="php-comment">         *       terminate.
</span></span><span id="8464" class="l"><a href="#8464"> 8464: </a><span class="php-comment">         *
</span></span><span id="8465" class="l"><a href="#8465"> 8465: </a><span class="php-comment">         *    2) Let U' = U - 0x10000. Because U is less than or equal to 0x10FFFF,
</span></span><span id="8466" class="l"><a href="#8466"> 8466: </a><span class="php-comment">         *       U' must be less than or equal to 0xFFFFF. That is, U' can be
</span></span><span id="8467" class="l"><a href="#8467"> 8467: </a><span class="php-comment">         *       represented in 20 bits.
</span></span><span id="8468" class="l"><a href="#8468"> 8468: </a><span class="php-comment">         *
</span></span><span id="8469" class="l"><a href="#8469"> 8469: </a><span class="php-comment">         *    3) Initialize two 16-bit unsigned integers, W1 and W2, to 0xD800 and
</span></span><span id="8470" class="l"><a href="#8470"> 8470: </a><span class="php-comment">         *       0xDC00, respectively. These integers each have 10 bits free to
</span></span><span id="8471" class="l"><a href="#8471"> 8471: </a><span class="php-comment">         *       encode the character value, for a total of 20 bits.
</span></span><span id="8472" class="l"><a href="#8472"> 8472: </a><span class="php-comment">         *
</span></span><span id="8473" class="l"><a href="#8473"> 8473: </a><span class="php-comment">         *    4) Assign the 10 high-order bits of the 20-bit U' to the 10 low-order
</span></span><span id="8474" class="l"><a href="#8474"> 8474: </a><span class="php-comment">         *       bits of W1 and the 10 low-order bits of U' to the 10 low-order
</span></span><span id="8475" class="l"><a href="#8475"> 8475: </a><span class="php-comment">         *       bits of W2. Terminate.
</span></span><span id="8476" class="l"><a href="#8476"> 8476: </a><span class="php-comment">         *
</span></span><span id="8477" class="l"><a href="#8477"> 8477: </a><span class="php-comment">         *    Graphically, steps 2 through 4 look like:
</span></span><span id="8478" class="l"><a href="#8478"> 8478: </a><span class="php-comment">         *    U' = yyyyyyyyyyxxxxxxxxxx
</span></span><span id="8479" class="l"><a href="#8479"> 8479: </a><span class="php-comment">         *    W1 = 110110yyyyyyyyyy
</span></span><span id="8480" class="l"><a href="#8480"> 8480: </a><span class="php-comment">         *    W2 = 110111xxxxxxxxxx
</span></span><span id="8481" class="l"><a href="#8481"> 8481: </a><span class="php-comment">         * &lt;/pre&gt;
</span></span><span id="8482" class="l"><a href="#8482"> 8482: </a><span class="php-comment">         * @param array $unicode array containing UTF-8 unicode values
</span></span><span id="8483" class="l"><a href="#8483"> 8483: </a><span class="php-comment">         * @param boolean $setbom if true set the Byte Order Mark (BOM = 0xFEFF)
</span></span><span id="8484" class="l"><a href="#8484"> 8484: </a><span class="php-comment">         * @return string
</span></span><span id="8485" class="l"><a href="#8485"> 8485: </a><span class="php-comment">         * @access protected
</span></span><span id="8486" class="l"><a href="#8486"> 8486: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="8487" class="l"><a href="#8487"> 8487: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="8488" class="l"><a href="#8488"> 8488: </a><span class="php-comment">         * @see UTF8ToUTF16BE()
</span></span><span id="8489" class="l"><a href="#8489"> 8489: </a><span class="php-comment">         */</span>
</span><span id="8490" class="l"><a href="#8490"> 8490: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> arrUTF8ToUTF16BE(<span class="php-var">$unicode</span>, <span class="php-var">$setbom</span>=<span class="php-keyword1">true</span>) {
</span><span id="8491" class="l"><a href="#8491"> 8491: </a>            <span class="php-var">$outstr</span> = <span class="php-quote">''</span>; <span class="php-comment">// string to be returned</span>
</span><span id="8492" class="l"><a href="#8492"> 8492: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$setbom</span>) {
</span><span id="8493" class="l"><a href="#8493"> 8493: </a>                <span class="php-var">$outstr</span> .= <span class="php-quote">&quot;\xFE\xFF&quot;</span>; <span class="php-comment">// Byte Order Mark (BOM)</span>
</span><span id="8494" class="l"><a href="#8494"> 8494: </a>            }
</span><span id="8495" class="l"><a href="#8495"> 8495: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$unicode</span> <span class="php-keyword1">as</span> <span class="php-var">$char</span>) {
</span><span id="8496" class="l"><a href="#8496"> 8496: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$char</span> == <span class="php-num">0xFFFD</span>) {
</span><span id="8497" class="l"><a href="#8497"> 8497: </a>                    <span class="php-var">$outstr</span> .= <span class="php-quote">&quot;\xFF\xFD&quot;</span>; <span class="php-comment">// replacement character</span>
</span><span id="8498" class="l"><a href="#8498"> 8498: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$char</span> &lt; <span class="php-num">0x10000</span>) {
</span><span id="8499" class="l"><a href="#8499"> 8499: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$char</span> &gt;&gt; <span class="php-num">0x08</span>);
</span><span id="8500" class="l"><a href="#8500"> 8500: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$char</span> &amp; <span class="php-num">0xFF</span>);
</span><span id="8501" class="l"><a href="#8501"> 8501: </a>                } <span class="php-keyword1">else</span> {
</span><span id="8502" class="l"><a href="#8502"> 8502: </a>                    <span class="php-var">$char</span> -= <span class="php-num">0x10000</span>;
</span><span id="8503" class="l"><a href="#8503"> 8503: </a>                    <span class="php-var">$w1</span> = <span class="php-num">0xD800</span> | (<span class="php-var">$char</span> &gt;&gt; <span class="php-num">0x10</span>);
</span><span id="8504" class="l"><a href="#8504"> 8504: </a>                    <span class="php-var">$w2</span> = <span class="php-num">0xDC00</span> | (<span class="php-var">$char</span> &amp; <span class="php-num">0x3FF</span>);
</span><span id="8505" class="l"><a href="#8505"> 8505: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$w1</span> &gt;&gt; <span class="php-num">0x08</span>);
</span><span id="8506" class="l"><a href="#8506"> 8506: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$w1</span> &amp; <span class="php-num">0xFF</span>);
</span><span id="8507" class="l"><a href="#8507"> 8507: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$w2</span> &gt;&gt; <span class="php-num">0x08</span>);
</span><span id="8508" class="l"><a href="#8508"> 8508: </a>                    <span class="php-var">$outstr</span> .= <span class="php-keyword2">chr</span>(<span class="php-var">$w2</span> &amp; <span class="php-num">0xFF</span>);
</span><span id="8509" class="l"><a href="#8509"> 8509: </a>                }
</span><span id="8510" class="l"><a href="#8510"> 8510: </a>            }
</span><span id="8511" class="l"><a href="#8511"> 8511: </a>            <span class="php-keyword1">return</span> <span class="php-var">$outstr</span>;
</span><span id="8512" class="l"><a href="#8512"> 8512: </a>        }
</span><span id="8513" class="l"><a href="#8513"> 8513: </a>        <span class="php-comment">// ====================================================</span>
</span><span id="8514" class="l"><a href="#8514"> 8514: </a>
</span><span id="8515" class="l"><a href="#8515"> 8515: </a>        <span class="php-comment">/**
</span></span><span id="8516" class="l"><a href="#8516"> 8516: </a><span class="php-comment">         * Set header font.
</span></span><span id="8517" class="l"><a href="#8517"> 8517: </a><span class="php-comment">         * @param array $font font
</span></span><span id="8518" class="l"><a href="#8518"> 8518: </a><span class="php-comment">         * @access public
</span></span><span id="8519" class="l"><a href="#8519"> 8519: </a><span class="php-comment">         * @since 1.1
</span></span><span id="8520" class="l"><a href="#8520"> 8520: </a><span class="php-comment">         */</span>
</span><span id="8521" class="l"><a href="#8521"> 8521: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setHeaderFont(<span class="php-var">$font</span>) {
</span><span id="8522" class="l"><a href="#8522"> 8522: </a>            <span class="php-var">$this</span>-&gt;header_font = <span class="php-var">$font</span>;
</span><span id="8523" class="l"><a href="#8523"> 8523: </a>        }
</span><span id="8524" class="l"><a href="#8524"> 8524: </a>
</span><span id="8525" class="l"><a href="#8525"> 8525: </a>        <span class="php-comment">/**
</span></span><span id="8526" class="l"><a href="#8526"> 8526: </a><span class="php-comment">         * Get header font.
</span></span><span id="8527" class="l"><a href="#8527"> 8527: </a><span class="php-comment">         * @return array()
</span></span><span id="8528" class="l"><a href="#8528"> 8528: </a><span class="php-comment">         * @access public
</span></span><span id="8529" class="l"><a href="#8529"> 8529: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="8530" class="l"><a href="#8530"> 8530: </a><span class="php-comment">         */</span>
</span><span id="8531" class="l"><a href="#8531"> 8531: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getHeaderFont() {
</span><span id="8532" class="l"><a href="#8532"> 8532: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;header_font;
</span><span id="8533" class="l"><a href="#8533"> 8533: </a>        }
</span><span id="8534" class="l"><a href="#8534"> 8534: </a>
</span><span id="8535" class="l"><a href="#8535"> 8535: </a>        <span class="php-comment">/**
</span></span><span id="8536" class="l"><a href="#8536"> 8536: </a><span class="php-comment">         * Set footer font.
</span></span><span id="8537" class="l"><a href="#8537"> 8537: </a><span class="php-comment">         * @param array $font font
</span></span><span id="8538" class="l"><a href="#8538"> 8538: </a><span class="php-comment">         * @access public
</span></span><span id="8539" class="l"><a href="#8539"> 8539: </a><span class="php-comment">         * @since 1.1
</span></span><span id="8540" class="l"><a href="#8540"> 8540: </a><span class="php-comment">         */</span>
</span><span id="8541" class="l"><a href="#8541"> 8541: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setFooterFont(<span class="php-var">$font</span>) {
</span><span id="8542" class="l"><a href="#8542"> 8542: </a>            <span class="php-var">$this</span>-&gt;footer_font = <span class="php-var">$font</span>;
</span><span id="8543" class="l"><a href="#8543"> 8543: </a>        }
</span><span id="8544" class="l"><a href="#8544"> 8544: </a>
</span><span id="8545" class="l"><a href="#8545"> 8545: </a>        <span class="php-comment">/**
</span></span><span id="8546" class="l"><a href="#8546"> 8546: </a><span class="php-comment">         * Get Footer font.
</span></span><span id="8547" class="l"><a href="#8547"> 8547: </a><span class="php-comment">         * @return array()
</span></span><span id="8548" class="l"><a href="#8548"> 8548: </a><span class="php-comment">         * @access public
</span></span><span id="8549" class="l"><a href="#8549"> 8549: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="8550" class="l"><a href="#8550"> 8550: </a><span class="php-comment">         */</span>
</span><span id="8551" class="l"><a href="#8551"> 8551: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFooterFont() {
</span><span id="8552" class="l"><a href="#8552"> 8552: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;footer_font;
</span><span id="8553" class="l"><a href="#8553"> 8553: </a>        }
</span><span id="8554" class="l"><a href="#8554"> 8554: </a>
</span><span id="8555" class="l"><a href="#8555"> 8555: </a>        <span class="php-comment">/**
</span></span><span id="8556" class="l"><a href="#8556"> 8556: </a><span class="php-comment">         * Set language array.
</span></span><span id="8557" class="l"><a href="#8557"> 8557: </a><span class="php-comment">         * @param array $language
</span></span><span id="8558" class="l"><a href="#8558"> 8558: </a><span class="php-comment">         * @access public
</span></span><span id="8559" class="l"><a href="#8559"> 8559: </a><span class="php-comment">         * @since 1.1
</span></span><span id="8560" class="l"><a href="#8560"> 8560: </a><span class="php-comment">         */</span>
</span><span id="8561" class="l"><a href="#8561"> 8561: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setLanguageArray(<span class="php-var">$language</span>) {
</span><span id="8562" class="l"><a href="#8562"> 8562: </a>            <span class="php-var">$this</span>-&gt;l = <span class="php-var">$language</span>;
</span><span id="8563" class="l"><a href="#8563"> 8563: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;l[<span class="php-quote">'a_meta_dir'</span>])) {
</span><span id="8564" class="l"><a href="#8564"> 8564: </a>                <span class="php-var">$this</span>-&gt;rtl = <span class="php-var">$this</span>-&gt;l[<span class="php-quote">'a_meta_dir'</span>]==<span class="php-quote">'rtl'</span> ? <span class="php-keyword1">true</span> : <span class="php-keyword1">false</span>;
</span><span id="8565" class="l"><a href="#8565"> 8565: </a>            } <span class="php-keyword1">else</span> {
</span><span id="8566" class="l"><a href="#8566"> 8566: </a>                <span class="php-var">$this</span>-&gt;rtl = <span class="php-keyword1">false</span>;
</span><span id="8567" class="l"><a href="#8567"> 8567: </a>            }
</span><span id="8568" class="l"><a href="#8568"> 8568: </a>        }
</span><span id="8569" class="l"><a href="#8569"> 8569: </a>
</span><span id="8570" class="l"><a href="#8570"> 8570: </a>        <span class="php-comment">/**
</span></span><span id="8571" class="l"><a href="#8571"> 8571: </a><span class="php-comment">         * Returns the PDF data.
</span></span><span id="8572" class="l"><a href="#8572"> 8572: </a><span class="php-comment">         * @access public
</span></span><span id="8573" class="l"><a href="#8573"> 8573: </a><span class="php-comment">         */</span>
</span><span id="8574" class="l"><a href="#8574"> 8574: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getPDFData() {
</span><span id="8575" class="l"><a href="#8575"> 8575: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;state &lt; <span class="php-num">3</span>) {
</span><span id="8576" class="l"><a href="#8576"> 8576: </a>                <span class="php-var">$this</span>-&gt;Close();
</span><span id="8577" class="l"><a href="#8577"> 8577: </a>            }
</span><span id="8578" class="l"><a href="#8578"> 8578: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;buffer;
</span><span id="8579" class="l"><a href="#8579"> 8579: </a>        }
</span><span id="8580" class="l"><a href="#8580"> 8580: </a>
</span><span id="8581" class="l"><a href="#8581"> 8581: </a>        <span class="php-comment">/**
</span></span><span id="8582" class="l"><a href="#8582"> 8582: </a><span class="php-comment">         * Output anchor link.
</span></span><span id="8583" class="l"><a href="#8583"> 8583: </a><span class="php-comment">         * @param string $url link URL or internal link (i.e.: &amp;lt;a href=&quot;#23&quot;&amp;gt;link to page 23&amp;lt;/a&amp;gt;)
</span></span><span id="8584" class="l"><a href="#8584"> 8584: </a><span class="php-comment">         * @param string $name link name
</span></span><span id="8585" class="l"><a href="#8585"> 8585: </a><span class="php-comment">         * @param int $fill Indicates if the cell background must be painted (1) or transparent (0). Default value: 0.
</span></span><span id="8586" class="l"><a href="#8586"> 8586: </a><span class="php-comment">         * @param boolean $firstline if true prints only the first line and return the remaining string.
</span></span><span id="8587" class="l"><a href="#8587"> 8587: </a><span class="php-comment">         * @param array $color array of RGB text color
</span></span><span id="8588" class="l"><a href="#8588"> 8588: </a><span class="php-comment">         * @param string $style font style (U, D, B, I)
</span></span><span id="8589" class="l"><a href="#8589"> 8589: </a><span class="php-comment">         * @param boolean $firstblock if true the string is the starting of a line.
</span></span><span id="8590" class="l"><a href="#8590"> 8590: </a><span class="php-comment">         * @return the number of cells used or the remaining text if $firstline = true;
</span></span><span id="8591" class="l"><a href="#8591"> 8591: </a><span class="php-comment">         * @access public
</span></span><span id="8592" class="l"><a href="#8592"> 8592: </a><span class="php-comment">         */</span>
</span><span id="8593" class="l"><a href="#8593"> 8593: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> addHtmlLink(<span class="php-var">$url</span>, <span class="php-var">$name</span>, <span class="php-var">$fill</span>=<span class="php-num">0</span>, <span class="php-var">$firstline</span>=<span class="php-keyword1">false</span>, <span class="php-var">$color</span>=<span class="php-quote">''</span>, <span class="php-var">$style</span>=-<span class="php-num">1</span>, <span class="php-var">$firstblock</span>=<span class="php-keyword1">false</span>) {
</span><span id="8594" class="l"><a href="#8594"> 8594: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$url</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$url</span>{<span class="php-num">0</span>} == <span class="php-quote">'#'</span>)) {
</span><span id="8595" class="l"><a href="#8595"> 8595: </a>                <span class="php-comment">// convert url to internal link</span>
</span><span id="8596" class="l"><a href="#8596"> 8596: </a>                <span class="php-var">$page</span> = <span class="php-keyword2">intval</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$url</span>, <span class="php-num">1</span>));
</span><span id="8597" class="l"><a href="#8597"> 8597: </a>                <span class="php-var">$url</span> = <span class="php-var">$this</span>-&gt;AddLink();
</span><span id="8598" class="l"><a href="#8598"> 8598: </a>                <span class="php-var">$this</span>-&gt;SetLink(<span class="php-var">$url</span>, <span class="php-num">0</span>, <span class="php-var">$page</span>);
</span><span id="8599" class="l"><a href="#8599"> 8599: </a>            }
</span><span id="8600" class="l"><a href="#8600"> 8600: </a>            <span class="php-comment">// store current settings</span>
</span><span id="8601" class="l"><a href="#8601"> 8601: </a>            <span class="php-var">$prevcolor</span> = <span class="php-var">$this</span>-&gt;fgcolor;
</span><span id="8602" class="l"><a href="#8602"> 8602: </a>            <span class="php-var">$prevstyle</span> = <span class="php-var">$this</span>-&gt;FontStyle;
</span><span id="8603" class="l"><a href="#8603"> 8603: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$color</span>)) {
</span><span id="8604" class="l"><a href="#8604"> 8604: </a>                <span class="php-var">$this</span>-&gt;SetTextColorArray(<span class="php-var">$this</span>-&gt;htmlLinkColorArray);
</span><span id="8605" class="l"><a href="#8605"> 8605: </a>            } <span class="php-keyword1">else</span> {
</span><span id="8606" class="l"><a href="#8606"> 8606: </a>                <span class="php-var">$this</span>-&gt;SetTextColorArray(<span class="php-var">$color</span>);
</span><span id="8607" class="l"><a href="#8607"> 8607: </a>            }
</span><span id="8608" class="l"><a href="#8608"> 8608: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span> == -<span class="php-num">1</span>) {
</span><span id="8609" class="l"><a href="#8609"> 8609: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-quote">''</span>, <span class="php-var">$this</span>-&gt;FontStyle.<span class="php-var">$this</span>-&gt;htmlLinkFontStyle);
</span><span id="8610" class="l"><a href="#8610"> 8610: </a>            } <span class="php-keyword1">else</span> {
</span><span id="8611" class="l"><a href="#8611"> 8611: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-quote">''</span>, <span class="php-var">$this</span>-&gt;FontStyle.<span class="php-var">$style</span>);
</span><span id="8612" class="l"><a href="#8612"> 8612: </a>            }
</span><span id="8613" class="l"><a href="#8613"> 8613: </a>            <span class="php-var">$ret</span> = <span class="php-var">$this</span>-&gt;Write(<span class="php-var">$this</span>-&gt;lasth, <span class="php-var">$name</span>, <span class="php-var">$url</span>, <span class="php-var">$fill</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>, <span class="php-var">$firstline</span>, <span class="php-var">$firstblock</span>, <span class="php-num">0</span>);
</span><span id="8614" class="l"><a href="#8614"> 8614: </a>            <span class="php-comment">// restore settings</span>
</span><span id="8615" class="l"><a href="#8615"> 8615: </a>            <span class="php-var">$this</span>-&gt;SetFont(<span class="php-quote">''</span>, <span class="php-var">$prevstyle</span>);
</span><span id="8616" class="l"><a href="#8616"> 8616: </a>            <span class="php-var">$this</span>-&gt;SetTextColorArray(<span class="php-var">$prevcolor</span>);
</span><span id="8617" class="l"><a href="#8617"> 8617: </a>            <span class="php-keyword1">return</span> <span class="php-var">$ret</span>;
</span><span id="8618" class="l"><a href="#8618"> 8618: </a>        }
</span><span id="8619" class="l"><a href="#8619"> 8619: </a>
</span><span id="8620" class="l"><a href="#8620"> 8620: </a>        <span class="php-comment">/**
</span></span><span id="8621" class="l"><a href="#8621"> 8621: </a><span class="php-comment">         * Returns an associative array (keys: R,G,B) from an html color name or a six-digit or three-digit hexadecimal color representation (i.e. #3FE5AA or #7FF).
</span></span><span id="8622" class="l"><a href="#8622"> 8622: </a><span class="php-comment">         * @param string $color html color
</span></span><span id="8623" class="l"><a href="#8623"> 8623: </a><span class="php-comment">         * @return array RGB color or false in case of error.
</span></span><span id="8624" class="l"><a href="#8624"> 8624: </a><span class="php-comment">         * @access public
</span></span><span id="8625" class="l"><a href="#8625"> 8625: </a><span class="php-comment">         */</span>
</span><span id="8626" class="l"><a href="#8626"> 8626: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> convertHTMLColorToDec(<span class="php-var">$color</span>=<span class="php-quote">'#FFFFFF'</span>) {
</span><span id="8627" class="l"><a href="#8627"> 8627: </a>            <span class="php-keyword1">global</span> <span class="php-var">$webcolor</span>;
</span><span id="8628" class="l"><a href="#8628"> 8628: </a>            <span class="php-var">$returncolor</span> = <span class="php-keyword1">false</span>;
</span><span id="8629" class="l"><a href="#8629"> 8629: </a>            <span class="php-var">$color</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]*/'</span>, <span class="php-quote">''</span>, <span class="php-var">$color</span>); <span class="php-comment">// remove extra spaces</span>
</span><span id="8630" class="l"><a href="#8630"> 8630: </a>            <span class="php-var">$color</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$color</span>);
</span><span id="8631" class="l"><a href="#8631"> 8631: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$dotpos</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$color</span>, <span class="php-quote">'.'</span>)) !== <span class="php-keyword1">false</span>) {
</span><span id="8632" class="l"><a href="#8632"> 8632: </a>                <span class="php-comment">// remove class parent (i.e.: color.red)</span>
</span><span id="8633" class="l"><a href="#8633"> 8633: </a>                <span class="php-var">$color</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$color</span>, (<span class="php-var">$dotpos</span> + <span class="php-num">1</span>));
</span><span id="8634" class="l"><a href="#8634"> 8634: </a>            }
</span><span id="8635" class="l"><a href="#8635"> 8635: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$color</span>) == <span class="php-num">0</span>) {
</span><span id="8636" class="l"><a href="#8636"> 8636: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="8637" class="l"><a href="#8637"> 8637: </a>            }
</span><span id="8638" class="l"><a href="#8638"> 8638: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$color</span>, <span class="php-num">0</span>, <span class="php-num">3</span>) == <span class="php-quote">'rgb'</span>) {
</span><span id="8639" class="l"><a href="#8639"> 8639: </a>                <span class="php-var">$codes</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$color</span>, <span class="php-num">4</span>);
</span><span id="8640" class="l"><a href="#8640"> 8640: </a>                <span class="php-var">$codes</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">')'</span>, <span class="php-quote">''</span>, <span class="php-var">$codes</span>);
</span><span id="8641" class="l"><a href="#8641"> 8641: </a>                <span class="php-var">$returncolor</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">','</span>, <span class="php-var">$codes</span>, <span class="php-num">3</span>);
</span><span id="8642" class="l"><a href="#8642"> 8642: </a>                <span class="php-keyword1">return</span> <span class="php-var">$returncolor</span>;
</span><span id="8643" class="l"><a href="#8643"> 8643: </a>            }
</span><span id="8644" class="l"><a href="#8644"> 8644: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$color</span>, <span class="php-num">0</span>, <span class="php-num">1</span>) != <span class="php-quote">'#'</span>) {
</span><span id="8645" class="l"><a href="#8645"> 8645: </a>                <span class="php-comment">// decode color name</span>
</span><span id="8646" class="l"><a href="#8646"> 8646: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$webcolor</span>[<span class="php-var">$color</span>])) {
</span><span id="8647" class="l"><a href="#8647"> 8647: </a>                    <span class="php-var">$color_code</span> = <span class="php-var">$webcolor</span>[<span class="php-var">$color</span>];
</span><span id="8648" class="l"><a href="#8648"> 8648: </a>                } <span class="php-keyword1">else</span> {
</span><span id="8649" class="l"><a href="#8649"> 8649: </a>                    <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="8650" class="l"><a href="#8650"> 8650: </a>                }
</span><span id="8651" class="l"><a href="#8651"> 8651: </a>            } <span class="php-keyword1">else</span> {
</span><span id="8652" class="l"><a href="#8652"> 8652: </a>                <span class="php-var">$color_code</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$color</span>, <span class="php-num">1</span>);
</span><span id="8653" class="l"><a href="#8653"> 8653: </a>            }
</span><span id="8654" class="l"><a href="#8654"> 8654: </a>            <span class="php-keyword1">switch</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$color_code</span>)) {
</span><span id="8655" class="l"><a href="#8655"> 8655: </a>                <span class="php-keyword1">case</span> <span class="php-num">3</span>: {
</span><span id="8656" class="l"><a href="#8656"> 8656: </a>                    <span class="php-comment">// three-digit hexadecimal representation</span>
</span><span id="8657" class="l"><a href="#8657"> 8657: </a>                    <span class="php-var">$r</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$color_code</span>, <span class="php-num">0</span>, <span class="php-num">1</span>);
</span><span id="8658" class="l"><a href="#8658"> 8658: </a>                    <span class="php-var">$g</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$color_code</span>, <span class="php-num">1</span>, <span class="php-num">1</span>);
</span><span id="8659" class="l"><a href="#8659"> 8659: </a>                    <span class="php-var">$b</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$color_code</span>, <span class="php-num">2</span>, <span class="php-num">1</span>);
</span><span id="8660" class="l"><a href="#8660"> 8660: </a>                    <span class="php-var">$returncolor</span>[<span class="php-quote">'R'</span>] = <span class="php-keyword2">hexdec</span>(<span class="php-var">$r</span>.<span class="php-var">$r</span>);
</span><span id="8661" class="l"><a href="#8661"> 8661: </a>                    <span class="php-var">$returncolor</span>[<span class="php-quote">'G'</span>] = <span class="php-keyword2">hexdec</span>(<span class="php-var">$g</span>.<span class="php-var">$g</span>);
</span><span id="8662" class="l"><a href="#8662"> 8662: </a>                    <span class="php-var">$returncolor</span>[<span class="php-quote">'B'</span>] = <span class="php-keyword2">hexdec</span>(<span class="php-var">$b</span>.<span class="php-var">$b</span>);
</span><span id="8663" class="l"><a href="#8663"> 8663: </a>                    <span class="php-keyword1">break</span>;
</span><span id="8664" class="l"><a href="#8664"> 8664: </a>                }
</span><span id="8665" class="l"><a href="#8665"> 8665: </a>                <span class="php-keyword1">case</span> <span class="php-num">6</span>: {
</span><span id="8666" class="l"><a href="#8666"> 8666: </a>                    <span class="php-comment">// six-digit hexadecimal representation</span>
</span><span id="8667" class="l"><a href="#8667"> 8667: </a>                    <span class="php-var">$returncolor</span>[<span class="php-quote">'R'</span>] = <span class="php-keyword2">hexdec</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$color_code</span>, <span class="php-num">0</span>, <span class="php-num">2</span>));
</span><span id="8668" class="l"><a href="#8668"> 8668: </a>                    <span class="php-var">$returncolor</span>[<span class="php-quote">'G'</span>] = <span class="php-keyword2">hexdec</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$color_code</span>, <span class="php-num">2</span>, <span class="php-num">2</span>));
</span><span id="8669" class="l"><a href="#8669"> 8669: </a>                    <span class="php-var">$returncolor</span>[<span class="php-quote">'B'</span>] = <span class="php-keyword2">hexdec</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$color_code</span>, <span class="php-num">4</span>, <span class="php-num">2</span>));
</span><span id="8670" class="l"><a href="#8670"> 8670: </a>                    <span class="php-keyword1">break</span>;
</span><span id="8671" class="l"><a href="#8671"> 8671: </a>                }
</span><span id="8672" class="l"><a href="#8672"> 8672: </a>            }
</span><span id="8673" class="l"><a href="#8673"> 8673: </a>            <span class="php-keyword1">return</span> <span class="php-var">$returncolor</span>;
</span><span id="8674" class="l"><a href="#8674"> 8674: </a>        }
</span><span id="8675" class="l"><a href="#8675"> 8675: </a>
</span><span id="8676" class="l"><a href="#8676"> 8676: </a>        <span class="php-comment">/**
</span></span><span id="8677" class="l"><a href="#8677"> 8677: </a><span class="php-comment">         * Converts pixels to User's Units.
</span></span><span id="8678" class="l"><a href="#8678"> 8678: </a><span class="php-comment">         * @param int $px pixels
</span></span><span id="8679" class="l"><a href="#8679"> 8679: </a><span class="php-comment">         * @return float value in user's unit
</span></span><span id="8680" class="l"><a href="#8680"> 8680: </a><span class="php-comment">         * @access public
</span></span><span id="8681" class="l"><a href="#8681"> 8681: </a><span class="php-comment">         * @see setImageScale(), getImageScale()
</span></span><span id="8682" class="l"><a href="#8682"> 8682: </a><span class="php-comment">         */</span>
</span><span id="8683" class="l"><a href="#8683"> 8683: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> pixelsToUnits(<span class="php-var">$px</span>) {
</span><span id="8684" class="l"><a href="#8684"> 8684: </a>            <span class="php-keyword1">return</span> (<span class="php-var">$px</span> / (<span class="php-var">$this</span>-&gt;imgscale * <span class="php-var">$this</span>-&gt;k));
</span><span id="8685" class="l"><a href="#8685"> 8685: </a>        }
</span><span id="8686" class="l"><a href="#8686"> 8686: </a>
</span><span id="8687" class="l"><a href="#8687"> 8687: </a>        <span class="php-comment">/**
</span></span><span id="8688" class="l"><a href="#8688"> 8688: </a><span class="php-comment">         * Reverse function for htmlentities.
</span></span><span id="8689" class="l"><a href="#8689"> 8689: </a><span class="php-comment">         * Convert entities in UTF-8.
</span></span><span id="8690" class="l"><a href="#8690"> 8690: </a><span class="php-comment">         * @param $text_to_convert Text to convert.
</span></span><span id="8691" class="l"><a href="#8691"> 8691: </a><span class="php-comment">         * @return string converted
</span></span><span id="8692" class="l"><a href="#8692"> 8692: </a><span class="php-comment">         * @access public
</span></span><span id="8693" class="l"><a href="#8693"> 8693: </a><span class="php-comment">         */</span>
</span><span id="8694" class="l"><a href="#8694"> 8694: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> unhtmlentities(<span class="php-var">$text_to_convert</span>) {
</span><span id="8695" class="l"><a href="#8695"> 8695: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">html_entity_decode</span>(<span class="php-var">$text_to_convert</span>, ENT_QUOTES, <span class="php-var">$this</span>-&gt;encoding);
</span><span id="8696" class="l"><a href="#8696"> 8696: </a>        }
</span><span id="8697" class="l"><a href="#8697"> 8697: </a>
</span><span id="8698" class="l"><a href="#8698"> 8698: </a>        <span class="php-comment">// ENCRYPTION METHODS ----------------------------------</span>
</span><span id="8699" class="l"><a href="#8699"> 8699: </a>        <span class="php-comment">// SINCE 2.0.000 (2008-01-02)</span>
</span><span id="8700" class="l"><a href="#8700"> 8700: </a>
</span><span id="8701" class="l"><a href="#8701"> 8701: </a>        <span class="php-comment">/**
</span></span><span id="8702" class="l"><a href="#8702"> 8702: </a><span class="php-comment">         * Compute encryption key depending on object number where the encrypted data is stored
</span></span><span id="8703" class="l"><a href="#8703"> 8703: </a><span class="php-comment">         * @param int $n object number
</span></span><span id="8704" class="l"><a href="#8704"> 8704: </a><span class="php-comment">         * @access protected
</span></span><span id="8705" class="l"><a href="#8705"> 8705: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8706" class="l"><a href="#8706"> 8706: </a><span class="php-comment">         */</span>
</span><span id="8707" class="l"><a href="#8707"> 8707: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _objectkey(<span class="php-var">$n</span>) {
</span><span id="8708" class="l"><a href="#8708"> 8708: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;_md5_16(<span class="php-var">$this</span>-&gt;encryption_key.<span class="php-keyword2">pack</span>(<span class="php-quote">'VXxx'</span>, <span class="php-var">$n</span>)), <span class="php-num">0</span>, <span class="php-num">10</span>);
</span><span id="8709" class="l"><a href="#8709"> 8709: </a>        }
</span><span id="8710" class="l"><a href="#8710"> 8710: </a>
</span><span id="8711" class="l"><a href="#8711"> 8711: </a>        <span class="php-comment">/**
</span></span><span id="8712" class="l"><a href="#8712"> 8712: </a><span class="php-comment">         * Put encryption on PDF document.
</span></span><span id="8713" class="l"><a href="#8713"> 8713: </a><span class="php-comment">         * @access protected
</span></span><span id="8714" class="l"><a href="#8714"> 8714: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8715" class="l"><a href="#8715"> 8715: </a><span class="php-comment">         */</span>
</span><span id="8716" class="l"><a href="#8716"> 8716: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putencryption() {
</span><span id="8717" class="l"><a href="#8717"> 8717: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;encrypted) {
</span><span id="8718" class="l"><a href="#8718"> 8718: </a>                <span class="php-keyword1">return</span>;
</span><span id="8719" class="l"><a href="#8719"> 8719: </a>            }
</span><span id="8720" class="l"><a href="#8720"> 8720: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="8721" class="l"><a href="#8721"> 8721: </a>            <span class="php-var">$this</span>-&gt;enc_obj_id = <span class="php-var">$this</span>-&gt;n;
</span><span id="8722" class="l"><a href="#8722"> 8722: </a>            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Filter /Standard /V 1 /R 2'</span>;
</span><span id="8723" class="l"><a href="#8723"> 8723: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /O ('</span>.<span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;Ovalue).<span class="php-quote">')'</span>;
</span><span id="8724" class="l"><a href="#8724"> 8724: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /U ('</span>.<span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;Uvalue).<span class="php-quote">')'</span>;
</span><span id="8725" class="l"><a href="#8725"> 8725: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /P '</span>.<span class="php-var">$this</span>-&gt;Pvalue;
</span><span id="8726" class="l"><a href="#8726"> 8726: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="8727" class="l"><a href="#8727"> 8727: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="8728" class="l"><a href="#8728"> 8728: </a>        }
</span><span id="8729" class="l"><a href="#8729"> 8729: </a>
</span><span id="8730" class="l"><a href="#8730"> 8730: </a>        <span class="php-comment">/**
</span></span><span id="8731" class="l"><a href="#8731"> 8731: </a><span class="php-comment">         * Returns the input text exrypted using RC4 algorithm and the specified key.
</span></span><span id="8732" class="l"><a href="#8732"> 8732: </a><span class="php-comment">         * RC4 is the standard encryption algorithm used in PDF format
</span></span><span id="8733" class="l"><a href="#8733"> 8733: </a><span class="php-comment">         * @param string $key encryption key
</span></span><span id="8734" class="l"><a href="#8734"> 8734: </a><span class="php-comment">         * @param String $text input text to be encrypted
</span></span><span id="8735" class="l"><a href="#8735"> 8735: </a><span class="php-comment">         * @return String encrypted text
</span></span><span id="8736" class="l"><a href="#8736"> 8736: </a><span class="php-comment">         * @access protected
</span></span><span id="8737" class="l"><a href="#8737"> 8737: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8738" class="l"><a href="#8738"> 8738: </a><span class="php-comment">         * @author Klemen Vodopivec
</span></span><span id="8739" class="l"><a href="#8739"> 8739: </a><span class="php-comment">         */</span>
</span><span id="8740" class="l"><a href="#8740"> 8740: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _RC4(<span class="php-var">$key</span>, <span class="php-var">$text</span>) {
</span><span id="8741" class="l"><a href="#8741"> 8741: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;last_rc4_key != <span class="php-var">$key</span>) {
</span><span id="8742" class="l"><a href="#8742"> 8742: </a>                <span class="php-var">$k</span> = <span class="php-keyword2">str_repeat</span>(<span class="php-var">$key</span>, ((<span class="php-num">256</span> / <span class="php-keyword2">strlen</span>(<span class="php-var">$key</span>)) + <span class="php-num">1</span>));
</span><span id="8743" class="l"><a href="#8743"> 8743: </a>                <span class="php-var">$rc4</span> = <span class="php-keyword2">range</span>(<span class="php-num">0</span>, <span class="php-num">255</span>);
</span><span id="8744" class="l"><a href="#8744"> 8744: </a>                <span class="php-var">$j</span> = <span class="php-num">0</span>;
</span><span id="8745" class="l"><a href="#8745"> 8745: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-num">256</span>; ++<span class="php-var">$i</span>) {
</span><span id="8746" class="l"><a href="#8746"> 8746: </a>                    <span class="php-var">$t</span> = <span class="php-var">$rc4</span>[<span class="php-var">$i</span>];
</span><span id="8747" class="l"><a href="#8747"> 8747: </a>                    <span class="php-var">$j</span> = (<span class="php-var">$j</span> + <span class="php-var">$t</span> + <span class="php-keyword2">ord</span>(<span class="php-var">$k</span>{<span class="php-var">$i</span>})) % <span class="php-num">256</span>;
</span><span id="8748" class="l"><a href="#8748"> 8748: </a>                    <span class="php-var">$rc4</span>[<span class="php-var">$i</span>] = <span class="php-var">$rc4</span>[<span class="php-var">$j</span>];
</span><span id="8749" class="l"><a href="#8749"> 8749: </a>                    <span class="php-var">$rc4</span>[<span class="php-var">$j</span>] = <span class="php-var">$t</span>;
</span><span id="8750" class="l"><a href="#8750"> 8750: </a>                }
</span><span id="8751" class="l"><a href="#8751"> 8751: </a>                <span class="php-var">$this</span>-&gt;last_rc4_key = <span class="php-var">$key</span>;
</span><span id="8752" class="l"><a href="#8752"> 8752: </a>                <span class="php-var">$this</span>-&gt;last_rc4_key_c = <span class="php-var">$rc4</span>;
</span><span id="8753" class="l"><a href="#8753"> 8753: </a>            } <span class="php-keyword1">else</span> {
</span><span id="8754" class="l"><a href="#8754"> 8754: </a>                <span class="php-var">$rc4</span> = <span class="php-var">$this</span>-&gt;last_rc4_key_c;
</span><span id="8755" class="l"><a href="#8755"> 8755: </a>            }
</span><span id="8756" class="l"><a href="#8756"> 8756: </a>            <span class="php-var">$len</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$text</span>);
</span><span id="8757" class="l"><a href="#8757"> 8757: </a>            <span class="php-var">$a</span> = <span class="php-num">0</span>;
</span><span id="8758" class="l"><a href="#8758"> 8758: </a>            <span class="php-var">$b</span> = <span class="php-num">0</span>;
</span><span id="8759" class="l"><a href="#8759"> 8759: </a>            <span class="php-var">$out</span> = <span class="php-quote">''</span>;
</span><span id="8760" class="l"><a href="#8760"> 8760: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$len</span>; ++<span class="php-var">$i</span>) {
</span><span id="8761" class="l"><a href="#8761"> 8761: </a>                <span class="php-var">$a</span> = (<span class="php-var">$a</span> + <span class="php-num">1</span>) % <span class="php-num">256</span>;
</span><span id="8762" class="l"><a href="#8762"> 8762: </a>                <span class="php-var">$t</span> = <span class="php-var">$rc4</span>[<span class="php-var">$a</span>];
</span><span id="8763" class="l"><a href="#8763"> 8763: </a>                <span class="php-var">$b</span> = (<span class="php-var">$b</span> + <span class="php-var">$t</span>) % <span class="php-num">256</span>;
</span><span id="8764" class="l"><a href="#8764"> 8764: </a>                <span class="php-var">$rc4</span>[<span class="php-var">$a</span>] = <span class="php-var">$rc4</span>[<span class="php-var">$b</span>];
</span><span id="8765" class="l"><a href="#8765"> 8765: </a>                <span class="php-var">$rc4</span>[<span class="php-var">$b</span>] = <span class="php-var">$t</span>;
</span><span id="8766" class="l"><a href="#8766"> 8766: </a>                <span class="php-var">$k</span> = <span class="php-var">$rc4</span>[(<span class="php-var">$rc4</span>[<span class="php-var">$a</span>] + <span class="php-var">$rc4</span>[<span class="php-var">$b</span>]) % <span class="php-num">256</span>];
</span><span id="8767" class="l"><a href="#8767"> 8767: </a>                <span class="php-var">$out</span> .= <span class="php-keyword2">chr</span>(<span class="php-keyword2">ord</span>(<span class="php-var">$text</span>{<span class="php-var">$i</span>}) ^ <span class="php-var">$k</span>);
</span><span id="8768" class="l"><a href="#8768"> 8768: </a>            }
</span><span id="8769" class="l"><a href="#8769"> 8769: </a>            <span class="php-keyword1">return</span> <span class="php-var">$out</span>;
</span><span id="8770" class="l"><a href="#8770"> 8770: </a>        }
</span><span id="8771" class="l"><a href="#8771"> 8771: </a>
</span><span id="8772" class="l"><a href="#8772"> 8772: </a>        <span class="php-comment">/**
</span></span><span id="8773" class="l"><a href="#8773"> 8773: </a><span class="php-comment">         * Encrypts a string using MD5 and returns it's value as a binary string.
</span></span><span id="8774" class="l"><a href="#8774"> 8774: </a><span class="php-comment">         * @param string $str input string
</span></span><span id="8775" class="l"><a href="#8775"> 8775: </a><span class="php-comment">         * @return String MD5 encrypted binary string
</span></span><span id="8776" class="l"><a href="#8776"> 8776: </a><span class="php-comment">         * @access protected
</span></span><span id="8777" class="l"><a href="#8777"> 8777: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8778" class="l"><a href="#8778"> 8778: </a><span class="php-comment">         * @author Klemen Vodopivec
</span></span><span id="8779" class="l"><a href="#8779"> 8779: </a><span class="php-comment">         */</span>
</span><span id="8780" class="l"><a href="#8780"> 8780: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _md5_16(<span class="php-var">$str</span>) {
</span><span id="8781" class="l"><a href="#8781"> 8781: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">pack</span>(<span class="php-quote">'H*'</span>, <span class="php-keyword2">md5</span>(<span class="php-var">$str</span>));
</span><span id="8782" class="l"><a href="#8782"> 8782: </a>        }
</span><span id="8783" class="l"><a href="#8783"> 8783: </a>
</span><span id="8784" class="l"><a href="#8784"> 8784: </a>        <span class="php-comment">/**
</span></span><span id="8785" class="l"><a href="#8785"> 8785: </a><span class="php-comment">         * Compute O value (used for RC4 encryption)
</span></span><span id="8786" class="l"><a href="#8786"> 8786: </a><span class="php-comment">         * @param String $user_pass user password
</span></span><span id="8787" class="l"><a href="#8787"> 8787: </a><span class="php-comment">         * @param String $owner_pass user password
</span></span><span id="8788" class="l"><a href="#8788"> 8788: </a><span class="php-comment">         * @return String O value
</span></span><span id="8789" class="l"><a href="#8789"> 8789: </a><span class="php-comment">         * @access protected
</span></span><span id="8790" class="l"><a href="#8790"> 8790: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8791" class="l"><a href="#8791"> 8791: </a><span class="php-comment">         * @author Klemen Vodopivec
</span></span><span id="8792" class="l"><a href="#8792"> 8792: </a><span class="php-comment">         */</span>
</span><span id="8793" class="l"><a href="#8793"> 8793: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _Ovalue(<span class="php-var">$user_pass</span>, <span class="php-var">$owner_pass</span>) {
</span><span id="8794" class="l"><a href="#8794"> 8794: </a>            <span class="php-var">$tmp</span> = <span class="php-var">$this</span>-&gt;_md5_16(<span class="php-var">$owner_pass</span>);
</span><span id="8795" class="l"><a href="#8795"> 8795: </a>            <span class="php-var">$owner_RC4_key</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$tmp</span>, <span class="php-num">0</span>, <span class="php-num">5</span>);
</span><span id="8796" class="l"><a href="#8796"> 8796: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_RC4(<span class="php-var">$owner_RC4_key</span>, <span class="php-var">$user_pass</span>);
</span><span id="8797" class="l"><a href="#8797"> 8797: </a>        }
</span><span id="8798" class="l"><a href="#8798"> 8798: </a>
</span><span id="8799" class="l"><a href="#8799"> 8799: </a>        <span class="php-comment">/**
</span></span><span id="8800" class="l"><a href="#8800"> 8800: </a><span class="php-comment">         * Compute U value (used for RC4 encryption)
</span></span><span id="8801" class="l"><a href="#8801"> 8801: </a><span class="php-comment">         * @return String U value
</span></span><span id="8802" class="l"><a href="#8802"> 8802: </a><span class="php-comment">         * @access protected
</span></span><span id="8803" class="l"><a href="#8803"> 8803: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8804" class="l"><a href="#8804"> 8804: </a><span class="php-comment">         * @author Klemen Vodopivec
</span></span><span id="8805" class="l"><a href="#8805"> 8805: </a><span class="php-comment">         */</span>
</span><span id="8806" class="l"><a href="#8806"> 8806: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _Uvalue() {
</span><span id="8807" class="l"><a href="#8807"> 8807: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;_RC4(<span class="php-var">$this</span>-&gt;encryption_key, <span class="php-var">$this</span>-&gt;padding);
</span><span id="8808" class="l"><a href="#8808"> 8808: </a>        }
</span><span id="8809" class="l"><a href="#8809"> 8809: </a>
</span><span id="8810" class="l"><a href="#8810"> 8810: </a>        <span class="php-comment">/**
</span></span><span id="8811" class="l"><a href="#8811"> 8811: </a><span class="php-comment">         * Compute encryption key
</span></span><span id="8812" class="l"><a href="#8812"> 8812: </a><span class="php-comment">         * @param String $user_pass user password
</span></span><span id="8813" class="l"><a href="#8813"> 8813: </a><span class="php-comment">         * @param String $owner_pass user password
</span></span><span id="8814" class="l"><a href="#8814"> 8814: </a><span class="php-comment">         * @param String $protection protection type
</span></span><span id="8815" class="l"><a href="#8815"> 8815: </a><span class="php-comment">         * @access protected
</span></span><span id="8816" class="l"><a href="#8816"> 8816: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8817" class="l"><a href="#8817"> 8817: </a><span class="php-comment">         * @author Klemen Vodopivec
</span></span><span id="8818" class="l"><a href="#8818"> 8818: </a><span class="php-comment">         */</span>
</span><span id="8819" class="l"><a href="#8819"> 8819: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _generateencryptionkey(<span class="php-var">$user_pass</span>, <span class="php-var">$owner_pass</span>, <span class="php-var">$protection</span>) {
</span><span id="8820" class="l"><a href="#8820"> 8820: </a>            <span class="php-comment">// Pad passwords</span>
</span><span id="8821" class="l"><a href="#8821"> 8821: </a>            <span class="php-var">$user_pass</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$user_pass</span>.<span class="php-var">$this</span>-&gt;padding, <span class="php-num">0</span>, <span class="php-num">32</span>);
</span><span id="8822" class="l"><a href="#8822"> 8822: </a>            <span class="php-var">$owner_pass</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$owner_pass</span>.<span class="php-var">$this</span>-&gt;padding, <span class="php-num">0</span>, <span class="php-num">32</span>);
</span><span id="8823" class="l"><a href="#8823"> 8823: </a>            <span class="php-comment">// Compute O value</span>
</span><span id="8824" class="l"><a href="#8824"> 8824: </a>            <span class="php-var">$this</span>-&gt;Ovalue = <span class="php-var">$this</span>-&gt;_Ovalue(<span class="php-var">$user_pass</span>, <span class="php-var">$owner_pass</span>);
</span><span id="8825" class="l"><a href="#8825"> 8825: </a>            <span class="php-comment">// Compute encyption key</span>
</span><span id="8826" class="l"><a href="#8826"> 8826: </a>            <span class="php-var">$tmp</span> = <span class="php-var">$this</span>-&gt;_md5_16(<span class="php-var">$user_pass</span>.<span class="php-var">$this</span>-&gt;Ovalue.<span class="php-keyword2">chr</span>(<span class="php-var">$protection</span>).<span class="php-quote">&quot;\xFF\xFF\xFF&quot;</span>);
</span><span id="8827" class="l"><a href="#8827"> 8827: </a>            <span class="php-var">$this</span>-&gt;encryption_key = <span class="php-keyword2">substr</span>(<span class="php-var">$tmp</span>, <span class="php-num">0</span>, <span class="php-num">5</span>);
</span><span id="8828" class="l"><a href="#8828"> 8828: </a>            <span class="php-comment">// Compute U value</span>
</span><span id="8829" class="l"><a href="#8829"> 8829: </a>            <span class="php-var">$this</span>-&gt;Uvalue = <span class="php-var">$this</span>-&gt;_Uvalue();
</span><span id="8830" class="l"><a href="#8830"> 8830: </a>            <span class="php-comment">// Compute P value</span>
</span><span id="8831" class="l"><a href="#8831"> 8831: </a>            <span class="php-var">$this</span>-&gt;Pvalue = -((<span class="php-var">$protection</span>^<span class="php-num">255</span>) + <span class="php-num">1</span>);
</span><span id="8832" class="l"><a href="#8832"> 8832: </a>        }
</span><span id="8833" class="l"><a href="#8833"> 8833: </a>
</span><span id="8834" class="l"><a href="#8834"> 8834: </a>        <span class="php-comment">/**
</span></span><span id="8835" class="l"><a href="#8835"> 8835: </a><span class="php-comment">         * Set document protection
</span></span><span id="8836" class="l"><a href="#8836"> 8836: </a><span class="php-comment">         * The permission array is composed of values taken from the following ones:
</span></span><span id="8837" class="l"><a href="#8837"> 8837: </a><span class="php-comment">         * - copy: copy text and images to the clipboard
</span></span><span id="8838" class="l"><a href="#8838"> 8838: </a><span class="php-comment">         * - print: print the document
</span></span><span id="8839" class="l"><a href="#8839"> 8839: </a><span class="php-comment">         * - modify: modify it (except for annotations and forms)
</span></span><span id="8840" class="l"><a href="#8840"> 8840: </a><span class="php-comment">         * - annot-forms: add annotations and forms
</span></span><span id="8841" class="l"><a href="#8841"> 8841: </a><span class="php-comment">         * Remark: the protection against modification is for people who have the full Acrobat product.
</span></span><span id="8842" class="l"><a href="#8842"> 8842: </a><span class="php-comment">         * If you don't set any password, the document will open as usual. If you set a user password, the PDF viewer will ask for it before displaying the document. The master password, if different from the user one, can be used to get full access.
</span></span><span id="8843" class="l"><a href="#8843"> 8843: </a><span class="php-comment">         * Note: protecting a document requires to encrypt it, which increases the processing time a lot. This can cause a PHP time-out in some cases, especially if the document contains images or fonts.
</span></span><span id="8844" class="l"><a href="#8844"> 8844: </a><span class="php-comment">         * @param Array $permissions the set of permissions. Empty by default (only viewing is allowed). (print, modify, copy, annot-forms)
</span></span><span id="8845" class="l"><a href="#8845"> 8845: </a><span class="php-comment">         * @param String $user_pass user password. Empty by default.
</span></span><span id="8846" class="l"><a href="#8846"> 8846: </a><span class="php-comment">         * @param String $owner_pass owner password. If not specified, a random value is used.
</span></span><span id="8847" class="l"><a href="#8847"> 8847: </a><span class="php-comment">         * @access public
</span></span><span id="8848" class="l"><a href="#8848"> 8848: </a><span class="php-comment">         * @since 2.0.000 (2008-01-02)
</span></span><span id="8849" class="l"><a href="#8849"> 8849: </a><span class="php-comment">         * @author Klemen Vodopivec
</span></span><span id="8850" class="l"><a href="#8850"> 8850: </a><span class="php-comment">         */</span>
</span><span id="8851" class="l"><a href="#8851"> 8851: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetProtection(<span class="php-var">$permissions</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$user_pass</span>=<span class="php-quote">''</span>, <span class="php-var">$owner_pass</span>=<span class="php-keyword1">null</span>) {
</span><span id="8852" class="l"><a href="#8852"> 8852: </a>            <span class="php-var">$options</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'print'</span> =&gt; <span class="php-num">4</span>, <span class="php-quote">'modify'</span> =&gt; <span class="php-num">8</span>, <span class="php-quote">'copy'</span> =&gt; <span class="php-num">16</span>, <span class="php-quote">'annot-forms'</span> =&gt; <span class="php-num">32</span>);
</span><span id="8853" class="l"><a href="#8853"> 8853: </a>            <span class="php-var">$protection</span> = <span class="php-num">192</span>;
</span><span id="8854" class="l"><a href="#8854"> 8854: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$permissions</span> <span class="php-keyword1">as</span> <span class="php-var">$permission</span>) {
</span><span id="8855" class="l"><a href="#8855"> 8855: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$options</span>[<span class="php-var">$permission</span>])) {
</span><span id="8856" class="l"><a href="#8856"> 8856: </a>                    <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Incorrect permission: '</span>.<span class="php-var">$permission</span>);
</span><span id="8857" class="l"><a href="#8857"> 8857: </a>                }
</span><span id="8858" class="l"><a href="#8858"> 8858: </a>                <span class="php-var">$protection</span> += <span class="php-var">$options</span>[<span class="php-var">$permission</span>];
</span><span id="8859" class="l"><a href="#8859"> 8859: </a>            }
</span><span id="8860" class="l"><a href="#8860"> 8860: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$owner_pass</span> === <span class="php-keyword1">null</span>) {
</span><span id="8861" class="l"><a href="#8861"> 8861: </a>                <span class="php-var">$owner_pass</span> = <span class="php-keyword2">uniqid</span>(<span class="php-keyword2">rand</span>());
</span><span id="8862" class="l"><a href="#8862"> 8862: </a>            }
</span><span id="8863" class="l"><a href="#8863"> 8863: </a>            <span class="php-var">$this</span>-&gt;encrypted = <span class="php-keyword1">true</span>;
</span><span id="8864" class="l"><a href="#8864"> 8864: </a>            <span class="php-var">$this</span>-&gt;_generateencryptionkey(<span class="php-var">$user_pass</span>, <span class="php-var">$owner_pass</span>, <span class="php-var">$protection</span>);
</span><span id="8865" class="l"><a href="#8865"> 8865: </a>        }
</span><span id="8866" class="l"><a href="#8866"> 8866: </a>
</span><span id="8867" class="l"><a href="#8867"> 8867: </a>        <span class="php-comment">// END OF ENCRYPTION FUNCTIONS -------------------------</span>
</span><span id="8868" class="l"><a href="#8868"> 8868: </a>
</span><span id="8869" class="l"><a href="#8869"> 8869: </a>        <span class="php-comment">// START TRANSFORMATIONS SECTION -----------------------</span>
</span><span id="8870" class="l"><a href="#8870"> 8870: </a>
</span><span id="8871" class="l"><a href="#8871"> 8871: </a>        <span class="php-comment">/**
</span></span><span id="8872" class="l"><a href="#8872"> 8872: </a><span class="php-comment">         * Starts a 2D tranformation saving current graphic state.
</span></span><span id="8873" class="l"><a href="#8873"> 8873: </a><span class="php-comment">         * This function must be called before scaling, mirroring, translation, rotation and skewing.
</span></span><span id="8874" class="l"><a href="#8874"> 8874: </a><span class="php-comment">         * Use StartTransform() before, and StopTransform() after the transformations to restore the normal behavior.
</span></span><span id="8875" class="l"><a href="#8875"> 8875: </a><span class="php-comment">         * @access public
</span></span><span id="8876" class="l"><a href="#8876"> 8876: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8877" class="l"><a href="#8877"> 8877: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8878" class="l"><a href="#8878"> 8878: </a><span class="php-comment">         */</span>
</span><span id="8879" class="l"><a href="#8879"> 8879: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> StartTransform() {
</span><span id="8880" class="l"><a href="#8880"> 8880: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'q'</span>);
</span><span id="8881" class="l"><a href="#8881"> 8881: </a>            <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page][] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="8882" class="l"><a href="#8882"> 8882: </a>            ++<span class="php-var">$this</span>-&gt;transfmatrix_key;
</span><span id="8883" class="l"><a href="#8883"> 8883: </a>            <span class="php-var">$this</span>-&gt;transfmatrix[<span class="php-var">$this</span>-&gt;transfmatrix_key] = <span class="php-keyword1">array</span>();
</span><span id="8884" class="l"><a href="#8884"> 8884: </a>        }
</span><span id="8885" class="l"><a href="#8885"> 8885: </a>
</span><span id="8886" class="l"><a href="#8886"> 8886: </a>        <span class="php-comment">/**
</span></span><span id="8887" class="l"><a href="#8887"> 8887: </a><span class="php-comment">         * Stops a 2D tranformation restoring previous graphic state.
</span></span><span id="8888" class="l"><a href="#8888"> 8888: </a><span class="php-comment">         * This function must be called after scaling, mirroring, translation, rotation and skewing.
</span></span><span id="8889" class="l"><a href="#8889"> 8889: </a><span class="php-comment">         * Use StartTransform() before, and StopTransform() after the transformations to restore the normal behavior.
</span></span><span id="8890" class="l"><a href="#8890"> 8890: </a><span class="php-comment">         * @access public
</span></span><span id="8891" class="l"><a href="#8891"> 8891: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8892" class="l"><a href="#8892"> 8892: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8893" class="l"><a href="#8893"> 8893: </a><span class="php-comment">         */</span>
</span><span id="8894" class="l"><a href="#8894"> 8894: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> StopTransform() {
</span><span id="8895" class="l"><a href="#8895"> 8895: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'Q'</span>);
</span><span id="8896" class="l"><a href="#8896"> 8896: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmatrix[<span class="php-var">$this</span>-&gt;transfmatrix_key])) {
</span><span id="8897" class="l"><a href="#8897"> 8897: </a>                <span class="php-keyword2">array_pop</span>(<span class="php-var">$this</span>-&gt;transfmatrix[<span class="php-var">$this</span>-&gt;transfmatrix_key]);
</span><span id="8898" class="l"><a href="#8898"> 8898: </a>                --<span class="php-var">$this</span>-&gt;transfmatrix_key;
</span><span id="8899" class="l"><a href="#8899"> 8899: </a>            }
</span><span id="8900" class="l"><a href="#8900"> 8900: </a>            <span class="php-keyword2">array_pop</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="8901" class="l"><a href="#8901"> 8901: </a>        }
</span><span id="8902" class="l"><a href="#8902"> 8902: </a>        <span class="php-comment">/**
</span></span><span id="8903" class="l"><a href="#8903"> 8903: </a><span class="php-comment">         * Horizontal Scaling.
</span></span><span id="8904" class="l"><a href="#8904"> 8904: </a><span class="php-comment">         * @param float $s_x scaling factor for width as percent. 0 is not allowed.
</span></span><span id="8905" class="l"><a href="#8905"> 8905: </a><span class="php-comment">         * @param int $x abscissa of the scaling center. Default is current x position
</span></span><span id="8906" class="l"><a href="#8906"> 8906: </a><span class="php-comment">         * @param int $y ordinate of the scaling center. Default is current y position
</span></span><span id="8907" class="l"><a href="#8907"> 8907: </a><span class="php-comment">         * @access public
</span></span><span id="8908" class="l"><a href="#8908"> 8908: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8909" class="l"><a href="#8909"> 8909: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8910" class="l"><a href="#8910"> 8910: </a><span class="php-comment">         */</span>
</span><span id="8911" class="l"><a href="#8911"> 8911: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> ScaleX(<span class="php-var">$s_x</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="8912" class="l"><a href="#8912"> 8912: </a>            <span class="php-var">$this</span>-&gt;Scale(<span class="php-var">$s_x</span>, <span class="php-num">100</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="8913" class="l"><a href="#8913"> 8913: </a>        }
</span><span id="8914" class="l"><a href="#8914"> 8914: </a>
</span><span id="8915" class="l"><a href="#8915"> 8915: </a>        <span class="php-comment">/**
</span></span><span id="8916" class="l"><a href="#8916"> 8916: </a><span class="php-comment">         * Vertical Scaling.
</span></span><span id="8917" class="l"><a href="#8917"> 8917: </a><span class="php-comment">         * @param float $s_y scaling factor for height as percent. 0 is not allowed.
</span></span><span id="8918" class="l"><a href="#8918"> 8918: </a><span class="php-comment">         * @param int $x abscissa of the scaling center. Default is current x position
</span></span><span id="8919" class="l"><a href="#8919"> 8919: </a><span class="php-comment">         * @param int $y ordinate of the scaling center. Default is current y position
</span></span><span id="8920" class="l"><a href="#8920"> 8920: </a><span class="php-comment">         * @access public
</span></span><span id="8921" class="l"><a href="#8921"> 8921: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8922" class="l"><a href="#8922"> 8922: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8923" class="l"><a href="#8923"> 8923: </a><span class="php-comment">         */</span>
</span><span id="8924" class="l"><a href="#8924"> 8924: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> ScaleY(<span class="php-var">$s_y</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="8925" class="l"><a href="#8925"> 8925: </a>            <span class="php-var">$this</span>-&gt;Scale(<span class="php-num">100</span>, <span class="php-var">$s_y</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="8926" class="l"><a href="#8926"> 8926: </a>        }
</span><span id="8927" class="l"><a href="#8927"> 8927: </a>
</span><span id="8928" class="l"><a href="#8928"> 8928: </a>        <span class="php-comment">/**
</span></span><span id="8929" class="l"><a href="#8929"> 8929: </a><span class="php-comment">         * Vertical and horizontal proportional Scaling.
</span></span><span id="8930" class="l"><a href="#8930"> 8930: </a><span class="php-comment">         * @param float $s scaling factor for width and height as percent. 0 is not allowed.
</span></span><span id="8931" class="l"><a href="#8931"> 8931: </a><span class="php-comment">         * @param int $x abscissa of the scaling center. Default is current x position
</span></span><span id="8932" class="l"><a href="#8932"> 8932: </a><span class="php-comment">         * @param int $y ordinate of the scaling center. Default is current y position
</span></span><span id="8933" class="l"><a href="#8933"> 8933: </a><span class="php-comment">         * @access public
</span></span><span id="8934" class="l"><a href="#8934"> 8934: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8935" class="l"><a href="#8935"> 8935: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8936" class="l"><a href="#8936"> 8936: </a><span class="php-comment">         */</span>
</span><span id="8937" class="l"><a href="#8937"> 8937: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> ScaleXY(<span class="php-var">$s</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="8938" class="l"><a href="#8938"> 8938: </a>            <span class="php-var">$this</span>-&gt;Scale(<span class="php-var">$s</span>, <span class="php-var">$s</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="8939" class="l"><a href="#8939"> 8939: </a>        }
</span><span id="8940" class="l"><a href="#8940"> 8940: </a>
</span><span id="8941" class="l"><a href="#8941"> 8941: </a>        <span class="php-comment">/**
</span></span><span id="8942" class="l"><a href="#8942"> 8942: </a><span class="php-comment">         * Vertical and horizontal non-proportional Scaling.
</span></span><span id="8943" class="l"><a href="#8943"> 8943: </a><span class="php-comment">         * @param float $s_x scaling factor for width as percent. 0 is not allowed.
</span></span><span id="8944" class="l"><a href="#8944"> 8944: </a><span class="php-comment">         * @param float $s_y scaling factor for height as percent. 0 is not allowed.
</span></span><span id="8945" class="l"><a href="#8945"> 8945: </a><span class="php-comment">         * @param int $x abscissa of the scaling center. Default is current x position
</span></span><span id="8946" class="l"><a href="#8946"> 8946: </a><span class="php-comment">         * @param int $y ordinate of the scaling center. Default is current y position
</span></span><span id="8947" class="l"><a href="#8947"> 8947: </a><span class="php-comment">         * @access public
</span></span><span id="8948" class="l"><a href="#8948"> 8948: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8949" class="l"><a href="#8949"> 8949: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8950" class="l"><a href="#8950"> 8950: </a><span class="php-comment">         */</span>
</span><span id="8951" class="l"><a href="#8951"> 8951: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Scale(<span class="php-var">$s_x</span>, <span class="php-var">$s_y</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="8952" class="l"><a href="#8952"> 8952: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="8953" class="l"><a href="#8953"> 8953: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="8954" class="l"><a href="#8954"> 8954: </a>            }
</span><span id="8955" class="l"><a href="#8955"> 8955: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="8956" class="l"><a href="#8956"> 8956: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="8957" class="l"><a href="#8957"> 8957: </a>            }
</span><span id="8958" class="l"><a href="#8958"> 8958: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$s_x</span> == <span class="php-num">0</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$s_y</span> == <span class="php-num">0</span>)) {
</span><span id="8959" class="l"><a href="#8959"> 8959: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Please do not use values equal to zero for scaling'</span>);
</span><span id="8960" class="l"><a href="#8960"> 8960: </a>            }
</span><span id="8961" class="l"><a href="#8961"> 8961: </a>            <span class="php-var">$y</span> = (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="8962" class="l"><a href="#8962"> 8962: </a>            <span class="php-var">$x</span> *= <span class="php-var">$this</span>-&gt;k;
</span><span id="8963" class="l"><a href="#8963"> 8963: </a>            <span class="php-comment">//calculate elements of transformation matrix</span>
</span><span id="8964" class="l"><a href="#8964"> 8964: </a>            <span class="php-var">$s_x</span> /= <span class="php-num">100</span>;
</span><span id="8965" class="l"><a href="#8965"> 8965: </a>            <span class="php-var">$s_y</span> /= <span class="php-num">100</span>;
</span><span id="8966" class="l"><a href="#8966"> 8966: </a>            <span class="php-var">$tm</span>[<span class="php-num">0</span>] = <span class="php-var">$s_x</span>;
</span><span id="8967" class="l"><a href="#8967"> 8967: </a>            <span class="php-var">$tm</span>[<span class="php-num">1</span>] = <span class="php-num">0</span>;
</span><span id="8968" class="l"><a href="#8968"> 8968: </a>            <span class="php-var">$tm</span>[<span class="php-num">2</span>] = <span class="php-num">0</span>;
</span><span id="8969" class="l"><a href="#8969"> 8969: </a>            <span class="php-var">$tm</span>[<span class="php-num">3</span>] = <span class="php-var">$s_y</span>;
</span><span id="8970" class="l"><a href="#8970"> 8970: </a>            <span class="php-var">$tm</span>[<span class="php-num">4</span>] = <span class="php-var">$x</span> * (<span class="php-num">1</span> - <span class="php-var">$s_x</span>);
</span><span id="8971" class="l"><a href="#8971"> 8971: </a>            <span class="php-var">$tm</span>[<span class="php-num">5</span>] = <span class="php-var">$y</span> * (<span class="php-num">1</span> - <span class="php-var">$s_y</span>);
</span><span id="8972" class="l"><a href="#8972"> 8972: </a>            <span class="php-comment">//scale the coordinate system</span>
</span><span id="8973" class="l"><a href="#8973"> 8973: </a>            <span class="php-var">$this</span>-&gt;Transform(<span class="php-var">$tm</span>);
</span><span id="8974" class="l"><a href="#8974"> 8974: </a>        }
</span><span id="8975" class="l"><a href="#8975"> 8975: </a>
</span><span id="8976" class="l"><a href="#8976"> 8976: </a>        <span class="php-comment">/**
</span></span><span id="8977" class="l"><a href="#8977"> 8977: </a><span class="php-comment">         * Horizontal Mirroring.
</span></span><span id="8978" class="l"><a href="#8978"> 8978: </a><span class="php-comment">         * @param int $x abscissa of the point. Default is current x position
</span></span><span id="8979" class="l"><a href="#8979"> 8979: </a><span class="php-comment">         * @access public
</span></span><span id="8980" class="l"><a href="#8980"> 8980: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8981" class="l"><a href="#8981"> 8981: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8982" class="l"><a href="#8982"> 8982: </a><span class="php-comment">         */</span>
</span><span id="8983" class="l"><a href="#8983"> 8983: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> MirrorH(<span class="php-var">$x</span>=<span class="php-quote">''</span>) {
</span><span id="8984" class="l"><a href="#8984"> 8984: </a>            <span class="php-var">$this</span>-&gt;Scale(-<span class="php-num">100</span>, <span class="php-num">100</span>, <span class="php-var">$x</span>);
</span><span id="8985" class="l"><a href="#8985"> 8985: </a>        }
</span><span id="8986" class="l"><a href="#8986"> 8986: </a>
</span><span id="8987" class="l"><a href="#8987"> 8987: </a>        <span class="php-comment">/**
</span></span><span id="8988" class="l"><a href="#8988"> 8988: </a><span class="php-comment">         * Verical Mirroring.
</span></span><span id="8989" class="l"><a href="#8989"> 8989: </a><span class="php-comment">         * @param int $y ordinate of the point. Default is current y position
</span></span><span id="8990" class="l"><a href="#8990"> 8990: </a><span class="php-comment">         * @access public
</span></span><span id="8991" class="l"><a href="#8991"> 8991: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="8992" class="l"><a href="#8992"> 8992: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="8993" class="l"><a href="#8993"> 8993: </a><span class="php-comment">         */</span>
</span><span id="8994" class="l"><a href="#8994"> 8994: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> MirrorV(<span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="8995" class="l"><a href="#8995"> 8995: </a>            <span class="php-var">$this</span>-&gt;Scale(<span class="php-num">100</span>, -<span class="php-num">100</span>, <span class="php-quote">''</span>, <span class="php-var">$y</span>);
</span><span id="8996" class="l"><a href="#8996"> 8996: </a>        }
</span><span id="8997" class="l"><a href="#8997"> 8997: </a>
</span><span id="8998" class="l"><a href="#8998"> 8998: </a>        <span class="php-comment">/**
</span></span><span id="8999" class="l"><a href="#8999"> 8999: </a><span class="php-comment">         * Point reflection mirroring.
</span></span><span id="9000" class="l"><a href="#9000"> 9000: </a><span class="php-comment">         * @param int $x abscissa of the point. Default is current x position
</span></span><span id="9001" class="l"><a href="#9001"> 9001: </a><span class="php-comment">         * @param int $y ordinate of the point. Default is current y position
</span></span><span id="9002" class="l"><a href="#9002"> 9002: </a><span class="php-comment">         * @access public
</span></span><span id="9003" class="l"><a href="#9003"> 9003: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9004" class="l"><a href="#9004"> 9004: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9005" class="l"><a href="#9005"> 9005: </a><span class="php-comment">         */</span>
</span><span id="9006" class="l"><a href="#9006"> 9006: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> MirrorP(<span class="php-var">$x</span>=<span class="php-quote">''</span>,<span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="9007" class="l"><a href="#9007"> 9007: </a>            <span class="php-var">$this</span>-&gt;Scale(-<span class="php-num">100</span>, -<span class="php-num">100</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="9008" class="l"><a href="#9008"> 9008: </a>        }
</span><span id="9009" class="l"><a href="#9009"> 9009: </a>
</span><span id="9010" class="l"><a href="#9010"> 9010: </a>        <span class="php-comment">/**
</span></span><span id="9011" class="l"><a href="#9011"> 9011: </a><span class="php-comment">         * Reflection against a straight line through point (x, y) with the gradient angle (angle).
</span></span><span id="9012" class="l"><a href="#9012"> 9012: </a><span class="php-comment">         * @param float $angle gradient angle of the straight line. Default is 0 (horizontal line).
</span></span><span id="9013" class="l"><a href="#9013"> 9013: </a><span class="php-comment">         * @param int $x abscissa of the point. Default is current x position
</span></span><span id="9014" class="l"><a href="#9014"> 9014: </a><span class="php-comment">         * @param int $y ordinate of the point. Default is current y position
</span></span><span id="9015" class="l"><a href="#9015"> 9015: </a><span class="php-comment">         * @access public
</span></span><span id="9016" class="l"><a href="#9016"> 9016: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9017" class="l"><a href="#9017"> 9017: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9018" class="l"><a href="#9018"> 9018: </a><span class="php-comment">         */</span>
</span><span id="9019" class="l"><a href="#9019"> 9019: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> MirrorL(<span class="php-var">$angle</span>=<span class="php-num">0</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>,<span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="9020" class="l"><a href="#9020"> 9020: </a>            <span class="php-var">$this</span>-&gt;Scale(-<span class="php-num">100</span>, <span class="php-num">100</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="9021" class="l"><a href="#9021"> 9021: </a>            <span class="php-var">$this</span>-&gt;Rotate(-<span class="php-num">2</span>*(<span class="php-var">$angle</span>-<span class="php-num">90</span>), <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="9022" class="l"><a href="#9022"> 9022: </a>        }
</span><span id="9023" class="l"><a href="#9023"> 9023: </a>
</span><span id="9024" class="l"><a href="#9024"> 9024: </a>        <span class="php-comment">/**
</span></span><span id="9025" class="l"><a href="#9025"> 9025: </a><span class="php-comment">         * Translate graphic object horizontally.
</span></span><span id="9026" class="l"><a href="#9026"> 9026: </a><span class="php-comment">         * @param int $t_x movement to the right (or left for RTL)
</span></span><span id="9027" class="l"><a href="#9027"> 9027: </a><span class="php-comment">         * @access public
</span></span><span id="9028" class="l"><a href="#9028"> 9028: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9029" class="l"><a href="#9029"> 9029: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9030" class="l"><a href="#9030"> 9030: </a><span class="php-comment">         */</span>
</span><span id="9031" class="l"><a href="#9031"> 9031: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> TranslateX(<span class="php-var">$t_x</span>) {
</span><span id="9032" class="l"><a href="#9032"> 9032: </a>            <span class="php-var">$this</span>-&gt;Translate(<span class="php-var">$t_x</span>, <span class="php-num">0</span>);
</span><span id="9033" class="l"><a href="#9033"> 9033: </a>        }
</span><span id="9034" class="l"><a href="#9034"> 9034: </a>
</span><span id="9035" class="l"><a href="#9035"> 9035: </a>        <span class="php-comment">/**
</span></span><span id="9036" class="l"><a href="#9036"> 9036: </a><span class="php-comment">         * Translate graphic object vertically.
</span></span><span id="9037" class="l"><a href="#9037"> 9037: </a><span class="php-comment">         * @param int $t_y movement to the bottom
</span></span><span id="9038" class="l"><a href="#9038"> 9038: </a><span class="php-comment">         * @access public
</span></span><span id="9039" class="l"><a href="#9039"> 9039: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9040" class="l"><a href="#9040"> 9040: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9041" class="l"><a href="#9041"> 9041: </a><span class="php-comment">         */</span>
</span><span id="9042" class="l"><a href="#9042"> 9042: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> TranslateY(<span class="php-var">$t_y</span>) {
</span><span id="9043" class="l"><a href="#9043"> 9043: </a>            <span class="php-var">$this</span>-&gt;Translate(<span class="php-num">0</span>, <span class="php-var">$t_y</span>);
</span><span id="9044" class="l"><a href="#9044"> 9044: </a>        }
</span><span id="9045" class="l"><a href="#9045"> 9045: </a>
</span><span id="9046" class="l"><a href="#9046"> 9046: </a>        <span class="php-comment">/**
</span></span><span id="9047" class="l"><a href="#9047"> 9047: </a><span class="php-comment">         * Translate graphic object horizontally and vertically.
</span></span><span id="9048" class="l"><a href="#9048"> 9048: </a><span class="php-comment">         * @param int $t_x movement to the right
</span></span><span id="9049" class="l"><a href="#9049"> 9049: </a><span class="php-comment">         * @param int $t_y movement to the bottom
</span></span><span id="9050" class="l"><a href="#9050"> 9050: </a><span class="php-comment">         * @access public
</span></span><span id="9051" class="l"><a href="#9051"> 9051: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9052" class="l"><a href="#9052"> 9052: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9053" class="l"><a href="#9053"> 9053: </a><span class="php-comment">         */</span>
</span><span id="9054" class="l"><a href="#9054"> 9054: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Translate(<span class="php-var">$t_x</span>, <span class="php-var">$t_y</span>) {
</span><span id="9055" class="l"><a href="#9055"> 9055: </a>            <span class="php-comment">//calculate elements of transformation matrix</span>
</span><span id="9056" class="l"><a href="#9056"> 9056: </a>            <span class="php-var">$tm</span>[<span class="php-num">0</span>] = <span class="php-num">1</span>;
</span><span id="9057" class="l"><a href="#9057"> 9057: </a>            <span class="php-var">$tm</span>[<span class="php-num">1</span>] = <span class="php-num">0</span>;
</span><span id="9058" class="l"><a href="#9058"> 9058: </a>            <span class="php-var">$tm</span>[<span class="php-num">2</span>] = <span class="php-num">0</span>;
</span><span id="9059" class="l"><a href="#9059"> 9059: </a>            <span class="php-var">$tm</span>[<span class="php-num">3</span>] = <span class="php-num">1</span>;
</span><span id="9060" class="l"><a href="#9060"> 9060: </a>            <span class="php-var">$tm</span>[<span class="php-num">4</span>] = <span class="php-var">$t_x</span> * <span class="php-var">$this</span>-&gt;k;
</span><span id="9061" class="l"><a href="#9061"> 9061: </a>            <span class="php-var">$tm</span>[<span class="php-num">5</span>] = -<span class="php-var">$t_y</span> * <span class="php-var">$this</span>-&gt;k;
</span><span id="9062" class="l"><a href="#9062"> 9062: </a>            <span class="php-comment">//translate the coordinate system</span>
</span><span id="9063" class="l"><a href="#9063"> 9063: </a>            <span class="php-var">$this</span>-&gt;Transform(<span class="php-var">$tm</span>);
</span><span id="9064" class="l"><a href="#9064"> 9064: </a>        }
</span><span id="9065" class="l"><a href="#9065"> 9065: </a>
</span><span id="9066" class="l"><a href="#9066"> 9066: </a>        <span class="php-comment">/**
</span></span><span id="9067" class="l"><a href="#9067"> 9067: </a><span class="php-comment">         * Rotate object.
</span></span><span id="9068" class="l"><a href="#9068"> 9068: </a><span class="php-comment">         * @param float $angle angle in degrees for counter-clockwise rotation
</span></span><span id="9069" class="l"><a href="#9069"> 9069: </a><span class="php-comment">         * @param int $x abscissa of the rotation center. Default is current x position
</span></span><span id="9070" class="l"><a href="#9070"> 9070: </a><span class="php-comment">         * @param int $y ordinate of the rotation center. Default is current y position
</span></span><span id="9071" class="l"><a href="#9071"> 9071: </a><span class="php-comment">         * @access public
</span></span><span id="9072" class="l"><a href="#9072"> 9072: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9073" class="l"><a href="#9073"> 9073: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9074" class="l"><a href="#9074"> 9074: </a><span class="php-comment">         */</span>
</span><span id="9075" class="l"><a href="#9075"> 9075: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Rotate(<span class="php-var">$angle</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="9076" class="l"><a href="#9076"> 9076: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="9077" class="l"><a href="#9077"> 9077: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="9078" class="l"><a href="#9078"> 9078: </a>            }
</span><span id="9079" class="l"><a href="#9079"> 9079: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="9080" class="l"><a href="#9080"> 9080: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="9081" class="l"><a href="#9081"> 9081: </a>            }
</span><span id="9082" class="l"><a href="#9082"> 9082: </a>            <span class="php-var">$y</span> = (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="9083" class="l"><a href="#9083"> 9083: </a>            <span class="php-var">$x</span> *= <span class="php-var">$this</span>-&gt;k;
</span><span id="9084" class="l"><a href="#9084"> 9084: </a>            <span class="php-comment">//calculate elements of transformation matrix</span>
</span><span id="9085" class="l"><a href="#9085"> 9085: </a>            <span class="php-var">$tm</span>[<span class="php-num">0</span>] = <span class="php-keyword2">cos</span>(<span class="php-keyword2">deg2rad</span>(<span class="php-var">$angle</span>));
</span><span id="9086" class="l"><a href="#9086"> 9086: </a>            <span class="php-var">$tm</span>[<span class="php-num">1</span>] = <span class="php-keyword2">sin</span>(<span class="php-keyword2">deg2rad</span>(<span class="php-var">$angle</span>));
</span><span id="9087" class="l"><a href="#9087"> 9087: </a>            <span class="php-var">$tm</span>[<span class="php-num">2</span>] = -<span class="php-var">$tm</span>[<span class="php-num">1</span>];
</span><span id="9088" class="l"><a href="#9088"> 9088: </a>            <span class="php-var">$tm</span>[<span class="php-num">3</span>] = <span class="php-var">$tm</span>[<span class="php-num">0</span>];
</span><span id="9089" class="l"><a href="#9089"> 9089: </a>            <span class="php-var">$tm</span>[<span class="php-num">4</span>] = <span class="php-var">$x</span> + (<span class="php-var">$tm</span>[<span class="php-num">1</span>] * <span class="php-var">$y</span>) - (<span class="php-var">$tm</span>[<span class="php-num">0</span>] * <span class="php-var">$x</span>);
</span><span id="9090" class="l"><a href="#9090"> 9090: </a>            <span class="php-var">$tm</span>[<span class="php-num">5</span>] = <span class="php-var">$y</span> - (<span class="php-var">$tm</span>[<span class="php-num">0</span>] * <span class="php-var">$y</span>) - (<span class="php-var">$tm</span>[<span class="php-num">1</span>] * <span class="php-var">$x</span>);
</span><span id="9091" class="l"><a href="#9091"> 9091: </a>            <span class="php-comment">//rotate the coordinate system around ($x,$y)</span>
</span><span id="9092" class="l"><a href="#9092"> 9092: </a>            <span class="php-var">$this</span>-&gt;Transform(<span class="php-var">$tm</span>);
</span><span id="9093" class="l"><a href="#9093"> 9093: </a>        }
</span><span id="9094" class="l"><a href="#9094"> 9094: </a>
</span><span id="9095" class="l"><a href="#9095"> 9095: </a>        <span class="php-comment">/**
</span></span><span id="9096" class="l"><a href="#9096"> 9096: </a><span class="php-comment">         * Skew horizontally.
</span></span><span id="9097" class="l"><a href="#9097"> 9097: </a><span class="php-comment">         * @param float $angle_x angle in degrees between -90 (skew to the left) and 90 (skew to the right)
</span></span><span id="9098" class="l"><a href="#9098"> 9098: </a><span class="php-comment">         * @param int $x abscissa of the skewing center. default is current x position
</span></span><span id="9099" class="l"><a href="#9099"> 9099: </a><span class="php-comment">         * @param int $y ordinate of the skewing center. default is current y position
</span></span><span id="9100" class="l"><a href="#9100"> 9100: </a><span class="php-comment">         * @access public
</span></span><span id="9101" class="l"><a href="#9101"> 9101: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9102" class="l"><a href="#9102"> 9102: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9103" class="l"><a href="#9103"> 9103: </a><span class="php-comment">         */</span>
</span><span id="9104" class="l"><a href="#9104"> 9104: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SkewX(<span class="php-var">$angle_x</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="9105" class="l"><a href="#9105"> 9105: </a>            <span class="php-var">$this</span>-&gt;Skew(<span class="php-var">$angle_x</span>, <span class="php-num">0</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="9106" class="l"><a href="#9106"> 9106: </a>        }
</span><span id="9107" class="l"><a href="#9107"> 9107: </a>
</span><span id="9108" class="l"><a href="#9108"> 9108: </a>        <span class="php-comment">/**
</span></span><span id="9109" class="l"><a href="#9109"> 9109: </a><span class="php-comment">         * Skew vertically.
</span></span><span id="9110" class="l"><a href="#9110"> 9110: </a><span class="php-comment">         * @param float $angle_y angle in degrees between -90 (skew to the bottom) and 90 (skew to the top)
</span></span><span id="9111" class="l"><a href="#9111"> 9111: </a><span class="php-comment">         * @param int $x abscissa of the skewing center. default is current x position
</span></span><span id="9112" class="l"><a href="#9112"> 9112: </a><span class="php-comment">         * @param int $y ordinate of the skewing center. default is current y position
</span></span><span id="9113" class="l"><a href="#9113"> 9113: </a><span class="php-comment">         * @access public
</span></span><span id="9114" class="l"><a href="#9114"> 9114: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9115" class="l"><a href="#9115"> 9115: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9116" class="l"><a href="#9116"> 9116: </a><span class="php-comment">         */</span>
</span><span id="9117" class="l"><a href="#9117"> 9117: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SkewY(<span class="php-var">$angle_y</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="9118" class="l"><a href="#9118"> 9118: </a>            <span class="php-var">$this</span>-&gt;Skew(<span class="php-num">0</span>, <span class="php-var">$angle_y</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="9119" class="l"><a href="#9119"> 9119: </a>        }
</span><span id="9120" class="l"><a href="#9120"> 9120: </a>
</span><span id="9121" class="l"><a href="#9121"> 9121: </a>        <span class="php-comment">/**
</span></span><span id="9122" class="l"><a href="#9122"> 9122: </a><span class="php-comment">         * Skew.
</span></span><span id="9123" class="l"><a href="#9123"> 9123: </a><span class="php-comment">         * @param float $angle_x angle in degrees between -90 (skew to the left) and 90 (skew to the right)
</span></span><span id="9124" class="l"><a href="#9124"> 9124: </a><span class="php-comment">         * @param float $angle_y angle in degrees between -90 (skew to the bottom) and 90 (skew to the top)
</span></span><span id="9125" class="l"><a href="#9125"> 9125: </a><span class="php-comment">         * @param int $x abscissa of the skewing center. default is current x position
</span></span><span id="9126" class="l"><a href="#9126"> 9126: </a><span class="php-comment">         * @param int $y ordinate of the skewing center. default is current y position
</span></span><span id="9127" class="l"><a href="#9127"> 9127: </a><span class="php-comment">         * @access public
</span></span><span id="9128" class="l"><a href="#9128"> 9128: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9129" class="l"><a href="#9129"> 9129: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9130" class="l"><a href="#9130"> 9130: </a><span class="php-comment">         */</span>
</span><span id="9131" class="l"><a href="#9131"> 9131: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Skew(<span class="php-var">$angle_x</span>, <span class="php-var">$angle_y</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="9132" class="l"><a href="#9132"> 9132: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="9133" class="l"><a href="#9133"> 9133: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="9134" class="l"><a href="#9134"> 9134: </a>            }
</span><span id="9135" class="l"><a href="#9135"> 9135: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="9136" class="l"><a href="#9136"> 9136: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="9137" class="l"><a href="#9137"> 9137: </a>            }
</span><span id="9138" class="l"><a href="#9138"> 9138: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$angle_x</span> &lt;= -<span class="php-num">90</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$angle_x</span> &gt;= <span class="php-num">90</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$angle_y</span> &lt;= -<span class="php-num">90</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$angle_y</span> &gt;= <span class="php-num">90</span>)) {
</span><span id="9139" class="l"><a href="#9139"> 9139: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Please use values between -90 and +90 degrees for Skewing.'</span>);
</span><span id="9140" class="l"><a href="#9140"> 9140: </a>            }
</span><span id="9141" class="l"><a href="#9141"> 9141: </a>            <span class="php-var">$x</span> *= <span class="php-var">$this</span>-&gt;k;
</span><span id="9142" class="l"><a href="#9142"> 9142: </a>            <span class="php-var">$y</span> = (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="9143" class="l"><a href="#9143"> 9143: </a>            <span class="php-comment">//calculate elements of transformation matrix</span>
</span><span id="9144" class="l"><a href="#9144"> 9144: </a>            <span class="php-var">$tm</span>[<span class="php-num">0</span>] = <span class="php-num">1</span>;
</span><span id="9145" class="l"><a href="#9145"> 9145: </a>            <span class="php-var">$tm</span>[<span class="php-num">1</span>] = <span class="php-keyword2">tan</span>(<span class="php-keyword2">deg2rad</span>(<span class="php-var">$angle_y</span>));
</span><span id="9146" class="l"><a href="#9146"> 9146: </a>            <span class="php-var">$tm</span>[<span class="php-num">2</span>] = <span class="php-keyword2">tan</span>(<span class="php-keyword2">deg2rad</span>(<span class="php-var">$angle_x</span>));
</span><span id="9147" class="l"><a href="#9147"> 9147: </a>            <span class="php-var">$tm</span>[<span class="php-num">3</span>] = <span class="php-num">1</span>;
</span><span id="9148" class="l"><a href="#9148"> 9148: </a>            <span class="php-var">$tm</span>[<span class="php-num">4</span>] = -<span class="php-var">$tm</span>[<span class="php-num">2</span>] * <span class="php-var">$y</span>;
</span><span id="9149" class="l"><a href="#9149"> 9149: </a>            <span class="php-var">$tm</span>[<span class="php-num">5</span>] = -<span class="php-var">$tm</span>[<span class="php-num">1</span>] * <span class="php-var">$x</span>;
</span><span id="9150" class="l"><a href="#9150"> 9150: </a>            <span class="php-comment">//skew the coordinate system</span>
</span><span id="9151" class="l"><a href="#9151"> 9151: </a>            <span class="php-var">$this</span>-&gt;Transform(<span class="php-var">$tm</span>);
</span><span id="9152" class="l"><a href="#9152"> 9152: </a>        }
</span><span id="9153" class="l"><a href="#9153"> 9153: </a>
</span><span id="9154" class="l"><a href="#9154"> 9154: </a>        <span class="php-comment">/**
</span></span><span id="9155" class="l"><a href="#9155"> 9155: </a><span class="php-comment">         * Apply graphic transformations.
</span></span><span id="9156" class="l"><a href="#9156"> 9156: </a><span class="php-comment">         * @param array $tm transformation matrix
</span></span><span id="9157" class="l"><a href="#9157"> 9157: </a><span class="php-comment">         * @access protected
</span></span><span id="9158" class="l"><a href="#9158"> 9158: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9159" class="l"><a href="#9159"> 9159: </a><span class="php-comment">         * @see StartTransform(), StopTransform()
</span></span><span id="9160" class="l"><a href="#9160"> 9160: </a><span class="php-comment">         */</span>
</span><span id="9161" class="l"><a href="#9161"> 9161: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> Transform(<span class="php-var">$tm</span>) {
</span><span id="9162" class="l"><a href="#9162"> 9162: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F %.3F %.3F cm'</span>, <span class="php-var">$tm</span>[<span class="php-num">0</span>], <span class="php-var">$tm</span>[<span class="php-num">1</span>], <span class="php-var">$tm</span>[<span class="php-num">2</span>], <span class="php-var">$tm</span>[<span class="php-num">3</span>], <span class="php-var">$tm</span>[<span class="php-num">4</span>], <span class="php-var">$tm</span>[<span class="php-num">5</span>]));
</span><span id="9163" class="l"><a href="#9163"> 9163: </a>            <span class="php-comment">// add tranformation matrix</span>
</span><span id="9164" class="l"><a href="#9164"> 9164: </a>            <span class="php-var">$this</span>-&gt;transfmatrix[<span class="php-var">$this</span>-&gt;transfmatrix_key][] = <span class="php-keyword1">array</span>(<span class="php-quote">'a'</span> =&gt; <span class="php-var">$tm</span>[<span class="php-num">0</span>], <span class="php-quote">'b'</span> =&gt; <span class="php-var">$tm</span>[<span class="php-num">1</span>], <span class="php-quote">'c'</span> =&gt; <span class="php-var">$tm</span>[<span class="php-num">2</span>], <span class="php-quote">'d'</span> =&gt; <span class="php-var">$tm</span>[<span class="php-num">3</span>], <span class="php-quote">'e'</span> =&gt; <span class="php-var">$tm</span>[<span class="php-num">4</span>], <span class="php-quote">'f'</span> =&gt; <span class="php-var">$tm</span>[<span class="php-num">5</span>]);
</span><span id="9165" class="l"><a href="#9165"> 9165: </a>            <span class="php-comment">// update tranformation mark</span>
</span><span id="9166" class="l"><a href="#9166"> 9166: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">end</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page]) !== <span class="php-keyword1">false</span>) {
</span><span id="9167" class="l"><a href="#9167"> 9167: </a>                <span class="php-var">$key</span> = <span class="php-keyword2">key</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="9168" class="l"><a href="#9168"> 9168: </a>                <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$key</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="9169" class="l"><a href="#9169"> 9169: </a>            }
</span><span id="9170" class="l"><a href="#9170"> 9170: </a>        }
</span><span id="9171" class="l"><a href="#9171"> 9171: </a>
</span><span id="9172" class="l"><a href="#9172"> 9172: </a>        <span class="php-comment">// END TRANSFORMATIONS SECTION -------------------------</span>
</span><span id="9173" class="l"><a href="#9173"> 9173: </a>
</span><span id="9174" class="l"><a href="#9174"> 9174: </a>
</span><span id="9175" class="l"><a href="#9175"> 9175: </a>        <span class="php-comment">// START GRAPHIC FUNCTIONS SECTION ---------------------</span>
</span><span id="9176" class="l"><a href="#9176"> 9176: </a>        <span class="php-comment">// The following section is based on the code provided by David Hernandez Sanz</span>
</span><span id="9177" class="l"><a href="#9177"> 9177: </a>
</span><span id="9178" class="l"><a href="#9178"> 9178: </a>        <span class="php-comment">/**
</span></span><span id="9179" class="l"><a href="#9179"> 9179: </a><span class="php-comment">         * Defines the line width. By default, the value equals 0.2 mm. The method can be called before the first page is created and the value is retained from page to page.
</span></span><span id="9180" class="l"><a href="#9180"> 9180: </a><span class="php-comment">         * @param float $width The width.
</span></span><span id="9181" class="l"><a href="#9181"> 9181: </a><span class="php-comment">         * @access public
</span></span><span id="9182" class="l"><a href="#9182"> 9182: </a><span class="php-comment">         * @since 1.0
</span></span><span id="9183" class="l"><a href="#9183"> 9183: </a><span class="php-comment">         * @see Line(), Rect(), Cell(), MultiCell()
</span></span><span id="9184" class="l"><a href="#9184"> 9184: </a><span class="php-comment">         */</span>
</span><span id="9185" class="l"><a href="#9185"> 9185: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetLineWidth(<span class="php-var">$width</span>) {
</span><span id="9186" class="l"><a href="#9186"> 9186: </a>            <span class="php-comment">//Set line width</span>
</span><span id="9187" class="l"><a href="#9187"> 9187: </a>            <span class="php-var">$this</span>-&gt;LineWidth = <span class="php-var">$width</span>;
</span><span id="9188" class="l"><a href="#9188"> 9188: </a>            <span class="php-var">$this</span>-&gt;linestyleWidth = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F w'</span>, (<span class="php-var">$width</span> * <span class="php-var">$this</span>-&gt;k));
</span><span id="9189" class="l"><a href="#9189"> 9189: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-num">0</span>) {
</span><span id="9190" class="l"><a href="#9190"> 9190: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;linestyleWidth);
</span><span id="9191" class="l"><a href="#9191"> 9191: </a>            }
</span><span id="9192" class="l"><a href="#9192"> 9192: </a>        }
</span><span id="9193" class="l"><a href="#9193"> 9193: </a>
</span><span id="9194" class="l"><a href="#9194"> 9194: </a>        <span class="php-comment">/**
</span></span><span id="9195" class="l"><a href="#9195"> 9195: </a><span class="php-comment">         * Returns the current the line width.
</span></span><span id="9196" class="l"><a href="#9196"> 9196: </a><span class="php-comment">         * @return int Line width
</span></span><span id="9197" class="l"><a href="#9197"> 9197: </a><span class="php-comment">         * @access public
</span></span><span id="9198" class="l"><a href="#9198"> 9198: </a><span class="php-comment">         * @since 2.1.000 (2008-01-07)
</span></span><span id="9199" class="l"><a href="#9199"> 9199: </a><span class="php-comment">         * @see Line(), SetLineWidth()
</span></span><span id="9200" class="l"><a href="#9200"> 9200: </a><span class="php-comment">         */</span>
</span><span id="9201" class="l"><a href="#9201"> 9201: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> GetLineWidth() {
</span><span id="9202" class="l"><a href="#9202"> 9202: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;LineWidth;
</span><span id="9203" class="l"><a href="#9203"> 9203: </a>        }
</span><span id="9204" class="l"><a href="#9204"> 9204: </a>
</span><span id="9205" class="l"><a href="#9205"> 9205: </a>        <span class="php-comment">/**
</span></span><span id="9206" class="l"><a href="#9206"> 9206: </a><span class="php-comment">         * Set line style.
</span></span><span id="9207" class="l"><a href="#9207"> 9207: </a><span class="php-comment">         * @param array $style Line style. Array with keys among the following:
</span></span><span id="9208" class="l"><a href="#9208"> 9208: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9209" class="l"><a href="#9209"> 9209: </a><span class="php-comment">         *   &lt;li&gt;width (float): Width of the line in user units.&lt;/li&gt;
</span></span><span id="9210" class="l"><a href="#9210"> 9210: </a><span class="php-comment">         *   &lt;li&gt;cap (string): Type of cap to put on the line. Possible values are:
</span></span><span id="9211" class="l"><a href="#9211"> 9211: </a><span class="php-comment">         * butt, round, square. The difference between &quot;square&quot; and &quot;butt&quot; is that
</span></span><span id="9212" class="l"><a href="#9212"> 9212: </a><span class="php-comment">         * &quot;square&quot; projects a flat end past the end of the line.&lt;/li&gt;
</span></span><span id="9213" class="l"><a href="#9213"> 9213: </a><span class="php-comment">         *   &lt;li&gt;join (string): Type of join. Possible values are: miter, round,
</span></span><span id="9214" class="l"><a href="#9214"> 9214: </a><span class="php-comment">         * bevel.&lt;/li&gt;
</span></span><span id="9215" class="l"><a href="#9215"> 9215: </a><span class="php-comment">         *   &lt;li&gt;dash (mixed): Dash pattern. Is 0 (without dash) or string with
</span></span><span id="9216" class="l"><a href="#9216"> 9216: </a><span class="php-comment">         * series of length values, which are the lengths of the on and off dashes.
</span></span><span id="9217" class="l"><a href="#9217"> 9217: </a><span class="php-comment">         * For example: &quot;2&quot; represents 2 on, 2 off, 2 on, 2 off, ...; &quot;2,1&quot; is 2 on,
</span></span><span id="9218" class="l"><a href="#9218"> 9218: </a><span class="php-comment">         * 1 off, 2 on, 1 off, ...&lt;/li&gt;
</span></span><span id="9219" class="l"><a href="#9219"> 9219: </a><span class="php-comment">         *   &lt;li&gt;phase (integer): Modifier on the dash pattern which is used to shift
</span></span><span id="9220" class="l"><a href="#9220"> 9220: </a><span class="php-comment">         * the point at which the pattern starts.&lt;/li&gt;
</span></span><span id="9221" class="l"><a href="#9221"> 9221: </a><span class="php-comment">         *   &lt;li&gt;color (array): Draw color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K).&lt;/li&gt;
</span></span><span id="9222" class="l"><a href="#9222"> 9222: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9223" class="l"><a href="#9223"> 9223: </a><span class="php-comment">         * @access public
</span></span><span id="9224" class="l"><a href="#9224"> 9224: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9225" class="l"><a href="#9225"> 9225: </a><span class="php-comment">         */</span>
</span><span id="9226" class="l"><a href="#9226"> 9226: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetLineStyle(<span class="php-var">$style</span>) {
</span><span id="9227" class="l"><a href="#9227"> 9227: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_array</span>(<span class="php-var">$style</span>)) {
</span><span id="9228" class="l"><a href="#9228"> 9228: </a>                <span class="php-keyword1">return</span>;
</span><span id="9229" class="l"><a href="#9229"> 9229: </a>            }
</span><span id="9230" class="l"><a href="#9230"> 9230: </a>            <span class="php-keyword2">extract</span>(<span class="php-var">$style</span>);
</span><span id="9231" class="l"><a href="#9231"> 9231: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$width</span>)) {
</span><span id="9232" class="l"><a href="#9232"> 9232: </a>                <span class="php-var">$width_prev</span> = <span class="php-var">$this</span>-&gt;LineWidth;
</span><span id="9233" class="l"><a href="#9233"> 9233: </a>                <span class="php-var">$this</span>-&gt;SetLineWidth(<span class="php-var">$width</span>);
</span><span id="9234" class="l"><a href="#9234"> 9234: </a>                <span class="php-var">$this</span>-&gt;LineWidth = <span class="php-var">$width_prev</span>;
</span><span id="9235" class="l"><a href="#9235"> 9235: </a>            }
</span><span id="9236" class="l"><a href="#9236"> 9236: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cap</span>)) {
</span><span id="9237" class="l"><a href="#9237"> 9237: </a>                <span class="php-var">$ca</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'butt'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'round'</span>=&gt; <span class="php-num">1</span>, <span class="php-quote">'square'</span> =&gt; <span class="php-num">2</span>);
</span><span id="9238" class="l"><a href="#9238"> 9238: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$ca</span>[<span class="php-var">$cap</span>])) {
</span><span id="9239" class="l"><a href="#9239"> 9239: </a>                    <span class="php-var">$this</span>-&gt;linestyleCap = <span class="php-var">$ca</span>[<span class="php-var">$cap</span>].<span class="php-quote">' J'</span>;
</span><span id="9240" class="l"><a href="#9240"> 9240: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;linestyleCap);
</span><span id="9241" class="l"><a href="#9241"> 9241: </a>                }
</span><span id="9242" class="l"><a href="#9242"> 9242: </a>            }
</span><span id="9243" class="l"><a href="#9243"> 9243: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$join</span>)) {
</span><span id="9244" class="l"><a href="#9244"> 9244: </a>                <span class="php-var">$ja</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'miter'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'round'</span> =&gt; <span class="php-num">1</span>, <span class="php-quote">'bevel'</span> =&gt; <span class="php-num">2</span>);
</span><span id="9245" class="l"><a href="#9245"> 9245: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$ja</span>[<span class="php-var">$join</span>])) {
</span><span id="9246" class="l"><a href="#9246"> 9246: </a>                    <span class="php-var">$this</span>-&gt;linestyleJoin = <span class="php-var">$ja</span>[<span class="php-var">$join</span>].<span class="php-quote">' j'</span>;
</span><span id="9247" class="l"><a href="#9247"> 9247: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;linestyleJoin);
</span><span id="9248" class="l"><a href="#9248"> 9248: </a>                }
</span><span id="9249" class="l"><a href="#9249"> 9249: </a>            }
</span><span id="9250" class="l"><a href="#9250"> 9250: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dash</span>)) {
</span><span id="9251" class="l"><a href="#9251"> 9251: </a>                <span class="php-var">$dash_string</span> = <span class="php-quote">''</span>;
</span><span id="9252" class="l"><a href="#9252"> 9252: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$dash</span>) {
</span><span id="9253" class="l"><a href="#9253"> 9253: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/^.+,/'</span>, <span class="php-var">$dash</span>) &gt; <span class="php-num">0</span>) {
</span><span id="9254" class="l"><a href="#9254"> 9254: </a>                        <span class="php-var">$tab</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">','</span>, <span class="php-var">$dash</span>);
</span><span id="9255" class="l"><a href="#9255"> 9255: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="9256" class="l"><a href="#9256"> 9256: </a>                        <span class="php-var">$tab</span> = <span class="php-keyword1">array</span>(<span class="php-var">$dash</span>);
</span><span id="9257" class="l"><a href="#9257"> 9257: </a>                    }
</span><span id="9258" class="l"><a href="#9258"> 9258: </a>                    <span class="php-var">$dash_string</span> = <span class="php-quote">''</span>;
</span><span id="9259" class="l"><a href="#9259"> 9259: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$tab</span> <span class="php-keyword1">as</span> <span class="php-var">$i</span> =&gt; <span class="php-var">$v</span>) {
</span><span id="9260" class="l"><a href="#9260"> 9260: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$i</span>) {
</span><span id="9261" class="l"><a href="#9261"> 9261: </a>                            <span class="php-var">$dash_string</span> .= <span class="php-quote">' '</span>;
</span><span id="9262" class="l"><a href="#9262"> 9262: </a>                        }
</span><span id="9263" class="l"><a href="#9263"> 9263: </a>                        <span class="php-var">$dash_string</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F'</span>, <span class="php-var">$v</span>);
</span><span id="9264" class="l"><a href="#9264"> 9264: </a>                    }
</span><span id="9265" class="l"><a href="#9265"> 9265: </a>                }
</span><span id="9266" class="l"><a href="#9266"> 9266: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$phase</span>) <span class="php-keyword1">OR</span> !<span class="php-var">$dash</span>) {
</span><span id="9267" class="l"><a href="#9267"> 9267: </a>                    <span class="php-var">$phase</span> = <span class="php-num">0</span>;
</span><span id="9268" class="l"><a href="#9268"> 9268: </a>                }
</span><span id="9269" class="l"><a href="#9269"> 9269: </a>                <span class="php-var">$this</span>-&gt;linestyleDash = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'[%s] %.2F d'</span>, <span class="php-var">$dash_string</span>, <span class="php-var">$phase</span>);
</span><span id="9270" class="l"><a href="#9270"> 9270: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;linestyleDash);
</span><span id="9271" class="l"><a href="#9271"> 9271: </a>            }
</span><span id="9272" class="l"><a href="#9272"> 9272: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$color</span>)) {
</span><span id="9273" class="l"><a href="#9273"> 9273: </a>                <span class="php-var">$this</span>-&gt;SetDrawColorArray(<span class="php-var">$color</span>);
</span><span id="9274" class="l"><a href="#9274"> 9274: </a>            }
</span><span id="9275" class="l"><a href="#9275"> 9275: </a>        }
</span><span id="9276" class="l"><a href="#9276"> 9276: </a>
</span><span id="9277" class="l"><a href="#9277"> 9277: </a>        <span class="php-comment">/**
</span></span><span id="9278" class="l"><a href="#9278"> 9278: </a><span class="php-comment">         * Begin a new subpath by moving the current point to coordinates (x, y), omitting any connecting line segment.
</span></span><span id="9279" class="l"><a href="#9279"> 9279: </a><span class="php-comment">         * @param float $x Abscissa of point.
</span></span><span id="9280" class="l"><a href="#9280"> 9280: </a><span class="php-comment">         * @param float $y Ordinate of point.
</span></span><span id="9281" class="l"><a href="#9281"> 9281: </a><span class="php-comment">         * @access protected
</span></span><span id="9282" class="l"><a href="#9282"> 9282: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9283" class="l"><a href="#9283"> 9283: </a><span class="php-comment">         */</span>
</span><span id="9284" class="l"><a href="#9284"> 9284: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _outPoint(<span class="php-var">$x</span>, <span class="php-var">$y</span>) {
</span><span id="9285" class="l"><a href="#9285"> 9285: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F m'</span>, <span class="php-var">$x</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$this</span>-&gt;k));
</span><span id="9286" class="l"><a href="#9286"> 9286: </a>        }
</span><span id="9287" class="l"><a href="#9287"> 9287: </a>
</span><span id="9288" class="l"><a href="#9288"> 9288: </a>        <span class="php-comment">/**
</span></span><span id="9289" class="l"><a href="#9289"> 9289: </a><span class="php-comment">         * Append a straight line segment from the current point to the point (x, y).
</span></span><span id="9290" class="l"><a href="#9290"> 9290: </a><span class="php-comment">         * The new current point shall be (x, y).
</span></span><span id="9291" class="l"><a href="#9291"> 9291: </a><span class="php-comment">         * @param float $x Abscissa of end point.
</span></span><span id="9292" class="l"><a href="#9292"> 9292: </a><span class="php-comment">         * @param float $y Ordinate of end point.
</span></span><span id="9293" class="l"><a href="#9293"> 9293: </a><span class="php-comment">         * @access protected
</span></span><span id="9294" class="l"><a href="#9294"> 9294: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9295" class="l"><a href="#9295"> 9295: </a><span class="php-comment">         */</span>
</span><span id="9296" class="l"><a href="#9296"> 9296: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _outLine(<span class="php-var">$x</span>, <span class="php-var">$y</span>) {
</span><span id="9297" class="l"><a href="#9297"> 9297: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F l'</span>, <span class="php-var">$x</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$this</span>-&gt;k));
</span><span id="9298" class="l"><a href="#9298"> 9298: </a>        }
</span><span id="9299" class="l"><a href="#9299"> 9299: </a>
</span><span id="9300" class="l"><a href="#9300"> 9300: </a>        <span class="php-comment">/**
</span></span><span id="9301" class="l"><a href="#9301"> 9301: </a><span class="php-comment">         * Append a rectangle to the current path as a complete subpath, with lower-left corner (x, y) and dimensions widthand height in user space.
</span></span><span id="9302" class="l"><a href="#9302"> 9302: </a><span class="php-comment">         * @param float $x Abscissa of upper-left corner (or upper-right corner for RTL language).
</span></span><span id="9303" class="l"><a href="#9303"> 9303: </a><span class="php-comment">         * @param float $y Ordinate of upper-left corner (or upper-right corner for RTL language).
</span></span><span id="9304" class="l"><a href="#9304"> 9304: </a><span class="php-comment">         * @param float $w Width.
</span></span><span id="9305" class="l"><a href="#9305"> 9305: </a><span class="php-comment">         * @param float $h Height.
</span></span><span id="9306" class="l"><a href="#9306"> 9306: </a><span class="php-comment">         * @param string $op options
</span></span><span id="9307" class="l"><a href="#9307"> 9307: </a><span class="php-comment">         * @access protected
</span></span><span id="9308" class="l"><a href="#9308"> 9308: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9309" class="l"><a href="#9309"> 9309: </a><span class="php-comment">         */</span>
</span><span id="9310" class="l"><a href="#9310"> 9310: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _outRect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$op</span>) {
</span><span id="9311" class="l"><a href="#9311"> 9311: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F re %s'</span>, <span class="php-var">$x</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span>) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k, -<span class="php-var">$h</span> * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$op</span>));
</span><span id="9312" class="l"><a href="#9312"> 9312: </a>        }
</span><span id="9313" class="l"><a href="#9313"> 9313: </a>
</span><span id="9314" class="l"><a href="#9314"> 9314: </a>        <span class="php-comment">/**
</span></span><span id="9315" class="l"><a href="#9315"> 9315: </a><span class="php-comment">        
</span></span><span id="9316" class="l"><a href="#9316"> 9316: </a><span class="php-comment">         * The new current point shall be (x3, y3).
</span></span><span id="9317" class="l"><a href="#9317"> 9317: </a><span class="php-comment">         * @param float $x1 Abscissa of control point 1.
</span></span><span id="9318" class="l"><a href="#9318"> 9318: </a><span class="php-comment">         * @param float $y1 Ordinate of control point 1.
</span></span><span id="9319" class="l"><a href="#9319"> 9319: </a><span class="php-comment">         * @param float $x2 Abscissa of control point 2.
</span></span><span id="9320" class="l"><a href="#9320"> 9320: </a><span class="php-comment">         * @param float $y2 Ordinate of control point 2.
</span></span><span id="9321" class="l"><a href="#9321"> 9321: </a><span class="php-comment">         * @param float $x3 Abscissa of end point.
</span></span><span id="9322" class="l"><a href="#9322"> 9322: </a><span class="php-comment">         * @param float $y3 Ordinate of end point.
</span></span><span id="9323" class="l"><a href="#9323"> 9323: </a><span class="php-comment">         * @access protected
</span></span><span id="9324" class="l"><a href="#9324"> 9324: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9325" class="l"><a href="#9325"> 9325: </a><span class="php-comment">         */</span>
</span><span id="9326" class="l"><a href="#9326"> 9326: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _outCurve(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x3</span>, <span class="php-var">$y3</span>) {
</span><span id="9327" class="l"><a href="#9327"> 9327: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F %.2F %.2F c'</span>, <span class="php-var">$x1</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y1</span>) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$x2</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y2</span>) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$x3</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y3</span>) * <span class="php-var">$this</span>-&gt;k));
</span><span id="9328" class="l"><a href="#9328"> 9328: </a>        }
</span><span id="9329" class="l"><a href="#9329"> 9329: </a>
</span><span id="9330" class="l"><a href="#9330"> 9330: </a>        <span class="php-comment">/**
</span></span><span id="9331" class="l"><a href="#9331"> 9331: </a><span class="php-comment">        
</span></span><span id="9332" class="l"><a href="#9332"> 9332: </a><span class="php-comment">         * The new current point shall be (x3, y3).
</span></span><span id="9333" class="l"><a href="#9333"> 9333: </a><span class="php-comment">         * @param float $x2 Abscissa of control point 2.
</span></span><span id="9334" class="l"><a href="#9334"> 9334: </a><span class="php-comment">         * @param float $y2 Ordinate of control point 2.
</span></span><span id="9335" class="l"><a href="#9335"> 9335: </a><span class="php-comment">         * @param float $x3 Abscissa of end point.
</span></span><span id="9336" class="l"><a href="#9336"> 9336: </a><span class="php-comment">         * @param float $y3 Ordinate of end point.
</span></span><span id="9337" class="l"><a href="#9337"> 9337: </a><span class="php-comment">         * @access protected
</span></span><span id="9338" class="l"><a href="#9338"> 9338: </a><span class="php-comment">         * @since 4.9.019 (2010-04-26)
</span></span><span id="9339" class="l"><a href="#9339"> 9339: </a><span class="php-comment">         */</span>
</span><span id="9340" class="l"><a href="#9340"> 9340: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _outCurveV(<span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x3</span>, <span class="php-var">$y3</span>) {
</span><span id="9341" class="l"><a href="#9341"> 9341: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F v'</span>, <span class="php-var">$x2</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y2</span>) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$x3</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y3</span>) * <span class="php-var">$this</span>-&gt;k));
</span><span id="9342" class="l"><a href="#9342"> 9342: </a>        }
</span><span id="9343" class="l"><a href="#9343"> 9343: </a>
</span><span id="9344" class="l"><a href="#9344"> 9344: </a>        <span class="php-comment">/**
</span></span><span id="9345" class="l"><a href="#9345"> 9345: </a><span class="php-comment">        
</span></span><span id="9346" class="l"><a href="#9346"> 9346: </a><span class="php-comment">         * The new current point shall be (x3, y3).
</span></span><span id="9347" class="l"><a href="#9347"> 9347: </a><span class="php-comment">         * @param float $x1 Abscissa of control point 1.
</span></span><span id="9348" class="l"><a href="#9348"> 9348: </a><span class="php-comment">         * @param float $y1 Ordinate of control point 1.
</span></span><span id="9349" class="l"><a href="#9349"> 9349: </a><span class="php-comment">         * @param float $x2 Abscissa of control point 2.
</span></span><span id="9350" class="l"><a href="#9350"> 9350: </a><span class="php-comment">         * @param float $y2 Ordinate of control point 2.
</span></span><span id="9351" class="l"><a href="#9351"> 9351: </a><span class="php-comment">         * @param float $x3 Abscissa of end point.
</span></span><span id="9352" class="l"><a href="#9352"> 9352: </a><span class="php-comment">         * @param float $y3 Ordinate of end point.
</span></span><span id="9353" class="l"><a href="#9353"> 9353: </a><span class="php-comment">         * @access protected
</span></span><span id="9354" class="l"><a href="#9354"> 9354: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9355" class="l"><a href="#9355"> 9355: </a><span class="php-comment">         */</span>
</span><span id="9356" class="l"><a href="#9356"> 9356: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _outCurveY(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x3</span>, <span class="php-var">$y3</span>) {
</span><span id="9357" class="l"><a href="#9357"> 9357: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F %.2F %.2F %.2F y'</span>, <span class="php-var">$x1</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y1</span>) * <span class="php-var">$this</span>-&gt;k, <span class="php-var">$x3</span> * <span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$y3</span>) * <span class="php-var">$this</span>-&gt;k));
</span><span id="9358" class="l"><a href="#9358"> 9358: </a>        }
</span><span id="9359" class="l"><a href="#9359"> 9359: </a>
</span><span id="9360" class="l"><a href="#9360"> 9360: </a>        <span class="php-comment">/**
</span></span><span id="9361" class="l"><a href="#9361"> 9361: </a><span class="php-comment">         * Draws a line between two points.
</span></span><span id="9362" class="l"><a href="#9362"> 9362: </a><span class="php-comment">         * @param float $x1 Abscissa of first point.
</span></span><span id="9363" class="l"><a href="#9363"> 9363: </a><span class="php-comment">         * @param float $y1 Ordinate of first point.
</span></span><span id="9364" class="l"><a href="#9364"> 9364: </a><span class="php-comment">         * @param float $x2 Abscissa of second point.
</span></span><span id="9365" class="l"><a href="#9365"> 9365: </a><span class="php-comment">         * @param float $y2 Ordinate of second point.
</span></span><span id="9366" class="l"><a href="#9366"> 9366: </a><span class="php-comment">         * @param array $style Line style. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9367" class="l"><a href="#9367"> 9367: </a><span class="php-comment">         * @access public
</span></span><span id="9368" class="l"><a href="#9368"> 9368: </a><span class="php-comment">         * @since 1.0
</span></span><span id="9369" class="l"><a href="#9369"> 9369: </a><span class="php-comment">         * @see SetLineWidth(), SetDrawColor(), SetLineStyle()
</span></span><span id="9370" class="l"><a href="#9370"> 9370: </a><span class="php-comment">         */</span>
</span><span id="9371" class="l"><a href="#9371"> 9371: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Line(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$style</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9372" class="l"><a href="#9372"> 9372: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$style</span>)) {
</span><span id="9373" class="l"><a href="#9373"> 9373: </a>                <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$style</span>);
</span><span id="9374" class="l"><a href="#9374"> 9374: </a>            }
</span><span id="9375" class="l"><a href="#9375"> 9375: </a>            <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>);
</span><span id="9376" class="l"><a href="#9376"> 9376: </a>            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x2</span>, <span class="php-var">$y2</span>);
</span><span id="9377" class="l"><a href="#9377"> 9377: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'S'</span>);
</span><span id="9378" class="l"><a href="#9378"> 9378: </a>        }
</span><span id="9379" class="l"><a href="#9379"> 9379: </a>
</span><span id="9380" class="l"><a href="#9380"> 9380: </a>        <span class="php-comment">/**
</span></span><span id="9381" class="l"><a href="#9381"> 9381: </a><span class="php-comment">         * Draws a rectangle.
</span></span><span id="9382" class="l"><a href="#9382"> 9382: </a><span class="php-comment">         * @param float $x Abscissa of upper-left corner (or upper-right corner for RTL language).
</span></span><span id="9383" class="l"><a href="#9383"> 9383: </a><span class="php-comment">         * @param float $y Ordinate of upper-left corner (or upper-right corner for RTL language).
</span></span><span id="9384" class="l"><a href="#9384"> 9384: </a><span class="php-comment">         * @param float $w Width.
</span></span><span id="9385" class="l"><a href="#9385"> 9385: </a><span class="php-comment">         * @param float $h Height.
</span></span><span id="9386" class="l"><a href="#9386"> 9386: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9387" class="l"><a href="#9387"> 9387: </a><span class="php-comment">         * @param array $border_style Border style of rectangle. Array with keys among the following:
</span></span><span id="9388" class="l"><a href="#9388"> 9388: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9389" class="l"><a href="#9389"> 9389: </a><span class="php-comment">         *   &lt;li&gt;all: Line style of all borders. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9390" class="l"><a href="#9390"> 9390: </a><span class="php-comment">         *   &lt;li&gt;L, T, R, B or combinations: Line style of left, top, right or bottom border. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9391" class="l"><a href="#9391"> 9391: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9392" class="l"><a href="#9392"> 9392: </a><span class="php-comment">         * If a key is not present or is null, not draws the border. Default value: default line style (empty array).
</span></span><span id="9393" class="l"><a href="#9393"> 9393: </a><span class="php-comment">         * @param array $border_style Border style of rectangle. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9394" class="l"><a href="#9394"> 9394: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9395" class="l"><a href="#9395"> 9395: </a><span class="php-comment">         * @access public
</span></span><span id="9396" class="l"><a href="#9396"> 9396: </a><span class="php-comment">         * @since 1.0
</span></span><span id="9397" class="l"><a href="#9397"> 9397: </a><span class="php-comment">         * @see SetLineStyle()
</span></span><span id="9398" class="l"><a href="#9398"> 9398: </a><span class="php-comment">         */</span>
</span><span id="9399" class="l"><a href="#9399"> 9399: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Rect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$border_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9400" class="l"><a href="#9400"> 9400: </a>            <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$style</span>, <span class="php-quote">'F'</span>)) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$fill_color</span>)) {
</span><span id="9401" class="l"><a href="#9401"> 9401: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="9402" class="l"><a href="#9402"> 9402: </a>            }
</span><span id="9403" class="l"><a href="#9403"> 9403: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>);
</span><span id="9404" class="l"><a href="#9404"> 9404: </a>            <span class="php-keyword1">if</span> ((!<span class="php-var">$border_style</span>) <span class="php-keyword1">OR</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$border_style</span>[<span class="php-quote">'all'</span>]))) {
</span><span id="9405" class="l"><a href="#9405"> 9405: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$border_style</span>[<span class="php-quote">'all'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$border_style</span>[<span class="php-quote">'all'</span>]) {
</span><span id="9406" class="l"><a href="#9406"> 9406: </a>                    <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$border_style</span>[<span class="php-quote">'all'</span>]);
</span><span id="9407" class="l"><a href="#9407"> 9407: </a>                    <span class="php-var">$border_style</span> = <span class="php-keyword1">array</span>();
</span><span id="9408" class="l"><a href="#9408"> 9408: </a>                }
</span><span id="9409" class="l"><a href="#9409"> 9409: </a>            }
</span><span id="9410" class="l"><a href="#9410"> 9410: </a>            <span class="php-var">$this</span>-&gt;_outRect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$op</span>);
</span><span id="9411" class="l"><a href="#9411"> 9411: </a>
</span><span id="9412" class="l"><a href="#9412"> 9412: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$border_style</span>) {
</span><span id="9413" class="l"><a href="#9413"> 9413: </a>                <span class="php-var">$border_style2</span> = <span class="php-keyword1">array</span>();
</span><span id="9414" class="l"><a href="#9414"> 9414: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$border_style</span> <span class="php-keyword1">as</span> <span class="php-var">$line</span> =&gt; <span class="php-var">$value</span>) {
</span><span id="9415" class="l"><a href="#9415"> 9415: </a>                    <span class="php-var">$length</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$line</span>);
</span><span id="9416" class="l"><a href="#9416"> 9416: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$length</span>; ++<span class="php-var">$i</span>) {
</span><span id="9417" class="l"><a href="#9417"> 9417: </a>                        <span class="php-var">$border_style2</span>[<span class="php-var">$line</span>[<span class="php-var">$i</span>]] = <span class="php-var">$value</span>;
</span><span id="9418" class="l"><a href="#9418"> 9418: </a>                    }
</span><span id="9419" class="l"><a href="#9419"> 9419: </a>                }
</span><span id="9420" class="l"><a href="#9420"> 9420: </a>                <span class="php-var">$border_style</span> = <span class="php-var">$border_style2</span>;
</span><span id="9421" class="l"><a href="#9421"> 9421: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$border_style</span>[<span class="php-quote">'L'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$border_style</span>[<span class="php-quote">'L'</span>]) {
</span><span id="9422" class="l"><a href="#9422"> 9422: </a>                    <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span> + <span class="php-var">$h</span>, <span class="php-var">$border_style</span>[<span class="php-quote">'L'</span>]);
</span><span id="9423" class="l"><a href="#9423"> 9423: </a>                }
</span><span id="9424" class="l"><a href="#9424"> 9424: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$border_style</span>[<span class="php-quote">'T'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$border_style</span>[<span class="php-quote">'T'</span>]) {
</span><span id="9425" class="l"><a href="#9425"> 9425: </a>                    <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$x</span> + <span class="php-var">$w</span>, <span class="php-var">$y</span>, <span class="php-var">$border_style</span>[<span class="php-quote">'T'</span>]);
</span><span id="9426" class="l"><a href="#9426"> 9426: </a>                }
</span><span id="9427" class="l"><a href="#9427"> 9427: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$border_style</span>[<span class="php-quote">'R'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$border_style</span>[<span class="php-quote">'R'</span>]) {
</span><span id="9428" class="l"><a href="#9428"> 9428: </a>                    <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x</span> + <span class="php-var">$w</span>, <span class="php-var">$y</span>, <span class="php-var">$x</span> + <span class="php-var">$w</span>, <span class="php-var">$y</span> + <span class="php-var">$h</span>, <span class="php-var">$border_style</span>[<span class="php-quote">'R'</span>]);
</span><span id="9429" class="l"><a href="#9429"> 9429: </a>                }
</span><span id="9430" class="l"><a href="#9430"> 9430: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$border_style</span>[<span class="php-quote">'B'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$border_style</span>[<span class="php-quote">'B'</span>]) {
</span><span id="9431" class="l"><a href="#9431"> 9431: </a>                    <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x</span>, <span class="php-var">$y</span> + <span class="php-var">$h</span>, <span class="php-var">$x</span> + <span class="php-var">$w</span>, <span class="php-var">$y</span> + <span class="php-var">$h</span>, <span class="php-var">$border_style</span>[<span class="php-quote">'B'</span>]);
</span><span id="9432" class="l"><a href="#9432"> 9432: </a>                }
</span><span id="9433" class="l"><a href="#9433"> 9433: </a>            }
</span><span id="9434" class="l"><a href="#9434"> 9434: </a>        }
</span><span id="9435" class="l"><a href="#9435"> 9435: </a>
</span><span id="9436" class="l"><a href="#9436"> 9436: </a>        <span class="php-comment">/**
</span></span><span id="9437" class="l"><a href="#9437"> 9437: </a><span class="php-comment">         * Draws a Bezier curve.
</span></span><span id="9438" class="l"><a href="#9438"> 9438: </a><span class="php-comment">         * The Bezier curve is a tangent to the line between the control points at
</span></span><span id="9439" class="l"><a href="#9439"> 9439: </a><span class="php-comment">         * either end of the curve.
</span></span><span id="9440" class="l"><a href="#9440"> 9440: </a><span class="php-comment">         * @param float $x0 Abscissa of start point.
</span></span><span id="9441" class="l"><a href="#9441"> 9441: </a><span class="php-comment">         * @param float $y0 Ordinate of start point.
</span></span><span id="9442" class="l"><a href="#9442"> 9442: </a><span class="php-comment">         * @param float $x1 Abscissa of control point 1.
</span></span><span id="9443" class="l"><a href="#9443"> 9443: </a><span class="php-comment">         * @param float $y1 Ordinate of control point 1.
</span></span><span id="9444" class="l"><a href="#9444"> 9444: </a><span class="php-comment">         * @param float $x2 Abscissa of control point 2.
</span></span><span id="9445" class="l"><a href="#9445"> 9445: </a><span class="php-comment">         * @param float $y2 Ordinate of control point 2.
</span></span><span id="9446" class="l"><a href="#9446"> 9446: </a><span class="php-comment">         * @param float $x3 Abscissa of end point.
</span></span><span id="9447" class="l"><a href="#9447"> 9447: </a><span class="php-comment">         * @param float $y3 Ordinate of end point.
</span></span><span id="9448" class="l"><a href="#9448"> 9448: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9449" class="l"><a href="#9449"> 9449: </a><span class="php-comment">         * @param array $line_style Line style of curve. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9450" class="l"><a href="#9450"> 9450: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9451" class="l"><a href="#9451"> 9451: </a><span class="php-comment">         * @access public
</span></span><span id="9452" class="l"><a href="#9452"> 9452: </a><span class="php-comment">         * @see SetLineStyle()
</span></span><span id="9453" class="l"><a href="#9453"> 9453: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9454" class="l"><a href="#9454"> 9454: </a><span class="php-comment">         */</span>
</span><span id="9455" class="l"><a href="#9455"> 9455: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Curve(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x3</span>, <span class="php-var">$y3</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9456" class="l"><a href="#9456"> 9456: </a>            <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$style</span>, <span class="php-quote">'F'</span>)) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$fill_color</span>)) {
</span><span id="9457" class="l"><a href="#9457"> 9457: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="9458" class="l"><a href="#9458"> 9458: </a>            }
</span><span id="9459" class="l"><a href="#9459"> 9459: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>);
</span><span id="9460" class="l"><a href="#9460"> 9460: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$line_style</span>) {
</span><span id="9461" class="l"><a href="#9461"> 9461: </a>                <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$line_style</span>);
</span><span id="9462" class="l"><a href="#9462"> 9462: </a>            }
</span><span id="9463" class="l"><a href="#9463"> 9463: </a>            <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>);
</span><span id="9464" class="l"><a href="#9464"> 9464: </a>            <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x3</span>, <span class="php-var">$y3</span>);
</span><span id="9465" class="l"><a href="#9465"> 9465: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="9466" class="l"><a href="#9466"> 9466: </a>        }
</span><span id="9467" class="l"><a href="#9467"> 9467: </a>
</span><span id="9468" class="l"><a href="#9468"> 9468: </a>        <span class="php-comment">/**
</span></span><span id="9469" class="l"><a href="#9469"> 9469: </a><span class="php-comment">         * Draws a poly-Bezier curve.
</span></span><span id="9470" class="l"><a href="#9470"> 9470: </a><span class="php-comment">         * Each Bezier curve segment is a tangent to the line between the control points at
</span></span><span id="9471" class="l"><a href="#9471"> 9471: </a><span class="php-comment">         * either end of the curve.
</span></span><span id="9472" class="l"><a href="#9472"> 9472: </a><span class="php-comment">         * @param float $x0 Abscissa of start point.
</span></span><span id="9473" class="l"><a href="#9473"> 9473: </a><span class="php-comment">         * @param float $y0 Ordinate of start point.
</span></span><span id="9474" class="l"><a href="#9474"> 9474: </a><span class="php-comment">         * @param float $segments An array of bezier descriptions. Format: array(x1, y1, x2, y2, x3, y3).
</span></span><span id="9475" class="l"><a href="#9475"> 9475: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9476" class="l"><a href="#9476"> 9476: </a><span class="php-comment">         * @param array $line_style Line style of curve. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9477" class="l"><a href="#9477"> 9477: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9478" class="l"><a href="#9478"> 9478: </a><span class="php-comment">         * @access public
</span></span><span id="9479" class="l"><a href="#9479"> 9479: </a><span class="php-comment">         * @see SetLineStyle()
</span></span><span id="9480" class="l"><a href="#9480"> 9480: </a><span class="php-comment">         * @since 3.0008 (2008-05-12)
</span></span><span id="9481" class="l"><a href="#9481"> 9481: </a><span class="php-comment">         */</span>
</span><span id="9482" class="l"><a href="#9482"> 9482: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Polycurve(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$segments</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9483" class="l"><a href="#9483"> 9483: </a>            <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$style</span>, <span class="php-quote">'F'</span>)) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$fill_color</span>)) {
</span><span id="9484" class="l"><a href="#9484"> 9484: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="9485" class="l"><a href="#9485"> 9485: </a>            }
</span><span id="9486" class="l"><a href="#9486"> 9486: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>);
</span><span id="9487" class="l"><a href="#9487"> 9487: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$op</span> == <span class="php-quote">'f'</span>) {
</span><span id="9488" class="l"><a href="#9488"> 9488: </a>                <span class="php-var">$line_style</span> = <span class="php-keyword1">array</span>();
</span><span id="9489" class="l"><a href="#9489"> 9489: </a>            }
</span><span id="9490" class="l"><a href="#9490"> 9490: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$line_style</span>) {
</span><span id="9491" class="l"><a href="#9491"> 9491: </a>                <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$line_style</span>);
</span><span id="9492" class="l"><a href="#9492"> 9492: </a>            }
</span><span id="9493" class="l"><a href="#9493"> 9493: </a>            <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>);
</span><span id="9494" class="l"><a href="#9494"> 9494: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$segments</span> <span class="php-keyword1">as</span> <span class="php-var">$segment</span>) {
</span><span id="9495" class="l"><a href="#9495"> 9495: </a>                <span class="php-keyword1">list</span>(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x3</span>, <span class="php-var">$y3</span>) = <span class="php-var">$segment</span>;
</span><span id="9496" class="l"><a href="#9496"> 9496: </a>                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x3</span>, <span class="php-var">$y3</span>);
</span><span id="9497" class="l"><a href="#9497"> 9497: </a>            }
</span><span id="9498" class="l"><a href="#9498"> 9498: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="9499" class="l"><a href="#9499"> 9499: </a>        }
</span><span id="9500" class="l"><a href="#9500"> 9500: </a>
</span><span id="9501" class="l"><a href="#9501"> 9501: </a>        <span class="php-comment">/**
</span></span><span id="9502" class="l"><a href="#9502"> 9502: </a><span class="php-comment">         * Draws an ellipse.
</span></span><span id="9503" class="l"><a href="#9503"> 9503: </a><span class="php-comment">         * An ellipse is formed from n Bezier curves.
</span></span><span id="9504" class="l"><a href="#9504"> 9504: </a><span class="php-comment">         * @param float $x0 Abscissa of center point.
</span></span><span id="9505" class="l"><a href="#9505"> 9505: </a><span class="php-comment">         * @param float $y0 Ordinate of center point.
</span></span><span id="9506" class="l"><a href="#9506"> 9506: </a><span class="php-comment">         * @param float $rx Horizontal radius.
</span></span><span id="9507" class="l"><a href="#9507"> 9507: </a><span class="php-comment">         * @param float $ry Vertical radius (if ry = 0 then is a circle, see {@link Circle Circle}). Default value: 0.
</span></span><span id="9508" class="l"><a href="#9508"> 9508: </a><span class="php-comment">         * @param float $angle: Angle oriented (anti-clockwise). Default value: 0.
</span></span><span id="9509" class="l"><a href="#9509"> 9509: </a><span class="php-comment">         * @param float $astart: Angle start of draw line. Default value: 0.
</span></span><span id="9510" class="l"><a href="#9510"> 9510: </a><span class="php-comment">         * @param float $afinish: Angle finish of draw line. Default value: 360.
</span></span><span id="9511" class="l"><a href="#9511"> 9511: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9512" class="l"><a href="#9512"> 9512: </a><span class="php-comment">         * @param array $line_style Line style of ellipse. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9513" class="l"><a href="#9513"> 9513: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9514" class="l"><a href="#9514"> 9514: </a><span class="php-comment">         * @param integer $nc Number of curves used to draw a 90 degrees portion of ellipse.
</span></span><span id="9515" class="l"><a href="#9515"> 9515: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="9516" class="l"><a href="#9516"> 9516: </a><span class="php-comment">         * @access public
</span></span><span id="9517" class="l"><a href="#9517"> 9517: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9518" class="l"><a href="#9518"> 9518: </a><span class="php-comment">         */</span>
</span><span id="9519" class="l"><a href="#9519"> 9519: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Ellipse(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>=<span class="php-quote">''</span>, <span class="php-var">$angle</span>=<span class="php-num">0</span>, <span class="php-var">$astart</span>=<span class="php-num">0</span>, <span class="php-var">$afinish</span>=<span class="php-num">360</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$nc</span>=<span class="php-num">2</span>) {
</span><span id="9520" class="l"><a href="#9520"> 9520: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$ry</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$ry</span> == <span class="php-num">0</span>)) {
</span><span id="9521" class="l"><a href="#9521"> 9521: </a>                <span class="php-var">$ry</span> = <span class="php-var">$rx</span>;
</span><span id="9522" class="l"><a href="#9522"> 9522: </a>            }
</span><span id="9523" class="l"><a href="#9523"> 9523: </a>            <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$style</span>, <span class="php-quote">'F'</span>)) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$fill_color</span>)) {
</span><span id="9524" class="l"><a href="#9524"> 9524: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="9525" class="l"><a href="#9525"> 9525: </a>            }
</span><span id="9526" class="l"><a href="#9526"> 9526: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>);
</span><span id="9527" class="l"><a href="#9527"> 9527: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$op</span> == <span class="php-quote">'f'</span>) {
</span><span id="9528" class="l"><a href="#9528"> 9528: </a>                <span class="php-var">$line_style</span> = <span class="php-keyword1">array</span>();
</span><span id="9529" class="l"><a href="#9529"> 9529: </a>            }
</span><span id="9530" class="l"><a href="#9530"> 9530: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$line_style</span>) {
</span><span id="9531" class="l"><a href="#9531"> 9531: </a>                <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$line_style</span>);
</span><span id="9532" class="l"><a href="#9532"> 9532: </a>            }
</span><span id="9533" class="l"><a href="#9533"> 9533: </a>            <span class="php-var">$this</span>-&gt;_outellipticalarc(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-var">$angle</span>, <span class="php-var">$astart</span>, <span class="php-var">$afinish</span>, <span class="php-keyword1">false</span>, <span class="php-var">$nc</span>);
</span><span id="9534" class="l"><a href="#9534"> 9534: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="9535" class="l"><a href="#9535"> 9535: </a>        }
</span><span id="9536" class="l"><a href="#9536"> 9536: </a>
</span><span id="9537" class="l"><a href="#9537"> 9537: </a>        <span class="php-comment">/**
</span></span><span id="9538" class="l"><a href="#9538"> 9538: </a><span class="php-comment">         * Append an elliptical arc to the current path.
</span></span><span id="9539" class="l"><a href="#9539"> 9539: </a><span class="php-comment">         * An ellipse is formed from n Bezier curves.
</span></span><span id="9540" class="l"><a href="#9540"> 9540: </a><span class="php-comment">         * @param float $xc Abscissa of center point.
</span></span><span id="9541" class="l"><a href="#9541"> 9541: </a><span class="php-comment">         * @param float $yc Ordinate of center point.
</span></span><span id="9542" class="l"><a href="#9542"> 9542: </a><span class="php-comment">         * @param float $rx Horizontal radius.
</span></span><span id="9543" class="l"><a href="#9543"> 9543: </a><span class="php-comment">         * @param float $ry Vertical radius (if ry = 0 then is a circle, see {@link Circle Circle}). Default value: 0.
</span></span><span id="9544" class="l"><a href="#9544"> 9544: </a><span class="php-comment">         * @param float $xang: Angle between the X-axis and the major axis of the ellipse. Default value: 0.
</span></span><span id="9545" class="l"><a href="#9545"> 9545: </a><span class="php-comment">         * @param float $angs: Angle start of draw line. Default value: 0.
</span></span><span id="9546" class="l"><a href="#9546"> 9546: </a><span class="php-comment">         * @param float $angf: Angle finish of draw line. Default value: 360.
</span></span><span id="9547" class="l"><a href="#9547"> 9547: </a><span class="php-comment">         * @param boolean $pie if true do not mark the border point (used to draw pie sectors).
</span></span><span id="9548" class="l"><a href="#9548"> 9548: </a><span class="php-comment">         * @param integer $nc Number of curves used to draw a 90 degrees portion of ellipse.
</span></span><span id="9549" class="l"><a href="#9549"> 9549: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="9550" class="l"><a href="#9550"> 9550: </a><span class="php-comment">         * @access protected
</span></span><span id="9551" class="l"><a href="#9551"> 9551: </a><span class="php-comment">         * @since 4.9.019 (2010-04-26)
</span></span><span id="9552" class="l"><a href="#9552"> 9552: </a><span class="php-comment">         */</span>
</span><span id="9553" class="l"><a href="#9553"> 9553: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _outellipticalarc(<span class="php-var">$xc</span>, <span class="php-var">$yc</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-var">$xang</span>=<span class="php-num">0</span>, <span class="php-var">$angs</span>=<span class="php-num">0</span>, <span class="php-var">$angf</span>=<span class="php-num">360</span>, <span class="php-var">$pie</span>=<span class="php-keyword1">false</span>, <span class="php-var">$nc</span>=<span class="php-num">2</span>) {
</span><span id="9554" class="l"><a href="#9554"> 9554: </a>            <span class="php-var">$k</span> = <span class="php-var">$this</span>-&gt;k;
</span><span id="9555" class="l"><a href="#9555"> 9555: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$nc</span> &lt; <span class="php-num">2</span>) {
</span><span id="9556" class="l"><a href="#9556"> 9556: </a>                <span class="php-var">$nc</span> = <span class="php-num">2</span>;
</span><span id="9557" class="l"><a href="#9557"> 9557: </a>            }
</span><span id="9558" class="l"><a href="#9558"> 9558: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$pie</span>) {
</span><span id="9559" class="l"><a href="#9559"> 9559: </a>                <span class="php-comment">// center of the arc</span>
</span><span id="9560" class="l"><a href="#9560"> 9560: </a>                <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$xc</span>, <span class="php-var">$yc</span>);
</span><span id="9561" class="l"><a href="#9561"> 9561: </a>            }
</span><span id="9562" class="l"><a href="#9562"> 9562: </a>            <span class="php-var">$xang</span> = <span class="php-keyword2">deg2rad</span>((float) <span class="php-var">$xang</span>);
</span><span id="9563" class="l"><a href="#9563"> 9563: </a>            <span class="php-var">$angs</span> = <span class="php-keyword2">deg2rad</span>((float) <span class="php-var">$angs</span>);
</span><span id="9564" class="l"><a href="#9564"> 9564: </a>            <span class="php-var">$angf</span> = <span class="php-keyword2">deg2rad</span>((float) <span class="php-var">$angf</span>);
</span><span id="9565" class="l"><a href="#9565"> 9565: </a>            <span class="php-var">$as</span> = <span class="php-keyword2">atan2</span>((<span class="php-keyword2">sin</span>(<span class="php-var">$angs</span>) / <span class="php-var">$ry</span>), (<span class="php-keyword2">cos</span>(<span class="php-var">$angs</span>) / <span class="php-var">$rx</span>));
</span><span id="9566" class="l"><a href="#9566"> 9566: </a>            <span class="php-var">$af</span> = <span class="php-keyword2">atan2</span>((<span class="php-keyword2">sin</span>(<span class="php-var">$angf</span>) / <span class="php-var">$ry</span>), (<span class="php-keyword2">cos</span>(<span class="php-var">$angf</span>) / <span class="php-var">$rx</span>));
</span><span id="9567" class="l"><a href="#9567"> 9567: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$as</span> &lt; <span class="php-num">0</span>) {
</span><span id="9568" class="l"><a href="#9568"> 9568: </a>                <span class="php-var">$as</span> += (<span class="php-num">2</span> * M_PI);
</span><span id="9569" class="l"><a href="#9569"> 9569: </a>            }
</span><span id="9570" class="l"><a href="#9570"> 9570: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$af</span> &lt; <span class="php-num">0</span>) {
</span><span id="9571" class="l"><a href="#9571"> 9571: </a>                <span class="php-var">$af</span> += (<span class="php-num">2</span> * M_PI);
</span><span id="9572" class="l"><a href="#9572"> 9572: </a>            }
</span><span id="9573" class="l"><a href="#9573"> 9573: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$as</span> &gt; <span class="php-var">$af</span>) {
</span><span id="9574" class="l"><a href="#9574"> 9574: </a>                <span class="php-comment">// reverse rotation go clockwise</span>
</span><span id="9575" class="l"><a href="#9575"> 9575: </a>                <span class="php-var">$as</span> -= (<span class="php-num">2</span> * M_PI);
</span><span id="9576" class="l"><a href="#9576"> 9576: </a>            }
</span><span id="9577" class="l"><a href="#9577"> 9577: </a>            <span class="php-var">$total_angle</span> = (<span class="php-var">$af</span> - <span class="php-var">$as</span>);
</span><span id="9578" class="l"><a href="#9578"> 9578: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$nc</span> &lt; <span class="php-num">2</span>) {
</span><span id="9579" class="l"><a href="#9579"> 9579: </a>                <span class="php-var">$nc</span> = <span class="php-num">2</span>;
</span><span id="9580" class="l"><a href="#9580"> 9580: </a>            }
</span><span id="9581" class="l"><a href="#9581"> 9581: </a>            <span class="php-comment">// total arcs to draw</span>
</span><span id="9582" class="l"><a href="#9582"> 9582: </a>            <span class="php-var">$nc</span> *= (<span class="php-num">2</span> * <span class="php-keyword2">abs</span>(<span class="php-var">$total_angle</span>) / M_PI);
</span><span id="9583" class="l"><a href="#9583"> 9583: </a>            <span class="php-var">$nc</span> = <span class="php-keyword2">round</span>(<span class="php-var">$nc</span>) + <span class="php-num">1</span>;
</span><span id="9584" class="l"><a href="#9584"> 9584: </a>            <span class="php-comment">// angle of each arc</span>
</span><span id="9585" class="l"><a href="#9585"> 9585: </a>            <span class="php-var">$arcang</span> = <span class="php-var">$total_angle</span> / <span class="php-var">$nc</span>;
</span><span id="9586" class="l"><a href="#9586"> 9586: </a>            <span class="php-comment">// center point in PDF coordiantes</span>
</span><span id="9587" class="l"><a href="#9587"> 9587: </a>            <span class="php-var">$x0</span> = <span class="php-var">$xc</span>;
</span><span id="9588" class="l"><a href="#9588"> 9588: </a>            <span class="php-var">$y0</span> = (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$yc</span>);
</span><span id="9589" class="l"><a href="#9589"> 9589: </a>            <span class="php-comment">// starting angle</span>
</span><span id="9590" class="l"><a href="#9590"> 9590: </a>            <span class="php-var">$ang</span> = <span class="php-var">$as</span>;
</span><span id="9591" class="l"><a href="#9591"> 9591: </a>            <span class="php-var">$alpha</span> = <span class="php-keyword2">sin</span>(<span class="php-var">$arcang</span>) * ((<span class="php-keyword2">sqrt</span>(<span class="php-num">4</span> + (<span class="php-num">3</span> * <span class="php-keyword2">pow</span>(<span class="php-keyword2">tan</span>((<span class="php-var">$arcang</span>) / <span class="php-num">2</span>), <span class="php-num">2</span>))) - <span class="php-num">1</span>) / <span class="php-num">3</span>);
</span><span id="9592" class="l"><a href="#9592"> 9592: </a>            <span class="php-var">$cos_xang</span> = <span class="php-keyword2">cos</span>(<span class="php-var">$xang</span>);
</span><span id="9593" class="l"><a href="#9593"> 9593: </a>            <span class="php-var">$sin_xang</span> = <span class="php-keyword2">sin</span>(<span class="php-var">$xang</span>);
</span><span id="9594" class="l"><a href="#9594"> 9594: </a>            <span class="php-var">$cos_ang</span> = <span class="php-keyword2">cos</span>(<span class="php-var">$ang</span>);
</span><span id="9595" class="l"><a href="#9595"> 9595: </a>            <span class="php-var">$sin_ang</span> = <span class="php-keyword2">sin</span>(<span class="php-var">$ang</span>);
</span><span id="9596" class="l"><a href="#9596"> 9596: </a>            <span class="php-comment">// first arc point</span>
</span><span id="9597" class="l"><a href="#9597"> 9597: </a>            <span class="php-var">$px1</span> = <span class="php-var">$x0</span> + (<span class="php-var">$rx</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$cos_ang</span>) - (<span class="php-var">$ry</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$sin_ang</span>);
</span><span id="9598" class="l"><a href="#9598"> 9598: </a>            <span class="php-var">$py1</span> = <span class="php-var">$y0</span> + (<span class="php-var">$rx</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$cos_ang</span>) + (<span class="php-var">$ry</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$sin_ang</span>);
</span><span id="9599" class="l"><a href="#9599"> 9599: </a>            <span class="php-comment">// first Bezier control point</span>
</span><span id="9600" class="l"><a href="#9600"> 9600: </a>            <span class="php-var">$qx1</span> = (<span class="php-var">$alpha</span> * ((-<span class="php-var">$rx</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$sin_ang</span>) - (<span class="php-var">$ry</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$cos_ang</span>)));
</span><span id="9601" class="l"><a href="#9601"> 9601: </a>            <span class="php-var">$qy1</span> = (<span class="php-var">$alpha</span> * ((-<span class="php-var">$rx</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$sin_ang</span>) + (<span class="php-var">$ry</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$cos_ang</span>)));
</span><span id="9602" class="l"><a href="#9602"> 9602: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$pie</span>) {
</span><span id="9603" class="l"><a href="#9603"> 9603: </a>                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$px1</span>, <span class="php-var">$this</span>-&gt;h - <span class="php-var">$py1</span>);
</span><span id="9604" class="l"><a href="#9604"> 9604: </a>            } <span class="php-keyword1">else</span> {
</span><span id="9605" class="l"><a href="#9605"> 9605: </a>                <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$px1</span>, <span class="php-var">$this</span>-&gt;h - <span class="php-var">$py1</span>);
</span><span id="9606" class="l"><a href="#9606"> 9606: </a>            }
</span><span id="9607" class="l"><a href="#9607"> 9607: </a>            <span class="php-comment">// draw arcs</span>
</span><span id="9608" class="l"><a href="#9608"> 9608: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt;= <span class="php-var">$nc</span>; ++<span class="php-var">$i</span>) {
</span><span id="9609" class="l"><a href="#9609"> 9609: </a>                <span class="php-comment">// starting angle</span>
</span><span id="9610" class="l"><a href="#9610"> 9610: </a>                <span class="php-var">$ang</span> = <span class="php-var">$as</span> + (<span class="php-var">$i</span> * <span class="php-var">$arcang</span>);
</span><span id="9611" class="l"><a href="#9611"> 9611: </a>                <span class="php-var">$cos_xang</span> = <span class="php-keyword2">cos</span>(<span class="php-var">$xang</span>);
</span><span id="9612" class="l"><a href="#9612"> 9612: </a>                <span class="php-var">$sin_xang</span> = <span class="php-keyword2">sin</span>(<span class="php-var">$xang</span>);
</span><span id="9613" class="l"><a href="#9613"> 9613: </a>                <span class="php-var">$cos_ang</span> = <span class="php-keyword2">cos</span>(<span class="php-var">$ang</span>);
</span><span id="9614" class="l"><a href="#9614"> 9614: </a>                <span class="php-var">$sin_ang</span> = <span class="php-keyword2">sin</span>(<span class="php-var">$ang</span>);
</span><span id="9615" class="l"><a href="#9615"> 9615: </a>                <span class="php-comment">// second arc point</span>
</span><span id="9616" class="l"><a href="#9616"> 9616: </a>                <span class="php-var">$px2</span> = <span class="php-var">$x0</span> + (<span class="php-var">$rx</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$cos_ang</span>) - (<span class="php-var">$ry</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$sin_ang</span>);
</span><span id="9617" class="l"><a href="#9617"> 9617: </a>                <span class="php-var">$py2</span> = <span class="php-var">$y0</span> + (<span class="php-var">$rx</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$cos_ang</span>) + (<span class="php-var">$ry</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$sin_ang</span>);
</span><span id="9618" class="l"><a href="#9618"> 9618: </a>                <span class="php-comment">// second Bezier control point</span>
</span><span id="9619" class="l"><a href="#9619"> 9619: </a>                <span class="php-var">$qx2</span> = (<span class="php-var">$alpha</span> * ((-<span class="php-var">$rx</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$sin_ang</span>) - (<span class="php-var">$ry</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$cos_ang</span>)));
</span><span id="9620" class="l"><a href="#9620"> 9620: </a>                <span class="php-var">$qy2</span> = (<span class="php-var">$alpha</span> * ((-<span class="php-var">$rx</span> * <span class="php-var">$sin_xang</span> * <span class="php-var">$sin_ang</span>) + (<span class="php-var">$ry</span> * <span class="php-var">$cos_xang</span> * <span class="php-var">$cos_ang</span>)));
</span><span id="9621" class="l"><a href="#9621"> 9621: </a>                <span class="php-comment">// draw arc</span>
</span><span id="9622" class="l"><a href="#9622"> 9622: </a>                <span class="php-var">$this</span>-&gt;_outCurve((<span class="php-var">$px1</span> + <span class="php-var">$qx1</span>), (<span class="php-var">$this</span>-&gt;h - (<span class="php-var">$py1</span> + <span class="php-var">$qy1</span>)), (<span class="php-var">$px2</span> - <span class="php-var">$qx2</span>), (<span class="php-var">$this</span>-&gt;h - (<span class="php-var">$py2</span> - <span class="php-var">$qy2</span>)), <span class="php-var">$px2</span>, (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$py2</span>));
</span><span id="9623" class="l"><a href="#9623"> 9623: </a>                <span class="php-comment">// move to next point</span>
</span><span id="9624" class="l"><a href="#9624"> 9624: </a>                <span class="php-var">$px1</span> = <span class="php-var">$px2</span>;
</span><span id="9625" class="l"><a href="#9625"> 9625: </a>                <span class="php-var">$py1</span> = <span class="php-var">$py2</span>;
</span><span id="9626" class="l"><a href="#9626"> 9626: </a>                <span class="php-var">$qx1</span> = <span class="php-var">$qx2</span>;
</span><span id="9627" class="l"><a href="#9627"> 9627: </a>                <span class="php-var">$qy1</span> = <span class="php-var">$qy2</span>;
</span><span id="9628" class="l"><a href="#9628"> 9628: </a>            }
</span><span id="9629" class="l"><a href="#9629"> 9629: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$pie</span>) {
</span><span id="9630" class="l"><a href="#9630"> 9630: </a>                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$xc</span>, <span class="php-var">$yc</span>);
</span><span id="9631" class="l"><a href="#9631"> 9631: </a>            }
</span><span id="9632" class="l"><a href="#9632"> 9632: </a>        }
</span><span id="9633" class="l"><a href="#9633"> 9633: </a>
</span><span id="9634" class="l"><a href="#9634"> 9634: </a>
</span><span id="9635" class="l"><a href="#9635"> 9635: </a>        <span class="php-comment">/**
</span></span><span id="9636" class="l"><a href="#9636"> 9636: </a><span class="php-comment">         * Draws a circle.
</span></span><span id="9637" class="l"><a href="#9637"> 9637: </a><span class="php-comment">         * A circle is formed from n Bezier curves.
</span></span><span id="9638" class="l"><a href="#9638"> 9638: </a><span class="php-comment">         * @param float $x0 Abscissa of center point.
</span></span><span id="9639" class="l"><a href="#9639"> 9639: </a><span class="php-comment">         * @param float $y0 Ordinate of center point.
</span></span><span id="9640" class="l"><a href="#9640"> 9640: </a><span class="php-comment">         * @param float $r Radius.
</span></span><span id="9641" class="l"><a href="#9641"> 9641: </a><span class="php-comment">         * @param float $angstr: Angle start of draw line. Default value: 0.
</span></span><span id="9642" class="l"><a href="#9642"> 9642: </a><span class="php-comment">         * @param float $angend: Angle finish of draw line. Default value: 360.
</span></span><span id="9643" class="l"><a href="#9643"> 9643: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9644" class="l"><a href="#9644"> 9644: </a><span class="php-comment">         * @param array $line_style Line style of circle. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9645" class="l"><a href="#9645"> 9645: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(red, green, blue). Default value: default color (empty array).
</span></span><span id="9646" class="l"><a href="#9646"> 9646: </a><span class="php-comment">         * @param integer $nc Number of curves used to draw a 90 degrees portion of circle.
</span></span><span id="9647" class="l"><a href="#9647"> 9647: </a><span class="php-comment">         * @access public
</span></span><span id="9648" class="l"><a href="#9648"> 9648: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9649" class="l"><a href="#9649"> 9649: </a><span class="php-comment">         */</span>
</span><span id="9650" class="l"><a href="#9650"> 9650: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Circle(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$r</span>, <span class="php-var">$angstr</span>=<span class="php-num">0</span>, <span class="php-var">$angend</span>=<span class="php-num">360</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$nc</span>=<span class="php-num">2</span>) {
</span><span id="9651" class="l"><a href="#9651"> 9651: </a>            <span class="php-var">$this</span>-&gt;Ellipse(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$r</span>, <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-var">$angstr</span>, <span class="php-var">$angend</span>, <span class="php-var">$style</span>, <span class="php-var">$line_style</span>, <span class="php-var">$fill_color</span>, <span class="php-var">$nc</span>);
</span><span id="9652" class="l"><a href="#9652"> 9652: </a>        }
</span><span id="9653" class="l"><a href="#9653"> 9653: </a>
</span><span id="9654" class="l"><a href="#9654"> 9654: </a>        <span class="php-comment">/**
</span></span><span id="9655" class="l"><a href="#9655"> 9655: </a><span class="php-comment">         * Draws a polygonal line
</span></span><span id="9656" class="l"><a href="#9656"> 9656: </a><span class="php-comment">         * @param array $p Points 0 to ($np - 1). Array with values (x0, y0, x1, y1,..., x(np-1), y(np - 1))
</span></span><span id="9657" class="l"><a href="#9657"> 9657: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9658" class="l"><a href="#9658"> 9658: </a><span class="php-comment">         * @param array $line_style Line style of polygon. Array with keys among the following:
</span></span><span id="9659" class="l"><a href="#9659"> 9659: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9660" class="l"><a href="#9660"> 9660: </a><span class="php-comment">         *   &lt;li&gt;all: Line style of all lines. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9661" class="l"><a href="#9661"> 9661: </a><span class="php-comment">         *   &lt;li&gt;0 to ($np - 1): Line style of each line. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9662" class="l"><a href="#9662"> 9662: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9663" class="l"><a href="#9663"> 9663: </a><span class="php-comment">         * If a key is not present or is null, not draws the line. Default value is default line style (empty array).
</span></span><span id="9664" class="l"><a href="#9664"> 9664: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9665" class="l"><a href="#9665"> 9665: </a><span class="php-comment">         * @param boolean $closed if true the polygon is closes, otherwise will remain open
</span></span><span id="9666" class="l"><a href="#9666"> 9666: </a><span class="php-comment">         * @access public
</span></span><span id="9667" class="l"><a href="#9667"> 9667: </a><span class="php-comment">         * @since 4.8.003 (2009-09-15)
</span></span><span id="9668" class="l"><a href="#9668"> 9668: </a><span class="php-comment">         */</span>
</span><span id="9669" class="l"><a href="#9669"> 9669: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> PolyLine(<span class="php-var">$p</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9670" class="l"><a href="#9670"> 9670: </a>            <span class="php-var">$this</span>-&gt;Polygon(<span class="php-var">$p</span>, <span class="php-var">$style</span>, <span class="php-var">$line_style</span>, <span class="php-var">$fill_color</span>, <span class="php-keyword1">false</span>);
</span><span id="9671" class="l"><a href="#9671"> 9671: </a>        }
</span><span id="9672" class="l"><a href="#9672"> 9672: </a>
</span><span id="9673" class="l"><a href="#9673"> 9673: </a>        <span class="php-comment">/**
</span></span><span id="9674" class="l"><a href="#9674"> 9674: </a><span class="php-comment">         * Draws a polygon.
</span></span><span id="9675" class="l"><a href="#9675"> 9675: </a><span class="php-comment">         * @param array $p Points 0 to ($np - 1). Array with values (x0, y0, x1, y1,..., x(np-1), y(np - 1))
</span></span><span id="9676" class="l"><a href="#9676"> 9676: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9677" class="l"><a href="#9677"> 9677: </a><span class="php-comment">         * @param array $line_style Line style of polygon. Array with keys among the following:
</span></span><span id="9678" class="l"><a href="#9678"> 9678: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9679" class="l"><a href="#9679"> 9679: </a><span class="php-comment">         *   &lt;li&gt;all: Line style of all lines. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9680" class="l"><a href="#9680"> 9680: </a><span class="php-comment">         *   &lt;li&gt;0 to ($np - 1): Line style of each line. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9681" class="l"><a href="#9681"> 9681: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9682" class="l"><a href="#9682"> 9682: </a><span class="php-comment">         * If a key is not present or is null, not draws the line. Default value is default line style (empty array).
</span></span><span id="9683" class="l"><a href="#9683"> 9683: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9684" class="l"><a href="#9684"> 9684: </a><span class="php-comment">         * @param boolean $closed if true the polygon is closes, otherwise will remain open
</span></span><span id="9685" class="l"><a href="#9685"> 9685: </a><span class="php-comment">         * @access public
</span></span><span id="9686" class="l"><a href="#9686"> 9686: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9687" class="l"><a href="#9687"> 9687: </a><span class="php-comment">         */</span>
</span><span id="9688" class="l"><a href="#9688"> 9688: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Polygon(<span class="php-var">$p</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$closed</span>=<span class="php-keyword1">true</span>) {
</span><span id="9689" class="l"><a href="#9689"> 9689: </a>            <span class="php-var">$nc</span> = <span class="php-keyword2">count</span>(<span class="php-var">$p</span>); <span class="php-comment">// number of coordinates</span>
</span><span id="9690" class="l"><a href="#9690"> 9690: </a>            <span class="php-var">$np</span> = <span class="php-var">$nc</span> / <span class="php-num">2</span>; <span class="php-comment">// number of points</span>
</span><span id="9691" class="l"><a href="#9691"> 9691: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$closed</span>) {
</span><span id="9692" class="l"><a href="#9692"> 9692: </a>                <span class="php-comment">// close polygon by adding the first 2 points at the end (one line)</span>
</span><span id="9693" class="l"><a href="#9693"> 9693: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-num">4</span>; ++<span class="php-var">$i</span>) {
</span><span id="9694" class="l"><a href="#9694"> 9694: </a>                    <span class="php-var">$p</span>[<span class="php-var">$nc</span> + <span class="php-var">$i</span>] = <span class="php-var">$p</span>[<span class="php-var">$i</span>];
</span><span id="9695" class="l"><a href="#9695"> 9695: </a>                }
</span><span id="9696" class="l"><a href="#9696"> 9696: </a>                <span class="php-comment">// copy style for the last added line</span>
</span><span id="9697" class="l"><a href="#9697"> 9697: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$line_style</span>[<span class="php-num">0</span>])) {
</span><span id="9698" class="l"><a href="#9698"> 9698: </a>                    <span class="php-var">$line_style</span>[<span class="php-var">$np</span>] = <span class="php-var">$line_style</span>[<span class="php-num">0</span>];
</span><span id="9699" class="l"><a href="#9699"> 9699: </a>                }
</span><span id="9700" class="l"><a href="#9700"> 9700: </a>                <span class="php-var">$nc</span> += <span class="php-num">4</span>;
</span><span id="9701" class="l"><a href="#9701"> 9701: </a>            }
</span><span id="9702" class="l"><a href="#9702"> 9702: </a>            <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$style</span>, <span class="php-quote">'F'</span>)) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$fill_color</span>)) {
</span><span id="9703" class="l"><a href="#9703"> 9703: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="9704" class="l"><a href="#9704"> 9704: </a>            }
</span><span id="9705" class="l"><a href="#9705"> 9705: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>);
</span><span id="9706" class="l"><a href="#9706"> 9706: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$op</span> == <span class="php-quote">'f'</span>) {
</span><span id="9707" class="l"><a href="#9707"> 9707: </a>                <span class="php-var">$line_style</span> = <span class="php-keyword1">array</span>();
</span><span id="9708" class="l"><a href="#9708"> 9708: </a>            }
</span><span id="9709" class="l"><a href="#9709"> 9709: </a>            <span class="php-var">$draw</span> = <span class="php-keyword1">true</span>;
</span><span id="9710" class="l"><a href="#9710"> 9710: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$line_style</span>) {
</span><span id="9711" class="l"><a href="#9711"> 9711: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$line_style</span>[<span class="php-quote">'all'</span>])) {
</span><span id="9712" class="l"><a href="#9712"> 9712: </a>                    <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$line_style</span>[<span class="php-quote">'all'</span>]);
</span><span id="9713" class="l"><a href="#9713"> 9713: </a>                } <span class="php-keyword1">else</span> {
</span><span id="9714" class="l"><a href="#9714"> 9714: </a>                    <span class="php-var">$draw</span> = <span class="php-keyword1">false</span>;
</span><span id="9715" class="l"><a href="#9715"> 9715: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$op</span> == <span class="php-quote">'B'</span>) {
</span><span id="9716" class="l"><a href="#9716"> 9716: </a>                        <span class="php-comment">// draw fill</span>
</span><span id="9717" class="l"><a href="#9717"> 9717: </a>                        <span class="php-var">$op</span> = <span class="php-quote">'f'</span>;
</span><span id="9718" class="l"><a href="#9718"> 9718: </a>                        <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$p</span>[<span class="php-num">0</span>], <span class="php-var">$p</span>[<span class="php-num">1</span>]);
</span><span id="9719" class="l"><a href="#9719"> 9719: </a>                        <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">2</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$nc</span>; <span class="php-var">$i</span> = <span class="php-var">$i</span> + <span class="php-num">2</span>) {
</span><span id="9720" class="l"><a href="#9720"> 9720: </a>                            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$p</span>[<span class="php-var">$i</span>], <span class="php-var">$p</span>[<span class="php-var">$i</span> + <span class="php-num">1</span>]);
</span><span id="9721" class="l"><a href="#9721"> 9721: </a>                        }
</span><span id="9722" class="l"><a href="#9722"> 9722: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="9723" class="l"><a href="#9723"> 9723: </a>                    }
</span><span id="9724" class="l"><a href="#9724"> 9724: </a>                    <span class="php-comment">// draw outline</span>
</span><span id="9725" class="l"><a href="#9725"> 9725: </a>                    <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$p</span>[<span class="php-num">0</span>], <span class="php-var">$p</span>[<span class="php-num">1</span>]);
</span><span id="9726" class="l"><a href="#9726"> 9726: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">2</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$nc</span>; <span class="php-var">$i</span> = <span class="php-var">$i</span> + <span class="php-num">2</span>) {
</span><span id="9727" class="l"><a href="#9727"> 9727: </a>                        <span class="php-var">$line_num</span> = (<span class="php-var">$i</span> / <span class="php-num">2</span>) - <span class="php-num">1</span>;
</span><span id="9728" class="l"><a href="#9728"> 9728: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$line_style</span>[<span class="php-var">$line_num</span>])) {
</span><span id="9729" class="l"><a href="#9729"> 9729: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$line_style</span>[<span class="php-var">$line_num</span>] != <span class="php-num">0</span>) {
</span><span id="9730" class="l"><a href="#9730"> 9730: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$line_style</span>[<span class="php-var">$line_num</span>])) {
</span><span id="9731" class="l"><a href="#9731"> 9731: </a>                                    <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'S'</span>);
</span><span id="9732" class="l"><a href="#9732"> 9732: </a>                                    <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$line_style</span>[<span class="php-var">$line_num</span>]);
</span><span id="9733" class="l"><a href="#9733"> 9733: </a>                                    <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$p</span>[<span class="php-var">$i</span> - <span class="php-num">2</span>], <span class="php-var">$p</span>[<span class="php-var">$i</span> - <span class="php-num">1</span>]);
</span><span id="9734" class="l"><a href="#9734"> 9734: </a>                                    <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$p</span>[<span class="php-var">$i</span>], <span class="php-var">$p</span>[<span class="php-var">$i</span> + <span class="php-num">1</span>]);
</span><span id="9735" class="l"><a href="#9735"> 9735: </a>                                    <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'S'</span>);
</span><span id="9736" class="l"><a href="#9736"> 9736: </a>                                    <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$p</span>[<span class="php-var">$i</span>], <span class="php-var">$p</span>[<span class="php-var">$i</span> + <span class="php-num">1</span>]);
</span><span id="9737" class="l"><a href="#9737"> 9737: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="9738" class="l"><a href="#9738"> 9738: </a>                                    <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$p</span>[<span class="php-var">$i</span>], <span class="php-var">$p</span>[<span class="php-var">$i</span> + <span class="php-num">1</span>]);
</span><span id="9739" class="l"><a href="#9739"> 9739: </a>                                }
</span><span id="9740" class="l"><a href="#9740"> 9740: </a>                            }
</span><span id="9741" class="l"><a href="#9741"> 9741: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="9742" class="l"><a href="#9742"> 9742: </a>                            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$p</span>[<span class="php-var">$i</span>], <span class="php-var">$p</span>[<span class="php-var">$i</span> + <span class="php-num">1</span>]);
</span><span id="9743" class="l"><a href="#9743"> 9743: </a>                        }
</span><span id="9744" class="l"><a href="#9744"> 9744: </a>                    }
</span><span id="9745" class="l"><a href="#9745"> 9745: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="9746" class="l"><a href="#9746"> 9746: </a>                }
</span><span id="9747" class="l"><a href="#9747"> 9747: </a>            }
</span><span id="9748" class="l"><a href="#9748"> 9748: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$draw</span>) {
</span><span id="9749" class="l"><a href="#9749"> 9749: </a>                <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$p</span>[<span class="php-num">0</span>], <span class="php-var">$p</span>[<span class="php-num">1</span>]);
</span><span id="9750" class="l"><a href="#9750"> 9750: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">2</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$nc</span>; <span class="php-var">$i</span> = <span class="php-var">$i</span> + <span class="php-num">2</span>) {
</span><span id="9751" class="l"><a href="#9751"> 9751: </a>                    <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$p</span>[<span class="php-var">$i</span>], <span class="php-var">$p</span>[<span class="php-var">$i</span> + <span class="php-num">1</span>]);
</span><span id="9752" class="l"><a href="#9752"> 9752: </a>                }
</span><span id="9753" class="l"><a href="#9753"> 9753: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="9754" class="l"><a href="#9754"> 9754: </a>            }
</span><span id="9755" class="l"><a href="#9755"> 9755: </a>        }
</span><span id="9756" class="l"><a href="#9756"> 9756: </a>
</span><span id="9757" class="l"><a href="#9757"> 9757: </a>        <span class="php-comment">/**
</span></span><span id="9758" class="l"><a href="#9758"> 9758: </a><span class="php-comment">         * Draws a regular polygon.
</span></span><span id="9759" class="l"><a href="#9759"> 9759: </a><span class="php-comment">         * @param float $x0 Abscissa of center point.
</span></span><span id="9760" class="l"><a href="#9760"> 9760: </a><span class="php-comment">         * @param float $y0 Ordinate of center point.
</span></span><span id="9761" class="l"><a href="#9761"> 9761: </a><span class="php-comment">         * @param float $r: Radius of inscribed circle.
</span></span><span id="9762" class="l"><a href="#9762"> 9762: </a><span class="php-comment">         * @param integer $ns Number of sides.
</span></span><span id="9763" class="l"><a href="#9763"> 9763: </a><span class="php-comment">         * @param float $angle Angle oriented (anti-clockwise). Default value: 0.
</span></span><span id="9764" class="l"><a href="#9764"> 9764: </a><span class="php-comment">         * @param boolean $draw_circle Draw inscribed circle or not. Default value: false.
</span></span><span id="9765" class="l"><a href="#9765"> 9765: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9766" class="l"><a href="#9766"> 9766: </a><span class="php-comment">         * @param array $line_style Line style of polygon sides. Array with keys among the following:
</span></span><span id="9767" class="l"><a href="#9767"> 9767: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9768" class="l"><a href="#9768"> 9768: </a><span class="php-comment">         *   &lt;li&gt;all: Line style of all sides. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9769" class="l"><a href="#9769"> 9769: </a><span class="php-comment">         *   &lt;li&gt;0 to ($ns - 1): Line style of each side. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9770" class="l"><a href="#9770"> 9770: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9771" class="l"><a href="#9771"> 9771: </a><span class="php-comment">         * If a key is not present or is null, not draws the side. Default value is default line style (empty array).
</span></span><span id="9772" class="l"><a href="#9772"> 9772: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(red, green, blue). Default value: default color (empty array).
</span></span><span id="9773" class="l"><a href="#9773"> 9773: </a><span class="php-comment">         * @param string $circle_style Style of rendering of inscribed circle (if draws). Possible values are:
</span></span><span id="9774" class="l"><a href="#9774"> 9774: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9775" class="l"><a href="#9775"> 9775: </a><span class="php-comment">         *   &lt;li&gt;D or empty string: Draw (default).&lt;/li&gt;
</span></span><span id="9776" class="l"><a href="#9776"> 9776: </a><span class="php-comment">         *   &lt;li&gt;F: Fill.&lt;/li&gt;
</span></span><span id="9777" class="l"><a href="#9777"> 9777: </a><span class="php-comment">         *   &lt;li&gt;DF or FD: Draw and fill.&lt;/li&gt;
</span></span><span id="9778" class="l"><a href="#9778"> 9778: </a><span class="php-comment">         *   &lt;li&gt;CNZ: Clipping mode (using the even-odd rule to determine which regions lie inside the clipping path).&lt;/li&gt;
</span></span><span id="9779" class="l"><a href="#9779"> 9779: </a><span class="php-comment">         *   &lt;li&gt;CEO: Clipping mode (using the nonzero winding number rule to determine which regions lie inside the clipping path).&lt;/li&gt;
</span></span><span id="9780" class="l"><a href="#9780"> 9780: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9781" class="l"><a href="#9781"> 9781: </a><span class="php-comment">         * @param array $circle_outLine_style Line style of inscribed circle (if draws). Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9782" class="l"><a href="#9782"> 9782: </a><span class="php-comment">         * @param array $circle_fill_color Fill color of inscribed circle (if draws). Format: array(red, green, blue). Default value: default color (empty array).
</span></span><span id="9783" class="l"><a href="#9783"> 9783: </a><span class="php-comment">         * @access public
</span></span><span id="9784" class="l"><a href="#9784"> 9784: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9785" class="l"><a href="#9785"> 9785: </a><span class="php-comment">         */</span>
</span><span id="9786" class="l"><a href="#9786"> 9786: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> RegularPolygon(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$r</span>, <span class="php-var">$ns</span>, <span class="php-var">$angle</span>=<span class="php-num">0</span>, <span class="php-var">$draw_circle</span>=<span class="php-keyword1">false</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$circle_style</span>=<span class="php-quote">''</span>, <span class="php-var">$circle_outLine_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$circle_fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9787" class="l"><a href="#9787"> 9787: </a>            <span class="php-keyword1">if</span> (<span class="php-num">3</span> &gt; <span class="php-var">$ns</span>) {
</span><span id="9788" class="l"><a href="#9788"> 9788: </a>                <span class="php-var">$ns</span> = <span class="php-num">3</span>;
</span><span id="9789" class="l"><a href="#9789"> 9789: </a>            }
</span><span id="9790" class="l"><a href="#9790"> 9790: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$draw_circle</span>) {
</span><span id="9791" class="l"><a href="#9791"> 9791: </a>                <span class="php-var">$this</span>-&gt;Circle(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-var">$circle_style</span>, <span class="php-var">$circle_outLine_style</span>, <span class="php-var">$circle_fill_color</span>);
</span><span id="9792" class="l"><a href="#9792"> 9792: </a>            }
</span><span id="9793" class="l"><a href="#9793"> 9793: </a>            <span class="php-var">$p</span> = <span class="php-keyword1">array</span>();
</span><span id="9794" class="l"><a href="#9794"> 9794: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$ns</span>; ++<span class="php-var">$i</span>) {
</span><span id="9795" class="l"><a href="#9795"> 9795: </a>                <span class="php-var">$a</span> = <span class="php-var">$angle</span> + (<span class="php-var">$i</span> * <span class="php-num">360</span> / <span class="php-var">$ns</span>);
</span><span id="9796" class="l"><a href="#9796"> 9796: </a>                <span class="php-var">$a_rad</span> = <span class="php-keyword2">deg2rad</span>((float) <span class="php-var">$a</span>);
</span><span id="9797" class="l"><a href="#9797"> 9797: </a>                <span class="php-var">$p</span>[] = <span class="php-var">$x0</span> + (<span class="php-var">$r</span> * <span class="php-keyword2">sin</span>(<span class="php-var">$a_rad</span>));
</span><span id="9798" class="l"><a href="#9798"> 9798: </a>                <span class="php-var">$p</span>[] = <span class="php-var">$y0</span> + (<span class="php-var">$r</span> * <span class="php-keyword2">cos</span>(<span class="php-var">$a_rad</span>));
</span><span id="9799" class="l"><a href="#9799"> 9799: </a>            }
</span><span id="9800" class="l"><a href="#9800"> 9800: </a>            <span class="php-var">$this</span>-&gt;Polygon(<span class="php-var">$p</span>, <span class="php-var">$style</span>, <span class="php-var">$line_style</span>, <span class="php-var">$fill_color</span>);
</span><span id="9801" class="l"><a href="#9801"> 9801: </a>        }
</span><span id="9802" class="l"><a href="#9802"> 9802: </a>
</span><span id="9803" class="l"><a href="#9803"> 9803: </a>        <span class="php-comment">/**
</span></span><span id="9804" class="l"><a href="#9804"> 9804: </a><span class="php-comment">         * Draws a star polygon
</span></span><span id="9805" class="l"><a href="#9805"> 9805: </a><span class="php-comment">         * @param float $x0 Abscissa of center point.
</span></span><span id="9806" class="l"><a href="#9806"> 9806: </a><span class="php-comment">         * @param float $y0 Ordinate of center point.
</span></span><span id="9807" class="l"><a href="#9807"> 9807: </a><span class="php-comment">         * @param float $r Radius of inscribed circle.
</span></span><span id="9808" class="l"><a href="#9808"> 9808: </a><span class="php-comment">         * @param integer $nv Number of vertices.
</span></span><span id="9809" class="l"><a href="#9809"> 9809: </a><span class="php-comment">         * @param integer $ng Number of gap (if ($ng % $nv = 1) then is a regular polygon).
</span></span><span id="9810" class="l"><a href="#9810"> 9810: </a><span class="php-comment">         * @param float $angle: Angle oriented (anti-clockwise). Default value: 0.
</span></span><span id="9811" class="l"><a href="#9811"> 9811: </a><span class="php-comment">         * @param boolean $draw_circle: Draw inscribed circle or not. Default value is false.
</span></span><span id="9812" class="l"><a href="#9812"> 9812: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9813" class="l"><a href="#9813"> 9813: </a><span class="php-comment">         * @param array $line_style Line style of polygon sides. Array with keys among the following:
</span></span><span id="9814" class="l"><a href="#9814"> 9814: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9815" class="l"><a href="#9815"> 9815: </a><span class="php-comment">         *   &lt;li&gt;all: Line style of all sides. Array like for
</span></span><span id="9816" class="l"><a href="#9816"> 9816: </a><span class="php-comment">         * {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9817" class="l"><a href="#9817"> 9817: </a><span class="php-comment">         *   &lt;li&gt;0 to (n - 1): Line style of each side. Array like for {@link SetLineStyle SetLineStyle}.&lt;/li&gt;
</span></span><span id="9818" class="l"><a href="#9818"> 9818: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9819" class="l"><a href="#9819"> 9819: </a><span class="php-comment">         * If a key is not present or is null, not draws the side. Default value is default line style (empty array).
</span></span><span id="9820" class="l"><a href="#9820"> 9820: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(red, green, blue). Default value: default color (empty array).
</span></span><span id="9821" class="l"><a href="#9821"> 9821: </a><span class="php-comment">         * @param string $circle_style Style of rendering of inscribed circle (if draws). Possible values are:
</span></span><span id="9822" class="l"><a href="#9822"> 9822: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="9823" class="l"><a href="#9823"> 9823: </a><span class="php-comment">         *   &lt;li&gt;D or empty string: Draw (default).&lt;/li&gt;
</span></span><span id="9824" class="l"><a href="#9824"> 9824: </a><span class="php-comment">         *   &lt;li&gt;F: Fill.&lt;/li&gt;
</span></span><span id="9825" class="l"><a href="#9825"> 9825: </a><span class="php-comment">         *   &lt;li&gt;DF or FD: Draw and fill.&lt;/li&gt;
</span></span><span id="9826" class="l"><a href="#9826"> 9826: </a><span class="php-comment">         *   &lt;li&gt;CNZ: Clipping mode (using the even-odd rule to determine which regions lie inside the clipping path).&lt;/li&gt;
</span></span><span id="9827" class="l"><a href="#9827"> 9827: </a><span class="php-comment">         *   &lt;li&gt;CEO: Clipping mode (using the nonzero winding number rule to determine which regions lie inside the clipping path).&lt;/li&gt;
</span></span><span id="9828" class="l"><a href="#9828"> 9828: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="9829" class="l"><a href="#9829"> 9829: </a><span class="php-comment">         * @param array $circle_outLine_style Line style of inscribed circle (if draws). Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9830" class="l"><a href="#9830"> 9830: </a><span class="php-comment">         * @param array $circle_fill_color Fill color of inscribed circle (if draws). Format: array(red, green, blue). Default value: default color (empty array).
</span></span><span id="9831" class="l"><a href="#9831"> 9831: </a><span class="php-comment">         * @access public
</span></span><span id="9832" class="l"><a href="#9832"> 9832: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9833" class="l"><a href="#9833"> 9833: </a><span class="php-comment">         */</span>
</span><span id="9834" class="l"><a href="#9834"> 9834: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> StarPolygon(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$r</span>, <span class="php-var">$nv</span>, <span class="php-var">$ng</span>, <span class="php-var">$angle</span>=<span class="php-num">0</span>, <span class="php-var">$draw_circle</span>=<span class="php-keyword1">false</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$line_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$circle_style</span>=<span class="php-quote">''</span>, <span class="php-var">$circle_outLine_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$circle_fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9835" class="l"><a href="#9835"> 9835: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$nv</span> &lt; <span class="php-num">2</span>) {
</span><span id="9836" class="l"><a href="#9836"> 9836: </a>                <span class="php-var">$nv</span> = <span class="php-num">2</span>;
</span><span id="9837" class="l"><a href="#9837"> 9837: </a>            }
</span><span id="9838" class="l"><a href="#9838"> 9838: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$draw_circle</span>) {
</span><span id="9839" class="l"><a href="#9839"> 9839: </a>                <span class="php-var">$this</span>-&gt;Circle(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-var">$circle_style</span>, <span class="php-var">$circle_outLine_style</span>, <span class="php-var">$circle_fill_color</span>);
</span><span id="9840" class="l"><a href="#9840"> 9840: </a>            }
</span><span id="9841" class="l"><a href="#9841"> 9841: </a>            <span class="php-var">$p2</span> = <span class="php-keyword1">array</span>();
</span><span id="9842" class="l"><a href="#9842"> 9842: </a>            <span class="php-var">$visited</span> = <span class="php-keyword1">array</span>();
</span><span id="9843" class="l"><a href="#9843"> 9843: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$nv</span>; ++<span class="php-var">$i</span>) {
</span><span id="9844" class="l"><a href="#9844"> 9844: </a>                <span class="php-var">$a</span> = <span class="php-var">$angle</span> + (<span class="php-var">$i</span> * <span class="php-num">360</span> / <span class="php-var">$nv</span>);
</span><span id="9845" class="l"><a href="#9845"> 9845: </a>                <span class="php-var">$a_rad</span> = <span class="php-keyword2">deg2rad</span>((float) <span class="php-var">$a</span>);
</span><span id="9846" class="l"><a href="#9846"> 9846: </a>                <span class="php-var">$p2</span>[] = <span class="php-var">$x0</span> + (<span class="php-var">$r</span> * <span class="php-keyword2">sin</span>(<span class="php-var">$a_rad</span>));
</span><span id="9847" class="l"><a href="#9847"> 9847: </a>                <span class="php-var">$p2</span>[] = <span class="php-var">$y0</span> + (<span class="php-var">$r</span> * <span class="php-keyword2">cos</span>(<span class="php-var">$a_rad</span>));
</span><span id="9848" class="l"><a href="#9848"> 9848: </a>                <span class="php-var">$visited</span>[] = <span class="php-keyword1">false</span>;
</span><span id="9849" class="l"><a href="#9849"> 9849: </a>            }
</span><span id="9850" class="l"><a href="#9850"> 9850: </a>            <span class="php-var">$p</span> = <span class="php-keyword1">array</span>();
</span><span id="9851" class="l"><a href="#9851"> 9851: </a>            <span class="php-var">$i</span> = <span class="php-num">0</span>;
</span><span id="9852" class="l"><a href="#9852"> 9852: </a>            <span class="php-keyword1">do</span> {
</span><span id="9853" class="l"><a href="#9853"> 9853: </a>                <span class="php-var">$p</span>[] = <span class="php-var">$p2</span>[<span class="php-var">$i</span> * <span class="php-num">2</span>];
</span><span id="9854" class="l"><a href="#9854"> 9854: </a>                <span class="php-var">$p</span>[] = <span class="php-var">$p2</span>[(<span class="php-var">$i</span> * <span class="php-num">2</span>) + <span class="php-num">1</span>];
</span><span id="9855" class="l"><a href="#9855"> 9855: </a>                <span class="php-var">$visited</span>[<span class="php-var">$i</span>] = <span class="php-keyword1">true</span>;
</span><span id="9856" class="l"><a href="#9856"> 9856: </a>                <span class="php-var">$i</span> += <span class="php-var">$ng</span>;
</span><span id="9857" class="l"><a href="#9857"> 9857: </a>                <span class="php-var">$i</span> %= <span class="php-var">$nv</span>;
</span><span id="9858" class="l"><a href="#9858"> 9858: </a>            } <span class="php-keyword1">while</span> (!<span class="php-var">$visited</span>[<span class="php-var">$i</span>]);
</span><span id="9859" class="l"><a href="#9859"> 9859: </a>            <span class="php-var">$this</span>-&gt;Polygon(<span class="php-var">$p</span>, <span class="php-var">$style</span>, <span class="php-var">$line_style</span>, <span class="php-var">$fill_color</span>);
</span><span id="9860" class="l"><a href="#9860"> 9860: </a>        }
</span><span id="9861" class="l"><a href="#9861"> 9861: </a>
</span><span id="9862" class="l"><a href="#9862"> 9862: </a>        <span class="php-comment">/**
</span></span><span id="9863" class="l"><a href="#9863"> 9863: </a><span class="php-comment">         * Draws a rounded rectangle.
</span></span><span id="9864" class="l"><a href="#9864"> 9864: </a><span class="php-comment">         * @param float $x Abscissa of upper-left corner.
</span></span><span id="9865" class="l"><a href="#9865"> 9865: </a><span class="php-comment">         * @param float $y Ordinate of upper-left corner.
</span></span><span id="9866" class="l"><a href="#9866"> 9866: </a><span class="php-comment">         * @param float $w Width.
</span></span><span id="9867" class="l"><a href="#9867"> 9867: </a><span class="php-comment">         * @param float $h Height.
</span></span><span id="9868" class="l"><a href="#9868"> 9868: </a><span class="php-comment">         * @param float $r the radius of the circle used to round off the corners of the rectangle.
</span></span><span id="9869" class="l"><a href="#9869"> 9869: </a><span class="php-comment">         * @param string $round_corner Draws rounded corner or not. String with a 0 (not rounded i-corner) or 1 (rounded i-corner) in i-position. Positions are, in order and begin to 0: top left, top right, bottom right and bottom left. Default value: all rounded corner (&quot;1111&quot;).
</span></span><span id="9870" class="l"><a href="#9870"> 9870: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9871" class="l"><a href="#9871"> 9871: </a><span class="php-comment">         * @param array $border_style Border style of rectangle. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9872" class="l"><a href="#9872"> 9872: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9873" class="l"><a href="#9873"> 9873: </a><span class="php-comment">         * @access public
</span></span><span id="9874" class="l"><a href="#9874"> 9874: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="9875" class="l"><a href="#9875"> 9875: </a><span class="php-comment">         */</span>
</span><span id="9876" class="l"><a href="#9876"> 9876: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> RoundedRect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$r</span>, <span class="php-var">$round_corner</span>=<span class="php-quote">'1111'</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$border_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9877" class="l"><a href="#9877"> 9877: </a>            <span class="php-var">$this</span>-&gt;RoundedRectXY(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$r</span>, <span class="php-var">$r</span>, <span class="php-var">$round_corner</span>, <span class="php-var">$style</span>, <span class="php-var">$border_style</span>, <span class="php-var">$fill_color</span>);
</span><span id="9878" class="l"><a href="#9878"> 9878: </a>        }
</span><span id="9879" class="l"><a href="#9879"> 9879: </a>
</span><span id="9880" class="l"><a href="#9880"> 9880: </a>        <span class="php-comment">/**
</span></span><span id="9881" class="l"><a href="#9881"> 9881: </a><span class="php-comment">         * Draws a rounded rectangle.
</span></span><span id="9882" class="l"><a href="#9882"> 9882: </a><span class="php-comment">         * @param float $x Abscissa of upper-left corner.
</span></span><span id="9883" class="l"><a href="#9883"> 9883: </a><span class="php-comment">         * @param float $y Ordinate of upper-left corner.
</span></span><span id="9884" class="l"><a href="#9884"> 9884: </a><span class="php-comment">         * @param float $w Width.
</span></span><span id="9885" class="l"><a href="#9885"> 9885: </a><span class="php-comment">         * @param float $h Height.
</span></span><span id="9886" class="l"><a href="#9886"> 9886: </a><span class="php-comment">         * @param float $rx the x-axis radius of the ellipse used to round off the corners of the rectangle.
</span></span><span id="9887" class="l"><a href="#9887"> 9887: </a><span class="php-comment">         * @param float $ry the y-axis radius of the ellipse used to round off the corners of the rectangle.
</span></span><span id="9888" class="l"><a href="#9888"> 9888: </a><span class="php-comment">         * @param string $round_corner Draws rounded corner or not. String with a 0 (not rounded i-corner) or 1 (rounded i-corner) in i-position. Positions are, in order and begin to 0: top left, top right, bottom right and bottom left. Default value: all rounded corner (&quot;1111&quot;).
</span></span><span id="9889" class="l"><a href="#9889"> 9889: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="9890" class="l"><a href="#9890"> 9890: </a><span class="php-comment">         * @param array $border_style Border style of rectangle. Array like for {@link SetLineStyle SetLineStyle}. Default value: default line style (empty array).
</span></span><span id="9891" class="l"><a href="#9891"> 9891: </a><span class="php-comment">         * @param array $fill_color Fill color. Format: array(GREY) or array(R,G,B) or array(C,M,Y,K). Default value: default color (empty array).
</span></span><span id="9892" class="l"><a href="#9892"> 9892: </a><span class="php-comment">         * @access public
</span></span><span id="9893" class="l"><a href="#9893"> 9893: </a><span class="php-comment">         * @since 4.9.019 (2010-04-22)
</span></span><span id="9894" class="l"><a href="#9894"> 9894: </a><span class="php-comment">         */</span>
</span><span id="9895" class="l"><a href="#9895"> 9895: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> RoundedRectXY(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-var">$round_corner</span>=<span class="php-quote">'1111'</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$border_style</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$fill_color</span>=<span class="php-keyword1">array</span>()) {
</span><span id="9896" class="l"><a href="#9896"> 9896: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$round_corner</span> == <span class="php-quote">'0000'</span>) <span class="php-keyword1">OR</span> ((<span class="php-var">$rx</span> == <span class="php-var">$ry</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$rx</span> == <span class="php-num">0</span>))) {
</span><span id="9897" class="l"><a href="#9897"> 9897: </a>                <span class="php-comment">// Not rounded</span>
</span><span id="9898" class="l"><a href="#9898"> 9898: </a>                <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$style</span>, <span class="php-var">$border_style</span>, <span class="php-var">$fill_color</span>);
</span><span id="9899" class="l"><a href="#9899"> 9899: </a>                <span class="php-keyword1">return</span>;
</span><span id="9900" class="l"><a href="#9900"> 9900: </a>            }
</span><span id="9901" class="l"><a href="#9901"> 9901: </a>            <span class="php-comment">// Rounded</span>
</span><span id="9902" class="l"><a href="#9902"> 9902: </a>            <span class="php-keyword1">if</span> (!(<span class="php-keyword1">false</span> === <span class="php-keyword2">strpos</span>(<span class="php-var">$style</span>, <span class="php-quote">'F'</span>)) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$fill_color</span>)) {
</span><span id="9903" class="l"><a href="#9903"> 9903: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="9904" class="l"><a href="#9904"> 9904: </a>            }
</span><span id="9905" class="l"><a href="#9905"> 9905: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>);
</span><span id="9906" class="l"><a href="#9906"> 9906: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$op</span> == <span class="php-quote">'f'</span>) {
</span><span id="9907" class="l"><a href="#9907"> 9907: </a>                <span class="php-var">$border_style</span> = <span class="php-keyword1">array</span>();
</span><span id="9908" class="l"><a href="#9908"> 9908: </a>            }
</span><span id="9909" class="l"><a href="#9909"> 9909: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$border_style</span>) {
</span><span id="9910" class="l"><a href="#9910"> 9910: </a>                <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$border_style</span>);
</span><span id="9911" class="l"><a href="#9911"> 9911: </a>            }
</span><span id="9912" class="l"><a href="#9912"> 9912: </a>            <span class="php-var">$MyArc</span> = <span class="php-num">4</span> / <span class="php-num">3</span> * (<span class="php-keyword2">sqrt</span>(<span class="php-num">2</span>) - <span class="php-num">1</span>);
</span><span id="9913" class="l"><a href="#9913"> 9913: </a>            <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$x</span> + <span class="php-var">$rx</span>, <span class="php-var">$y</span>);
</span><span id="9914" class="l"><a href="#9914"> 9914: </a>            <span class="php-var">$xc</span> = <span class="php-var">$x</span> + <span class="php-var">$w</span> - <span class="php-var">$rx</span>;
</span><span id="9915" class="l"><a href="#9915"> 9915: </a>            <span class="php-var">$yc</span> = <span class="php-var">$y</span> + <span class="php-var">$ry</span>;
</span><span id="9916" class="l"><a href="#9916"> 9916: </a>            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$xc</span>, <span class="php-var">$y</span>);
</span><span id="9917" class="l"><a href="#9917"> 9917: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$round_corner</span>[<span class="php-num">0</span>]) {
</span><span id="9918" class="l"><a href="#9918"> 9918: </a>                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$xc</span> + (<span class="php-var">$rx</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$yc</span> - <span class="php-var">$ry</span>, <span class="php-var">$xc</span> + <span class="php-var">$rx</span>, <span class="php-var">$yc</span> - (<span class="php-var">$ry</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$xc</span> + <span class="php-var">$rx</span>, <span class="php-var">$yc</span>);
</span><span id="9919" class="l"><a href="#9919"> 9919: </a>            } <span class="php-keyword1">else</span> {
</span><span id="9920" class="l"><a href="#9920"> 9920: </a>                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span> + <span class="php-var">$w</span>, <span class="php-var">$y</span>);
</span><span id="9921" class="l"><a href="#9921"> 9921: </a>            }
</span><span id="9922" class="l"><a href="#9922"> 9922: </a>            <span class="php-var">$xc</span> = <span class="php-var">$x</span> + <span class="php-var">$w</span> - <span class="php-var">$rx</span>;
</span><span id="9923" class="l"><a href="#9923"> 9923: </a>            <span class="php-var">$yc</span> = <span class="php-var">$y</span> + <span class="php-var">$h</span> - <span class="php-var">$ry</span>;
</span><span id="9924" class="l"><a href="#9924"> 9924: </a>            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span> + <span class="php-var">$w</span>, <span class="php-var">$yc</span>);
</span><span id="9925" class="l"><a href="#9925"> 9925: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$round_corner</span>[<span class="php-num">1</span>]) {
</span><span id="9926" class="l"><a href="#9926"> 9926: </a>                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$xc</span> + <span class="php-var">$rx</span>, <span class="php-var">$yc</span> + (<span class="php-var">$ry</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$xc</span> + (<span class="php-var">$rx</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$yc</span> + <span class="php-var">$ry</span>, <span class="php-var">$xc</span>, <span class="php-var">$yc</span> + <span class="php-var">$ry</span>);
</span><span id="9927" class="l"><a href="#9927"> 9927: </a>            } <span class="php-keyword1">else</span> {
</span><span id="9928" class="l"><a href="#9928"> 9928: </a>                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span> + <span class="php-var">$w</span>, <span class="php-var">$y</span> + <span class="php-var">$h</span>);
</span><span id="9929" class="l"><a href="#9929"> 9929: </a>            }
</span><span id="9930" class="l"><a href="#9930"> 9930: </a>            <span class="php-var">$xc</span> = <span class="php-var">$x</span> + <span class="php-var">$rx</span>;
</span><span id="9931" class="l"><a href="#9931"> 9931: </a>            <span class="php-var">$yc</span> = <span class="php-var">$y</span> + <span class="php-var">$h</span> - <span class="php-var">$ry</span>;
</span><span id="9932" class="l"><a href="#9932"> 9932: </a>            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$xc</span>, <span class="php-var">$y</span> + <span class="php-var">$h</span>);
</span><span id="9933" class="l"><a href="#9933"> 9933: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$round_corner</span>[<span class="php-num">2</span>]) {
</span><span id="9934" class="l"><a href="#9934"> 9934: </a>                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$xc</span> - (<span class="php-var">$rx</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$yc</span> + <span class="php-var">$ry</span>, <span class="php-var">$xc</span> - <span class="php-var">$rx</span>, <span class="php-var">$yc</span> + (<span class="php-var">$ry</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$xc</span> - <span class="php-var">$rx</span>, <span class="php-var">$yc</span>);
</span><span id="9935" class="l"><a href="#9935"> 9935: </a>            } <span class="php-keyword1">else</span> {
</span><span id="9936" class="l"><a href="#9936"> 9936: </a>                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span>, <span class="php-var">$y</span> + <span class="php-var">$h</span>);
</span><span id="9937" class="l"><a href="#9937"> 9937: </a>            }
</span><span id="9938" class="l"><a href="#9938"> 9938: </a>            <span class="php-var">$xc</span> = <span class="php-var">$x</span> + <span class="php-var">$rx</span>;
</span><span id="9939" class="l"><a href="#9939"> 9939: </a>            <span class="php-var">$yc</span> = <span class="php-var">$y</span> + <span class="php-var">$ry</span>;
</span><span id="9940" class="l"><a href="#9940"> 9940: </a>            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span>, <span class="php-var">$yc</span>);
</span><span id="9941" class="l"><a href="#9941"> 9941: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$round_corner</span>[<span class="php-num">3</span>]) {
</span><span id="9942" class="l"><a href="#9942"> 9942: </a>                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$xc</span> - <span class="php-var">$rx</span>, <span class="php-var">$yc</span> - (<span class="php-var">$ry</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$xc</span> - (<span class="php-var">$rx</span> * <span class="php-var">$MyArc</span>), <span class="php-var">$yc</span> - <span class="php-var">$ry</span>, <span class="php-var">$xc</span>, <span class="php-var">$yc</span> - <span class="php-var">$ry</span>);
</span><span id="9943" class="l"><a href="#9943"> 9943: </a>            } <span class="php-keyword1">else</span> {
</span><span id="9944" class="l"><a href="#9944"> 9944: </a>                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="9945" class="l"><a href="#9945"> 9945: </a>                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span> + <span class="php-var">$rx</span>, <span class="php-var">$y</span>);
</span><span id="9946" class="l"><a href="#9946"> 9946: </a>            }
</span><span id="9947" class="l"><a href="#9947"> 9947: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="9948" class="l"><a href="#9948"> 9948: </a>        }
</span><span id="9949" class="l"><a href="#9949"> 9949: </a>
</span><span id="9950" class="l"><a href="#9950"> 9950: </a>        <span class="php-comment">/**
</span></span><span id="9951" class="l"><a href="#9951"> 9951: </a><span class="php-comment">         * Draws a grahic arrow.
</span></span><span id="9952" class="l"><a href="#9952"> 9952: </a><span class="php-comment">         * @parameter float $x0 Abscissa of first point.
</span></span><span id="9953" class="l"><a href="#9953"> 9953: </a><span class="php-comment">         * @parameter float $y0 Ordinate of first point.
</span></span><span id="9954" class="l"><a href="#9954"> 9954: </a><span class="php-comment">         * @parameter float $x0 Abscissa of second point.
</span></span><span id="9955" class="l"><a href="#9955"> 9955: </a><span class="php-comment">         * @parameter float $y1 Ordinate of second point.
</span></span><span id="9956" class="l"><a href="#9956"> 9956: </a><span class="php-comment">         * @parameter int $head_style (0 = draw only arrowhead arms, 1 = draw closed arrowhead, but no fill, 2 = closed and filled arrowhead, 3 = filled arrowhead)
</span></span><span id="9957" class="l"><a href="#9957"> 9957: </a><span class="php-comment">         * @parameter float $arm_size length of arrowhead arms
</span></span><span id="9958" class="l"><a href="#9958"> 9958: </a><span class="php-comment">         * @parameter int $arm_angle angle between an arm and the shaft
</span></span><span id="9959" class="l"><a href="#9959"> 9959: </a><span class="php-comment">         * @author Piotr Galecki, Nicola Asuni, Andy Meier
</span></span><span id="9960" class="l"><a href="#9960"> 9960: </a><span class="php-comment">         * @since 4.6.018 (2009-07-10)
</span></span><span id="9961" class="l"><a href="#9961"> 9961: </a><span class="php-comment">         */</span>
</span><span id="9962" class="l"><a href="#9962"> 9962: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Arrow(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$head_style</span>=<span class="php-num">0</span>, <span class="php-var">$arm_size</span>=<span class="php-num">5</span>, <span class="php-var">$arm_angle</span>=<span class="php-num">15</span>) {
</span><span id="9963" class="l"><a href="#9963"> 9963: </a>            <span class="php-comment">// getting arrow direction angle</span>
</span><span id="9964" class="l"><a href="#9964"> 9964: </a>            <span class="php-comment">// 0 deg angle is when both arms go along X axis. angle grows clockwise.</span>
</span><span id="9965" class="l"><a href="#9965"> 9965: </a>            <span class="php-var">$dir_angle</span> = <span class="php-keyword2">atan2</span>((<span class="php-var">$y0</span> - <span class="php-var">$y1</span>), (<span class="php-var">$x0</span> - <span class="php-var">$x1</span>));
</span><span id="9966" class="l"><a href="#9966"> 9966: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$dir_angle</span> &lt; <span class="php-num">0</span>) {
</span><span id="9967" class="l"><a href="#9967"> 9967: </a>                <span class="php-var">$dir_angle</span> += (<span class="php-num">2</span> * M_PI);
</span><span id="9968" class="l"><a href="#9968"> 9968: </a>            }
</span><span id="9969" class="l"><a href="#9969"> 9969: </a>            <span class="php-var">$arm_angle</span> = <span class="php-keyword2">deg2rad</span>(<span class="php-var">$arm_angle</span>);
</span><span id="9970" class="l"><a href="#9970"> 9970: </a>            <span class="php-var">$sx1</span> = <span class="php-var">$x1</span>;
</span><span id="9971" class="l"><a href="#9971"> 9971: </a>            <span class="php-var">$sy1</span> = <span class="php-var">$y1</span>;
</span><span id="9972" class="l"><a href="#9972"> 9972: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$head_style</span> &gt; <span class="php-num">0</span>) {
</span><span id="9973" class="l"><a href="#9973"> 9973: </a>                <span class="php-comment">// calculate the stopping point for the arrow shaft</span>
</span><span id="9974" class="l"><a href="#9974"> 9974: </a>                <span class="php-var">$sx1</span> = <span class="php-var">$x1</span> + ((<span class="php-var">$arm_size</span> - <span class="php-var">$this</span>-&gt;LineWidth) * <span class="php-keyword2">cos</span>(<span class="php-var">$dir_angle</span>));
</span><span id="9975" class="l"><a href="#9975"> 9975: </a>                <span class="php-var">$sy1</span> = <span class="php-var">$y1</span> + ((<span class="php-var">$arm_size</span> - <span class="php-var">$this</span>-&gt;LineWidth) * <span class="php-keyword2">sin</span>(<span class="php-var">$dir_angle</span>));
</span><span id="9976" class="l"><a href="#9976"> 9976: </a>            }
</span><span id="9977" class="l"><a href="#9977"> 9977: </a>            <span class="php-comment">// main arrow line / shaft</span>
</span><span id="9978" class="l"><a href="#9978"> 9978: </a>            <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x0</span>, <span class="php-var">$y0</span>, <span class="php-var">$sx1</span>, <span class="php-var">$sy1</span>);
</span><span id="9979" class="l"><a href="#9979"> 9979: </a>            <span class="php-comment">// left arrowhead arm tip</span>
</span><span id="9980" class="l"><a href="#9980"> 9980: </a>            <span class="php-var">$x2L</span> = <span class="php-var">$x1</span> + (<span class="php-var">$arm_size</span> * <span class="php-keyword2">cos</span>(<span class="php-var">$dir_angle</span> + <span class="php-var">$arm_angle</span>));
</span><span id="9981" class="l"><a href="#9981"> 9981: </a>            <span class="php-var">$y2L</span> = <span class="php-var">$y1</span> + (<span class="php-var">$arm_size</span> * <span class="php-keyword2">sin</span>(<span class="php-var">$dir_angle</span> + <span class="php-var">$arm_angle</span>));
</span><span id="9982" class="l"><a href="#9982"> 9982: </a>            <span class="php-comment">// right arrowhead arm tip</span>
</span><span id="9983" class="l"><a href="#9983"> 9983: </a>            <span class="php-var">$x2R</span> = <span class="php-var">$x1</span> + (<span class="php-var">$arm_size</span> * <span class="php-keyword2">cos</span>(<span class="php-var">$dir_angle</span> - <span class="php-var">$arm_angle</span>));
</span><span id="9984" class="l"><a href="#9984"> 9984: </a>            <span class="php-var">$y2R</span> = <span class="php-var">$y1</span> + (<span class="php-var">$arm_size</span> * <span class="php-keyword2">sin</span>(<span class="php-var">$dir_angle</span> - <span class="php-var">$arm_angle</span>));
</span><span id="9985" class="l"><a href="#9985"> 9985: </a>            <span class="php-var">$mode</span> = <span class="php-quote">'D'</span>;
</span><span id="9986" class="l"><a href="#9986"> 9986: </a>            <span class="php-var">$style</span> = <span class="php-keyword1">array</span>();
</span><span id="9987" class="l"><a href="#9987"> 9987: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$head_style</span>) {
</span><span id="9988" class="l"><a href="#9988"> 9988: </a>                <span class="php-keyword1">case</span> <span class="php-num">0</span>: {
</span><span id="9989" class="l"><a href="#9989"> 9989: </a>                    <span class="php-comment">// draw only arrowhead arms</span>
</span><span id="9990" class="l"><a href="#9990"> 9990: </a>                    <span class="php-var">$mode</span> = <span class="php-quote">'D'</span>;
</span><span id="9991" class="l"><a href="#9991"> 9991: </a>                    <span class="php-var">$style</span> = <span class="php-keyword1">array</span>(<span class="php-num">1</span>, <span class="php-num">1</span>, <span class="php-num">0</span>);
</span><span id="9992" class="l"><a href="#9992"> 9992: </a>                    <span class="php-keyword1">break</span>;
</span><span id="9993" class="l"><a href="#9993"> 9993: </a>                }
</span><span id="9994" class="l"><a href="#9994"> 9994: </a>                <span class="php-keyword1">case</span> <span class="php-num">1</span>: {
</span><span id="9995" class="l"><a href="#9995"> 9995: </a>                    <span class="php-comment">// draw closed arrowhead, but no fill</span>
</span><span id="9996" class="l"><a href="#9996"> 9996: </a>                    <span class="php-var">$mode</span> = <span class="php-quote">'D'</span>;
</span><span id="9997" class="l"><a href="#9997"> 9997: </a>                    <span class="php-keyword1">break</span>;
</span><span id="9998" class="l"><a href="#9998"> 9998: </a>                }
</span><span id="9999" class="l"><a href="#9999"> 9999: </a>                <span class="php-keyword1">case</span> <span class="php-num">2</span>: {
</span><span id="10000" class="l"><a href="#10000">10000: </a>                    <span class="php-comment">// closed and filled arrowhead</span>
</span><span id="10001" class="l"><a href="#10001">10001: </a>                    <span class="php-var">$mode</span> = <span class="php-quote">'DF'</span>;
</span><span id="10002" class="l"><a href="#10002">10002: </a>                    <span class="php-keyword1">break</span>;
</span><span id="10003" class="l"><a href="#10003">10003: </a>                }
</span><span id="10004" class="l"><a href="#10004">10004: </a>                <span class="php-keyword1">case</span> <span class="php-num">3</span>: {
</span><span id="10005" class="l"><a href="#10005">10005: </a>                    <span class="php-comment">// filled arrowhead</span>
</span><span id="10006" class="l"><a href="#10006">10006: </a>                    <span class="php-var">$mode</span> = <span class="php-quote">'F'</span>;
</span><span id="10007" class="l"><a href="#10007">10007: </a>                    <span class="php-keyword1">break</span>;
</span><span id="10008" class="l"><a href="#10008">10008: </a>                }
</span><span id="10009" class="l"><a href="#10009">10009: </a>            }
</span><span id="10010" class="l"><a href="#10010">10010: </a>            <span class="php-var">$this</span>-&gt;Polygon(<span class="php-keyword1">array</span>(<span class="php-var">$x2L</span>, <span class="php-var">$y2L</span>, <span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2R</span>, <span class="php-var">$y2R</span>), <span class="php-var">$mode</span>, <span class="php-var">$style</span>, <span class="php-keyword1">array</span>());
</span><span id="10011" class="l"><a href="#10011">10011: </a>        }
</span><span id="10012" class="l"><a href="#10012">10012: </a>
</span><span id="10013" class="l"><a href="#10013">10013: </a>        <span class="php-comment">// END GRAPHIC FUNCTIONS SECTION -----------------------</span>
</span><span id="10014" class="l"><a href="#10014">10014: </a>
</span><span id="10015" class="l"><a href="#10015">10015: </a>        <span class="php-comment">// BIDIRECTIONAL TEXT SECTION --------------------------</span>
</span><span id="10016" class="l"><a href="#10016">10016: </a>
</span><span id="10017" class="l"><a href="#10017">10017: </a>        <span class="php-comment">/**
</span></span><span id="10018" class="l"><a href="#10018">10018: </a><span class="php-comment">         * Reverse the RLT substrings using the Bidirectional Algorithm (http://unicode.org/reports/tr9/).
</span></span><span id="10019" class="l"><a href="#10019">10019: </a><span class="php-comment">         * @param string $str string to manipulate.
</span></span><span id="10020" class="l"><a href="#10020">10020: </a><span class="php-comment">         * @param bool $setbom  if true set the Byte Order Mark (BOM = 0xFEFF)
</span></span><span id="10021" class="l"><a href="#10021">10021: </a><span class="php-comment">         * @param bool $forcertl if true forces RTL text direction
</span></span><span id="10022" class="l"><a href="#10022">10022: </a><span class="php-comment">         * @return string
</span></span><span id="10023" class="l"><a href="#10023">10023: </a><span class="php-comment">         * @access protected
</span></span><span id="10024" class="l"><a href="#10024">10024: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="10025" class="l"><a href="#10025">10025: </a><span class="php-comment">         * @since 2.1.000 (2008-01-08)
</span></span><span id="10026" class="l"><a href="#10026">10026: </a><span class="php-comment">         */</span>
</span><span id="10027" class="l"><a href="#10027">10027: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> utf8StrRev(<span class="php-var">$str</span>, <span class="php-var">$setbom</span>=<span class="php-keyword1">false</span>, <span class="php-var">$forcertl</span>=<span class="php-keyword1">false</span>) {
</span><span id="10028" class="l"><a href="#10028">10028: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;utf8StrArrRev(<span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$str</span>), <span class="php-var">$str</span>, <span class="php-var">$setbom</span>, <span class="php-var">$forcertl</span>);
</span><span id="10029" class="l"><a href="#10029">10029: </a>        }
</span><span id="10030" class="l"><a href="#10030">10030: </a>
</span><span id="10031" class="l"><a href="#10031">10031: </a>        <span class="php-comment">/**
</span></span><span id="10032" class="l"><a href="#10032">10032: </a><span class="php-comment">         * Reverse the RLT substrings array using the Bidirectional Algorithm (http://unicode.org/reports/tr9/).
</span></span><span id="10033" class="l"><a href="#10033">10033: </a><span class="php-comment">         * @param array $arr array of unicode values.
</span></span><span id="10034" class="l"><a href="#10034">10034: </a><span class="php-comment">         * @param string $str string to manipulate (or empty value).
</span></span><span id="10035" class="l"><a href="#10035">10035: </a><span class="php-comment">         * @param bool $setbom  if true set the Byte Order Mark (BOM = 0xFEFF)
</span></span><span id="10036" class="l"><a href="#10036">10036: </a><span class="php-comment">         * @param bool $forcertl if true forces RTL text direction
</span></span><span id="10037" class="l"><a href="#10037">10037: </a><span class="php-comment">         * @return string
</span></span><span id="10038" class="l"><a href="#10038">10038: </a><span class="php-comment">         * @access protected
</span></span><span id="10039" class="l"><a href="#10039">10039: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="10040" class="l"><a href="#10040">10040: </a><span class="php-comment">         * @since 4.9.000 (2010-03-27)
</span></span><span id="10041" class="l"><a href="#10041">10041: </a><span class="php-comment">         */</span>
</span><span id="10042" class="l"><a href="#10042">10042: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> utf8StrArrRev(<span class="php-var">$arr</span>, <span class="php-var">$str</span>=<span class="php-quote">''</span>, <span class="php-var">$setbom</span>=<span class="php-keyword1">false</span>, <span class="php-var">$forcertl</span>=<span class="php-keyword1">false</span>) {
</span><span id="10043" class="l"><a href="#10043">10043: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;arrUTF8ToUTF16BE(<span class="php-var">$this</span>-&gt;utf8Bidi(<span class="php-var">$arr</span>, <span class="php-var">$str</span>, <span class="php-var">$forcertl</span>), <span class="php-var">$setbom</span>);
</span><span id="10044" class="l"><a href="#10044">10044: </a>        }
</span><span id="10045" class="l"><a href="#10045">10045: </a>
</span><span id="10046" class="l"><a href="#10046">10046: </a>        <span class="php-comment">/**
</span></span><span id="10047" class="l"><a href="#10047">10047: </a><span class="php-comment">         * Reverse the RLT substrings using the Bidirectional Algorithm (http://unicode.org/reports/tr9/).
</span></span><span id="10048" class="l"><a href="#10048">10048: </a><span class="php-comment">         * @param array $ta array of characters composing the string.
</span></span><span id="10049" class="l"><a href="#10049">10049: </a><span class="php-comment">         * @param string $str string to process
</span></span><span id="10050" class="l"><a href="#10050">10050: </a><span class="php-comment">         * @param bool $forcertl if 'R' forces RTL, if 'L' forces LTR
</span></span><span id="10051" class="l"><a href="#10051">10051: </a><span class="php-comment">         * @return array of unicode chars
</span></span><span id="10052" class="l"><a href="#10052">10052: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="10053" class="l"><a href="#10053">10053: </a><span class="php-comment">         * @access protected
</span></span><span id="10054" class="l"><a href="#10054">10054: </a><span class="php-comment">         * @since 2.4.000 (2008-03-06)
</span></span><span id="10055" class="l"><a href="#10055">10055: </a><span class="php-comment">         */</span>
</span><span id="10056" class="l"><a href="#10056">10056: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> utf8Bidi(<span class="php-var">$ta</span>, <span class="php-var">$str</span>=<span class="php-quote">''</span>, <span class="php-var">$forcertl</span>=<span class="php-keyword1">false</span>) {
</span><span id="10057" class="l"><a href="#10057">10057: </a>            <span class="php-keyword1">global</span> <span class="php-var">$unicode</span>, <span class="php-var">$unicode_mirror</span>, <span class="php-var">$unicode_arlet</span>, <span class="php-var">$laa_array</span>, <span class="php-var">$diacritics</span>;
</span><span id="10058" class="l"><a href="#10058">10058: </a>            <span class="php-comment">// paragraph embedding level</span>
</span><span id="10059" class="l"><a href="#10059">10059: </a>            <span class="php-var">$pel</span> = <span class="php-num">0</span>;
</span><span id="10060" class="l"><a href="#10060">10060: </a>            <span class="php-comment">// max level</span>
</span><span id="10061" class="l"><a href="#10061">10061: </a>            <span class="php-var">$maxlevel</span> = <span class="php-num">0</span>;
</span><span id="10062" class="l"><a href="#10062">10062: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$str</span>)) {
</span><span id="10063" class="l"><a href="#10063">10063: </a>                <span class="php-comment">// create string from array</span>
</span><span id="10064" class="l"><a href="#10064">10064: </a>                <span class="php-var">$str</span> = <span class="php-var">$this</span>-&gt;UTF8ArrSubString(<span class="php-var">$ta</span>);
</span><span id="10065" class="l"><a href="#10065">10065: </a>            }
</span><span id="10066" class="l"><a href="#10066">10066: </a>            <span class="php-comment">// check if string contains arabic text</span>
</span><span id="10067" class="l"><a href="#10067">10067: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(K_RE_PATTERN_ARABIC, <span class="php-var">$str</span>)) {
</span><span id="10068" class="l"><a href="#10068">10068: </a>                <span class="php-var">$arabic</span> = <span class="php-keyword1">true</span>;
</span><span id="10069" class="l"><a href="#10069">10069: </a>            } <span class="php-keyword1">else</span> {
</span><span id="10070" class="l"><a href="#10070">10070: </a>                <span class="php-var">$arabic</span> = <span class="php-keyword1">false</span>;
</span><span id="10071" class="l"><a href="#10071">10071: </a>            }
</span><span id="10072" class="l"><a href="#10072">10072: </a>            <span class="php-comment">// check if string contains RTL text</span>
</span><span id="10073" class="l"><a href="#10073">10073: </a>            <span class="php-keyword1">if</span> (!(<span class="php-var">$forcertl</span> <span class="php-keyword1">OR</span> <span class="php-var">$arabic</span> <span class="php-keyword1">OR</span> <span class="php-keyword2">preg_match</span>(K_RE_PATTERN_RTL, <span class="php-var">$str</span>))) {
</span><span id="10074" class="l"><a href="#10074">10074: </a>                <span class="php-keyword1">return</span> <span class="php-var">$ta</span>;
</span><span id="10075" class="l"><a href="#10075">10075: </a>            }
</span><span id="10076" class="l"><a href="#10076">10076: </a>
</span><span id="10077" class="l"><a href="#10077">10077: </a>            <span class="php-comment">// get number of chars</span>
</span><span id="10078" class="l"><a href="#10078">10078: </a>            <span class="php-var">$numchars</span> = <span class="php-keyword2">count</span>(<span class="php-var">$ta</span>);
</span><span id="10079" class="l"><a href="#10079">10079: </a>
</span><span id="10080" class="l"><a href="#10080">10080: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$forcertl</span> == <span class="php-quote">'R'</span>) {
</span><span id="10081" class="l"><a href="#10081">10081: </a>                <span class="php-var">$pel</span> = <span class="php-num">1</span>;
</span><span id="10082" class="l"><a href="#10082">10082: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$forcertl</span> == <span class="php-quote">'L'</span>) {
</span><span id="10083" class="l"><a href="#10083">10083: </a>                <span class="php-var">$pel</span> = <span class="php-num">0</span>;
</span><span id="10084" class="l"><a href="#10084">10084: </a>            } <span class="php-keyword1">else</span> {
</span><span id="10085" class="l"><a href="#10085">10085: </a>                <span class="php-comment">// P2. In each paragraph, find the first character of type L, AL, or R.</span>
</span><span id="10086" class="l"><a href="#10086">10086: </a>                <span class="php-comment">// P3. If a character is found in P2 and it is of type AL or R, then set the paragraph embedding level to one; otherwise, set it to zero.</span>
</span><span id="10087" class="l"><a href="#10087">10087: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10088" class="l"><a href="#10088">10088: </a>                    <span class="php-var">$type</span> = <span class="php-var">$unicode</span>[<span class="php-var">$ta</span>[<span class="php-var">$i</span>]];
</span><span id="10089" class="l"><a href="#10089">10089: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$type</span> == <span class="php-quote">'L'</span>) {
</span><span id="10090" class="l"><a href="#10090">10090: </a>                        <span class="php-var">$pel</span> = <span class="php-num">0</span>;
</span><span id="10091" class="l"><a href="#10091">10091: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10092" class="l"><a href="#10092">10092: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$type</span> == <span class="php-quote">'AL'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$type</span> == <span class="php-quote">'R'</span>)) {
</span><span id="10093" class="l"><a href="#10093">10093: </a>                        <span class="php-var">$pel</span> = <span class="php-num">1</span>;
</span><span id="10094" class="l"><a href="#10094">10094: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10095" class="l"><a href="#10095">10095: </a>                    }
</span><span id="10096" class="l"><a href="#10096">10096: </a>                }
</span><span id="10097" class="l"><a href="#10097">10097: </a>            }
</span><span id="10098" class="l"><a href="#10098">10098: </a>
</span><span id="10099" class="l"><a href="#10099">10099: </a>            <span class="php-comment">// Current Embedding Level</span>
</span><span id="10100" class="l"><a href="#10100">10100: </a>            <span class="php-var">$cel</span> = <span class="php-var">$pel</span>;
</span><span id="10101" class="l"><a href="#10101">10101: </a>            <span class="php-comment">// directional override status</span>
</span><span id="10102" class="l"><a href="#10102">10102: </a>            <span class="php-var">$dos</span> = <span class="php-quote">'N'</span>;
</span><span id="10103" class="l"><a href="#10103">10103: </a>            <span class="php-var">$remember</span> = <span class="php-keyword1">array</span>();
</span><span id="10104" class="l"><a href="#10104">10104: </a>            <span class="php-comment">// start-of-level-run</span>
</span><span id="10105" class="l"><a href="#10105">10105: </a>            <span class="php-var">$sor</span> = <span class="php-var">$pel</span> % <span class="php-num">2</span> ? <span class="php-quote">'R'</span> : <span class="php-quote">'L'</span>;
</span><span id="10106" class="l"><a href="#10106">10106: </a>            <span class="php-var">$eor</span> = <span class="php-var">$sor</span>;
</span><span id="10107" class="l"><a href="#10107">10107: </a>
</span><span id="10108" class="l"><a href="#10108">10108: </a>            <span class="php-comment">// Array of characters data</span>
</span><span id="10109" class="l"><a href="#10109">10109: </a>            <span class="php-var">$chardata</span> = <span class="php-keyword1">Array</span>();
</span><span id="10110" class="l"><a href="#10110">10110: </a>
</span><span id="10111" class="l"><a href="#10111">10111: </a>            <span class="php-comment">// X1. Begin by setting the current embedding level to the paragraph embedding level. Set the directional override status to neutral. Process each character iteratively, applying rules X2 through X9. Only embedding levels from 0 to 61 are valid in this phase.</span>
</span><span id="10112" class="l"><a href="#10112">10112: </a>            <span class="php-comment">//  In the resolution of levels in rules I1 and I2, the maximum embedding level of 62 can be reached.</span>
</span><span id="10113" class="l"><a href="#10113">10113: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10114" class="l"><a href="#10114">10114: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] == K_RLE) {
</span><span id="10115" class="l"><a href="#10115">10115: </a>                    <span class="php-comment">// X2. With each RLE, compute the least greater odd embedding level.</span>
</span><span id="10116" class="l"><a href="#10116">10116: </a>                    <span class="php-comment">//  a. If this new level would be valid, then this embedding code is valid. Remember (push) the current embedding level and override status. Reset the current level to this new level, and reset the override status to neutral.</span>
</span><span id="10117" class="l"><a href="#10117">10117: </a>                    <span class="php-comment">//  b. If the new level would not be valid, then this code is invalid. Do not change the current level or override status.</span>
</span><span id="10118" class="l"><a href="#10118">10118: </a>                    <span class="php-var">$next_level</span> = <span class="php-var">$cel</span> + (<span class="php-var">$cel</span> % <span class="php-num">2</span>) + <span class="php-num">1</span>;
</span><span id="10119" class="l"><a href="#10119">10119: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$next_level</span> &lt; <span class="php-num">62</span>) {
</span><span id="10120" class="l"><a href="#10120">10120: </a>                        <span class="php-var">$remember</span>[] = <span class="php-keyword1">array</span>(<span class="php-quote">'num'</span> =&gt; K_RLE, <span class="php-quote">'cel'</span> =&gt; <span class="php-var">$cel</span>, <span class="php-quote">'dos'</span> =&gt; <span class="php-var">$dos</span>);
</span><span id="10121" class="l"><a href="#10121">10121: </a>                        <span class="php-var">$cel</span> = <span class="php-var">$next_level</span>;
</span><span id="10122" class="l"><a href="#10122">10122: </a>                        <span class="php-var">$dos</span> = <span class="php-quote">'N'</span>;
</span><span id="10123" class="l"><a href="#10123">10123: </a>                        <span class="php-var">$sor</span> = <span class="php-var">$eor</span>;
</span><span id="10124" class="l"><a href="#10124">10124: </a>                        <span class="php-var">$eor</span> = <span class="php-var">$cel</span> % <span class="php-num">2</span> ? <span class="php-quote">'R'</span> : <span class="php-quote">'L'</span>;
</span><span id="10125" class="l"><a href="#10125">10125: </a>                    }
</span><span id="10126" class="l"><a href="#10126">10126: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] == K_LRE) {
</span><span id="10127" class="l"><a href="#10127">10127: </a>                    <span class="php-comment">// X3. With each LRE, compute the least greater even embedding level.</span>
</span><span id="10128" class="l"><a href="#10128">10128: </a>                    <span class="php-comment">//  a. If this new level would be valid, then this embedding code is valid. Remember (push) the current embedding level and override status. Reset the current level to this new level, and reset the override status to neutral.</span>
</span><span id="10129" class="l"><a href="#10129">10129: </a>                    <span class="php-comment">//  b. If the new level would not be valid, then this code is invalid. Do not change the current level or override status.</span>
</span><span id="10130" class="l"><a href="#10130">10130: </a>                    <span class="php-var">$next_level</span> = <span class="php-var">$cel</span> + <span class="php-num">2</span> - (<span class="php-var">$cel</span> % <span class="php-num">2</span>);
</span><span id="10131" class="l"><a href="#10131">10131: </a>                    <span class="php-keyword1">if</span> ( <span class="php-var">$next_level</span> &lt; <span class="php-num">62</span> ) {
</span><span id="10132" class="l"><a href="#10132">10132: </a>                        <span class="php-var">$remember</span>[] = <span class="php-keyword1">array</span>(<span class="php-quote">'num'</span> =&gt; K_LRE, <span class="php-quote">'cel'</span> =&gt; <span class="php-var">$cel</span>, <span class="php-quote">'dos'</span> =&gt; <span class="php-var">$dos</span>);
</span><span id="10133" class="l"><a href="#10133">10133: </a>                        <span class="php-var">$cel</span> = <span class="php-var">$next_level</span>;
</span><span id="10134" class="l"><a href="#10134">10134: </a>                        <span class="php-var">$dos</span> = <span class="php-quote">'N'</span>;
</span><span id="10135" class="l"><a href="#10135">10135: </a>                        <span class="php-var">$sor</span> = <span class="php-var">$eor</span>;
</span><span id="10136" class="l"><a href="#10136">10136: </a>                        <span class="php-var">$eor</span> = <span class="php-var">$cel</span> % <span class="php-num">2</span> ? <span class="php-quote">'R'</span> : <span class="php-quote">'L'</span>;
</span><span id="10137" class="l"><a href="#10137">10137: </a>                    }
</span><span id="10138" class="l"><a href="#10138">10138: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] == K_RLO) {
</span><span id="10139" class="l"><a href="#10139">10139: </a>                    <span class="php-comment">// X4. With each RLO, compute the least greater odd embedding level.</span>
</span><span id="10140" class="l"><a href="#10140">10140: </a>                    <span class="php-comment">//  a. If this new level would be valid, then this embedding code is valid. Remember (push) the current embedding level and override status. Reset the current level to this new level, and reset the override status to right-to-left.</span>
</span><span id="10141" class="l"><a href="#10141">10141: </a>                    <span class="php-comment">//  b. If the new level would not be valid, then this code is invalid. Do not change the current level or override status.</span>
</span><span id="10142" class="l"><a href="#10142">10142: </a>                    <span class="php-var">$next_level</span> = <span class="php-var">$cel</span> + (<span class="php-var">$cel</span> % <span class="php-num">2</span>) + <span class="php-num">1</span>;
</span><span id="10143" class="l"><a href="#10143">10143: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$next_level</span> &lt; <span class="php-num">62</span>) {
</span><span id="10144" class="l"><a href="#10144">10144: </a>                        <span class="php-var">$remember</span>[] = <span class="php-keyword1">array</span>(<span class="php-quote">'num'</span> =&gt; K_RLO, <span class="php-quote">'cel'</span> =&gt; <span class="php-var">$cel</span>, <span class="php-quote">'dos'</span> =&gt; <span class="php-var">$dos</span>);
</span><span id="10145" class="l"><a href="#10145">10145: </a>                        <span class="php-var">$cel</span> = <span class="php-var">$next_level</span>;
</span><span id="10146" class="l"><a href="#10146">10146: </a>                        <span class="php-var">$dos</span> = <span class="php-quote">'R'</span>;
</span><span id="10147" class="l"><a href="#10147">10147: </a>                        <span class="php-var">$sor</span> = <span class="php-var">$eor</span>;
</span><span id="10148" class="l"><a href="#10148">10148: </a>                        <span class="php-var">$eor</span> = <span class="php-var">$cel</span> % <span class="php-num">2</span> ? <span class="php-quote">'R'</span> : <span class="php-quote">'L'</span>;
</span><span id="10149" class="l"><a href="#10149">10149: </a>                    }
</span><span id="10150" class="l"><a href="#10150">10150: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] == K_LRO) {
</span><span id="10151" class="l"><a href="#10151">10151: </a>                    <span class="php-comment">// X5. With each LRO, compute the least greater even embedding level.</span>
</span><span id="10152" class="l"><a href="#10152">10152: </a>                    <span class="php-comment">//  a. If this new level would be valid, then this embedding code is valid. Remember (push) the current embedding level and override status. Reset the current level to this new level, and reset the override status to left-to-right.</span>
</span><span id="10153" class="l"><a href="#10153">10153: </a>                    <span class="php-comment">//  b. If the new level would not be valid, then this code is invalid. Do not change the current level or override status.</span>
</span><span id="10154" class="l"><a href="#10154">10154: </a>                    <span class="php-var">$next_level</span> = <span class="php-var">$cel</span> + <span class="php-num">2</span> - (<span class="php-var">$cel</span> % <span class="php-num">2</span>);
</span><span id="10155" class="l"><a href="#10155">10155: </a>                    <span class="php-keyword1">if</span> ( <span class="php-var">$next_level</span> &lt; <span class="php-num">62</span> ) {
</span><span id="10156" class="l"><a href="#10156">10156: </a>                        <span class="php-var">$remember</span>[] = <span class="php-keyword1">array</span>(<span class="php-quote">'num'</span> =&gt; K_LRO, <span class="php-quote">'cel'</span> =&gt; <span class="php-var">$cel</span>, <span class="php-quote">'dos'</span> =&gt; <span class="php-var">$dos</span>);
</span><span id="10157" class="l"><a href="#10157">10157: </a>                        <span class="php-var">$cel</span> = <span class="php-var">$next_level</span>;
</span><span id="10158" class="l"><a href="#10158">10158: </a>                        <span class="php-var">$dos</span> = <span class="php-quote">'L'</span>;
</span><span id="10159" class="l"><a href="#10159">10159: </a>                        <span class="php-var">$sor</span> = <span class="php-var">$eor</span>;
</span><span id="10160" class="l"><a href="#10160">10160: </a>                        <span class="php-var">$eor</span> = <span class="php-var">$cel</span> % <span class="php-num">2</span> ? <span class="php-quote">'R'</span> : <span class="php-quote">'L'</span>;
</span><span id="10161" class="l"><a href="#10161">10161: </a>                    }
</span><span id="10162" class="l"><a href="#10162">10162: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] == K_PDF) {
</span><span id="10163" class="l"><a href="#10163">10163: </a>                    <span class="php-comment">// X7. With each PDF, determine the matching embedding or override code. If there was a valid matching code, restore (pop) the last remembered (pushed) embedding level and directional override.</span>
</span><span id="10164" class="l"><a href="#10164">10164: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$remember</span>)) {
</span><span id="10165" class="l"><a href="#10165">10165: </a>                        <span class="php-var">$last</span> = <span class="php-keyword2">count</span>(<span class="php-var">$remember</span> ) - <span class="php-num">1</span>;
</span><span id="10166" class="l"><a href="#10166">10166: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$remember</span>[<span class="php-var">$last</span>][<span class="php-quote">'num'</span>] == K_RLE) <span class="php-keyword1">OR</span>
</span><span id="10167" class="l"><a href="#10167">10167: </a>                            (<span class="php-var">$remember</span>[<span class="php-var">$last</span>][<span class="php-quote">'num'</span>] == K_LRE) <span class="php-keyword1">OR</span>
</span><span id="10168" class="l"><a href="#10168">10168: </a>                            (<span class="php-var">$remember</span>[<span class="php-var">$last</span>][<span class="php-quote">'num'</span>] == K_RLO) <span class="php-keyword1">OR</span>
</span><span id="10169" class="l"><a href="#10169">10169: </a>                            (<span class="php-var">$remember</span>[<span class="php-var">$last</span>][<span class="php-quote">'num'</span>] == K_LRO)) {
</span><span id="10170" class="l"><a href="#10170">10170: </a>                            <span class="php-var">$match</span> = <span class="php-keyword2">array_pop</span>(<span class="php-var">$remember</span>);
</span><span id="10171" class="l"><a href="#10171">10171: </a>                            <span class="php-var">$cel</span> = <span class="php-var">$match</span>[<span class="php-quote">'cel'</span>];
</span><span id="10172" class="l"><a href="#10172">10172: </a>                            <span class="php-var">$dos</span> = <span class="php-var">$match</span>[<span class="php-quote">'dos'</span>];
</span><span id="10173" class="l"><a href="#10173">10173: </a>                            <span class="php-var">$sor</span> = <span class="php-var">$eor</span>;
</span><span id="10174" class="l"><a href="#10174">10174: </a>                            <span class="php-var">$eor</span> = (<span class="php-var">$cel</span> &gt; <span class="php-var">$match</span>[<span class="php-quote">'cel'</span>] ? <span class="php-var">$cel</span> : <span class="php-var">$match</span>[<span class="php-quote">'cel'</span>]) % <span class="php-num">2</span> ? <span class="php-quote">'R'</span> : <span class="php-quote">'L'</span>;
</span><span id="10175" class="l"><a href="#10175">10175: </a>                        }
</span><span id="10176" class="l"><a href="#10176">10176: </a>                    }
</span><span id="10177" class="l"><a href="#10177">10177: </a>                } <span class="php-keyword1">elseif</span> ((<span class="php-var">$ta</span>[<span class="php-var">$i</span>] != K_RLE) <span class="php-keyword1">AND</span>
</span><span id="10178" class="l"><a href="#10178">10178: </a>                                 (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] != K_LRE) <span class="php-keyword1">AND</span>
</span><span id="10179" class="l"><a href="#10179">10179: </a>                                 (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] != K_RLO) <span class="php-keyword1">AND</span>
</span><span id="10180" class="l"><a href="#10180">10180: </a>                                 (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] != K_LRO) <span class="php-keyword1">AND</span>
</span><span id="10181" class="l"><a href="#10181">10181: </a>                                 (<span class="php-var">$ta</span>[<span class="php-var">$i</span>] != K_PDF)) {
</span><span id="10182" class="l"><a href="#10182">10182: </a>                    <span class="php-comment">// X6. For all types besides RLE, LRE, RLO, LRO, and PDF:</span>
</span><span id="10183" class="l"><a href="#10183">10183: </a>                    <span class="php-comment">//  a. Set the level of the current character to the current embedding level.</span>
</span><span id="10184" class="l"><a href="#10184">10184: </a>                    <span class="php-comment">//  b. Whenever the directional override status is not neutral, reset the current character type to the directional override status.</span>
</span><span id="10185" class="l"><a href="#10185">10185: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$dos</span> != <span class="php-quote">'N'</span>) {
</span><span id="10186" class="l"><a href="#10186">10186: </a>                        <span class="php-var">$chardir</span> = <span class="php-var">$dos</span>;
</span><span id="10187" class="l"><a href="#10187">10187: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="10188" class="l"><a href="#10188">10188: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$unicode</span>[<span class="php-var">$ta</span>[<span class="php-var">$i</span>]])) {
</span><span id="10189" class="l"><a href="#10189">10189: </a>                            <span class="php-var">$chardir</span> = <span class="php-var">$unicode</span>[<span class="php-var">$ta</span>[<span class="php-var">$i</span>]];
</span><span id="10190" class="l"><a href="#10190">10190: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="10191" class="l"><a href="#10191">10191: </a>                            <span class="php-var">$chardir</span> = <span class="php-quote">'L'</span>;
</span><span id="10192" class="l"><a href="#10192">10192: </a>                        }
</span><span id="10193" class="l"><a href="#10193">10193: </a>                    }
</span><span id="10194" class="l"><a href="#10194">10194: </a>                    <span class="php-comment">// stores string characters and other information</span>
</span><span id="10195" class="l"><a href="#10195">10195: </a>                    <span class="php-var">$chardata</span>[] = <span class="php-keyword1">array</span>(<span class="php-quote">'char'</span> =&gt; <span class="php-var">$ta</span>[<span class="php-var">$i</span>], <span class="php-quote">'level'</span> =&gt; <span class="php-var">$cel</span>, <span class="php-quote">'type'</span> =&gt; <span class="php-var">$chardir</span>, <span class="php-quote">'sor'</span> =&gt; <span class="php-var">$sor</span>, <span class="php-quote">'eor'</span> =&gt; <span class="php-var">$eor</span>);
</span><span id="10196" class="l"><a href="#10196">10196: </a>                }
</span><span id="10197" class="l"><a href="#10197">10197: </a>            } <span class="php-comment">// end for each char</span>
</span><span id="10198" class="l"><a href="#10198">10198: </a>
</span><span id="10199" class="l"><a href="#10199">10199: </a>            <span class="php-comment">// X8. All explicit directional embeddings and overrides are completely terminated at the end of each paragraph. Paragraph separators are not included in the embedding.</span>
</span><span id="10200" class="l"><a href="#10200">10200: </a>            <span class="php-comment">// X9. Remove all RLE, LRE, RLO, LRO, PDF, and BN codes.</span>
</span><span id="10201" class="l"><a href="#10201">10201: </a>            <span class="php-comment">// X10. The remaining rules are applied to each run of characters at the same level. For each run, determine the start-of-level-run (sor) and end-of-level-run (eor) type, either L or R. This depends on the higher of the two levels on either side of the boundary (at the start or end of the paragraph, the level of the 'other' run is the base embedding level). If the higher level is odd, the type is R; otherwise, it is L.</span>
</span><span id="10202" class="l"><a href="#10202">10202: </a>
</span><span id="10203" class="l"><a href="#10203">10203: </a>            <span class="php-comment">// 3.3.3 Resolving Weak Types</span>
</span><span id="10204" class="l"><a href="#10204">10204: </a>            <span class="php-comment">// Weak types are now resolved one level run at a time. At level run boundaries where the type of the character on the other side of the boundary is required, the type assigned to sor or eor is used.</span>
</span><span id="10205" class="l"><a href="#10205">10205: </a>            <span class="php-comment">// Nonspacing marks are now resolved based on the previous characters.</span>
</span><span id="10206" class="l"><a href="#10206">10206: </a>            <span class="php-var">$numchars</span> = <span class="php-keyword2">count</span>(<span class="php-var">$chardata</span>);
</span><span id="10207" class="l"><a href="#10207">10207: </a>
</span><span id="10208" class="l"><a href="#10208">10208: </a>            <span class="php-comment">// W1. Examine each nonspacing mark (NSM) in the level run, and change the type of the NSM to the type of the previous character. If the NSM is at the start of the level run, it will get the type of sor.</span>
</span><span id="10209" class="l"><a href="#10209">10209: </a>            <span class="php-var">$prevlevel</span> = -<span class="php-num">1</span>; <span class="php-comment">// track level changes</span>
</span><span id="10210" class="l"><a href="#10210">10210: </a>            <span class="php-var">$levcount</span> = <span class="php-num">0</span>; <span class="php-comment">// counts consecutive chars at the same level</span>
</span><span id="10211" class="l"><a href="#10211">10211: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10212" class="l"><a href="#10212">10212: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'NSM'</span>) {
</span><span id="10213" class="l"><a href="#10213">10213: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$levcount</span>) {
</span><span id="10214" class="l"><a href="#10214">10214: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>];
</span><span id="10215" class="l"><a href="#10215">10215: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$i</span> &gt; <span class="php-num">0</span>) {
</span><span id="10216" class="l"><a href="#10216">10216: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>];
</span><span id="10217" class="l"><a href="#10217">10217: </a>                    }
</span><span id="10218" class="l"><a href="#10218">10218: </a>                }
</span><span id="10219" class="l"><a href="#10219">10219: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>) {
</span><span id="10220" class="l"><a href="#10220">10220: </a>                    <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10221" class="l"><a href="#10221">10221: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10222" class="l"><a href="#10222">10222: </a>                    ++<span class="php-var">$levcount</span>;
</span><span id="10223" class="l"><a href="#10223">10223: </a>                }
</span><span id="10224" class="l"><a href="#10224">10224: </a>                <span class="php-var">$prevlevel</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>];
</span><span id="10225" class="l"><a href="#10225">10225: </a>            }
</span><span id="10226" class="l"><a href="#10226">10226: </a>
</span><span id="10227" class="l"><a href="#10227">10227: </a>            <span class="php-comment">// W2. Search backward from each instance of a European number until the first strong type (R, L, AL, or sor) is found. If an AL is found, change the type of the European number to Arabic number.</span>
</span><span id="10228" class="l"><a href="#10228">10228: </a>            <span class="php-var">$prevlevel</span> = -<span class="php-num">1</span>;
</span><span id="10229" class="l"><a href="#10229">10229: </a>            <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10230" class="l"><a href="#10230">10230: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10231" class="l"><a href="#10231">10231: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] == <span class="php-quote">'EN'</span>) {
</span><span id="10232" class="l"><a href="#10232">10232: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$j</span>=<span class="php-var">$levcount</span>; <span class="php-var">$j</span> &gt;= <span class="php-num">0</span>; <span class="php-var">$j</span>--) {
</span><span id="10233" class="l"><a href="#10233">10233: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'AL'</span>) {
</span><span id="10234" class="l"><a href="#10234">10234: </a>                            <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'AN'</span>;
</span><span id="10235" class="l"><a href="#10235">10235: </a>                        } <span class="php-keyword1">elseif</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'L'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'R'</span>)) {
</span><span id="10236" class="l"><a href="#10236">10236: </a>                            <span class="php-keyword1">break</span>;
</span><span id="10237" class="l"><a href="#10237">10237: </a>                        }
</span><span id="10238" class="l"><a href="#10238">10238: </a>                    }
</span><span id="10239" class="l"><a href="#10239">10239: </a>                }
</span><span id="10240" class="l"><a href="#10240">10240: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>) {
</span><span id="10241" class="l"><a href="#10241">10241: </a>                    <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10242" class="l"><a href="#10242">10242: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10243" class="l"><a href="#10243">10243: </a>                    ++<span class="php-var">$levcount</span>;
</span><span id="10244" class="l"><a href="#10244">10244: </a>                }
</span><span id="10245" class="l"><a href="#10245">10245: </a>                <span class="php-var">$prevlevel</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>];
</span><span id="10246" class="l"><a href="#10246">10246: </a>            }
</span><span id="10247" class="l"><a href="#10247">10247: </a>
</span><span id="10248" class="l"><a href="#10248">10248: </a>            <span class="php-comment">// W3. Change all ALs to R.</span>
</span><span id="10249" class="l"><a href="#10249">10249: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10250" class="l"><a href="#10250">10250: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'AL'</span>) {
</span><span id="10251" class="l"><a href="#10251">10251: </a>                    <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'R'</span>;
</span><span id="10252" class="l"><a href="#10252">10252: </a>                }
</span><span id="10253" class="l"><a href="#10253">10253: </a>            }
</span><span id="10254" class="l"><a href="#10254">10254: </a>
</span><span id="10255" class="l"><a href="#10255">10255: </a>            <span class="php-comment">// W4. A single European separator between two European numbers changes to a European number. A single common separator between two numbers of the same type changes to that type.</span>
</span><span id="10256" class="l"><a href="#10256">10256: </a>            <span class="php-var">$prevlevel</span> = -<span class="php-num">1</span>;
</span><span id="10257" class="l"><a href="#10257">10257: </a>            <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10258" class="l"><a href="#10258">10258: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10259" class="l"><a href="#10259">10259: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$levcount</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$i</span>+<span class="php-num">1</span>) &lt; <span class="php-var">$numchars</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'level'</span>] == <span class="php-var">$prevlevel</span>)) {
</span><span id="10260" class="l"><a href="#10260">10260: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'ES'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>)) {
</span><span id="10261" class="l"><a href="#10261">10261: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'EN'</span>;
</span><span id="10262" class="l"><a href="#10262">10262: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'CS'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>)) {
</span><span id="10263" class="l"><a href="#10263">10263: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'EN'</span>;
</span><span id="10264" class="l"><a href="#10264">10264: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'CS'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>)) {
</span><span id="10265" class="l"><a href="#10265">10265: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'AN'</span>;
</span><span id="10266" class="l"><a href="#10266">10266: </a>                    }
</span><span id="10267" class="l"><a href="#10267">10267: </a>                }
</span><span id="10268" class="l"><a href="#10268">10268: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>) {
</span><span id="10269" class="l"><a href="#10269">10269: </a>                    <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10270" class="l"><a href="#10270">10270: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10271" class="l"><a href="#10271">10271: </a>                    ++<span class="php-var">$levcount</span>;
</span><span id="10272" class="l"><a href="#10272">10272: </a>                }
</span><span id="10273" class="l"><a href="#10273">10273: </a>                <span class="php-var">$prevlevel</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>];
</span><span id="10274" class="l"><a href="#10274">10274: </a>            }
</span><span id="10275" class="l"><a href="#10275">10275: </a>
</span><span id="10276" class="l"><a href="#10276">10276: </a>            <span class="php-comment">// W5. A sequence of European terminators adjacent to European numbers changes to all European numbers.</span>
</span><span id="10277" class="l"><a href="#10277">10277: </a>            <span class="php-var">$prevlevel</span> = -<span class="php-num">1</span>;
</span><span id="10278" class="l"><a href="#10278">10278: </a>            <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10279" class="l"><a href="#10279">10279: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10280" class="l"><a href="#10280">10280: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'ET'</span>) {
</span><span id="10281" class="l"><a href="#10281">10281: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$levcount</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>)) {
</span><span id="10282" class="l"><a href="#10282">10282: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'EN'</span>;
</span><span id="10283" class="l"><a href="#10283">10283: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="10284" class="l"><a href="#10284">10284: </a>                        <span class="php-var">$j</span> = <span class="php-var">$i</span>+<span class="php-num">1</span>;
</span><span id="10285" class="l"><a href="#10285">10285: </a>                        <span class="php-keyword1">while</span> ((<span class="php-var">$j</span> &lt; <span class="php-var">$numchars</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'level'</span>] == <span class="php-var">$prevlevel</span>)) {
</span><span id="10286" class="l"><a href="#10286">10286: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>) {
</span><span id="10287" class="l"><a href="#10287">10287: </a>                                <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'EN'</span>;
</span><span id="10288" class="l"><a href="#10288">10288: </a>                                <span class="php-keyword1">break</span>;
</span><span id="10289" class="l"><a href="#10289">10289: </a>                            } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] != <span class="php-quote">'ET'</span>) {
</span><span id="10290" class="l"><a href="#10290">10290: </a>                                <span class="php-keyword1">break</span>;
</span><span id="10291" class="l"><a href="#10291">10291: </a>                            }
</span><span id="10292" class="l"><a href="#10292">10292: </a>                            ++<span class="php-var">$j</span>;
</span><span id="10293" class="l"><a href="#10293">10293: </a>                        }
</span><span id="10294" class="l"><a href="#10294">10294: </a>                    }
</span><span id="10295" class="l"><a href="#10295">10295: </a>                }
</span><span id="10296" class="l"><a href="#10296">10296: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>) {
</span><span id="10297" class="l"><a href="#10297">10297: </a>                    <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10298" class="l"><a href="#10298">10298: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10299" class="l"><a href="#10299">10299: </a>                    ++<span class="php-var">$levcount</span>;
</span><span id="10300" class="l"><a href="#10300">10300: </a>                }
</span><span id="10301" class="l"><a href="#10301">10301: </a>                <span class="php-var">$prevlevel</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>];
</span><span id="10302" class="l"><a href="#10302">10302: </a>            }
</span><span id="10303" class="l"><a href="#10303">10303: </a>
</span><span id="10304" class="l"><a href="#10304">10304: </a>            <span class="php-comment">// W6. Otherwise, separators and terminators change to Other Neutral.</span>
</span><span id="10305" class="l"><a href="#10305">10305: </a>            <span class="php-var">$prevlevel</span> = -<span class="php-num">1</span>;
</span><span id="10306" class="l"><a href="#10306">10306: </a>            <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10307" class="l"><a href="#10307">10307: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10308" class="l"><a href="#10308">10308: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'ET'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'ES'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'CS'</span>)) {
</span><span id="10309" class="l"><a href="#10309">10309: </a>                    <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'ON'</span>;
</span><span id="10310" class="l"><a href="#10310">10310: </a>                }
</span><span id="10311" class="l"><a href="#10311">10311: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>) {
</span><span id="10312" class="l"><a href="#10312">10312: </a>                    <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10313" class="l"><a href="#10313">10313: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10314" class="l"><a href="#10314">10314: </a>                    ++<span class="php-var">$levcount</span>;
</span><span id="10315" class="l"><a href="#10315">10315: </a>                }
</span><span id="10316" class="l"><a href="#10316">10316: </a>                <span class="php-var">$prevlevel</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>];
</span><span id="10317" class="l"><a href="#10317">10317: </a>            }
</span><span id="10318" class="l"><a href="#10318">10318: </a>
</span><span id="10319" class="l"><a href="#10319">10319: </a>            <span class="php-comment">//W7. Search backward from each instance of a European number until the first strong type (R, L, or sor) is found. If an L is found, then change the type of the European number to L.</span>
</span><span id="10320" class="l"><a href="#10320">10320: </a>            <span class="php-var">$prevlevel</span> = -<span class="php-num">1</span>;
</span><span id="10321" class="l"><a href="#10321">10321: </a>            <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10322" class="l"><a href="#10322">10322: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10323" class="l"><a href="#10323">10323: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] == <span class="php-quote">'EN'</span>) {
</span><span id="10324" class="l"><a href="#10324">10324: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$j</span>=<span class="php-var">$levcount</span>; <span class="php-var">$j</span> &gt;= <span class="php-num">0</span>; <span class="php-var">$j</span>--) {
</span><span id="10325" class="l"><a href="#10325">10325: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'L'</span>) {
</span><span id="10326" class="l"><a href="#10326">10326: </a>                            <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'L'</span>;
</span><span id="10327" class="l"><a href="#10327">10327: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'R'</span>) {
</span><span id="10328" class="l"><a href="#10328">10328: </a>                            <span class="php-keyword1">break</span>;
</span><span id="10329" class="l"><a href="#10329">10329: </a>                        }
</span><span id="10330" class="l"><a href="#10330">10330: </a>                    }
</span><span id="10331" class="l"><a href="#10331">10331: </a>                }
</span><span id="10332" class="l"><a href="#10332">10332: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>) {
</span><span id="10333" class="l"><a href="#10333">10333: </a>                    <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10334" class="l"><a href="#10334">10334: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10335" class="l"><a href="#10335">10335: </a>                    ++<span class="php-var">$levcount</span>;
</span><span id="10336" class="l"><a href="#10336">10336: </a>                }
</span><span id="10337" class="l"><a href="#10337">10337: </a>                <span class="php-var">$prevlevel</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>];
</span><span id="10338" class="l"><a href="#10338">10338: </a>            }
</span><span id="10339" class="l"><a href="#10339">10339: </a>
</span><span id="10340" class="l"><a href="#10340">10340: </a>            <span class="php-comment">// N1. A sequence of neutrals takes the direction of the surrounding strong text if the text on both sides has the same direction. European and Arabic numbers act as if they were R in terms of their influence on neutrals. Start-of-level-run (sor) and end-of-level-run (eor) are used at level run boundaries.</span>
</span><span id="10341" class="l"><a href="#10341">10341: </a>            <span class="php-var">$prevlevel</span> = -<span class="php-num">1</span>;
</span><span id="10342" class="l"><a href="#10342">10342: </a>            <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10343" class="l"><a href="#10343">10343: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10344" class="l"><a href="#10344">10344: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$levcount</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$i</span>+<span class="php-num">1</span>) &lt; <span class="php-var">$numchars</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'level'</span>] == <span class="php-var">$prevlevel</span>)) {
</span><span id="10345" class="l"><a href="#10345">10345: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'L'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'L'</span>)) {
</span><span id="10346" class="l"><a href="#10346">10346: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'L'</span>;
</span><span id="10347" class="l"><a href="#10347">10347: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) <span class="php-keyword1">AND</span>
</span><span id="10348" class="l"><a href="#10348">10348: </a>                     ((<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'R'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>)) <span class="php-keyword1">AND</span>
</span><span id="10349" class="l"><a href="#10349">10349: </a>                     ((<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'R'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>))) {
</span><span id="10350" class="l"><a href="#10350">10350: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'R'</span>;
</span><span id="10351" class="l"><a href="#10351">10351: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) {
</span><span id="10352" class="l"><a href="#10352">10352: </a>                        <span class="php-comment">// N2. Any remaining neutrals take the embedding direction</span>
</span><span id="10353" class="l"><a href="#10353">10353: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>];
</span><span id="10354" class="l"><a href="#10354">10354: </a>                    }
</span><span id="10355" class="l"><a href="#10355">10355: </a>                } <span class="php-keyword1">elseif</span> ((<span class="php-var">$levcount</span> == <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$i</span>+<span class="php-num">1</span>) &lt; <span class="php-var">$numchars</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'level'</span>] == <span class="php-var">$prevlevel</span>)) {
</span><span id="10356" class="l"><a href="#10356">10356: </a>                    <span class="php-comment">// first char</span>
</span><span id="10357" class="l"><a href="#10357">10357: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>] == <span class="php-quote">'L'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'L'</span>)) {
</span><span id="10358" class="l"><a href="#10358">10358: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'L'</span>;
</span><span id="10359" class="l"><a href="#10359">10359: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) <span class="php-keyword1">AND</span>
</span><span id="10360" class="l"><a href="#10360">10360: </a>                     ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>] == <span class="php-quote">'R'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>] == <span class="php-quote">'AN'</span>)) <span class="php-keyword1">AND</span>
</span><span id="10361" class="l"><a href="#10361">10361: </a>                     ((<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'R'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>))) {
</span><span id="10362" class="l"><a href="#10362">10362: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'R'</span>;
</span><span id="10363" class="l"><a href="#10363">10363: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) {
</span><span id="10364" class="l"><a href="#10364">10364: </a>                        <span class="php-comment">// N2. Any remaining neutrals take the embedding direction</span>
</span><span id="10365" class="l"><a href="#10365">10365: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>];
</span><span id="10366" class="l"><a href="#10366">10366: </a>                    }
</span><span id="10367" class="l"><a href="#10367">10367: </a>                } <span class="php-keyword1">elseif</span> ((<span class="php-var">$levcount</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (((<span class="php-var">$i</span>+<span class="php-num">1</span>) == <span class="php-var">$numchars</span>) <span class="php-keyword1">OR</span> ((<span class="php-var">$i</span>+<span class="php-num">1</span>) &lt; <span class="php-var">$numchars</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>))) {
</span><span id="10368" class="l"><a href="#10368">10368: </a>                    <span class="php-comment">//last char</span>
</span><span id="10369" class="l"><a href="#10369">10369: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'L'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'eor'</span>] == <span class="php-quote">'L'</span>)) {
</span><span id="10370" class="l"><a href="#10370">10370: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'L'</span>;
</span><span id="10371" class="l"><a href="#10371">10371: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) <span class="php-keyword1">AND</span>
</span><span id="10372" class="l"><a href="#10372">10372: </a>                     ((<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'R'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>)) <span class="php-keyword1">AND</span>
</span><span id="10373" class="l"><a href="#10373">10373: </a>                     ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'eor'</span>] == <span class="php-quote">'R'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'eor'</span>] == <span class="php-quote">'EN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'eor'</span>] == <span class="php-quote">'AN'</span>))) {
</span><span id="10374" class="l"><a href="#10374">10374: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-quote">'R'</span>;
</span><span id="10375" class="l"><a href="#10375">10375: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) {
</span><span id="10376" class="l"><a href="#10376">10376: </a>                        <span class="php-comment">// N2. Any remaining neutrals take the embedding direction</span>
</span><span id="10377" class="l"><a href="#10377">10377: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>];
</span><span id="10378" class="l"><a href="#10378">10378: </a>                    }
</span><span id="10379" class="l"><a href="#10379">10379: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'N'</span>) {
</span><span id="10380" class="l"><a href="#10380">10380: </a>                    <span class="php-comment">// N2. Any remaining neutrals take the embedding direction</span>
</span><span id="10381" class="l"><a href="#10381">10381: </a>                    <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'sor'</span>];
</span><span id="10382" class="l"><a href="#10382">10382: </a>                }
</span><span id="10383" class="l"><a href="#10383">10383: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] != <span class="php-var">$prevlevel</span>) {
</span><span id="10384" class="l"><a href="#10384">10384: </a>                    <span class="php-var">$levcount</span> = <span class="php-num">0</span>;
</span><span id="10385" class="l"><a href="#10385">10385: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10386" class="l"><a href="#10386">10386: </a>                    ++<span class="php-var">$levcount</span>;
</span><span id="10387" class="l"><a href="#10387">10387: </a>                }
</span><span id="10388" class="l"><a href="#10388">10388: </a>                <span class="php-var">$prevlevel</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>];
</span><span id="10389" class="l"><a href="#10389">10389: </a>            }
</span><span id="10390" class="l"><a href="#10390">10390: </a>
</span><span id="10391" class="l"><a href="#10391">10391: </a>            <span class="php-comment">// I1. For all characters with an even (left-to-right) embedding direction, those of type R go up one level and those of type AN or EN go up two levels.</span>
</span><span id="10392" class="l"><a href="#10392">10392: </a>            <span class="php-comment">// I2. For all characters with an odd (right-to-left) embedding direction, those of type L, EN or AN go up one level.</span>
</span><span id="10393" class="l"><a href="#10393">10393: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10394" class="l"><a href="#10394">10394: </a>                <span class="php-var">$odd</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] % <span class="php-num">2</span>;
</span><span id="10395" class="l"><a href="#10395">10395: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$odd</span>) {
</span><span id="10396" class="l"><a href="#10396">10396: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'L'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>)) {
</span><span id="10397" class="l"><a href="#10397">10397: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] += <span class="php-num">1</span>;
</span><span id="10398" class="l"><a href="#10398">10398: </a>                    }
</span><span id="10399" class="l"><a href="#10399">10399: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10400" class="l"><a href="#10400">10400: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'R'</span>) {
</span><span id="10401" class="l"><a href="#10401">10401: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] += <span class="php-num">1</span>;
</span><span id="10402" class="l"><a href="#10402">10402: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'AN'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'EN'</span>)) {
</span><span id="10403" class="l"><a href="#10403">10403: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] += <span class="php-num">2</span>;
</span><span id="10404" class="l"><a href="#10404">10404: </a>                    }
</span><span id="10405" class="l"><a href="#10405">10405: </a>                }
</span><span id="10406" class="l"><a href="#10406">10406: </a>                <span class="php-var">$maxlevel</span> = <span class="php-keyword2">max</span>(<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>],<span class="php-var">$maxlevel</span>);
</span><span id="10407" class="l"><a href="#10407">10407: </a>            }
</span><span id="10408" class="l"><a href="#10408">10408: </a>
</span><span id="10409" class="l"><a href="#10409">10409: </a>            <span class="php-comment">// L1. On each line, reset the embedding level of the following characters to the paragraph embedding level:</span>
</span><span id="10410" class="l"><a href="#10410">10410: </a>            <span class="php-comment">//  1. Segment separators,</span>
</span><span id="10411" class="l"><a href="#10411">10411: </a>            <span class="php-comment">//  2. Paragraph separators,</span>
</span><span id="10412" class="l"><a href="#10412">10412: </a>            <span class="php-comment">//  3. Any sequence of whitespace characters preceding a segment separator or paragraph separator, and</span>
</span><span id="10413" class="l"><a href="#10413">10413: </a>            <span class="php-comment">//  4. Any sequence of white space characters at the end of the line.</span>
</span><span id="10414" class="l"><a href="#10414">10414: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10415" class="l"><a href="#10415">10415: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'B'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'S'</span>)) {
</span><span id="10416" class="l"><a href="#10416">10416: </a>                    <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] = <span class="php-var">$pel</span>;
</span><span id="10417" class="l"><a href="#10417">10417: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'WS'</span>) {
</span><span id="10418" class="l"><a href="#10418">10418: </a>                    <span class="php-var">$j</span> = <span class="php-var">$i</span>+<span class="php-num">1</span>;
</span><span id="10419" class="l"><a href="#10419">10419: </a>                    <span class="php-keyword1">while</span> (<span class="php-var">$j</span> &lt; <span class="php-var">$numchars</span>) {
</span><span id="10420" class="l"><a href="#10420">10420: </a>                        <span class="php-keyword1">if</span> (((<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'B'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'S'</span>)) <span class="php-keyword1">OR</span>
</span><span id="10421" class="l"><a href="#10421">10421: </a>                            ((<span class="php-var">$j</span> == (<span class="php-var">$numchars</span>-<span class="php-num">1</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] == <span class="php-quote">'WS'</span>))) {
</span><span id="10422" class="l"><a href="#10422">10422: </a>                            <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] = <span class="php-var">$pel</span>;
</span><span id="10423" class="l"><a href="#10423">10423: </a>                            <span class="php-keyword1">break</span>;
</span><span id="10424" class="l"><a href="#10424">10424: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$chardata</span>[<span class="php-var">$j</span>][<span class="php-quote">'type'</span>] != <span class="php-quote">'WS'</span>) {
</span><span id="10425" class="l"><a href="#10425">10425: </a>                            <span class="php-keyword1">break</span>;
</span><span id="10426" class="l"><a href="#10426">10426: </a>                        }
</span><span id="10427" class="l"><a href="#10427">10427: </a>                        ++<span class="php-var">$j</span>;
</span><span id="10428" class="l"><a href="#10428">10428: </a>                    }
</span><span id="10429" class="l"><a href="#10429">10429: </a>                }
</span><span id="10430" class="l"><a href="#10430">10430: </a>            }
</span><span id="10431" class="l"><a href="#10431">10431: </a>
</span><span id="10432" class="l"><a href="#10432">10432: </a>            <span class="php-comment">// Arabic Shaping</span>
</span><span id="10433" class="l"><a href="#10433">10433: </a>            <span class="php-comment">// Cursively connected scripts, such as Arabic or Syriac, require the selection of positional character shapes that depend on adjacent characters. Shaping is logically applied after the Bidirectional Algorithm is used and is limited to characters within the same directional run.</span>
</span><span id="10434" class="l"><a href="#10434">10434: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$arabic</span>) {
</span><span id="10435" class="l"><a href="#10435">10435: </a>                <span class="php-var">$endedletter</span> = <span class="php-keyword1">array</span>(<span class="php-num">1569</span>,<span class="php-num">1570</span>,<span class="php-num">1571</span>,<span class="php-num">1572</span>,<span class="php-num">1573</span>,<span class="php-num">1575</span>,<span class="php-num">1577</span>,<span class="php-num">1583</span>,<span class="php-num">1584</span>,<span class="php-num">1585</span>,<span class="php-num">1586</span>,<span class="php-num">1608</span>,<span class="php-num">1688</span>);
</span><span id="10436" class="l"><a href="#10436">10436: </a>                <span class="php-var">$alfletter</span> = <span class="php-keyword1">array</span>(<span class="php-num">1570</span>,<span class="php-num">1571</span>,<span class="php-num">1573</span>,<span class="php-num">1575</span>);
</span><span id="10437" class="l"><a href="#10437">10437: </a>                <span class="php-var">$chardata2</span> = <span class="php-var">$chardata</span>;
</span><span id="10438" class="l"><a href="#10438">10438: </a>                <span class="php-var">$laaletter</span> = <span class="php-keyword1">false</span>;
</span><span id="10439" class="l"><a href="#10439">10439: </a>                <span class="php-var">$charAL</span> = <span class="php-keyword1">array</span>();
</span><span id="10440" class="l"><a href="#10440">10440: </a>                <span class="php-var">$x</span> = <span class="php-num">0</span>;
</span><span id="10441" class="l"><a href="#10441">10441: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10442" class="l"><a href="#10442">10442: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$unicode</span>[<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>]] == <span class="php-quote">'AL'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] == <span class="php-num">32</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] == <span class="php-num">8204</span>)) {
</span><span id="10443" class="l"><a href="#10443">10443: </a>                        <span class="php-var">$charAL</span>[<span class="php-var">$x</span>] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>];
</span><span id="10444" class="l"><a href="#10444">10444: </a>                        <span class="php-var">$charAL</span>[<span class="php-var">$x</span>][<span class="php-quote">'i'</span>] = <span class="php-var">$i</span>;
</span><span id="10445" class="l"><a href="#10445">10445: </a>                        <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'x'</span>] = <span class="php-var">$x</span>;
</span><span id="10446" class="l"><a href="#10446">10446: </a>                        ++<span class="php-var">$x</span>;
</span><span id="10447" class="l"><a href="#10447">10447: </a>                    }
</span><span id="10448" class="l"><a href="#10448">10448: </a>                }
</span><span id="10449" class="l"><a href="#10449">10449: </a>                <span class="php-var">$numAL</span> = <span class="php-var">$x</span>;
</span><span id="10450" class="l"><a href="#10450">10450: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10451" class="l"><a href="#10451">10451: </a>                    <span class="php-var">$thischar</span> = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>];
</span><span id="10452" class="l"><a href="#10452">10452: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$i</span> &gt; <span class="php-num">0</span>) {
</span><span id="10453" class="l"><a href="#10453">10453: </a>                        <span class="php-var">$prevchar</span> = <span class="php-var">$chardata</span>[(<span class="php-var">$i</span>-<span class="php-num">1</span>)];
</span><span id="10454" class="l"><a href="#10454">10454: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="10455" class="l"><a href="#10455">10455: </a>                        <span class="php-var">$prevchar</span> = <span class="php-keyword1">false</span>;
</span><span id="10456" class="l"><a href="#10456">10456: </a>                    }
</span><span id="10457" class="l"><a href="#10457">10457: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$i</span>+<span class="php-num">1</span>) &lt; <span class="php-var">$numchars</span>) {
</span><span id="10458" class="l"><a href="#10458">10458: </a>                        <span class="php-var">$nextchar</span> = <span class="php-var">$chardata</span>[(<span class="php-var">$i</span>+<span class="php-num">1</span>)];
</span><span id="10459" class="l"><a href="#10459">10459: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="10460" class="l"><a href="#10460">10460: </a>                        <span class="php-var">$nextchar</span> = <span class="php-keyword1">false</span>;
</span><span id="10461" class="l"><a href="#10461">10461: </a>                    }
</span><span id="10462" class="l"><a href="#10462">10462: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$unicode</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'AL'</span>) {
</span><span id="10463" class="l"><a href="#10463">10463: </a>                        <span class="php-var">$x</span> = <span class="php-var">$thischar</span>[<span class="php-quote">'x'</span>];
</span><span id="10464" class="l"><a href="#10464">10464: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$x</span> &gt; <span class="php-num">0</span>) {
</span><span id="10465" class="l"><a href="#10465">10465: </a>                            <span class="php-var">$prevchar</span> = <span class="php-var">$charAL</span>[(<span class="php-var">$x</span>-<span class="php-num">1</span>)];
</span><span id="10466" class="l"><a href="#10466">10466: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="10467" class="l"><a href="#10467">10467: </a>                            <span class="php-var">$prevchar</span> = <span class="php-keyword1">false</span>;
</span><span id="10468" class="l"><a href="#10468">10468: </a>                        }
</span><span id="10469" class="l"><a href="#10469">10469: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$x</span>+<span class="php-num">1</span>) &lt; <span class="php-var">$numAL</span>) {
</span><span id="10470" class="l"><a href="#10470">10470: </a>                            <span class="php-var">$nextchar</span> = <span class="php-var">$charAL</span>[(<span class="php-var">$x</span>+<span class="php-num">1</span>)];
</span><span id="10471" class="l"><a href="#10471">10471: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="10472" class="l"><a href="#10472">10472: </a>                            <span class="php-var">$nextchar</span> = <span class="php-keyword1">false</span>;
</span><span id="10473" class="l"><a href="#10473">10473: </a>                        }
</span><span id="10474" class="l"><a href="#10474">10474: </a>                        <span class="php-comment">// if laa letter</span>
</span><span id="10475" class="l"><a href="#10475">10475: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$prevchar</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$prevchar</span>[<span class="php-quote">'char'</span>] == <span class="php-num">1604</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>], <span class="php-var">$alfletter</span>))) {
</span><span id="10476" class="l"><a href="#10476">10476: </a>                            <span class="php-var">$arabicarr</span> = <span class="php-var">$laa_array</span>;
</span><span id="10477" class="l"><a href="#10477">10477: </a>                            <span class="php-var">$laaletter</span> = <span class="php-keyword1">true</span>;
</span><span id="10478" class="l"><a href="#10478">10478: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> &gt; <span class="php-num">1</span>) {
</span><span id="10479" class="l"><a href="#10479">10479: </a>                                <span class="php-var">$prevchar</span> = <span class="php-var">$charAL</span>[(<span class="php-var">$x</span>-<span class="php-num">2</span>)];
</span><span id="10480" class="l"><a href="#10480">10480: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="10481" class="l"><a href="#10481">10481: </a>                                <span class="php-var">$prevchar</span> = <span class="php-keyword1">false</span>;
</span><span id="10482" class="l"><a href="#10482">10482: </a>                            }
</span><span id="10483" class="l"><a href="#10483">10483: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="10484" class="l"><a href="#10484">10484: </a>                            <span class="php-var">$arabicarr</span> = <span class="php-var">$unicode_arlet</span>;
</span><span id="10485" class="l"><a href="#10485">10485: </a>                            <span class="php-var">$laaletter</span> = <span class="php-keyword1">false</span>;
</span><span id="10486" class="l"><a href="#10486">10486: </a>                        }
</span><span id="10487" class="l"><a href="#10487">10487: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$prevchar</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$nextchar</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span>
</span><span id="10488" class="l"><a href="#10488">10488: </a>                            ((<span class="php-var">$unicode</span>[<span class="php-var">$prevchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'AL'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$unicode</span>[<span class="php-var">$prevchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'NSM'</span>)) <span class="php-keyword1">AND</span>
</span><span id="10489" class="l"><a href="#10489">10489: </a>                            ((<span class="php-var">$unicode</span>[<span class="php-var">$nextchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'AL'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$unicode</span>[<span class="php-var">$nextchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'NSM'</span>)) <span class="php-keyword1">AND</span>
</span><span id="10490" class="l"><a href="#10490">10490: </a>                            (<span class="php-var">$prevchar</span>[<span class="php-quote">'type'</span>] == <span class="php-var">$thischar</span>[<span class="php-quote">'type'</span>]) <span class="php-keyword1">AND</span>
</span><span id="10491" class="l"><a href="#10491">10491: </a>                            (<span class="php-var">$nextchar</span>[<span class="php-quote">'type'</span>] == <span class="php-var">$thischar</span>[<span class="php-quote">'type'</span>]) <span class="php-keyword1">AND</span>
</span><span id="10492" class="l"><a href="#10492">10492: </a>                            (<span class="php-var">$nextchar</span>[<span class="php-quote">'char'</span>] != <span class="php-num">1567</span>)) {
</span><span id="10493" class="l"><a href="#10493">10493: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$prevchar</span>[<span class="php-quote">'char'</span>], <span class="php-var">$endedletter</span>)) {
</span><span id="10494" class="l"><a href="#10494">10494: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">2</span>])) {
</span><span id="10495" class="l"><a href="#10495">10495: </a>                                    <span class="php-comment">// initial</span>
</span><span id="10496" class="l"><a href="#10496">10496: </a>                                    <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">2</span>];
</span><span id="10497" class="l"><a href="#10497">10497: </a>                                }
</span><span id="10498" class="l"><a href="#10498">10498: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="10499" class="l"><a href="#10499">10499: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">3</span>])) {
</span><span id="10500" class="l"><a href="#10500">10500: </a>                                    <span class="php-comment">// medial</span>
</span><span id="10501" class="l"><a href="#10501">10501: </a>                                    <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">3</span>];
</span><span id="10502" class="l"><a href="#10502">10502: </a>                                }
</span><span id="10503" class="l"><a href="#10503">10503: </a>                            }
</span><span id="10504" class="l"><a href="#10504">10504: </a>                        } <span class="php-keyword1">elseif</span> ((<span class="php-var">$nextchar</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span>
</span><span id="10505" class="l"><a href="#10505">10505: </a>                            ((<span class="php-var">$unicode</span>[<span class="php-var">$nextchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'AL'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$unicode</span>[<span class="php-var">$nextchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'NSM'</span>)) <span class="php-keyword1">AND</span>
</span><span id="10506" class="l"><a href="#10506">10506: </a>                            (<span class="php-var">$nextchar</span>[<span class="php-quote">'type'</span>] == <span class="php-var">$thischar</span>[<span class="php-quote">'type'</span>]) <span class="php-keyword1">AND</span>
</span><span id="10507" class="l"><a href="#10507">10507: </a>                            (<span class="php-var">$nextchar</span>[<span class="php-quote">'char'</span>] != <span class="php-num">1567</span>)) {
</span><span id="10508" class="l"><a href="#10508">10508: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$arabicarr</span>[<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>]][<span class="php-num">2</span>])) {
</span><span id="10509" class="l"><a href="#10509">10509: </a>                                <span class="php-comment">// initial</span>
</span><span id="10510" class="l"><a href="#10510">10510: </a>                                <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">2</span>];
</span><span id="10511" class="l"><a href="#10511">10511: </a>                            }
</span><span id="10512" class="l"><a href="#10512">10512: </a>                        } <span class="php-keyword1">elseif</span> (((<span class="php-var">$prevchar</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span>
</span><span id="10513" class="l"><a href="#10513">10513: </a>                            ((<span class="php-var">$unicode</span>[<span class="php-var">$prevchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'AL'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$unicode</span>[<span class="php-var">$prevchar</span>[<span class="php-quote">'char'</span>]] == <span class="php-quote">'NSM'</span>)) <span class="php-keyword1">AND</span>
</span><span id="10514" class="l"><a href="#10514">10514: </a>                            (<span class="php-var">$prevchar</span>[<span class="php-quote">'type'</span>] == <span class="php-var">$thischar</span>[<span class="php-quote">'type'</span>])) <span class="php-keyword1">OR</span>
</span><span id="10515" class="l"><a href="#10515">10515: </a>                            ((<span class="php-var">$nextchar</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$nextchar</span>[<span class="php-quote">'char'</span>] == <span class="php-num">1567</span>))) {
</span><span id="10516" class="l"><a href="#10516">10516: </a>                            <span class="php-comment">// final</span>
</span><span id="10517" class="l"><a href="#10517">10517: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$i</span> &gt; <span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>] == <span class="php-num">1607</span>) <span class="php-keyword1">AND</span>
</span><span id="10518" class="l"><a href="#10518">10518: </a>                                (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>-<span class="php-num">1</span>][<span class="php-quote">'char'</span>] == <span class="php-num">1604</span>) <span class="php-keyword1">AND</span>
</span><span id="10519" class="l"><a href="#10519">10519: </a>                                (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>-<span class="php-num">2</span>][<span class="php-quote">'char'</span>] == <span class="php-num">1604</span>)) {
</span><span id="10520" class="l"><a href="#10520">10520: </a>                                <span class="php-comment">//Allah Word</span>
</span><span id="10521" class="l"><a href="#10521">10521: </a>                                <span class="php-comment">// mark characters to delete with false</span>
</span><span id="10522" class="l"><a href="#10522">10522: </a>                                <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>-<span class="php-num">2</span>][<span class="php-quote">'char'</span>] = <span class="php-keyword1">false</span>;
</span><span id="10523" class="l"><a href="#10523">10523: </a>                                <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>-<span class="php-num">1</span>][<span class="php-quote">'char'</span>] = <span class="php-keyword1">false</span>;
</span><span id="10524" class="l"><a href="#10524">10524: </a>                                <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-num">65010</span>;
</span><span id="10525" class="l"><a href="#10525">10525: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="10526" class="l"><a href="#10526">10526: </a>                                <span class="php-keyword1">if</span> ((<span class="php-var">$prevchar</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$prevchar</span>[<span class="php-quote">'char'</span>], <span class="php-var">$endedletter</span>)) {
</span><span id="10527" class="l"><a href="#10527">10527: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">0</span>])) {
</span><span id="10528" class="l"><a href="#10528">10528: </a>                                        <span class="php-comment">// isolated</span>
</span><span id="10529" class="l"><a href="#10529">10529: </a>                                        <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">0</span>];
</span><span id="10530" class="l"><a href="#10530">10530: </a>                                    }
</span><span id="10531" class="l"><a href="#10531">10531: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="10532" class="l"><a href="#10532">10532: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">1</span>])) {
</span><span id="10533" class="l"><a href="#10533">10533: </a>                                        <span class="php-comment">// final</span>
</span><span id="10534" class="l"><a href="#10534">10534: </a>                                        <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">1</span>];
</span><span id="10535" class="l"><a href="#10535">10535: </a>                                    }
</span><span id="10536" class="l"><a href="#10536">10536: </a>                                }
</span><span id="10537" class="l"><a href="#10537">10537: </a>                            }
</span><span id="10538" class="l"><a href="#10538">10538: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">0</span>])) {
</span><span id="10539" class="l"><a href="#10539">10539: </a>                            <span class="php-comment">// isolated</span>
</span><span id="10540" class="l"><a href="#10540">10540: </a>                            <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$arabicarr</span>[<span class="php-var">$thischar</span>[<span class="php-quote">'char'</span>]][<span class="php-num">0</span>];
</span><span id="10541" class="l"><a href="#10541">10541: </a>                        }
</span><span id="10542" class="l"><a href="#10542">10542: </a>                        <span class="php-comment">// if laa letter</span>
</span><span id="10543" class="l"><a href="#10543">10543: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$laaletter</span>) {
</span><span id="10544" class="l"><a href="#10544">10544: </a>                            <span class="php-comment">// mark characters to delete with false</span>
</span><span id="10545" class="l"><a href="#10545">10545: </a>                            <span class="php-var">$chardata2</span>[(<span class="php-var">$charAL</span>[(<span class="php-var">$x</span>-<span class="php-num">1</span>)][<span class="php-quote">'i'</span>])][<span class="php-quote">'char'</span>] = <span class="php-keyword1">false</span>;
</span><span id="10546" class="l"><a href="#10546">10546: </a>                        }
</span><span id="10547" class="l"><a href="#10547">10547: </a>                    } <span class="php-comment">// end if AL (Arabic Letter)</span>
</span><span id="10548" class="l"><a href="#10548">10548: </a>                } <span class="php-comment">// end for each char</span>
</span><span id="10549" class="l"><a href="#10549">10549: </a>                <span class="php-comment">/*
</span></span><span id="10550" class="l"><a href="#10550">10550: </a><span class="php-comment">                 * Combining characters that can occur with Arabic Shadda (0651 HEX, 1617 DEC) are replaced.
</span></span><span id="10551" class="l"><a href="#10551">10551: </a><span class="php-comment">                 * Putting the combining mark and shadda in the same glyph allows us to avoid the two marks overlapping each other in an illegible manner.
</span></span><span id="10552" class="l"><a href="#10552">10552: </a><span class="php-comment">                 */</span>
</span><span id="10553" class="l"><a href="#10553">10553: </a>                <span class="php-var">$cw</span> = &amp;<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'cw'</span>];
</span><span id="10554" class="l"><a href="#10554">10554: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; (<span class="php-var">$numchars</span>-<span class="php-num">1</span>); ++<span class="php-var">$i</span>) {
</span><span id="10555" class="l"><a href="#10555">10555: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] == <span class="php-num">1617</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$diacritics</span>[(<span class="php-var">$chardata2</span>[<span class="php-var">$i</span>+<span class="php-num">1</span>][<span class="php-quote">'char'</span>])]))) {
</span><span id="10556" class="l"><a href="#10556">10556: </a>                        <span class="php-comment">// check if the subtitution font is defined on current font</span>
</span><span id="10557" class="l"><a href="#10557">10557: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cw</span>[(<span class="php-var">$diacritics</span>[(<span class="php-var">$chardata2</span>[<span class="php-var">$i</span>+<span class="php-num">1</span>][<span class="php-quote">'char'</span>])])])) {
</span><span id="10558" class="l"><a href="#10558">10558: </a>                            <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-keyword1">false</span>;
</span><span id="10559" class="l"><a href="#10559">10559: </a>                            <span class="php-var">$chardata2</span>[<span class="php-var">$i</span>+<span class="php-num">1</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$diacritics</span>[(<span class="php-var">$chardata2</span>[<span class="php-var">$i</span>+<span class="php-num">1</span>][<span class="php-quote">'char'</span>])];
</span><span id="10560" class="l"><a href="#10560">10560: </a>                        }
</span><span id="10561" class="l"><a href="#10561">10561: </a>                    }
</span><span id="10562" class="l"><a href="#10562">10562: </a>                }
</span><span id="10563" class="l"><a href="#10563">10563: </a>                <span class="php-comment">// remove marked characters</span>
</span><span id="10564" class="l"><a href="#10564">10564: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$chardata2</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>) {
</span><span id="10565" class="l"><a href="#10565">10565: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$value</span>[<span class="php-quote">'char'</span>] === <span class="php-keyword1">false</span>) {
</span><span id="10566" class="l"><a href="#10566">10566: </a>                        <span class="php-keyword1">unset</span>(<span class="php-var">$chardata2</span>[<span class="php-var">$key</span>]);
</span><span id="10567" class="l"><a href="#10567">10567: </a>                    }
</span><span id="10568" class="l"><a href="#10568">10568: </a>                }
</span><span id="10569" class="l"><a href="#10569">10569: </a>                <span class="php-var">$chardata</span> = <span class="php-keyword2">array_values</span>(<span class="php-var">$chardata2</span>);
</span><span id="10570" class="l"><a href="#10570">10570: </a>                <span class="php-var">$numchars</span> = <span class="php-keyword2">count</span>(<span class="php-var">$chardata</span>);
</span><span id="10571" class="l"><a href="#10571">10571: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$chardata2</span>);
</span><span id="10572" class="l"><a href="#10572">10572: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$arabicarr</span>);
</span><span id="10573" class="l"><a href="#10573">10573: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$laaletter</span>);
</span><span id="10574" class="l"><a href="#10574">10574: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$charAL</span>);
</span><span id="10575" class="l"><a href="#10575">10575: </a>            }
</span><span id="10576" class="l"><a href="#10576">10576: </a>
</span><span id="10577" class="l"><a href="#10577">10577: </a>            <span class="php-comment">// L2. From the highest level found in the text to the lowest odd level on each line, including intermediate levels not actually present in the text, reverse any contiguous sequence of characters that are at that level or higher.</span>
</span><span id="10578" class="l"><a href="#10578">10578: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$j</span>=<span class="php-var">$maxlevel</span>; <span class="php-var">$j</span> &gt; <span class="php-num">0</span>; <span class="php-var">$j</span>--) {
</span><span id="10579" class="l"><a href="#10579">10579: </a>                <span class="php-var">$ordarray</span> = <span class="php-keyword1">Array</span>();
</span><span id="10580" class="l"><a href="#10580">10580: </a>                <span class="php-var">$revarr</span> = <span class="php-keyword1">Array</span>();
</span><span id="10581" class="l"><a href="#10581">10581: </a>                <span class="php-var">$onlevel</span> = <span class="php-keyword1">false</span>;
</span><span id="10582" class="l"><a href="#10582">10582: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10583" class="l"><a href="#10583">10583: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'level'</span>] &gt;= <span class="php-var">$j</span>) {
</span><span id="10584" class="l"><a href="#10584">10584: </a>                        <span class="php-var">$onlevel</span> = <span class="php-keyword1">true</span>;
</span><span id="10585" class="l"><a href="#10585">10585: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$unicode_mirror</span>[<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>]])) {
</span><span id="10586" class="l"><a href="#10586">10586: </a>                            <span class="php-comment">// L4. A character is depicted by a mirrored glyph if and only if (a) the resolved directionality of that character is R, and (b) the Bidi_Mirrored property value of that character is true.</span>
</span><span id="10587" class="l"><a href="#10587">10587: </a>                            <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>] = <span class="php-var">$unicode_mirror</span>[<span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>]];
</span><span id="10588" class="l"><a href="#10588">10588: </a>                        }
</span><span id="10589" class="l"><a href="#10589">10589: </a>                        <span class="php-var">$revarr</span>[] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>];
</span><span id="10590" class="l"><a href="#10590">10590: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="10591" class="l"><a href="#10591">10591: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$onlevel</span>) {
</span><span id="10592" class="l"><a href="#10592">10592: </a>                            <span class="php-var">$revarr</span> = <span class="php-keyword2">array_reverse</span>(<span class="php-var">$revarr</span>);
</span><span id="10593" class="l"><a href="#10593">10593: </a>                            <span class="php-var">$ordarray</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$ordarray</span>, <span class="php-var">$revarr</span>);
</span><span id="10594" class="l"><a href="#10594">10594: </a>                            <span class="php-var">$revarr</span> = <span class="php-keyword1">Array</span>();
</span><span id="10595" class="l"><a href="#10595">10595: </a>                            <span class="php-var">$onlevel</span> = <span class="php-keyword1">false</span>;
</span><span id="10596" class="l"><a href="#10596">10596: </a>                        }
</span><span id="10597" class="l"><a href="#10597">10597: </a>                        <span class="php-var">$ordarray</span>[] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>];
</span><span id="10598" class="l"><a href="#10598">10598: </a>                    }
</span><span id="10599" class="l"><a href="#10599">10599: </a>                }
</span><span id="10600" class="l"><a href="#10600">10600: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$onlevel</span>) {
</span><span id="10601" class="l"><a href="#10601">10601: </a>                    <span class="php-var">$revarr</span> = <span class="php-keyword2">array_reverse</span>(<span class="php-var">$revarr</span>);
</span><span id="10602" class="l"><a href="#10602">10602: </a>                    <span class="php-var">$ordarray</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$ordarray</span>, <span class="php-var">$revarr</span>);
</span><span id="10603" class="l"><a href="#10603">10603: </a>                }
</span><span id="10604" class="l"><a href="#10604">10604: </a>                <span class="php-var">$chardata</span> = <span class="php-var">$ordarray</span>;
</span><span id="10605" class="l"><a href="#10605">10605: </a>            }
</span><span id="10606" class="l"><a href="#10606">10606: </a>
</span><span id="10607" class="l"><a href="#10607">10607: </a>            <span class="php-var">$ordarray</span> = <span class="php-keyword1">array</span>();
</span><span id="10608" class="l"><a href="#10608">10608: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numchars</span>; ++<span class="php-var">$i</span>) {
</span><span id="10609" class="l"><a href="#10609">10609: </a>                <span class="php-var">$ordarray</span>[] = <span class="php-var">$chardata</span>[<span class="php-var">$i</span>][<span class="php-quote">'char'</span>];
</span><span id="10610" class="l"><a href="#10610">10610: </a>            }
</span><span id="10611" class="l"><a href="#10611">10611: </a>
</span><span id="10612" class="l"><a href="#10612">10612: </a>            <span class="php-keyword1">return</span> <span class="php-var">$ordarray</span>;
</span><span id="10613" class="l"><a href="#10613">10613: </a>        }
</span><span id="10614" class="l"><a href="#10614">10614: </a>
</span><span id="10615" class="l"><a href="#10615">10615: </a>        <span class="php-comment">// END OF BIDIRECTIONAL TEXT SECTION -------------------</span>
</span><span id="10616" class="l"><a href="#10616">10616: </a>
</span><span id="10617" class="l"><a href="#10617">10617: </a>        <span class="php-comment">/**
</span></span><span id="10618" class="l"><a href="#10618">10618: </a><span class="php-comment">         * Adds a bookmark.
</span></span><span id="10619" class="l"><a href="#10619">10619: </a><span class="php-comment">         * @param string $txt bookmark description.
</span></span><span id="10620" class="l"><a href="#10620">10620: </a><span class="php-comment">         * @param int $level bookmark level (minimum value is 0).
</span></span><span id="10621" class="l"><a href="#10621">10621: </a><span class="php-comment">         * @param float $y Ordinate of the boorkmark position (default = -1 = current position).
</span></span><span id="10622" class="l"><a href="#10622">10622: </a><span class="php-comment">         * @param int $page target page number (leave empty for current page).
</span></span><span id="10623" class="l"><a href="#10623">10623: </a><span class="php-comment">         * @access public
</span></span><span id="10624" class="l"><a href="#10624">10624: </a><span class="php-comment">         * @author Olivier Plathey, Nicola Asuni
</span></span><span id="10625" class="l"><a href="#10625">10625: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="10626" class="l"><a href="#10626">10626: </a><span class="php-comment">         */</span>
</span><span id="10627" class="l"><a href="#10627">10627: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Bookmark(<span class="php-var">$txt</span>, <span class="php-var">$level</span>=<span class="php-num">0</span>, <span class="php-var">$y</span>=-<span class="php-num">1</span>, <span class="php-var">$page</span>=<span class="php-quote">''</span>) {
</span><span id="10628" class="l"><a href="#10628">10628: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$level</span> &lt; <span class="php-num">0</span>) {
</span><span id="10629" class="l"><a href="#10629">10629: </a>                <span class="php-var">$level</span> = <span class="php-num">0</span>;
</span><span id="10630" class="l"><a href="#10630">10630: </a>            }
</span><span id="10631" class="l"><a href="#10631">10631: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;outlines[<span class="php-num">0</span>])) {
</span><span id="10632" class="l"><a href="#10632">10632: </a>                <span class="php-var">$lastoutline</span> = <span class="php-keyword2">end</span>(<span class="php-var">$this</span>-&gt;outlines);
</span><span id="10633" class="l"><a href="#10633">10633: </a>                <span class="php-var">$maxlevel</span> = <span class="php-var">$lastoutline</span>[<span class="php-quote">'l'</span>] + <span class="php-num">1</span>;
</span><span id="10634" class="l"><a href="#10634">10634: </a>            } <span class="php-keyword1">else</span> {
</span><span id="10635" class="l"><a href="#10635">10635: </a>                <span class="php-var">$maxlevel</span> = <span class="php-num">0</span>;
</span><span id="10636" class="l"><a href="#10636">10636: </a>            }
</span><span id="10637" class="l"><a href="#10637">10637: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$level</span> &gt; <span class="php-var">$maxlevel</span>) {
</span><span id="10638" class="l"><a href="#10638">10638: </a>                <span class="php-var">$level</span> = <span class="php-var">$maxlevel</span>;
</span><span id="10639" class="l"><a href="#10639">10639: </a>            }
</span><span id="10640" class="l"><a href="#10640">10640: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> == -<span class="php-num">1</span>) {
</span><span id="10641" class="l"><a href="#10641">10641: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="10642" class="l"><a href="#10642">10642: </a>            }
</span><span id="10643" class="l"><a href="#10643">10643: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$page</span>)) {
</span><span id="10644" class="l"><a href="#10644">10644: </a>                <span class="php-var">$page</span> = <span class="php-var">$this</span>-&gt;PageNo();
</span><span id="10645" class="l"><a href="#10645">10645: </a>            }
</span><span id="10646" class="l"><a href="#10646">10646: </a>            <span class="php-var">$this</span>-&gt;outlines[] = <span class="php-keyword1">array</span>(<span class="php-quote">'t'</span> =&gt; <span class="php-var">$txt</span>, <span class="php-quote">'l'</span> =&gt; <span class="php-var">$level</span>, <span class="php-quote">'y'</span> =&gt; <span class="php-var">$y</span>, <span class="php-quote">'p'</span> =&gt; <span class="php-var">$page</span>);
</span><span id="10647" class="l"><a href="#10647">10647: </a>        }
</span><span id="10648" class="l"><a href="#10648">10648: </a>
</span><span id="10649" class="l"><a href="#10649">10649: </a>        <span class="php-comment">/**
</span></span><span id="10650" class="l"><a href="#10650">10650: </a><span class="php-comment">         * Create a bookmark PDF string.
</span></span><span id="10651" class="l"><a href="#10651">10651: </a><span class="php-comment">         * @access protected
</span></span><span id="10652" class="l"><a href="#10652">10652: </a><span class="php-comment">         * @author Olivier Plathey, Nicola Asuni
</span></span><span id="10653" class="l"><a href="#10653">10653: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="10654" class="l"><a href="#10654">10654: </a><span class="php-comment">         */</span>
</span><span id="10655" class="l"><a href="#10655">10655: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putbookmarks() {
</span><span id="10656" class="l"><a href="#10656">10656: </a>            <span class="php-var">$nb</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;outlines);
</span><span id="10657" class="l"><a href="#10657">10657: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$nb</span> == <span class="php-num">0</span>) {
</span><span id="10658" class="l"><a href="#10658">10658: </a>                <span class="php-keyword1">return</span>;
</span><span id="10659" class="l"><a href="#10659">10659: </a>            }
</span><span id="10660" class="l"><a href="#10660">10660: </a>            <span class="php-comment">// get sorting columns</span>
</span><span id="10661" class="l"><a href="#10661">10661: </a>            <span class="php-var">$outline_p</span> = <span class="php-keyword1">array</span>();
</span><span id="10662" class="l"><a href="#10662">10662: </a>            <span class="php-var">$outline_y</span> = <span class="php-keyword1">array</span>();
</span><span id="10663" class="l"><a href="#10663">10663: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;outlines <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$row</span>) {
</span><span id="10664" class="l"><a href="#10664">10664: </a>                <span class="php-var">$outline_p</span>[<span class="php-var">$key</span>]  = <span class="php-var">$row</span>[<span class="php-quote">'p'</span>];
</span><span id="10665" class="l"><a href="#10665">10665: </a>                <span class="php-var">$outline_k</span>[<span class="php-var">$key</span>] = <span class="php-var">$key</span>;
</span><span id="10666" class="l"><a href="#10666">10666: </a>            }
</span><span id="10667" class="l"><a href="#10667">10667: </a>            <span class="php-comment">// sort outlines by page and original position</span>
</span><span id="10668" class="l"><a href="#10668">10668: </a>            <span class="php-keyword2">array_multisort</span>(<span class="php-var">$outline_p</span>, SORT_NUMERIC, SORT_ASC, <span class="php-var">$outline_k</span>, SORT_NUMERIC, SORT_ASC, <span class="php-var">$this</span>-&gt;outlines);
</span><span id="10669" class="l"><a href="#10669">10669: </a>            <span class="php-var">$lru</span> = <span class="php-keyword1">array</span>();
</span><span id="10670" class="l"><a href="#10670">10670: </a>            <span class="php-var">$level</span> = <span class="php-num">0</span>;
</span><span id="10671" class="l"><a href="#10671">10671: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;outlines <span class="php-keyword1">as</span> <span class="php-var">$i</span> =&gt; <span class="php-var">$o</span>) {
</span><span id="10672" class="l"><a href="#10672">10672: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$o</span>[<span class="php-quote">'l'</span>] &gt; <span class="php-num">0</span>) {
</span><span id="10673" class="l"><a href="#10673">10673: </a>                    <span class="php-var">$parent</span> = <span class="php-var">$lru</span>[(<span class="php-var">$o</span>[<span class="php-quote">'l'</span>] - <span class="php-num">1</span>)];
</span><span id="10674" class="l"><a href="#10674">10674: </a>                    <span class="php-comment">//Set parent and last pointers</span>
</span><span id="10675" class="l"><a href="#10675">10675: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$i</span>][<span class="php-quote">'parent'</span>] = <span class="php-var">$parent</span>;
</span><span id="10676" class="l"><a href="#10676">10676: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$parent</span>][<span class="php-quote">'last'</span>] = <span class="php-var">$i</span>;
</span><span id="10677" class="l"><a href="#10677">10677: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$o</span>[<span class="php-quote">'l'</span>] &gt; <span class="php-var">$level</span>) {
</span><span id="10678" class="l"><a href="#10678">10678: </a>                        <span class="php-comment">//Level increasing: set first pointer</span>
</span><span id="10679" class="l"><a href="#10679">10679: </a>                        <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$parent</span>][<span class="php-quote">'first'</span>] = <span class="php-var">$i</span>;
</span><span id="10680" class="l"><a href="#10680">10680: </a>                    }
</span><span id="10681" class="l"><a href="#10681">10681: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10682" class="l"><a href="#10682">10682: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$i</span>][<span class="php-quote">'parent'</span>] = <span class="php-var">$nb</span>;
</span><span id="10683" class="l"><a href="#10683">10683: </a>                }
</span><span id="10684" class="l"><a href="#10684">10684: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$o</span>[<span class="php-quote">'l'</span>] &lt;= <span class="php-var">$level</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$i</span> &gt; <span class="php-num">0</span>)) {
</span><span id="10685" class="l"><a href="#10685">10685: </a>                    <span class="php-comment">//Set prev and next pointers</span>
</span><span id="10686" class="l"><a href="#10686">10686: </a>                    <span class="php-var">$prev</span> = <span class="php-var">$lru</span>[<span class="php-var">$o</span>[<span class="php-quote">'l'</span>]];
</span><span id="10687" class="l"><a href="#10687">10687: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$prev</span>][<span class="php-quote">'next'</span>] = <span class="php-var">$i</span>;
</span><span id="10688" class="l"><a href="#10688">10688: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$i</span>][<span class="php-quote">'prev'</span>] = <span class="php-var">$prev</span>;
</span><span id="10689" class="l"><a href="#10689">10689: </a>                }
</span><span id="10690" class="l"><a href="#10690">10690: </a>                <span class="php-var">$lru</span>[<span class="php-var">$o</span>[<span class="php-quote">'l'</span>]] = <span class="php-var">$i</span>;
</span><span id="10691" class="l"><a href="#10691">10691: </a>                <span class="php-var">$level</span> = <span class="php-var">$o</span>[<span class="php-quote">'l'</span>];
</span><span id="10692" class="l"><a href="#10692">10692: </a>            }
</span><span id="10693" class="l"><a href="#10693">10693: </a>            <span class="php-comment">//Outline items</span>
</span><span id="10694" class="l"><a href="#10694">10694: </a>            <span class="php-var">$n</span> = <span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>;
</span><span id="10695" class="l"><a href="#10695">10695: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;outlines <span class="php-keyword1">as</span> <span class="php-var">$i</span> =&gt; <span class="php-var">$o</span>) {
</span><span id="10696" class="l"><a href="#10696">10696: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="10697" class="l"><a href="#10697">10697: </a>                <span class="php-comment">// covert HTML title to string</span>
</span><span id="10698" class="l"><a href="#10698">10698: </a>                <span class="php-var">$nltags</span> = <span class="php-quote">'/&lt;br[\s]?\/&gt;|&lt;\/(blockquote|dd|dl|div|dt|h1|h2|h3|h4|h5|h6|hr|li|ol|p|pre|ul|tcpdf|table|tr|td)&gt;/si'</span>;
</span><span id="10699" class="l"><a href="#10699">10699: </a>                <span class="php-var">$title</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-var">$nltags</span>, <span class="php-quote">&quot;\n&quot;</span>, <span class="php-var">$o</span>[<span class="php-quote">'t'</span>]);
</span><span id="10700" class="l"><a href="#10700">10700: </a>                <span class="php-var">$title</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;/[\r]+/si&quot;</span>, <span class="php-quote">''</span>, <span class="php-var">$title</span>);
</span><span id="10701" class="l"><a href="#10701">10701: </a>                <span class="php-var">$title</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;/[\n]+/si&quot;</span>, <span class="php-quote">&quot;\n&quot;</span>, <span class="php-var">$title</span>);
</span><span id="10702" class="l"><a href="#10702">10702: </a>                <span class="php-var">$title</span> = <span class="php-keyword2">strip_tags</span>(<span class="php-keyword2">trim</span>(<span class="php-var">$title</span>));
</span><span id="10703" class="l"><a href="#10703">10703: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;/Title '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$title</span>);
</span><span id="10704" class="l"><a href="#10704">10704: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Parent '</span>.(<span class="php-var">$n</span> + <span class="php-var">$o</span>[<span class="php-quote">'parent'</span>]).<span class="php-quote">' 0 R'</span>;
</span><span id="10705" class="l"><a href="#10705">10705: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$o</span>[<span class="php-quote">'prev'</span>])) {
</span><span id="10706" class="l"><a href="#10706">10706: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Prev '</span>.(<span class="php-var">$n</span> + <span class="php-var">$o</span>[<span class="php-quote">'prev'</span>]).<span class="php-quote">' 0 R'</span>;
</span><span id="10707" class="l"><a href="#10707">10707: </a>                }
</span><span id="10708" class="l"><a href="#10708">10708: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$o</span>[<span class="php-quote">'next'</span>])) {
</span><span id="10709" class="l"><a href="#10709">10709: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Next '</span>.(<span class="php-var">$n</span> + <span class="php-var">$o</span>[<span class="php-quote">'next'</span>]).<span class="php-quote">' 0 R'</span>;
</span><span id="10710" class="l"><a href="#10710">10710: </a>                }
</span><span id="10711" class="l"><a href="#10711">10711: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$o</span>[<span class="php-quote">'first'</span>])) {
</span><span id="10712" class="l"><a href="#10712">10712: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /First '</span>.(<span class="php-var">$n</span> + <span class="php-var">$o</span>[<span class="php-quote">'first'</span>]).<span class="php-quote">' 0 R'</span>;
</span><span id="10713" class="l"><a href="#10713">10713: </a>                }
</span><span id="10714" class="l"><a href="#10714">10714: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$o</span>[<span class="php-quote">'last'</span>])) {
</span><span id="10715" class="l"><a href="#10715">10715: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Last '</span>.(<span class="php-var">$n</span> + <span class="php-var">$o</span>[<span class="php-quote">'last'</span>]).<span class="php-quote">' 0 R'</span>;
</span><span id="10716" class="l"><a href="#10716">10716: </a>                }
</span><span id="10717" class="l"><a href="#10717">10717: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'/Dest [%d 0 R /XYZ 0 %.2F null]'</span>, (<span class="php-num">1</span> + (<span class="php-num">2</span> * <span class="php-var">$o</span>[<span class="php-quote">'p'</span>])), (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$o</span>[<span class="php-quote">'p'</span>]][<span class="php-quote">'h'</span>] - (<span class="php-var">$o</span>[<span class="php-quote">'y'</span>] * <span class="php-var">$this</span>-&gt;k)));
</span><span id="10718" class="l"><a href="#10718">10718: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Count 0 &gt;&gt; endobj'</span>;
</span><span id="10719" class="l"><a href="#10719">10719: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="10720" class="l"><a href="#10720">10720: </a>            }
</span><span id="10721" class="l"><a href="#10721">10721: </a>            <span class="php-comment">//Outline root</span>
</span><span id="10722" class="l"><a href="#10722">10722: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="10723" class="l"><a href="#10723">10723: </a>            <span class="php-var">$this</span>-&gt;OutlineRoot = <span class="php-var">$this</span>-&gt;n;
</span><span id="10724" class="l"><a href="#10724">10724: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'&lt;&lt; /Type /Outlines /First '</span>.<span class="php-var">$n</span>.<span class="php-quote">' 0 R /Last '</span>.(<span class="php-var">$n</span> + <span class="php-var">$lru</span>[<span class="php-num">0</span>]).<span class="php-quote">' 0 R &gt;&gt; endobj'</span>);
</span><span id="10725" class="l"><a href="#10725">10725: </a>        }
</span><span id="10726" class="l"><a href="#10726">10726: </a>
</span><span id="10727" class="l"><a href="#10727">10727: </a>        <span class="php-comment">// --- JAVASCRIPT ------------------------------------------------------</span>
</span><span id="10728" class="l"><a href="#10728">10728: </a>
</span><span id="10729" class="l"><a href="#10729">10729: </a>        <span class="php-comment">/**
</span></span><span id="10730" class="l"><a href="#10730">10730: </a><span class="php-comment">         * Adds a javascript
</span></span><span id="10731" class="l"><a href="#10731">10731: </a><span class="php-comment">         * @param string $script Javascript code
</span></span><span id="10732" class="l"><a href="#10732">10732: </a><span class="php-comment">         * @access public
</span></span><span id="10733" class="l"><a href="#10733">10733: </a><span class="php-comment">        
</span></span><span id="10734" class="l"><a href="#10734">10734: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="10735" class="l"><a href="#10735">10735: </a><span class="php-comment">         */</span>
</span><span id="10736" class="l"><a href="#10736">10736: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> IncludeJS(<span class="php-var">$script</span>) {
</span><span id="10737" class="l"><a href="#10737">10737: </a>            <span class="php-var">$this</span>-&gt;javascript .= <span class="php-var">$script</span>;
</span><span id="10738" class="l"><a href="#10738">10738: </a>        }
</span><span id="10739" class="l"><a href="#10739">10739: </a>
</span><span id="10740" class="l"><a href="#10740">10740: </a>        <span class="php-comment">/**
</span></span><span id="10741" class="l"><a href="#10741">10741: </a><span class="php-comment">         * Adds a javascript object and return object ID
</span></span><span id="10742" class="l"><a href="#10742">10742: </a><span class="php-comment">         * @param string $script Javascript code
</span></span><span id="10743" class="l"><a href="#10743">10743: </a><span class="php-comment">         * @param boolean $onload if true executes this object when opening the document
</span></span><span id="10744" class="l"><a href="#10744">10744: </a><span class="php-comment">         * @return int internal object ID
</span></span><span id="10745" class="l"><a href="#10745">10745: </a><span class="php-comment">         * @access public
</span></span><span id="10746" class="l"><a href="#10746">10746: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="10747" class="l"><a href="#10747">10747: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="10748" class="l"><a href="#10748">10748: </a><span class="php-comment">         */</span>
</span><span id="10749" class="l"><a href="#10749">10749: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> addJavascriptObject(<span class="php-var">$script</span>, <span class="php-var">$onload</span>=<span class="php-keyword1">false</span>) {
</span><span id="10750" class="l"><a href="#10750">10750: </a>            ++<span class="php-var">$this</span>-&gt;js_obj_id;
</span><span id="10751" class="l"><a href="#10751">10751: </a>            <span class="php-var">$this</span>-&gt;js_objects[<span class="php-var">$this</span>-&gt;js_obj_id] = <span class="php-keyword1">array</span>(<span class="php-quote">'js'</span> =&gt; <span class="php-var">$script</span>, <span class="php-quote">'onload'</span> =&gt; <span class="php-var">$onload</span>);
</span><span id="10752" class="l"><a href="#10752">10752: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;js_obj_id;
</span><span id="10753" class="l"><a href="#10753">10753: </a>        }
</span><span id="10754" class="l"><a href="#10754">10754: </a>
</span><span id="10755" class="l"><a href="#10755">10755: </a>        <span class="php-comment">/**
</span></span><span id="10756" class="l"><a href="#10756">10756: </a><span class="php-comment">         * Create a javascript PDF string.
</span></span><span id="10757" class="l"><a href="#10757">10757: </a><span class="php-comment">         * @access protected
</span></span><span id="10758" class="l"><a href="#10758">10758: </a><span class="php-comment">        
</span></span><span id="10759" class="l"><a href="#10759">10759: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="10760" class="l"><a href="#10760">10760: </a><span class="php-comment">         */</span>
</span><span id="10761" class="l"><a href="#10761">10761: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putjavascript() {
</span><span id="10762" class="l"><a href="#10762">10762: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;javascript) <span class="php-keyword1">AND</span> <span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;js_objects)) {
</span><span id="10763" class="l"><a href="#10763">10763: </a>                <span class="php-keyword1">return</span>;
</span><span id="10764" class="l"><a href="#10764">10764: </a>            }
</span><span id="10765" class="l"><a href="#10765">10765: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$this</span>-&gt;javascript, <span class="php-quote">'this.addField'</span>) &gt; <span class="php-num">0</span>) {
</span><span id="10766" class="l"><a href="#10766">10766: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;ur) {
</span><span id="10767" class="l"><a href="#10767">10767: </a>                    <span class="php-comment">//$this-&gt;setUserRights();</span>
</span><span id="10768" class="l"><a href="#10768">10768: </a>                }
</span><span id="10769" class="l"><a href="#10769">10769: </a>                <span class="php-comment">// the following two lines are used to avoid form fields duplication after saving</span>
</span><span id="10770" class="l"><a href="#10770">10770: </a>                <span class="php-comment">// The addField method only works on Acrobat Writer, unless the document is signed with Adobe private key (UR3)</span>
</span><span id="10771" class="l"><a href="#10771">10771: </a>                <span class="php-var">$jsa</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">&quot;ftcpdfdocsaved=this.addField('%s','%s',%d,[%.2F,%.2F,%.2F,%.2F]);&quot;</span>, <span class="php-quote">'tcpdfdocsaved'</span>, <span class="php-quote">'text'</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">1</span>);
</span><span id="10772" class="l"><a href="#10772">10772: </a>                <span class="php-var">$jsb</span> = <span class="php-quote">&quot;getField('tcpdfdocsaved').value='saved';&quot;</span>;
</span><span id="10773" class="l"><a href="#10773">10773: </a>                <span class="php-var">$this</span>-&gt;javascript = <span class="php-var">$jsa</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$this</span>-&gt;javascript.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$jsb</span>;
</span><span id="10774" class="l"><a href="#10774">10774: </a>            }
</span><span id="10775" class="l"><a href="#10775">10775: </a>            <span class="php-var">$this</span>-&gt;n_js = <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="10776" class="l"><a href="#10776">10776: </a>            <span class="php-var">$out</span> = <span class="php-quote">' &lt;&lt; /Names ['</span>;
</span><span id="10777" class="l"><a href="#10777">10777: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;javascript)) {
</span><span id="10778" class="l"><a href="#10778">10778: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' (EmbeddedJS) '</span>.(<span class="php-var">$this</span>-&gt;n + <span class="php-num">1</span>).<span class="php-quote">' 0 R'</span>;
</span><span id="10779" class="l"><a href="#10779">10779: </a>            }
</span><span id="10780" class="l"><a href="#10780">10780: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;js_objects)) {
</span><span id="10781" class="l"><a href="#10781">10781: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;js_objects <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="10782" class="l"><a href="#10782">10782: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$val</span>[<span class="php-quote">'onload'</span>]) {
</span><span id="10783" class="l"><a href="#10783">10783: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' (JS'</span>.<span class="php-var">$key</span>.<span class="php-quote">') '</span>.<span class="php-var">$key</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="10784" class="l"><a href="#10784">10784: </a>                    }
</span><span id="10785" class="l"><a href="#10785">10785: </a>                }
</span><span id="10786" class="l"><a href="#10786">10786: </a>            }
</span><span id="10787" class="l"><a href="#10787">10787: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' ] &gt;&gt; endobj'</span>;
</span><span id="10788" class="l"><a href="#10788">10788: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="10789" class="l"><a href="#10789">10789: </a>            <span class="php-comment">// default Javascript object</span>
</span><span id="10790" class="l"><a href="#10790">10790: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;javascript)) {
</span><span id="10791" class="l"><a href="#10791">10791: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="10792" class="l"><a href="#10792">10792: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /S /JavaScript'</span>;
</span><span id="10793" class="l"><a href="#10793">10793: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /JS '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;javascript);
</span><span id="10794" class="l"><a href="#10794">10794: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="10795" class="l"><a href="#10795">10795: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="10796" class="l"><a href="#10796">10796: </a>            }
</span><span id="10797" class="l"><a href="#10797">10797: </a>            <span class="php-comment">// additional Javascript objects</span>
</span><span id="10798" class="l"><a href="#10798">10798: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;js_objects)) {
</span><span id="10799" class="l"><a href="#10799">10799: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;js_objects <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="10800" class="l"><a href="#10800">10800: </a>                    <span class="php-var">$this</span>-&gt;offsets[<span class="php-var">$key</span>] = <span class="php-var">$this</span>-&gt;bufferlen;
</span><span id="10801" class="l"><a href="#10801">10801: </a>                    <span class="php-var">$out</span> = <span class="php-var">$key</span>.<span class="php-quote">' 0 obj'</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-quote">' &lt;&lt; /S /JavaScript /JS '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$val</span>[<span class="php-quote">'js'</span>]).<span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="10802" class="l"><a href="#10802">10802: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="10803" class="l"><a href="#10803">10803: </a>                }
</span><span id="10804" class="l"><a href="#10804">10804: </a>            }
</span><span id="10805" class="l"><a href="#10805">10805: </a>        }
</span><span id="10806" class="l"><a href="#10806">10806: </a>
</span><span id="10807" class="l"><a href="#10807">10807: </a>        <span class="php-comment">/**
</span></span><span id="10808" class="l"><a href="#10808">10808: </a><span class="php-comment">         * Convert color to javascript color.
</span></span><span id="10809" class="l"><a href="#10809">10809: </a><span class="php-comment">         * @param string $color color name or #RRGGBB
</span></span><span id="10810" class="l"><a href="#10810">10810: </a><span class="php-comment">         * @access protected
</span></span><span id="10811" class="l"><a href="#10811">10811: </a><span class="php-comment">         * @author Denis Van Nuffelen, Nicola Asuni
</span></span><span id="10812" class="l"><a href="#10812">10812: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="10813" class="l"><a href="#10813">10813: </a><span class="php-comment">         */</span>
</span><span id="10814" class="l"><a href="#10814">10814: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _JScolor(<span class="php-var">$color</span>) {
</span><span id="10815" class="l"><a href="#10815">10815: </a>            <span class="php-keyword1">static</span> <span class="php-var">$aColors</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'transparent'</span>, <span class="php-quote">'black'</span>, <span class="php-quote">'white'</span>, <span class="php-quote">'red'</span>, <span class="php-quote">'green'</span>, <span class="php-quote">'blue'</span>, <span class="php-quote">'cyan'</span>, <span class="php-quote">'magenta'</span>, <span class="php-quote">'yellow'</span>, <span class="php-quote">'dkGray'</span>, <span class="php-quote">'gray'</span>, <span class="php-quote">'ltGray'</span>);
</span><span id="10816" class="l"><a href="#10816">10816: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$color</span>,<span class="php-num">0</span>,<span class="php-num">1</span>) == <span class="php-quote">'#'</span>) {
</span><span id="10817" class="l"><a href="#10817">10817: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">sprintf</span>(<span class="php-quote">&quot;['RGB',%.3F,%.3F,%.3F]&quot;</span>, <span class="php-keyword2">hexdec</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$color</span>,<span class="php-num">1</span>,<span class="php-num">2</span>))/<span class="php-num">255</span>, <span class="php-keyword2">hexdec</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$color</span>,<span class="php-num">3</span>,<span class="php-num">2</span>))/<span class="php-num">255</span>, <span class="php-keyword2">hexdec</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$color</span>,<span class="php-num">5</span>,<span class="php-num">2</span>))/<span class="php-num">255</span>);
</span><span id="10818" class="l"><a href="#10818">10818: </a>            }
</span><span id="10819" class="l"><a href="#10819">10819: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$color</span>,<span class="php-var">$aColors</span>)) {
</span><span id="10820" class="l"><a href="#10820">10820: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Invalid color: '</span>.<span class="php-var">$color</span>);
</span><span id="10821" class="l"><a href="#10821">10821: </a>            }
</span><span id="10822" class="l"><a href="#10822">10822: </a>            <span class="php-keyword1">return</span> <span class="php-quote">'color.'</span>.<span class="php-var">$color</span>;
</span><span id="10823" class="l"><a href="#10823">10823: </a>        }
</span><span id="10824" class="l"><a href="#10824">10824: </a>
</span><span id="10825" class="l"><a href="#10825">10825: </a>        <span class="php-comment">/**
</span></span><span id="10826" class="l"><a href="#10826">10826: </a><span class="php-comment">         * Adds a javascript form field.
</span></span><span id="10827" class="l"><a href="#10827">10827: </a><span class="php-comment">         * @param string $type field type
</span></span><span id="10828" class="l"><a href="#10828">10828: </a><span class="php-comment">         * @param string $name field name
</span></span><span id="10829" class="l"><a href="#10829">10829: </a><span class="php-comment">         * @param int $x horizontal position
</span></span><span id="10830" class="l"><a href="#10830">10830: </a><span class="php-comment">         * @param int $y vertical position
</span></span><span id="10831" class="l"><a href="#10831">10831: </a><span class="php-comment">         * @param int $w width
</span></span><span id="10832" class="l"><a href="#10832">10832: </a><span class="php-comment">         * @param int $h height
</span></span><span id="10833" class="l"><a href="#10833">10833: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="10834" class="l"><a href="#10834">10834: </a><span class="php-comment">         * @access protected
</span></span><span id="10835" class="l"><a href="#10835">10835: </a><span class="php-comment">         * @author Denis Van Nuffelen, Nicola Asuni
</span></span><span id="10836" class="l"><a href="#10836">10836: </a><span class="php-comment">         * @since 2.1.002 (2008-02-12)
</span></span><span id="10837" class="l"><a href="#10837">10837: </a><span class="php-comment">         */</span>
</span><span id="10838" class="l"><a href="#10838">10838: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _addfield(<span class="php-var">$type</span>, <span class="php-var">$name</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>) {
</span><span id="10839" class="l"><a href="#10839">10839: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="10840" class="l"><a href="#10840">10840: </a>                <span class="php-var">$x</span> = <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="10841" class="l"><a href="#10841">10841: </a>            }
</span><span id="10842" class="l"><a href="#10842">10842: </a>            <span class="php-comment">// the followind avoid fields duplication after saving the document</span>
</span><span id="10843" class="l"><a href="#10843">10843: </a>            <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">&quot;if(getField('tcpdfdocsaved').value != 'saved') {&quot;</span>;
</span><span id="10844" class="l"><a href="#10844">10844: </a>            <span class="php-var">$k</span> = <span class="php-var">$this</span>-&gt;k;
</span><span id="10845" class="l"><a href="#10845">10845: </a>            <span class="php-var">$this</span>-&gt;javascript .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">&quot;f&quot;</span>.<span class="php-var">$name</span>.<span class="php-quote">&quot;=this.addField('%s','%s',%d,[%.2F,%.2F,%.2F,%.2F]);&quot;</span>, <span class="php-var">$name</span>, <span class="php-var">$type</span>, <span class="php-var">$this</span>-&gt;PageNo()-<span class="php-num">1</span>, <span class="php-var">$x</span>*<span class="php-var">$k</span>, (<span class="php-var">$this</span>-&gt;h-<span class="php-var">$y</span>)*<span class="php-var">$k</span>+<span class="php-num">1</span>, (<span class="php-var">$x</span>+<span class="php-var">$w</span>)*<span class="php-var">$k</span>, (<span class="php-var">$this</span>-&gt;h-<span class="php-var">$y</span>-<span class="php-var">$h</span>)*<span class="php-var">$k</span>+<span class="php-num">1</span>).<span class="php-quote">&quot;\n&quot;</span>;
</span><span id="10846" class="l"><a href="#10846">10846: </a>            <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">'.textSize='</span>.<span class="php-var">$this</span>-&gt;FontSizePt.<span class="php-quote">&quot;;\n&quot;</span>;
</span><span id="10847" class="l"><a href="#10847">10847: </a>            <span class="php-keyword1">while</span> (<span class="php-keyword1">list</span>(<span class="php-var">$key</span>, <span class="php-var">$val</span>) = <span class="php-keyword2">each</span>(<span class="php-var">$prop</span>)) {
</span><span id="10848" class="l"><a href="#10848">10848: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strcmp</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$key</span>, -<span class="php-num">5</span>), <span class="php-quote">'Color'</span>) == <span class="php-num">0</span>) {
</span><span id="10849" class="l"><a href="#10849">10849: </a>                    <span class="php-var">$val</span> = <span class="php-var">$this</span>-&gt;_JScolor(<span class="php-var">$val</span>);
</span><span id="10850" class="l"><a href="#10850">10850: </a>                } <span class="php-keyword1">else</span> {
</span><span id="10851" class="l"><a href="#10851">10851: </a>                    <span class="php-var">$val</span> = <span class="php-quote">&quot;'&quot;</span>.<span class="php-var">$val</span>.<span class="php-quote">&quot;'&quot;</span>;
</span><span id="10852" class="l"><a href="#10852">10852: </a>                }
</span><span id="10853" class="l"><a href="#10853">10853: </a>                <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">'.'</span>.<span class="php-var">$key</span>.<span class="php-quote">'='</span>.<span class="php-var">$val</span>.<span class="php-quote">&quot;;\n&quot;</span>;
</span><span id="10854" class="l"><a href="#10854">10854: </a>            }
</span><span id="10855" class="l"><a href="#10855">10855: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="10856" class="l"><a href="#10856">10856: </a>                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="10857" class="l"><a href="#10857">10857: </a>            } <span class="php-keyword1">else</span> {
</span><span id="10858" class="l"><a href="#10858">10858: </a>                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="10859" class="l"><a href="#10859">10859: </a>            }
</span><span id="10860" class="l"><a href="#10860">10860: </a>            <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'}'</span>;
</span><span id="10861" class="l"><a href="#10861">10861: </a>        }
</span><span id="10862" class="l"><a href="#10862">10862: </a>
</span><span id="10863" class="l"><a href="#10863">10863: </a>        <span class="php-comment">// --- FORM FIELDS -----------------------------------------------------</span>
</span><span id="10864" class="l"><a href="#10864">10864: </a>
</span><span id="10865" class="l"><a href="#10865">10865: </a>        <span class="php-comment">/**
</span></span><span id="10866" class="l"><a href="#10866">10866: </a><span class="php-comment">         * Convert JavaScript form fields properties array to Annotation Properties array.
</span></span><span id="10867" class="l"><a href="#10867">10867: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="10868" class="l"><a href="#10868">10868: </a><span class="php-comment">         * @return array of annotation properties
</span></span><span id="10869" class="l"><a href="#10869">10869: </a><span class="php-comment">         * @access protected
</span></span><span id="10870" class="l"><a href="#10870">10870: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="10871" class="l"><a href="#10871">10871: </a><span class="php-comment">         * @since 4.8.000 (2009-09-06)
</span></span><span id="10872" class="l"><a href="#10872">10872: </a><span class="php-comment">         */</span>
</span><span id="10873" class="l"><a href="#10873">10873: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getAnnotOptFromJSProp(<span class="php-var">$prop</span>) {
</span><span id="10874" class="l"><a href="#10874">10874: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'aopt'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$prop</span>[<span class="php-quote">'aopt'</span>])) {
</span><span id="10875" class="l"><a href="#10875">10875: </a>                <span class="php-comment">// the annotation options area lready defined</span>
</span><span id="10876" class="l"><a href="#10876">10876: </a>                <span class="php-keyword1">return</span> <span class="php-var">$prop</span>[<span class="php-quote">'aopt'</span>];
</span><span id="10877" class="l"><a href="#10877">10877: </a>            }
</span><span id="10878" class="l"><a href="#10878">10878: </a>            <span class="php-var">$opt</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// value to be returned</span>
</span><span id="10879" class="l"><a href="#10879">10879: </a>            <span class="php-comment">// alignment: Controls how the text is laid out within the text field.</span>
</span><span id="10880" class="l"><a href="#10880">10880: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'alignment'</span>])) {
</span><span id="10881" class="l"><a href="#10881">10881: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$prop</span>[<span class="php-quote">'alignment'</span>]) {
</span><span id="10882" class="l"><a href="#10882">10882: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'left'</span>: {
</span><span id="10883" class="l"><a href="#10883">10883: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'q'</span>] = <span class="php-num">0</span>;
</span><span id="10884" class="l"><a href="#10884">10884: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10885" class="l"><a href="#10885">10885: </a>                    }
</span><span id="10886" class="l"><a href="#10886">10886: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'center'</span>: {
</span><span id="10887" class="l"><a href="#10887">10887: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'q'</span>] = <span class="php-num">1</span>;
</span><span id="10888" class="l"><a href="#10888">10888: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10889" class="l"><a href="#10889">10889: </a>                    }
</span><span id="10890" class="l"><a href="#10890">10890: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'right'</span>: {
</span><span id="10891" class="l"><a href="#10891">10891: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'q'</span>] = <span class="php-num">2</span>;
</span><span id="10892" class="l"><a href="#10892">10892: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10893" class="l"><a href="#10893">10893: </a>                    }
</span><span id="10894" class="l"><a href="#10894">10894: </a>                    <span class="php-keyword1">default</span>: {
</span><span id="10895" class="l"><a href="#10895">10895: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'q'</span>] = (<span class="php-var">$this</span>-&gt;rtl)?<span class="php-num">2</span>:<span class="php-num">0</span>;
</span><span id="10896" class="l"><a href="#10896">10896: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10897" class="l"><a href="#10897">10897: </a>                    }
</span><span id="10898" class="l"><a href="#10898">10898: </a>                }
</span><span id="10899" class="l"><a href="#10899">10899: </a>            }
</span><span id="10900" class="l"><a href="#10900">10900: </a>            <span class="php-comment">// lineWidth: Specifies the thickness of the border when stroking the perimeter of a field's rectangle.</span>
</span><span id="10901" class="l"><a href="#10901">10901: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'lineWidth'</span>])) {
</span><span id="10902" class="l"><a href="#10902">10902: </a>                <span class="php-var">$linewidth</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$prop</span>[<span class="php-quote">'lineWidth'</span>]);
</span><span id="10903" class="l"><a href="#10903">10903: </a>            } <span class="php-keyword1">else</span> {
</span><span id="10904" class="l"><a href="#10904">10904: </a>                <span class="php-var">$linewidth</span> = <span class="php-num">1</span>;
</span><span id="10905" class="l"><a href="#10905">10905: </a>            }
</span><span id="10906" class="l"><a href="#10906">10906: </a>            <span class="php-comment">// borderStyle: The border style for a field.</span>
</span><span id="10907" class="l"><a href="#10907">10907: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'borderStyle'</span>])) {
</span><span id="10908" class="l"><a href="#10908">10908: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$prop</span>[<span class="php-quote">'borderStyle'</span>]) {
</span><span id="10909" class="l"><a href="#10909">10909: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'border.d'</span>:
</span><span id="10910" class="l"><a href="#10910">10910: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'dashed'</span>: {
</span><span id="10911" class="l"><a href="#10911">10911: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$linewidth</span>, <span class="php-keyword1">array</span>(<span class="php-num">3</span>, <span class="php-num">2</span>));
</span><span id="10912" class="l"><a href="#10912">10912: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'bs'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span>=&gt;<span class="php-var">$linewidth</span>, <span class="php-quote">'s'</span>=&gt;<span class="php-quote">'D'</span>, <span class="php-quote">'d'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">3</span>, <span class="php-num">2</span>));
</span><span id="10913" class="l"><a href="#10913">10913: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10914" class="l"><a href="#10914">10914: </a>                    }
</span><span id="10915" class="l"><a href="#10915">10915: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'border.b'</span>:
</span><span id="10916" class="l"><a href="#10916">10916: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'beveled'</span>: {
</span><span id="10917" class="l"><a href="#10917">10917: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$linewidth</span>);
</span><span id="10918" class="l"><a href="#10918">10918: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'bs'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span>=&gt;<span class="php-var">$linewidth</span>, <span class="php-quote">'s'</span>=&gt;<span class="php-quote">'B'</span>);
</span><span id="10919" class="l"><a href="#10919">10919: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10920" class="l"><a href="#10920">10920: </a>                    }
</span><span id="10921" class="l"><a href="#10921">10921: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'border.i'</span>:
</span><span id="10922" class="l"><a href="#10922">10922: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'inset'</span>: {
</span><span id="10923" class="l"><a href="#10923">10923: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$linewidth</span>);
</span><span id="10924" class="l"><a href="#10924">10924: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'bs'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span>=&gt;<span class="php-var">$linewidth</span>, <span class="php-quote">'s'</span>=&gt;<span class="php-quote">'I'</span>);
</span><span id="10925" class="l"><a href="#10925">10925: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10926" class="l"><a href="#10926">10926: </a>                    }
</span><span id="10927" class="l"><a href="#10927">10927: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'border.u'</span>:
</span><span id="10928" class="l"><a href="#10928">10928: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'underline'</span>: {
</span><span id="10929" class="l"><a href="#10929">10929: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$linewidth</span>);
</span><span id="10930" class="l"><a href="#10930">10930: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'bs'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span>=&gt;<span class="php-var">$linewidth</span>, <span class="php-quote">'s'</span>=&gt;<span class="php-quote">'U'</span>);
</span><span id="10931" class="l"><a href="#10931">10931: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10932" class="l"><a href="#10932">10932: </a>                    }
</span><span id="10933" class="l"><a href="#10933">10933: </a>                    <span class="php-keyword1">default</span>:
</span><span id="10934" class="l"><a href="#10934">10934: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'border.s'</span>:
</span><span id="10935" class="l"><a href="#10935">10935: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'solid'</span>: {
</span><span id="10936" class="l"><a href="#10936">10936: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$linewidth</span>);
</span><span id="10937" class="l"><a href="#10937">10937: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'bs'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span>=&gt;<span class="php-var">$linewidth</span>, <span class="php-quote">'s'</span>=&gt;<span class="php-quote">'S'</span>);
</span><span id="10938" class="l"><a href="#10938">10938: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10939" class="l"><a href="#10939">10939: </a>                    }
</span><span id="10940" class="l"><a href="#10940">10940: </a>                }
</span><span id="10941" class="l"><a href="#10941">10941: </a>            }
</span><span id="10942" class="l"><a href="#10942">10942: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'border'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$prop</span>[<span class="php-quote">'border'</span>])) {
</span><span id="10943" class="l"><a href="#10943">10943: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'border'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'border'</span>];
</span><span id="10944" class="l"><a href="#10944">10944: </a>            }
</span><span id="10945" class="l"><a href="#10945">10945: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>])) {
</span><span id="10946" class="l"><a href="#10946">10946: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>] = <span class="php-keyword1">array</span>();
</span><span id="10947" class="l"><a href="#10947">10947: </a>            }
</span><span id="10948" class="l"><a href="#10948">10948: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>])) {
</span><span id="10949" class="l"><a href="#10949">10949: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>] = <span class="php-keyword1">array</span>();
</span><span id="10950" class="l"><a href="#10950">10950: </a>            }
</span><span id="10951" class="l"><a href="#10951">10951: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0.5</span>, <span class="php-num">0.5</span>);
</span><span id="10952" class="l"><a href="#10952">10952: </a>            <span class="php-comment">// buttonAlignX: Controls how space is distributed from the left of the button face with respect to the icon.</span>
</span><span id="10953" class="l"><a href="#10953">10953: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'buttonAlignX'</span>])) {
</span><span id="10954" class="l"><a href="#10954">10954: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>][<span class="php-num">0</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'buttonAlignX'</span>];
</span><span id="10955" class="l"><a href="#10955">10955: </a>            }
</span><span id="10956" class="l"><a href="#10956">10956: </a>            <span class="php-comment">// buttonAlignY: Controls how unused space is distributed from the bottom of the button face with respect to the icon.</span>
</span><span id="10957" class="l"><a href="#10957">10957: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'buttonAlignY'</span>])) {
</span><span id="10958" class="l"><a href="#10958">10958: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'a'</span>][<span class="php-num">1</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'buttonAlignY'</span>];
</span><span id="10959" class="l"><a href="#10959">10959: </a>            }
</span><span id="10960" class="l"><a href="#10960">10960: </a>            <span class="php-comment">// buttonFitBounds: If true, the extent to which the icon may be scaled is set to the bounds of the button field.</span>
</span><span id="10961" class="l"><a href="#10961">10961: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'buttonFitBounds'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'buttonFitBounds'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="10962" class="l"><a href="#10962">10962: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'fb'</span>] = <span class="php-keyword1">true</span>;
</span><span id="10963" class="l"><a href="#10963">10963: </a>            }
</span><span id="10964" class="l"><a href="#10964">10964: </a>            <span class="php-comment">// buttonScaleHow: Controls how the icon is scaled (if necessary) to fit inside the button face.</span>
</span><span id="10965" class="l"><a href="#10965">10965: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'buttonScaleHow'</span>])) {
</span><span id="10966" class="l"><a href="#10966">10966: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$prop</span>[<span class="php-quote">'buttonScaleHow'</span>]) {
</span><span id="10967" class="l"><a href="#10967">10967: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'scaleHow.proportional'</span>: {
</span><span id="10968" class="l"><a href="#10968">10968: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'s'</span>] = <span class="php-quote">'P'</span>;
</span><span id="10969" class="l"><a href="#10969">10969: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10970" class="l"><a href="#10970">10970: </a>                    }
</span><span id="10971" class="l"><a href="#10971">10971: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'scaleHow.anamorphic'</span>: {
</span><span id="10972" class="l"><a href="#10972">10972: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'s'</span>] = <span class="php-quote">'A'</span>;
</span><span id="10973" class="l"><a href="#10973">10973: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10974" class="l"><a href="#10974">10974: </a>                    }
</span><span id="10975" class="l"><a href="#10975">10975: </a>                }
</span><span id="10976" class="l"><a href="#10976">10976: </a>            }
</span><span id="10977" class="l"><a href="#10977">10977: </a>            <span class="php-comment">// buttonScaleWhen: Controls when an icon is scaled to fit inside the button face.</span>
</span><span id="10978" class="l"><a href="#10978">10978: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'buttonScaleWhen'</span>])) {
</span><span id="10979" class="l"><a href="#10979">10979: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$prop</span>[<span class="php-quote">'buttonScaleWhen'</span>]) {
</span><span id="10980" class="l"><a href="#10980">10980: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'scaleWhen.always'</span>: {
</span><span id="10981" class="l"><a href="#10981">10981: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'sw'</span>] = <span class="php-quote">'A'</span>;
</span><span id="10982" class="l"><a href="#10982">10982: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10983" class="l"><a href="#10983">10983: </a>                    }
</span><span id="10984" class="l"><a href="#10984">10984: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'scaleWhen.never'</span>: {
</span><span id="10985" class="l"><a href="#10985">10985: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'sw'</span>] = <span class="php-quote">'N'</span>;
</span><span id="10986" class="l"><a href="#10986">10986: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10987" class="l"><a href="#10987">10987: </a>                    }
</span><span id="10988" class="l"><a href="#10988">10988: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'scaleWhen.tooBig'</span>: {
</span><span id="10989" class="l"><a href="#10989">10989: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'sw'</span>] = <span class="php-quote">'B'</span>;
</span><span id="10990" class="l"><a href="#10990">10990: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10991" class="l"><a href="#10991">10991: </a>                    }
</span><span id="10992" class="l"><a href="#10992">10992: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'scaleWhen.tooSmall'</span>: {
</span><span id="10993" class="l"><a href="#10993">10993: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'if'</span>][<span class="php-quote">'sw'</span>] = <span class="php-quote">'S'</span>;
</span><span id="10994" class="l"><a href="#10994">10994: </a>                        <span class="php-keyword1">break</span>;
</span><span id="10995" class="l"><a href="#10995">10995: </a>                    }
</span><span id="10996" class="l"><a href="#10996">10996: </a>                }
</span><span id="10997" class="l"><a href="#10997">10997: </a>            }
</span><span id="10998" class="l"><a href="#10998">10998: </a>            <span class="php-comment">// buttonPosition: Controls how the text and the icon of the button are positioned with respect to each other within the button face.</span>
</span><span id="10999" class="l"><a href="#10999">10999: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'buttonPosition'</span>])) {
</span><span id="11000" class="l"><a href="#11000">11000: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$prop</span>[<span class="php-quote">'buttonPosition'</span>]) {
</span><span id="11001" class="l"><a href="#11001">11001: </a>                    <span class="php-keyword1">case</span> <span class="php-num">0</span>:
</span><span id="11002" class="l"><a href="#11002">11002: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'position.textOnly'</span>: {
</span><span id="11003" class="l"><a href="#11003">11003: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] = <span class="php-num">0</span>;
</span><span id="11004" class="l"><a href="#11004">11004: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11005" class="l"><a href="#11005">11005: </a>                    }
</span><span id="11006" class="l"><a href="#11006">11006: </a>                    <span class="php-keyword1">case</span> <span class="php-num">1</span>:
</span><span id="11007" class="l"><a href="#11007">11007: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'position.iconOnly'</span>: {
</span><span id="11008" class="l"><a href="#11008">11008: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] = <span class="php-num">1</span>;
</span><span id="11009" class="l"><a href="#11009">11009: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11010" class="l"><a href="#11010">11010: </a>                    }
</span><span id="11011" class="l"><a href="#11011">11011: </a>                    <span class="php-keyword1">case</span> <span class="php-num">2</span>:
</span><span id="11012" class="l"><a href="#11012">11012: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'position.iconTextV'</span>: {
</span><span id="11013" class="l"><a href="#11013">11013: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] = <span class="php-num">2</span>;
</span><span id="11014" class="l"><a href="#11014">11014: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11015" class="l"><a href="#11015">11015: </a>                    }
</span><span id="11016" class="l"><a href="#11016">11016: </a>                    <span class="php-keyword1">case</span> <span class="php-num">3</span>:
</span><span id="11017" class="l"><a href="#11017">11017: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'position.textIconV'</span>: {
</span><span id="11018" class="l"><a href="#11018">11018: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] = <span class="php-num">3</span>;
</span><span id="11019" class="l"><a href="#11019">11019: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11020" class="l"><a href="#11020">11020: </a>                    }
</span><span id="11021" class="l"><a href="#11021">11021: </a>                    <span class="php-keyword1">case</span> <span class="php-num">4</span>:
</span><span id="11022" class="l"><a href="#11022">11022: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'position.iconTextH'</span>: {
</span><span id="11023" class="l"><a href="#11023">11023: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] = <span class="php-num">4</span>;
</span><span id="11024" class="l"><a href="#11024">11024: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11025" class="l"><a href="#11025">11025: </a>                    }
</span><span id="11026" class="l"><a href="#11026">11026: </a>                    <span class="php-keyword1">case</span> <span class="php-num">5</span>:
</span><span id="11027" class="l"><a href="#11027">11027: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'position.textIconH'</span>: {
</span><span id="11028" class="l"><a href="#11028">11028: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] = <span class="php-num">5</span>;
</span><span id="11029" class="l"><a href="#11029">11029: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11030" class="l"><a href="#11030">11030: </a>                    }
</span><span id="11031" class="l"><a href="#11031">11031: </a>                    <span class="php-keyword1">case</span> <span class="php-num">6</span>:
</span><span id="11032" class="l"><a href="#11032">11032: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'position.overlay'</span>: {
</span><span id="11033" class="l"><a href="#11033">11033: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'tp'</span>] = <span class="php-num">6</span>;
</span><span id="11034" class="l"><a href="#11034">11034: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11035" class="l"><a href="#11035">11035: </a>                    }
</span><span id="11036" class="l"><a href="#11036">11036: </a>                }
</span><span id="11037" class="l"><a href="#11037">11037: </a>            }
</span><span id="11038" class="l"><a href="#11038">11038: </a>            <span class="php-comment">// fillColor: Specifies the background color for a field.</span>
</span><span id="11039" class="l"><a href="#11039">11039: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'fillColor'</span>])) {
</span><span id="11040" class="l"><a href="#11040">11040: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$prop</span>[<span class="php-quote">'fillColor'</span>])) {
</span><span id="11041" class="l"><a href="#11041">11041: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'bg'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'fillColor'</span>];
</span><span id="11042" class="l"><a href="#11042">11042: </a>                } <span class="php-keyword1">else</span> {
</span><span id="11043" class="l"><a href="#11043">11043: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'bg'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$prop</span>[<span class="php-quote">'fillColor'</span>]);
</span><span id="11044" class="l"><a href="#11044">11044: </a>                }
</span><span id="11045" class="l"><a href="#11045">11045: </a>            }
</span><span id="11046" class="l"><a href="#11046">11046: </a>            <span class="php-comment">// strokeColor: Specifies the stroke color for a field that is used to stroke the rectangle of the field with a line as large as the line width.</span>
</span><span id="11047" class="l"><a href="#11047">11047: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'strokeColor'</span>])) {
</span><span id="11048" class="l"><a href="#11048">11048: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$prop</span>[<span class="php-quote">'strokeColor'</span>])) {
</span><span id="11049" class="l"><a href="#11049">11049: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'bc'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'strokeColor'</span>];
</span><span id="11050" class="l"><a href="#11050">11050: </a>                } <span class="php-keyword1">else</span> {
</span><span id="11051" class="l"><a href="#11051">11051: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'bc'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$prop</span>[<span class="php-quote">'strokeColor'</span>]);
</span><span id="11052" class="l"><a href="#11052">11052: </a>                }
</span><span id="11053" class="l"><a href="#11053">11053: </a>            }
</span><span id="11054" class="l"><a href="#11054">11054: </a>            <span class="php-comment">// rotation: The rotation of a widget in counterclockwise increments.</span>
</span><span id="11055" class="l"><a href="#11055">11055: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'rotation'</span>])) {
</span><span id="11056" class="l"><a href="#11056">11056: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'r'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'rotation'</span>];
</span><span id="11057" class="l"><a href="#11057">11057: </a>            }
</span><span id="11058" class="l"><a href="#11058">11058: </a>            <span class="php-comment">// charLimit: Limits the number of characters that a user can type into a text field.</span>
</span><span id="11059" class="l"><a href="#11059">11059: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'charLimit'</span>])) {
</span><span id="11060" class="l"><a href="#11060">11060: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'maxlen'</span>] = <span class="php-keyword2">intval</span>(<span class="php-var">$prop</span>[<span class="php-quote">'charLimit'</span>]);
</span><span id="11061" class="l"><a href="#11061">11061: </a>            }
</span><span id="11062" class="l"><a href="#11062">11062: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$ff</span>)) {
</span><span id="11063" class="l"><a href="#11063">11063: </a>                <span class="php-var">$ff</span> = <span class="php-num">0</span>;
</span><span id="11064" class="l"><a href="#11064">11064: </a>            }
</span><span id="11065" class="l"><a href="#11065">11065: </a>            <span class="php-comment">// readonly: The read-only characteristic of a field. If a field is read-only, the user can see the field but cannot change it.</span>
</span><span id="11066" class="l"><a href="#11066">11066: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'readonly'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'readonly'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11067" class="l"><a href="#11067">11067: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">0</span>;
</span><span id="11068" class="l"><a href="#11068">11068: </a>            }
</span><span id="11069" class="l"><a href="#11069">11069: </a>            <span class="php-comment">// required: Specifies whether a field requires a value.</span>
</span><span id="11070" class="l"><a href="#11070">11070: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'required'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'required'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11071" class="l"><a href="#11071">11071: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">1</span>;
</span><span id="11072" class="l"><a href="#11072">11072: </a>            }
</span><span id="11073" class="l"><a href="#11073">11073: </a>            <span class="php-comment">// multiline: Controls how text is wrapped within the field.</span>
</span><span id="11074" class="l"><a href="#11074">11074: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'multiline'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'multiline'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11075" class="l"><a href="#11075">11075: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">12</span>;
</span><span id="11076" class="l"><a href="#11076">11076: </a>            }
</span><span id="11077" class="l"><a href="#11077">11077: </a>            <span class="php-comment">// password: Specifies whether the field should display asterisks when data is entered in the field.</span>
</span><span id="11078" class="l"><a href="#11078">11078: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'password'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'password'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11079" class="l"><a href="#11079">11079: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">13</span>;
</span><span id="11080" class="l"><a href="#11080">11080: </a>            }
</span><span id="11081" class="l"><a href="#11081">11081: </a>            <span class="php-comment">// NoToggleToOff: If set, exactly one radio button shall be selected at all times; selecting the currently selected button has no effect.</span>
</span><span id="11082" class="l"><a href="#11082">11082: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'NoToggleToOff'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'NoToggleToOff'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11083" class="l"><a href="#11083">11083: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">14</span>;
</span><span id="11084" class="l"><a href="#11084">11084: </a>            }
</span><span id="11085" class="l"><a href="#11085">11085: </a>            <span class="php-comment">// Radio: If set, the field is a set of radio buttons.</span>
</span><span id="11086" class="l"><a href="#11086">11086: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'Radio'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'Radio'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11087" class="l"><a href="#11087">11087: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">15</span>;
</span><span id="11088" class="l"><a href="#11088">11088: </a>            }
</span><span id="11089" class="l"><a href="#11089">11089: </a>            <span class="php-comment">// Pushbutton: If set, the field is a pushbutton that does not retain a permanent value.</span>
</span><span id="11090" class="l"><a href="#11090">11090: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'Pushbutton'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'Pushbutton'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11091" class="l"><a href="#11091">11091: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">16</span>;
</span><span id="11092" class="l"><a href="#11092">11092: </a>            }
</span><span id="11093" class="l"><a href="#11093">11093: </a>            <span class="php-comment">// Combo: If set, the field is a combo box; if clear, the field is a list box.</span>
</span><span id="11094" class="l"><a href="#11094">11094: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'Combo'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'Combo'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11095" class="l"><a href="#11095">11095: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">17</span>;
</span><span id="11096" class="l"><a href="#11096">11096: </a>            }
</span><span id="11097" class="l"><a href="#11097">11097: </a>            <span class="php-comment">// editable: Controls whether a combo box is editable.</span>
</span><span id="11098" class="l"><a href="#11098">11098: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'editable'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'editable'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11099" class="l"><a href="#11099">11099: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">18</span>;
</span><span id="11100" class="l"><a href="#11100">11100: </a>            }
</span><span id="11101" class="l"><a href="#11101">11101: </a>            <span class="php-comment">// Sort: If set, the field's option items shall be sorted alphabetically.</span>
</span><span id="11102" class="l"><a href="#11102">11102: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'Sort'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'Sort'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11103" class="l"><a href="#11103">11103: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">19</span>;
</span><span id="11104" class="l"><a href="#11104">11104: </a>            }
</span><span id="11105" class="l"><a href="#11105">11105: </a>            <span class="php-comment">// fileSelect: If true, sets the file-select flag in the Options tab of the text field (Field is Used for File Selection).</span>
</span><span id="11106" class="l"><a href="#11106">11106: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'fileSelect'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'fileSelect'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11107" class="l"><a href="#11107">11107: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">20</span>;
</span><span id="11108" class="l"><a href="#11108">11108: </a>            }
</span><span id="11109" class="l"><a href="#11109">11109: </a>            <span class="php-comment">// multipleSelection: If true, indicates that a list box allows a multiple selection of items.</span>
</span><span id="11110" class="l"><a href="#11110">11110: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'multipleSelection'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'multipleSelection'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11111" class="l"><a href="#11111">11111: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">21</span>;
</span><span id="11112" class="l"><a href="#11112">11112: </a>            }
</span><span id="11113" class="l"><a href="#11113">11113: </a>            <span class="php-comment">// doNotSpellCheck: If true, spell checking is not performed on this editable text field.</span>
</span><span id="11114" class="l"><a href="#11114">11114: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'doNotSpellCheck'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'doNotSpellCheck'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11115" class="l"><a href="#11115">11115: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">22</span>;
</span><span id="11116" class="l"><a href="#11116">11116: </a>            }
</span><span id="11117" class="l"><a href="#11117">11117: </a>            <span class="php-comment">// doNotScroll: If true, the text field does not scroll and the user, therefore, is limited by the rectangular region designed for the field.</span>
</span><span id="11118" class="l"><a href="#11118">11118: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'doNotScroll'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'doNotScroll'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11119" class="l"><a href="#11119">11119: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">23</span>;
</span><span id="11120" class="l"><a href="#11120">11120: </a>            }
</span><span id="11121" class="l"><a href="#11121">11121: </a>            <span class="php-comment">// comb: If set to true, the field background is drawn as series of boxes (one for each character in the value of the field) and each character of the content is drawn within those boxes. The number of boxes drawn is determined from the charLimit property. It applies only to text fields. The setter will also raise if any of the following field properties are also set multiline, password, and fileSelect. A side-effect of setting this property is that the doNotScroll property is also set.</span>
</span><span id="11122" class="l"><a href="#11122">11122: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'comb'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'comb'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11123" class="l"><a href="#11123">11123: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">24</span>;
</span><span id="11124" class="l"><a href="#11124">11124: </a>            }
</span><span id="11125" class="l"><a href="#11125">11125: </a>            <span class="php-comment">// radiosInUnison: If false, even if a group of radio buttons have the same name and export value, they behave in a mutually exclusive fashion, like HTML radio buttons.</span>
</span><span id="11126" class="l"><a href="#11126">11126: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'radiosInUnison'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'radiosInUnison'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11127" class="l"><a href="#11127">11127: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">25</span>;
</span><span id="11128" class="l"><a href="#11128">11128: </a>            }
</span><span id="11129" class="l"><a href="#11129">11129: </a>            <span class="php-comment">// richText: If true, the field allows rich text formatting.</span>
</span><span id="11130" class="l"><a href="#11130">11130: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'richText'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'richText'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11131" class="l"><a href="#11131">11131: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">25</span>;
</span><span id="11132" class="l"><a href="#11132">11132: </a>            }
</span><span id="11133" class="l"><a href="#11133">11133: </a>            <span class="php-comment">// commitOnSelChange: Controls whether a field value is committed after a selection change.</span>
</span><span id="11134" class="l"><a href="#11134">11134: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'commitOnSelChange'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'commitOnSelChange'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11135" class="l"><a href="#11135">11135: </a>                <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">26</span>;
</span><span id="11136" class="l"><a href="#11136">11136: </a>            }
</span><span id="11137" class="l"><a href="#11137">11137: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'ff'</span>] = <span class="php-var">$ff</span>;
</span><span id="11138" class="l"><a href="#11138">11138: </a>            <span class="php-comment">// defaultValue: The default value of a field - that is, the value that the field is set to when the form is reset.</span>
</span><span id="11139" class="l"><a href="#11139">11139: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'defaultValue'</span>])) {
</span><span id="11140" class="l"><a href="#11140">11140: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'dv'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'defaultValue'</span>];
</span><span id="11141" class="l"><a href="#11141">11141: </a>            }
</span><span id="11142" class="l"><a href="#11142">11142: </a>            <span class="php-var">$f</span> = <span class="php-num">4</span>; <span class="php-comment">// default value for annotation flags</span>
</span><span id="11143" class="l"><a href="#11143">11143: </a>            <span class="php-comment">// readonly: The read-only characteristic of a field. If a field is read-only, the user can see the field but cannot change it.</span>
</span><span id="11144" class="l"><a href="#11144">11144: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'readonly'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$prop</span>[<span class="php-quote">'readonly'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="11145" class="l"><a href="#11145">11145: </a>                <span class="php-var">$f</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">6</span>;
</span><span id="11146" class="l"><a href="#11146">11146: </a>            }
</span><span id="11147" class="l"><a href="#11147">11147: </a>            <span class="php-comment">// display: Controls whether the field is hidden or visible on screen and in print.</span>
</span><span id="11148" class="l"><a href="#11148">11148: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'display'</span>])) {
</span><span id="11149" class="l"><a href="#11149">11149: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$prop</span>[<span class="php-quote">'display'</span>] == <span class="php-quote">'display.visible'</span>) {
</span><span id="11150" class="l"><a href="#11150">11150: </a>                    <span class="php-comment">//</span>
</span><span id="11151" class="l"><a href="#11151">11151: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$prop</span>[<span class="php-quote">'display'</span>] == <span class="php-quote">'display.hidden'</span>) {
</span><span id="11152" class="l"><a href="#11152">11152: </a>                    <span class="php-var">$f</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">1</span>;
</span><span id="11153" class="l"><a href="#11153">11153: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$prop</span>[<span class="php-quote">'display'</span>] == <span class="php-quote">'display.noPrint'</span>) {
</span><span id="11154" class="l"><a href="#11154">11154: </a>                    <span class="php-var">$f</span> -= <span class="php-num">1</span> &lt;&lt; <span class="php-num">2</span>;
</span><span id="11155" class="l"><a href="#11155">11155: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$prop</span>[<span class="php-quote">'display'</span>] == <span class="php-quote">'display.noView'</span>) {
</span><span id="11156" class="l"><a href="#11156">11156: </a>                    <span class="php-var">$f</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">5</span>;
</span><span id="11157" class="l"><a href="#11157">11157: </a>                }
</span><span id="11158" class="l"><a href="#11158">11158: </a>            }
</span><span id="11159" class="l"><a href="#11159">11159: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'f'</span>] = <span class="php-var">$f</span>;
</span><span id="11160" class="l"><a href="#11160">11160: </a>            <span class="php-comment">// currentValueIndices: Reads and writes single or multiple values of a list box or combo box.</span>
</span><span id="11161" class="l"><a href="#11161">11161: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'currentValueIndices'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$prop</span>[<span class="php-quote">'currentValueIndices'</span>])) {
</span><span id="11162" class="l"><a href="#11162">11162: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'i'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'currentValueIndices'</span>];
</span><span id="11163" class="l"><a href="#11163">11163: </a>            }
</span><span id="11164" class="l"><a href="#11164">11164: </a>            <span class="php-comment">// value: The value of the field data that the user has entered.</span>
</span><span id="11165" class="l"><a href="#11165">11165: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'value'</span>])) {
</span><span id="11166" class="l"><a href="#11166">11166: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$prop</span>[<span class="php-quote">'value'</span>])) {
</span><span id="11167" class="l"><a href="#11167">11167: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'opt'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11168" class="l"><a href="#11168">11168: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$prop</span>[<span class="php-quote">'value'</span>] <span class="php-keyword1">AS</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$optval</span>) {
</span><span id="11169" class="l"><a href="#11169">11169: </a>                        <span class="php-comment">// exportValues: An array of strings representing the export values for the field.</span>
</span><span id="11170" class="l"><a href="#11170">11170: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'exportValues'</span>][<span class="php-var">$key</span>])) {
</span><span id="11171" class="l"><a href="#11171">11171: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'opt'</span>][<span class="php-var">$key</span>] = <span class="php-keyword1">array</span>(<span class="php-var">$prop</span>[<span class="php-quote">'exportValues'</span>][<span class="php-var">$key</span>], <span class="php-var">$prop</span>[<span class="php-quote">'value'</span>][<span class="php-var">$key</span>]);
</span><span id="11172" class="l"><a href="#11172">11172: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="11173" class="l"><a href="#11173">11173: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'opt'</span>][<span class="php-var">$key</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'value'</span>][<span class="php-var">$key</span>];
</span><span id="11174" class="l"><a href="#11174">11174: </a>                        }
</span><span id="11175" class="l"><a href="#11175">11175: </a>                    }
</span><span id="11176" class="l"><a href="#11176">11176: </a>                } <span class="php-keyword1">else</span> {
</span><span id="11177" class="l"><a href="#11177">11177: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'value'</span>];
</span><span id="11178" class="l"><a href="#11178">11178: </a>                }
</span><span id="11179" class="l"><a href="#11179">11179: </a>            }
</span><span id="11180" class="l"><a href="#11180">11180: </a>            <span class="php-comment">// richValue: This property specifies the text contents and formatting of a rich text field.</span>
</span><span id="11181" class="l"><a href="#11181">11181: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'richValue'</span>])) {
</span><span id="11182" class="l"><a href="#11182">11182: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'rv'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'richValue'</span>];
</span><span id="11183" class="l"><a href="#11183">11183: </a>            }
</span><span id="11184" class="l"><a href="#11184">11184: </a>            <span class="php-comment">// submitName: If nonempty, used during form submission instead of name. Only applicable if submitting in HTML format (that is, URL-encoded).</span>
</span><span id="11185" class="l"><a href="#11185">11185: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'submitName'</span>])) {
</span><span id="11186" class="l"><a href="#11186">11186: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'tm'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'submitName'</span>];
</span><span id="11187" class="l"><a href="#11187">11187: </a>            }
</span><span id="11188" class="l"><a href="#11188">11188: </a>            <span class="php-comment">// name: Fully qualified field name.</span>
</span><span id="11189" class="l"><a href="#11189">11189: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'name'</span>])) {
</span><span id="11190" class="l"><a href="#11190">11190: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'t'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'name'</span>];
</span><span id="11191" class="l"><a href="#11191">11191: </a>            }
</span><span id="11192" class="l"><a href="#11192">11192: </a>            <span class="php-comment">// userName: The user name (short description string) of the field.</span>
</span><span id="11193" class="l"><a href="#11193">11193: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'userName'</span>])) {
</span><span id="11194" class="l"><a href="#11194">11194: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'tu'</span>] = <span class="php-var">$prop</span>[<span class="php-quote">'userName'</span>];
</span><span id="11195" class="l"><a href="#11195">11195: </a>            }
</span><span id="11196" class="l"><a href="#11196">11196: </a>            <span class="php-comment">// highlight: Defines how a button reacts when a user clicks it.</span>
</span><span id="11197" class="l"><a href="#11197">11197: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'highlight'</span>])) {
</span><span id="11198" class="l"><a href="#11198">11198: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$prop</span>[<span class="php-quote">'highlight'</span>]) {
</span><span id="11199" class="l"><a href="#11199">11199: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'none'</span>:
</span><span id="11200" class="l"><a href="#11200">11200: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'highlight.n'</span>: {
</span><span id="11201" class="l"><a href="#11201">11201: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'h'</span>] = <span class="php-quote">'N'</span>;
</span><span id="11202" class="l"><a href="#11202">11202: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11203" class="l"><a href="#11203">11203: </a>                    }
</span><span id="11204" class="l"><a href="#11204">11204: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'invert'</span>:
</span><span id="11205" class="l"><a href="#11205">11205: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'highlight.i'</span>: {
</span><span id="11206" class="l"><a href="#11206">11206: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'h'</span>] = <span class="php-quote">'i'</span>;
</span><span id="11207" class="l"><a href="#11207">11207: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11208" class="l"><a href="#11208">11208: </a>                    }
</span><span id="11209" class="l"><a href="#11209">11209: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'push'</span>:
</span><span id="11210" class="l"><a href="#11210">11210: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'highlight.p'</span>: {
</span><span id="11211" class="l"><a href="#11211">11211: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'h'</span>] = <span class="php-quote">'P'</span>;
</span><span id="11212" class="l"><a href="#11212">11212: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11213" class="l"><a href="#11213">11213: </a>                    }
</span><span id="11214" class="l"><a href="#11214">11214: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'outline'</span>:
</span><span id="11215" class="l"><a href="#11215">11215: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'highlight.o'</span>: {
</span><span id="11216" class="l"><a href="#11216">11216: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'h'</span>] = <span class="php-quote">'O'</span>;
</span><span id="11217" class="l"><a href="#11217">11217: </a>                        <span class="php-keyword1">break</span>;
</span><span id="11218" class="l"><a href="#11218">11218: </a>                    }
</span><span id="11219" class="l"><a href="#11219">11219: </a>                }
</span><span id="11220" class="l"><a href="#11220">11220: </a>            }
</span><span id="11221" class="l"><a href="#11221">11221: </a>            <span class="php-comment">// Unsupported options:</span>
</span><span id="11222" class="l"><a href="#11222">11222: </a>            <span class="php-comment">// - calcOrderIndex: Changes the calculation order of fields in the document.</span>
</span><span id="11223" class="l"><a href="#11223">11223: </a>            <span class="php-comment">// - delay: Delays the redrawing of a field's appearance.</span>
</span><span id="11224" class="l"><a href="#11224">11224: </a>            <span class="php-comment">// - defaultStyle: This property defines the default style attributes for the form field.</span>
</span><span id="11225" class="l"><a href="#11225">11225: </a>            <span class="php-comment">// - style: Allows the user to set the glyph style of a check box or radio button.</span>
</span><span id="11226" class="l"><a href="#11226">11226: </a>            <span class="php-comment">// - textColor, textFont, textSize</span>
</span><span id="11227" class="l"><a href="#11227">11227: </a>            <span class="php-keyword1">return</span> <span class="php-var">$opt</span>;
</span><span id="11228" class="l"><a href="#11228">11228: </a>        }
</span><span id="11229" class="l"><a href="#11229">11229: </a>
</span><span id="11230" class="l"><a href="#11230">11230: </a>        <span class="php-comment">/**
</span></span><span id="11231" class="l"><a href="#11231">11231: </a><span class="php-comment">         * Set default properties for form fields.
</span></span><span id="11232" class="l"><a href="#11232">11232: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11233" class="l"><a href="#11233">11233: </a><span class="php-comment">         * @access public
</span></span><span id="11234" class="l"><a href="#11234">11234: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11235" class="l"><a href="#11235">11235: </a><span class="php-comment">         * @since 4.8.000 (2009-09-06)
</span></span><span id="11236" class="l"><a href="#11236">11236: </a><span class="php-comment">         */</span>
</span><span id="11237" class="l"><a href="#11237">11237: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setFormDefaultProp(<span class="php-var">$prop</span>=<span class="php-keyword1">array</span>()) {
</span><span id="11238" class="l"><a href="#11238">11238: </a>            <span class="php-var">$this</span>-&gt;default_form_prop = <span class="php-var">$prop</span>;
</span><span id="11239" class="l"><a href="#11239">11239: </a>        }
</span><span id="11240" class="l"><a href="#11240">11240: </a>
</span><span id="11241" class="l"><a href="#11241">11241: </a>        <span class="php-comment">/**
</span></span><span id="11242" class="l"><a href="#11242">11242: </a><span class="php-comment">         * Return the default properties for form fields.
</span></span><span id="11243" class="l"><a href="#11243">11243: </a><span class="php-comment">         * @return array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11244" class="l"><a href="#11244">11244: </a><span class="php-comment">         * @access public
</span></span><span id="11245" class="l"><a href="#11245">11245: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11246" class="l"><a href="#11246">11246: </a><span class="php-comment">         * @since 4.8.000 (2009-09-06)
</span></span><span id="11247" class="l"><a href="#11247">11247: </a><span class="php-comment">         */</span>
</span><span id="11248" class="l"><a href="#11248">11248: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFormDefaultProp() {
</span><span id="11249" class="l"><a href="#11249">11249: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;default_form_prop;
</span><span id="11250" class="l"><a href="#11250">11250: </a>        }
</span><span id="11251" class="l"><a href="#11251">11251: </a>
</span><span id="11252" class="l"><a href="#11252">11252: </a>        <span class="php-comment">/**
</span></span><span id="11253" class="l"><a href="#11253">11253: </a><span class="php-comment">         * Creates a text field
</span></span><span id="11254" class="l"><a href="#11254">11254: </a><span class="php-comment">         * @param string $name field name
</span></span><span id="11255" class="l"><a href="#11255">11255: </a><span class="php-comment">         * @param float $w Width of the rectangle
</span></span><span id="11256" class="l"><a href="#11256">11256: </a><span class="php-comment">         * @param float $h Height of the rectangle
</span></span><span id="11257" class="l"><a href="#11257">11257: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11258" class="l"><a href="#11258">11258: </a><span class="php-comment">         * @param array $opt annotation parameters. Possible values are described on official PDF32000_2008 reference.
</span></span><span id="11259" class="l"><a href="#11259">11259: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="11260" class="l"><a href="#11260">11260: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="11261" class="l"><a href="#11261">11261: </a><span class="php-comment">         * @param boolean $js if true put the field using JavaScript (requires Acrobat Writer to be rendered).
</span></span><span id="11262" class="l"><a href="#11262">11262: </a><span class="php-comment">         * @access public
</span></span><span id="11263" class="l"><a href="#11263">11263: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11264" class="l"><a href="#11264">11264: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="11265" class="l"><a href="#11265">11265: </a><span class="php-comment">         */</span>
</span><span id="11266" class="l"><a href="#11266">11266: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> TextField(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$opt</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$js</span>=<span class="php-keyword1">false</span>) {
</span><span id="11267" class="l"><a href="#11267">11267: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="11268" class="l"><a href="#11268">11268: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="11269" class="l"><a href="#11269">11269: </a>            }
</span><span id="11270" class="l"><a href="#11270">11270: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="11271" class="l"><a href="#11271">11271: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="11272" class="l"><a href="#11272">11272: </a>            }
</span><span id="11273" class="l"><a href="#11273">11273: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$js</span>) {
</span><span id="11274" class="l"><a href="#11274">11274: </a>                <span class="php-var">$this</span>-&gt;_addfield(<span class="php-quote">'text'</span>, <span class="php-var">$name</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>);
</span><span id="11275" class="l"><a href="#11275">11275: </a>                <span class="php-keyword1">return</span>;
</span><span id="11276" class="l"><a href="#11276">11276: </a>            }
</span><span id="11277" class="l"><a href="#11277">11277: </a>            <span class="php-comment">// get default style</span>
</span><span id="11278" class="l"><a href="#11278">11278: </a>            <span class="php-var">$prop</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$this</span>-&gt;getFormDefaultProp(), <span class="php-var">$prop</span>);
</span><span id="11279" class="l"><a href="#11279">11279: </a>            <span class="php-comment">// get annotation data</span>
</span><span id="11280" class="l"><a href="#11280">11280: </a>            <span class="php-var">$popt</span> = <span class="php-var">$this</span>-&gt;getAnnotOptFromJSProp(<span class="php-var">$prop</span>);
</span><span id="11281" class="l"><a href="#11281">11281: </a>            <span class="php-comment">// set default appearance stream</span>
</span><span id="11282" class="l"><a href="#11282">11282: </a>            <span class="php-var">$font</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="11283" class="l"><a href="#11283">11283: </a>            <span class="php-var">$fontkey</span> = <span class="php-keyword2">array_search</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys);
</span><span id="11284" class="l"><a href="#11284">11284: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$fontkey</span>, <span class="php-var">$this</span>-&gt;annotation_fonts)) {
</span><span id="11285" class="l"><a href="#11285">11285: </a>                <span class="php-var">$this</span>-&gt;annotation_fonts[<span class="php-var">$font</span>] = <span class="php-var">$fontkey</span>;
</span><span id="11286" class="l"><a href="#11286">11286: </a>            }
</span><span id="11287" class="l"><a href="#11287">11287: </a>            <span class="php-var">$fontstyle</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/F%d %.2F Tf %s'</span>, (<span class="php-var">$fontkey</span> + <span class="php-num">1</span>), <span class="php-var">$this</span>-&gt;FontSizePt, <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="11288" class="l"><a href="#11288">11288: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'da'</span>] = <span class="php-var">$fontstyle</span>;
</span><span id="11289" class="l"><a href="#11289">11289: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11290" class="l"><a href="#11290">11290: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' ET Q'</span>;
</span><span id="11291" class="l"><a href="#11291">11291: </a>            <span class="php-comment">// merge options</span>
</span><span id="11292" class="l"><a href="#11292">11292: </a>            <span class="php-var">$opt</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$popt</span>, <span class="php-var">$opt</span>);
</span><span id="11293" class="l"><a href="#11293">11293: </a>            <span class="php-comment">// remove some conflicting options</span>
</span><span id="11294" class="l"><a href="#11294">11294: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$opt</span>[<span class="php-quote">'bs'</span>]);
</span><span id="11295" class="l"><a href="#11295">11295: </a>            <span class="php-comment">// set remaining annotation data</span>
</span><span id="11296" class="l"><a href="#11296">11296: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] = <span class="php-quote">'Widget'</span>;
</span><span id="11297" class="l"><a href="#11297">11297: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'ft'</span>] = <span class="php-quote">'Tx'</span>;
</span><span id="11298" class="l"><a href="#11298">11298: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'t'</span>] = <span class="php-var">$name</span>;
</span><span id="11299" class="l"><a href="#11299">11299: </a>            <span class="php-comment">/*
</span></span><span id="11300" class="l"><a href="#11300">11300: </a><span class="php-comment">            Additional annotation's parameters (check _putannotsobj() method):
</span></span><span id="11301" class="l"><a href="#11301">11301: </a><span class="php-comment">            //$opt['f']
</span></span><span id="11302" class="l"><a href="#11302">11302: </a><span class="php-comment">            //$opt['ap']
</span></span><span id="11303" class="l"><a href="#11303">11303: </a><span class="php-comment">            //$opt['as']
</span></span><span id="11304" class="l"><a href="#11304">11304: </a><span class="php-comment">            //$opt['bs']
</span></span><span id="11305" class="l"><a href="#11305">11305: </a><span class="php-comment">            //$opt['be']
</span></span><span id="11306" class="l"><a href="#11306">11306: </a><span class="php-comment">            //$opt['c']
</span></span><span id="11307" class="l"><a href="#11307">11307: </a><span class="php-comment">            //$opt['border']
</span></span><span id="11308" class="l"><a href="#11308">11308: </a><span class="php-comment">            //$opt['h']
</span></span><span id="11309" class="l"><a href="#11309">11309: </a><span class="php-comment">            //$opt['mk']
</span></span><span id="11310" class="l"><a href="#11310">11310: </a><span class="php-comment">            //$opt['mk']['r']
</span></span><span id="11311" class="l"><a href="#11311">11311: </a><span class="php-comment">            //$opt['mk']['bc']
</span></span><span id="11312" class="l"><a href="#11312">11312: </a><span class="php-comment">            //$opt['mk']['bg']
</span></span><span id="11313" class="l"><a href="#11313">11313: </a><span class="php-comment">            //$opt['mk']['ca']
</span></span><span id="11314" class="l"><a href="#11314">11314: </a><span class="php-comment">            //$opt['mk']['rc']
</span></span><span id="11315" class="l"><a href="#11315">11315: </a><span class="php-comment">            //$opt['mk']['ac']
</span></span><span id="11316" class="l"><a href="#11316">11316: </a><span class="php-comment">            //$opt['mk']['i']
</span></span><span id="11317" class="l"><a href="#11317">11317: </a><span class="php-comment">            //$opt['mk']['ri']
</span></span><span id="11318" class="l"><a href="#11318">11318: </a><span class="php-comment">            //$opt['mk']['ix']
</span></span><span id="11319" class="l"><a href="#11319">11319: </a><span class="php-comment">            //$opt['mk']['if']
</span></span><span id="11320" class="l"><a href="#11320">11320: </a><span class="php-comment">            //$opt['mk']['if']['sw']
</span></span><span id="11321" class="l"><a href="#11321">11321: </a><span class="php-comment">            //$opt['mk']['if']['s']
</span></span><span id="11322" class="l"><a href="#11322">11322: </a><span class="php-comment">            //$opt['mk']['if']['a']
</span></span><span id="11323" class="l"><a href="#11323">11323: </a><span class="php-comment">            //$opt['mk']['if']['fb']
</span></span><span id="11324" class="l"><a href="#11324">11324: </a><span class="php-comment">            //$opt['mk']['tp']
</span></span><span id="11325" class="l"><a href="#11325">11325: </a><span class="php-comment">            //$opt['tu']
</span></span><span id="11326" class="l"><a href="#11326">11326: </a><span class="php-comment">            //$opt['tm']
</span></span><span id="11327" class="l"><a href="#11327">11327: </a><span class="php-comment">            //$opt['ff']
</span></span><span id="11328" class="l"><a href="#11328">11328: </a><span class="php-comment">            //$opt['v']
</span></span><span id="11329" class="l"><a href="#11329">11329: </a><span class="php-comment">            //$opt['dv']
</span></span><span id="11330" class="l"><a href="#11330">11330: </a><span class="php-comment">            //$opt['a']
</span></span><span id="11331" class="l"><a href="#11331">11331: </a><span class="php-comment">            //$opt['aa']
</span></span><span id="11332" class="l"><a href="#11332">11332: </a><span class="php-comment">            //$opt['q']
</span></span><span id="11333" class="l"><a href="#11333">11333: </a><span class="php-comment">            */</span>
</span><span id="11334" class="l"><a href="#11334">11334: </a>            <span class="php-var">$this</span>-&gt;Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$name</span>, <span class="php-var">$opt</span>, <span class="php-num">0</span>);
</span><span id="11335" class="l"><a href="#11335">11335: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="11336" class="l"><a href="#11336">11336: </a>                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="11337" class="l"><a href="#11337">11337: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11338" class="l"><a href="#11338">11338: </a>                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="11339" class="l"><a href="#11339">11339: </a>            }
</span><span id="11340" class="l"><a href="#11340">11340: </a>        }
</span><span id="11341" class="l"><a href="#11341">11341: </a>
</span><span id="11342" class="l"><a href="#11342">11342: </a>        <span class="php-comment">/**
</span></span><span id="11343" class="l"><a href="#11343">11343: </a><span class="php-comment">         * Creates a RadioButton field
</span></span><span id="11344" class="l"><a href="#11344">11344: </a><span class="php-comment">         * @param string $name field name
</span></span><span id="11345" class="l"><a href="#11345">11345: </a><span class="php-comment">         * @param int $w width
</span></span><span id="11346" class="l"><a href="#11346">11346: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11347" class="l"><a href="#11347">11347: </a><span class="php-comment">         * @param array $opt annotation parameters. Possible values are described on official PDF32000_2008 reference.
</span></span><span id="11348" class="l"><a href="#11348">11348: </a><span class="php-comment">         * @param string $onvalue value to be returned if selected.
</span></span><span id="11349" class="l"><a href="#11349">11349: </a><span class="php-comment">         * @param boolean $checked define the initial state.
</span></span><span id="11350" class="l"><a href="#11350">11350: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="11351" class="l"><a href="#11351">11351: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="11352" class="l"><a href="#11352">11352: </a><span class="php-comment">         * @param boolean $js if true put the field using JavaScript (requires Acrobat Writer to be rendered).
</span></span><span id="11353" class="l"><a href="#11353">11353: </a><span class="php-comment">         * @access public
</span></span><span id="11354" class="l"><a href="#11354">11354: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11355" class="l"><a href="#11355">11355: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="11356" class="l"><a href="#11356">11356: </a><span class="php-comment">         */</span>
</span><span id="11357" class="l"><a href="#11357">11357: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> RadioButton(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$prop</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$opt</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$onvalue</span>=<span class="php-quote">'On'</span>, <span class="php-var">$checked</span>=<span class="php-keyword1">false</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$js</span>=<span class="php-keyword1">false</span>) {
</span><span id="11358" class="l"><a href="#11358">11358: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="11359" class="l"><a href="#11359">11359: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="11360" class="l"><a href="#11360">11360: </a>            }
</span><span id="11361" class="l"><a href="#11361">11361: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="11362" class="l"><a href="#11362">11362: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="11363" class="l"><a href="#11363">11363: </a>            }
</span><span id="11364" class="l"><a href="#11364">11364: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$js</span>) {
</span><span id="11365" class="l"><a href="#11365">11365: </a>                <span class="php-var">$this</span>-&gt;_addfield(<span class="php-quote">'radiobutton'</span>, <span class="php-var">$name</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$w</span>, <span class="php-var">$prop</span>);
</span><span id="11366" class="l"><a href="#11366">11366: </a>                <span class="php-keyword1">return</span>;
</span><span id="11367" class="l"><a href="#11367">11367: </a>            }
</span><span id="11368" class="l"><a href="#11368">11368: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$onvalue</span>)) {
</span><span id="11369" class="l"><a href="#11369">11369: </a>                <span class="php-var">$onvalue</span> = <span class="php-quote">'On'</span>;
</span><span id="11370" class="l"><a href="#11370">11370: </a>            }
</span><span id="11371" class="l"><a href="#11371">11371: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$checked</span>) {
</span><span id="11372" class="l"><a href="#11372">11372: </a>                <span class="php-var">$defval</span> = <span class="php-var">$onvalue</span>;
</span><span id="11373" class="l"><a href="#11373">11373: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11374" class="l"><a href="#11374">11374: </a>                <span class="php-var">$defval</span> = <span class="php-quote">'Off'</span>;
</span><span id="11375" class="l"><a href="#11375">11375: </a>            }
</span><span id="11376" class="l"><a href="#11376">11376: </a>            <span class="php-comment">// set data for parent group</span>
</span><span id="11377" class="l"><a href="#11377">11377: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="11378" class="l"><a href="#11378">11378: </a>                <span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$this</span>-&gt;page] = <span class="php-keyword1">array</span>();
</span><span id="11379" class="l"><a href="#11379">11379: </a>            }
</span><span id="11380" class="l"><a href="#11380">11380: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$name</span>])) {
</span><span id="11381" class="l"><a href="#11381">11381: </a>                <span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$name</span>] = <span class="php-keyword1">array</span>();
</span><span id="11382" class="l"><a href="#11382">11382: </a>                ++<span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="11383" class="l"><a href="#11383">11383: </a>                <span class="php-var">$this</span>-&gt;radio_groups[] = <span class="php-var">$this</span>-&gt;annot_obj_id;
</span><span id="11384" class="l"><a href="#11384">11384: </a>            }
</span><span id="11385" class="l"><a href="#11385">11385: </a>            <span class="php-comment">// save object ID to be added on Kids entry on parent object</span>
</span><span id="11386" class="l"><a href="#11386">11386: </a>            <span class="php-var">$this</span>-&gt;radiobutton_groups[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$name</span>][] = <span class="php-keyword1">array</span>(<span class="php-quote">'kid'</span> =&gt; (<span class="php-var">$this</span>-&gt;annot_obj_id + <span class="php-num">1</span>), <span class="php-quote">'def'</span> =&gt; <span class="php-var">$defval</span>);
</span><span id="11387" class="l"><a href="#11387">11387: </a>            <span class="php-comment">// get default style</span>
</span><span id="11388" class="l"><a href="#11388">11388: </a>            <span class="php-var">$prop</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$this</span>-&gt;getFormDefaultProp(), <span class="php-var">$prop</span>);
</span><span id="11389" class="l"><a href="#11389">11389: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'NoToggleToOff'</span>] = <span class="php-quote">'true'</span>;
</span><span id="11390" class="l"><a href="#11390">11390: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'Radio'</span>] = <span class="php-quote">'true'</span>;
</span><span id="11391" class="l"><a href="#11391">11391: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'borderStyle'</span>] = <span class="php-quote">'inset'</span>;
</span><span id="11392" class="l"><a href="#11392">11392: </a>            <span class="php-comment">// get annotation data</span>
</span><span id="11393" class="l"><a href="#11393">11393: </a>            <span class="php-var">$popt</span> = <span class="php-var">$this</span>-&gt;getAnnotOptFromJSProp(<span class="php-var">$prop</span>);
</span><span id="11394" class="l"><a href="#11394">11394: </a>            <span class="php-comment">// set additional default values</span>
</span><span id="11395" class="l"><a href="#11395">11395: </a>            <span class="php-var">$font</span> = <span class="php-quote">'zapfdingbats'</span>;
</span><span id="11396" class="l"><a href="#11396">11396: </a>            <span class="php-var">$this</span>-&gt;AddFont(<span class="php-var">$font</span>);
</span><span id="11397" class="l"><a href="#11397">11397: </a>            <span class="php-var">$fontkey</span> = <span class="php-keyword2">array_search</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys);
</span><span id="11398" class="l"><a href="#11398">11398: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$fontkey</span>, <span class="php-var">$this</span>-&gt;annotation_fonts)) {
</span><span id="11399" class="l"><a href="#11399">11399: </a>                <span class="php-var">$this</span>-&gt;annotation_fonts[<span class="php-var">$font</span>] = <span class="php-var">$fontkey</span>;
</span><span id="11400" class="l"><a href="#11400">11400: </a>            }
</span><span id="11401" class="l"><a href="#11401">11401: </a>            <span class="php-var">$fontstyle</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/F%d %.2F Tf %s'</span>, (<span class="php-var">$fontkey</span> + <span class="php-num">1</span>), <span class="php-var">$this</span>-&gt;FontSizePt, <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="11402" class="l"><a href="#11402">11402: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'da'</span>] = <span class="php-var">$fontstyle</span>;
</span><span id="11403" class="l"><a href="#11403">11403: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11404" class="l"><a href="#11404">11404: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11405" class="l"><a href="#11405">11405: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>][<span class="php-var">$onvalue</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' 0 0 Td (8) Tj ET Q'</span>;
</span><span id="11406" class="l"><a href="#11406">11406: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>][<span class="php-quote">'Off'</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' 0 0 Td (8) Tj ET Q'</span>;
</span><span id="11407" class="l"><a href="#11407">11407: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>])) {
</span><span id="11408" class="l"><a href="#11408">11408: </a>                <span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11409" class="l"><a href="#11409">11409: </a>            }
</span><span id="11410" class="l"><a href="#11410">11410: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ca'</span>] = <span class="php-quote">'(l)'</span>;
</span><span id="11411" class="l"><a href="#11411">11411: </a>            <span class="php-comment">// merge options</span>
</span><span id="11412" class="l"><a href="#11412">11412: </a>            <span class="php-var">$opt</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$popt</span>, <span class="php-var">$opt</span>);
</span><span id="11413" class="l"><a href="#11413">11413: </a>            <span class="php-comment">// set remaining annotation data</span>
</span><span id="11414" class="l"><a href="#11414">11414: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] = <span class="php-quote">'Widget'</span>;
</span><span id="11415" class="l"><a href="#11415">11415: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'ft'</span>] = <span class="php-quote">'Btn'</span>;
</span><span id="11416" class="l"><a href="#11416">11416: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$checked</span>) {
</span><span id="11417" class="l"><a href="#11417">11417: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'/'</span>.<span class="php-var">$onvalue</span>);
</span><span id="11418" class="l"><a href="#11418">11418: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'as'</span>] = <span class="php-var">$onvalue</span>;
</span><span id="11419" class="l"><a href="#11419">11419: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11420" class="l"><a href="#11420">11420: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'as'</span>] = <span class="php-quote">'Off'</span>;
</span><span id="11421" class="l"><a href="#11421">11421: </a>            }
</span><span id="11422" class="l"><a href="#11422">11422: </a>            <span class="php-var">$this</span>-&gt;Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$w</span>, <span class="php-var">$name</span>, <span class="php-var">$opt</span>, <span class="php-num">0</span>);
</span><span id="11423" class="l"><a href="#11423">11423: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="11424" class="l"><a href="#11424">11424: </a>                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="11425" class="l"><a href="#11425">11425: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11426" class="l"><a href="#11426">11426: </a>                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="11427" class="l"><a href="#11427">11427: </a>            }
</span><span id="11428" class="l"><a href="#11428">11428: </a>        }
</span><span id="11429" class="l"><a href="#11429">11429: </a>
</span><span id="11430" class="l"><a href="#11430">11430: </a>        <span class="php-comment">/**
</span></span><span id="11431" class="l"><a href="#11431">11431: </a><span class="php-comment">         * Creates a List-box field
</span></span><span id="11432" class="l"><a href="#11432">11432: </a><span class="php-comment">         * @param string $name field name
</span></span><span id="11433" class="l"><a href="#11433">11433: </a><span class="php-comment">         * @param int $w width
</span></span><span id="11434" class="l"><a href="#11434">11434: </a><span class="php-comment">         * @param int $h height
</span></span><span id="11435" class="l"><a href="#11435">11435: </a><span class="php-comment">         * @param array $values array containing the list of values.
</span></span><span id="11436" class="l"><a href="#11436">11436: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11437" class="l"><a href="#11437">11437: </a><span class="php-comment">         * @param array $opt annotation parameters. Possible values are described on official PDF32000_2008 reference.
</span></span><span id="11438" class="l"><a href="#11438">11438: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="11439" class="l"><a href="#11439">11439: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="11440" class="l"><a href="#11440">11440: </a><span class="php-comment">         * @param boolean $js if true put the field using JavaScript (requires Acrobat Writer to be rendered).
</span></span><span id="11441" class="l"><a href="#11441">11441: </a><span class="php-comment">         * @access public
</span></span><span id="11442" class="l"><a href="#11442">11442: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11443" class="l"><a href="#11443">11443: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="11444" class="l"><a href="#11444">11444: </a><span class="php-comment">         */</span>
</span><span id="11445" class="l"><a href="#11445">11445: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> ListBox(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$values</span>, <span class="php-var">$prop</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$opt</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$js</span>=<span class="php-keyword1">false</span>) {
</span><span id="11446" class="l"><a href="#11446">11446: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="11447" class="l"><a href="#11447">11447: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="11448" class="l"><a href="#11448">11448: </a>            }
</span><span id="11449" class="l"><a href="#11449">11449: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="11450" class="l"><a href="#11450">11450: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="11451" class="l"><a href="#11451">11451: </a>            }
</span><span id="11452" class="l"><a href="#11452">11452: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$js</span>) {
</span><span id="11453" class="l"><a href="#11453">11453: </a>                <span class="php-var">$this</span>-&gt;_addfield(<span class="php-quote">'listbox'</span>, <span class="php-var">$name</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>);
</span><span id="11454" class="l"><a href="#11454">11454: </a>                <span class="php-var">$s</span> = <span class="php-quote">''</span>;
</span><span id="11455" class="l"><a href="#11455">11455: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$values</span> <span class="php-keyword1">as</span> <span class="php-var">$value</span>) {
</span><span id="11456" class="l"><a href="#11456">11456: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">&quot;'&quot;</span>.<span class="php-keyword2">addslashes</span>(<span class="php-var">$value</span>).<span class="php-quote">&quot;',&quot;</span>;
</span><span id="11457" class="l"><a href="#11457">11457: </a>                }
</span><span id="11458" class="l"><a href="#11458">11458: </a>                <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">'.setItems(['</span>.<span class="php-keyword2">substr</span>(<span class="php-var">$s</span>, <span class="php-num">0</span>, -<span class="php-num">1</span>).<span class="php-quote">&quot;]);\n&quot;</span>;
</span><span id="11459" class="l"><a href="#11459">11459: </a>                <span class="php-keyword1">return</span>;
</span><span id="11460" class="l"><a href="#11460">11460: </a>            }
</span><span id="11461" class="l"><a href="#11461">11461: </a>            <span class="php-comment">// get default style</span>
</span><span id="11462" class="l"><a href="#11462">11462: </a>            <span class="php-var">$prop</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$this</span>-&gt;getFormDefaultProp(), <span class="php-var">$prop</span>);
</span><span id="11463" class="l"><a href="#11463">11463: </a>            <span class="php-comment">// get annotation data</span>
</span><span id="11464" class="l"><a href="#11464">11464: </a>            <span class="php-var">$popt</span> = <span class="php-var">$this</span>-&gt;getAnnotOptFromJSProp(<span class="php-var">$prop</span>);
</span><span id="11465" class="l"><a href="#11465">11465: </a>            <span class="php-comment">// set additional default values</span>
</span><span id="11466" class="l"><a href="#11466">11466: </a>            <span class="php-var">$font</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="11467" class="l"><a href="#11467">11467: </a>            <span class="php-var">$fontkey</span> = <span class="php-keyword2">array_search</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys);
</span><span id="11468" class="l"><a href="#11468">11468: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$fontkey</span>, <span class="php-var">$this</span>-&gt;annotation_fonts)) {
</span><span id="11469" class="l"><a href="#11469">11469: </a>                <span class="php-var">$this</span>-&gt;annotation_fonts[<span class="php-var">$font</span>] = <span class="php-var">$fontkey</span>;
</span><span id="11470" class="l"><a href="#11470">11470: </a>            }
</span><span id="11471" class="l"><a href="#11471">11471: </a>            <span class="php-var">$fontstyle</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/F%d %.2F Tf %s'</span>, (<span class="php-var">$fontkey</span> + <span class="php-num">1</span>), <span class="php-var">$this</span>-&gt;FontSizePt, <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="11472" class="l"><a href="#11472">11472: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'da'</span>] = <span class="php-var">$fontstyle</span>;
</span><span id="11473" class="l"><a href="#11473">11473: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11474" class="l"><a href="#11474">11474: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' ET Q'</span>;
</span><span id="11475" class="l"><a href="#11475">11475: </a>            <span class="php-comment">// merge options</span>
</span><span id="11476" class="l"><a href="#11476">11476: </a>            <span class="php-var">$opt</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$popt</span>, <span class="php-var">$opt</span>);
</span><span id="11477" class="l"><a href="#11477">11477: </a>            <span class="php-comment">// set remaining annotation data</span>
</span><span id="11478" class="l"><a href="#11478">11478: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] = <span class="php-quote">'Widget'</span>;
</span><span id="11479" class="l"><a href="#11479">11479: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'ft'</span>] = <span class="php-quote">'Ch'</span>;
</span><span id="11480" class="l"><a href="#11480">11480: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'t'</span>] = <span class="php-var">$name</span>;
</span><span id="11481" class="l"><a href="#11481">11481: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'opt'</span>] = <span class="php-var">$values</span>;
</span><span id="11482" class="l"><a href="#11482">11482: </a>            <span class="php-var">$this</span>-&gt;Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$name</span>, <span class="php-var">$opt</span>, <span class="php-num">0</span>);
</span><span id="11483" class="l"><a href="#11483">11483: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="11484" class="l"><a href="#11484">11484: </a>                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="11485" class="l"><a href="#11485">11485: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11486" class="l"><a href="#11486">11486: </a>                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="11487" class="l"><a href="#11487">11487: </a>            }
</span><span id="11488" class="l"><a href="#11488">11488: </a>        }
</span><span id="11489" class="l"><a href="#11489">11489: </a>
</span><span id="11490" class="l"><a href="#11490">11490: </a>        <span class="php-comment">/**
</span></span><span id="11491" class="l"><a href="#11491">11491: </a><span class="php-comment">         * Creates a Combo-box field
</span></span><span id="11492" class="l"><a href="#11492">11492: </a><span class="php-comment">         * @param string $name field name
</span></span><span id="11493" class="l"><a href="#11493">11493: </a><span class="php-comment">         * @param int $w width
</span></span><span id="11494" class="l"><a href="#11494">11494: </a><span class="php-comment">         * @param int $h height
</span></span><span id="11495" class="l"><a href="#11495">11495: </a><span class="php-comment">         * @param array $values array containing the list of values.
</span></span><span id="11496" class="l"><a href="#11496">11496: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11497" class="l"><a href="#11497">11497: </a><span class="php-comment">         * @param array $opt annotation parameters. Possible values are described on official PDF32000_2008 reference.
</span></span><span id="11498" class="l"><a href="#11498">11498: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="11499" class="l"><a href="#11499">11499: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="11500" class="l"><a href="#11500">11500: </a><span class="php-comment">         * @param boolean $js if true put the field using JavaScript (requires Acrobat Writer to be rendered).
</span></span><span id="11501" class="l"><a href="#11501">11501: </a><span class="php-comment">         * @access public
</span></span><span id="11502" class="l"><a href="#11502">11502: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11503" class="l"><a href="#11503">11503: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="11504" class="l"><a href="#11504">11504: </a><span class="php-comment">         */</span>
</span><span id="11505" class="l"><a href="#11505">11505: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> ComboBox(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$values</span>, <span class="php-var">$prop</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$opt</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$js</span>=<span class="php-keyword1">false</span>) {
</span><span id="11506" class="l"><a href="#11506">11506: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="11507" class="l"><a href="#11507">11507: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="11508" class="l"><a href="#11508">11508: </a>            }
</span><span id="11509" class="l"><a href="#11509">11509: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="11510" class="l"><a href="#11510">11510: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="11511" class="l"><a href="#11511">11511: </a>            }
</span><span id="11512" class="l"><a href="#11512">11512: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$js</span>) {
</span><span id="11513" class="l"><a href="#11513">11513: </a>                <span class="php-var">$this</span>-&gt;_addfield(<span class="php-quote">'combobox'</span>, <span class="php-var">$name</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>);
</span><span id="11514" class="l"><a href="#11514">11514: </a>                <span class="php-var">$s</span> = <span class="php-quote">''</span>;
</span><span id="11515" class="l"><a href="#11515">11515: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$values</span> <span class="php-keyword1">as</span> <span class="php-var">$value</span>) {
</span><span id="11516" class="l"><a href="#11516">11516: </a>                    <span class="php-var">$s</span> .= <span class="php-quote">&quot;'&quot;</span>.<span class="php-keyword2">addslashes</span>(<span class="php-var">$value</span>).<span class="php-quote">&quot;',&quot;</span>;
</span><span id="11517" class="l"><a href="#11517">11517: </a>                }
</span><span id="11518" class="l"><a href="#11518">11518: </a>                <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">'.setItems(['</span>.<span class="php-keyword2">substr</span>(<span class="php-var">$s</span>, <span class="php-num">0</span>, -<span class="php-num">1</span>).<span class="php-quote">&quot;]);\n&quot;</span>;
</span><span id="11519" class="l"><a href="#11519">11519: </a>                <span class="php-keyword1">return</span>;
</span><span id="11520" class="l"><a href="#11520">11520: </a>            }
</span><span id="11521" class="l"><a href="#11521">11521: </a>            <span class="php-comment">// get default style</span>
</span><span id="11522" class="l"><a href="#11522">11522: </a>            <span class="php-var">$prop</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$this</span>-&gt;getFormDefaultProp(), <span class="php-var">$prop</span>);
</span><span id="11523" class="l"><a href="#11523">11523: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'Combo'</span>] = <span class="php-keyword1">true</span>;
</span><span id="11524" class="l"><a href="#11524">11524: </a>            <span class="php-comment">// get annotation data</span>
</span><span id="11525" class="l"><a href="#11525">11525: </a>            <span class="php-var">$popt</span> = <span class="php-var">$this</span>-&gt;getAnnotOptFromJSProp(<span class="php-var">$prop</span>);
</span><span id="11526" class="l"><a href="#11526">11526: </a>            <span class="php-comment">// set additional default options</span>
</span><span id="11527" class="l"><a href="#11527">11527: </a>            <span class="php-var">$font</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="11528" class="l"><a href="#11528">11528: </a>            <span class="php-var">$fontkey</span> = <span class="php-keyword2">array_search</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys);
</span><span id="11529" class="l"><a href="#11529">11529: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$fontkey</span>, <span class="php-var">$this</span>-&gt;annotation_fonts)) {
</span><span id="11530" class="l"><a href="#11530">11530: </a>                <span class="php-var">$this</span>-&gt;annotation_fonts[<span class="php-var">$font</span>] = <span class="php-var">$fontkey</span>;
</span><span id="11531" class="l"><a href="#11531">11531: </a>            }
</span><span id="11532" class="l"><a href="#11532">11532: </a>            <span class="php-var">$fontstyle</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/F%d %.2F Tf %s'</span>, (<span class="php-var">$fontkey</span> + <span class="php-num">1</span>), <span class="php-var">$this</span>-&gt;FontSizePt, <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="11533" class="l"><a href="#11533">11533: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'da'</span>] = <span class="php-var">$fontstyle</span>;
</span><span id="11534" class="l"><a href="#11534">11534: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11535" class="l"><a href="#11535">11535: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' ET Q'</span>;
</span><span id="11536" class="l"><a href="#11536">11536: </a>            <span class="php-comment">// merge options</span>
</span><span id="11537" class="l"><a href="#11537">11537: </a>            <span class="php-var">$opt</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$popt</span>, <span class="php-var">$opt</span>);
</span><span id="11538" class="l"><a href="#11538">11538: </a>            <span class="php-comment">// set remaining annotation data</span>
</span><span id="11539" class="l"><a href="#11539">11539: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] = <span class="php-quote">'Widget'</span>;
</span><span id="11540" class="l"><a href="#11540">11540: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'ft'</span>] = <span class="php-quote">'Ch'</span>;
</span><span id="11541" class="l"><a href="#11541">11541: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'t'</span>] = <span class="php-var">$name</span>;
</span><span id="11542" class="l"><a href="#11542">11542: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'opt'</span>] = <span class="php-var">$values</span>;
</span><span id="11543" class="l"><a href="#11543">11543: </a>            <span class="php-var">$this</span>-&gt;Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$name</span>, <span class="php-var">$opt</span>, <span class="php-num">0</span>);
</span><span id="11544" class="l"><a href="#11544">11544: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="11545" class="l"><a href="#11545">11545: </a>                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="11546" class="l"><a href="#11546">11546: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11547" class="l"><a href="#11547">11547: </a>                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="11548" class="l"><a href="#11548">11548: </a>            }
</span><span id="11549" class="l"><a href="#11549">11549: </a>        }
</span><span id="11550" class="l"><a href="#11550">11550: </a>
</span><span id="11551" class="l"><a href="#11551">11551: </a>        <span class="php-comment">/**
</span></span><span id="11552" class="l"><a href="#11552">11552: </a><span class="php-comment">         * Creates a CheckBox field
</span></span><span id="11553" class="l"><a href="#11553">11553: </a><span class="php-comment">         * @param string $name field name
</span></span><span id="11554" class="l"><a href="#11554">11554: </a><span class="php-comment">         * @param int $w width
</span></span><span id="11555" class="l"><a href="#11555">11555: </a><span class="php-comment">         * @param boolean $checked define the initial state.
</span></span><span id="11556" class="l"><a href="#11556">11556: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11557" class="l"><a href="#11557">11557: </a><span class="php-comment">         * @param array $opt annotation parameters. Possible values are described on official PDF32000_2008 reference.
</span></span><span id="11558" class="l"><a href="#11558">11558: </a><span class="php-comment">         * @param string $onvalue value to be returned if selected.
</span></span><span id="11559" class="l"><a href="#11559">11559: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="11560" class="l"><a href="#11560">11560: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="11561" class="l"><a href="#11561">11561: </a><span class="php-comment">         * @param boolean $js if true put the field using JavaScript (requires Acrobat Writer to be rendered).
</span></span><span id="11562" class="l"><a href="#11562">11562: </a><span class="php-comment">         * @access public
</span></span><span id="11563" class="l"><a href="#11563">11563: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11564" class="l"><a href="#11564">11564: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="11565" class="l"><a href="#11565">11565: </a><span class="php-comment">         */</span>
</span><span id="11566" class="l"><a href="#11566">11566: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> CheckBox(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$checked</span>=<span class="php-keyword1">false</span>, <span class="php-var">$prop</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$opt</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$onvalue</span>=<span class="php-quote">'Yes'</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$js</span>=<span class="php-keyword1">false</span>) {
</span><span id="11567" class="l"><a href="#11567">11567: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="11568" class="l"><a href="#11568">11568: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="11569" class="l"><a href="#11569">11569: </a>            }
</span><span id="11570" class="l"><a href="#11570">11570: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="11571" class="l"><a href="#11571">11571: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="11572" class="l"><a href="#11572">11572: </a>            }
</span><span id="11573" class="l"><a href="#11573">11573: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$js</span>) {
</span><span id="11574" class="l"><a href="#11574">11574: </a>                <span class="php-var">$this</span>-&gt;_addfield(<span class="php-quote">'checkbox'</span>, <span class="php-var">$name</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$w</span>, <span class="php-var">$prop</span>);
</span><span id="11575" class="l"><a href="#11575">11575: </a>                <span class="php-keyword1">return</span>;
</span><span id="11576" class="l"><a href="#11576">11576: </a>            }
</span><span id="11577" class="l"><a href="#11577">11577: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$prop</span>[<span class="php-quote">'value'</span>])) {
</span><span id="11578" class="l"><a href="#11578">11578: </a>                <span class="php-var">$prop</span>[<span class="php-quote">'value'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'Yes'</span>);
</span><span id="11579" class="l"><a href="#11579">11579: </a>            }
</span><span id="11580" class="l"><a href="#11580">11580: </a>            <span class="php-comment">// get default style</span>
</span><span id="11581" class="l"><a href="#11581">11581: </a>            <span class="php-var">$prop</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$this</span>-&gt;getFormDefaultProp(), <span class="php-var">$prop</span>);
</span><span id="11582" class="l"><a href="#11582">11582: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'borderStyle'</span>] = <span class="php-quote">'inset'</span>;
</span><span id="11583" class="l"><a href="#11583">11583: </a>            <span class="php-comment">// get annotation data</span>
</span><span id="11584" class="l"><a href="#11584">11584: </a>            <span class="php-var">$popt</span> = <span class="php-var">$this</span>-&gt;getAnnotOptFromJSProp(<span class="php-var">$prop</span>);
</span><span id="11585" class="l"><a href="#11585">11585: </a>            <span class="php-comment">// set additional default options</span>
</span><span id="11586" class="l"><a href="#11586">11586: </a>            <span class="php-var">$font</span> = <span class="php-quote">'zapfdingbats'</span>;
</span><span id="11587" class="l"><a href="#11587">11587: </a>            <span class="php-var">$this</span>-&gt;AddFont(<span class="php-var">$font</span>);
</span><span id="11588" class="l"><a href="#11588">11588: </a>            <span class="php-var">$fontkey</span> = <span class="php-keyword2">array_search</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys);
</span><span id="11589" class="l"><a href="#11589">11589: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$fontkey</span>, <span class="php-var">$this</span>-&gt;annotation_fonts)) {
</span><span id="11590" class="l"><a href="#11590">11590: </a>                <span class="php-var">$this</span>-&gt;annotation_fonts[<span class="php-var">$font</span>] = <span class="php-var">$fontkey</span>;
</span><span id="11591" class="l"><a href="#11591">11591: </a>            }
</span><span id="11592" class="l"><a href="#11592">11592: </a>            <span class="php-var">$fontstyle</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/F%d %.2F Tf %s'</span>, (<span class="php-var">$fontkey</span> + <span class="php-num">1</span>), <span class="php-var">$this</span>-&gt;FontSizePt, <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="11593" class="l"><a href="#11593">11593: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'da'</span>] = <span class="php-var">$fontstyle</span>;
</span><span id="11594" class="l"><a href="#11594">11594: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11595" class="l"><a href="#11595">11595: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11596" class="l"><a href="#11596">11596: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>][<span class="php-quote">'Yes'</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' 0 0 Td (8) Tj ET Q'</span>;
</span><span id="11597" class="l"><a href="#11597">11597: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>][<span class="php-quote">'Off'</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' 0 0 Td (8) Tj ET Q'</span>;
</span><span id="11598" class="l"><a href="#11598">11598: </a>            <span class="php-comment">// merge options</span>
</span><span id="11599" class="l"><a href="#11599">11599: </a>            <span class="php-var">$opt</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$popt</span>, <span class="php-var">$opt</span>);
</span><span id="11600" class="l"><a href="#11600">11600: </a>            <span class="php-comment">// set remaining annotation data</span>
</span><span id="11601" class="l"><a href="#11601">11601: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] = <span class="php-quote">'Widget'</span>;
</span><span id="11602" class="l"><a href="#11602">11602: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'ft'</span>] = <span class="php-quote">'Btn'</span>;
</span><span id="11603" class="l"><a href="#11603">11603: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'t'</span>] = <span class="php-var">$name</span>;
</span><span id="11604" class="l"><a href="#11604">11604: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'opt'</span>] = <span class="php-keyword1">array</span>(<span class="php-var">$onvalue</span>);
</span><span id="11605" class="l"><a href="#11605">11605: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$checked</span>) {
</span><span id="11606" class="l"><a href="#11606">11606: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'/0'</span>);
</span><span id="11607" class="l"><a href="#11607">11607: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'as'</span>] = <span class="php-quote">'Yes'</span>;
</span><span id="11608" class="l"><a href="#11608">11608: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11609" class="l"><a href="#11609">11609: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'/Off'</span>);
</span><span id="11610" class="l"><a href="#11610">11610: </a>                <span class="php-var">$opt</span>[<span class="php-quote">'as'</span>] = <span class="php-quote">'Off'</span>;
</span><span id="11611" class="l"><a href="#11611">11611: </a>            }
</span><span id="11612" class="l"><a href="#11612">11612: </a>            <span class="php-var">$this</span>-&gt;Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$w</span>, <span class="php-var">$name</span>, <span class="php-var">$opt</span>, <span class="php-num">0</span>);
</span><span id="11613" class="l"><a href="#11613">11613: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="11614" class="l"><a href="#11614">11614: </a>                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="11615" class="l"><a href="#11615">11615: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11616" class="l"><a href="#11616">11616: </a>                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="11617" class="l"><a href="#11617">11617: </a>            }
</span><span id="11618" class="l"><a href="#11618">11618: </a>        }
</span><span id="11619" class="l"><a href="#11619">11619: </a>
</span><span id="11620" class="l"><a href="#11620">11620: </a>        <span class="php-comment">/**
</span></span><span id="11621" class="l"><a href="#11621">11621: </a><span class="php-comment">         * Creates a button field
</span></span><span id="11622" class="l"><a href="#11622">11622: </a><span class="php-comment">         * @param string $name field name
</span></span><span id="11623" class="l"><a href="#11623">11623: </a><span class="php-comment">         * @param int $w width
</span></span><span id="11624" class="l"><a href="#11624">11624: </a><span class="php-comment">         * @param int $h height
</span></span><span id="11625" class="l"><a href="#11625">11625: </a><span class="php-comment">         * @param string $caption caption.
</span></span><span id="11626" class="l"><a href="#11626">11626: </a><span class="php-comment">         * @param mixed $action action triggered by pressing the button. Use a string to specify a javascript action. Use an array to specify a form action options as on section 12.7.5 of PDF32000_2008.
</span></span><span id="11627" class="l"><a href="#11627">11627: </a><span class="php-comment">         * @param array $prop javascript field properties. Possible values are described on official Javascript for Acrobat API reference.
</span></span><span id="11628" class="l"><a href="#11628">11628: </a><span class="php-comment">         * @param array $opt annotation parameters. Possible values are described on official PDF32000_2008 reference.
</span></span><span id="11629" class="l"><a href="#11629">11629: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner of the rectangle
</span></span><span id="11630" class="l"><a href="#11630">11630: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner of the rectangle
</span></span><span id="11631" class="l"><a href="#11631">11631: </a><span class="php-comment">         * @param boolean $js if true put the field using JavaScript (requires Acrobat Writer to be rendered).
</span></span><span id="11632" class="l"><a href="#11632">11632: </a><span class="php-comment">         * @access public
</span></span><span id="11633" class="l"><a href="#11633">11633: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11634" class="l"><a href="#11634">11634: </a><span class="php-comment">         * @since 4.8.000 (2009-09-07)
</span></span><span id="11635" class="l"><a href="#11635">11635: </a><span class="php-comment">         */</span>
</span><span id="11636" class="l"><a href="#11636">11636: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Button(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$caption</span>, <span class="php-var">$action</span>, <span class="php-var">$prop</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$opt</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$js</span>=<span class="php-keyword1">false</span>) {
</span><span id="11637" class="l"><a href="#11637">11637: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="11638" class="l"><a href="#11638">11638: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="11639" class="l"><a href="#11639">11639: </a>            }
</span><span id="11640" class="l"><a href="#11640">11640: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="11641" class="l"><a href="#11641">11641: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="11642" class="l"><a href="#11642">11642: </a>            }
</span><span id="11643" class="l"><a href="#11643">11643: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$js</span>) {
</span><span id="11644" class="l"><a href="#11644">11644: </a>                <span class="php-var">$this</span>-&gt;_addfield(<span class="php-quote">'button'</span>, <span class="php-var">$name</span>, <span class="php-var">$this</span>-&gt;x, <span class="php-var">$this</span>-&gt;y, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>);
</span><span id="11645" class="l"><a href="#11645">11645: </a>                <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">&quot;.buttonSetCaption('&quot;</span>.<span class="php-keyword2">addslashes</span>(<span class="php-var">$caption</span>).<span class="php-quote">&quot;');\n&quot;</span>;
</span><span id="11646" class="l"><a href="#11646">11646: </a>                <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">&quot;.setAction('MouseUp','&quot;</span>.<span class="php-keyword2">addslashes</span>(<span class="php-var">$action</span>).<span class="php-quote">&quot;');\n&quot;</span>;
</span><span id="11647" class="l"><a href="#11647">11647: </a>                <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">&quot;.highlight='push';\n&quot;</span>;
</span><span id="11648" class="l"><a href="#11648">11648: </a>                <span class="php-var">$this</span>-&gt;javascript .= <span class="php-quote">'f'</span>.<span class="php-var">$name</span>.<span class="php-quote">&quot;.print=false;\n&quot;</span>;
</span><span id="11649" class="l"><a href="#11649">11649: </a>                <span class="php-keyword1">return</span>;
</span><span id="11650" class="l"><a href="#11650">11650: </a>            }
</span><span id="11651" class="l"><a href="#11651">11651: </a>            <span class="php-comment">// get default style</span>
</span><span id="11652" class="l"><a href="#11652">11652: </a>            <span class="php-var">$prop</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$this</span>-&gt;getFormDefaultProp(), <span class="php-var">$prop</span>);
</span><span id="11653" class="l"><a href="#11653">11653: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'Pushbutton'</span>] = <span class="php-quote">'true'</span>;
</span><span id="11654" class="l"><a href="#11654">11654: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'highlight'</span>] = <span class="php-quote">'push'</span>;
</span><span id="11655" class="l"><a href="#11655">11655: </a>            <span class="php-var">$prop</span>[<span class="php-quote">'display'</span>] = <span class="php-quote">'display.noPrint'</span>;
</span><span id="11656" class="l"><a href="#11656">11656: </a>            <span class="php-comment">// get annotation data</span>
</span><span id="11657" class="l"><a href="#11657">11657: </a>            <span class="php-var">$popt</span> = <span class="php-var">$this</span>-&gt;getAnnotOptFromJSProp(<span class="php-var">$prop</span>);
</span><span id="11658" class="l"><a href="#11658">11658: </a>            <span class="php-comment">// set additional default options</span>
</span><span id="11659" class="l"><a href="#11659">11659: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>])) {
</span><span id="11660" class="l"><a href="#11660">11660: </a>                <span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11661" class="l"><a href="#11661">11661: </a>            }
</span><span id="11662" class="l"><a href="#11662">11662: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ca'</span>] = <span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$caption</span>);
</span><span id="11663" class="l"><a href="#11663">11663: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'rc'</span>] = <span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$caption</span>);
</span><span id="11664" class="l"><a href="#11664">11664: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'mk'</span>][<span class="php-quote">'ac'</span>] = <span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$caption</span>);
</span><span id="11665" class="l"><a href="#11665">11665: </a>            <span class="php-var">$font</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="11666" class="l"><a href="#11666">11666: </a>            <span class="php-var">$fontkey</span> = <span class="php-keyword2">array_search</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys);
</span><span id="11667" class="l"><a href="#11667">11667: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$fontkey</span>, <span class="php-var">$this</span>-&gt;annotation_fonts)) {
</span><span id="11668" class="l"><a href="#11668">11668: </a>                <span class="php-var">$this</span>-&gt;annotation_fonts[<span class="php-var">$font</span>] = <span class="php-var">$fontkey</span>;
</span><span id="11669" class="l"><a href="#11669">11669: </a>            }
</span><span id="11670" class="l"><a href="#11670">11670: </a>            <span class="php-var">$fontstyle</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'/F%d %.2F Tf %s'</span>, (<span class="php-var">$fontkey</span> + <span class="php-num">1</span>), <span class="php-var">$this</span>-&gt;FontSizePt, <span class="php-var">$this</span>-&gt;TextColor);
</span><span id="11671" class="l"><a href="#11671">11671: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'da'</span>] = <span class="php-var">$fontstyle</span>;
</span><span id="11672" class="l"><a href="#11672">11672: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>] = <span class="php-keyword1">array</span>();
</span><span id="11673" class="l"><a href="#11673">11673: </a>            <span class="php-var">$popt</span>[<span class="php-quote">'ap'</span>][<span class="php-quote">'n'</span>] = <span class="php-quote">'q BT '</span>.<span class="php-var">$fontstyle</span>.<span class="php-quote">' ET Q'</span>;
</span><span id="11674" class="l"><a href="#11674">11674: </a>            <span class="php-comment">// merge options</span>
</span><span id="11675" class="l"><a href="#11675">11675: </a>            <span class="php-var">$opt</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$popt</span>, <span class="php-var">$opt</span>);
</span><span id="11676" class="l"><a href="#11676">11676: </a>            <span class="php-comment">// set remaining annotation data</span>
</span><span id="11677" class="l"><a href="#11677">11677: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'Subtype'</span>] = <span class="php-quote">'Widget'</span>;
</span><span id="11678" class="l"><a href="#11678">11678: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'ft'</span>] = <span class="php-quote">'Btn'</span>;
</span><span id="11679" class="l"><a href="#11679">11679: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'t'</span>] = <span class="php-var">$caption</span>;
</span><span id="11680" class="l"><a href="#11680">11680: </a>            <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-var">$name</span>;
</span><span id="11681" class="l"><a href="#11681">11681: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$action</span>)) {
</span><span id="11682" class="l"><a href="#11682">11682: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$action</span>)) {
</span><span id="11683" class="l"><a href="#11683">11683: </a>                    <span class="php-comment">// form action options as on section 12.7.5 of PDF32000_2008.</span>
</span><span id="11684" class="l"><a href="#11684">11684: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] = <span class="php-quote">'/D &lt;&lt;'</span>;
</span><span id="11685" class="l"><a href="#11685">11685: </a>                    <span class="php-var">$bmode</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'SubmitForm'</span>, <span class="php-quote">'ResetForm'</span>, <span class="php-quote">'ImportData'</span>);
</span><span id="11686" class="l"><a href="#11686">11686: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$action</span> <span class="php-keyword1">AS</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="11687" class="l"><a href="#11687">11687: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$key</span> == <span class="php-quote">'S'</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$val</span>, <span class="php-var">$bmode</span>)) {
</span><span id="11688" class="l"><a href="#11688">11688: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] .= <span class="php-quote">' /S /'</span>.<span class="php-var">$val</span>;
</span><span id="11689" class="l"><a href="#11689">11689: </a>                        } <span class="php-keyword1">elseif</span> ((<span class="php-var">$key</span> == <span class="php-quote">'F'</span>) <span class="php-keyword1">AND</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$val</span>))) {
</span><span id="11690" class="l"><a href="#11690">11690: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] .= <span class="php-quote">' /F '</span>.<span class="php-var">$this</span>-&gt;_datastring(<span class="php-var">$val</span>);
</span><span id="11691" class="l"><a href="#11691">11691: </a>                        } <span class="php-keyword1">elseif</span> ((<span class="php-var">$key</span> == <span class="php-quote">'Fields'</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_array</span>(<span class="php-var">$val</span>) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$val</span>)) {
</span><span id="11692" class="l"><a href="#11692">11692: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] .= <span class="php-quote">' /Fields ['</span>;
</span><span id="11693" class="l"><a href="#11693">11693: </a>                            <span class="php-keyword1">foreach</span> (<span class="php-var">$val</span> <span class="php-keyword1">AS</span> <span class="php-var">$field</span>) {
</span><span id="11694" class="l"><a href="#11694">11694: </a>                                <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$field</span>);
</span><span id="11695" class="l"><a href="#11695">11695: </a>                            }
</span><span id="11696" class="l"><a href="#11696">11696: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] .= <span class="php-quote">']'</span>;
</span><span id="11697" class="l"><a href="#11697">11697: </a>                        } <span class="php-keyword1">elseif</span> ((<span class="php-var">$key</span> == <span class="php-quote">'Flags'</span>)) {
</span><span id="11698" class="l"><a href="#11698">11698: </a>                            <span class="php-var">$ff</span> = <span class="php-num">0</span>;
</span><span id="11699" class="l"><a href="#11699">11699: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$val</span>)) {
</span><span id="11700" class="l"><a href="#11700">11700: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$val</span> <span class="php-keyword1">AS</span> <span class="php-var">$flag</span>) {
</span><span id="11701" class="l"><a href="#11701">11701: </a>                                    <span class="php-keyword1">switch</span> (<span class="php-var">$flag</span>) {
</span><span id="11702" class="l"><a href="#11702">11702: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'Include/Exclude'</span>: {
</span><span id="11703" class="l"><a href="#11703">11703: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">0</span>;
</span><span id="11704" class="l"><a href="#11704">11704: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11705" class="l"><a href="#11705">11705: </a>                                        }
</span><span id="11706" class="l"><a href="#11706">11706: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'IncludeNoValueFields'</span>: {
</span><span id="11707" class="l"><a href="#11707">11707: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">1</span>;
</span><span id="11708" class="l"><a href="#11708">11708: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11709" class="l"><a href="#11709">11709: </a>                                        }
</span><span id="11710" class="l"><a href="#11710">11710: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'ExportFormat'</span>: {
</span><span id="11711" class="l"><a href="#11711">11711: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">2</span>;
</span><span id="11712" class="l"><a href="#11712">11712: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11713" class="l"><a href="#11713">11713: </a>                                        }
</span><span id="11714" class="l"><a href="#11714">11714: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'GetMethod'</span>: {
</span><span id="11715" class="l"><a href="#11715">11715: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">3</span>;
</span><span id="11716" class="l"><a href="#11716">11716: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11717" class="l"><a href="#11717">11717: </a>                                        }
</span><span id="11718" class="l"><a href="#11718">11718: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'SubmitCoordinates'</span>: {
</span><span id="11719" class="l"><a href="#11719">11719: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">4</span>;
</span><span id="11720" class="l"><a href="#11720">11720: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11721" class="l"><a href="#11721">11721: </a>                                        }
</span><span id="11722" class="l"><a href="#11722">11722: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'XFDF'</span>: {
</span><span id="11723" class="l"><a href="#11723">11723: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">5</span>;
</span><span id="11724" class="l"><a href="#11724">11724: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11725" class="l"><a href="#11725">11725: </a>                                        }
</span><span id="11726" class="l"><a href="#11726">11726: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'IncludeAppendSaves'</span>: {
</span><span id="11727" class="l"><a href="#11727">11727: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">6</span>;
</span><span id="11728" class="l"><a href="#11728">11728: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11729" class="l"><a href="#11729">11729: </a>                                        }
</span><span id="11730" class="l"><a href="#11730">11730: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'IncludeAnnotations'</span>: {
</span><span id="11731" class="l"><a href="#11731">11731: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">7</span>;
</span><span id="11732" class="l"><a href="#11732">11732: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11733" class="l"><a href="#11733">11733: </a>                                        }
</span><span id="11734" class="l"><a href="#11734">11734: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'SubmitPDF'</span>: {
</span><span id="11735" class="l"><a href="#11735">11735: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">8</span>;
</span><span id="11736" class="l"><a href="#11736">11736: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11737" class="l"><a href="#11737">11737: </a>                                        }
</span><span id="11738" class="l"><a href="#11738">11738: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'CanonicalFormat'</span>: {
</span><span id="11739" class="l"><a href="#11739">11739: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">9</span>;
</span><span id="11740" class="l"><a href="#11740">11740: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11741" class="l"><a href="#11741">11741: </a>                                        }
</span><span id="11742" class="l"><a href="#11742">11742: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'ExclNonUserAnnots'</span>: {
</span><span id="11743" class="l"><a href="#11743">11743: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">10</span>;
</span><span id="11744" class="l"><a href="#11744">11744: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11745" class="l"><a href="#11745">11745: </a>                                        }
</span><span id="11746" class="l"><a href="#11746">11746: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'ExclFKey'</span>: {
</span><span id="11747" class="l"><a href="#11747">11747: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">11</span>;
</span><span id="11748" class="l"><a href="#11748">11748: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11749" class="l"><a href="#11749">11749: </a>                                        }
</span><span id="11750" class="l"><a href="#11750">11750: </a>                                        <span class="php-keyword1">case</span> <span class="php-quote">'EmbedForm'</span>: {
</span><span id="11751" class="l"><a href="#11751">11751: </a>                                            <span class="php-var">$ff</span> += <span class="php-num">1</span> &lt;&lt; <span class="php-num">13</span>;
</span><span id="11752" class="l"><a href="#11752">11752: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="11753" class="l"><a href="#11753">11753: </a>                                        }
</span><span id="11754" class="l"><a href="#11754">11754: </a>                                    }
</span><span id="11755" class="l"><a href="#11755">11755: </a>                                }
</span><span id="11756" class="l"><a href="#11756">11756: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="11757" class="l"><a href="#11757">11757: </a>                                <span class="php-var">$ff</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$val</span>);
</span><span id="11758" class="l"><a href="#11758">11758: </a>                            }
</span><span id="11759" class="l"><a href="#11759">11759: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] .= <span class="php-quote">' /Flags '</span>.<span class="php-var">$ff</span>;
</span><span id="11760" class="l"><a href="#11760">11760: </a>                        }
</span><span id="11761" class="l"><a href="#11761">11761: </a>                    }
</span><span id="11762" class="l"><a href="#11762">11762: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="11763" class="l"><a href="#11763">11763: </a>                } <span class="php-keyword1">else</span> {
</span><span id="11764" class="l"><a href="#11764">11764: </a>                    <span class="php-comment">// Javascript action or raw action command</span>
</span><span id="11765" class="l"><a href="#11765">11765: </a>                    <span class="php-var">$js_obj_id</span> = <span class="php-var">$this</span>-&gt;addJavascriptObject(<span class="php-var">$action</span>);
</span><span id="11766" class="l"><a href="#11766">11766: </a>                    <span class="php-var">$opt</span>[<span class="php-quote">'aa'</span>] = <span class="php-quote">'/D '</span>.<span class="php-var">$js_obj_id</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="11767" class="l"><a href="#11767">11767: </a>                }
</span><span id="11768" class="l"><a href="#11768">11768: </a>            }
</span><span id="11769" class="l"><a href="#11769">11769: </a>            <span class="php-var">$this</span>-&gt;Annotation(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$name</span>, <span class="php-var">$opt</span>, <span class="php-num">0</span>);
</span><span id="11770" class="l"><a href="#11770">11770: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="11771" class="l"><a href="#11771">11771: </a>                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$w</span>;
</span><span id="11772" class="l"><a href="#11772">11772: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11773" class="l"><a href="#11773">11773: </a>                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="11774" class="l"><a href="#11774">11774: </a>            }
</span><span id="11775" class="l"><a href="#11775">11775: </a>        }
</span><span id="11776" class="l"><a href="#11776">11776: </a>
</span><span id="11777" class="l"><a href="#11777">11777: </a>        <span class="php-comment">// --- END FORMS FIELDS ------------------------------------------------</span>
</span><span id="11778" class="l"><a href="#11778">11778: </a>
</span><span id="11779" class="l"><a href="#11779">11779: </a>        <span class="php-comment">/**
</span></span><span id="11780" class="l"><a href="#11780">11780: </a><span class="php-comment">         * Add certification signature (DocMDP or UR3)
</span></span><span id="11781" class="l"><a href="#11781">11781: </a><span class="php-comment">         * You can set only one signature type
</span></span><span id="11782" class="l"><a href="#11782">11782: </a><span class="php-comment">         * @access protected
</span></span><span id="11783" class="l"><a href="#11783">11783: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11784" class="l"><a href="#11784">11784: </a><span class="php-comment">         * @since 4.6.008 (2009-05-07)
</span></span><span id="11785" class="l"><a href="#11785">11785: </a><span class="php-comment">         */</span>
</span><span id="11786" class="l"><a href="#11786">11786: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putsignature() {
</span><span id="11787" class="l"><a href="#11787">11787: </a>            <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;sign) <span class="php-keyword1">OR</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>]))) {
</span><span id="11788" class="l"><a href="#11788">11788: </a>                <span class="php-keyword1">return</span>;
</span><span id="11789" class="l"><a href="#11789">11789: </a>            }
</span><span id="11790" class="l"><a href="#11790">11790: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="11791" class="l"><a href="#11791">11791: </a>            <span class="php-var">$out</span> = <span class="php-quote">' &lt;&lt; /Type /Sig'</span>;
</span><span id="11792" class="l"><a href="#11792">11792: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Filter /Adobe.PPKLite'</span>;
</span><span id="11793" class="l"><a href="#11793">11793: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /SubFilter /adbe.pkcs7.detached'</span>;
</span><span id="11794" class="l"><a href="#11794">11794: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;byterange_string;
</span><span id="11795" class="l"><a href="#11795">11795: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Contents&lt;&gt;'</span>.<span class="php-keyword2">str_repeat</span>(<span class="php-quote">' '</span>, <span class="php-var">$this</span>-&gt;signature_max_length);
</span><span id="11796" class="l"><a href="#11796">11796: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /Reference'</span>;
</span><span id="11797" class="l"><a href="#11797">11797: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' ['</span>;
</span><span id="11798" class="l"><a href="#11798">11798: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &lt;&lt; /Type /SigRef'</span>;
</span><span id="11799" class="l"><a href="#11799">11799: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>] &gt; <span class="php-num">0</span>) {
</span><span id="11800" class="l"><a href="#11800">11800: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /TransformMethod /DocMDP'</span>;
</span><span id="11801" class="l"><a href="#11801">11801: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /TransformParams'</span>;
</span><span id="11802" class="l"><a href="#11802">11802: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &lt;&lt;'</span>;
</span><span id="11803" class="l"><a href="#11803">11803: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Type /TransformParams'</span>;
</span><span id="11804" class="l"><a href="#11804">11804: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /V /1.2'</span>;
</span><span id="11805" class="l"><a href="#11805">11805: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /P '</span>.<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>];
</span><span id="11806" class="l"><a href="#11806">11806: </a>            } <span class="php-keyword1">else</span> {
</span><span id="11807" class="l"><a href="#11807">11807: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /TransformMethod /UR3'</span>;
</span><span id="11808" class="l"><a href="#11808">11808: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /TransformParams'</span>;
</span><span id="11809" class="l"><a href="#11809">11809: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &lt;&lt; /Type /TransformParams'</span>;
</span><span id="11810" class="l"><a href="#11810">11810: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /V /2.2'</span>;
</span><span id="11811" class="l"><a href="#11811">11811: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;ur_document)) {
</span><span id="11812" class="l"><a href="#11812">11812: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Document['</span>.<span class="php-var">$this</span>-&gt;ur_document.<span class="php-quote">']'</span>;
</span><span id="11813" class="l"><a href="#11813">11813: </a>                }
</span><span id="11814" class="l"><a href="#11814">11814: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;ur_annots)) {
</span><span id="11815" class="l"><a href="#11815">11815: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Annots['</span>.<span class="php-var">$this</span>-&gt;ur_annots.<span class="php-quote">']'</span>;
</span><span id="11816" class="l"><a href="#11816">11816: </a>                }
</span><span id="11817" class="l"><a href="#11817">11817: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;ur_form)) {
</span><span id="11818" class="l"><a href="#11818">11818: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Form['</span>.<span class="php-var">$this</span>-&gt;ur_form.<span class="php-quote">']'</span>;
</span><span id="11819" class="l"><a href="#11819">11819: </a>                }
</span><span id="11820" class="l"><a href="#11820">11820: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;ur_signature)) {
</span><span id="11821" class="l"><a href="#11821">11821: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Signature['</span>.<span class="php-var">$this</span>-&gt;ur_signature.<span class="php-quote">']'</span>;
</span><span id="11822" class="l"><a href="#11822">11822: </a>                }
</span><span id="11823" class="l"><a href="#11823">11823: </a>            }
</span><span id="11824" class="l"><a href="#11824">11824: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; &gt;&gt; ]'</span>;
</span><span id="11825" class="l"><a href="#11825">11825: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Name'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Name'</span>])) {
</span><span id="11826" class="l"><a href="#11826">11826: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Name '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Name'</span>]);
</span><span id="11827" class="l"><a href="#11827">11827: </a>            }
</span><span id="11828" class="l"><a href="#11828">11828: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Location'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Location'</span>])) {
</span><span id="11829" class="l"><a href="#11829">11829: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Location '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Location'</span>]);
</span><span id="11830" class="l"><a href="#11830">11830: </a>            }
</span><span id="11831" class="l"><a href="#11831">11831: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Reason'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Reason'</span>])) {
</span><span id="11832" class="l"><a href="#11832">11832: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Reason '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'Reason'</span>]);
</span><span id="11833" class="l"><a href="#11833">11833: </a>            }
</span><span id="11834" class="l"><a href="#11834">11834: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'ContactInfo'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'ContactInfo'</span>])) {
</span><span id="11835" class="l"><a href="#11835">11835: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /ContactInfo '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>][<span class="php-quote">'ContactInfo'</span>]);
</span><span id="11836" class="l"><a href="#11836">11836: </a>            }
</span><span id="11837" class="l"><a href="#11837">11837: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' /M '</span>.<span class="php-var">$this</span>-&gt;_datestring();
</span><span id="11838" class="l"><a href="#11838">11838: </a>            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="11839" class="l"><a href="#11839">11839: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="11840" class="l"><a href="#11840">11840: </a>        }
</span><span id="11841" class="l"><a href="#11841">11841: </a>
</span><span id="11842" class="l"><a href="#11842">11842: </a>        <span class="php-comment">/**
</span></span><span id="11843" class="l"><a href="#11843">11843: </a><span class="php-comment">         * Set User's Rights for PDF Reader
</span></span><span id="11844" class="l"><a href="#11844">11844: </a><span class="php-comment">         * WARNING: This works only using the Adobe private key with the setSignature() method!.
</span></span><span id="11845" class="l"><a href="#11845">11845: </a><span class="php-comment">         * Check the PDF Reference 8.7.1 Transform Methods,
</span></span><span id="11846" class="l"><a href="#11846">11846: </a><span class="php-comment">         * Table 8.105 Entries in the UR transform parameters dictionary
</span></span><span id="11847" class="l"><a href="#11847">11847: </a><span class="php-comment">         * @param boolean $enable if true enable user's rights on PDF reader
</span></span><span id="11848" class="l"><a href="#11848">11848: </a><span class="php-comment">         * @param string $document Names specifying additional document-wide usage rights for the document. The only defined value is &quot;/FullSave&quot;, which permits a user to save the document along with modified form and/or annotation data.
</span></span><span id="11849" class="l"><a href="#11849">11849: </a><span class="php-comment">         * @param string $annots Names specifying additional annotation-related usage rights for the document. Valid names in PDF 1.5 and later are /Create/Delete/Modify/Copy/Import/Export, which permit the user to perform the named operation on annotations.
</span></span><span id="11850" class="l"><a href="#11850">11850: </a><span class="php-comment">         * @param string $form Names specifying additional form-field-related usage rights for the document. Valid names are: /Add/Delete/FillIn/Import/Export/SubmitStandalone/SpawnTemplate
</span></span><span id="11851" class="l"><a href="#11851">11851: </a><span class="php-comment">         * @param string $signature Names specifying additional signature-related usage rights for the document. The only defined value is /Modify, which permits a user to apply a digital signature to an existing signature form field or clear a signed signature form field.
</span></span><span id="11852" class="l"><a href="#11852">11852: </a><span class="php-comment">         * @access public
</span></span><span id="11853" class="l"><a href="#11853">11853: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11854" class="l"><a href="#11854">11854: </a><span class="php-comment">         * @since 2.9.000 (2008-03-26)
</span></span><span id="11855" class="l"><a href="#11855">11855: </a><span class="php-comment">         */</span>
</span><span id="11856" class="l"><a href="#11856">11856: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setUserRights(
</span><span id="11857" class="l"><a href="#11857">11857: </a>                <span class="php-var">$enable</span>=<span class="php-keyword1">true</span>,
</span><span id="11858" class="l"><a href="#11858">11858: </a>                <span class="php-var">$document</span>=<span class="php-quote">'/FullSave'</span>,
</span><span id="11859" class="l"><a href="#11859">11859: </a>                <span class="php-var">$annots</span>=<span class="php-quote">'/Create/Delete/Modify/Copy/Import/Export'</span>,
</span><span id="11860" class="l"><a href="#11860">11860: </a>                <span class="php-var">$form</span>=<span class="php-quote">'/Add/Delete/FillIn/Import/Export/SubmitStandalone/SpawnTemplate'</span>,
</span><span id="11861" class="l"><a href="#11861">11861: </a>                <span class="php-var">$signature</span>=<span class="php-quote">'/Modify'</span>) {
</span><span id="11862" class="l"><a href="#11862">11862: </a>            <span class="php-var">$this</span>-&gt;ur = <span class="php-var">$enable</span>;
</span><span id="11863" class="l"><a href="#11863">11863: </a>            <span class="php-var">$this</span>-&gt;ur_document = <span class="php-var">$document</span>;
</span><span id="11864" class="l"><a href="#11864">11864: </a>            <span class="php-var">$this</span>-&gt;ur_annots = <span class="php-var">$annots</span>;
</span><span id="11865" class="l"><a href="#11865">11865: </a>            <span class="php-var">$this</span>-&gt;ur_form = <span class="php-var">$form</span>;
</span><span id="11866" class="l"><a href="#11866">11866: </a>            <span class="php-var">$this</span>-&gt;ur_signature = <span class="php-var">$signature</span>;
</span><span id="11867" class="l"><a href="#11867">11867: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;sign) {
</span><span id="11868" class="l"><a href="#11868">11868: </a>                <span class="php-comment">// This signature only works using the Adobe Private key that is unavailable!</span>
</span><span id="11869" class="l"><a href="#11869">11869: </a>                <span class="php-var">$this</span>-&gt;setSignature(<span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-keyword1">array</span>());
</span><span id="11870" class="l"><a href="#11870">11870: </a>            }
</span><span id="11871" class="l"><a href="#11871">11871: </a>        }
</span><span id="11872" class="l"><a href="#11872">11872: </a>
</span><span id="11873" class="l"><a href="#11873">11873: </a>        <span class="php-comment">/**
</span></span><span id="11874" class="l"><a href="#11874">11874: </a><span class="php-comment">         * Enable document signature (requires the OpenSSL Library).
</span></span><span id="11875" class="l"><a href="#11875">11875: </a><span class="php-comment">         * The digital signature improve document authenticity and integrity and allows o enable extra features on Acrobat Reader.
</span></span><span id="11876" class="l"><a href="#11876">11876: </a><span class="php-comment">         * @param mixed $signing_cert signing certificate (string or filename prefixed with 'file://')
</span></span><span id="11877" class="l"><a href="#11877">11877: </a><span class="php-comment">         * @param mixed $private_key private key (string or filename prefixed with 'file://')
</span></span><span id="11878" class="l"><a href="#11878">11878: </a><span class="php-comment">         * @param string $private_key_password password
</span></span><span id="11879" class="l"><a href="#11879">11879: </a><span class="php-comment">         * @param string $extracerts specifies the name of a file containing a bunch of extra certificates to include in the signature which can for example be used to help the recipient to verify the certificate that you used.
</span></span><span id="11880" class="l"><a href="#11880">11880: </a><span class="php-comment">         * @param int $cert_type The access permissions granted for this document. Valid values shall be: 1 = No changes to the document shall be permitted; any change to the document shall invalidate the signature; 2 = Permitted changes shall be filling in forms, instantiating page templates, and signing; other changes shall invalidate the signature; 3 = Permitted changes shall be the same as for 2, as well as annotation creation, deletion, and modification; other changes shall invalidate the signature.
</span></span><span id="11881" class="l"><a href="#11881">11881: </a><span class="php-comment">         * @param array $info array of option information: Name, Location, Reason, ContactInfo.
</span></span><span id="11882" class="l"><a href="#11882">11882: </a><span class="php-comment">         * @access public
</span></span><span id="11883" class="l"><a href="#11883">11883: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="11884" class="l"><a href="#11884">11884: </a><span class="php-comment">         * @since 4.6.005 (2009-04-24)
</span></span><span id="11885" class="l"><a href="#11885">11885: </a><span class="php-comment">         */</span>
</span><span id="11886" class="l"><a href="#11886">11886: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setSignature(<span class="php-var">$signing_cert</span>=<span class="php-quote">''</span>, <span class="php-var">$private_key</span>=<span class="php-quote">''</span>, <span class="php-var">$private_key_password</span>=<span class="php-quote">''</span>, <span class="php-var">$extracerts</span>=<span class="php-quote">''</span>, <span class="php-var">$cert_type</span>=<span class="php-num">2</span>, <span class="php-var">$info</span>=<span class="php-keyword1">array</span>()) {
</span><span id="11887" class="l"><a href="#11887">11887: </a>            <span class="php-comment">// to create self-signed signature: openssl req -x509 -nodes -days 365000 -newkey rsa:1024 -keyout tcpdf.crt -out tcpdf.crt</span>
</span><span id="11888" class="l"><a href="#11888">11888: </a>            <span class="php-comment">// to convert pfx certificate to pem: openssl</span>
</span><span id="11889" class="l"><a href="#11889">11889: </a>            <span class="php-comment">//     OpenSSL&gt; pkcs12 -in &lt;cert.pfx&gt; -out &lt;cert.crt&gt; -nodes</span>
</span><span id="11890" class="l"><a href="#11890">11890: </a>            <span class="php-var">$this</span>-&gt;sign = <span class="php-keyword1">true</span>;
</span><span id="11891" class="l"><a href="#11891">11891: </a>            <span class="php-var">$this</span>-&gt;signature_data = <span class="php-keyword1">array</span>();
</span><span id="11892" class="l"><a href="#11892">11892: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$signing_cert</span>) == <span class="php-num">0</span>) {
</span><span id="11893" class="l"><a href="#11893">11893: </a>                <span class="php-var">$signing_cert</span> = <span class="php-quote">'file://'</span>.<span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/tcpdf.crt'</span>;
</span><span id="11894" class="l"><a href="#11894">11894: </a>                <span class="php-var">$private_key_password</span> = <span class="php-quote">'tcpdfdemo'</span>;
</span><span id="11895" class="l"><a href="#11895">11895: </a>            }
</span><span id="11896" class="l"><a href="#11896">11896: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$private_key</span>) == <span class="php-num">0</span>) {
</span><span id="11897" class="l"><a href="#11897">11897: </a>                <span class="php-var">$private_key</span> = <span class="php-var">$signing_cert</span>;
</span><span id="11898" class="l"><a href="#11898">11898: </a>            }
</span><span id="11899" class="l"><a href="#11899">11899: </a>            <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'signcert'</span>] = <span class="php-var">$signing_cert</span>;
</span><span id="11900" class="l"><a href="#11900">11900: </a>            <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'privkey'</span>] = <span class="php-var">$private_key</span>;
</span><span id="11901" class="l"><a href="#11901">11901: </a>            <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'password'</span>] = <span class="php-var">$private_key_password</span>;
</span><span id="11902" class="l"><a href="#11902">11902: </a>            <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'extracerts'</span>] = <span class="php-var">$extracerts</span>;
</span><span id="11903" class="l"><a href="#11903">11903: </a>            <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'cert_type'</span>] = <span class="php-var">$cert_type</span>;
</span><span id="11904" class="l"><a href="#11904">11904: </a>            <span class="php-var">$this</span>-&gt;signature_data[<span class="php-quote">'info'</span>] = <span class="php-var">$info</span>;
</span><span id="11905" class="l"><a href="#11905">11905: </a>        }
</span><span id="11906" class="l"><a href="#11906">11906: </a>
</span><span id="11907" class="l"><a href="#11907">11907: </a>        <span class="php-comment">/**
</span></span><span id="11908" class="l"><a href="#11908">11908: </a><span class="php-comment">         * Create a new page group.
</span></span><span id="11909" class="l"><a href="#11909">11909: </a><span class="php-comment">         * NOTE: call this function before calling AddPage()
</span></span><span id="11910" class="l"><a href="#11910">11910: </a><span class="php-comment">         * @param int $page starting group page (leave empty for next page).
</span></span><span id="11911" class="l"><a href="#11911">11911: </a><span class="php-comment">         * @access public
</span></span><span id="11912" class="l"><a href="#11912">11912: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="11913" class="l"><a href="#11913">11913: </a><span class="php-comment">         */</span>
</span><span id="11914" class="l"><a href="#11914">11914: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> startPageGroup(<span class="php-var">$page</span>=<span class="php-quote">''</span>) {
</span><span id="11915" class="l"><a href="#11915">11915: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$page</span>)) {
</span><span id="11916" class="l"><a href="#11916">11916: </a>                <span class="php-var">$page</span> = <span class="php-var">$this</span>-&gt;page + <span class="php-num">1</span>;
</span><span id="11917" class="l"><a href="#11917">11917: </a>            }
</span><span id="11918" class="l"><a href="#11918">11918: </a>            <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$page</span>] = <span class="php-keyword1">true</span>;
</span><span id="11919" class="l"><a href="#11919">11919: </a>        }
</span><span id="11920" class="l"><a href="#11920">11920: </a>
</span><span id="11921" class="l"><a href="#11921">11921: </a>        <span class="php-comment">/**
</span></span><span id="11922" class="l"><a href="#11922">11922: </a><span class="php-comment">         * Defines an alias for the total number of pages.
</span></span><span id="11923" class="l"><a href="#11923">11923: </a><span class="php-comment">         * It will be substituted as the document is closed.
</span></span><span id="11924" class="l"><a href="#11924">11924: </a><span class="php-comment">         * @param string $alias The alias.
</span></span><span id="11925" class="l"><a href="#11925">11925: </a><span class="php-comment">         * @access public
</span></span><span id="11926" class="l"><a href="#11926">11926: </a><span class="php-comment">         * @since 1.4
</span></span><span id="11927" class="l"><a href="#11927">11927: </a><span class="php-comment">         * @see getAliasNbPages(), PageNo(), Footer()
</span></span><span id="11928" class="l"><a href="#11928">11928: </a><span class="php-comment">         */</span>
</span><span id="11929" class="l"><a href="#11929">11929: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> AliasNbPages(<span class="php-var">$alias</span>=<span class="php-quote">'{nb}'</span>) {
</span><span id="11930" class="l"><a href="#11930">11930: </a>            <span class="php-var">$this</span>-&gt;AliasNbPages = <span class="php-var">$alias</span>;
</span><span id="11931" class="l"><a href="#11931">11931: </a>        }
</span><span id="11932" class="l"><a href="#11932">11932: </a>
</span><span id="11933" class="l"><a href="#11933">11933: </a>        <span class="php-comment">/**
</span></span><span id="11934" class="l"><a href="#11934">11934: </a><span class="php-comment">         * Returns the string alias used for the total number of pages.
</span></span><span id="11935" class="l"><a href="#11935">11935: </a><span class="php-comment">         * If the current font is unicode type, the returned string is surrounded by additional curly braces.
</span></span><span id="11936" class="l"><a href="#11936">11936: </a><span class="php-comment">         * @return string
</span></span><span id="11937" class="l"><a href="#11937">11937: </a><span class="php-comment">         * @access public
</span></span><span id="11938" class="l"><a href="#11938">11938: </a><span class="php-comment">         * @since 4.0.018 (2008-08-08)
</span></span><span id="11939" class="l"><a href="#11939">11939: </a><span class="php-comment">         * @see AliasNbPages(), PageNo(), Footer()
</span></span><span id="11940" class="l"><a href="#11940">11940: </a><span class="php-comment">         */</span>
</span><span id="11941" class="l"><a href="#11941">11941: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getAliasNbPages() {
</span><span id="11942" class="l"><a href="#11942">11942: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="11943" class="l"><a href="#11943">11943: </a>                <span class="php-keyword1">return</span> <span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNbPages.<span class="php-quote">'}'</span>;
</span><span id="11944" class="l"><a href="#11944">11944: </a>            }
</span><span id="11945" class="l"><a href="#11945">11945: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;AliasNbPages;
</span><span id="11946" class="l"><a href="#11946">11946: </a>        }
</span><span id="11947" class="l"><a href="#11947">11947: </a>
</span><span id="11948" class="l"><a href="#11948">11948: </a>        <span class="php-comment">/**
</span></span><span id="11949" class="l"><a href="#11949">11949: </a><span class="php-comment">         * Defines an alias for the page number.
</span></span><span id="11950" class="l"><a href="#11950">11950: </a><span class="php-comment">         * It will be substituted as the document is closed.
</span></span><span id="11951" class="l"><a href="#11951">11951: </a><span class="php-comment">         * @param string $alias The alias.
</span></span><span id="11952" class="l"><a href="#11952">11952: </a><span class="php-comment">         * @access public
</span></span><span id="11953" class="l"><a href="#11953">11953: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="11954" class="l"><a href="#11954">11954: </a><span class="php-comment">         * @see getAliasNbPages(), PageNo(), Footer()
</span></span><span id="11955" class="l"><a href="#11955">11955: </a><span class="php-comment">         */</span>
</span><span id="11956" class="l"><a href="#11956">11956: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> AliasNumPage(<span class="php-var">$alias</span>=<span class="php-quote">'{pnb}'</span>) {
</span><span id="11957" class="l"><a href="#11957">11957: </a>            <span class="php-comment">//Define an alias for total number of pages</span>
</span><span id="11958" class="l"><a href="#11958">11958: </a>            <span class="php-var">$this</span>-&gt;AliasNumPage = <span class="php-var">$alias</span>;
</span><span id="11959" class="l"><a href="#11959">11959: </a>        }
</span><span id="11960" class="l"><a href="#11960">11960: </a>
</span><span id="11961" class="l"><a href="#11961">11961: </a>        <span class="php-comment">/**
</span></span><span id="11962" class="l"><a href="#11962">11962: </a><span class="php-comment">         * Returns the string alias used for the page number.
</span></span><span id="11963" class="l"><a href="#11963">11963: </a><span class="php-comment">         * If the current font is unicode type, the returned string is surrounded by additional curly braces.
</span></span><span id="11964" class="l"><a href="#11964">11964: </a><span class="php-comment">         * @return string
</span></span><span id="11965" class="l"><a href="#11965">11965: </a><span class="php-comment">         * @access public
</span></span><span id="11966" class="l"><a href="#11966">11966: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="11967" class="l"><a href="#11967">11967: </a><span class="php-comment">         * @see AliasNbPages(), PageNo(), Footer()
</span></span><span id="11968" class="l"><a href="#11968">11968: </a><span class="php-comment">         */</span>
</span><span id="11969" class="l"><a href="#11969">11969: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getAliasNumPage() {
</span><span id="11970" class="l"><a href="#11970">11970: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="11971" class="l"><a href="#11971">11971: </a>                <span class="php-keyword1">return</span> <span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;AliasNumPage.<span class="php-quote">'}'</span>;
</span><span id="11972" class="l"><a href="#11972">11972: </a>            }
</span><span id="11973" class="l"><a href="#11973">11973: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;AliasNumPage;
</span><span id="11974" class="l"><a href="#11974">11974: </a>        }
</span><span id="11975" class="l"><a href="#11975">11975: </a>
</span><span id="11976" class="l"><a href="#11976">11976: </a>        <span class="php-comment">/**
</span></span><span id="11977" class="l"><a href="#11977">11977: </a><span class="php-comment">         * Return the current page in the group.
</span></span><span id="11978" class="l"><a href="#11978">11978: </a><span class="php-comment">         * @return current page in the group
</span></span><span id="11979" class="l"><a href="#11979">11979: </a><span class="php-comment">         * @access public
</span></span><span id="11980" class="l"><a href="#11980">11980: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="11981" class="l"><a href="#11981">11981: </a><span class="php-comment">         */</span>
</span><span id="11982" class="l"><a href="#11982">11982: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getGroupPageNo() {
</span><span id="11983" class="l"><a href="#11983">11983: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;pagegroups[<span class="php-var">$this</span>-&gt;currpagegroup];
</span><span id="11984" class="l"><a href="#11984">11984: </a>        }
</span><span id="11985" class="l"><a href="#11985">11985: </a>
</span><span id="11986" class="l"><a href="#11986">11986: </a>        <span class="php-comment">/**
</span></span><span id="11987" class="l"><a href="#11987">11987: </a><span class="php-comment">         * Returns the current group page number formatted as a string.
</span></span><span id="11988" class="l"><a href="#11988">11988: </a><span class="php-comment">         * @access public
</span></span><span id="11989" class="l"><a href="#11989">11989: </a><span class="php-comment">         * @since 4.3.003 (2008-11-18)
</span></span><span id="11990" class="l"><a href="#11990">11990: </a><span class="php-comment">         * @see PaneNo(), formatPageNumber()
</span></span><span id="11991" class="l"><a href="#11991">11991: </a><span class="php-comment">         */</span>
</span><span id="11992" class="l"><a href="#11992">11992: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getGroupPageNoFormatted() {
</span><span id="11993" class="l"><a href="#11993">11993: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;formatPageNumber(<span class="php-var">$this</span>-&gt;getGroupPageNo());
</span><span id="11994" class="l"><a href="#11994">11994: </a>        }
</span><span id="11995" class="l"><a href="#11995">11995: </a>
</span><span id="11996" class="l"><a href="#11996">11996: </a>        <span class="php-comment">/**
</span></span><span id="11997" class="l"><a href="#11997">11997: </a><span class="php-comment">         * Return the alias of the current page group
</span></span><span id="11998" class="l"><a href="#11998">11998: </a><span class="php-comment">         * If the current font is unicode type, the returned string is surrounded by additional curly braces.
</span></span><span id="11999" class="l"><a href="#11999">11999: </a><span class="php-comment">         * (will be replaced by the total number of pages in this group).
</span></span><span id="12000" class="l"><a href="#12000">12000: </a><span class="php-comment">         * @return alias of the current page group
</span></span><span id="12001" class="l"><a href="#12001">12001: </a><span class="php-comment">         * @access public
</span></span><span id="12002" class="l"><a href="#12002">12002: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12003" class="l"><a href="#12003">12003: </a><span class="php-comment">         */</span>
</span><span id="12004" class="l"><a href="#12004">12004: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getPageGroupAlias() {
</span><span id="12005" class="l"><a href="#12005">12005: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="12006" class="l"><a href="#12006">12006: </a>                <span class="php-keyword1">return</span> <span class="php-quote">'{'</span>.<span class="php-var">$this</span>-&gt;currpagegroup.<span class="php-quote">'}'</span>;
</span><span id="12007" class="l"><a href="#12007">12007: </a>            }
</span><span id="12008" class="l"><a href="#12008">12008: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;currpagegroup;
</span><span id="12009" class="l"><a href="#12009">12009: </a>        }
</span><span id="12010" class="l"><a href="#12010">12010: </a>
</span><span id="12011" class="l"><a href="#12011">12011: </a>        <span class="php-comment">/**
</span></span><span id="12012" class="l"><a href="#12012">12012: </a><span class="php-comment">         * Return the alias for the page number on the current page group
</span></span><span id="12013" class="l"><a href="#12013">12013: </a><span class="php-comment">         * If the current font is unicode type, the returned string is surrounded by additional curly braces.
</span></span><span id="12014" class="l"><a href="#12014">12014: </a><span class="php-comment">         * (will be replaced by the total number of pages in this group).
</span></span><span id="12015" class="l"><a href="#12015">12015: </a><span class="php-comment">         * @return alias of the current page group
</span></span><span id="12016" class="l"><a href="#12016">12016: </a><span class="php-comment">         * @access public
</span></span><span id="12017" class="l"><a href="#12017">12017: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="12018" class="l"><a href="#12018">12018: </a><span class="php-comment">         */</span>
</span><span id="12019" class="l"><a href="#12019">12019: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getPageNumGroupAlias() {
</span><span id="12020" class="l"><a href="#12020">12020: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="12021" class="l"><a href="#12021">12021: </a>                <span class="php-keyword1">return</span> <span class="php-quote">'{'</span>.<span class="php-keyword2">str_replace</span>(<span class="php-quote">'{nb'</span>, <span class="php-quote">'{pnb'</span>, <span class="php-var">$this</span>-&gt;currpagegroup).<span class="php-quote">'}'</span>;
</span><span id="12022" class="l"><a href="#12022">12022: </a>            }
</span><span id="12023" class="l"><a href="#12023">12023: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">str_replace</span>(<span class="php-quote">'{nb'</span>, <span class="php-quote">'{pnb'</span>, <span class="php-var">$this</span>-&gt;currpagegroup);
</span><span id="12024" class="l"><a href="#12024">12024: </a>        }
</span><span id="12025" class="l"><a href="#12025">12025: </a>
</span><span id="12026" class="l"><a href="#12026">12026: </a>        <span class="php-comment">/**
</span></span><span id="12027" class="l"><a href="#12027">12027: </a><span class="php-comment">         * Format the page numbers.
</span></span><span id="12028" class="l"><a href="#12028">12028: </a><span class="php-comment">         * This method can be overriden for custom formats.
</span></span><span id="12029" class="l"><a href="#12029">12029: </a><span class="php-comment">         * @param int $num page number
</span></span><span id="12030" class="l"><a href="#12030">12030: </a><span class="php-comment">         * @access protected
</span></span><span id="12031" class="l"><a href="#12031">12031: </a><span class="php-comment">         * @since 4.2.005 (2008-11-06)
</span></span><span id="12032" class="l"><a href="#12032">12032: </a><span class="php-comment">         */</span>
</span><span id="12033" class="l"><a href="#12033">12033: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> formatPageNumber(<span class="php-var">$num</span>) {
</span><span id="12034" class="l"><a href="#12034">12034: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">number_format</span>((float)<span class="php-var">$num</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-quote">'.'</span>);
</span><span id="12035" class="l"><a href="#12035">12035: </a>        }
</span><span id="12036" class="l"><a href="#12036">12036: </a>
</span><span id="12037" class="l"><a href="#12037">12037: </a>        <span class="php-comment">/**
</span></span><span id="12038" class="l"><a href="#12038">12038: </a><span class="php-comment">         * Format the page numbers on the Table Of Content.
</span></span><span id="12039" class="l"><a href="#12039">12039: </a><span class="php-comment">         * This method can be overriden for custom formats.
</span></span><span id="12040" class="l"><a href="#12040">12040: </a><span class="php-comment">         * @param int $num page number
</span></span><span id="12041" class="l"><a href="#12041">12041: </a><span class="php-comment">         * @access protected
</span></span><span id="12042" class="l"><a href="#12042">12042: </a><span class="php-comment">         * @since 4.5.001 (2009-01-04)
</span></span><span id="12043" class="l"><a href="#12043">12043: </a><span class="php-comment">         * @see addTOC(), addHTMLTOC()
</span></span><span id="12044" class="l"><a href="#12044">12044: </a><span class="php-comment">         */</span>
</span><span id="12045" class="l"><a href="#12045">12045: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> formatTOCPageNumber(<span class="php-var">$num</span>) {
</span><span id="12046" class="l"><a href="#12046">12046: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">number_format</span>((float)<span class="php-var">$num</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-quote">'.'</span>);
</span><span id="12047" class="l"><a href="#12047">12047: </a>        }
</span><span id="12048" class="l"><a href="#12048">12048: </a>
</span><span id="12049" class="l"><a href="#12049">12049: </a>        <span class="php-comment">/**
</span></span><span id="12050" class="l"><a href="#12050">12050: </a><span class="php-comment">         * Returns the current page number formatted as a string.
</span></span><span id="12051" class="l"><a href="#12051">12051: </a><span class="php-comment">         * @access public
</span></span><span id="12052" class="l"><a href="#12052">12052: </a><span class="php-comment">         * @since 4.2.005 (2008-11-06)
</span></span><span id="12053" class="l"><a href="#12053">12053: </a><span class="php-comment">         * @see PaneNo(), formatPageNumber()
</span></span><span id="12054" class="l"><a href="#12054">12054: </a><span class="php-comment">         */</span>
</span><span id="12055" class="l"><a href="#12055">12055: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> PageNoFormatted() {
</span><span id="12056" class="l"><a href="#12056">12056: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;formatPageNumber(<span class="php-var">$this</span>-&gt;PageNo());
</span><span id="12057" class="l"><a href="#12057">12057: </a>        }
</span><span id="12058" class="l"><a href="#12058">12058: </a>
</span><span id="12059" class="l"><a href="#12059">12059: </a>        <span class="php-comment">/**
</span></span><span id="12060" class="l"><a href="#12060">12060: </a><span class="php-comment">         * Put visibility settings.
</span></span><span id="12061" class="l"><a href="#12061">12061: </a><span class="php-comment">         * @access protected
</span></span><span id="12062" class="l"><a href="#12062">12062: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12063" class="l"><a href="#12063">12063: </a><span class="php-comment">         */</span>
</span><span id="12064" class="l"><a href="#12064">12064: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putocg() {
</span><span id="12065" class="l"><a href="#12065">12065: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12066" class="l"><a href="#12066">12066: </a>            <span class="php-var">$this</span>-&gt;n_ocg_print = <span class="php-var">$this</span>-&gt;n;
</span><span id="12067" class="l"><a href="#12067">12067: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'&lt;&lt; /Type /OCG /Name '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-quote">'print'</span>).<span class="php-quote">' /Usage &lt;&lt; /Print &lt;&lt;/PrintState /ON&gt;&gt; /View &lt;&lt;/ViewState /OFF&gt;&gt; &gt;&gt; &gt;&gt; endobj'</span>);
</span><span id="12068" class="l"><a href="#12068">12068: </a>            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12069" class="l"><a href="#12069">12069: </a>            <span class="php-var">$this</span>-&gt;n_ocg_view = <span class="php-var">$this</span>-&gt;n;
</span><span id="12070" class="l"><a href="#12070">12070: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'&lt;&lt; /Type /OCG /Name '</span>.<span class="php-var">$this</span>-&gt;_textstring(<span class="php-quote">'view'</span>).<span class="php-quote">' /Usage &lt;&lt; /Print &lt;&lt;/PrintState /OFF&gt;&gt; /View &lt;&lt;/ViewState /ON&gt;&gt; &gt;&gt; &gt;&gt; endobj'</span>);
</span><span id="12071" class="l"><a href="#12071">12071: </a>        }
</span><span id="12072" class="l"><a href="#12072">12072: </a>
</span><span id="12073" class="l"><a href="#12073">12073: </a>        <span class="php-comment">/**
</span></span><span id="12074" class="l"><a href="#12074">12074: </a><span class="php-comment">         * Set the visibility of the successive elements.
</span></span><span id="12075" class="l"><a href="#12075">12075: </a><span class="php-comment">         * This can be useful, for instance, to put a background
</span></span><span id="12076" class="l"><a href="#12076">12076: </a><span class="php-comment">         * image or color that will show on screen but won't print.
</span></span><span id="12077" class="l"><a href="#12077">12077: </a><span class="php-comment">         * @param string $v visibility mode. Legal values are: all, print, screen.
</span></span><span id="12078" class="l"><a href="#12078">12078: </a><span class="php-comment">         * @access public
</span></span><span id="12079" class="l"><a href="#12079">12079: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12080" class="l"><a href="#12080">12080: </a><span class="php-comment">         */</span>
</span><span id="12081" class="l"><a href="#12081">12081: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setVisibility(<span class="php-var">$v</span>) {
</span><span id="12082" class="l"><a href="#12082">12082: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;openMarkedContent) {
</span><span id="12083" class="l"><a href="#12083">12083: </a>                <span class="php-comment">// close existing open marked-content</span>
</span><span id="12084" class="l"><a href="#12084">12084: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'EMC'</span>);
</span><span id="12085" class="l"><a href="#12085">12085: </a>                <span class="php-var">$this</span>-&gt;openMarkedContent = <span class="php-keyword1">false</span>;
</span><span id="12086" class="l"><a href="#12086">12086: </a>            }
</span><span id="12087" class="l"><a href="#12087">12087: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$v</span>) {
</span><span id="12088" class="l"><a href="#12088">12088: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'print'</span>: {
</span><span id="12089" class="l"><a href="#12089">12089: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'/OC /OC1 BDC'</span>);
</span><span id="12090" class="l"><a href="#12090">12090: </a>                    <span class="php-var">$this</span>-&gt;openMarkedContent = <span class="php-keyword1">true</span>;
</span><span id="12091" class="l"><a href="#12091">12091: </a>                    <span class="php-keyword1">break</span>;
</span><span id="12092" class="l"><a href="#12092">12092: </a>                }
</span><span id="12093" class="l"><a href="#12093">12093: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'screen'</span>: {
</span><span id="12094" class="l"><a href="#12094">12094: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'/OC /OC2 BDC'</span>);
</span><span id="12095" class="l"><a href="#12095">12095: </a>                    <span class="php-var">$this</span>-&gt;openMarkedContent = <span class="php-keyword1">true</span>;
</span><span id="12096" class="l"><a href="#12096">12096: </a>                    <span class="php-keyword1">break</span>;
</span><span id="12097" class="l"><a href="#12097">12097: </a>                }
</span><span id="12098" class="l"><a href="#12098">12098: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'all'</span>: {
</span><span id="12099" class="l"><a href="#12099">12099: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">''</span>);
</span><span id="12100" class="l"><a href="#12100">12100: </a>                    <span class="php-keyword1">break</span>;
</span><span id="12101" class="l"><a href="#12101">12101: </a>                }
</span><span id="12102" class="l"><a href="#12102">12102: </a>                <span class="php-keyword1">default</span>: {
</span><span id="12103" class="l"><a href="#12103">12103: </a>                    <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Incorrect visibility: '</span>.<span class="php-var">$v</span>);
</span><span id="12104" class="l"><a href="#12104">12104: </a>                    <span class="php-keyword1">break</span>;
</span><span id="12105" class="l"><a href="#12105">12105: </a>                }
</span><span id="12106" class="l"><a href="#12106">12106: </a>            }
</span><span id="12107" class="l"><a href="#12107">12107: </a>            <span class="php-var">$this</span>-&gt;visibility = <span class="php-var">$v</span>;
</span><span id="12108" class="l"><a href="#12108">12108: </a>        }
</span><span id="12109" class="l"><a href="#12109">12109: </a>
</span><span id="12110" class="l"><a href="#12110">12110: </a>        <span class="php-comment">/**
</span></span><span id="12111" class="l"><a href="#12111">12111: </a><span class="php-comment">         * Add transparency parameters to the current extgstate
</span></span><span id="12112" class="l"><a href="#12112">12112: </a><span class="php-comment">         * @param array $params parameters
</span></span><span id="12113" class="l"><a href="#12113">12113: </a><span class="php-comment">         * @return the number of extgstates
</span></span><span id="12114" class="l"><a href="#12114">12114: </a><span class="php-comment">         * @access protected
</span></span><span id="12115" class="l"><a href="#12115">12115: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12116" class="l"><a href="#12116">12116: </a><span class="php-comment">         */</span>
</span><span id="12117" class="l"><a href="#12117">12117: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> addExtGState(<span class="php-var">$parms</span>) {
</span><span id="12118" class="l"><a href="#12118">12118: </a>            <span class="php-var">$n</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;extgstates) + <span class="php-num">1</span>;
</span><span id="12119" class="l"><a href="#12119">12119: </a>            <span class="php-comment">// check if this ExtGState already exist</span>
</span><span id="12120" class="l"><a href="#12120">12120: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$n</span>; ++<span class="php-var">$i</span>) {
</span><span id="12121" class="l"><a href="#12121">12121: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;extgstates[<span class="php-var">$i</span>][<span class="php-quote">'parms'</span>] == <span class="php-var">$parms</span>) {
</span><span id="12122" class="l"><a href="#12122">12122: </a>                    <span class="php-comment">// return reference to existing ExtGState</span>
</span><span id="12123" class="l"><a href="#12123">12123: </a>                    <span class="php-keyword1">return</span> <span class="php-var">$i</span>;
</span><span id="12124" class="l"><a href="#12124">12124: </a>                }
</span><span id="12125" class="l"><a href="#12125">12125: </a>            }
</span><span id="12126" class="l"><a href="#12126">12126: </a>            <span class="php-var">$this</span>-&gt;extgstates[<span class="php-var">$n</span>][<span class="php-quote">'parms'</span>] = <span class="php-var">$parms</span>;
</span><span id="12127" class="l"><a href="#12127">12127: </a>            <span class="php-keyword1">return</span> <span class="php-var">$n</span>;
</span><span id="12128" class="l"><a href="#12128">12128: </a>        }
</span><span id="12129" class="l"><a href="#12129">12129: </a>
</span><span id="12130" class="l"><a href="#12130">12130: </a>        <span class="php-comment">/**
</span></span><span id="12131" class="l"><a href="#12131">12131: </a><span class="php-comment">         * Add an extgstate
</span></span><span id="12132" class="l"><a href="#12132">12132: </a><span class="php-comment">         * @param array $gs extgstate
</span></span><span id="12133" class="l"><a href="#12133">12133: </a><span class="php-comment">         * @access protected
</span></span><span id="12134" class="l"><a href="#12134">12134: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12135" class="l"><a href="#12135">12135: </a><span class="php-comment">         */</span>
</span><span id="12136" class="l"><a href="#12136">12136: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setExtGState(<span class="php-var">$gs</span>) {
</span><span id="12137" class="l"><a href="#12137">12137: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'/GS%d gs'</span>, <span class="php-var">$gs</span>));
</span><span id="12138" class="l"><a href="#12138">12138: </a>        }
</span><span id="12139" class="l"><a href="#12139">12139: </a>
</span><span id="12140" class="l"><a href="#12140">12140: </a>        <span class="php-comment">/**
</span></span><span id="12141" class="l"><a href="#12141">12141: </a><span class="php-comment">         * Put extgstates for object transparency
</span></span><span id="12142" class="l"><a href="#12142">12142: </a><span class="php-comment">         * @param array $gs extgstate
</span></span><span id="12143" class="l"><a href="#12143">12143: </a><span class="php-comment">         * @access protected
</span></span><span id="12144" class="l"><a href="#12144">12144: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12145" class="l"><a href="#12145">12145: </a><span class="php-comment">         */</span>
</span><span id="12146" class="l"><a href="#12146">12146: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> _putextgstates() {
</span><span id="12147" class="l"><a href="#12147">12147: </a>            <span class="php-var">$ne</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;extgstates);
</span><span id="12148" class="l"><a href="#12148">12148: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt;= <span class="php-var">$ne</span>; ++<span class="php-var">$i</span>) {
</span><span id="12149" class="l"><a href="#12149">12149: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12150" class="l"><a href="#12150">12150: </a>                <span class="php-var">$this</span>-&gt;extgstates[<span class="php-var">$i</span>][<span class="php-quote">'n'</span>] = <span class="php-var">$this</span>-&gt;n;
</span><span id="12151" class="l"><a href="#12151">12151: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /ExtGState'</span>;
</span><span id="12152" class="l"><a href="#12152">12152: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;extgstates[<span class="php-var">$i</span>][<span class="php-quote">'parms'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$v</span>) {
</span><span id="12153" class="l"><a href="#12153">12153: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">is_float</span>(<span class="php-var">$v</span>)) {
</span><span id="12154" class="l"><a href="#12154">12154: </a>                        <span class="php-var">$v</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.2F'</span>, <span class="php-var">$v</span>);
</span><span id="12155" class="l"><a href="#12155">12155: </a>                    }
</span><span id="12156" class="l"><a href="#12156">12156: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /'</span>.<span class="php-var">$k</span>.<span class="php-quote">' '</span>.<span class="php-var">$v</span>;
</span><span id="12157" class="l"><a href="#12157">12157: </a>                }
</span><span id="12158" class="l"><a href="#12158">12158: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="12159" class="l"><a href="#12159">12159: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12160" class="l"><a href="#12160">12160: </a>            }
</span><span id="12161" class="l"><a href="#12161">12161: </a>        }
</span><span id="12162" class="l"><a href="#12162">12162: </a>
</span><span id="12163" class="l"><a href="#12163">12163: </a>        <span class="php-comment">/**
</span></span><span id="12164" class="l"><a href="#12164">12164: </a><span class="php-comment">         * Set alpha for stroking (CA) and non-stroking (ca) operations.
</span></span><span id="12165" class="l"><a href="#12165">12165: </a><span class="php-comment">         * @param float $alpha real value from 0 (transparent) to 1 (opaque)
</span></span><span id="12166" class="l"><a href="#12166">12166: </a><span class="php-comment">         * @param string $bm blend mode, one of the following: Normal, Multiply, Screen, Overlay, Darken, Lighten, ColorDodge, ColorBurn, HardLight, SoftLight, Difference, Exclusion, Hue, Saturation, Color, Luminosity
</span></span><span id="12167" class="l"><a href="#12167">12167: </a><span class="php-comment">         * @access public
</span></span><span id="12168" class="l"><a href="#12168">12168: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12169" class="l"><a href="#12169">12169: </a><span class="php-comment">         */</span>
</span><span id="12170" class="l"><a href="#12170">12170: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setAlpha(<span class="php-var">$alpha</span>, <span class="php-var">$bm</span>=<span class="php-quote">'Normal'</span>) {
</span><span id="12171" class="l"><a href="#12171">12171: </a>            <span class="php-var">$gs</span> = <span class="php-var">$this</span>-&gt;addExtGState(<span class="php-keyword1">array</span>(<span class="php-quote">'ca'</span> =&gt; <span class="php-var">$alpha</span>, <span class="php-quote">'CA'</span> =&gt; <span class="php-var">$alpha</span>, <span class="php-quote">'BM'</span> =&gt; <span class="php-quote">'/'</span>.<span class="php-var">$bm</span>, <span class="php-quote">'AIS'</span> =&gt; <span class="php-quote">'false'</span>));
</span><span id="12172" class="l"><a href="#12172">12172: </a>            <span class="php-var">$this</span>-&gt;setExtGState(<span class="php-var">$gs</span>);
</span><span id="12173" class="l"><a href="#12173">12173: </a>        }
</span><span id="12174" class="l"><a href="#12174">12174: </a>
</span><span id="12175" class="l"><a href="#12175">12175: </a>        <span class="php-comment">/**
</span></span><span id="12176" class="l"><a href="#12176">12176: </a><span class="php-comment">         * Set the default JPEG compression quality (1-100)
</span></span><span id="12177" class="l"><a href="#12177">12177: </a><span class="php-comment">         * @param int $quality JPEG quality, integer between 1 and 100
</span></span><span id="12178" class="l"><a href="#12178">12178: </a><span class="php-comment">         * @access public
</span></span><span id="12179" class="l"><a href="#12179">12179: </a><span class="php-comment">         * @since 3.0.000 (2008-03-27)
</span></span><span id="12180" class="l"><a href="#12180">12180: </a><span class="php-comment">         */</span>
</span><span id="12181" class="l"><a href="#12181">12181: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setJPEGQuality(<span class="php-var">$quality</span>) {
</span><span id="12182" class="l"><a href="#12182">12182: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$quality</span> &lt; <span class="php-num">1</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$quality</span> &gt; <span class="php-num">100</span>)) {
</span><span id="12183" class="l"><a href="#12183">12183: </a>                <span class="php-var">$quality</span> = <span class="php-num">75</span>;
</span><span id="12184" class="l"><a href="#12184">12184: </a>            }
</span><span id="12185" class="l"><a href="#12185">12185: </a>            <span class="php-var">$this</span>-&gt;jpeg_quality = <span class="php-keyword2">intval</span>(<span class="php-var">$quality</span>);
</span><span id="12186" class="l"><a href="#12186">12186: </a>        }
</span><span id="12187" class="l"><a href="#12187">12187: </a>
</span><span id="12188" class="l"><a href="#12188">12188: </a>        <span class="php-comment">/**
</span></span><span id="12189" class="l"><a href="#12189">12189: </a><span class="php-comment">         * Set the default number of columns in a row for HTML tables.
</span></span><span id="12190" class="l"><a href="#12190">12190: </a><span class="php-comment">         * @param int $cols number of columns
</span></span><span id="12191" class="l"><a href="#12191">12191: </a><span class="php-comment">         * @access public
</span></span><span id="12192" class="l"><a href="#12192">12192: </a><span class="php-comment">         * @since 3.0.014 (2008-06-04)
</span></span><span id="12193" class="l"><a href="#12193">12193: </a><span class="php-comment">         */</span>
</span><span id="12194" class="l"><a href="#12194">12194: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setDefaultTableColumns(<span class="php-var">$cols</span>=<span class="php-num">4</span>) {
</span><span id="12195" class="l"><a href="#12195">12195: </a>            <span class="php-var">$this</span>-&gt;default_table_columns = <span class="php-keyword2">intval</span>(<span class="php-var">$cols</span>);
</span><span id="12196" class="l"><a href="#12196">12196: </a>        }
</span><span id="12197" class="l"><a href="#12197">12197: </a>
</span><span id="12198" class="l"><a href="#12198">12198: </a>        <span class="php-comment">/**
</span></span><span id="12199" class="l"><a href="#12199">12199: </a><span class="php-comment">         * Set the height of the cell (line height) respect the font height.
</span></span><span id="12200" class="l"><a href="#12200">12200: </a><span class="php-comment">         * @param int $h cell proportion respect font height (typical value = 1.25).
</span></span><span id="12201" class="l"><a href="#12201">12201: </a><span class="php-comment">         * @access public
</span></span><span id="12202" class="l"><a href="#12202">12202: </a><span class="php-comment">         * @since 3.0.014 (2008-06-04)
</span></span><span id="12203" class="l"><a href="#12203">12203: </a><span class="php-comment">         */</span>
</span><span id="12204" class="l"><a href="#12204">12204: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setCellHeightRatio(<span class="php-var">$h</span>) {
</span><span id="12205" class="l"><a href="#12205">12205: </a>            <span class="php-var">$this</span>-&gt;cell_height_ratio = <span class="php-var">$h</span>;
</span><span id="12206" class="l"><a href="#12206">12206: </a>        }
</span><span id="12207" class="l"><a href="#12207">12207: </a>
</span><span id="12208" class="l"><a href="#12208">12208: </a>        <span class="php-comment">/**
</span></span><span id="12209" class="l"><a href="#12209">12209: </a><span class="php-comment">         * return the height of cell repect font height.
</span></span><span id="12210" class="l"><a href="#12210">12210: </a><span class="php-comment">         * @access public
</span></span><span id="12211" class="l"><a href="#12211">12211: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="12212" class="l"><a href="#12212">12212: </a><span class="php-comment">         */</span>
</span><span id="12213" class="l"><a href="#12213">12213: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getCellHeightRatio() {
</span><span id="12214" class="l"><a href="#12214">12214: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="12215" class="l"><a href="#12215">12215: </a>        }
</span><span id="12216" class="l"><a href="#12216">12216: </a>
</span><span id="12217" class="l"><a href="#12217">12217: </a>        <span class="php-comment">/**
</span></span><span id="12218" class="l"><a href="#12218">12218: </a><span class="php-comment">         * Set the PDF version (check PDF reference for valid values).
</span></span><span id="12219" class="l"><a href="#12219">12219: </a><span class="php-comment">         * Default value is 1.t
</span></span><span id="12220" class="l"><a href="#12220">12220: </a><span class="php-comment">         * @access public
</span></span><span id="12221" class="l"><a href="#12221">12221: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12222" class="l"><a href="#12222">12222: </a><span class="php-comment">         */</span>
</span><span id="12223" class="l"><a href="#12223">12223: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setPDFVersion(<span class="php-var">$version</span>=<span class="php-quote">'1.7'</span>) {
</span><span id="12224" class="l"><a href="#12224">12224: </a>            <span class="php-var">$this</span>-&gt;PDFVersion = <span class="php-var">$version</span>;
</span><span id="12225" class="l"><a href="#12225">12225: </a>        }
</span><span id="12226" class="l"><a href="#12226">12226: </a>
</span><span id="12227" class="l"><a href="#12227">12227: </a>        <span class="php-comment">/**
</span></span><span id="12228" class="l"><a href="#12228">12228: </a><span class="php-comment">         * Set the viewer preferences dictionary controlling the way the document is to be presented on the screen or in print.
</span></span><span id="12229" class="l"><a href="#12229">12229: </a><span class="php-comment">         * (see Section 8.1 of PDF reference, &quot;Viewer Preferences&quot;).
</span></span><span id="12230" class="l"><a href="#12230">12230: </a><span class="php-comment">         * &lt;ul&gt;&lt;li&gt;HideToolbar boolean (Optional) A flag specifying whether to hide the viewer application's tool bars when the document is active. Default value: false.&lt;/li&gt;&lt;li&gt;HideMenubar boolean (Optional) A flag specifying whether to hide the viewer application's menu bar when the document is active. Default value: false.&lt;/li&gt;&lt;li&gt;HideWindowUI boolean (Optional) A flag specifying whether to hide user interface elements in the document's window (such as scroll bars and navigation controls), leaving only the document's contents displayed. Default value: false.&lt;/li&gt;&lt;li&gt;FitWindow boolean (Optional) A flag specifying whether to resize the document's window to fit the size of the first displayed page. Default value: false.&lt;/li&gt;&lt;li&gt;CenterWindow boolean (Optional) A flag specifying whether to position the document's window in the center of the screen. Default value: false.&lt;/li&gt;&lt;li&gt;DisplayDocTitle boolean (Optional; PDF 1.4) A flag specifying whether the window's title bar should display the document title taken from the Title entry of the document information dictionary (see Section 10.2.1, &quot;Document Information Dictionary&quot;). If false, the title bar should instead display the name of the PDF file containing the document. Default value: false.&lt;/li&gt;&lt;li&gt;NonFullScreenPageMode name (Optional) The document's page mode, specifying how to display the document on exiting full-screen mode:&lt;ul&gt;&lt;li&gt;UseNone Neither document outline nor thumbnail images visible&lt;/li&gt;&lt;li&gt;UseOutlines Document outline visible&lt;/li&gt;&lt;li&gt;UseThumbs Thumbnail images visible&lt;/li&gt;&lt;li&gt;UseOC Optional content group panel visible&lt;/li&gt;&lt;/ul&gt;This entry is meaningful only if the value of the PageMode entry in the catalog dictionary (see Section 3.6.1, &quot;Document Catalog&quot;) is FullScreen; it is ignored otherwise. Default value: UseNone.&lt;/li&gt;&lt;li&gt;ViewArea name (Optional; PDF 1.4) The name of the page boundary representing the area of a page to be displayed when viewing the document on the screen. Valid values are (see Section 10.10.1, &quot;Page Boundaries&quot;).:&lt;ul&gt;&lt;li&gt;MediaBox&lt;/li&gt;&lt;li&gt;CropBox (default)&lt;/li&gt;&lt;li&gt;BleedBox&lt;/li&gt;&lt;li&gt;TrimBox&lt;/li&gt;&lt;li&gt;ArtBox&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;ViewClip name (Optional; PDF 1.4) The name of the page boundary to which the contents of a page are to be clipped when viewing the document on the screen. Valid values are (see Section 10.10.1, &quot;Page Boundaries&quot;).:&lt;ul&gt;&lt;li&gt;MediaBox&lt;/li&gt;&lt;li&gt;CropBox (default)&lt;/li&gt;&lt;li&gt;BleedBox&lt;/li&gt;&lt;li&gt;TrimBox&lt;/li&gt;&lt;li&gt;ArtBox&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;PrintArea name (Optional; PDF 1.4) The name of the page boundary representing the area of a page to be rendered when printing the document. Valid values are (see Section 10.10.1, &quot;Page Boundaries&quot;).:&lt;ul&gt;&lt;li&gt;MediaBox&lt;/li&gt;&lt;li&gt;CropBox (default)&lt;/li&gt;&lt;li&gt;BleedBox&lt;/li&gt;&lt;li&gt;TrimBox&lt;/li&gt;&lt;li&gt;ArtBox&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;PrintClip name (Optional; PDF 1.4) The name of the page boundary to which the contents of a page are to be clipped when printing the document. Valid values are (see Section 10.10.1, &quot;Page Boundaries&quot;).:&lt;ul&gt;&lt;li&gt;MediaBox&lt;/li&gt;&lt;li&gt;CropBox (default)&lt;/li&gt;&lt;li&gt;BleedBox&lt;/li&gt;&lt;li&gt;TrimBox&lt;/li&gt;&lt;li&gt;ArtBox&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;PrintScaling name (Optional; PDF 1.6) The page scaling option to be selected when a print dialog is displayed for this document. Valid values are: &lt;ul&gt;&lt;li&gt;None, which indicates that the print dialog should reflect no page scaling&lt;/li&gt;&lt;li&gt;AppDefault (default), which indicates that applications should use the current print scaling&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Duplex name (Optional; PDF 1.7) The paper handling option to use when printing the file from the print dialog. The following values are valid:&lt;ul&gt;&lt;li&gt;Simplex - Print single-sided&lt;/li&gt;&lt;li&gt;DuplexFlipShortEdge - Duplex and flip on the short edge of the sheet&lt;/li&gt;&lt;li&gt;DuplexFlipLongEdge - Duplex and flip on the long edge of the sheet&lt;/li&gt;&lt;/ul&gt;Default value: none&lt;/li&gt;&lt;li&gt;PickTrayByPDFSize boolean (Optional; PDF 1.7) A flag specifying whether the PDF page size is used to select the input paper tray. This setting influences only the preset values used to populate the print dialog presented by a PDF viewer application. If PickTrayByPDFSize is true, the check box in the print dialog associated with input paper tray is checked. Note: This setting has no effect on Mac OS systems, which do not provide the ability to pick the input tray by size.&lt;/li&gt;&lt;li&gt;PrintPageRange array (Optional; PDF 1.7) The page numbers used to initialize the print dialog box when the file is printed. The first page of the PDF file is denoted by 1. Each pair consists of the first and last pages in the sub-range. An odd number of integers causes this entry to be ignored. Negative numbers cause the entire array to be ignored. Default value: as defined by PDF viewer application&lt;/li&gt;&lt;li&gt;NumCopies integer (Optional; PDF 1.7) The number of copies to be printed when the print dialog is opened for this file. Supported values are the integers 2 through 5. Values outside this range are ignored. Default value: as defined by PDF viewer application, but typically 1&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="12231" class="l"><a href="#12231">12231: </a><span class="php-comment">         * @param array $preferences array of options.
</span></span><span id="12232" class="l"><a href="#12232">12232: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="12233" class="l"><a href="#12233">12233: </a><span class="php-comment">         * @access public
</span></span><span id="12234" class="l"><a href="#12234">12234: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12235" class="l"><a href="#12235">12235: </a><span class="php-comment">         */</span>
</span><span id="12236" class="l"><a href="#12236">12236: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setViewerPreferences(<span class="php-var">$preferences</span>) {
</span><span id="12237" class="l"><a href="#12237">12237: </a>            <span class="php-var">$this</span>-&gt;viewer_preferences = <span class="php-var">$preferences</span>;
</span><span id="12238" class="l"><a href="#12238">12238: </a>        }
</span><span id="12239" class="l"><a href="#12239">12239: </a>
</span><span id="12240" class="l"><a href="#12240">12240: </a>        <span class="php-comment">/**
</span></span><span id="12241" class="l"><a href="#12241">12241: </a><span class="php-comment">         * Paints color transition registration bars
</span></span><span id="12242" class="l"><a href="#12242">12242: </a><span class="php-comment">         * @param float $x abscissa of the top left corner of the rectangle.
</span></span><span id="12243" class="l"><a href="#12243">12243: </a><span class="php-comment">         * @param float $y ordinate of the top left corner of the rectangle.
</span></span><span id="12244" class="l"><a href="#12244">12244: </a><span class="php-comment">         * @param float $w width of the rectangle.
</span></span><span id="12245" class="l"><a href="#12245">12245: </a><span class="php-comment">         * @param float $h height of the rectangle.
</span></span><span id="12246" class="l"><a href="#12246">12246: </a><span class="php-comment">         * @param boolean $transition if true prints tcolor transitions to white.
</span></span><span id="12247" class="l"><a href="#12247">12247: </a><span class="php-comment">         * @param boolean $vertical if true prints bar vertically.
</span></span><span id="12248" class="l"><a href="#12248">12248: </a><span class="php-comment">         * @param string $colors colors to print, one letter per color separated by comma (for example 'A,W,R,G,B,C,M,Y,K'): A=black, W=white, R=red, G=green, B=blue, C=cyan, M=magenta, Y=yellow, K=black.
</span></span><span id="12249" class="l"><a href="#12249">12249: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="12250" class="l"><a href="#12250">12250: </a><span class="php-comment">         * @since 4.9.000 (2010-03-26)
</span></span><span id="12251" class="l"><a href="#12251">12251: </a><span class="php-comment">         * @access public
</span></span><span id="12252" class="l"><a href="#12252">12252: </a><span class="php-comment">         */</span>
</span><span id="12253" class="l"><a href="#12253">12253: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> colorRegistrationBar(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$transition</span>=<span class="php-keyword1">true</span>, <span class="php-var">$vertical</span>=<span class="php-keyword1">false</span>, <span class="php-var">$colors</span>=<span class="php-quote">'A,R,G,B,C,M,Y,K'</span>) {
</span><span id="12254" class="l"><a href="#12254">12254: </a>            <span class="php-var">$bars</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">','</span>, <span class="php-var">$colors</span>);
</span><span id="12255" class="l"><a href="#12255">12255: </a>            <span class="php-var">$numbars</span> = <span class="php-keyword2">count</span>(<span class="php-var">$bars</span>); <span class="php-comment">// number of bars to print</span>
</span><span id="12256" class="l"><a href="#12256">12256: </a>            <span class="php-comment">// set bar measures</span>
</span><span id="12257" class="l"><a href="#12257">12257: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$vertical</span>) {
</span><span id="12258" class="l"><a href="#12258">12258: </a>                <span class="php-var">$coords</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">1</span>);
</span><span id="12259" class="l"><a href="#12259">12259: </a>                <span class="php-var">$wb</span> = <span class="php-var">$w</span> / <span class="php-var">$numbars</span>; <span class="php-comment">// bar width</span>
</span><span id="12260" class="l"><a href="#12260">12260: </a>                <span class="php-var">$hb</span> = <span class="php-var">$h</span>; <span class="php-comment">// bar height</span>
</span><span id="12261" class="l"><a href="#12261">12261: </a>                <span class="php-var">$xd</span> = <span class="php-var">$wb</span>; <span class="php-comment">// delta x</span>
</span><span id="12262" class="l"><a href="#12262">12262: </a>                <span class="php-var">$yd</span> = <span class="php-num">0</span>; <span class="php-comment">// delta y</span>
</span><span id="12263" class="l"><a href="#12263">12263: </a>            } <span class="php-keyword1">else</span> {
</span><span id="12264" class="l"><a href="#12264">12264: </a>                <span class="php-var">$coords</span> = <span class="php-keyword1">array</span>(<span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">0</span>);
</span><span id="12265" class="l"><a href="#12265">12265: </a>                <span class="php-var">$wb</span> = <span class="php-var">$w</span>; <span class="php-comment">// bar width</span>
</span><span id="12266" class="l"><a href="#12266">12266: </a>                <span class="php-var">$hb</span> = <span class="php-var">$h</span> / <span class="php-var">$numbars</span>; <span class="php-comment">// bar height</span>
</span><span id="12267" class="l"><a href="#12267">12267: </a>                <span class="php-var">$xd</span> = <span class="php-num">0</span>; <span class="php-comment">// delta x</span>
</span><span id="12268" class="l"><a href="#12268">12268: </a>                <span class="php-var">$yd</span> = <span class="php-var">$hb</span>; <span class="php-comment">// delta y</span>
</span><span id="12269" class="l"><a href="#12269">12269: </a>            }
</span><span id="12270" class="l"><a href="#12270">12270: </a>            <span class="php-var">$xb</span> = <span class="php-var">$x</span>;
</span><span id="12271" class="l"><a href="#12271">12271: </a>            <span class="php-var">$yb</span> = <span class="php-var">$y</span>;
</span><span id="12272" class="l"><a href="#12272">12272: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$bars</span> <span class="php-keyword1">as</span> <span class="php-var">$col</span>) {
</span><span id="12273" class="l"><a href="#12273">12273: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$col</span>) {
</span><span id="12274" class="l"><a href="#12274">12274: </a>                    <span class="php-comment">// set transition colors</span>
</span><span id="12275" class="l"><a href="#12275">12275: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A'</span>: { <span class="php-comment">// BLACK</span>
</span><span id="12276" class="l"><a href="#12276">12276: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">255</span>);
</span><span id="12277" class="l"><a href="#12277">12277: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>);
</span><span id="12278" class="l"><a href="#12278">12278: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12279" class="l"><a href="#12279">12279: </a>                    }
</span><span id="12280" class="l"><a href="#12280">12280: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'W'</span>: { <span class="php-comment">// WHITE</span>
</span><span id="12281" class="l"><a href="#12281">12281: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>);
</span><span id="12282" class="l"><a href="#12282">12282: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">255</span>);
</span><span id="12283" class="l"><a href="#12283">12283: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12284" class="l"><a href="#12284">12284: </a>                    }
</span><span id="12285" class="l"><a href="#12285">12285: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'R'</span>: { <span class="php-comment">// R</span>
</span><span id="12286" class="l"><a href="#12286">12286: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">255</span>,<span class="php-num">255</span>,<span class="php-num">255</span>);
</span><span id="12287" class="l"><a href="#12287">12287: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">255</span>,<span class="php-num">0</span>,<span class="php-num">0</span>);
</span><span id="12288" class="l"><a href="#12288">12288: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12289" class="l"><a href="#12289">12289: </a>                    }
</span><span id="12290" class="l"><a href="#12290">12290: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'G'</span>: { <span class="php-comment">// G</span>
</span><span id="12291" class="l"><a href="#12291">12291: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">255</span>,<span class="php-num">255</span>,<span class="php-num">255</span>);
</span><span id="12292" class="l"><a href="#12292">12292: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">255</span>,<span class="php-num">0</span>);
</span><span id="12293" class="l"><a href="#12293">12293: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12294" class="l"><a href="#12294">12294: </a>                    }
</span><span id="12295" class="l"><a href="#12295">12295: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: { <span class="php-comment">// B</span>
</span><span id="12296" class="l"><a href="#12296">12296: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">255</span>,<span class="php-num">255</span>,<span class="php-num">255</span>);
</span><span id="12297" class="l"><a href="#12297">12297: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">255</span>);
</span><span id="12298" class="l"><a href="#12298">12298: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12299" class="l"><a href="#12299">12299: </a>                    }
</span><span id="12300" class="l"><a href="#12300">12300: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: { <span class="php-comment">// C</span>
</span><span id="12301" class="l"><a href="#12301">12301: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>);
</span><span id="12302" class="l"><a href="#12302">12302: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">100</span>,<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>);
</span><span id="12303" class="l"><a href="#12303">12303: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12304" class="l"><a href="#12304">12304: </a>                    }
</span><span id="12305" class="l"><a href="#12305">12305: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: { <span class="php-comment">// M</span>
</span><span id="12306" class="l"><a href="#12306">12306: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>);
</span><span id="12307" class="l"><a href="#12307">12307: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">100</span>,<span class="php-num">0</span>,<span class="php-num">0</span>);
</span><span id="12308" class="l"><a href="#12308">12308: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12309" class="l"><a href="#12309">12309: </a>                    }
</span><span id="12310" class="l"><a href="#12310">12310: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Y'</span>: { <span class="php-comment">// Y</span>
</span><span id="12311" class="l"><a href="#12311">12311: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>);
</span><span id="12312" class="l"><a href="#12312">12312: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">100</span>,<span class="php-num">0</span>);
</span><span id="12313" class="l"><a href="#12313">12313: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12314" class="l"><a href="#12314">12314: </a>                    }
</span><span id="12315" class="l"><a href="#12315">12315: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'K'</span>: { <span class="php-comment">// K</span>
</span><span id="12316" class="l"><a href="#12316">12316: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>);
</span><span id="12317" class="l"><a href="#12317">12317: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">100</span>);
</span><span id="12318" class="l"><a href="#12318">12318: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12319" class="l"><a href="#12319">12319: </a>                    }
</span><span id="12320" class="l"><a href="#12320">12320: </a>                    <span class="php-keyword1">default</span>: { <span class="php-comment">// GRAY</span>
</span><span id="12321" class="l"><a href="#12321">12321: </a>                        <span class="php-var">$col_a</span> = <span class="php-keyword1">array</span>(<span class="php-num">255</span>);
</span><span id="12322" class="l"><a href="#12322">12322: </a>                        <span class="php-var">$col_b</span> = <span class="php-keyword1">array</span>(<span class="php-num">0</span>);
</span><span id="12323" class="l"><a href="#12323">12323: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12324" class="l"><a href="#12324">12324: </a>                    }
</span><span id="12325" class="l"><a href="#12325">12325: </a>                }
</span><span id="12326" class="l"><a href="#12326">12326: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$transition</span>) {
</span><span id="12327" class="l"><a href="#12327">12327: </a>                    <span class="php-comment">// color gradient</span>
</span><span id="12328" class="l"><a href="#12328">12328: </a>                    <span class="php-var">$this</span>-&gt;LinearGradient(<span class="php-var">$xb</span>, <span class="php-var">$yb</span>, <span class="php-var">$wb</span>, <span class="php-var">$hb</span>, <span class="php-var">$col_a</span>, <span class="php-var">$col_b</span>, <span class="php-var">$coords</span>);
</span><span id="12329" class="l"><a href="#12329">12329: </a>                } <span class="php-keyword1">else</span> {
</span><span id="12330" class="l"><a href="#12330">12330: </a>                    <span class="php-comment">// color rectangle</span>
</span><span id="12331" class="l"><a href="#12331">12331: </a>                    <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$col_b</span>);
</span><span id="12332" class="l"><a href="#12332">12332: </a>                    <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$xb</span>, <span class="php-var">$yb</span>, <span class="php-var">$wb</span>, <span class="php-var">$hb</span>, <span class="php-quote">'F'</span>, <span class="php-keyword1">array</span>());
</span><span id="12333" class="l"><a href="#12333">12333: </a>                }
</span><span id="12334" class="l"><a href="#12334">12334: </a>                <span class="php-var">$xb</span> += <span class="php-var">$xd</span>;
</span><span id="12335" class="l"><a href="#12335">12335: </a>                <span class="php-var">$yb</span> += <span class="php-var">$yd</span>;
</span><span id="12336" class="l"><a href="#12336">12336: </a>            }
</span><span id="12337" class="l"><a href="#12337">12337: </a>        }
</span><span id="12338" class="l"><a href="#12338">12338: </a>
</span><span id="12339" class="l"><a href="#12339">12339: </a>        <span class="php-comment">/**
</span></span><span id="12340" class="l"><a href="#12340">12340: </a><span class="php-comment">         * Paints crop mark
</span></span><span id="12341" class="l"><a href="#12341">12341: </a><span class="php-comment">         * @param float $x abscissa of the crop mark center.
</span></span><span id="12342" class="l"><a href="#12342">12342: </a><span class="php-comment">         * @param float $y ordinate of the crop mark center.
</span></span><span id="12343" class="l"><a href="#12343">12343: </a><span class="php-comment">         * @param float $w width of the crop mark.
</span></span><span id="12344" class="l"><a href="#12344">12344: </a><span class="php-comment">         * @param float $h height of the crop mark.
</span></span><span id="12345" class="l"><a href="#12345">12345: </a><span class="php-comment">         * @param string $type type of crop mark, one sybol per type separated by comma: A = top left, B = top right, C = bottom left, D = bottom right.
</span></span><span id="12346" class="l"><a href="#12346">12346: </a><span class="php-comment">         * @param array $color crop mark color (default black).
</span></span><span id="12347" class="l"><a href="#12347">12347: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="12348" class="l"><a href="#12348">12348: </a><span class="php-comment">         * @since 4.9.000 (2010-03-26)
</span></span><span id="12349" class="l"><a href="#12349">12349: </a><span class="php-comment">         * @access public
</span></span><span id="12350" class="l"><a href="#12350">12350: </a><span class="php-comment">         */</span>
</span><span id="12351" class="l"><a href="#12351">12351: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> cropMark(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$type</span>=<span class="php-quote">'A,B,C,D'</span>, <span class="php-var">$color</span>=<span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>)) {
</span><span id="12352" class="l"><a href="#12352">12352: </a>            <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-keyword1">array</span>(<span class="php-quote">'width'</span> =&gt; (<span class="php-num">0.5</span> / <span class="php-var">$this</span>-&gt;k), <span class="php-quote">'cap'</span> =&gt; <span class="php-quote">'butt'</span>, <span class="php-quote">'join'</span> =&gt; <span class="php-quote">'miter'</span>, <span class="php-quote">'dash'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'color'</span> =&gt; <span class="php-var">$color</span>));
</span><span id="12353" class="l"><a href="#12353">12353: </a>            <span class="php-var">$crops</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">','</span>, <span class="php-var">$type</span>);
</span><span id="12354" class="l"><a href="#12354">12354: </a>            <span class="php-var">$numcrops</span> = <span class="php-keyword2">count</span>(<span class="php-var">$crops</span>); <span class="php-comment">// number of crop marks to print</span>
</span><span id="12355" class="l"><a href="#12355">12355: </a>            <span class="php-var">$dw</span> = <span class="php-var">$w</span> / <span class="php-num">4</span>; <span class="php-comment">// horizontal space to leave before the intersection point</span>
</span><span id="12356" class="l"><a href="#12356">12356: </a>            <span class="php-var">$dh</span> = <span class="php-var">$h</span> / <span class="php-num">4</span>; <span class="php-comment">// vertical space to leave before the intersection point</span>
</span><span id="12357" class="l"><a href="#12357">12357: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$crops</span> <span class="php-keyword1">as</span> <span class="php-var">$crop</span>) {
</span><span id="12358" class="l"><a href="#12358">12358: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$crop</span>) {
</span><span id="12359" class="l"><a href="#12359">12359: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A'</span>: {
</span><span id="12360" class="l"><a href="#12360">12360: </a>                        <span class="php-var">$x1</span> = <span class="php-var">$x</span>;
</span><span id="12361" class="l"><a href="#12361">12361: </a>                        <span class="php-var">$y1</span> = <span class="php-var">$y</span> - <span class="php-var">$h</span>;
</span><span id="12362" class="l"><a href="#12362">12362: </a>                        <span class="php-var">$x2</span> = <span class="php-var">$x</span>;
</span><span id="12363" class="l"><a href="#12363">12363: </a>                        <span class="php-var">$y2</span> = <span class="php-var">$y</span> - <span class="php-var">$dh</span>;
</span><span id="12364" class="l"><a href="#12364">12364: </a>                        <span class="php-var">$x3</span> = <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="12365" class="l"><a href="#12365">12365: </a>                        <span class="php-var">$y3</span> = <span class="php-var">$y</span>;
</span><span id="12366" class="l"><a href="#12366">12366: </a>                        <span class="php-var">$x4</span> = <span class="php-var">$x</span> - <span class="php-var">$dw</span>;
</span><span id="12367" class="l"><a href="#12367">12367: </a>                        <span class="php-var">$y4</span> = <span class="php-var">$y</span>;
</span><span id="12368" class="l"><a href="#12368">12368: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12369" class="l"><a href="#12369">12369: </a>                    }
</span><span id="12370" class="l"><a href="#12370">12370: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="12371" class="l"><a href="#12371">12371: </a>                        <span class="php-var">$x1</span> = <span class="php-var">$x</span>;
</span><span id="12372" class="l"><a href="#12372">12372: </a>                        <span class="php-var">$y1</span> = <span class="php-var">$y</span> - <span class="php-var">$h</span>;
</span><span id="12373" class="l"><a href="#12373">12373: </a>                        <span class="php-var">$x2</span> = <span class="php-var">$x</span>;
</span><span id="12374" class="l"><a href="#12374">12374: </a>                        <span class="php-var">$y2</span> = <span class="php-var">$y</span> - <span class="php-var">$dh</span>;
</span><span id="12375" class="l"><a href="#12375">12375: </a>                        <span class="php-var">$x3</span> = <span class="php-var">$x</span> + <span class="php-var">$dw</span>;
</span><span id="12376" class="l"><a href="#12376">12376: </a>                        <span class="php-var">$y3</span> = <span class="php-var">$y</span>;
</span><span id="12377" class="l"><a href="#12377">12377: </a>                        <span class="php-var">$x4</span> = <span class="php-var">$x</span> + <span class="php-var">$w</span>;
</span><span id="12378" class="l"><a href="#12378">12378: </a>                        <span class="php-var">$y4</span> = <span class="php-var">$y</span>;
</span><span id="12379" class="l"><a href="#12379">12379: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12380" class="l"><a href="#12380">12380: </a>                    }
</span><span id="12381" class="l"><a href="#12381">12381: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: {
</span><span id="12382" class="l"><a href="#12382">12382: </a>                        <span class="php-var">$x1</span> = <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="12383" class="l"><a href="#12383">12383: </a>                        <span class="php-var">$y1</span> = <span class="php-var">$y</span>;
</span><span id="12384" class="l"><a href="#12384">12384: </a>                        <span class="php-var">$x2</span> = <span class="php-var">$x</span> - <span class="php-var">$dw</span>;
</span><span id="12385" class="l"><a href="#12385">12385: </a>                        <span class="php-var">$y2</span> = <span class="php-var">$y</span>;
</span><span id="12386" class="l"><a href="#12386">12386: </a>                        <span class="php-var">$x3</span> = <span class="php-var">$x</span>;
</span><span id="12387" class="l"><a href="#12387">12387: </a>                        <span class="php-var">$y3</span> = <span class="php-var">$y</span> + <span class="php-var">$dh</span>;
</span><span id="12388" class="l"><a href="#12388">12388: </a>                        <span class="php-var">$x4</span> = <span class="php-var">$x</span>;
</span><span id="12389" class="l"><a href="#12389">12389: </a>                        <span class="php-var">$y4</span> = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="12390" class="l"><a href="#12390">12390: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12391" class="l"><a href="#12391">12391: </a>                    }
</span><span id="12392" class="l"><a href="#12392">12392: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'D'</span>: {
</span><span id="12393" class="l"><a href="#12393">12393: </a>                        <span class="php-var">$x1</span> = <span class="php-var">$x</span> + <span class="php-var">$dw</span>;
</span><span id="12394" class="l"><a href="#12394">12394: </a>                        <span class="php-var">$y1</span> = <span class="php-var">$y</span>;
</span><span id="12395" class="l"><a href="#12395">12395: </a>                        <span class="php-var">$x2</span> = <span class="php-var">$x</span> + <span class="php-var">$w</span>;
</span><span id="12396" class="l"><a href="#12396">12396: </a>                        <span class="php-var">$y2</span> = <span class="php-var">$y</span>;
</span><span id="12397" class="l"><a href="#12397">12397: </a>                        <span class="php-var">$x3</span> = <span class="php-var">$x</span>;
</span><span id="12398" class="l"><a href="#12398">12398: </a>                        <span class="php-var">$y3</span> = <span class="php-var">$y</span> + <span class="php-var">$dh</span>;
</span><span id="12399" class="l"><a href="#12399">12399: </a>                        <span class="php-var">$x4</span> = <span class="php-var">$x</span>;
</span><span id="12400" class="l"><a href="#12400">12400: </a>                        <span class="php-var">$y4</span> = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="12401" class="l"><a href="#12401">12401: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12402" class="l"><a href="#12402">12402: </a>                    }
</span><span id="12403" class="l"><a href="#12403">12403: </a>                }
</span><span id="12404" class="l"><a href="#12404">12404: </a>                <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>);
</span><span id="12405" class="l"><a href="#12405">12405: </a>                <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x3</span>, <span class="php-var">$y3</span>, <span class="php-var">$x4</span>, <span class="php-var">$y4</span>);
</span><span id="12406" class="l"><a href="#12406">12406: </a>            }
</span><span id="12407" class="l"><a href="#12407">12407: </a>        }
</span><span id="12408" class="l"><a href="#12408">12408: </a>
</span><span id="12409" class="l"><a href="#12409">12409: </a>        <span class="php-comment">/**
</span></span><span id="12410" class="l"><a href="#12410">12410: </a><span class="php-comment">         * Paints a registration mark
</span></span><span id="12411" class="l"><a href="#12411">12411: </a><span class="php-comment">         * @param float $x abscissa of the registration mark center.
</span></span><span id="12412" class="l"><a href="#12412">12412: </a><span class="php-comment">         * @param float $y ordinate of the registration mark center.
</span></span><span id="12413" class="l"><a href="#12413">12413: </a><span class="php-comment">         * @param float $r radius of the crop mark.
</span></span><span id="12414" class="l"><a href="#12414">12414: </a><span class="php-comment">         * @param boolean $double if true print two concentric crop marks.
</span></span><span id="12415" class="l"><a href="#12415">12415: </a><span class="php-comment">         * @param array $cola crop mark color (default black).
</span></span><span id="12416" class="l"><a href="#12416">12416: </a><span class="php-comment">         * @param array $colb second crop mark color.
</span></span><span id="12417" class="l"><a href="#12417">12417: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="12418" class="l"><a href="#12418">12418: </a><span class="php-comment">         * @since 4.9.000 (2010-03-26)
</span></span><span id="12419" class="l"><a href="#12419">12419: </a><span class="php-comment">         * @access public
</span></span><span id="12420" class="l"><a href="#12420">12420: </a><span class="php-comment">         */</span>
</span><span id="12421" class="l"><a href="#12421">12421: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> registrationMark(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r</span>, <span class="php-var">$double</span>=<span class="php-keyword1">false</span>, <span class="php-var">$cola</span>=<span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>), <span class="php-var">$colb</span>=<span class="php-keyword1">array</span>(<span class="php-num">255</span>,<span class="php-num">255</span>,<span class="php-num">255</span>)) {
</span><span id="12422" class="l"><a href="#12422">12422: </a>            <span class="php-var">$line_style</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'width'</span> =&gt; (<span class="php-num">0.5</span> / <span class="php-var">$this</span>-&gt;k), <span class="php-quote">'cap'</span> =&gt; <span class="php-quote">'butt'</span>, <span class="php-quote">'join'</span> =&gt; <span class="php-quote">'miter'</span>, <span class="php-quote">'dash'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'color'</span> =&gt; <span class="php-var">$cola</span>);
</span><span id="12423" class="l"><a href="#12423">12423: </a>            <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$cola</span>);
</span><span id="12424" class="l"><a href="#12424">12424: </a>            <span class="php-var">$this</span>-&gt;PieSector(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r</span>, <span class="php-num">90</span>, <span class="php-num">180</span>, <span class="php-quote">'F'</span>);
</span><span id="12425" class="l"><a href="#12425">12425: </a>            <span class="php-var">$this</span>-&gt;PieSector(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r</span>, <span class="php-num">270</span>, <span class="php-num">360</span>, <span class="php-quote">'F'</span>);
</span><span id="12426" class="l"><a href="#12426">12426: </a>            <span class="php-var">$this</span>-&gt;Circle(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-quote">'C'</span>, <span class="php-var">$line_style</span>, <span class="php-keyword1">array</span>(), <span class="php-num">8</span>);
</span><span id="12427" class="l"><a href="#12427">12427: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$double</span>) {
</span><span id="12428" class="l"><a href="#12428">12428: </a>                <span class="php-var">$r2</span> = <span class="php-var">$r</span> * <span class="php-num">0.5</span>;
</span><span id="12429" class="l"><a href="#12429">12429: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$colb</span>);
</span><span id="12430" class="l"><a href="#12430">12430: </a>                <span class="php-var">$this</span>-&gt;PieSector(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r2</span>, <span class="php-num">90</span>, <span class="php-num">180</span>, <span class="php-quote">'F'</span>);
</span><span id="12431" class="l"><a href="#12431">12431: </a>                <span class="php-var">$this</span>-&gt;PieSector(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r2</span>, <span class="php-num">270</span>, <span class="php-num">360</span>, <span class="php-quote">'F'</span>);
</span><span id="12432" class="l"><a href="#12432">12432: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$cola</span>);
</span><span id="12433" class="l"><a href="#12433">12433: </a>                <span class="php-var">$this</span>-&gt;PieSector(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r2</span>, <span class="php-num">0</span>, <span class="php-num">90</span>, <span class="php-quote">'F'</span>);
</span><span id="12434" class="l"><a href="#12434">12434: </a>                <span class="php-var">$this</span>-&gt;PieSector(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r2</span>, <span class="php-num">180</span>, <span class="php-num">270</span>, <span class="php-quote">'F'</span>);
</span><span id="12435" class="l"><a href="#12435">12435: </a>                <span class="php-var">$this</span>-&gt;Circle(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$r2</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-quote">'C'</span>, <span class="php-var">$line_style</span>, <span class="php-keyword1">array</span>(), <span class="php-num">8</span>);
</span><span id="12436" class="l"><a href="#12436">12436: </a>            }
</span><span id="12437" class="l"><a href="#12437">12437: </a>        }
</span><span id="12438" class="l"><a href="#12438">12438: </a>
</span><span id="12439" class="l"><a href="#12439">12439: </a>        <span class="php-comment">/**
</span></span><span id="12440" class="l"><a href="#12440">12440: </a><span class="php-comment">         * Paints a linear colour gradient.
</span></span><span id="12441" class="l"><a href="#12441">12441: </a><span class="php-comment">         * @param float $x abscissa of the top left corner of the rectangle.
</span></span><span id="12442" class="l"><a href="#12442">12442: </a><span class="php-comment">         * @param float $y ordinate of the top left corner of the rectangle.
</span></span><span id="12443" class="l"><a href="#12443">12443: </a><span class="php-comment">         * @param float $w width of the rectangle.
</span></span><span id="12444" class="l"><a href="#12444">12444: </a><span class="php-comment">         * @param float $h height of the rectangle.
</span></span><span id="12445" class="l"><a href="#12445">12445: </a><span class="php-comment">         * @param array $col1 first color (Grayscale, RGB or CMYK components).
</span></span><span id="12446" class="l"><a href="#12446">12446: </a><span class="php-comment">         * @param array $col2 second color (Grayscale, RGB or CMYK components).
</span></span><span id="12447" class="l"><a href="#12447">12447: </a><span class="php-comment">         * @param array $coords array of the form (x1, y1, x2, y2) which defines the gradient vector (see linear_gradient_coords.jpg). The default value is from left to right (x1=0, y1=0, x2=1, y2=0).
</span></span><span id="12448" class="l"><a href="#12448">12448: </a><span class="php-comment">        
</span></span><span id="12449" class="l"><a href="#12449">12449: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12450" class="l"><a href="#12450">12450: </a><span class="php-comment">         * @access public
</span></span><span id="12451" class="l"><a href="#12451">12451: </a><span class="php-comment">         */</span>
</span><span id="12452" class="l"><a href="#12452">12452: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> LinearGradient(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$col1</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$col2</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$coords</span>=<span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">1</span>,<span class="php-num">0</span>)) {
</span><span id="12453" class="l"><a href="#12453">12453: </a>            <span class="php-var">$this</span>-&gt;Clip(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>);
</span><span id="12454" class="l"><a href="#12454">12454: </a>            <span class="php-var">$this</span>-&gt;Gradient(<span class="php-num">2</span>, <span class="php-var">$coords</span>, <span class="php-keyword1">array</span>(<span class="php-keyword1">array</span>(<span class="php-quote">'color'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'offset'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'exponent'</span> =&gt; <span class="php-num">1</span>), <span class="php-keyword1">array</span>(<span class="php-quote">'color'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'offset'</span> =&gt; <span class="php-num">1</span>, <span class="php-quote">'exponent'</span> =&gt; <span class="php-num">1</span>)), <span class="php-keyword1">array</span>(), <span class="php-keyword1">false</span>);
</span><span id="12455" class="l"><a href="#12455">12455: </a>        }
</span><span id="12456" class="l"><a href="#12456">12456: </a>
</span><span id="12457" class="l"><a href="#12457">12457: </a>        <span class="php-comment">/**
</span></span><span id="12458" class="l"><a href="#12458">12458: </a><span class="php-comment">         * Paints a radial colour gradient.
</span></span><span id="12459" class="l"><a href="#12459">12459: </a><span class="php-comment">         * @param float $x abscissa of the top left corner of the rectangle.
</span></span><span id="12460" class="l"><a href="#12460">12460: </a><span class="php-comment">         * @param float $y ordinate of the top left corner of the rectangle.
</span></span><span id="12461" class="l"><a href="#12461">12461: </a><span class="php-comment">         * @param float $w width of the rectangle.
</span></span><span id="12462" class="l"><a href="#12462">12462: </a><span class="php-comment">         * @param float $h height of the rectangle.
</span></span><span id="12463" class="l"><a href="#12463">12463: </a><span class="php-comment">         * @param array $col1 first color (Grayscale, RGB or CMYK components).
</span></span><span id="12464" class="l"><a href="#12464">12464: </a><span class="php-comment">         * @param array $col2 second color (Grayscale, RGB or CMYK components).
</span></span><span id="12465" class="l"><a href="#12465">12465: </a><span class="php-comment">         * @param array $coords array of the form (fx, fy, cx, cy, r) where (fx, fy) is the starting point of the gradient with color1, (cx, cy) is the center of the circle with color2, and r is the radius of the circle (see radial_gradient_coords.jpg). (fx, fy) should be inside the circle, otherwise some areas will not be defined.
</span></span><span id="12466" class="l"><a href="#12466">12466: </a><span class="php-comment">        
</span></span><span id="12467" class="l"><a href="#12467">12467: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12468" class="l"><a href="#12468">12468: </a><span class="php-comment">         * @access public
</span></span><span id="12469" class="l"><a href="#12469">12469: </a><span class="php-comment">         */</span>
</span><span id="12470" class="l"><a href="#12470">12470: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> RadialGradient(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$col1</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$col2</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$coords</span>=<span class="php-keyword1">array</span>(<span class="php-num">0.5</span>,<span class="php-num">0.5</span>,<span class="php-num">0.5</span>,<span class="php-num">0.5</span>,<span class="php-num">1</span>)) {
</span><span id="12471" class="l"><a href="#12471">12471: </a>            <span class="php-var">$this</span>-&gt;Clip(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>);
</span><span id="12472" class="l"><a href="#12472">12472: </a>            <span class="php-var">$this</span>-&gt;Gradient(<span class="php-num">3</span>, <span class="php-var">$coords</span>, <span class="php-keyword1">array</span>(<span class="php-keyword1">array</span>(<span class="php-quote">'color'</span> =&gt; <span class="php-var">$col1</span>, <span class="php-quote">'offset'</span> =&gt; <span class="php-num">0</span>, <span class="php-quote">'exponent'</span> =&gt; <span class="php-num">1</span>), <span class="php-keyword1">array</span>(<span class="php-quote">'color'</span> =&gt; <span class="php-var">$col2</span>, <span class="php-quote">'offset'</span> =&gt; <span class="php-num">1</span>, <span class="php-quote">'exponent'</span> =&gt; <span class="php-num">1</span>)), <span class="php-keyword1">array</span>(), <span class="php-keyword1">false</span>);
</span><span id="12473" class="l"><a href="#12473">12473: </a>        }
</span><span id="12474" class="l"><a href="#12474">12474: </a>
</span><span id="12475" class="l"><a href="#12475">12475: </a>        <span class="php-comment">/**
</span></span><span id="12476" class="l"><a href="#12476">12476: </a><span class="php-comment">         * Paints a coons patch mesh.
</span></span><span id="12477" class="l"><a href="#12477">12477: </a><span class="php-comment">         * @param float $x abscissa of the top left corner of the rectangle.
</span></span><span id="12478" class="l"><a href="#12478">12478: </a><span class="php-comment">         * @param float $y ordinate of the top left corner of the rectangle.
</span></span><span id="12479" class="l"><a href="#12479">12479: </a><span class="php-comment">         * @param float $w width of the rectangle.
</span></span><span id="12480" class="l"><a href="#12480">12480: </a><span class="php-comment">         * @param float $h height of the rectangle.
</span></span><span id="12481" class="l"><a href="#12481">12481: </a><span class="php-comment">         * @param array $col1 first color (lower left corner) (RGB components).
</span></span><span id="12482" class="l"><a href="#12482">12482: </a><span class="php-comment">         * @param array $col2 second color (lower right corner) (RGB components).
</span></span><span id="12483" class="l"><a href="#12483">12483: </a><span class="php-comment">         * @param array $col3 third color (upper right corner) (RGB components).
</span></span><span id="12484" class="l"><a href="#12484">12484: </a><span class="php-comment">         * @param array $col4 fourth color (upper left corner) (RGB components).
</span></span><span id="12485" class="l"><a href="#12485">12485: </a><span class="php-comment">         * @param array $coords &lt;ul&gt;&lt;li&gt;for one patch mesh: array(float x1, float y1, .... float x12, float y12): 12 pairs of coordinates (normally from 0 to 1) which specify the Bezier control points that define the patch. First pair is the lower left edge point, next is its right control point (control point 2). Then the other points are defined in the order: control point 1, edge point, control point 2 going counter-clockwise around the patch. Last (x12, y12) is the first edge point's left control point (control point 1).&lt;/li&gt;&lt;li&gt;for two or more patch meshes: array[number of patches]: arrays with the following keys for each patch: f: where to put that patch (0 = first patch, 1, 2, 3 = right, top and left of precedent patch - I didn't figure this out completely - just try and error ;-) points: 12 pairs of coordinates of the Bezier control points as above for the first patch, 8 pairs of coordinates for the following patches, ignoring the coordinates already defined by the precedent patch (I also didn't figure out the order of these - also: try and see what's happening) colors: must be 4 colors for the first patch, 2 colors for the following patches&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="12486" class="l"><a href="#12486">12486: </a><span class="php-comment">         * @param array $coords_min minimum value used by the coordinates. If a coordinate's value is smaller than this it will be cut to coords_min. default: 0
</span></span><span id="12487" class="l"><a href="#12487">12487: </a><span class="php-comment">         * @param array $coords_max maximum value used by the coordinates. If a coordinate's value is greater than this it will be cut to coords_max. default: 1
</span></span><span id="12488" class="l"><a href="#12488">12488: </a><span class="php-comment">         * @param boolean $antialias A flag indicating whether to filter the shading function to prevent aliasing artifacts.
</span></span><span id="12489" class="l"><a href="#12489">12489: </a><span class="php-comment">        
</span></span><span id="12490" class="l"><a href="#12490">12490: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12491" class="l"><a href="#12491">12491: </a><span class="php-comment">         * @access public
</span></span><span id="12492" class="l"><a href="#12492">12492: </a><span class="php-comment">         */</span>
</span><span id="12493" class="l"><a href="#12493">12493: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> CoonsPatchMesh(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$col1</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$col2</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$col3</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$col4</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$coords</span>=<span class="php-keyword1">array</span>(<span class="php-num">0.00</span>,<span class="php-num">0.0</span>,<span class="php-num">0.33</span>,<span class="php-num">0.00</span>,<span class="php-num">0.67</span>,<span class="php-num">0.00</span>,<span class="php-num">1.00</span>,<span class="php-num">0.00</span>,<span class="php-num">1.00</span>,<span class="php-num">0.33</span>,<span class="php-num">1.00</span>,<span class="php-num">0.67</span>,<span class="php-num">1.00</span>,<span class="php-num">1.00</span>,<span class="php-num">0.67</span>,<span class="php-num">1.00</span>,<span class="php-num">0.33</span>,<span class="php-num">1.00</span>,<span class="php-num">0.00</span>,<span class="php-num">1.00</span>,<span class="php-num">0.00</span>,<span class="php-num">0.67</span>,<span class="php-num">0.00</span>,<span class="php-num">0.33</span>), <span class="php-var">$coords_min</span>=<span class="php-num">0</span>, <span class="php-var">$coords_max</span>=<span class="php-num">1</span>, <span class="php-var">$antialias</span>=<span class="php-keyword1">false</span>) {
</span><span id="12494" class="l"><a href="#12494">12494: </a>            <span class="php-var">$this</span>-&gt;Clip(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>);
</span><span id="12495" class="l"><a href="#12495">12495: </a>            <span class="php-var">$n</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;gradients) + <span class="php-num">1</span>;
</span><span id="12496" class="l"><a href="#12496">12496: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>] = <span class="php-keyword1">array</span>();
</span><span id="12497" class="l"><a href="#12497">12497: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'type'</span>] = <span class="php-num">6</span>; <span class="php-comment">//coons patch mesh</span>
</span><span id="12498" class="l"><a href="#12498">12498: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'coords'</span>] = <span class="php-keyword1">array</span>();
</span><span id="12499" class="l"><a href="#12499">12499: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'antialias'</span>] = <span class="php-var">$antialias</span>;
</span><span id="12500" class="l"><a href="#12500">12500: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>] = <span class="php-keyword1">array</span>();
</span><span id="12501" class="l"><a href="#12501">12501: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'transparency'</span>] = <span class="php-keyword1">false</span>;
</span><span id="12502" class="l"><a href="#12502">12502: </a>            <span class="php-comment">//check the coords array if it is the simple array or the multi patch array</span>
</span><span id="12503" class="l"><a href="#12503">12503: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$coords</span>[<span class="php-num">0</span>][<span class="php-quote">'f'</span>])) {
</span><span id="12504" class="l"><a href="#12504">12504: </a>                <span class="php-comment">//simple array -&gt; convert to multi patch array</span>
</span><span id="12505" class="l"><a href="#12505">12505: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$col1</span>[<span class="php-num">1</span>])) {
</span><span id="12506" class="l"><a href="#12506">12506: </a>                    <span class="php-var">$col1</span>[<span class="php-num">1</span>] = <span class="php-var">$col1</span>[<span class="php-num">2</span>] = <span class="php-var">$col1</span>[<span class="php-num">0</span>];
</span><span id="12507" class="l"><a href="#12507">12507: </a>                }
</span><span id="12508" class="l"><a href="#12508">12508: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$col2</span>[<span class="php-num">1</span>])) {
</span><span id="12509" class="l"><a href="#12509">12509: </a>                    <span class="php-var">$col2</span>[<span class="php-num">1</span>] = <span class="php-var">$col2</span>[<span class="php-num">2</span>] = <span class="php-var">$col2</span>[<span class="php-num">0</span>];
</span><span id="12510" class="l"><a href="#12510">12510: </a>                }
</span><span id="12511" class="l"><a href="#12511">12511: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$col3</span>[<span class="php-num">1</span>])) {
</span><span id="12512" class="l"><a href="#12512">12512: </a>                    <span class="php-var">$col3</span>[<span class="php-num">1</span>] = <span class="php-var">$col3</span>[<span class="php-num">2</span>] = <span class="php-var">$col3</span>[<span class="php-num">0</span>];
</span><span id="12513" class="l"><a href="#12513">12513: </a>                }
</span><span id="12514" class="l"><a href="#12514">12514: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$col4</span>[<span class="php-num">1</span>])) {
</span><span id="12515" class="l"><a href="#12515">12515: </a>                    <span class="php-var">$col4</span>[<span class="php-num">1</span>] = <span class="php-var">$col4</span>[<span class="php-num">2</span>] = <span class="php-var">$col4</span>[<span class="php-num">0</span>];
</span><span id="12516" class="l"><a href="#12516">12516: </a>                }
</span><span id="12517" class="l"><a href="#12517">12517: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'f'</span>] = <span class="php-num">0</span>;
</span><span id="12518" class="l"><a href="#12518">12518: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'points'</span>] = <span class="php-var">$coords</span>;
</span><span id="12519" class="l"><a href="#12519">12519: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">0</span>][<span class="php-quote">'r'</span>] = <span class="php-var">$col1</span>[<span class="php-num">0</span>];
</span><span id="12520" class="l"><a href="#12520">12520: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">0</span>][<span class="php-quote">'g'</span>] = <span class="php-var">$col1</span>[<span class="php-num">1</span>];
</span><span id="12521" class="l"><a href="#12521">12521: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">0</span>][<span class="php-quote">'b'</span>] = <span class="php-var">$col1</span>[<span class="php-num">2</span>];
</span><span id="12522" class="l"><a href="#12522">12522: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">1</span>][<span class="php-quote">'r'</span>] = <span class="php-var">$col2</span>[<span class="php-num">0</span>];
</span><span id="12523" class="l"><a href="#12523">12523: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">1</span>][<span class="php-quote">'g'</span>] = <span class="php-var">$col2</span>[<span class="php-num">1</span>];
</span><span id="12524" class="l"><a href="#12524">12524: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">1</span>][<span class="php-quote">'b'</span>] = <span class="php-var">$col2</span>[<span class="php-num">2</span>];
</span><span id="12525" class="l"><a href="#12525">12525: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">2</span>][<span class="php-quote">'r'</span>] = <span class="php-var">$col3</span>[<span class="php-num">0</span>];
</span><span id="12526" class="l"><a href="#12526">12526: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">2</span>][<span class="php-quote">'g'</span>] = <span class="php-var">$col3</span>[<span class="php-num">1</span>];
</span><span id="12527" class="l"><a href="#12527">12527: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">2</span>][<span class="php-quote">'b'</span>] = <span class="php-var">$col3</span>[<span class="php-num">2</span>];
</span><span id="12528" class="l"><a href="#12528">12528: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">3</span>][<span class="php-quote">'r'</span>] = <span class="php-var">$col4</span>[<span class="php-num">0</span>];
</span><span id="12529" class="l"><a href="#12529">12529: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">3</span>][<span class="php-quote">'g'</span>] = <span class="php-var">$col4</span>[<span class="php-num">1</span>];
</span><span id="12530" class="l"><a href="#12530">12530: </a>                <span class="php-var">$patch_array</span>[<span class="php-num">0</span>][<span class="php-quote">'colors'</span>][<span class="php-num">3</span>][<span class="php-quote">'b'</span>] = <span class="php-var">$col4</span>[<span class="php-num">2</span>];
</span><span id="12531" class="l"><a href="#12531">12531: </a>            } <span class="php-keyword1">else</span> {
</span><span id="12532" class="l"><a href="#12532">12532: </a>                <span class="php-comment">//multi patch array</span>
</span><span id="12533" class="l"><a href="#12533">12533: </a>                <span class="php-var">$patch_array</span> = <span class="php-var">$coords</span>;
</span><span id="12534" class="l"><a href="#12534">12534: </a>            }
</span><span id="12535" class="l"><a href="#12535">12535: </a>            <span class="php-var">$bpcd</span> = <span class="php-num">65535</span>; <span class="php-comment">//16 bits per coordinate</span>
</span><span id="12536" class="l"><a href="#12536">12536: </a>            <span class="php-comment">//build the data stream</span>
</span><span id="12537" class="l"><a href="#12537">12537: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'stream'</span>] = <span class="php-quote">''</span>;
</span><span id="12538" class="l"><a href="#12538">12538: </a>            <span class="php-var">$count_patch</span> = <span class="php-keyword2">count</span>(<span class="php-var">$patch_array</span>);
</span><span id="12539" class="l"><a href="#12539">12539: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$count_patch</span>; ++<span class="php-var">$i</span>) {
</span><span id="12540" class="l"><a href="#12540">12540: </a>                <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'stream'</span>] .= <span class="php-keyword2">chr</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'f'</span>]); <span class="php-comment">//start with the edge flag as 8 bit</span>
</span><span id="12541" class="l"><a href="#12541">12541: </a>                <span class="php-var">$count_points</span> = <span class="php-keyword2">count</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>]);
</span><span id="12542" class="l"><a href="#12542">12542: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$j</span>=<span class="php-num">0</span>; <span class="php-var">$j</span> &lt; <span class="php-var">$count_points</span>; ++<span class="php-var">$j</span>) {
</span><span id="12543" class="l"><a href="#12543">12543: </a>                    <span class="php-comment">//each point as 16 bit</span>
</span><span id="12544" class="l"><a href="#12544">12544: </a>                    <span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] = ((<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] - <span class="php-var">$coords_min</span>) / (<span class="php-var">$coords_max</span> - <span class="php-var">$coords_min</span>)) * <span class="php-var">$bpcd</span>;
</span><span id="12545" class="l"><a href="#12545">12545: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] &lt; <span class="php-num">0</span>) {
</span><span id="12546" class="l"><a href="#12546">12546: </a>                        <span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] = <span class="php-num">0</span>;
</span><span id="12547" class="l"><a href="#12547">12547: </a>                    }
</span><span id="12548" class="l"><a href="#12548">12548: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] &gt; <span class="php-var">$bpcd</span>) {
</span><span id="12549" class="l"><a href="#12549">12549: </a>                        <span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] = <span class="php-var">$bpcd</span>;
</span><span id="12550" class="l"><a href="#12550">12550: </a>                    }
</span><span id="12551" class="l"><a href="#12551">12551: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'stream'</span>] .= <span class="php-keyword2">chr</span>(<span class="php-keyword2">floor</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] / <span class="php-num">256</span>));
</span><span id="12552" class="l"><a href="#12552">12552: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'stream'</span>] .= <span class="php-keyword2">chr</span>(<span class="php-keyword2">floor</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'points'</span>][<span class="php-var">$j</span>] % <span class="php-num">256</span>));
</span><span id="12553" class="l"><a href="#12553">12553: </a>                }
</span><span id="12554" class="l"><a href="#12554">12554: </a>                <span class="php-var">$count_cols</span> = <span class="php-keyword2">count</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'colors'</span>]);
</span><span id="12555" class="l"><a href="#12555">12555: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$j</span>=<span class="php-num">0</span>; <span class="php-var">$j</span> &lt; <span class="php-var">$count_cols</span>; ++<span class="php-var">$j</span>) {
</span><span id="12556" class="l"><a href="#12556">12556: </a>                    <span class="php-comment">//each color component as 8 bit</span>
</span><span id="12557" class="l"><a href="#12557">12557: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'stream'</span>] .= <span class="php-keyword2">chr</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$j</span>][<span class="php-quote">'r'</span>]);
</span><span id="12558" class="l"><a href="#12558">12558: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'stream'</span>] .= <span class="php-keyword2">chr</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$j</span>][<span class="php-quote">'g'</span>]);
</span><span id="12559" class="l"><a href="#12559">12559: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'stream'</span>] .= <span class="php-keyword2">chr</span>(<span class="php-var">$patch_array</span>[<span class="php-var">$i</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$j</span>][<span class="php-quote">'b'</span>]);
</span><span id="12560" class="l"><a href="#12560">12560: </a>                }
</span><span id="12561" class="l"><a href="#12561">12561: </a>            }
</span><span id="12562" class="l"><a href="#12562">12562: </a>            <span class="php-comment">//paint the gradient</span>
</span><span id="12563" class="l"><a href="#12563">12563: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'/Sh'</span>.<span class="php-var">$n</span>.<span class="php-quote">' sh'</span>);
</span><span id="12564" class="l"><a href="#12564">12564: </a>            <span class="php-comment">//restore previous Graphic State</span>
</span><span id="12565" class="l"><a href="#12565">12565: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'Q'</span>);
</span><span id="12566" class="l"><a href="#12566">12566: </a>        }
</span><span id="12567" class="l"><a href="#12567">12567: </a>
</span><span id="12568" class="l"><a href="#12568">12568: </a>        <span class="php-comment">/**
</span></span><span id="12569" class="l"><a href="#12569">12569: </a><span class="php-comment">         * Set a rectangular clipping area.
</span></span><span id="12570" class="l"><a href="#12570">12570: </a><span class="php-comment">         * @param float $x abscissa of the top left corner of the rectangle (or top right corner for RTL mode).
</span></span><span id="12571" class="l"><a href="#12571">12571: </a><span class="php-comment">         * @param float $y ordinate of the top left corner of the rectangle.
</span></span><span id="12572" class="l"><a href="#12572">12572: </a><span class="php-comment">         * @param float $w width of the rectangle.
</span></span><span id="12573" class="l"><a href="#12573">12573: </a><span class="php-comment">         * @param float $h height of the rectangle.
</span></span><span id="12574" class="l"><a href="#12574">12574: </a><span class="php-comment">        
</span></span><span id="12575" class="l"><a href="#12575">12575: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12576" class="l"><a href="#12576">12576: </a><span class="php-comment">         * @access protected
</span></span><span id="12577" class="l"><a href="#12577">12577: </a><span class="php-comment">         */</span>
</span><span id="12578" class="l"><a href="#12578">12578: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> Clip(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>) {
</span><span id="12579" class="l"><a href="#12579">12579: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="12580" class="l"><a href="#12580">12580: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="12581" class="l"><a href="#12581">12581: </a>            }
</span><span id="12582" class="l"><a href="#12582">12582: </a>            <span class="php-comment">//save current Graphic State</span>
</span><span id="12583" class="l"><a href="#12583">12583: </a>            <span class="php-var">$s</span> = <span class="php-quote">'q'</span>;
</span><span id="12584" class="l"><a href="#12584">12584: </a>            <span class="php-comment">//set clipping area</span>
</span><span id="12585" class="l"><a href="#12585">12585: </a>            <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' %.2F %.2F %.2F %.2F re W n'</span>, <span class="php-var">$x</span>*<span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h-<span class="php-var">$y</span>)*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$w</span>*<span class="php-var">$this</span>-&gt;k, -<span class="php-var">$h</span>*<span class="php-var">$this</span>-&gt;k);
</span><span id="12586" class="l"><a href="#12586">12586: </a>            <span class="php-comment">//set up transformation matrix for gradient</span>
</span><span id="12587" class="l"><a href="#12587">12587: </a>            <span class="php-var">$s</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">' %.3F 0 0 %.3F %.3F %.3F cm'</span>, <span class="php-var">$w</span>*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$h</span>*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$x</span>*<span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h-(<span class="php-var">$y</span>+<span class="php-var">$h</span>))*<span class="php-var">$this</span>-&gt;k);
</span><span id="12588" class="l"><a href="#12588">12588: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$s</span>);
</span><span id="12589" class="l"><a href="#12589">12589: </a>        }
</span><span id="12590" class="l"><a href="#12590">12590: </a>
</span><span id="12591" class="l"><a href="#12591">12591: </a>        <span class="php-comment">/**
</span></span><span id="12592" class="l"><a href="#12592">12592: </a><span class="php-comment">         * Output gradient.
</span></span><span id="12593" class="l"><a href="#12593">12593: </a><span class="php-comment">         * @param int $type type of gradient (1 Function-based shading; 2 Axial shading; 3 Radial shading; 4 Free-form Gouraud-shaded triangle mesh; 5 Lattice-form Gouraud-shaded triangle mesh; 6 Coons patch mesh; 7 Tensor-product patch mesh). (Not all types are currently supported)
</span></span><span id="12594" class="l"><a href="#12594">12594: </a><span class="php-comment">         * @param array $coords array of coordinates.
</span></span><span id="12595" class="l"><a href="#12595">12595: </a><span class="php-comment">         * @param array $stops array gradient color components: color = array of GRAY, RGB or CMYK color components; offset = (0 to 1) represents a location along the gradient vector; exponent = exponent of the exponential interpolation function (default = 1).
</span></span><span id="12596" class="l"><a href="#12596">12596: </a><span class="php-comment">         * @param array $background An array of colour components appropriate to the colour space, specifying a single background colour value.
</span></span><span id="12597" class="l"><a href="#12597">12597: </a><span class="php-comment">         * @param boolean $antialias A flag indicating whether to filter the shading function to prevent aliasing artifacts.
</span></span><span id="12598" class="l"><a href="#12598">12598: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="12599" class="l"><a href="#12599">12599: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12600" class="l"><a href="#12600">12600: </a><span class="php-comment">         * @access public
</span></span><span id="12601" class="l"><a href="#12601">12601: </a><span class="php-comment">         */</span>
</span><span id="12602" class="l"><a href="#12602">12602: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> Gradient(<span class="php-var">$type</span>, <span class="php-var">$coords</span>, <span class="php-var">$stops</span>, <span class="php-var">$background</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$antialias</span>=<span class="php-keyword1">false</span>) {
</span><span id="12603" class="l"><a href="#12603">12603: </a>            <span class="php-var">$n</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;gradients) + <span class="php-num">1</span>;
</span><span id="12604" class="l"><a href="#12604">12604: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>] = <span class="php-keyword1">array</span>();
</span><span id="12605" class="l"><a href="#12605">12605: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'type'</span>] = <span class="php-var">$type</span>;
</span><span id="12606" class="l"><a href="#12606">12606: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'coords'</span>] = <span class="php-var">$coords</span>;
</span><span id="12607" class="l"><a href="#12607">12607: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'antialias'</span>] = <span class="php-var">$antialias</span>;
</span><span id="12608" class="l"><a href="#12608">12608: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>] = <span class="php-keyword1">array</span>();
</span><span id="12609" class="l"><a href="#12609">12609: </a>            <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'transparency'</span>] = <span class="php-keyword1">false</span>;
</span><span id="12610" class="l"><a href="#12610">12610: </a>            <span class="php-comment">// color space</span>
</span><span id="12611" class="l"><a href="#12611">12611: </a>            <span class="php-var">$numcolspace</span> = <span class="php-keyword2">count</span>(<span class="php-var">$stops</span>[<span class="php-num">0</span>][<span class="php-quote">'color'</span>]);
</span><span id="12612" class="l"><a href="#12612">12612: </a>            <span class="php-var">$bcolor</span> = <span class="php-keyword2">array_values</span>(<span class="php-var">$background</span>);
</span><span id="12613" class="l"><a href="#12613">12613: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$numcolspace</span>) {
</span><span id="12614" class="l"><a href="#12614">12614: </a>                <span class="php-keyword1">case</span> <span class="php-num">4</span>: { <span class="php-comment">// CMYK</span>
</span><span id="12615" class="l"><a href="#12615">12615: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colspace'</span>] = <span class="php-quote">'DeviceCMYK'</span>;
</span><span id="12616" class="l"><a href="#12616">12616: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$background</span>)) {
</span><span id="12617" class="l"><a href="#12617">12617: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'background'</span>] = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F'</span>, <span class="php-var">$bcolor</span>[<span class="php-num">0</span>]/<span class="php-num">100</span>, <span class="php-var">$bcolor</span>[<span class="php-num">1</span>]/<span class="php-num">100</span>, <span class="php-var">$bcolor</span>[<span class="php-num">2</span>]/<span class="php-num">100</span>, <span class="php-var">$bcolor</span>[<span class="php-num">3</span>]/<span class="php-num">100</span>);
</span><span id="12618" class="l"><a href="#12618">12618: </a>                    }
</span><span id="12619" class="l"><a href="#12619">12619: </a>                    <span class="php-keyword1">break</span>;
</span><span id="12620" class="l"><a href="#12620">12620: </a>                }
</span><span id="12621" class="l"><a href="#12621">12621: </a>                <span class="php-keyword1">case</span> <span class="php-num">3</span>: { <span class="php-comment">// RGB</span>
</span><span id="12622" class="l"><a href="#12622">12622: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colspace'</span>] = <span class="php-quote">'DeviceRGB'</span>;
</span><span id="12623" class="l"><a href="#12623">12623: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$background</span>)) {
</span><span id="12624" class="l"><a href="#12624">12624: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'background'</span>] = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F'</span>, <span class="php-var">$bcolor</span>[<span class="php-num">0</span>]/<span class="php-num">255</span>, <span class="php-var">$bcolor</span>[<span class="php-num">1</span>]/<span class="php-num">255</span>, <span class="php-var">$bcolor</span>[<span class="php-num">2</span>]/<span class="php-num">255</span>);
</span><span id="12625" class="l"><a href="#12625">12625: </a>                    }
</span><span id="12626" class="l"><a href="#12626">12626: </a>                    <span class="php-keyword1">break</span>;
</span><span id="12627" class="l"><a href="#12627">12627: </a>                }
</span><span id="12628" class="l"><a href="#12628">12628: </a>                <span class="php-keyword1">case</span> <span class="php-num">1</span>: { <span class="php-comment">// Gray scale</span>
</span><span id="12629" class="l"><a href="#12629">12629: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colspace'</span>] = <span class="php-quote">'DeviceGray'</span>;
</span><span id="12630" class="l"><a href="#12630">12630: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$background</span>)) {
</span><span id="12631" class="l"><a href="#12631">12631: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'background'</span>] = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F'</span>, <span class="php-var">$bcolor</span>[<span class="php-num">0</span>]/<span class="php-num">255</span>);
</span><span id="12632" class="l"><a href="#12632">12632: </a>                    }
</span><span id="12633" class="l"><a href="#12633">12633: </a>                    <span class="php-keyword1">break</span>;
</span><span id="12634" class="l"><a href="#12634">12634: </a>                }
</span><span id="12635" class="l"><a href="#12635">12635: </a>            }
</span><span id="12636" class="l"><a href="#12636">12636: </a>            <span class="php-var">$num_stops</span> = <span class="php-keyword2">count</span>(<span class="php-var">$stops</span>);
</span><span id="12637" class="l"><a href="#12637">12637: </a>            <span class="php-var">$last_stop_id</span> = <span class="php-var">$num_stops</span> - <span class="php-num">1</span>;
</span><span id="12638" class="l"><a href="#12638">12638: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$stops</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$stop</span>) {
</span><span id="12639" class="l"><a href="#12639">12639: </a>                <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>] = <span class="php-keyword1">array</span>();
</span><span id="12640" class="l"><a href="#12640">12640: </a>                <span class="php-comment">// offset represents a location along the gradient vector</span>
</span><span id="12641" class="l"><a href="#12641">12641: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$stop</span>[<span class="php-quote">'offset'</span>])) {
</span><span id="12642" class="l"><a href="#12642">12642: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'offset'</span>] = <span class="php-var">$stop</span>[<span class="php-quote">'offset'</span>];
</span><span id="12643" class="l"><a href="#12643">12643: </a>                } <span class="php-keyword1">else</span> {
</span><span id="12644" class="l"><a href="#12644">12644: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$key</span> == <span class="php-num">0</span>) {
</span><span id="12645" class="l"><a href="#12645">12645: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'offset'</span>] = <span class="php-num">0</span>;
</span><span id="12646" class="l"><a href="#12646">12646: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$key</span> == <span class="php-var">$last_stop_id</span>) {
</span><span id="12647" class="l"><a href="#12647">12647: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'offset'</span>] = <span class="php-num">1</span>;
</span><span id="12648" class="l"><a href="#12648">12648: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="12649" class="l"><a href="#12649">12649: </a>                        <span class="php-var">$offsetstep</span> = (<span class="php-num">1</span> - <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-quote">'offset'</span>]) / (<span class="php-var">$num_stops</span> - <span class="php-var">$key</span>);
</span><span id="12650" class="l"><a href="#12650">12650: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'offset'</span>] = <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-quote">'offset'</span>] + <span class="php-var">$offsetstep</span>;
</span><span id="12651" class="l"><a href="#12651">12651: </a>                    }
</span><span id="12652" class="l"><a href="#12652">12652: </a>                }
</span><span id="12653" class="l"><a href="#12653">12653: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$stop</span>[<span class="php-quote">'opacity'</span>])) {
</span><span id="12654" class="l"><a href="#12654">12654: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'opacity'</span>] = <span class="php-var">$stop</span>[<span class="php-quote">'opacity'</span>];
</span><span id="12655" class="l"><a href="#12655">12655: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$stop</span>[<span class="php-quote">'opacity'</span>] &lt; <span class="php-num">1</span>) {
</span><span id="12656" class="l"><a href="#12656">12656: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'transparency'</span>] = <span class="php-keyword1">true</span>;
</span><span id="12657" class="l"><a href="#12657">12657: </a>                    }
</span><span id="12658" class="l"><a href="#12658">12658: </a>                } <span class="php-keyword1">else</span> {
</span><span id="12659" class="l"><a href="#12659">12659: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'opacity'</span>] = <span class="php-num">1</span>;
</span><span id="12660" class="l"><a href="#12660">12660: </a>                }
</span><span id="12661" class="l"><a href="#12661">12661: </a>                <span class="php-comment">// exponent for the exponential interpolation function</span>
</span><span id="12662" class="l"><a href="#12662">12662: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$stop</span>[<span class="php-quote">'exponent'</span>])) {
</span><span id="12663" class="l"><a href="#12663">12663: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'exponent'</span>] = <span class="php-var">$stop</span>[<span class="php-quote">'exponent'</span>];
</span><span id="12664" class="l"><a href="#12664">12664: </a>                } <span class="php-keyword1">else</span> {
</span><span id="12665" class="l"><a href="#12665">12665: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'exponent'</span>] = <span class="php-num">1</span>;
</span><span id="12666" class="l"><a href="#12666">12666: </a>                }
</span><span id="12667" class="l"><a href="#12667">12667: </a>                <span class="php-comment">// set colors</span>
</span><span id="12668" class="l"><a href="#12668">12668: </a>                <span class="php-var">$color</span> = <span class="php-keyword2">array_values</span>(<span class="php-var">$stop</span>[<span class="php-quote">'color'</span>]);
</span><span id="12669" class="l"><a href="#12669">12669: </a>                <span class="php-keyword1">switch</span>(<span class="php-var">$numcolspace</span>) {
</span><span id="12670" class="l"><a href="#12670">12670: </a>                    <span class="php-keyword1">case</span> <span class="php-num">4</span>: { <span class="php-comment">// CMYK</span>
</span><span id="12671" class="l"><a href="#12671">12671: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'color'</span>] = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F'</span>, <span class="php-var">$color</span>[<span class="php-num">0</span>]/<span class="php-num">100</span>, <span class="php-var">$color</span>[<span class="php-num">1</span>]/<span class="php-num">100</span>, <span class="php-var">$color</span>[<span class="php-num">2</span>]/<span class="php-num">100</span>, <span class="php-var">$color</span>[<span class="php-num">3</span>]/<span class="php-num">100</span>);
</span><span id="12672" class="l"><a href="#12672">12672: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12673" class="l"><a href="#12673">12673: </a>                    }
</span><span id="12674" class="l"><a href="#12674">12674: </a>                    <span class="php-keyword1">case</span> <span class="php-num">3</span>: { <span class="php-comment">// RGB</span>
</span><span id="12675" class="l"><a href="#12675">12675: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'color'</span>] = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F'</span>, <span class="php-var">$color</span>[<span class="php-num">0</span>]/<span class="php-num">255</span>, <span class="php-var">$color</span>[<span class="php-num">1</span>]/<span class="php-num">255</span>, <span class="php-var">$color</span>[<span class="php-num">2</span>]/<span class="php-num">255</span>);
</span><span id="12676" class="l"><a href="#12676">12676: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12677" class="l"><a href="#12677">12677: </a>                    }
</span><span id="12678" class="l"><a href="#12678">12678: </a>                    <span class="php-keyword1">case</span> <span class="php-num">1</span>: { <span class="php-comment">// Gray scale</span>
</span><span id="12679" class="l"><a href="#12679">12679: </a>                        <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'colors'</span>][<span class="php-var">$key</span>][<span class="php-quote">'color'</span>] = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F'</span>, <span class="php-var">$color</span>[<span class="php-num">0</span>]/<span class="php-num">255</span>);
</span><span id="12680" class="l"><a href="#12680">12680: </a>                        <span class="php-keyword1">break</span>;
</span><span id="12681" class="l"><a href="#12681">12681: </a>                    }
</span><span id="12682" class="l"><a href="#12682">12682: </a>                }
</span><span id="12683" class="l"><a href="#12683">12683: </a>            }
</span><span id="12684" class="l"><a href="#12684">12684: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$n</span>][<span class="php-quote">'transparency'</span>]) {
</span><span id="12685" class="l"><a href="#12685">12685: </a>                <span class="php-comment">// paint luminosity gradient</span>
</span><span id="12686" class="l"><a href="#12686">12686: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'/TGS'</span>.<span class="php-var">$n</span>.<span class="php-quote">' gs'</span>);
</span><span id="12687" class="l"><a href="#12687">12687: </a>            }
</span><span id="12688" class="l"><a href="#12688">12688: </a>            <span class="php-comment">//paint the gradient</span>
</span><span id="12689" class="l"><a href="#12689">12689: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'/Sh'</span>.<span class="php-var">$n</span>.<span class="php-quote">' sh'</span>);
</span><span id="12690" class="l"><a href="#12690">12690: </a>            <span class="php-comment">//restore previous Graphic State</span>
</span><span id="12691" class="l"><a href="#12691">12691: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'Q'</span>);
</span><span id="12692" class="l"><a href="#12692">12692: </a>        }
</span><span id="12693" class="l"><a href="#12693">12693: </a>
</span><span id="12694" class="l"><a href="#12694">12694: </a>        <span class="php-comment">/**
</span></span><span id="12695" class="l"><a href="#12695">12695: </a><span class="php-comment">         * Output gradient shaders.
</span></span><span id="12696" class="l"><a href="#12696">12696: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="12697" class="l"><a href="#12697">12697: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12698" class="l"><a href="#12698">12698: </a><span class="php-comment">         * @access protected
</span></span><span id="12699" class="l"><a href="#12699">12699: </a><span class="php-comment">         */</span>
</span><span id="12700" class="l"><a href="#12700">12700: </a>        <span class="php-keyword1">function</span> _putshaders() {
</span><span id="12701" class="l"><a href="#12701">12701: </a>            <span class="php-var">$idt</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;gradients); <span class="php-comment">//index for transparency gradients</span>
</span><span id="12702" class="l"><a href="#12702">12702: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;gradients <span class="php-keyword1">as</span> <span class="php-var">$id</span> =&gt; <span class="php-var">$grad</span>) {
</span><span id="12703" class="l"><a href="#12703">12703: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$grad</span>[<span class="php-quote">'type'</span>] == <span class="php-num">2</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$grad</span>[<span class="php-quote">'type'</span>] == <span class="php-num">3</span>)) {
</span><span id="12704" class="l"><a href="#12704">12704: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12705" class="l"><a href="#12705">12705: </a>                    <span class="php-var">$fc</span> = <span class="php-var">$this</span>-&gt;n;
</span><span id="12706" class="l"><a href="#12706">12706: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;'</span>;
</span><span id="12707" class="l"><a href="#12707">12707: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /FunctionType 3'</span>;
</span><span id="12708" class="l"><a href="#12708">12708: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Domain [0 1]'</span>;
</span><span id="12709" class="l"><a href="#12709">12709: </a>                    <span class="php-var">$functions</span> = <span class="php-quote">''</span>;
</span><span id="12710" class="l"><a href="#12710">12710: </a>                    <span class="php-var">$bounds</span> = <span class="php-quote">''</span>;
</span><span id="12711" class="l"><a href="#12711">12711: </a>                    <span class="php-var">$encode</span> = <span class="php-quote">''</span>;
</span><span id="12712" class="l"><a href="#12712">12712: </a>                    <span class="php-var">$i</span> = <span class="php-num">1</span>;
</span><span id="12713" class="l"><a href="#12713">12713: </a>                    <span class="php-var">$num_cols</span> = <span class="php-keyword2">count</span>(<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>]);
</span><span id="12714" class="l"><a href="#12714">12714: </a>                    <span class="php-var">$lastcols</span> = <span class="php-var">$num_cols</span> - <span class="php-num">1</span>;
</span><span id="12715" class="l"><a href="#12715">12715: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$num_cols</span>; ++<span class="php-var">$i</span>) {
</span><span id="12716" class="l"><a href="#12716">12716: </a>                        <span class="php-var">$functions</span> .= (<span class="php-var">$fc</span> + <span class="php-var">$i</span>).<span class="php-quote">' 0 R '</span>;
</span><span id="12717" class="l"><a href="#12717">12717: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$i</span> &lt; <span class="php-var">$lastcols</span>) {
</span><span id="12718" class="l"><a href="#12718">12718: </a>                            <span class="php-var">$bounds</span> .= <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F '</span>, <span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>][<span class="php-var">$i</span>][<span class="php-quote">'offset'</span>]);
</span><span id="12719" class="l"><a href="#12719">12719: </a>                        }
</span><span id="12720" class="l"><a href="#12720">12720: </a>                        <span class="php-var">$encode</span> .= <span class="php-quote">'0 1 '</span>;
</span><span id="12721" class="l"><a href="#12721">12721: </a>                    }
</span><span id="12722" class="l"><a href="#12722">12722: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Functions ['</span>.<span class="php-keyword2">trim</span>(<span class="php-var">$functions</span>).<span class="php-quote">']'</span>;
</span><span id="12723" class="l"><a href="#12723">12723: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Bounds ['</span>.<span class="php-keyword2">trim</span>(<span class="php-var">$bounds</span>).<span class="php-quote">']'</span>;
</span><span id="12724" class="l"><a href="#12724">12724: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Encode ['</span>.<span class="php-keyword2">trim</span>(<span class="php-var">$encode</span>).<span class="php-quote">']'</span>;
</span><span id="12725" class="l"><a href="#12725">12725: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12726" class="l"><a href="#12726">12726: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="12727" class="l"><a href="#12727">12727: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12728" class="l"><a href="#12728">12728: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$num_cols</span>; ++<span class="php-var">$i</span>) {
</span><span id="12729" class="l"><a href="#12729">12729: </a>                        <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12730" class="l"><a href="#12730">12730: </a>                        <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;'</span>;
</span><span id="12731" class="l"><a href="#12731">12731: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /FunctionType 2'</span>;
</span><span id="12732" class="l"><a href="#12732">12732: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Domain [0 1]'</span>;
</span><span id="12733" class="l"><a href="#12733">12733: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /C0 ['</span>.<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>][(<span class="php-var">$i</span> - <span class="php-num">1</span>)][<span class="php-quote">'color'</span>].<span class="php-quote">']'</span>;
</span><span id="12734" class="l"><a href="#12734">12734: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /C1 ['</span>.<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>][<span class="php-var">$i</span>][<span class="php-quote">'color'</span>].<span class="php-quote">']'</span>;
</span><span id="12735" class="l"><a href="#12735">12735: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /N '</span>.<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>][<span class="php-var">$i</span>][<span class="php-quote">'exponent'</span>];
</span><span id="12736" class="l"><a href="#12736">12736: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12737" class="l"><a href="#12737">12737: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="12738" class="l"><a href="#12738">12738: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12739" class="l"><a href="#12739">12739: </a>                    }
</span><span id="12740" class="l"><a href="#12740">12740: </a>                    <span class="php-comment">// set transparency fuctions</span>
</span><span id="12741" class="l"><a href="#12741">12741: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$grad</span>[<span class="php-quote">'transparency'</span>]) {
</span><span id="12742" class="l"><a href="#12742">12742: </a>                        <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12743" class="l"><a href="#12743">12743: </a>                        <span class="php-var">$ft</span> = <span class="php-var">$this</span>-&gt;n;
</span><span id="12744" class="l"><a href="#12744">12744: </a>                        <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;'</span>;
</span><span id="12745" class="l"><a href="#12745">12745: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /FunctionType 3'</span>;
</span><span id="12746" class="l"><a href="#12746">12746: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Domain [0 1]'</span>;
</span><span id="12747" class="l"><a href="#12747">12747: </a>                        <span class="php-var">$functions</span> = <span class="php-quote">''</span>;
</span><span id="12748" class="l"><a href="#12748">12748: </a>                        <span class="php-var">$i</span> = <span class="php-num">1</span>;
</span><span id="12749" class="l"><a href="#12749">12749: </a>                        <span class="php-var">$num_cols</span> = <span class="php-keyword2">count</span>(<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>]);
</span><span id="12750" class="l"><a href="#12750">12750: </a>                        <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$num_cols</span>; ++<span class="php-var">$i</span>) {
</span><span id="12751" class="l"><a href="#12751">12751: </a>                            <span class="php-var">$functions</span> .= (<span class="php-var">$ft</span> + <span class="php-var">$i</span>).<span class="php-quote">' 0 R '</span>;
</span><span id="12752" class="l"><a href="#12752">12752: </a>                        }
</span><span id="12753" class="l"><a href="#12753">12753: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Functions ['</span>.<span class="php-keyword2">trim</span>(<span class="php-var">$functions</span>).<span class="php-quote">']'</span>;
</span><span id="12754" class="l"><a href="#12754">12754: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Bounds ['</span>.<span class="php-keyword2">trim</span>(<span class="php-var">$bounds</span>).<span class="php-quote">']'</span>;
</span><span id="12755" class="l"><a href="#12755">12755: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' /Encode ['</span>.<span class="php-keyword2">trim</span>(<span class="php-var">$encode</span>).<span class="php-quote">']'</span>;
</span><span id="12756" class="l"><a href="#12756">12756: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12757" class="l"><a href="#12757">12757: </a>                        <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="12758" class="l"><a href="#12758">12758: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12759" class="l"><a href="#12759">12759: </a>                        <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">1</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$num_cols</span>; ++<span class="php-var">$i</span>) {
</span><span id="12760" class="l"><a href="#12760">12760: </a>                            <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12761" class="l"><a href="#12761">12761: </a>                            <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt;'</span>;
</span><span id="12762" class="l"><a href="#12762">12762: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' /FunctionType 2'</span>;
</span><span id="12763" class="l"><a href="#12763">12763: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' /Domain [0 1]'</span>;
</span><span id="12764" class="l"><a href="#12764">12764: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' /C0 ['</span>.<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>][(<span class="php-var">$i</span> - <span class="php-num">1</span>)][<span class="php-quote">'opacity'</span>].<span class="php-quote">']'</span>;
</span><span id="12765" class="l"><a href="#12765">12765: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' /C1 ['</span>.<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>][<span class="php-var">$i</span>][<span class="php-quote">'opacity'</span>].<span class="php-quote">']'</span>;
</span><span id="12766" class="l"><a href="#12766">12766: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' /N '</span>.<span class="php-var">$grad</span>[<span class="php-quote">'colors'</span>][<span class="php-var">$i</span>][<span class="php-quote">'exponent'</span>];
</span><span id="12767" class="l"><a href="#12767">12767: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12768" class="l"><a href="#12768">12768: </a>                            <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="12769" class="l"><a href="#12769">12769: </a>                            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12770" class="l"><a href="#12770">12770: </a>                        }
</span><span id="12771" class="l"><a href="#12771">12771: </a>                    }
</span><span id="12772" class="l"><a href="#12772">12772: </a>                }
</span><span id="12773" class="l"><a href="#12773">12773: </a>                <span class="php-comment">// set shading object</span>
</span><span id="12774" class="l"><a href="#12774">12774: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12775" class="l"><a href="#12775">12775: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /ShadingType '</span>.<span class="php-var">$grad</span>[<span class="php-quote">'type'</span>];
</span><span id="12776" class="l"><a href="#12776">12776: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$grad</span>[<span class="php-quote">'colspace'</span>])) {
</span><span id="12777" class="l"><a href="#12777">12777: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /ColorSpace /'</span>.<span class="php-var">$grad</span>[<span class="php-quote">'colspace'</span>];
</span><span id="12778" class="l"><a href="#12778">12778: </a>                } <span class="php-keyword1">else</span> {
</span><span id="12779" class="l"><a href="#12779">12779: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /ColorSpace /DeviceRGB'</span>;
</span><span id="12780" class="l"><a href="#12780">12780: </a>                }
</span><span id="12781" class="l"><a href="#12781">12781: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$grad</span>[<span class="php-quote">'background'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$grad</span>[<span class="php-quote">'background'</span>])) {
</span><span id="12782" class="l"><a href="#12782">12782: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Background ['</span>.<span class="php-var">$grad</span>[<span class="php-quote">'background'</span>].<span class="php-quote">']'</span>;
</span><span id="12783" class="l"><a href="#12783">12783: </a>                }
</span><span id="12784" class="l"><a href="#12784">12784: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$grad</span>[<span class="php-quote">'antialias'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$grad</span>[<span class="php-quote">'antialias'</span>] === <span class="php-keyword1">true</span>)) {
</span><span id="12785" class="l"><a href="#12785">12785: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /AntiAlias true'</span>;
</span><span id="12786" class="l"><a href="#12786">12786: </a>                }
</span><span id="12787" class="l"><a href="#12787">12787: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$grad</span>[<span class="php-quote">'type'</span>] == <span class="php-num">2</span>) {
</span><span id="12788" class="l"><a href="#12788">12788: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'/Coords [%.3F %.3F %.3F %.3F]'</span>, <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>], <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>], <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>], <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>]);
</span><span id="12789" class="l"><a href="#12789">12789: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Domain [0 1]'</span>;
</span><span id="12790" class="l"><a href="#12790">12790: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Function '</span>.<span class="php-var">$fc</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="12791" class="l"><a href="#12791">12791: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Extend [true true]'</span>;
</span><span id="12792" class="l"><a href="#12792">12792: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12793" class="l"><a href="#12793">12793: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$grad</span>[<span class="php-quote">'type'</span>] == <span class="php-num">3</span>) {
</span><span id="12794" class="l"><a href="#12794">12794: </a>                    <span class="php-comment">//x0, y0, r0, x1, y1, r1</span>
</span><span id="12795" class="l"><a href="#12795">12795: </a>                    <span class="php-comment">//at this this time radius of inner circle is 0</span>
</span><span id="12796" class="l"><a href="#12796">12796: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-keyword2">sprintf</span>(<span class="php-quote">'/Coords [%.3F %.3F 0 %.3F %.3F %.3F]'</span>, <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>], <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>], <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>], <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>], <span class="php-var">$grad</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>]);
</span><span id="12797" class="l"><a href="#12797">12797: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Domain [0 1]'</span>;
</span><span id="12798" class="l"><a href="#12798">12798: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Function '</span>.<span class="php-var">$fc</span>.<span class="php-quote">' 0 R'</span>;
</span><span id="12799" class="l"><a href="#12799">12799: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Extend [true true]'</span>;
</span><span id="12800" class="l"><a href="#12800">12800: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12801" class="l"><a href="#12801">12801: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$grad</span>[<span class="php-quote">'type'</span>] == <span class="php-num">6</span>) {
</span><span id="12802" class="l"><a href="#12802">12802: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /BitsPerCoordinate 16'</span>;
</span><span id="12803" class="l"><a href="#12803">12803: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /BitsPerComponent 8'</span>;
</span><span id="12804" class="l"><a href="#12804">12804: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Decode[0 1 0 1 0 1 0 1 0 1]'</span>;
</span><span id="12805" class="l"><a href="#12805">12805: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /BitsPerFlag 8'</span>;
</span><span id="12806" class="l"><a href="#12806">12806: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$grad</span>[<span class="php-quote">'stream'</span>]);
</span><span id="12807" class="l"><a href="#12807">12807: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12808" class="l"><a href="#12808">12808: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$grad</span>[<span class="php-quote">'stream'</span>]);
</span><span id="12809" class="l"><a href="#12809">12809: </a>                }
</span><span id="12810" class="l"><a href="#12810">12810: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="12811" class="l"><a href="#12811">12811: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12812" class="l"><a href="#12812">12812: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$grad</span>[<span class="php-quote">'transparency'</span>]) {
</span><span id="12813" class="l"><a href="#12813">12813: </a>                    <span class="php-var">$shading_transparency</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/\/ColorSpace \/[^\s]+/si'</span>, <span class="php-quote">'/ColorSpace /DeviceGray'</span>, <span class="php-var">$out</span>);
</span><span id="12814" class="l"><a href="#12814">12814: </a>                    <span class="php-var">$shading_transparency</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/\/Function [0-9]+ /si'</span>, <span class="php-quote">'/Function '</span>.<span class="php-var">$ft</span>.<span class="php-quote">' '</span>, <span class="php-var">$shading_transparency</span>);
</span><span id="12815" class="l"><a href="#12815">12815: </a>                }
</span><span id="12816" class="l"><a href="#12816">12816: </a>                <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$id</span>][<span class="php-quote">'id'</span>] = <span class="php-var">$this</span>-&gt;n;
</span><span id="12817" class="l"><a href="#12817">12817: </a>                <span class="php-comment">// set pattern object</span>
</span><span id="12818" class="l"><a href="#12818">12818: </a>                <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12819" class="l"><a href="#12819">12819: </a>                <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /Pattern /PatternType 2'</span>;
</span><span id="12820" class="l"><a href="#12820">12820: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' /Shading '</span>.<span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$id</span>][<span class="php-quote">'id'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="12821" class="l"><a href="#12821">12821: </a>                <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="12822" class="l"><a href="#12822">12822: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12823" class="l"><a href="#12823">12823: </a>                <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$id</span>][<span class="php-quote">'pattern'</span>] = <span class="php-var">$this</span>-&gt;n;
</span><span id="12824" class="l"><a href="#12824">12824: </a>                <span class="php-comment">// set shading and pattern for transparency mask</span>
</span><span id="12825" class="l"><a href="#12825">12825: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$grad</span>[<span class="php-quote">'transparency'</span>]) {
</span><span id="12826" class="l"><a href="#12826">12826: </a>                    <span class="php-comment">// luminosity pattern</span>
</span><span id="12827" class="l"><a href="#12827">12827: </a>                    <span class="php-var">$idgs</span> = <span class="php-var">$id</span> + <span class="php-var">$idt</span>;
</span><span id="12828" class="l"><a href="#12828">12828: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12829" class="l"><a href="#12829">12829: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$shading_transparency</span>);
</span><span id="12830" class="l"><a href="#12830">12830: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$idgs</span>][<span class="php-quote">'id'</span>] = <span class="php-var">$this</span>-&gt;n;
</span><span id="12831" class="l"><a href="#12831">12831: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12832" class="l"><a href="#12832">12832: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /Pattern /PatternType 2'</span>;
</span><span id="12833" class="l"><a href="#12833">12833: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Shading '</span>.<span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$idgs</span>][<span class="php-quote">'id'</span>].<span class="php-quote">' 0 R'</span>;
</span><span id="12834" class="l"><a href="#12834">12834: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; endobj'</span>;
</span><span id="12835" class="l"><a href="#12835">12835: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12836" class="l"><a href="#12836">12836: </a>                    <span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$idgs</span>][<span class="php-quote">'pattern'</span>] = <span class="php-var">$this</span>-&gt;n;
</span><span id="12837" class="l"><a href="#12837">12837: </a>                    <span class="php-comment">// luminosity XObject</span>
</span><span id="12838" class="l"><a href="#12838">12838: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12839" class="l"><a href="#12839">12839: </a>                    <span class="php-var">$filter</span> = (<span class="php-var">$this</span>-&gt;compress)?<span class="php-quote">' /Filter /FlateDecode'</span>:<span class="php-quote">''</span>;
</span><span id="12840" class="l"><a href="#12840">12840: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /XObject /Subtype /Form /FormType 1'</span>.<span class="php-var">$filter</span>;
</span><span id="12841" class="l"><a href="#12841">12841: </a>                    <span class="php-var">$stream</span> = <span class="php-quote">'q /a0 gs /Pattern cs /p'</span>.<span class="php-var">$idgs</span>.<span class="php-quote">' scn 0 0 '</span>.<span class="php-var">$this</span>-&gt;wPt.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;hPt.<span class="php-quote">' re f Q'</span>;
</span><span id="12842" class="l"><a href="#12842">12842: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Length '</span>.<span class="php-keyword2">strlen</span>(<span class="php-var">$stream</span>);
</span><span id="12843" class="l"><a href="#12843">12843: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /BBox [0 0 '</span>.<span class="php-var">$this</span>-&gt;wPt.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;hPt.<span class="php-quote">']'</span>;
</span><span id="12844" class="l"><a href="#12844">12844: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Group &lt;&lt; /Type /Group /S /Transparency /CS /DeviceGray &gt;&gt;'</span>;
</span><span id="12845" class="l"><a href="#12845">12845: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Resources &lt;&lt;'</span>;
</span><span id="12846" class="l"><a href="#12846">12846: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /ExtGState &lt;&lt; /a0 &lt;&lt; /ca 1 /CA 1 &gt;&gt; &gt;&gt;'</span>;
</span><span id="12847" class="l"><a href="#12847">12847: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' /Pattern &lt;&lt; /p'</span>.<span class="php-var">$idgs</span>.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;gradients[<span class="php-var">$idgs</span>][<span class="php-quote">'pattern'</span>].<span class="php-quote">' 0 R &gt;&gt;'</span>;
</span><span id="12848" class="l"><a href="#12848">12848: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt;'</span>;
</span><span id="12849" class="l"><a href="#12849">12849: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' &gt;&gt; '</span>;
</span><span id="12850" class="l"><a href="#12850">12850: </a>                    <span class="php-var">$out</span> .= <span class="php-var">$this</span>-&gt;_getstream(<span class="php-var">$stream</span>);
</span><span id="12851" class="l"><a href="#12851">12851: </a>                    <span class="php-var">$out</span> .= <span class="php-quote">' endobj'</span>;
</span><span id="12852" class="l"><a href="#12852">12852: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12853" class="l"><a href="#12853">12853: </a>                    <span class="php-comment">// SMask</span>
</span><span id="12854" class="l"><a href="#12854">12854: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12855" class="l"><a href="#12855">12855: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /Mask /S /Luminosity /G '</span>.(<span class="php-var">$this</span>-&gt;n - <span class="php-num">1</span>).<span class="php-quote">' 0 R &gt;&gt; endobj'</span>;
</span><span id="12856" class="l"><a href="#12856">12856: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12857" class="l"><a href="#12857">12857: </a>                    <span class="php-comment">// ExtGState</span>
</span><span id="12858" class="l"><a href="#12858">12858: </a>                    <span class="php-var">$this</span>-&gt;_newobj();
</span><span id="12859" class="l"><a href="#12859">12859: </a>                    <span class="php-var">$out</span> = <span class="php-quote">'&lt;&lt; /Type /ExtGState /SMask '</span>.(<span class="php-var">$this</span>-&gt;n - <span class="php-num">1</span>).<span class="php-quote">' 0 R /AIS false &gt;&gt; endobj'</span>;
</span><span id="12860" class="l"><a href="#12860">12860: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$out</span>);
</span><span id="12861" class="l"><a href="#12861">12861: </a>                    <span class="php-var">$this</span>-&gt;extgstates[] = <span class="php-keyword1">array</span>(<span class="php-quote">'n'</span> =&gt; <span class="php-var">$this</span>-&gt;n, <span class="php-quote">'name'</span> =&gt; <span class="php-quote">'TGS'</span>.<span class="php-var">$id</span>);
</span><span id="12862" class="l"><a href="#12862">12862: </a>                }
</span><span id="12863" class="l"><a href="#12863">12863: </a>            }
</span><span id="12864" class="l"><a href="#12864">12864: </a>        }
</span><span id="12865" class="l"><a href="#12865">12865: </a>
</span><span id="12866" class="l"><a href="#12866">12866: </a>        <span class="php-comment">/**
</span></span><span id="12867" class="l"><a href="#12867">12867: </a><span class="php-comment">         * Draw the sector of a circle.
</span></span><span id="12868" class="l"><a href="#12868">12868: </a><span class="php-comment">         * It can be used for instance to render pie charts.
</span></span><span id="12869" class="l"><a href="#12869">12869: </a><span class="php-comment">         * @param float $xc abscissa of the center.
</span></span><span id="12870" class="l"><a href="#12870">12870: </a><span class="php-comment">         * @param float $yc ordinate of the center.
</span></span><span id="12871" class="l"><a href="#12871">12871: </a><span class="php-comment">         * @param float $r radius.
</span></span><span id="12872" class="l"><a href="#12872">12872: </a><span class="php-comment">         * @param float $a start angle (in degrees).
</span></span><span id="12873" class="l"><a href="#12873">12873: </a><span class="php-comment">         * @param float $b end angle (in degrees).
</span></span><span id="12874" class="l"><a href="#12874">12874: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="12875" class="l"><a href="#12875">12875: </a><span class="php-comment">         * @param float $cw: indicates whether to go clockwise (default: true).
</span></span><span id="12876" class="l"><a href="#12876">12876: </a><span class="php-comment">         * @param float $o: origin of angles (0 for 3 o'clock, 90 for noon, 180 for 9 o'clock, 270 for 6 o'clock). Default: 90.
</span></span><span id="12877" class="l"><a href="#12877">12877: </a><span class="php-comment">         * @author Maxime Delorme, Nicola Asuni
</span></span><span id="12878" class="l"><a href="#12878">12878: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12879" class="l"><a href="#12879">12879: </a><span class="php-comment">         * @access public
</span></span><span id="12880" class="l"><a href="#12880">12880: </a><span class="php-comment">         */</span>
</span><span id="12881" class="l"><a href="#12881">12881: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> PieSector(<span class="php-var">$xc</span>, <span class="php-var">$yc</span>, <span class="php-var">$r</span>, <span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-var">$style</span>=<span class="php-quote">'FD'</span>, <span class="php-var">$cw</span>=<span class="php-keyword1">true</span>, <span class="php-var">$o</span>=<span class="php-num">90</span>) {
</span><span id="12882" class="l"><a href="#12882">12882: </a>            <span class="php-var">$this</span>-&gt;PieSectorXY(<span class="php-var">$xc</span>, <span class="php-var">$yc</span>, <span class="php-var">$r</span>, <span class="php-var">$r</span>, <span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-var">$style</span>, <span class="php-var">$cw</span>, <span class="php-var">$o</span>);
</span><span id="12883" class="l"><a href="#12883">12883: </a>        }
</span><span id="12884" class="l"><a href="#12884">12884: </a>
</span><span id="12885" class="l"><a href="#12885">12885: </a>        <span class="php-comment">/**
</span></span><span id="12886" class="l"><a href="#12886">12886: </a><span class="php-comment">         * Draw the sector of an ellipse.
</span></span><span id="12887" class="l"><a href="#12887">12887: </a><span class="php-comment">         * It can be used for instance to render pie charts.
</span></span><span id="12888" class="l"><a href="#12888">12888: </a><span class="php-comment">         * @param float $xc abscissa of the center.
</span></span><span id="12889" class="l"><a href="#12889">12889: </a><span class="php-comment">         * @param float $yc ordinate of the center.
</span></span><span id="12890" class="l"><a href="#12890">12890: </a><span class="php-comment">         * @param float $rx the x-axis radius.
</span></span><span id="12891" class="l"><a href="#12891">12891: </a><span class="php-comment">         * @param float $ry the y-axis radius.
</span></span><span id="12892" class="l"><a href="#12892">12892: </a><span class="php-comment">         * @param float $a start angle (in degrees).
</span></span><span id="12893" class="l"><a href="#12893">12893: </a><span class="php-comment">         * @param float $b end angle (in degrees).
</span></span><span id="12894" class="l"><a href="#12894">12894: </a><span class="php-comment">         * @param string $style Style of rendering. See the getPathPaintOperator() function for more information.
</span></span><span id="12895" class="l"><a href="#12895">12895: </a><span class="php-comment">         * @param float $cw: indicates whether to go clockwise.
</span></span><span id="12896" class="l"><a href="#12896">12896: </a><span class="php-comment">         * @param float $o: origin of angles (0 for 3 o'clock, 90 for noon, 180 for 9 o'clock, 270 for 6 o'clock).
</span></span><span id="12897" class="l"><a href="#12897">12897: </a><span class="php-comment">         * @param integer $nc Number of curves used to draw a 90 degrees portion of arc.
</span></span><span id="12898" class="l"><a href="#12898">12898: </a><span class="php-comment">         * @author Maxime Delorme, Nicola Asuni
</span></span><span id="12899" class="l"><a href="#12899">12899: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12900" class="l"><a href="#12900">12900: </a><span class="php-comment">         * @access public
</span></span><span id="12901" class="l"><a href="#12901">12901: </a><span class="php-comment">         */</span>
</span><span id="12902" class="l"><a href="#12902">12902: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> PieSectorXY(<span class="php-var">$xc</span>, <span class="php-var">$yc</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-var">$style</span>=<span class="php-quote">'FD'</span>, <span class="php-var">$cw</span>=<span class="php-keyword1">false</span>, <span class="php-var">$o</span>=<span class="php-num">0</span>, <span class="php-var">$nc</span>=<span class="php-num">2</span>) {
</span><span id="12903" class="l"><a href="#12903">12903: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="12904" class="l"><a href="#12904">12904: </a>                <span class="php-var">$xc</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$xc</span>;
</span><span id="12905" class="l"><a href="#12905">12905: </a>            }
</span><span id="12906" class="l"><a href="#12906">12906: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>);
</span><span id="12907" class="l"><a href="#12907">12907: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$op</span> == <span class="php-quote">'f'</span>) {
</span><span id="12908" class="l"><a href="#12908">12908: </a>                <span class="php-var">$line_style</span> = <span class="php-keyword1">array</span>();
</span><span id="12909" class="l"><a href="#12909">12909: </a>            }
</span><span id="12910" class="l"><a href="#12910">12910: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$cw</span>) {
</span><span id="12911" class="l"><a href="#12911">12911: </a>                <span class="php-var">$d</span> = <span class="php-var">$b</span>;
</span><span id="12912" class="l"><a href="#12912">12912: </a>                <span class="php-var">$b</span> = <span class="php-num">360</span> - <span class="php-var">$a</span> + <span class="php-var">$o</span>;
</span><span id="12913" class="l"><a href="#12913">12913: </a>                <span class="php-var">$a</span> = <span class="php-num">360</span> - <span class="php-var">$d</span> + <span class="php-var">$o</span>;
</span><span id="12914" class="l"><a href="#12914">12914: </a>            } <span class="php-keyword1">else</span> {
</span><span id="12915" class="l"><a href="#12915">12915: </a>                <span class="php-var">$b</span> += <span class="php-var">$o</span>;
</span><span id="12916" class="l"><a href="#12916">12916: </a>                <span class="php-var">$a</span> += <span class="php-var">$o</span>;
</span><span id="12917" class="l"><a href="#12917">12917: </a>            }
</span><span id="12918" class="l"><a href="#12918">12918: </a>            <span class="php-var">$this</span>-&gt;_outellipticalarc(<span class="php-var">$xc</span>, <span class="php-var">$yc</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-num">0</span>, <span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-keyword1">true</span>, <span class="php-var">$nc</span>);
</span><span id="12919" class="l"><a href="#12919">12919: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="12920" class="l"><a href="#12920">12920: </a>        }
</span><span id="12921" class="l"><a href="#12921">12921: </a>
</span><span id="12922" class="l"><a href="#12922">12922: </a>        <span class="php-comment">/**
</span></span><span id="12923" class="l"><a href="#12923">12923: </a><span class="php-comment">         * Embed vector-based Adobe Illustrator (AI) or AI-compatible EPS files.
</span></span><span id="12924" class="l"><a href="#12924">12924: </a><span class="php-comment">         * NOTE: EPS is not yet fully implemented, use the setRasterizeVectorImages() method to enable/disable rasterization of SVG images using ImageMagick library.
</span></span><span id="12925" class="l"><a href="#12925">12925: </a><span class="php-comment">         * Only vector drawing is supported, not text or bitmap.
</span></span><span id="12926" class="l"><a href="#12926">12926: </a><span class="php-comment">         * Although the script was successfully tested with various AI format versions, best results are probably achieved with files that were exported in the AI3 format (tested with Illustrator CS2, Freehand MX and Photoshop CS2).
</span></span><span id="12927" class="l"><a href="#12927">12927: </a><span class="php-comment">         * @param string $file Name of the file containing the image.
</span></span><span id="12928" class="l"><a href="#12928">12928: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner.
</span></span><span id="12929" class="l"><a href="#12929">12929: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner.
</span></span><span id="12930" class="l"><a href="#12930">12930: </a><span class="php-comment">         * @param float $w Width of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="12931" class="l"><a href="#12931">12931: </a><span class="php-comment">         * @param float $h Height of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="12932" class="l"><a href="#12932">12932: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink().
</span></span><span id="12933" class="l"><a href="#12933">12933: </a><span class="php-comment">         * @param boolean useBoundingBox specifies whether to position the bounding box (true) or the complete canvas (false) at location (x,y). Default value is true.
</span></span><span id="12934" class="l"><a href="#12934">12934: </a><span class="php-comment">         * @param string $align Indicates the alignment of the pointer next to image insertion relative to image height. The value can be:&lt;ul&gt;&lt;li&gt;T: top-right for LTR or top-left for RTL&lt;/li&gt;&lt;li&gt;M: middle-right for LTR or middle-left for RTL&lt;/li&gt;&lt;li&gt;B: bottom-right for LTR or bottom-left for RTL&lt;/li&gt;&lt;li&gt;N: next line&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="12935" class="l"><a href="#12935">12935: </a><span class="php-comment">         * @param string $palign Allows to center or align the image on the current line. Possible values are:&lt;ul&gt;&lt;li&gt;L : left align&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;R : right align&lt;/li&gt;&lt;li&gt;'' : empty string : left for LTR or right for RTL&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="12936" class="l"><a href="#12936">12936: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the image. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="12937" class="l"><a href="#12937">12937: </a><span class="php-comment">         * @param boolean $fitonpage if true the image is resized to not exceed page dimensions.
</span></span><span id="12938" class="l"><a href="#12938">12938: </a><span class="php-comment">         * @author Valentin Schmidt, Nicola Asuni
</span></span><span id="12939" class="l"><a href="#12939">12939: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="12940" class="l"><a href="#12940">12940: </a><span class="php-comment">         * @access public
</span></span><span id="12941" class="l"><a href="#12941">12941: </a><span class="php-comment">         */</span>
</span><span id="12942" class="l"><a href="#12942">12942: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> ImageEps(<span class="php-var">$file</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$w</span>=<span class="php-num">0</span>, <span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$useBoundingBox</span>=<span class="php-keyword1">true</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$palign</span>=<span class="php-quote">''</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$fitonpage</span>=<span class="php-keyword1">false</span>) {
</span><span id="12943" class="l"><a href="#12943">12943: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rasterize_vector_images) {
</span><span id="12944" class="l"><a href="#12944">12944: </a>                <span class="php-comment">// convert SVG to raster image using GD or ImageMagick libraries</span>
</span><span id="12945" class="l"><a href="#12945">12945: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$file</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'EPS'</span>, <span class="php-var">$link</span>, <span class="php-var">$align</span>, <span class="php-keyword1">true</span>, <span class="php-num">300</span>, <span class="php-var">$palign</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-var">$border</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-var">$fitonpage</span>);
</span><span id="12946" class="l"><a href="#12946">12946: </a>            }
</span><span id="12947" class="l"><a href="#12947">12947: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="12948" class="l"><a href="#12948">12948: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="12949" class="l"><a href="#12949">12949: </a>            }
</span><span id="12950" class="l"><a href="#12950">12950: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="12951" class="l"><a href="#12951">12951: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="12952" class="l"><a href="#12952">12952: </a>            }
</span><span id="12953" class="l"><a href="#12953">12953: </a>            <span class="php-var">$k</span> = <span class="php-var">$this</span>-&gt;k;
</span><span id="12954" class="l"><a href="#12954">12954: </a>            <span class="php-var">$data</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$file</span>);
</span><span id="12955" class="l"><a href="#12955">12955: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$data</span> === <span class="php-keyword1">false</span>) {
</span><span id="12956" class="l"><a href="#12956">12956: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'EPS file not found: '</span>.<span class="php-var">$file</span>);
</span><span id="12957" class="l"><a href="#12957">12957: </a>            }
</span><span id="12958" class="l"><a href="#12958">12958: </a>            <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="12959" class="l"><a href="#12959">12959: </a>            <span class="php-comment">// EPS/AI compatibility check (only checks files created by Adobe Illustrator!)</span>
</span><span id="12960" class="l"><a href="#12960">12960: </a>            <span class="php-keyword2">preg_match</span>(<span class="php-quote">&quot;/%%Creator:([^\r\n]+)/&quot;</span>, <span class="php-var">$data</span>, <span class="php-var">$regs</span>); <span class="php-comment"># find Creator</span>
</span><span id="12961" class="l"><a href="#12961">12961: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$regs</span>) &gt; <span class="php-num">1</span>) {
</span><span id="12962" class="l"><a href="#12962">12962: </a>                <span class="php-var">$version_str</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]); <span class="php-comment"># e.g. &quot;Adobe Illustrator(R) 8.0&quot;</span>
</span><span id="12963" class="l"><a href="#12963">12963: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$version_str</span>, <span class="php-quote">'Adobe Illustrator'</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="12964" class="l"><a href="#12964">12964: </a>                    <span class="php-var">$versexp</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-var">$version_str</span>);
</span><span id="12965" class="l"><a href="#12965">12965: </a>                    <span class="php-var">$version</span> = (float)<span class="php-keyword2">array_pop</span>(<span class="php-var">$versexp</span>);
</span><span id="12966" class="l"><a href="#12966">12966: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$version</span> &gt;= <span class="php-num">9</span>) {
</span><span id="12967" class="l"><a href="#12967">12967: </a>                        <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'This version of Adobe Illustrator file is not supported: '</span>.<span class="php-var">$file</span>);
</span><span id="12968" class="l"><a href="#12968">12968: </a>                    }
</span><span id="12969" class="l"><a href="#12969">12969: </a>                }
</span><span id="12970" class="l"><a href="#12970">12970: </a>            }
</span><span id="12971" class="l"><a href="#12971">12971: </a>            <span class="php-comment">// strip binary bytes in front of PS-header</span>
</span><span id="12972" class="l"><a href="#12972">12972: </a>            <span class="php-var">$start</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$data</span>, <span class="php-quote">'%!PS-Adobe'</span>);
</span><span id="12973" class="l"><a href="#12973">12973: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$start</span> &gt; <span class="php-num">0</span>) {
</span><span id="12974" class="l"><a href="#12974">12974: </a>                <span class="php-var">$data</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$data</span>, <span class="php-var">$start</span>);
</span><span id="12975" class="l"><a href="#12975">12975: </a>            }
</span><span id="12976" class="l"><a href="#12976">12976: </a>            <span class="php-comment">// find BoundingBox params</span>
</span><span id="12977" class="l"><a href="#12977">12977: </a>            <span class="php-keyword2">preg_match</span>(<span class="php-quote">&quot;/%%BoundingBox:([^\r\n]+)/&quot;</span>, <span class="php-var">$data</span>, <span class="php-var">$regs</span>);
</span><span id="12978" class="l"><a href="#12978">12978: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$regs</span>) &gt; <span class="php-num">1</span>) {
</span><span id="12979" class="l"><a href="#12979">12979: </a>                <span class="php-keyword1">list</span>(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>) = <span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-keyword2">trim</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]));
</span><span id="12980" class="l"><a href="#12980">12980: </a>            } <span class="php-keyword1">else</span> {
</span><span id="12981" class="l"><a href="#12981">12981: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'No BoundingBox found in EPS file: '</span>.<span class="php-var">$file</span>);
</span><span id="12982" class="l"><a href="#12982">12982: </a>            }
</span><span id="12983" class="l"><a href="#12983">12983: </a>            <span class="php-var">$start</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$data</span>, <span class="php-quote">'%%EndSetup'</span>);
</span><span id="12984" class="l"><a href="#12984">12984: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$start</span> === <span class="php-keyword1">false</span>) {
</span><span id="12985" class="l"><a href="#12985">12985: </a>                <span class="php-var">$start</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$data</span>, <span class="php-quote">'%%EndProlog'</span>);
</span><span id="12986" class="l"><a href="#12986">12986: </a>            }
</span><span id="12987" class="l"><a href="#12987">12987: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$start</span> === <span class="php-keyword1">false</span>) {
</span><span id="12988" class="l"><a href="#12988">12988: </a>                <span class="php-var">$start</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$data</span>, <span class="php-quote">'%%BoundingBox'</span>);
</span><span id="12989" class="l"><a href="#12989">12989: </a>            }
</span><span id="12990" class="l"><a href="#12990">12990: </a>            <span class="php-var">$data</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$data</span>, <span class="php-var">$start</span>);
</span><span id="12991" class="l"><a href="#12991">12991: </a>            <span class="php-var">$end</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$data</span>, <span class="php-quote">'%%PageTrailer'</span>);
</span><span id="12992" class="l"><a href="#12992">12992: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$end</span>===<span class="php-keyword1">false</span>) {
</span><span id="12993" class="l"><a href="#12993">12993: </a>                <span class="php-var">$end</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$data</span>, <span class="php-quote">'showpage'</span>);
</span><span id="12994" class="l"><a href="#12994">12994: </a>            }
</span><span id="12995" class="l"><a href="#12995">12995: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$end</span>) {
</span><span id="12996" class="l"><a href="#12996">12996: </a>                <span class="php-var">$data</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$data</span>, <span class="php-num">0</span>, <span class="php-var">$end</span>);
</span><span id="12997" class="l"><a href="#12997">12997: </a>            }
</span><span id="12998" class="l"><a href="#12998">12998: </a>            <span class="php-comment">// calculate image width and height on document</span>
</span><span id="12999" class="l"><a href="#12999">12999: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="13000" class="l"><a href="#13000">13000: </a>                <span class="php-var">$w</span> = (<span class="php-var">$x2</span> - <span class="php-var">$x1</span>) / <span class="php-var">$k</span>;
</span><span id="13001" class="l"><a href="#13001">13001: </a>                <span class="php-var">$h</span> = (<span class="php-var">$y2</span> - <span class="php-var">$y1</span>) / <span class="php-var">$k</span>;
</span><span id="13002" class="l"><a href="#13002">13002: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>) {
</span><span id="13003" class="l"><a href="#13003">13003: </a>                <span class="php-var">$w</span> = (<span class="php-var">$x2</span>-<span class="php-var">$x1</span>) / <span class="php-var">$k</span> * (<span class="php-var">$h</span> / ((<span class="php-var">$y2</span> - <span class="php-var">$y1</span>) / <span class="php-var">$k</span>));
</span><span id="13004" class="l"><a href="#13004">13004: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>) {
</span><span id="13005" class="l"><a href="#13005">13005: </a>                <span class="php-var">$h</span> = (<span class="php-var">$y2</span> - <span class="php-var">$y1</span>) / <span class="php-var">$k</span> * (<span class="php-var">$w</span> / ((<span class="php-var">$x2</span> - <span class="php-var">$x1</span>) / <span class="php-var">$k</span>));
</span><span id="13006" class="l"><a href="#13006">13006: </a>            }
</span><span id="13007" class="l"><a href="#13007">13007: </a>            <span class="php-comment">// Check whether we need a new page first as this does not fit</span>
</span><span id="13008" class="l"><a href="#13008">13008: </a>            <span class="php-var">$prev_x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="13009" class="l"><a href="#13009">13009: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$h</span>, <span class="php-var">$y</span>)) {
</span><span id="13010" class="l"><a href="#13010">13010: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="13011" class="l"><a href="#13011">13011: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13012" class="l"><a href="#13012">13012: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$prev_x</span> - <span class="php-var">$this</span>-&gt;x);
</span><span id="13013" class="l"><a href="#13013">13013: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13014" class="l"><a href="#13014">13014: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$this</span>-&gt;x - <span class="php-var">$prev_x</span>);
</span><span id="13015" class="l"><a href="#13015">13015: </a>                }
</span><span id="13016" class="l"><a href="#13016">13016: </a>            }
</span><span id="13017" class="l"><a href="#13017">13017: </a>            <span class="php-comment">// resize image to be contained on a single page</span>
</span><span id="13018" class="l"><a href="#13018">13018: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$fitonpage</span>) {
</span><span id="13019" class="l"><a href="#13019">13019: </a>                <span class="php-var">$ratio_wh</span> = <span class="php-var">$w</span> / <span class="php-var">$h</span>;
</span><span id="13020" class="l"><a href="#13020">13020: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$y</span> + <span class="php-var">$h</span>) &gt; <span class="php-var">$this</span>-&gt;PageBreakTrigger) {
</span><span id="13021" class="l"><a href="#13021">13021: </a>                    <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;PageBreakTrigger - <span class="php-var">$y</span>;
</span><span id="13022" class="l"><a href="#13022">13022: </a>                    <span class="php-var">$w</span> = <span class="php-var">$h</span> * <span class="php-var">$ratio_wh</span>;
</span><span id="13023" class="l"><a href="#13023">13023: </a>                }
</span><span id="13024" class="l"><a href="#13024">13024: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$x</span> + <span class="php-var">$w</span>) &gt; (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin)) {
</span><span id="13025" class="l"><a href="#13025">13025: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$x</span>;
</span><span id="13026" class="l"><a href="#13026">13026: </a>                    <span class="php-var">$h</span> = <span class="php-var">$w</span> / <span class="php-var">$ratio_wh</span>;
</span><span id="13027" class="l"><a href="#13027">13027: </a>                }
</span><span id="13028" class="l"><a href="#13028">13028: </a>            }
</span><span id="13029" class="l"><a href="#13029">13029: </a>            <span class="php-comment">// set scaling factors</span>
</span><span id="13030" class="l"><a href="#13030">13030: </a>            <span class="php-var">$scale_x</span> = <span class="php-var">$w</span> / ((<span class="php-var">$x2</span> - <span class="php-var">$x1</span>) / <span class="php-var">$k</span>);
</span><span id="13031" class="l"><a href="#13031">13031: </a>            <span class="php-var">$scale_y</span> = <span class="php-var">$h</span> / ((<span class="php-var">$y2</span> - <span class="php-var">$y1</span>) / <span class="php-var">$k</span>);
</span><span id="13032" class="l"><a href="#13032">13032: </a>            <span class="php-comment">// set alignment</span>
</span><span id="13033" class="l"><a href="#13033">13033: </a>            <span class="php-var">$this</span>-&gt;img_rb_y = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="13034" class="l"><a href="#13034">13034: </a>            <span class="php-comment">// set alignment</span>
</span><span id="13035" class="l"><a href="#13035">13035: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13036" class="l"><a href="#13036">13036: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$palign</span> == <span class="php-quote">'L'</span>) {
</span><span id="13037" class="l"><a href="#13037">13037: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="13038" class="l"><a href="#13038">13038: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'C'</span>) {
</span><span id="13039" class="l"><a href="#13039">13039: </a>                    <span class="php-var">$ximg</span> = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$w</span>) / <span class="php-num">2</span>;
</span><span id="13040" class="l"><a href="#13040">13040: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'R'</span>) {
</span><span id="13041" class="l"><a href="#13041">13041: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$w</span>;
</span><span id="13042" class="l"><a href="#13042">13042: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13043" class="l"><a href="#13043">13043: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="13044" class="l"><a href="#13044">13044: </a>                }
</span><span id="13045" class="l"><a href="#13045">13045: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$ximg</span>;
</span><span id="13046" class="l"><a href="#13046">13046: </a>            } <span class="php-keyword1">else</span> {
</span><span id="13047" class="l"><a href="#13047">13047: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$palign</span> == <span class="php-quote">'L'</span>) {
</span><span id="13048" class="l"><a href="#13048">13048: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="13049" class="l"><a href="#13049">13049: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'C'</span>) {
</span><span id="13050" class="l"><a href="#13050">13050: </a>                    <span class="php-var">$ximg</span> = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$w</span>) / <span class="php-num">2</span>;
</span><span id="13051" class="l"><a href="#13051">13051: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'R'</span>) {
</span><span id="13052" class="l"><a href="#13052">13052: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$w</span>;
</span><span id="13053" class="l"><a href="#13053">13053: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13054" class="l"><a href="#13054">13054: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$x</span>;
</span><span id="13055" class="l"><a href="#13055">13055: </a>                }
</span><span id="13056" class="l"><a href="#13056">13056: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$ximg</span> + <span class="php-var">$w</span>;
</span><span id="13057" class="l"><a href="#13057">13057: </a>            }
</span><span id="13058" class="l"><a href="#13058">13058: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$useBoundingBox</span>) {
</span><span id="13059" class="l"><a href="#13059">13059: </a>                <span class="php-var">$dx</span> = <span class="php-var">$ximg</span> * <span class="php-var">$k</span> - <span class="php-var">$x1</span>;
</span><span id="13060" class="l"><a href="#13060">13060: </a>                <span class="php-var">$dy</span> = <span class="php-var">$y</span> * <span class="php-var">$k</span> - <span class="php-var">$y1</span>;
</span><span id="13061" class="l"><a href="#13061">13061: </a>            } <span class="php-keyword1">else</span> {
</span><span id="13062" class="l"><a href="#13062">13062: </a>                <span class="php-var">$dx</span> = <span class="php-var">$ximg</span> * <span class="php-var">$k</span>;
</span><span id="13063" class="l"><a href="#13063">13063: </a>                <span class="php-var">$dy</span> = <span class="php-var">$y</span> * <span class="php-var">$k</span>;
</span><span id="13064" class="l"><a href="#13064">13064: </a>            }
</span><span id="13065" class="l"><a href="#13065">13065: </a>            <span class="php-comment">// save the current graphic state</span>
</span><span id="13066" class="l"><a href="#13066">13066: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'q'</span>.<span class="php-var">$this</span>-&gt;epsmarker);
</span><span id="13067" class="l"><a href="#13067">13067: </a>            <span class="php-comment">// translate</span>
</span><span id="13068" class="l"><a href="#13068">13068: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F %.3F %.3F cm'</span>, <span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-var">$dx</span>, <span class="php-var">$dy</span> + (<span class="php-var">$this</span>-&gt;hPt - (<span class="php-num">2</span> * <span class="php-var">$y</span> * <span class="php-var">$k</span>) - (<span class="php-var">$y2</span> - <span class="php-var">$y1</span>))));
</span><span id="13069" class="l"><a href="#13069">13069: </a>            <span class="php-comment">// scale</span>
</span><span id="13070" class="l"><a href="#13070">13070: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$scale_x</span>)) {
</span><span id="13071" class="l"><a href="#13071">13071: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F %.3F %.3F cm'</span>, <span class="php-var">$scale_x</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$scale_y</span>, <span class="php-var">$x1</span> * (<span class="php-num">1</span> - <span class="php-var">$scale_x</span>), <span class="php-var">$y2</span> * (<span class="php-num">1</span> - <span class="php-var">$scale_y</span>)));
</span><span id="13072" class="l"><a href="#13072">13072: </a>            }
</span><span id="13073" class="l"><a href="#13073">13073: </a>            <span class="php-comment">// handle pc/unix/mac line endings</span>
</span><span id="13074" class="l"><a href="#13074">13074: </a>            <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\r\n]+/s'</span>, <span class="php-var">$data</span>, <span class="php-var">$regs</span>);
</span><span id="13075" class="l"><a href="#13075">13075: </a>            <span class="php-var">$lines</span> = <span class="php-keyword2">explode</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-var">$data</span>);
</span><span id="13076" class="l"><a href="#13076">13076: </a>            <span class="php-var">$u</span>=<span class="php-num">0</span>;
</span><span id="13077" class="l"><a href="#13077">13077: </a>            <span class="php-var">$cnt</span> = <span class="php-keyword2">count</span>(<span class="php-var">$lines</span>);
</span><span id="13078" class="l"><a href="#13078">13078: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span>=<span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$cnt</span>; ++<span class="php-var">$i</span>) {
</span><span id="13079" class="l"><a href="#13079">13079: </a>                <span class="php-var">$line</span> = <span class="php-var">$lines</span>[<span class="php-var">$i</span>];
</span><span id="13080" class="l"><a href="#13080">13080: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$line</span> == <span class="php-quote">''</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$line</span>{<span class="php-num">0</span>} == <span class="php-quote">'%'</span>)) {
</span><span id="13081" class="l"><a href="#13081">13081: </a>                    <span class="php-keyword1">continue</span>;
</span><span id="13082" class="l"><a href="#13082">13082: </a>                }
</span><span id="13083" class="l"><a href="#13083">13083: </a>                <span class="php-var">$len</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$line</span>);
</span><span id="13084" class="l"><a href="#13084">13084: </a>                <span class="php-var">$chunks</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-var">$line</span>);
</span><span id="13085" class="l"><a href="#13085">13085: </a>                <span class="php-var">$cmd</span> = <span class="php-keyword2">array_pop</span>(<span class="php-var">$chunks</span>);
</span><span id="13086" class="l"><a href="#13086">13086: </a>                <span class="php-comment">// RGB</span>
</span><span id="13087" class="l"><a href="#13087">13087: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$cmd</span> == <span class="php-quote">'Xa'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$cmd</span> == <span class="php-quote">'XA'</span>)) {
</span><span id="13088" class="l"><a href="#13088">13088: </a>                    <span class="php-var">$b</span> = <span class="php-keyword2">array_pop</span>(<span class="php-var">$chunks</span>);
</span><span id="13089" class="l"><a href="#13089">13089: </a>                    <span class="php-var">$g</span> = <span class="php-keyword2">array_pop</span>(<span class="php-var">$chunks</span>);
</span><span id="13090" class="l"><a href="#13090">13090: </a>                    <span class="php-var">$r</span> = <span class="php-keyword2">array_pop</span>(<span class="php-var">$chunks</span>);
</span><span id="13091" class="l"><a href="#13091">13091: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">''</span>.<span class="php-var">$r</span>.<span class="php-quote">' '</span>.<span class="php-var">$g</span>.<span class="php-quote">' '</span>.<span class="php-var">$b</span>.<span class="php-quote">' '</span>.(<span class="php-var">$cmd</span>==<span class="php-quote">'Xa'</span>?<span class="php-quote">'rg'</span>:<span class="php-quote">'RG'</span>)); <span class="php-comment">//substr($line, 0, -2).'rg' -&gt; in EPS (AI8): c m y k r g b rg!</span>
</span><span id="13092" class="l"><a href="#13092">13092: </a>                    <span class="php-keyword1">continue</span>;
</span><span id="13093" class="l"><a href="#13093">13093: </a>                }
</span><span id="13094" class="l"><a href="#13094">13094: </a>                <span class="php-keyword1">switch</span> (<span class="php-var">$cmd</span>) {
</span><span id="13095" class="l"><a href="#13095">13095: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'m'</span>:
</span><span id="13096" class="l"><a href="#13096">13096: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'l'</span>:
</span><span id="13097" class="l"><a href="#13097">13097: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'v'</span>:
</span><span id="13098" class="l"><a href="#13098">13098: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'y'</span>:
</span><span id="13099" class="l"><a href="#13099">13099: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'c'</span>:
</span><span id="13100" class="l"><a href="#13100">13100: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'k'</span>:
</span><span id="13101" class="l"><a href="#13101">13101: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'K'</span>:
</span><span id="13102" class="l"><a href="#13102">13102: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'g'</span>:
</span><span id="13103" class="l"><a href="#13103">13103: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'G'</span>:
</span><span id="13104" class="l"><a href="#13104">13104: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'s'</span>:
</span><span id="13105" class="l"><a href="#13105">13105: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'S'</span>:
</span><span id="13106" class="l"><a href="#13106">13106: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'J'</span>:
</span><span id="13107" class="l"><a href="#13107">13107: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'j'</span>:
</span><span id="13108" class="l"><a href="#13108">13108: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'w'</span>:
</span><span id="13109" class="l"><a href="#13109">13109: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>:
</span><span id="13110" class="l"><a href="#13110">13110: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'d'</span>:
</span><span id="13111" class="l"><a href="#13111">13111: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'n'</span>: {
</span><span id="13112" class="l"><a href="#13112">13112: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$line</span>);
</span><span id="13113" class="l"><a href="#13113">13113: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13114" class="l"><a href="#13114">13114: </a>                    }
</span><span id="13115" class="l"><a href="#13115">13115: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'x'</span>: {<span class="php-comment">// custom fill color</span>
</span><span id="13116" class="l"><a href="#13116">13116: </a>                        <span class="php-keyword1">list</span>(<span class="php-var">$c</span>,<span class="php-var">$m</span>,<span class="php-var">$y</span>,<span class="php-var">$k</span>) = <span class="php-var">$chunks</span>;
</span><span id="13117" class="l"><a href="#13117">13117: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">''</span>.<span class="php-var">$c</span>.<span class="php-quote">' '</span>.<span class="php-var">$m</span>.<span class="php-quote">' '</span>.<span class="php-var">$y</span>.<span class="php-quote">' '</span>.<span class="php-var">$k</span>.<span class="php-quote">' k'</span>);
</span><span id="13118" class="l"><a href="#13118">13118: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13119" class="l"><a href="#13119">13119: </a>                    }
</span><span id="13120" class="l"><a href="#13120">13120: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'X'</span>: { <span class="php-comment">// custom stroke color</span>
</span><span id="13121" class="l"><a href="#13121">13121: </a>                        <span class="php-keyword1">list</span>(<span class="php-var">$c</span>,<span class="php-var">$m</span>,<span class="php-var">$y</span>,<span class="php-var">$k</span>) = <span class="php-var">$chunks</span>;
</span><span id="13122" class="l"><a href="#13122">13122: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">''</span>.<span class="php-var">$c</span>.<span class="php-quote">' '</span>.<span class="php-var">$m</span>.<span class="php-quote">' '</span>.<span class="php-var">$y</span>.<span class="php-quote">' '</span>.<span class="php-var">$k</span>.<span class="php-quote">' K'</span>);
</span><span id="13123" class="l"><a href="#13123">13123: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13124" class="l"><a href="#13124">13124: </a>                    }
</span><span id="13125" class="l"><a href="#13125">13125: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Y'</span>:
</span><span id="13126" class="l"><a href="#13126">13126: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'N'</span>:
</span><span id="13127" class="l"><a href="#13127">13127: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'V'</span>:
</span><span id="13128" class="l"><a href="#13128">13128: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'L'</span>:
</span><span id="13129" class="l"><a href="#13129">13129: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: {
</span><span id="13130" class="l"><a href="#13130">13130: </a>                        <span class="php-var">$line</span>{<span class="php-var">$len</span>-<span class="php-num">1</span>} = <span class="php-keyword2">strtolower</span>(<span class="php-var">$cmd</span>);
</span><span id="13131" class="l"><a href="#13131">13131: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$line</span>);
</span><span id="13132" class="l"><a href="#13132">13132: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13133" class="l"><a href="#13133">13133: </a>                    }
</span><span id="13134" class="l"><a href="#13134">13134: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'b'</span>:
</span><span id="13135" class="l"><a href="#13135">13135: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="13136" class="l"><a href="#13136">13136: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$cmd</span> . <span class="php-quote">'*'</span>);
</span><span id="13137" class="l"><a href="#13137">13137: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13138" class="l"><a href="#13138">13138: </a>                    }
</span><span id="13139" class="l"><a href="#13139">13139: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'f'</span>:
</span><span id="13140" class="l"><a href="#13140">13140: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'F'</span>: {
</span><span id="13141" class="l"><a href="#13141">13141: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$u</span> &gt; <span class="php-num">0</span>) {
</span><span id="13142" class="l"><a href="#13142">13142: </a>                            <span class="php-var">$isU</span> = <span class="php-keyword1">false</span>;
</span><span id="13143" class="l"><a href="#13143">13143: </a>                            <span class="php-var">$max</span> = <span class="php-keyword2">min</span>(<span class="php-var">$i</span>+<span class="php-num">5</span>, <span class="php-var">$cnt</span>);
</span><span id="13144" class="l"><a href="#13144">13144: </a>                            <span class="php-keyword1">for</span> (<span class="php-var">$j</span>=<span class="php-var">$i</span>+<span class="php-num">1</span>; <span class="php-var">$j</span> &lt; <span class="php-var">$max</span>; ++<span class="php-var">$j</span>) {
</span><span id="13145" class="l"><a href="#13145">13145: </a>                                <span class="php-var">$isU</span> = (<span class="php-var">$isU</span> <span class="php-keyword1">OR</span> ((<span class="php-var">$lines</span>[<span class="php-var">$j</span>] == <span class="php-quote">'U'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$lines</span>[<span class="php-var">$j</span>] == <span class="php-quote">'*U'</span>)));
</span><span id="13146" class="l"><a href="#13146">13146: </a>                            }
</span><span id="13147" class="l"><a href="#13147">13147: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$isU</span>) {
</span><span id="13148" class="l"><a href="#13148">13148: </a>                                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'f*'</span>);
</span><span id="13149" class="l"><a href="#13149">13149: </a>                            }
</span><span id="13150" class="l"><a href="#13150">13150: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="13151" class="l"><a href="#13151">13151: </a>                            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'f*'</span>);
</span><span id="13152" class="l"><a href="#13152">13152: </a>                        }
</span><span id="13153" class="l"><a href="#13153">13153: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13154" class="l"><a href="#13154">13154: </a>                    }
</span><span id="13155" class="l"><a href="#13155">13155: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'*u'</span>: {
</span><span id="13156" class="l"><a href="#13156">13156: </a>                        ++<span class="php-var">$u</span>;
</span><span id="13157" class="l"><a href="#13157">13157: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13158" class="l"><a href="#13158">13158: </a>                    }
</span><span id="13159" class="l"><a href="#13159">13159: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'*U'</span>: {
</span><span id="13160" class="l"><a href="#13160">13160: </a>                        --<span class="php-var">$u</span>;
</span><span id="13161" class="l"><a href="#13161">13161: </a>                        <span class="php-keyword1">break</span>;
</span><span id="13162" class="l"><a href="#13162">13162: </a>                    }
</span><span id="13163" class="l"><a href="#13163">13163: </a>                }
</span><span id="13164" class="l"><a href="#13164">13164: </a>            }
</span><span id="13165" class="l"><a href="#13165">13165: </a>            <span class="php-comment">// restore previous graphic state</span>
</span><span id="13166" class="l"><a href="#13166">13166: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;epsmarker.<span class="php-quote">'Q'</span>);
</span><span id="13167" class="l"><a href="#13167">13167: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$border</span>)) {
</span><span id="13168" class="l"><a href="#13168">13168: </a>                <span class="php-var">$bx</span> = <span class="php-var">$x</span>;
</span><span id="13169" class="l"><a href="#13169">13169: </a>                <span class="php-var">$by</span> = <span class="php-var">$y</span>;
</span><span id="13170" class="l"><a href="#13170">13170: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$ximg</span>;
</span><span id="13171" class="l"><a href="#13171">13171: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13172" class="l"><a href="#13172">13172: </a>                    <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="13173" class="l"><a href="#13173">13173: </a>                }
</span><span id="13174" class="l"><a href="#13174">13174: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="13175" class="l"><a href="#13175">13175: </a>                <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">''</span>, <span class="php-var">$border</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>);
</span><span id="13176" class="l"><a href="#13176">13176: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$bx</span>;
</span><span id="13177" class="l"><a href="#13177">13177: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$by</span>;
</span><span id="13178" class="l"><a href="#13178">13178: </a>            }
</span><span id="13179" class="l"><a href="#13179">13179: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$link</span>) {
</span><span id="13180" class="l"><a href="#13180">13180: </a>                <span class="php-var">$this</span>-&gt;<span class="php-keyword2">Link</span>(<span class="php-var">$ximg</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$link</span>, <span class="php-num">0</span>);
</span><span id="13181" class="l"><a href="#13181">13181: </a>            }
</span><span id="13182" class="l"><a href="#13182">13182: </a>            <span class="php-comment">// set pointer to align the successive text/objects</span>
</span><span id="13183" class="l"><a href="#13183">13183: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$align</span>) {
</span><span id="13184" class="l"><a href="#13184">13184: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>:{
</span><span id="13185" class="l"><a href="#13185">13185: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="13186" class="l"><a href="#13186">13186: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13187" class="l"><a href="#13187">13187: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13188" class="l"><a href="#13188">13188: </a>                }
</span><span id="13189" class="l"><a href="#13189">13189: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>:{
</span><span id="13190" class="l"><a href="#13190">13190: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span> + <span class="php-keyword2">round</span>(<span class="php-var">$h</span>/<span class="php-num">2</span>);
</span><span id="13191" class="l"><a href="#13191">13191: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13192" class="l"><a href="#13192">13192: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13193" class="l"><a href="#13193">13193: </a>                }
</span><span id="13194" class="l"><a href="#13194">13194: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>:{
</span><span id="13195" class="l"><a href="#13195">13195: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;img_rb_y;
</span><span id="13196" class="l"><a href="#13196">13196: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13197" class="l"><a href="#13197">13197: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13198" class="l"><a href="#13198">13198: </a>                }
</span><span id="13199" class="l"><a href="#13199">13199: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'N'</span>:{
</span><span id="13200" class="l"><a href="#13200">13200: </a>                    <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$this</span>-&gt;img_rb_y);
</span><span id="13201" class="l"><a href="#13201">13201: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13202" class="l"><a href="#13202">13202: </a>                }
</span><span id="13203" class="l"><a href="#13203">13203: </a>                <span class="php-keyword1">default</span>:{
</span><span id="13204" class="l"><a href="#13204">13204: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13205" class="l"><a href="#13205">13205: </a>                }
</span><span id="13206" class="l"><a href="#13206">13206: </a>            }
</span><span id="13207" class="l"><a href="#13207">13207: </a>            <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13208" class="l"><a href="#13208">13208: </a>        }
</span><span id="13209" class="l"><a href="#13209">13209: </a>
</span><span id="13210" class="l"><a href="#13210">13210: </a>        <span class="php-comment">/**
</span></span><span id="13211" class="l"><a href="#13211">13211: </a><span class="php-comment">         * Set document barcode.
</span></span><span id="13212" class="l"><a href="#13212">13212: </a><span class="php-comment">         * @param string $bc barcode
</span></span><span id="13213" class="l"><a href="#13213">13213: </a><span class="php-comment">         * @access public
</span></span><span id="13214" class="l"><a href="#13214">13214: </a><span class="php-comment">         */</span>
</span><span id="13215" class="l"><a href="#13215">13215: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setBarcode(<span class="php-var">$bc</span>=<span class="php-quote">''</span>) {
</span><span id="13216" class="l"><a href="#13216">13216: </a>            <span class="php-var">$this</span>-&gt;barcode = <span class="php-var">$bc</span>;
</span><span id="13217" class="l"><a href="#13217">13217: </a>        }
</span><span id="13218" class="l"><a href="#13218">13218: </a>
</span><span id="13219" class="l"><a href="#13219">13219: </a>        <span class="php-comment">/**
</span></span><span id="13220" class="l"><a href="#13220">13220: </a><span class="php-comment">         * Get current barcode.
</span></span><span id="13221" class="l"><a href="#13221">13221: </a><span class="php-comment">         * @return string
</span></span><span id="13222" class="l"><a href="#13222">13222: </a><span class="php-comment">         * @access public
</span></span><span id="13223" class="l"><a href="#13223">13223: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="13224" class="l"><a href="#13224">13224: </a><span class="php-comment">         */</span>
</span><span id="13225" class="l"><a href="#13225">13225: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getBarcode() {
</span><span id="13226" class="l"><a href="#13226">13226: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;barcode;
</span><span id="13227" class="l"><a href="#13227">13227: </a>        }
</span><span id="13228" class="l"><a href="#13228">13228: </a>
</span><span id="13229" class="l"><a href="#13229">13229: </a>        <span class="php-comment">/**
</span></span><span id="13230" class="l"><a href="#13230">13230: </a><span class="php-comment">         * Print a Linear Barcode.
</span></span><span id="13231" class="l"><a href="#13231">13231: </a><span class="php-comment">         * @param string $code code to print
</span></span><span id="13232" class="l"><a href="#13232">13232: </a><span class="php-comment">         * @param string $type type of barcode (see barcodes.php for supported formats).
</span></span><span id="13233" class="l"><a href="#13233">13233: </a><span class="php-comment">         * @param int $x x position in user units
</span></span><span id="13234" class="l"><a href="#13234">13234: </a><span class="php-comment">         * @param int $y y position in user units
</span></span><span id="13235" class="l"><a href="#13235">13235: </a><span class="php-comment">         * @param int $w width in user units
</span></span><span id="13236" class="l"><a href="#13236">13236: </a><span class="php-comment">         * @param int $h height in user units
</span></span><span id="13237" class="l"><a href="#13237">13237: </a><span class="php-comment">         * @param float $xres width of the smallest bar in user units
</span></span><span id="13238" class="l"><a href="#13238">13238: </a><span class="php-comment">         * @param array $style array of options:&lt;ul&gt;&lt;li&gt;string $style['position'] barcode position inside the specified width: L = left (default for LTR); C = center; R = right (default for RTL); S = stretch&lt;/li&gt;&lt;li&gt;boolean $style['border'] if true prints a border around the barcode&lt;/li&gt;&lt;li&gt;int $style['padding'] padding to leave around the barcode in user units (set to 'auto' for automatic padding)&lt;/li&gt;&lt;li&gt;array $style['fgcolor'] color array for bars and text&lt;/li&gt;&lt;li&gt;mixed $style['bgcolor'] color array for background or false for transparent&lt;/li&gt;&lt;li&gt;boolean $style[&quot;text&quot;] boolean if true prints text below the barcode&lt;/li&gt;&lt;li&gt;string $style['font'] font name for text&lt;/li&gt;&lt;li&gt;int $style['fontsize'] font size for text&lt;/li&gt;&lt;li&gt;int $style['stretchtext']: 0 = disabled; 1 = horizontal scaling only if necessary; 2 = forced horizontal scaling; 3 = character spacing only if necessary; 4 = forced character spacing&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13239" class="l"><a href="#13239">13239: </a><span class="php-comment">         * @param string $align Indicates the alignment of the pointer next to barcode insertion relative to barcode height. The value can be:&lt;ul&gt;&lt;li&gt;T: top-right for LTR or top-left for RTL&lt;/li&gt;&lt;li&gt;M: middle-right for LTR or middle-left for RTL&lt;/li&gt;&lt;li&gt;B: bottom-right for LTR or bottom-left for RTL&lt;/li&gt;&lt;li&gt;N: next line&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13240" class="l"><a href="#13240">13240: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="13241" class="l"><a href="#13241">13241: </a><span class="php-comment">         * @since 3.1.000 (2008-06-09)
</span></span><span id="13242" class="l"><a href="#13242">13242: </a><span class="php-comment">         * @access public
</span></span><span id="13243" class="l"><a href="#13243">13243: </a><span class="php-comment">         */</span>
</span><span id="13244" class="l"><a href="#13244">13244: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> write1DBarcode(<span class="php-var">$code</span>, <span class="php-var">$type</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$w</span>=<span class="php-quote">''</span>, <span class="php-var">$h</span>=<span class="php-quote">''</span>, <span class="php-var">$xres</span>=<span class="php-num">0.4</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>) {
</span><span id="13245" class="l"><a href="#13245">13245: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$code</span>)) {
</span><span id="13246" class="l"><a href="#13246">13246: </a>                <span class="php-keyword1">return</span>;
</span><span id="13247" class="l"><a href="#13247">13247: </a>            }
</span><span id="13248" class="l"><a href="#13248">13248: </a>            <span class="php-keyword1">require_once</span>(<span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/barcodes.php'</span>);
</span><span id="13249" class="l"><a href="#13249">13249: </a>            <span class="php-comment">// save current graphic settings</span>
</span><span id="13250" class="l"><a href="#13250">13250: </a>            <span class="php-var">$gvars</span> = <span class="php-var">$this</span>-&gt;getGraphicVars();
</span><span id="13251" class="l"><a href="#13251">13251: </a>            <span class="php-comment">// create new barcode object</span>
</span><span id="13252" class="l"><a href="#13252">13252: </a>            <span class="php-var">$barcodeobj</span> = <span class="php-keyword1">new</span> TCPDFBarcode(<span class="php-var">$code</span>, <span class="php-var">$type</span>);
</span><span id="13253" class="l"><a href="#13253">13253: </a>            <span class="php-var">$arrcode</span> = <span class="php-var">$barcodeobj</span>-&gt;getBarcodeArray();
</span><span id="13254" class="l"><a href="#13254">13254: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$arrcode</span> === <span class="php-keyword1">false</span>) {
</span><span id="13255" class="l"><a href="#13255">13255: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Error in 1D barcode string'</span>);
</span><span id="13256" class="l"><a href="#13256">13256: </a>            }
</span><span id="13257" class="l"><a href="#13257">13257: </a>            <span class="php-comment">// set default values</span>
</span><span id="13258" class="l"><a href="#13258">13258: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'position'</span>])) {
</span><span id="13259" class="l"><a href="#13259">13259: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13260" class="l"><a href="#13260">13260: </a>                    <span class="php-var">$style</span>[<span class="php-quote">'position'</span>] = <span class="php-quote">'R'</span>;
</span><span id="13261" class="l"><a href="#13261">13261: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13262" class="l"><a href="#13262">13262: </a>                    <span class="php-var">$style</span>[<span class="php-quote">'position'</span>] = <span class="php-quote">'L'</span>;
</span><span id="13263" class="l"><a href="#13263">13263: </a>                }
</span><span id="13264" class="l"><a href="#13264">13264: </a>            }
</span><span id="13265" class="l"><a href="#13265">13265: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>])) {
</span><span id="13266" class="l"><a href="#13266">13266: </a>                <span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>); <span class="php-comment">// default black</span>
</span><span id="13267" class="l"><a href="#13267">13267: </a>            }
</span><span id="13268" class="l"><a href="#13268">13268: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>])) {
</span><span id="13269" class="l"><a href="#13269">13269: </a>                <span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>] = <span class="php-keyword1">false</span>; <span class="php-comment">// default transparent</span>
</span><span id="13270" class="l"><a href="#13270">13270: </a>            }
</span><span id="13271" class="l"><a href="#13271">13271: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'border'</span>])) {
</span><span id="13272" class="l"><a href="#13272">13272: </a>                <span class="php-var">$style</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13273" class="l"><a href="#13273">13273: </a>            }
</span><span id="13274" class="l"><a href="#13274">13274: </a>            <span class="php-var">$fontsize</span> = <span class="php-num">0</span>;
</span><span id="13275" class="l"><a href="#13275">13275: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'text'</span>])) {
</span><span id="13276" class="l"><a href="#13276">13276: </a>                <span class="php-var">$style</span>[<span class="php-quote">'text'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13277" class="l"><a href="#13277">13277: </a>            }
</span><span id="13278" class="l"><a href="#13278">13278: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span>[<span class="php-quote">'text'</span>] <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'font'</span>])) {
</span><span id="13279" class="l"><a href="#13279">13279: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'fontsize'</span>])) {
</span><span id="13280" class="l"><a href="#13280">13280: </a>                    <span class="php-var">$fontsize</span> = <span class="php-var">$style</span>[<span class="php-quote">'fontsize'</span>];
</span><span id="13281" class="l"><a href="#13281">13281: </a>                }
</span><span id="13282" class="l"><a href="#13282">13282: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$style</span>[<span class="php-quote">'font'</span>], <span class="php-quote">''</span>, <span class="php-var">$fontsize</span>);
</span><span id="13283" class="l"><a href="#13283">13283: </a>            }
</span><span id="13284" class="l"><a href="#13284">13284: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'stretchtext'</span>])) {
</span><span id="13285" class="l"><a href="#13285">13285: </a>                <span class="php-var">$style</span>[<span class="php-quote">'stretchtext'</span>] = <span class="php-num">4</span>;
</span><span id="13286" class="l"><a href="#13286">13286: </a>            }
</span><span id="13287" class="l"><a href="#13287">13287: </a>            <span class="php-comment">// set foreground color</span>
</span><span id="13288" class="l"><a href="#13288">13288: </a>            <span class="php-var">$this</span>-&gt;SetDrawColorArray(<span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>]);
</span><span id="13289" class="l"><a href="#13289">13289: </a>            <span class="php-var">$this</span>-&gt;SetTextColorArray(<span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>]);
</span><span id="13290" class="l"><a href="#13290">13290: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$w</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="13291" class="l"><a href="#13291">13291: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13292" class="l"><a href="#13292">13292: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="13293" class="l"><a href="#13293">13293: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13294" class="l"><a href="#13294">13294: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x;
</span><span id="13295" class="l"><a href="#13295">13295: </a>                }
</span><span id="13296" class="l"><a href="#13296">13296: </a>            }
</span><span id="13297" class="l"><a href="#13297">13297: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$x</span>)) {
</span><span id="13298" class="l"><a href="#13298">13298: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;GetX();
</span><span id="13299" class="l"><a href="#13299">13299: </a>            }
</span><span id="13300" class="l"><a href="#13300">13300: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13301" class="l"><a href="#13301">13301: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span>;
</span><span id="13302" class="l"><a href="#13302">13302: </a>            }
</span><span id="13303" class="l"><a href="#13303">13303: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$y</span>)) {
</span><span id="13304" class="l"><a href="#13304">13304: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="13305" class="l"><a href="#13305">13305: </a>            }
</span><span id="13306" class="l"><a href="#13306">13306: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$xres</span>)) {
</span><span id="13307" class="l"><a href="#13307">13307: </a>                <span class="php-var">$xres</span> = <span class="php-num">0.4</span>;
</span><span id="13308" class="l"><a href="#13308">13308: </a>            }
</span><span id="13309" class="l"><a href="#13309">13309: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$h</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="13310" class="l"><a href="#13310">13310: </a>                <span class="php-var">$h</span> = <span class="php-var">$w</span> / <span class="php-num">3</span>;
</span><span id="13311" class="l"><a href="#13311">13311: </a>            }
</span><span id="13312" class="l"><a href="#13312">13312: </a>            <span class="php-comment">// padding</span>
</span><span id="13313" class="l"><a href="#13313">13313: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'padding'</span>])) {
</span><span id="13314" class="l"><a href="#13314">13314: </a>                <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] = <span class="php-num">0</span>;
</span><span id="13315" class="l"><a href="#13315">13315: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] === <span class="php-quote">'auto'</span>) {
</span><span id="13316" class="l"><a href="#13316">13316: </a>                <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] = <span class="php-var">$h</span> / <span class="php-num">4</span>;
</span><span id="13317" class="l"><a href="#13317">13317: </a>            }
</span><span id="13318" class="l"><a href="#13318">13318: </a>            <span class="php-var">$fbw</span> = (<span class="php-var">$arrcode</span>[<span class="php-quote">'maxw'</span>] * <span class="php-var">$xres</span>) + (<span class="php-num">2</span> * <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>]);
</span><span id="13319" class="l"><a href="#13319">13319: </a>            <span class="php-var">$extraspace</span> = (<span class="php-var">$this</span>-&gt;cell_height_ratio * <span class="php-var">$fontsize</span> / <span class="php-var">$this</span>-&gt;k) + (<span class="php-num">2</span> * <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>]);
</span><span id="13320" class="l"><a href="#13320">13320: </a>            <span class="php-var">$prev_x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="13321" class="l"><a href="#13321">13321: </a>            <span class="php-comment">// maximum bar height</span>
</span><span id="13322" class="l"><a href="#13322">13322: </a>            <span class="php-var">$barh</span> = <span class="php-var">$h</span>;
</span><span id="13323" class="l"><a href="#13323">13323: </a>            <span class="php-var">$h</span> += <span class="php-var">$extraspace</span>;
</span><span id="13324" class="l"><a href="#13324">13324: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$h</span>, <span class="php-var">$y</span>)) {
</span><span id="13325" class="l"><a href="#13325">13325: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY() + <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="13326" class="l"><a href="#13326">13326: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13327" class="l"><a href="#13327">13327: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$prev_x</span> - <span class="php-var">$this</span>-&gt;x);
</span><span id="13328" class="l"><a href="#13328">13328: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13329" class="l"><a href="#13329">13329: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$this</span>-&gt;x - <span class="php-var">$prev_x</span>);
</span><span id="13330" class="l"><a href="#13330">13330: </a>                }
</span><span id="13331" class="l"><a href="#13331">13331: </a>            }
</span><span id="13332" class="l"><a href="#13332">13332: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$style</span>[<span class="php-quote">'position'</span>]) {
</span><span id="13333" class="l"><a href="#13333">13333: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'L'</span>: { <span class="php-comment">// left</span>
</span><span id="13334" class="l"><a href="#13334">13334: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13335" class="l"><a href="#13335">13335: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="13336" class="l"><a href="#13336">13336: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="13337" class="l"><a href="#13337">13337: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span>;
</span><span id="13338" class="l"><a href="#13338">13338: </a>                    }
</span><span id="13339" class="l"><a href="#13339">13339: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13340" class="l"><a href="#13340">13340: </a>                }
</span><span id="13341" class="l"><a href="#13341">13341: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: { <span class="php-comment">// center</span>
</span><span id="13342" class="l"><a href="#13342">13342: </a>                    <span class="php-var">$xdiff</span> = ((<span class="php-var">$w</span> - <span class="php-var">$fbw</span>) / <span class="php-num">2</span>);
</span><span id="13343" class="l"><a href="#13343">13343: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13344" class="l"><a href="#13344">13344: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span> - <span class="php-var">$w</span> + <span class="php-var">$xdiff</span>;
</span><span id="13345" class="l"><a href="#13345">13345: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="13346" class="l"><a href="#13346">13346: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span> + <span class="php-var">$xdiff</span>;
</span><span id="13347" class="l"><a href="#13347">13347: </a>                    }
</span><span id="13348" class="l"><a href="#13348">13348: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13349" class="l"><a href="#13349">13349: </a>                }
</span><span id="13350" class="l"><a href="#13350">13350: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'R'</span>: { <span class="php-comment">// right</span>
</span><span id="13351" class="l"><a href="#13351">13351: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13352" class="l"><a href="#13352">13352: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span> - <span class="php-var">$fbw</span>;
</span><span id="13353" class="l"><a href="#13353">13353: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="13354" class="l"><a href="#13354">13354: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span> + <span class="php-var">$w</span> - <span class="php-var">$fbw</span>;
</span><span id="13355" class="l"><a href="#13355">13355: </a>                    }
</span><span id="13356" class="l"><a href="#13356">13356: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13357" class="l"><a href="#13357">13357: </a>                }
</span><span id="13358" class="l"><a href="#13358">13358: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'S'</span>: { <span class="php-comment">// stretch</span>
</span><span id="13359" class="l"><a href="#13359">13359: </a>                    <span class="php-var">$fbw</span> = <span class="php-var">$w</span>;
</span><span id="13360" class="l"><a href="#13360">13360: </a>                    <span class="php-var">$xres</span> = (<span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>])) / <span class="php-var">$arrcode</span>[<span class="php-quote">'maxw'</span>];
</span><span id="13361" class="l"><a href="#13361">13361: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13362" class="l"><a href="#13362">13362: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="13363" class="l"><a href="#13363">13363: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="13364" class="l"><a href="#13364">13364: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$x</span>;
</span><span id="13365" class="l"><a href="#13365">13365: </a>                    }
</span><span id="13366" class="l"><a href="#13366">13366: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13367" class="l"><a href="#13367">13367: </a>                }
</span><span id="13368" class="l"><a href="#13368">13368: </a>            }
</span><span id="13369" class="l"><a href="#13369">13369: </a>            <span class="php-var">$xpos_rect</span> = <span class="php-var">$xpos</span>;
</span><span id="13370" class="l"><a href="#13370">13370: </a>            <span class="php-var">$xpos</span> = <span class="php-var">$xpos_rect</span> + <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>];
</span><span id="13371" class="l"><a href="#13371">13371: </a>            <span class="php-var">$xpos_text</span> = <span class="php-var">$xpos</span>;
</span><span id="13372" class="l"><a href="#13372">13372: </a>            <span class="php-comment">// barcode is always printed in LTR direction</span>
</span><span id="13373" class="l"><a href="#13373">13373: </a>            <span class="php-var">$tempRTL</span> = <span class="php-var">$this</span>-&gt;rtl;
</span><span id="13374" class="l"><a href="#13374">13374: </a>            <span class="php-var">$this</span>-&gt;rtl = <span class="php-keyword1">false</span>;
</span><span id="13375" class="l"><a href="#13375">13375: </a>            <span class="php-comment">// print background color</span>
</span><span id="13376" class="l"><a href="#13376">13376: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>]) {
</span><span id="13377" class="l"><a href="#13377">13377: </a>                <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$xpos_rect</span>, <span class="php-var">$y</span>, <span class="php-var">$fbw</span>, <span class="php-var">$h</span>, <span class="php-var">$style</span>[<span class="php-quote">'border'</span>] ? <span class="php-quote">'DF'</span> : <span class="php-quote">'F'</span>, <span class="php-quote">''</span>, <span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>]);
</span><span id="13378" class="l"><a href="#13378">13378: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$style</span>[<span class="php-quote">'border'</span>]) {
</span><span id="13379" class="l"><a href="#13379">13379: </a>                <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$xpos_rect</span>, <span class="php-var">$y</span>, <span class="php-var">$fbw</span>, <span class="php-var">$h</span>, <span class="php-quote">'D'</span>);
</span><span id="13380" class="l"><a href="#13380">13380: </a>            }
</span><span id="13381" class="l"><a href="#13381">13381: </a>            <span class="php-comment">// print bars</span>
</span><span id="13382" class="l"><a href="#13382">13382: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$arrcode</span> !== <span class="php-keyword1">false</span>) {
</span><span id="13383" class="l"><a href="#13383">13383: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$arrcode</span>[<span class="php-quote">'bcode'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$v</span>) {
</span><span id="13384" class="l"><a href="#13384">13384: </a>                    <span class="php-var">$bw</span> = (<span class="php-var">$v</span>[<span class="php-quote">'w'</span>] * <span class="php-var">$xres</span>);
</span><span id="13385" class="l"><a href="#13385">13385: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$v</span>[<span class="php-quote">'t'</span>]) {
</span><span id="13386" class="l"><a href="#13386">13386: </a>                        <span class="php-comment">// draw a vertical bar</span>
</span><span id="13387" class="l"><a href="#13387">13387: </a>                        <span class="php-var">$ypos</span> = <span class="php-var">$y</span> + <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] + (<span class="php-var">$v</span>[<span class="php-quote">'p'</span>] * <span class="php-var">$barh</span> / <span class="php-var">$arrcode</span>[<span class="php-quote">'maxh'</span>]);
</span><span id="13388" class="l"><a href="#13388">13388: </a>                        <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$xpos</span>, <span class="php-var">$ypos</span>, <span class="php-var">$bw</span>, (<span class="php-var">$v</span>[<span class="php-quote">'h'</span>] * <span class="php-var">$barh</span>  / <span class="php-var">$arrcode</span>[<span class="php-quote">'maxh'</span>]), <span class="php-quote">'F'</span>, <span class="php-keyword1">array</span>(), <span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>]);
</span><span id="13389" class="l"><a href="#13389">13389: </a>                    }
</span><span id="13390" class="l"><a href="#13390">13390: </a>                    <span class="php-var">$xpos</span> += <span class="php-var">$bw</span>;
</span><span id="13391" class="l"><a href="#13391">13391: </a>                }
</span><span id="13392" class="l"><a href="#13392">13392: </a>            }
</span><span id="13393" class="l"><a href="#13393">13393: </a>            <span class="php-comment">// print text</span>
</span><span id="13394" class="l"><a href="#13394">13394: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span>[<span class="php-quote">'text'</span>]) {
</span><span id="13395" class="l"><a href="#13395">13395: </a>                <span class="php-comment">// print text</span>
</span><span id="13396" class="l"><a href="#13396">13396: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$xpos_text</span>;
</span><span id="13397" class="l"><a href="#13397">13397: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span> + <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] + <span class="php-var">$barh</span>;
</span><span id="13398" class="l"><a href="#13398">13398: </a>                <span class="php-var">$this</span>-&gt;Cell((<span class="php-var">$arrcode</span>[<span class="php-quote">'maxw'</span>] * <span class="php-var">$xres</span>), (<span class="php-var">$this</span>-&gt;cell_height_ratio * <span class="php-var">$fontsize</span> / <span class="php-var">$this</span>-&gt;k), <span class="php-var">$code</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-quote">'C'</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-var">$style</span>[<span class="php-quote">'stretchtext'</span>]);
</span><span id="13399" class="l"><a href="#13399">13399: </a>            }
</span><span id="13400" class="l"><a href="#13400">13400: </a>            <span class="php-comment">// restore original direction</span>
</span><span id="13401" class="l"><a href="#13401">13401: </a>            <span class="php-var">$this</span>-&gt;rtl = <span class="php-var">$tempRTL</span>;
</span><span id="13402" class="l"><a href="#13402">13402: </a>            <span class="php-comment">// restore previous settings</span>
</span><span id="13403" class="l"><a href="#13403">13403: </a>            <span class="php-var">$this</span>-&gt;setGraphicVars(<span class="php-var">$gvars</span>);
</span><span id="13404" class="l"><a href="#13404">13404: </a>            <span class="php-comment">// set bottomcoordinates</span>
</span><span id="13405" class="l"><a href="#13405">13405: </a>            <span class="php-var">$this</span>-&gt;img_rb_y = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="13406" class="l"><a href="#13406">13406: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13407" class="l"><a href="#13407">13407: </a>                <span class="php-comment">// set left side coordinate</span>
</span><span id="13408" class="l"><a href="#13408">13408: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> - <span class="php-var">$w</span>);
</span><span id="13409" class="l"><a href="#13409">13409: </a>            } <span class="php-keyword1">else</span> {
</span><span id="13410" class="l"><a href="#13410">13410: </a>                <span class="php-comment">// set right side coordinate</span>
</span><span id="13411" class="l"><a href="#13411">13411: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$x</span> + <span class="php-var">$w</span>;
</span><span id="13412" class="l"><a href="#13412">13412: </a>            }
</span><span id="13413" class="l"><a href="#13413">13413: </a>            <span class="php-comment">// set pointer to align the successive text/objects</span>
</span><span id="13414" class="l"><a href="#13414">13414: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$align</span>) {
</span><span id="13415" class="l"><a href="#13415">13415: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>:{
</span><span id="13416" class="l"><a href="#13416">13416: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="13417" class="l"><a href="#13417">13417: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13418" class="l"><a href="#13418">13418: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13419" class="l"><a href="#13419">13419: </a>                }
</span><span id="13420" class="l"><a href="#13420">13420: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>:{
</span><span id="13421" class="l"><a href="#13421">13421: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span> + <span class="php-keyword2">round</span>(<span class="php-var">$h</span>/<span class="php-num">2</span>);
</span><span id="13422" class="l"><a href="#13422">13422: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13423" class="l"><a href="#13423">13423: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13424" class="l"><a href="#13424">13424: </a>                }
</span><span id="13425" class="l"><a href="#13425">13425: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>:{
</span><span id="13426" class="l"><a href="#13426">13426: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;img_rb_y;
</span><span id="13427" class="l"><a href="#13427">13427: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13428" class="l"><a href="#13428">13428: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13429" class="l"><a href="#13429">13429: </a>                }
</span><span id="13430" class="l"><a href="#13430">13430: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'N'</span>:{
</span><span id="13431" class="l"><a href="#13431">13431: </a>                    <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$this</span>-&gt;img_rb_y);
</span><span id="13432" class="l"><a href="#13432">13432: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13433" class="l"><a href="#13433">13433: </a>                }
</span><span id="13434" class="l"><a href="#13434">13434: </a>                <span class="php-keyword1">default</span>:{
</span><span id="13435" class="l"><a href="#13435">13435: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13436" class="l"><a href="#13436">13436: </a>                }
</span><span id="13437" class="l"><a href="#13437">13437: </a>            }
</span><span id="13438" class="l"><a href="#13438">13438: </a>        }
</span><span id="13439" class="l"><a href="#13439">13439: </a>
</span><span id="13440" class="l"><a href="#13440">13440: </a>        <span class="php-comment">/**
</span></span><span id="13441" class="l"><a href="#13441">13441: </a><span class="php-comment">         * This function is DEPRECATED, please use the new write1DBarcode() function.
</span></span><span id="13442" class="l"><a href="#13442">13442: </a><span class="php-comment">         * @param int $x x position in user units
</span></span><span id="13443" class="l"><a href="#13443">13443: </a><span class="php-comment">         * @param int $y y position in user units
</span></span><span id="13444" class="l"><a href="#13444">13444: </a><span class="php-comment">         * @param int $w width in user units
</span></span><span id="13445" class="l"><a href="#13445">13445: </a><span class="php-comment">         * @param int $h height position in user units
</span></span><span id="13446" class="l"><a href="#13446">13446: </a><span class="php-comment">         * @param string $type type of barcode (I25, C128A, C128B, C128C, C39)
</span></span><span id="13447" class="l"><a href="#13447">13447: </a><span class="php-comment">         * @param string $style barcode style
</span></span><span id="13448" class="l"><a href="#13448">13448: </a><span class="php-comment">         * @param string $font font for text
</span></span><span id="13449" class="l"><a href="#13449">13449: </a><span class="php-comment">         * @param int $xres x resolution
</span></span><span id="13450" class="l"><a href="#13450">13450: </a><span class="php-comment">         * @param string $code code to print
</span></span><span id="13451" class="l"><a href="#13451">13451: </a><span class="php-comment">         * @deprecated deprecated since version 3.1.000 (2008-06-10)
</span></span><span id="13452" class="l"><a href="#13452">13452: </a><span class="php-comment">         * @access public
</span></span><span id="13453" class="l"><a href="#13453">13453: </a><span class="php-comment">         * @see write1DBarcode()
</span></span><span id="13454" class="l"><a href="#13454">13454: </a><span class="php-comment">         */</span>
</span><span id="13455" class="l"><a href="#13455">13455: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> writeBarcode(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$type</span>, <span class="php-var">$style</span>, <span class="php-var">$font</span>, <span class="php-var">$xres</span>, <span class="php-var">$code</span>) {
</span><span id="13456" class="l"><a href="#13456">13456: </a>            <span class="php-comment">// convert old settings for the new write1DBarcode() function.</span>
</span><span id="13457" class="l"><a href="#13457">13457: </a>            <span class="php-var">$xres</span> = <span class="php-num">1</span> / <span class="php-var">$xres</span>;
</span><span id="13458" class="l"><a href="#13458">13458: </a>            <span class="php-var">$newstyle</span> = <span class="php-keyword1">array</span>(
</span><span id="13459" class="l"><a href="#13459">13459: </a>                <span class="php-quote">'position'</span> =&gt; <span class="php-quote">'L'</span>,
</span><span id="13460" class="l"><a href="#13460">13460: </a>                <span class="php-quote">'border'</span> =&gt; <span class="php-keyword1">false</span>,
</span><span id="13461" class="l"><a href="#13461">13461: </a>                <span class="php-quote">'padding'</span> =&gt; <span class="php-num">0</span>,
</span><span id="13462" class="l"><a href="#13462">13462: </a>                <span class="php-quote">'fgcolor'</span> =&gt; <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>),
</span><span id="13463" class="l"><a href="#13463">13463: </a>                <span class="php-quote">'bgcolor'</span> =&gt; <span class="php-keyword1">false</span>,
</span><span id="13464" class="l"><a href="#13464">13464: </a>                <span class="php-quote">'text'</span> =&gt; <span class="php-keyword1">true</span>,
</span><span id="13465" class="l"><a href="#13465">13465: </a>                <span class="php-quote">'font'</span> =&gt; <span class="php-var">$font</span>,
</span><span id="13466" class="l"><a href="#13466">13466: </a>                <span class="php-quote">'fontsize'</span> =&gt; <span class="php-num">8</span>,
</span><span id="13467" class="l"><a href="#13467">13467: </a>                <span class="php-quote">'stretchtext'</span> =&gt; <span class="php-num">4</span>
</span><span id="13468" class="l"><a href="#13468">13468: </a>            );
</span><span id="13469" class="l"><a href="#13469">13469: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span> &amp; <span class="php-num">1</span>) {
</span><span id="13470" class="l"><a href="#13470">13470: </a>                <span class="php-var">$newstyle</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">true</span>;
</span><span id="13471" class="l"><a href="#13471">13471: </a>            }
</span><span id="13472" class="l"><a href="#13472">13472: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span> &amp; <span class="php-num">2</span>) {
</span><span id="13473" class="l"><a href="#13473">13473: </a>                <span class="php-var">$newstyle</span>[<span class="php-quote">'bgcolor'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13474" class="l"><a href="#13474">13474: </a>            }
</span><span id="13475" class="l"><a href="#13475">13475: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span> &amp; <span class="php-num">4</span>) {
</span><span id="13476" class="l"><a href="#13476">13476: </a>                <span class="php-var">$newstyle</span>[<span class="php-quote">'position'</span>] = <span class="php-quote">'C'</span>;
</span><span id="13477" class="l"><a href="#13477">13477: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$style</span> &amp; <span class="php-num">8</span>) {
</span><span id="13478" class="l"><a href="#13478">13478: </a>                <span class="php-var">$newstyle</span>[<span class="php-quote">'position'</span>] = <span class="php-quote">'L'</span>;
</span><span id="13479" class="l"><a href="#13479">13479: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$style</span> &amp; <span class="php-num">16</span>) {
</span><span id="13480" class="l"><a href="#13480">13480: </a>                <span class="php-var">$newstyle</span>[<span class="php-quote">'position'</span>] = <span class="php-quote">'R'</span>;
</span><span id="13481" class="l"><a href="#13481">13481: </a>            }
</span><span id="13482" class="l"><a href="#13482">13482: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span> &amp; <span class="php-num">128</span>) {
</span><span id="13483" class="l"><a href="#13483">13483: </a>                <span class="php-var">$newstyle</span>[<span class="php-quote">'text'</span>] = <span class="php-keyword1">true</span>;
</span><span id="13484" class="l"><a href="#13484">13484: </a>            }
</span><span id="13485" class="l"><a href="#13485">13485: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span> &amp; <span class="php-num">256</span>) {
</span><span id="13486" class="l"><a href="#13486">13486: </a>                <span class="php-var">$newstyle</span>[<span class="php-quote">'stretchtext'</span>] = <span class="php-num">4</span>;
</span><span id="13487" class="l"><a href="#13487">13487: </a>            }
</span><span id="13488" class="l"><a href="#13488">13488: </a>            <span class="php-var">$this</span>-&gt;write1DBarcode(<span class="php-var">$code</span>, <span class="php-var">$type</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$xres</span>, <span class="php-var">$newstyle</span>, <span class="php-quote">''</span>);
</span><span id="13489" class="l"><a href="#13489">13489: </a>        }
</span><span id="13490" class="l"><a href="#13490">13490: </a>
</span><span id="13491" class="l"><a href="#13491">13491: </a>        <span class="php-comment">/**
</span></span><span id="13492" class="l"><a href="#13492">13492: </a><span class="php-comment">         * Print 2D Barcode.
</span></span><span id="13493" class="l"><a href="#13493">13493: </a><span class="php-comment">         * @param string $code code to print
</span></span><span id="13494" class="l"><a href="#13494">13494: </a><span class="php-comment">         * @param string $type type of barcode (see 2dbarcodes.php for supported formats).
</span></span><span id="13495" class="l"><a href="#13495">13495: </a><span class="php-comment">         * @param int $x x position in user units
</span></span><span id="13496" class="l"><a href="#13496">13496: </a><span class="php-comment">         * @param int $y y position in user units
</span></span><span id="13497" class="l"><a href="#13497">13497: </a><span class="php-comment">         * @param int $w width in user units
</span></span><span id="13498" class="l"><a href="#13498">13498: </a><span class="php-comment">         * @param int $h height in user units
</span></span><span id="13499" class="l"><a href="#13499">13499: </a><span class="php-comment">         * @param array $style array of options:&lt;ul&gt;&lt;li&gt;boolean $style['border'] if true prints a border around the barcode&lt;/li&gt;&lt;li&gt;int $style['padding'] padding to leave around the barcode in user units (set to 'auto' for automatic padding)&lt;/li&gt;&lt;li&gt;array $style['fgcolor'] color array for bars and text&lt;/li&gt;&lt;li&gt;mixed $style['bgcolor'] color array for background or false for transparent&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13500" class="l"><a href="#13500">13500: </a><span class="php-comment">         * @param string $align Indicates the alignment of the pointer next to barcode insertion relative to barcode height. The value can be:&lt;ul&gt;&lt;li&gt;T: top-right for LTR or top-left for RTL&lt;/li&gt;&lt;li&gt;M: middle-right for LTR or middle-left for RTL&lt;/li&gt;&lt;li&gt;B: bottom-right for LTR or bottom-left for RTL&lt;/li&gt;&lt;li&gt;N: next line&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13501" class="l"><a href="#13501">13501: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="13502" class="l"><a href="#13502">13502: </a><span class="php-comment">         * @since 4.5.037 (2009-04-07)
</span></span><span id="13503" class="l"><a href="#13503">13503: </a><span class="php-comment">         * @access public
</span></span><span id="13504" class="l"><a href="#13504">13504: </a><span class="php-comment">         */</span>
</span><span id="13505" class="l"><a href="#13505">13505: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> write2DBarcode(<span class="php-var">$code</span>, <span class="php-var">$type</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$w</span>=<span class="php-quote">''</span>, <span class="php-var">$h</span>=<span class="php-quote">''</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>) {
</span><span id="13506" class="l"><a href="#13506">13506: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$code</span>)) {
</span><span id="13507" class="l"><a href="#13507">13507: </a>                <span class="php-keyword1">return</span>;
</span><span id="13508" class="l"><a href="#13508">13508: </a>            }
</span><span id="13509" class="l"><a href="#13509">13509: </a>            <span class="php-keyword1">require_once</span>(<span class="php-keyword2">dirname</span>(__FILE__).<span class="php-quote">'/2dbarcodes.php'</span>);
</span><span id="13510" class="l"><a href="#13510">13510: </a>            <span class="php-comment">// save current graphic settings</span>
</span><span id="13511" class="l"><a href="#13511">13511: </a>            <span class="php-var">$gvars</span> = <span class="php-var">$this</span>-&gt;getGraphicVars();
</span><span id="13512" class="l"><a href="#13512">13512: </a>            <span class="php-comment">// create new barcode object</span>
</span><span id="13513" class="l"><a href="#13513">13513: </a>            <span class="php-var">$barcodeobj</span> = <span class="php-keyword1">new</span> TCPDF2DBarcode(<span class="php-var">$code</span>, <span class="php-var">$type</span>);
</span><span id="13514" class="l"><a href="#13514">13514: </a>            <span class="php-var">$arrcode</span> = <span class="php-var">$barcodeobj</span>-&gt;getBarcodeArray();
</span><span id="13515" class="l"><a href="#13515">13515: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$arrcode</span> === <span class="php-keyword1">false</span>) {
</span><span id="13516" class="l"><a href="#13516">13516: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Error in 2D barcode string'</span>);
</span><span id="13517" class="l"><a href="#13517">13517: </a>            }
</span><span id="13518" class="l"><a href="#13518">13518: </a>            <span class="php-comment">// set default values</span>
</span><span id="13519" class="l"><a href="#13519">13519: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>])) {
</span><span id="13520" class="l"><a href="#13520">13520: </a>                <span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>] = <span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">0</span>); <span class="php-comment">// default black</span>
</span><span id="13521" class="l"><a href="#13521">13521: </a>            }
</span><span id="13522" class="l"><a href="#13522">13522: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>])) {
</span><span id="13523" class="l"><a href="#13523">13523: </a>                <span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>] = <span class="php-keyword1">false</span>; <span class="php-comment">// default transparent</span>
</span><span id="13524" class="l"><a href="#13524">13524: </a>            }
</span><span id="13525" class="l"><a href="#13525">13525: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'border'</span>])) {
</span><span id="13526" class="l"><a href="#13526">13526: </a>                <span class="php-var">$style</span>[<span class="php-quote">'border'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13527" class="l"><a href="#13527">13527: </a>            }
</span><span id="13528" class="l"><a href="#13528">13528: </a>            <span class="php-comment">// set foreground color</span>
</span><span id="13529" class="l"><a href="#13529">13529: </a>            <span class="php-var">$this</span>-&gt;SetDrawColorArray(<span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>]);
</span><span id="13530" class="l"><a href="#13530">13530: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$x</span>)) {
</span><span id="13531" class="l"><a href="#13531">13531: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;GetX();
</span><span id="13532" class="l"><a href="#13532">13532: </a>            }
</span><span id="13533" class="l"><a href="#13533">13533: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13534" class="l"><a href="#13534">13534: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span>;
</span><span id="13535" class="l"><a href="#13535">13535: </a>            }
</span><span id="13536" class="l"><a href="#13536">13536: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$y</span>)) {
</span><span id="13537" class="l"><a href="#13537">13537: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="13538" class="l"><a href="#13538">13538: </a>            }
</span><span id="13539" class="l"><a href="#13539">13539: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$w</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="13540" class="l"><a href="#13540">13540: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13541" class="l"><a href="#13541">13541: </a>                    <span class="php-var">$w</span> = <span class="php-var">$x</span> - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="13542" class="l"><a href="#13542">13542: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13543" class="l"><a href="#13543">13543: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$x</span>;
</span><span id="13544" class="l"><a href="#13544">13544: </a>                }
</span><span id="13545" class="l"><a href="#13545">13545: </a>            }
</span><span id="13546" class="l"><a href="#13546">13546: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$h</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="13547" class="l"><a href="#13547">13547: </a>                <span class="php-comment">// 2d barcodes are square by default</span>
</span><span id="13548" class="l"><a href="#13548">13548: </a>                <span class="php-var">$h</span> = <span class="php-var">$w</span>;
</span><span id="13549" class="l"><a href="#13549">13549: </a>            }
</span><span id="13550" class="l"><a href="#13550">13550: </a>            <span class="php-var">$prev_x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="13551" class="l"><a href="#13551">13551: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$h</span>, <span class="php-var">$y</span>)) {
</span><span id="13552" class="l"><a href="#13552">13552: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY() + <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="13553" class="l"><a href="#13553">13553: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13554" class="l"><a href="#13554">13554: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$prev_x</span> - <span class="php-var">$this</span>-&gt;x);
</span><span id="13555" class="l"><a href="#13555">13555: </a>                } <span class="php-keyword1">else</span> {
</span><span id="13556" class="l"><a href="#13556">13556: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$this</span>-&gt;x - <span class="php-var">$prev_x</span>);
</span><span id="13557" class="l"><a href="#13557">13557: </a>                }
</span><span id="13558" class="l"><a href="#13558">13558: </a>            }
</span><span id="13559" class="l"><a href="#13559">13559: </a>            <span class="php-comment">// padding</span>
</span><span id="13560" class="l"><a href="#13560">13560: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$style</span>[<span class="php-quote">'padding'</span>])) {
</span><span id="13561" class="l"><a href="#13561">13561: </a>                <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] = <span class="php-num">0</span>;
</span><span id="13562" class="l"><a href="#13562">13562: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] === <span class="php-quote">'auto'</span>) {
</span><span id="13563" class="l"><a href="#13563">13563: </a>                <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>] = <span class="php-num">4</span> * <span class="php-var">$w</span> / (<span class="php-num">8</span> + <span class="php-var">$arrcode</span>[<span class="php-quote">'num_cols'</span>]);
</span><span id="13564" class="l"><a href="#13564">13564: </a>            }
</span><span id="13565" class="l"><a href="#13565">13565: </a>            <span class="php-comment">// calculate barcode size (excluding padding)</span>
</span><span id="13566" class="l"><a href="#13566">13566: </a>            <span class="php-var">$bw</span> = <span class="php-var">$w</span> - (<span class="php-num">2</span> * <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>]);
</span><span id="13567" class="l"><a href="#13567">13567: </a>            <span class="php-var">$bh</span> = <span class="php-var">$h</span> - (<span class="php-num">2</span> * <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>]);
</span><span id="13568" class="l"><a href="#13568">13568: </a>            <span class="php-comment">// calculate starting coordinates</span>
</span><span id="13569" class="l"><a href="#13569">13569: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13570" class="l"><a href="#13570">13570: </a>                <span class="php-var">$xpos</span> = <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="13571" class="l"><a href="#13571">13571: </a>            } <span class="php-keyword1">else</span> {
</span><span id="13572" class="l"><a href="#13572">13572: </a>                <span class="php-var">$xpos</span> = <span class="php-var">$x</span>;
</span><span id="13573" class="l"><a href="#13573">13573: </a>            }
</span><span id="13574" class="l"><a href="#13574">13574: </a>            <span class="php-var">$xpos</span> += <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>];
</span><span id="13575" class="l"><a href="#13575">13575: </a>            <span class="php-var">$ypos</span> = <span class="php-var">$y</span> + <span class="php-var">$style</span>[<span class="php-quote">'padding'</span>];
</span><span id="13576" class="l"><a href="#13576">13576: </a>            <span class="php-comment">// barcode is always printed in LTR direction</span>
</span><span id="13577" class="l"><a href="#13577">13577: </a>            <span class="php-var">$tempRTL</span> = <span class="php-var">$this</span>-&gt;rtl;
</span><span id="13578" class="l"><a href="#13578">13578: </a>            <span class="php-var">$this</span>-&gt;rtl = <span class="php-keyword1">false</span>;
</span><span id="13579" class="l"><a href="#13579">13579: </a>            <span class="php-comment">// print background color</span>
</span><span id="13580" class="l"><a href="#13580">13580: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>]) {
</span><span id="13581" class="l"><a href="#13581">13581: </a>                <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$style</span>[<span class="php-quote">'border'</span>] ? <span class="php-quote">'DF'</span> : <span class="php-quote">'F'</span>, <span class="php-quote">''</span>, <span class="php-var">$style</span>[<span class="php-quote">'bgcolor'</span>]);
</span><span id="13582" class="l"><a href="#13582">13582: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$style</span>[<span class="php-quote">'border'</span>]) {
</span><span id="13583" class="l"><a href="#13583">13583: </a>                <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'D'</span>);
</span><span id="13584" class="l"><a href="#13584">13584: </a>            }
</span><span id="13585" class="l"><a href="#13585">13585: </a>            <span class="php-comment">// print barcode cells</span>
</span><span id="13586" class="l"><a href="#13586">13586: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$arrcode</span> !== <span class="php-keyword1">false</span>) {
</span><span id="13587" class="l"><a href="#13587">13587: </a>                <span class="php-var">$rows</span> = <span class="php-var">$arrcode</span>[<span class="php-quote">'num_rows'</span>];
</span><span id="13588" class="l"><a href="#13588">13588: </a>                <span class="php-var">$cols</span> = <span class="php-var">$arrcode</span>[<span class="php-quote">'num_cols'</span>];
</span><span id="13589" class="l"><a href="#13589">13589: </a>                <span class="php-comment">// calculate dimension of single barcode cell</span>
</span><span id="13590" class="l"><a href="#13590">13590: </a>                <span class="php-var">$cw</span> = <span class="php-var">$bw</span> / <span class="php-var">$cols</span>;
</span><span id="13591" class="l"><a href="#13591">13591: </a>                <span class="php-var">$ch</span> = <span class="php-var">$bh</span> / <span class="php-var">$rows</span>;
</span><span id="13592" class="l"><a href="#13592">13592: </a>                <span class="php-comment">// for each row</span>
</span><span id="13593" class="l"><a href="#13593">13593: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$r</span> = <span class="php-num">0</span>; <span class="php-var">$r</span> &lt; <span class="php-var">$rows</span>; ++<span class="php-var">$r</span>) {
</span><span id="13594" class="l"><a href="#13594">13594: </a>                    <span class="php-var">$xr</span> = <span class="php-var">$xpos</span>;
</span><span id="13595" class="l"><a href="#13595">13595: </a>                    <span class="php-comment">// for each column</span>
</span><span id="13596" class="l"><a href="#13596">13596: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$c</span> = <span class="php-num">0</span>; <span class="php-var">$c</span> &lt; <span class="php-var">$cols</span>; ++<span class="php-var">$c</span>) {
</span><span id="13597" class="l"><a href="#13597">13597: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$arrcode</span>[<span class="php-quote">'bcode'</span>][<span class="php-var">$r</span>][<span class="php-var">$c</span>] == <span class="php-num">1</span>) {
</span><span id="13598" class="l"><a href="#13598">13598: </a>                            <span class="php-comment">// draw a single barcode cell</span>
</span><span id="13599" class="l"><a href="#13599">13599: </a>                            <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$xr</span>, <span class="php-var">$ypos</span>, <span class="php-var">$cw</span>, <span class="php-var">$ch</span>, <span class="php-quote">'F'</span>, <span class="php-keyword1">array</span>(), <span class="php-var">$style</span>[<span class="php-quote">'fgcolor'</span>]);
</span><span id="13600" class="l"><a href="#13600">13600: </a>                        }
</span><span id="13601" class="l"><a href="#13601">13601: </a>                        <span class="php-var">$xr</span> += <span class="php-var">$cw</span>;
</span><span id="13602" class="l"><a href="#13602">13602: </a>                    }
</span><span id="13603" class="l"><a href="#13603">13603: </a>                    <span class="php-var">$ypos</span> += <span class="php-var">$ch</span>;
</span><span id="13604" class="l"><a href="#13604">13604: </a>                }
</span><span id="13605" class="l"><a href="#13605">13605: </a>            }
</span><span id="13606" class="l"><a href="#13606">13606: </a>            <span class="php-comment">// restore original direction</span>
</span><span id="13607" class="l"><a href="#13607">13607: </a>            <span class="php-var">$this</span>-&gt;rtl = <span class="php-var">$tempRTL</span>;
</span><span id="13608" class="l"><a href="#13608">13608: </a>            <span class="php-comment">// restore previous settings</span>
</span><span id="13609" class="l"><a href="#13609">13609: </a>            <span class="php-var">$this</span>-&gt;setGraphicVars(<span class="php-var">$gvars</span>);
</span><span id="13610" class="l"><a href="#13610">13610: </a>            <span class="php-comment">// set bottomcoordinates</span>
</span><span id="13611" class="l"><a href="#13611">13611: </a>            <span class="php-var">$this</span>-&gt;img_rb_y = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="13612" class="l"><a href="#13612">13612: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="13613" class="l"><a href="#13613">13613: </a>                <span class="php-comment">// set left side coordinate</span>
</span><span id="13614" class="l"><a href="#13614">13614: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> - <span class="php-var">$w</span>);
</span><span id="13615" class="l"><a href="#13615">13615: </a>            } <span class="php-keyword1">else</span> {
</span><span id="13616" class="l"><a href="#13616">13616: </a>                <span class="php-comment">// set right side coordinate</span>
</span><span id="13617" class="l"><a href="#13617">13617: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$x</span> + <span class="php-var">$w</span>;
</span><span id="13618" class="l"><a href="#13618">13618: </a>            }
</span><span id="13619" class="l"><a href="#13619">13619: </a>            <span class="php-comment">// set pointer to align the successive text/objects</span>
</span><span id="13620" class="l"><a href="#13620">13620: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$align</span>) {
</span><span id="13621" class="l"><a href="#13621">13621: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>:{
</span><span id="13622" class="l"><a href="#13622">13622: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="13623" class="l"><a href="#13623">13623: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13624" class="l"><a href="#13624">13624: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13625" class="l"><a href="#13625">13625: </a>                }
</span><span id="13626" class="l"><a href="#13626">13626: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>:{
</span><span id="13627" class="l"><a href="#13627">13627: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span> + <span class="php-keyword2">round</span>(<span class="php-var">$h</span>/<span class="php-num">2</span>);
</span><span id="13628" class="l"><a href="#13628">13628: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13629" class="l"><a href="#13629">13629: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13630" class="l"><a href="#13630">13630: </a>                }
</span><span id="13631" class="l"><a href="#13631">13631: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>:{
</span><span id="13632" class="l"><a href="#13632">13632: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;img_rb_y;
</span><span id="13633" class="l"><a href="#13633">13633: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="13634" class="l"><a href="#13634">13634: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13635" class="l"><a href="#13635">13635: </a>                }
</span><span id="13636" class="l"><a href="#13636">13636: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'N'</span>:{
</span><span id="13637" class="l"><a href="#13637">13637: </a>                    <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$this</span>-&gt;img_rb_y);
</span><span id="13638" class="l"><a href="#13638">13638: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13639" class="l"><a href="#13639">13639: </a>                }
</span><span id="13640" class="l"><a href="#13640">13640: </a>                <span class="php-keyword1">default</span>:{
</span><span id="13641" class="l"><a href="#13641">13641: </a>                    <span class="php-keyword1">break</span>;
</span><span id="13642" class="l"><a href="#13642">13642: </a>                }
</span><span id="13643" class="l"><a href="#13643">13643: </a>            }
</span><span id="13644" class="l"><a href="#13644">13644: </a>        }
</span><span id="13645" class="l"><a href="#13645">13645: </a>
</span><span id="13646" class="l"><a href="#13646">13646: </a>        <span class="php-comment">/**
</span></span><span id="13647" class="l"><a href="#13647">13647: </a><span class="php-comment">         * Returns an array containing current margins:
</span></span><span id="13648" class="l"><a href="#13648">13648: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="13649" class="l"><a href="#13649">13649: </a><span class="php-comment">                &lt;li&gt;$ret['left'] = left  margin&lt;/li&gt;
</span></span><span id="13650" class="l"><a href="#13650">13650: </a><span class="php-comment">                &lt;li&gt;$ret['right'] = right margin&lt;/li&gt;
</span></span><span id="13651" class="l"><a href="#13651">13651: </a><span class="php-comment">                &lt;li&gt;$ret['top'] = top margin&lt;/li&gt;
</span></span><span id="13652" class="l"><a href="#13652">13652: </a><span class="php-comment">                &lt;li&gt;$ret['bottom'] = bottom margin&lt;/li&gt;
</span></span><span id="13653" class="l"><a href="#13653">13653: </a><span class="php-comment">                &lt;li&gt;$ret['header'] = header margin&lt;/li&gt;
</span></span><span id="13654" class="l"><a href="#13654">13654: </a><span class="php-comment">                &lt;li&gt;$ret['footer'] = footer margin&lt;/li&gt;
</span></span><span id="13655" class="l"><a href="#13655">13655: </a><span class="php-comment">                &lt;li&gt;$ret['cell'] = cell margin&lt;/li&gt;
</span></span><span id="13656" class="l"><a href="#13656">13656: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="13657" class="l"><a href="#13657">13657: </a><span class="php-comment">         * @return array containing all margins measures
</span></span><span id="13658" class="l"><a href="#13658">13658: </a><span class="php-comment">         * @access public
</span></span><span id="13659" class="l"><a href="#13659">13659: </a><span class="php-comment">         * @since 3.2.000 (2008-06-23)
</span></span><span id="13660" class="l"><a href="#13660">13660: </a><span class="php-comment">         */</span>
</span><span id="13661" class="l"><a href="#13661">13661: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getMargins() {
</span><span id="13662" class="l"><a href="#13662">13662: </a>            <span class="php-var">$ret</span> = <span class="php-keyword1">array</span>(
</span><span id="13663" class="l"><a href="#13663">13663: </a>                <span class="php-quote">'left'</span> =&gt; <span class="php-var">$this</span>-&gt;lMargin,
</span><span id="13664" class="l"><a href="#13664">13664: </a>                <span class="php-quote">'right'</span> =&gt; <span class="php-var">$this</span>-&gt;rMargin,
</span><span id="13665" class="l"><a href="#13665">13665: </a>                <span class="php-quote">'top'</span> =&gt; <span class="php-var">$this</span>-&gt;tMargin,
</span><span id="13666" class="l"><a href="#13666">13666: </a>                <span class="php-quote">'bottom'</span> =&gt; <span class="php-var">$this</span>-&gt;bMargin,
</span><span id="13667" class="l"><a href="#13667">13667: </a>                <span class="php-quote">'header'</span> =&gt; <span class="php-var">$this</span>-&gt;header_margin,
</span><span id="13668" class="l"><a href="#13668">13668: </a>                <span class="php-quote">'footer'</span> =&gt; <span class="php-var">$this</span>-&gt;footer_margin,
</span><span id="13669" class="l"><a href="#13669">13669: </a>                <span class="php-quote">'cell'</span> =&gt; <span class="php-var">$this</span>-&gt;cMargin,
</span><span id="13670" class="l"><a href="#13670">13670: </a>            );
</span><span id="13671" class="l"><a href="#13671">13671: </a>            <span class="php-keyword1">return</span> <span class="php-var">$ret</span>;
</span><span id="13672" class="l"><a href="#13672">13672: </a>        }
</span><span id="13673" class="l"><a href="#13673">13673: </a>
</span><span id="13674" class="l"><a href="#13674">13674: </a>        <span class="php-comment">/**
</span></span><span id="13675" class="l"><a href="#13675">13675: </a><span class="php-comment">         * Returns an array containing original margins:
</span></span><span id="13676" class="l"><a href="#13676">13676: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="13677" class="l"><a href="#13677">13677: </a><span class="php-comment">                &lt;li&gt;$ret['left'] = left  margin&lt;/li&gt;
</span></span><span id="13678" class="l"><a href="#13678">13678: </a><span class="php-comment">                &lt;li&gt;$ret['right'] = right margin&lt;/li&gt;
</span></span><span id="13679" class="l"><a href="#13679">13679: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="13680" class="l"><a href="#13680">13680: </a><span class="php-comment">         * @return array containing all margins measures
</span></span><span id="13681" class="l"><a href="#13681">13681: </a><span class="php-comment">         * @access public
</span></span><span id="13682" class="l"><a href="#13682">13682: </a><span class="php-comment">         * @since 4.0.012 (2008-07-24)
</span></span><span id="13683" class="l"><a href="#13683">13683: </a><span class="php-comment">         */</span>
</span><span id="13684" class="l"><a href="#13684">13684: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getOriginalMargins() {
</span><span id="13685" class="l"><a href="#13685">13685: </a>            <span class="php-var">$ret</span> = <span class="php-keyword1">array</span>(
</span><span id="13686" class="l"><a href="#13686">13686: </a>                <span class="php-quote">'left'</span> =&gt; <span class="php-var">$this</span>-&gt;original_lMargin,
</span><span id="13687" class="l"><a href="#13687">13687: </a>                <span class="php-quote">'right'</span> =&gt; <span class="php-var">$this</span>-&gt;original_rMargin
</span><span id="13688" class="l"><a href="#13688">13688: </a>            );
</span><span id="13689" class="l"><a href="#13689">13689: </a>            <span class="php-keyword1">return</span> <span class="php-var">$ret</span>;
</span><span id="13690" class="l"><a href="#13690">13690: </a>        }
</span><span id="13691" class="l"><a href="#13691">13691: </a>
</span><span id="13692" class="l"><a href="#13692">13692: </a>        <span class="php-comment">/**
</span></span><span id="13693" class="l"><a href="#13693">13693: </a><span class="php-comment">         * Returns the current font size.
</span></span><span id="13694" class="l"><a href="#13694">13694: </a><span class="php-comment">         * @return current font size
</span></span><span id="13695" class="l"><a href="#13695">13695: </a><span class="php-comment">         * @access public
</span></span><span id="13696" class="l"><a href="#13696">13696: </a><span class="php-comment">         * @since 3.2.000 (2008-06-23)
</span></span><span id="13697" class="l"><a href="#13697">13697: </a><span class="php-comment">         */</span>
</span><span id="13698" class="l"><a href="#13698">13698: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFontSize() {
</span><span id="13699" class="l"><a href="#13699">13699: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;FontSize;
</span><span id="13700" class="l"><a href="#13700">13700: </a>        }
</span><span id="13701" class="l"><a href="#13701">13701: </a>
</span><span id="13702" class="l"><a href="#13702">13702: </a>        <span class="php-comment">/**
</span></span><span id="13703" class="l"><a href="#13703">13703: </a><span class="php-comment">         * Returns the current font size in points unit.
</span></span><span id="13704" class="l"><a href="#13704">13704: </a><span class="php-comment">         * @return current font size in points unit
</span></span><span id="13705" class="l"><a href="#13705">13705: </a><span class="php-comment">         * @access public
</span></span><span id="13706" class="l"><a href="#13706">13706: </a><span class="php-comment">         * @since 3.2.000 (2008-06-23)
</span></span><span id="13707" class="l"><a href="#13707">13707: </a><span class="php-comment">         */</span>
</span><span id="13708" class="l"><a href="#13708">13708: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFontSizePt() {
</span><span id="13709" class="l"><a href="#13709">13709: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="13710" class="l"><a href="#13710">13710: </a>        }
</span><span id="13711" class="l"><a href="#13711">13711: </a>
</span><span id="13712" class="l"><a href="#13712">13712: </a>        <span class="php-comment">/**
</span></span><span id="13713" class="l"><a href="#13713">13713: </a><span class="php-comment">         * Returns the current font family name.
</span></span><span id="13714" class="l"><a href="#13714">13714: </a><span class="php-comment">         * @return string current font family name
</span></span><span id="13715" class="l"><a href="#13715">13715: </a><span class="php-comment">         * @access public
</span></span><span id="13716" class="l"><a href="#13716">13716: </a><span class="php-comment">         * @since 4.3.008 (2008-12-05)
</span></span><span id="13717" class="l"><a href="#13717">13717: </a><span class="php-comment">         */</span>
</span><span id="13718" class="l"><a href="#13718">13718: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFontFamily() {
</span><span id="13719" class="l"><a href="#13719">13719: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="13720" class="l"><a href="#13720">13720: </a>        }
</span><span id="13721" class="l"><a href="#13721">13721: </a>
</span><span id="13722" class="l"><a href="#13722">13722: </a>        <span class="php-comment">/**
</span></span><span id="13723" class="l"><a href="#13723">13723: </a><span class="php-comment">         * Returns the current font style.
</span></span><span id="13724" class="l"><a href="#13724">13724: </a><span class="php-comment">         * @return string current font style
</span></span><span id="13725" class="l"><a href="#13725">13725: </a><span class="php-comment">         * @access public
</span></span><span id="13726" class="l"><a href="#13726">13726: </a><span class="php-comment">         * @since 4.3.008 (2008-12-05)
</span></span><span id="13727" class="l"><a href="#13727">13727: </a><span class="php-comment">         */</span>
</span><span id="13728" class="l"><a href="#13728">13728: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getFontStyle() {
</span><span id="13729" class="l"><a href="#13729">13729: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;FontStyle;
</span><span id="13730" class="l"><a href="#13730">13730: </a>        }
</span><span id="13731" class="l"><a href="#13731">13731: </a>
</span><span id="13732" class="l"><a href="#13732">13732: </a>        <span class="php-comment">/**
</span></span><span id="13733" class="l"><a href="#13733">13733: </a><span class="php-comment">         * Prints a cell (rectangular area) with optional borders, background color and html text string.
</span></span><span id="13734" class="l"><a href="#13734">13734: </a><span class="php-comment">         * The upper-left corner of the cell corresponds to the current position. After the call, the current position moves to the right or to the next line.&lt;br /&gt;
</span></span><span id="13735" class="l"><a href="#13735">13735: </a><span class="php-comment">         * If automatic page breaking is enabled and the cell goes beyond the limit, a page break is done before outputting.
</span></span><span id="13736" class="l"><a href="#13736">13736: </a><span class="php-comment">         * @param float $w Cell width. If 0, the cell extends up to the right margin.
</span></span><span id="13737" class="l"><a href="#13737">13737: </a><span class="php-comment">         * @param float $h Cell minimum height. The cell extends automatically if needed.
</span></span><span id="13738" class="l"><a href="#13738">13738: </a><span class="php-comment">         * @param float $x upper-left corner X coordinate
</span></span><span id="13739" class="l"><a href="#13739">13739: </a><span class="php-comment">         * @param float $y upper-left corner Y coordinate
</span></span><span id="13740" class="l"><a href="#13740">13740: </a><span class="php-comment">         * @param string $html html text to print. Default value: empty string.
</span></span><span id="13741" class="l"><a href="#13741">13741: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the cell. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13742" class="l"><a href="#13742">13742: </a><span class="php-comment">         * @param int $ln Indicates where the current position should go after the call. Possible values are:&lt;ul&gt;&lt;li&gt;0: to the right (or left for RTL language)&lt;/li&gt;&lt;li&gt;1: to the beginning of the next line&lt;/li&gt;&lt;li&gt;2: below&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13743" class="l"><a href="#13743">13743: </a><span class="php-comment">    Putting 1 is equivalent to putting 0 and calling Ln() just after. Default value: 0.
</span></span><span id="13744" class="l"><a href="#13744">13744: </a><span class="php-comment">         * @param int $fill Indicates if the cell background must be painted (1) or transparent (0). Default value: 0.
</span></span><span id="13745" class="l"><a href="#13745">13745: </a><span class="php-comment">         * @param boolean $reseth if true reset the last cell height (default true).
</span></span><span id="13746" class="l"><a href="#13746">13746: </a><span class="php-comment">         * @param string $align Allows to center or align the text. Possible values are:&lt;ul&gt;&lt;li&gt;L : left align&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;R : right align&lt;/li&gt;&lt;li&gt;'' : empty string : left for LTR or right for RTL&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13747" class="l"><a href="#13747">13747: </a><span class="php-comment">         * @param boolean $autopadding if true, uses internal padding and automatically adjust it to account for line width.
</span></span><span id="13748" class="l"><a href="#13748">13748: </a><span class="php-comment">         * @access public
</span></span><span id="13749" class="l"><a href="#13749">13749: </a><span class="php-comment">         * @uses MultiCell()
</span></span><span id="13750" class="l"><a href="#13750">13750: </a><span class="php-comment">         * @see Multicell(), writeHTML()
</span></span><span id="13751" class="l"><a href="#13751">13751: </a><span class="php-comment">         */</span>
</span><span id="13752" class="l"><a href="#13752">13752: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> writeHTMLCell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$html</span>=<span class="php-quote">''</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$ln</span>=<span class="php-num">0</span>, <span class="php-var">$fill</span>=<span class="php-num">0</span>, <span class="php-var">$reseth</span>=<span class="php-keyword1">true</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$autopadding</span>=<span class="php-keyword1">true</span>) {
</span><span id="13753" class="l"><a href="#13753">13753: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;MultiCell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$html</span>, <span class="php-var">$border</span>, <span class="php-var">$align</span>, <span class="php-var">$fill</span>, <span class="php-var">$ln</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$reseth</span>, <span class="php-num">0</span>, <span class="php-keyword1">true</span>, <span class="php-var">$autopadding</span>, <span class="php-num">0</span>);
</span><span id="13754" class="l"><a href="#13754">13754: </a>        }
</span><span id="13755" class="l"><a href="#13755">13755: </a>
</span><span id="13756" class="l"><a href="#13756">13756: </a>        <span class="php-comment">/**
</span></span><span id="13757" class="l"><a href="#13757">13757: </a><span class="php-comment">         * Returns the HTML DOM array.
</span></span><span id="13758" class="l"><a href="#13758">13758: </a><span class="php-comment">         * &lt;ul&gt;&lt;li&gt;$dom[$key]['tag'] = true if tag, false otherwise;&lt;/li&gt;&lt;li&gt;$dom[$key]['value'] = tag name or text;&lt;/li&gt;&lt;li&gt;$dom[$key]['opening'] = true if opening tag, false otherwise;&lt;/li&gt;&lt;li&gt;$dom[$key]['attribute'] = array of attributes (attribute name is the key);&lt;/li&gt;&lt;li&gt;$dom[$key]['style'] = array of style attributes (attribute name is the key);&lt;/li&gt;&lt;li&gt;$dom[$key]['parent'] = id of parent element;&lt;/li&gt;&lt;li&gt;$dom[$key]['fontname'] = font family name;&lt;/li&gt;&lt;li&gt;$dom[$key]['fontstyle'] = font style;&lt;/li&gt;&lt;li&gt;$dom[$key]['fontsize'] = font size in points;&lt;/li&gt;&lt;li&gt;$dom[$key]['bgcolor'] = RGB array of background color;&lt;/li&gt;&lt;li&gt;$dom[$key]['fgcolor'] = RGB array of foreground color;&lt;/li&gt;&lt;li&gt;$dom[$key]['width'] = width in pixels;&lt;/li&gt;&lt;li&gt;$dom[$key]['height'] = height in pixels;&lt;/li&gt;&lt;li&gt;$dom[$key]['align'] = text alignment;&lt;/li&gt;&lt;li&gt;$dom[$key]['cols'] = number of colums in table;&lt;/li&gt;&lt;li&gt;$dom[$key]['rows'] = number of rows in table;&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="13759" class="l"><a href="#13759">13759: </a><span class="php-comment">         * @param string $html html code
</span></span><span id="13760" class="l"><a href="#13760">13760: </a><span class="php-comment">         * @return array
</span></span><span id="13761" class="l"><a href="#13761">13761: </a><span class="php-comment">         * @access protected
</span></span><span id="13762" class="l"><a href="#13762">13762: </a><span class="php-comment">         * @since 3.2.000 (2008-06-20)
</span></span><span id="13763" class="l"><a href="#13763">13763: </a><span class="php-comment">         */</span>
</span><span id="13764" class="l"><a href="#13764">13764: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getHtmlDomArray(<span class="php-var">$html</span>) {
</span><span id="13765" class="l"><a href="#13765">13765: </a>            <span class="php-comment">// define block tags</span>
</span><span id="13766" class="l"><a href="#13766">13766: </a>            <span class="php-var">$blocktags</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'blockquote'</span>,<span class="php-quote">'br'</span>,<span class="php-quote">'dd'</span>,<span class="php-quote">'dl'</span>,<span class="php-quote">'div'</span>,<span class="php-quote">'dt'</span>,<span class="php-quote">'h1'</span>,<span class="php-quote">'h2'</span>,<span class="php-quote">'h3'</span>,<span class="php-quote">'h4'</span>,<span class="php-quote">'h5'</span>,<span class="php-quote">'h6'</span>,<span class="php-quote">'hr'</span>,<span class="php-quote">'li'</span>,<span class="php-quote">'ol'</span>,<span class="php-quote">'p'</span>,<span class="php-quote">'pre'</span>,<span class="php-quote">'ul'</span>,<span class="php-quote">'tcpdf'</span>,<span class="php-quote">'table'</span>,<span class="php-quote">'tr'</span>,<span class="php-quote">'td'</span>);
</span><span id="13767" class="l"><a href="#13767">13767: </a>            <span class="php-comment">// remove all unsupported tags (the line below lists all supported tags)</span>
</span><span id="13768" class="l"><a href="#13768">13768: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">strip_tags</span>(<span class="php-var">$html</span>, <span class="php-quote">'&lt;marker/&gt;&lt;a&gt;&lt;b&gt;&lt;blockquote&gt;&lt;body&gt;&lt;br&gt;&lt;br/&gt;&lt;dd&gt;&lt;del&gt;&lt;div&gt;&lt;dl&gt;&lt;dt&gt;&lt;em&gt;&lt;font&gt;&lt;form&gt;&lt;h1&gt;&lt;h2&gt;&lt;h3&gt;&lt;h4&gt;&lt;h5&gt;&lt;h6&gt;&lt;hr&gt;&lt;i&gt;&lt;img&gt;&lt;input&gt;&lt;label&gt;&lt;li&gt;&lt;ol&gt;&lt;option&gt;&lt;p&gt;&lt;pre&gt;&lt;select&gt;&lt;small&gt;&lt;span&gt;&lt;strong&gt;&lt;sub&gt;&lt;sup&gt;&lt;table&gt;&lt;tablehead&gt;&lt;tcpdf&gt;&lt;td&gt;&lt;textarea&gt;&lt;th&gt;&lt;thead&gt;&lt;tr&gt;&lt;tt&gt;&lt;u&gt;&lt;ul&gt;'</span>);
</span><span id="13769" class="l"><a href="#13769">13769: </a>            <span class="php-comment">//replace some blank characters</span>
</span><span id="13770" class="l"><a href="#13770">13770: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;pre/'</span>, <span class="php-quote">'&lt;xre'</span>, <span class="php-var">$html</span>); <span class="php-comment">// preserve pre tag</span>
</span><span id="13771" class="l"><a href="#13771">13771: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;(table|tr|td|th|tcpdf|blockquote|dd|div|dl|dt|form|h1|h2|h3|h4|h5|h6|br|hr|li|ol|ul|p)([^\&gt;]*)&gt;[\n\r\t]+/'</span>, <span class="php-quote">'&lt;\\1\\2&gt;'</span>, <span class="php-var">$html</span>);
</span><span id="13772" class="l"><a href="#13772">13772: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'@(\r\n|\r)@'</span>, <span class="php-quote">&quot;\n&quot;</span>, <span class="php-var">$html</span>);
</span><span id="13773" class="l"><a href="#13773">13773: </a>            <span class="php-var">$repTable</span> = <span class="php-keyword1">array</span>(<span class="php-quote">&quot;\t&quot;</span> =&gt; <span class="php-quote">' '</span>, <span class="php-quote">&quot;\0&quot;</span> =&gt; <span class="php-quote">' '</span>, <span class="php-quote">&quot;\x0B&quot;</span> =&gt; <span class="php-quote">' '</span>, <span class="php-quote">&quot;\\&quot;</span> =&gt; <span class="php-quote">&quot;\\\\&quot;</span>);
</span><span id="13774" class="l"><a href="#13774">13774: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">strtr</span>(<span class="php-var">$html</span>, <span class="php-var">$repTable</span>);
</span><span id="13775" class="l"><a href="#13775">13775: </a>            <span class="php-var">$offset</span> = <span class="php-num">0</span>;
</span><span id="13776" class="l"><a href="#13776">13776: </a>            <span class="php-keyword1">while</span> ((<span class="php-var">$offset</span> &lt; <span class="php-keyword2">strlen</span>(<span class="php-var">$html</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$pos</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$html</span>, <span class="php-quote">'&lt;/pre&gt;'</span>, <span class="php-var">$offset</span>)) !== <span class="php-keyword1">false</span>) {
</span><span id="13777" class="l"><a href="#13777">13777: </a>                <span class="php-var">$html_a</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-num">0</span>, <span class="php-var">$offset</span>);
</span><span id="13778" class="l"><a href="#13778">13778: </a>                <span class="php-var">$html_b</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-var">$offset</span>, (<span class="php-var">$pos</span> - <span class="php-var">$offset</span> + <span class="php-num">6</span>));
</span><span id="13779" class="l"><a href="#13779">13779: </a>                <span class="php-keyword1">while</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">&quot;'&lt;xre([^\&gt;]*)&gt;(.*?)\n(.*?)&lt;/pre&gt;'si&quot;</span>, <span class="php-var">$html_b</span>)) {
</span><span id="13780" class="l"><a href="#13780">13780: </a>                    <span class="php-comment">// preserve newlines on &lt;pre&gt; tag</span>
</span><span id="13781" class="l"><a href="#13781">13781: </a>                    <span class="php-var">$html_b</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'&lt;xre([^\&gt;]*)&gt;(.*?)\n(.*?)&lt;/pre&gt;'si&quot;</span>, <span class="php-quote">&quot;&lt;xre\\1&gt;\\2&lt;br /&gt;\\3&lt;/pre&gt;&quot;</span>, <span class="php-var">$html_b</span>);
</span><span id="13782" class="l"><a href="#13782">13782: </a>                }
</span><span id="13783" class="l"><a href="#13783">13783: </a>                <span class="php-var">$html</span> = <span class="php-var">$html_a</span>.<span class="php-var">$html_b</span>.<span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-var">$pos</span> + <span class="php-num">6</span>);
</span><span id="13784" class="l"><a href="#13784">13784: </a>                <span class="php-var">$offset</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$html_a</span>.<span class="php-var">$html_b</span>);
</span><span id="13785" class="l"><a href="#13785">13785: </a>            }
</span><span id="13786" class="l"><a href="#13786">13786: </a>            <span class="php-var">$offset</span> = <span class="php-num">0</span>;
</span><span id="13787" class="l"><a href="#13787">13787: </a>            <span class="php-keyword1">while</span> ((<span class="php-var">$offset</span> &lt; <span class="php-keyword2">strlen</span>(<span class="php-var">$html</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$pos</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$html</span>, <span class="php-quote">'&lt;/textarea&gt;'</span>, <span class="php-var">$offset</span>)) !== <span class="php-keyword1">false</span>) {
</span><span id="13788" class="l"><a href="#13788">13788: </a>                <span class="php-var">$html_a</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-num">0</span>, <span class="php-var">$offset</span>);
</span><span id="13789" class="l"><a href="#13789">13789: </a>                <span class="php-var">$html_b</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-var">$offset</span>, (<span class="php-var">$pos</span> - <span class="php-var">$offset</span> + <span class="php-num">11</span>));
</span><span id="13790" class="l"><a href="#13790">13790: </a>                <span class="php-keyword1">while</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">&quot;'&lt;textarea([^\&gt;]*)&gt;(.*?)\n(.*?)&lt;/textarea&gt;'si&quot;</span>, <span class="php-var">$html_b</span>)) {
</span><span id="13791" class="l"><a href="#13791">13791: </a>                    <span class="php-comment">// preserve newlines on &lt;textarea&gt; tag</span>
</span><span id="13792" class="l"><a href="#13792">13792: </a>                    <span class="php-var">$html_b</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'&lt;textarea([^\&gt;]*)&gt;(.*?)\n(.*?)&lt;/textarea&gt;'si&quot;</span>, <span class="php-quote">&quot;&lt;textarea\\1&gt;\\2&lt;TBR&gt;\\3&lt;/textarea&gt;&quot;</span>, <span class="php-var">$html_b</span>);
</span><span id="13793" class="l"><a href="#13793">13793: </a>                    <span class="php-var">$html_b</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'&lt;textarea([^\&gt;]*)&gt;(.*?)[\&quot;](.*?)&lt;/textarea&gt;'si&quot;</span>, <span class="php-quote">&quot;&lt;textarea\\1&gt;\\2''\\3&lt;/textarea&gt;&quot;</span>, <span class="php-var">$html_b</span>);
</span><span id="13794" class="l"><a href="#13794">13794: </a>                }
</span><span id="13795" class="l"><a href="#13795">13795: </a>                <span class="php-var">$html</span> = <span class="php-var">$html_a</span>.<span class="php-var">$html_b</span>.<span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-var">$pos</span> + <span class="php-num">11</span>);
</span><span id="13796" class="l"><a href="#13796">13796: </a>                <span class="php-var">$offset</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$html_a</span>.<span class="php-var">$html_b</span>);
</span><span id="13797" class="l"><a href="#13797">13797: </a>            }
</span><span id="13798" class="l"><a href="#13798">13798: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'([\s]*)&lt;option'si&quot;</span>, <span class="php-quote">&quot;&lt;option&quot;</span>, <span class="php-var">$html</span>);
</span><span id="13799" class="l"><a href="#13799">13799: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'&lt;/option&gt;([\s]*)'si&quot;</span>, <span class="php-quote">&quot;&lt;/option&gt;&quot;</span>, <span class="php-var">$html</span>);
</span><span id="13800" class="l"><a href="#13800">13800: </a>            <span class="php-var">$offset</span> = <span class="php-num">0</span>;
</span><span id="13801" class="l"><a href="#13801">13801: </a>            <span class="php-keyword1">while</span> ((<span class="php-var">$offset</span> &lt; <span class="php-keyword2">strlen</span>(<span class="php-var">$html</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$pos</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$html</span>, <span class="php-quote">'&lt;/option&gt;'</span>, <span class="php-var">$offset</span>)) !== <span class="php-keyword1">false</span>) {
</span><span id="13802" class="l"><a href="#13802">13802: </a>                <span class="php-var">$html_a</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-num">0</span>, <span class="php-var">$offset</span>);
</span><span id="13803" class="l"><a href="#13803">13803: </a>                <span class="php-var">$html_b</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-var">$offset</span>, (<span class="php-var">$pos</span> - <span class="php-var">$offset</span> + <span class="php-num">9</span>));
</span><span id="13804" class="l"><a href="#13804">13804: </a>                <span class="php-keyword1">while</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">&quot;'&lt;option([^\&gt;]*)&gt;(.*?)&lt;/option&gt;'si&quot;</span>, <span class="php-var">$html_b</span>)) {
</span><span id="13805" class="l"><a href="#13805">13805: </a>                    <span class="php-var">$html_b</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'&lt;option([\s]+)value=\&quot;([^\&quot;]*)\&quot;([^\&gt;]*)&gt;(.*?)&lt;/option&gt;'si&quot;</span>, <span class="php-quote">&quot;\\2\t\\4\r&quot;</span>, <span class="php-var">$html_b</span>);
</span><span id="13806" class="l"><a href="#13806">13806: </a>                    <span class="php-var">$html_b</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'&lt;option([^\&gt;]*)&gt;(.*?)&lt;/option&gt;'si&quot;</span>, <span class="php-quote">&quot;\\2\r&quot;</span>, <span class="php-var">$html_b</span>);
</span><span id="13807" class="l"><a href="#13807">13807: </a>                }
</span><span id="13808" class="l"><a href="#13808">13808: </a>                <span class="php-var">$html</span> = <span class="php-var">$html_a</span>.<span class="php-var">$html_b</span>.<span class="php-keyword2">substr</span>(<span class="php-var">$html</span>, <span class="php-var">$pos</span> + <span class="php-num">9</span>);
</span><span id="13809" class="l"><a href="#13809">13809: </a>                <span class="php-var">$offset</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$html_a</span>.<span class="php-var">$html_b</span>);
</span><span id="13810" class="l"><a href="#13810">13810: </a>            }
</span><span id="13811" class="l"><a href="#13811">13811: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'&lt;select([^\&gt;]*)&gt;'si&quot;</span>, <span class="php-quote">&quot;&lt;select\\1 opt=\&quot;&quot;</span>, <span class="php-var">$html</span>);
</span><span id="13812" class="l"><a href="#13812">13812: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;'([\s]+)&lt;/select&gt;'si&quot;</span>, <span class="php-quote">&quot;\&quot; /&gt;&quot;</span>, <span class="php-var">$html</span>);
</span><span id="13813" class="l"><a href="#13813">13813: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">&quot;\n&quot;</span>, <span class="php-quote">' '</span>, <span class="php-var">$html</span>);
</span><span id="13814" class="l"><a href="#13814">13814: </a>            <span class="php-comment">// restore textarea newlines</span>
</span><span id="13815" class="l"><a href="#13815">13815: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'&lt;TBR&gt;'</span>, <span class="php-quote">&quot;\n&quot;</span>, <span class="php-var">$html</span>);
</span><span id="13816" class="l"><a href="#13816">13816: </a>            <span class="php-comment">// remove extra spaces from code</span>
</span><span id="13817" class="l"><a href="#13817">13817: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]+&lt;\/(table|tr|td|th|ul|ol|li|dl|dt|dd)&gt;/'</span>, <span class="php-quote">'&lt;/\\1&gt;'</span>, <span class="php-var">$html</span>);
</span><span id="13818" class="l"><a href="#13818">13818: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]+&lt;(tr|td|th|ul|ol|li|dl|dt|dd|br)/'</span>, <span class="php-quote">'&lt;\\1'</span>, <span class="php-var">$html</span>);
</span><span id="13819" class="l"><a href="#13819">13819: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;\/(table|tr|td|th|blockquote|dd|dt|dl|div|dt|h1|h2|h3|h4|h5|h6|hr|li|ol|ul|p)&gt;[\s]+&lt;/'</span>, <span class="php-quote">'&lt;/\\1&gt;&lt;'</span>, <span class="php-var">$html</span>);
</span><span id="13820" class="l"><a href="#13820">13820: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;\/(td|th)&gt;/'</span>, <span class="php-quote">'&lt;marker style=&quot;font-size:0&quot;/&gt;&lt;/\\1&gt;'</span>, <span class="php-var">$html</span>);
</span><span id="13821" class="l"><a href="#13821">13821: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;\/table&gt;([\s]*)&lt;marker style=&quot;font-size:0&quot;\/&gt;/'</span>, <span class="php-quote">'&lt;/table&gt;'</span>, <span class="php-var">$html</span>);
</span><span id="13822" class="l"><a href="#13822">13822: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]*&lt;img/'</span>, <span class="php-quote">' &lt;img'</span>, <span class="php-var">$html</span>);
</span><span id="13823" class="l"><a href="#13823">13823: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;img([^\&gt;]*)&gt;/xi'</span>, <span class="php-quote">'&lt;img\\1&gt;&lt;span&gt;&lt;marker style=&quot;font-size:0&quot;/&gt;&lt;/span&gt;'</span>, <span class="php-var">$html</span>);
</span><span id="13824" class="l"><a href="#13824">13824: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;xre/'</span>, <span class="php-quote">'&lt;pre'</span>, <span class="php-var">$html</span>); <span class="php-comment">// restore pre tag</span>
</span><span id="13825" class="l"><a href="#13825">13825: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;textarea([^\&gt;]*)&gt;/xi'</span>, <span class="php-quote">'&lt;textarea\\1 value=&quot;'</span>, <span class="php-var">$html</span>);
</span><span id="13826" class="l"><a href="#13826">13826: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/&lt;\/textarea&gt;/'</span>, <span class="php-quote">'&quot; /&gt;'</span>, <span class="php-var">$html</span>);
</span><span id="13827" class="l"><a href="#13827">13827: </a>            <span class="php-comment">// trim string</span>
</span><span id="13828" class="l"><a href="#13828">13828: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/^[\s]+/'</span>, <span class="php-quote">''</span>, <span class="php-var">$html</span>);
</span><span id="13829" class="l"><a href="#13829">13829: </a>            <span class="php-var">$html</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\s]+$/'</span>, <span class="php-quote">''</span>, <span class="php-var">$html</span>);
</span><span id="13830" class="l"><a href="#13830">13830: </a>            <span class="php-comment">// pattern for generic tag</span>
</span><span id="13831" class="l"><a href="#13831">13831: </a>            <span class="php-var">$tagpattern</span> = <span class="php-quote">'/(&lt;[^&gt;]+&gt;)/'</span>;
</span><span id="13832" class="l"><a href="#13832">13832: </a>            <span class="php-comment">// explodes the string</span>
</span><span id="13833" class="l"><a href="#13833">13833: </a>            <span class="php-var">$a</span> = <span class="php-keyword2">preg_split</span>(<span class="php-var">$tagpattern</span>, <span class="php-var">$html</span>, -<span class="php-num">1</span>, PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
</span><span id="13834" class="l"><a href="#13834">13834: </a>            <span class="php-comment">// count elements</span>
</span><span id="13835" class="l"><a href="#13835">13835: </a>            <span class="php-var">$maxel</span> = <span class="php-keyword2">count</span>(<span class="php-var">$a</span>);
</span><span id="13836" class="l"><a href="#13836">13836: </a>            <span class="php-var">$elkey</span> = <span class="php-num">0</span>;
</span><span id="13837" class="l"><a href="#13837">13837: </a>            <span class="php-var">$key</span> = <span class="php-num">0</span>;
</span><span id="13838" class="l"><a href="#13838">13838: </a>            <span class="php-comment">// create an array of elements</span>
</span><span id="13839" class="l"><a href="#13839">13839: </a>            <span class="php-var">$dom</span> = <span class="php-keyword1">array</span>();
</span><span id="13840" class="l"><a href="#13840">13840: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>] = <span class="php-keyword1">array</span>();
</span><span id="13841" class="l"><a href="#13841">13841: </a>            <span class="php-comment">// set first void element</span>
</span><span id="13842" class="l"><a href="#13842">13842: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13843" class="l"><a href="#13843">13843: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'block'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13844" class="l"><a href="#13844">13844: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-quote">''</span>;
</span><span id="13845" class="l"><a href="#13845">13845: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>] = <span class="php-num">0</span>;
</span><span id="13846" class="l"><a href="#13846">13846: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>] = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="13847" class="l"><a href="#13847">13847: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] = <span class="php-var">$this</span>-&gt;FontStyle;
</span><span id="13848" class="l"><a href="#13848">13848: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="13849" class="l"><a href="#13849">13849: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'stroke'</span>] = <span class="php-var">$this</span>-&gt;textstrokewidth;
</span><span id="13850" class="l"><a href="#13850">13850: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fill'</span>] = ((<span class="php-var">$this</span>-&gt;textrendermode % <span class="php-num">2</span>) == <span class="php-num">0</span>);
</span><span id="13851" class="l"><a href="#13851">13851: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'clip'</span>] = (<span class="php-var">$this</span>-&gt;textrendermode &gt; <span class="php-num">3</span>);
</span><span id="13852" class="l"><a href="#13852">13852: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'line-height'</span>] = <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="13853" class="l"><a href="#13853">13853: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13854" class="l"><a href="#13854">13854: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>] = <span class="php-var">$this</span>-&gt;fgcolor;
</span><span id="13855" class="l"><a href="#13855">13855: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'strokecolor'</span>] = <span class="php-var">$this</span>-&gt;strokecolor;
</span><span id="13856" class="l"><a href="#13856">13856: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = <span class="php-quote">''</span>;
</span><span id="13857" class="l"><a href="#13857">13857: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'listtype'</span>] = <span class="php-quote">''</span>;
</span><span id="13858" class="l"><a href="#13858">13858: </a>            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'text-indent'</span>] = <span class="php-num">0</span>;
</span><span id="13859" class="l"><a href="#13859">13859: </a>            <span class="php-var">$thead</span> = <span class="php-keyword1">false</span>; <span class="php-comment">// true when we are inside the THEAD tag</span>
</span><span id="13860" class="l"><a href="#13860">13860: </a>            ++<span class="php-var">$key</span>;
</span><span id="13861" class="l"><a href="#13861">13861: </a>            <span class="php-var">$level</span> = <span class="php-keyword1">array</span>();
</span><span id="13862" class="l"><a href="#13862">13862: </a>            <span class="php-keyword2">array_push</span>(<span class="php-var">$level</span>, <span class="php-num">0</span>); <span class="php-comment">// root</span>
</span><span id="13863" class="l"><a href="#13863">13863: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$elkey</span> &lt; <span class="php-var">$maxel</span>) {
</span><span id="13864" class="l"><a href="#13864">13864: </a>                <span class="php-var">$dom</span>[<span class="php-var">$key</span>] = <span class="php-keyword1">array</span>();
</span><span id="13865" class="l"><a href="#13865">13865: </a>                <span class="php-var">$element</span> = <span class="php-var">$a</span>[<span class="php-var">$elkey</span>];
</span><span id="13866" class="l"><a href="#13866">13866: </a>                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'elkey'</span>] = <span class="php-var">$elkey</span>;
</span><span id="13867" class="l"><a href="#13867">13867: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-var">$tagpattern</span>, <span class="php-var">$element</span>)) {
</span><span id="13868" class="l"><a href="#13868">13868: </a>                    <span class="php-comment">// html tag</span>
</span><span id="13869" class="l"><a href="#13869">13869: </a>                    <span class="php-var">$element</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$element</span>, <span class="php-num">1</span>, -<span class="php-num">1</span>);
</span><span id="13870" class="l"><a href="#13870">13870: </a>                    <span class="php-comment">// get tag name</span>
</span><span id="13871" class="l"><a href="#13871">13871: </a>                    <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\/]?([a-zA-Z0-9]*)/'</span>, <span class="php-var">$element</span>, <span class="php-var">$tag</span>);
</span><span id="13872" class="l"><a href="#13872">13872: </a>                    <span class="php-var">$tagname</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$tag</span>[<span class="php-num">1</span>]);
</span><span id="13873" class="l"><a href="#13873">13873: </a>                    <span class="php-comment">// check if we are inside a table header</span>
</span><span id="13874" class="l"><a href="#13874">13874: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$tagname</span> == <span class="php-quote">'thead'</span>) {
</span><span id="13875" class="l"><a href="#13875">13875: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$element</span>{<span class="php-num">0</span>} == <span class="php-quote">'/'</span>) {
</span><span id="13876" class="l"><a href="#13876">13876: </a>                            <span class="php-var">$thead</span> = <span class="php-keyword1">false</span>;
</span><span id="13877" class="l"><a href="#13877">13877: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="13878" class="l"><a href="#13878">13878: </a>                            <span class="php-var">$thead</span> = <span class="php-keyword1">true</span>;
</span><span id="13879" class="l"><a href="#13879">13879: </a>                        }
</span><span id="13880" class="l"><a href="#13880">13880: </a>                        ++<span class="php-var">$elkey</span>;
</span><span id="13881" class="l"><a href="#13881">13881: </a>                        <span class="php-keyword1">continue</span>;
</span><span id="13882" class="l"><a href="#13882">13882: </a>                    }
</span><span id="13883" class="l"><a href="#13883">13883: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] = <span class="php-keyword1">true</span>;
</span><span id="13884" class="l"><a href="#13884">13884: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-var">$tagname</span>;
</span><span id="13885" class="l"><a href="#13885">13885: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>], <span class="php-var">$blocktags</span>)) {
</span><span id="13886" class="l"><a href="#13886">13886: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'block'</span>] = <span class="php-keyword1">true</span>;
</span><span id="13887" class="l"><a href="#13887">13887: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="13888" class="l"><a href="#13888">13888: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'block'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13889" class="l"><a href="#13889">13889: </a>                    }
</span><span id="13890" class="l"><a href="#13890">13890: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$element</span>{<span class="php-num">0</span>} == <span class="php-quote">'/'</span>) {
</span><span id="13891" class="l"><a href="#13891">13891: </a>                        <span class="php-comment">// *** closing html tag</span>
</span><span id="13892" class="l"><a href="#13892">13892: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13893" class="l"><a href="#13893">13893: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>] = <span class="php-keyword2">end</span>(<span class="php-var">$level</span>);
</span><span id="13894" class="l"><a href="#13894">13894: </a>                        <span class="php-keyword2">array_pop</span>(<span class="php-var">$level</span>);
</span><span id="13895" class="l"><a href="#13895">13895: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'fontname'</span>];
</span><span id="13896" class="l"><a href="#13896">13896: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'fontstyle'</span>];
</span><span id="13897" class="l"><a href="#13897">13897: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'fontsize'</span>];
</span><span id="13898" class="l"><a href="#13898">13898: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'stroke'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'stroke'</span>];
</span><span id="13899" class="l"><a href="#13899">13899: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fill'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'fill'</span>];
</span><span id="13900" class="l"><a href="#13900">13900: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'clip'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'clip'</span>];
</span><span id="13901" class="l"><a href="#13901">13901: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'line-height'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'line-height'</span>];
</span><span id="13902" class="l"><a href="#13902">13902: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'bgcolor'</span>];
</span><span id="13903" class="l"><a href="#13903">13903: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'fgcolor'</span>];
</span><span id="13904" class="l"><a href="#13904">13904: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'strokecolor'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'strokecolor'</span>];
</span><span id="13905" class="l"><a href="#13905">13905: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'align'</span>];
</span><span id="13906" class="l"><a href="#13906">13906: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'listtype'</span>])) {
</span><span id="13907" class="l"><a href="#13907">13907: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'listtype'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'listtype'</span>];
</span><span id="13908" class="l"><a href="#13908">13908: </a>                        }
</span><span id="13909" class="l"><a href="#13909">13909: </a>                        <span class="php-comment">// set the number of columns in table tag</span>
</span><span id="13910" class="l"><a href="#13910">13910: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'tr'</span>) <span class="php-keyword1">AND</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'cols'</span>]))) {
</span><span id="13911" class="l"><a href="#13911">13911: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'cols'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'cols'</span>];
</span><span id="13912" class="l"><a href="#13912">13912: </a>                        }
</span><span id="13913" class="l"><a href="#13913">13913: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'td'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'th'</span>)) {
</span><span id="13914" class="l"><a href="#13914">13914: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>] = <span class="php-quote">''</span>;
</span><span id="13915" class="l"><a href="#13915">13915: </a>                            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>] + <span class="php-num">1</span>); <span class="php-var">$i</span> &lt; <span class="php-var">$key</span>; ++<span class="php-var">$i</span>) {
</span><span id="13916" class="l"><a href="#13916">13916: </a>                                <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>] .= <span class="php-var">$a</span>[<span class="php-var">$dom</span>[<span class="php-var">$i</span>][<span class="php-quote">'elkey'</span>]];
</span><span id="13917" class="l"><a href="#13917">13917: </a>                            }
</span><span id="13918" class="l"><a href="#13918">13918: </a>                            <span class="php-var">$key</span> = <span class="php-var">$i</span>;
</span><span id="13919" class="l"><a href="#13919">13919: </a>                            <span class="php-comment">// mark nested tables</span>
</span><span id="13920" class="l"><a href="#13920">13920: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>] = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'&lt;table'</span>, <span class="php-quote">'&lt;table nested=&quot;true&quot;'</span>, <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>]);
</span><span id="13921" class="l"><a href="#13921">13921: </a>                            <span class="php-comment">// remove thead sections from nested tables</span>
</span><span id="13922" class="l"><a href="#13922">13922: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>] = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'&lt;thead&gt;'</span>, <span class="php-quote">''</span>, <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>]);
</span><span id="13923" class="l"><a href="#13923">13923: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>] = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'&lt;/thead&gt;'</span>, <span class="php-quote">''</span>, <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'content'</span>]);
</span><span id="13924" class="l"><a href="#13924">13924: </a>                        }
</span><span id="13925" class="l"><a href="#13925">13925: </a>                        <span class="php-comment">// store header rows on a new table</span>
</span><span id="13926" class="l"><a href="#13926">13926: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'tr'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>] === <span class="php-keyword1">true</span>)) {
</span><span id="13927" class="l"><a href="#13927">13927: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>])) {
</span><span id="13928" class="l"><a href="#13928">13928: </a>                                <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>] = <span class="php-var">$a</span>[<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'elkey'</span>]];
</span><span id="13929" class="l"><a href="#13929">13929: </a>                            }
</span><span id="13930" class="l"><a href="#13930">13930: </a>                            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>]; <span class="php-var">$i</span> &lt;= <span class="php-var">$key</span>; ++<span class="php-var">$i</span>) {
</span><span id="13931" class="l"><a href="#13931">13931: </a>                                <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>] .= <span class="php-var">$a</span>[<span class="php-var">$dom</span>[<span class="php-var">$i</span>][<span class="php-quote">'elkey'</span>]];
</span><span id="13932" class="l"><a href="#13932">13932: </a>                            }
</span><span id="13933" class="l"><a href="#13933">13933: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>])) {
</span><span id="13934" class="l"><a href="#13934">13934: </a>                                <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>] = <span class="php-keyword1">array</span>();
</span><span id="13935" class="l"><a href="#13935">13935: </a>                            }
</span><span id="13936" class="l"><a href="#13936">13936: </a>                            <span class="php-comment">// header elements must be always contained in a single page</span>
</span><span id="13937" class="l"><a href="#13937">13937: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>] = <span class="php-quote">'true'</span>;
</span><span id="13938" class="l"><a href="#13938">13938: </a>                        }
</span><span id="13939" class="l"><a href="#13939">13939: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'table'</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>]))) {
</span><span id="13940" class="l"><a href="#13940">13940: </a>                            <span class="php-comment">// remove the nobr attributes from the table header</span>
</span><span id="13941" class="l"><a href="#13941">13941: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>] = <span class="php-keyword2">str_replace</span>(<span class="php-quote">' nobr=&quot;true&quot;'</span>, <span class="php-quote">''</span>, <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>]);
</span><span id="13942" class="l"><a href="#13942">13942: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'thead'</span>] .= <span class="php-quote">'&lt;/tablehead&gt;'</span>;
</span><span id="13943" class="l"><a href="#13943">13943: </a>                        }
</span><span id="13944" class="l"><a href="#13944">13944: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="13945" class="l"><a href="#13945">13945: </a>                        <span class="php-comment">// *** opening html tag</span>
</span><span id="13946" class="l"><a href="#13946">13946: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>] = <span class="php-keyword1">true</span>;
</span><span id="13947" class="l"><a href="#13947">13947: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>] = <span class="php-keyword2">end</span>(<span class="php-var">$level</span>);
</span><span id="13948" class="l"><a href="#13948">13948: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$element</span>, -<span class="php-num">1</span>, <span class="php-num">1</span>) != <span class="php-quote">'/'</span>) {
</span><span id="13949" class="l"><a href="#13949">13949: </a>                            <span class="php-comment">// not self-closing tag</span>
</span><span id="13950" class="l"><a href="#13950">13950: </a>                            <span class="php-keyword2">array_push</span>(<span class="php-var">$level</span>, <span class="php-var">$key</span>);
</span><span id="13951" class="l"><a href="#13951">13951: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'self'</span>] = <span class="php-keyword1">false</span>;
</span><span id="13952" class="l"><a href="#13952">13952: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="13953" class="l"><a href="#13953">13953: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'self'</span>] = <span class="php-keyword1">true</span>;
</span><span id="13954" class="l"><a href="#13954">13954: </a>                        }
</span><span id="13955" class="l"><a href="#13955">13955: </a>                        <span class="php-comment">// copy some values from parent</span>
</span><span id="13956" class="l"><a href="#13956">13956: </a>                        <span class="php-var">$parentkey</span> = <span class="php-num">0</span>;
</span><span id="13957" class="l"><a href="#13957">13957: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$key</span> &gt; <span class="php-num">0</span>) {
</span><span id="13958" class="l"><a href="#13958">13958: </a>                            <span class="php-var">$parentkey</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>];
</span><span id="13959" class="l"><a href="#13959">13959: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fontname'</span>];
</span><span id="13960" class="l"><a href="#13960">13960: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fontstyle'</span>];
</span><span id="13961" class="l"><a href="#13961">13961: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fontsize'</span>];
</span><span id="13962" class="l"><a href="#13962">13962: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'stroke'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'stroke'</span>];
</span><span id="13963" class="l"><a href="#13963">13963: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fill'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fill'</span>];
</span><span id="13964" class="l"><a href="#13964">13964: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'clip'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'clip'</span>];
</span><span id="13965" class="l"><a href="#13965">13965: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'line-height'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'line-height'</span>];
</span><span id="13966" class="l"><a href="#13966">13966: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'bgcolor'</span>];
</span><span id="13967" class="l"><a href="#13967">13967: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fgcolor'</span>];
</span><span id="13968" class="l"><a href="#13968">13968: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'strokecolor'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'strokecolor'</span>];
</span><span id="13969" class="l"><a href="#13969">13969: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'align'</span>];
</span><span id="13970" class="l"><a href="#13970">13970: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'listtype'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'listtype'</span>];
</span><span id="13971" class="l"><a href="#13971">13971: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'text-indent'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'text-indent'</span>];
</span><span id="13972" class="l"><a href="#13972">13972: </a>                        }
</span><span id="13973" class="l"><a href="#13973">13973: </a>                        <span class="php-comment">// get attributes</span>
</span><span id="13974" class="l"><a href="#13974">13974: </a>                        <span class="php-keyword2">preg_match_all</span>(<span class="php-quote">'/([^=\s]*)=[&quot;]?([^&quot;]*)[&quot;]?/'</span>, <span class="php-var">$element</span>, <span class="php-var">$attr_array</span>, PREG_PATTERN_ORDER);
</span><span id="13975" class="l"><a href="#13975">13975: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>] = <span class="php-keyword1">array</span>(); <span class="php-comment">// reset attribute array</span>
</span><span id="13976" class="l"><a href="#13976">13976: </a>                        <span class="php-keyword1">while</span> (<span class="php-keyword1">list</span>(<span class="php-var">$id</span>, <span class="php-var">$name</span>) = <span class="php-keyword2">each</span>(<span class="php-var">$attr_array</span>[<span class="php-num">1</span>])) {
</span><span id="13977" class="l"><a href="#13977">13977: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-keyword2">strtolower</span>(<span class="php-var">$name</span>)] = <span class="php-var">$attr_array</span>[<span class="php-num">2</span>][<span class="php-var">$id</span>];
</span><span id="13978" class="l"><a href="#13978">13978: </a>                        }
</span><span id="13979" class="l"><a href="#13979">13979: </a>                        <span class="php-comment">// split style attributes</span>
</span><span id="13980" class="l"><a href="#13980">13980: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'style'</span>])) {
</span><span id="13981" class="l"><a href="#13981">13981: </a>                            <span class="php-comment">// get style attributes</span>
</span><span id="13982" class="l"><a href="#13982">13982: </a>                            <span class="php-keyword2">preg_match_all</span>(<span class="php-quote">'/([^;:\s]*):([^;]*)/'</span>, <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'style'</span>], <span class="php-var">$style_array</span>, PREG_PATTERN_ORDER);
</span><span id="13983" class="l"><a href="#13983">13983: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>] = <span class="php-keyword1">array</span>(); <span class="php-comment">// reset style attribute array</span>
</span><span id="13984" class="l"><a href="#13984">13984: </a>                            <span class="php-keyword1">while</span> (<span class="php-keyword1">list</span>(<span class="php-var">$id</span>, <span class="php-var">$name</span>) = <span class="php-keyword2">each</span>(<span class="php-var">$style_array</span>[<span class="php-num">1</span>])) {
</span><span id="13985" class="l"><a href="#13985">13985: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-keyword2">strtolower</span>(<span class="php-var">$name</span>)] = <span class="php-keyword2">trim</span>(<span class="php-var">$style_array</span>[<span class="php-num">2</span>][<span class="php-var">$id</span>]);
</span><span id="13986" class="l"><a href="#13986">13986: </a>                            }
</span><span id="13987" class="l"><a href="#13987">13987: </a>                            <span class="php-comment">// --- get some style attributes ---</span>
</span><span id="13988" class="l"><a href="#13988">13988: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-family'</span>])) {
</span><span id="13989" class="l"><a href="#13989">13989: </a>                                <span class="php-comment">// font family</span>
</span><span id="13990" class="l"><a href="#13990">13990: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-family'</span>])) {
</span><span id="13991" class="l"><a href="#13991">13991: </a>                                    <span class="php-var">$fontslist</span> = <span class="php-keyword2">preg_split</span>(<span class="php-quote">'/[,]/'</span>, <span class="php-keyword2">strtolower</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-family'</span>]));
</span><span id="13992" class="l"><a href="#13992">13992: </a>                                    <span class="php-keyword1">foreach</span> (<span class="php-var">$fontslist</span> <span class="php-keyword1">as</span> <span class="php-var">$font</span>) {
</span><span id="13993" class="l"><a href="#13993">13993: </a>                                        <span class="php-var">$font</span> = <span class="php-keyword2">trim</span>(<span class="php-keyword2">strtolower</span>(<span class="php-var">$font</span>));
</span><span id="13994" class="l"><a href="#13994">13994: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontlist) <span class="php-keyword1">OR</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys)) {
</span><span id="13995" class="l"><a href="#13995">13995: </a>                                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>] = <span class="php-var">$font</span>;
</span><span id="13996" class="l"><a href="#13996">13996: </a>                                            <span class="php-keyword1">break</span>;
</span><span id="13997" class="l"><a href="#13997">13997: </a>                                        }
</span><span id="13998" class="l"><a href="#13998">13998: </a>                                    }
</span><span id="13999" class="l"><a href="#13999">13999: </a>                                }
</span><span id="14000" class="l"><a href="#14000">14000: </a>                            }
</span><span id="14001" class="l"><a href="#14001">14001: </a>                            <span class="php-comment">// list-style-type</span>
</span><span id="14002" class="l"><a href="#14002">14002: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'list-style-type'</span>])) {
</span><span id="14003" class="l"><a href="#14003">14003: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'listtype'</span>] = <span class="php-keyword2">trim</span>(<span class="php-keyword2">strtolower</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'list-style-type'</span>]));
</span><span id="14004" class="l"><a href="#14004">14004: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'listtype'</span>] == <span class="php-quote">'inherit'</span>) {
</span><span id="14005" class="l"><a href="#14005">14005: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'listtype'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'listtype'</span>];
</span><span id="14006" class="l"><a href="#14006">14006: </a>                                }
</span><span id="14007" class="l"><a href="#14007">14007: </a>                            }
</span><span id="14008" class="l"><a href="#14008">14008: </a>                            <span class="php-comment">// text-indent</span>
</span><span id="14009" class="l"><a href="#14009">14009: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'text-indent'</span>])) {
</span><span id="14010" class="l"><a href="#14010">14010: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'text-indent'</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'text-indent'</span>]);
</span><span id="14011" class="l"><a href="#14011">14011: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'text-indent'</span>] == <span class="php-quote">'inherit'</span>) {
</span><span id="14012" class="l"><a href="#14012">14012: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'text-indent'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'text-indent'</span>];
</span><span id="14013" class="l"><a href="#14013">14013: </a>                                }
</span><span id="14014" class="l"><a href="#14014">14014: </a>                            }
</span><span id="14015" class="l"><a href="#14015">14015: </a>                            <span class="php-comment">// font size</span>
</span><span id="14016" class="l"><a href="#14016">14016: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-size'</span>])) {
</span><span id="14017" class="l"><a href="#14017">14017: </a>                                <span class="php-var">$fsize</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-size'</span>]);
</span><span id="14018" class="l"><a href="#14018">14018: </a>                                <span class="php-keyword1">switch</span> (<span class="php-var">$fsize</span>) {
</span><span id="14019" class="l"><a href="#14019">14019: </a>                                    <span class="php-comment">// absolute-size</span>
</span><span id="14020" class="l"><a href="#14020">14020: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'xx-small'</span>: {
</span><span id="14021" class="l"><a href="#14021">14021: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>] - <span class="php-num">4</span>;
</span><span id="14022" class="l"><a href="#14022">14022: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14023" class="l"><a href="#14023">14023: </a>                                    }
</span><span id="14024" class="l"><a href="#14024">14024: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'x-small'</span>: {
</span><span id="14025" class="l"><a href="#14025">14025: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>] - <span class="php-num">3</span>;
</span><span id="14026" class="l"><a href="#14026">14026: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14027" class="l"><a href="#14027">14027: </a>                                    }
</span><span id="14028" class="l"><a href="#14028">14028: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'small'</span>: {
</span><span id="14029" class="l"><a href="#14029">14029: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>] - <span class="php-num">2</span>;
</span><span id="14030" class="l"><a href="#14030">14030: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14031" class="l"><a href="#14031">14031: </a>                                    }
</span><span id="14032" class="l"><a href="#14032">14032: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'medium'</span>: {
</span><span id="14033" class="l"><a href="#14033">14033: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>];
</span><span id="14034" class="l"><a href="#14034">14034: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14035" class="l"><a href="#14035">14035: </a>                                    }
</span><span id="14036" class="l"><a href="#14036">14036: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'large'</span>: {
</span><span id="14037" class="l"><a href="#14037">14037: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>] + <span class="php-num">2</span>;
</span><span id="14038" class="l"><a href="#14038">14038: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14039" class="l"><a href="#14039">14039: </a>                                    }
</span><span id="14040" class="l"><a href="#14040">14040: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'x-large'</span>: {
</span><span id="14041" class="l"><a href="#14041">14041: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>] + <span class="php-num">4</span>;
</span><span id="14042" class="l"><a href="#14042">14042: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14043" class="l"><a href="#14043">14043: </a>                                    }
</span><span id="14044" class="l"><a href="#14044">14044: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'xx-large'</span>: {
</span><span id="14045" class="l"><a href="#14045">14045: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>] + <span class="php-num">6</span>;
</span><span id="14046" class="l"><a href="#14046">14046: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14047" class="l"><a href="#14047">14047: </a>                                    }
</span><span id="14048" class="l"><a href="#14048">14048: </a>                                    <span class="php-comment">// relative-size</span>
</span><span id="14049" class="l"><a href="#14049">14049: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'smaller'</span>: {
</span><span id="14050" class="l"><a href="#14050">14050: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fontsize'</span>] - <span class="php-num">3</span>;
</span><span id="14051" class="l"><a href="#14051">14051: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14052" class="l"><a href="#14052">14052: </a>                                    }
</span><span id="14053" class="l"><a href="#14053">14053: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'larger'</span>: {
</span><span id="14054" class="l"><a href="#14054">14054: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fontsize'</span>] + <span class="php-num">3</span>;
</span><span id="14055" class="l"><a href="#14055">14055: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14056" class="l"><a href="#14056">14056: </a>                                    }
</span><span id="14057" class="l"><a href="#14057">14057: </a>                                    <span class="php-keyword1">default</span>: {
</span><span id="14058" class="l"><a href="#14058">14058: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$fsize</span>, <span class="php-var">$dom</span>[<span class="php-var">$parentkey</span>][<span class="php-quote">'fontsize'</span>], <span class="php-quote">'pt'</span>, <span class="php-keyword1">true</span>);
</span><span id="14059" class="l"><a href="#14059">14059: </a>                                    }
</span><span id="14060" class="l"><a href="#14060">14060: </a>                                }
</span><span id="14061" class="l"><a href="#14061">14061: </a>                            }
</span><span id="14062" class="l"><a href="#14062">14062: </a>                            <span class="php-comment">// line-height</span>
</span><span id="14063" class="l"><a href="#14063">14063: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'line-height'</span>])) {
</span><span id="14064" class="l"><a href="#14064">14064: </a>                                <span class="php-var">$lineheight</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'line-height'</span>]);
</span><span id="14065" class="l"><a href="#14065">14065: </a>                                <span class="php-keyword1">switch</span> (<span class="php-var">$lineheight</span>) {
</span><span id="14066" class="l"><a href="#14066">14066: </a>                                    <span class="php-comment">// A normal line height. This is default</span>
</span><span id="14067" class="l"><a href="#14067">14067: </a>                                    <span class="php-keyword1">case</span> <span class="php-quote">'normal'</span>: {
</span><span id="14068" class="l"><a href="#14068">14068: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'line-height'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'line-height'</span>];
</span><span id="14069" class="l"><a href="#14069">14069: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14070" class="l"><a href="#14070">14070: </a>                                    }
</span><span id="14071" class="l"><a href="#14071">14071: </a>                                    <span class="php-keyword1">default</span>: {
</span><span id="14072" class="l"><a href="#14072">14072: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword2">is_numeric</span>(<span class="php-var">$lineheight</span>)) {
</span><span id="14073" class="l"><a href="#14073">14073: </a>                                            <span class="php-var">$lineheight</span> = <span class="php-var">$lineheight</span> * <span class="php-num">100</span>;
</span><span id="14074" class="l"><a href="#14074">14074: </a>                                        }
</span><span id="14075" class="l"><a href="#14075">14075: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'line-height'</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$lineheight</span>, <span class="php-num">1</span>, <span class="php-quote">'%'</span>, <span class="php-keyword1">true</span>);
</span><span id="14076" class="l"><a href="#14076">14076: </a>                                    }
</span><span id="14077" class="l"><a href="#14077">14077: </a>                                }
</span><span id="14078" class="l"><a href="#14078">14078: </a>                            }
</span><span id="14079" class="l"><a href="#14079">14079: </a>                            <span class="php-comment">// font style</span>
</span><span id="14080" class="l"><a href="#14080">14080: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-weight'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">strtolower</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-weight'</span>]{<span class="php-num">0</span>}) == <span class="php-quote">'b'</span>)) {
</span><span id="14081" class="l"><a href="#14081">14081: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'B'</span>;
</span><span id="14082" class="l"><a href="#14082">14082: </a>                            }
</span><span id="14083" class="l"><a href="#14083">14083: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-style'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">strtolower</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'font-style'</span>]{<span class="php-num">0</span>}) == <span class="php-quote">'i'</span>)) {
</span><span id="14084" class="l"><a href="#14084">14084: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'I'</span>;
</span><span id="14085" class="l"><a href="#14085">14085: </a>                            }
</span><span id="14086" class="l"><a href="#14086">14086: </a>                            <span class="php-comment">// font color</span>
</span><span id="14087" class="l"><a href="#14087">14087: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'color'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'color'</span>]))) {
</span><span id="14088" class="l"><a href="#14088">14088: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'color'</span>]);
</span><span id="14089" class="l"><a href="#14089">14089: </a>                            }
</span><span id="14090" class="l"><a href="#14090">14090: </a>                            <span class="php-comment">// background color</span>
</span><span id="14091" class="l"><a href="#14091">14091: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'background-color'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'background-color'</span>]))) {
</span><span id="14092" class="l"><a href="#14092">14092: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'background-color'</span>]);
</span><span id="14093" class="l"><a href="#14093">14093: </a>                            }
</span><span id="14094" class="l"><a href="#14094">14094: </a>                            <span class="php-comment">// text-decoration</span>
</span><span id="14095" class="l"><a href="#14095">14095: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'text-decoration'</span>])) {
</span><span id="14096" class="l"><a href="#14096">14096: </a>                                <span class="php-var">$decors</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-keyword2">strtolower</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'text-decoration'</span>]));
</span><span id="14097" class="l"><a href="#14097">14097: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$decors</span> <span class="php-keyword1">as</span> <span class="php-var">$dec</span>) {
</span><span id="14098" class="l"><a href="#14098">14098: </a>                                    <span class="php-var">$dec</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$dec</span>);
</span><span id="14099" class="l"><a href="#14099">14099: </a>                                    <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dec</span>)) {
</span><span id="14100" class="l"><a href="#14100">14100: </a>                                        <span class="php-keyword1">if</span> (<span class="php-var">$dec</span>{<span class="php-num">0</span>} == <span class="php-quote">'u'</span>) {
</span><span id="14101" class="l"><a href="#14101">14101: </a>                                            <span class="php-comment">// underline</span>
</span><span id="14102" class="l"><a href="#14102">14102: </a>                                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'U'</span>;
</span><span id="14103" class="l"><a href="#14103">14103: </a>                                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$dec</span>{<span class="php-num">0</span>} == <span class="php-quote">'l'</span>) {
</span><span id="14104" class="l"><a href="#14104">14104: </a>                                            <span class="php-comment">// line-trough</span>
</span><span id="14105" class="l"><a href="#14105">14105: </a>                                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'D'</span>;
</span><span id="14106" class="l"><a href="#14106">14106: </a>                                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$dec</span>{<span class="php-num">0</span>} == <span class="php-quote">'o'</span>) {
</span><span id="14107" class="l"><a href="#14107">14107: </a>                                            <span class="php-comment">// overline</span>
</span><span id="14108" class="l"><a href="#14108">14108: </a>                                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'O'</span>;
</span><span id="14109" class="l"><a href="#14109">14109: </a>                                        }
</span><span id="14110" class="l"><a href="#14110">14110: </a>                                    }
</span><span id="14111" class="l"><a href="#14111">14111: </a>                                }
</span><span id="14112" class="l"><a href="#14112">14112: </a>                            }
</span><span id="14113" class="l"><a href="#14113">14113: </a>                            <span class="php-comment">// check for width attribute</span>
</span><span id="14114" class="l"><a href="#14114">14114: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'width'</span>])) {
</span><span id="14115" class="l"><a href="#14115">14115: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'width'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'width'</span>];
</span><span id="14116" class="l"><a href="#14116">14116: </a>                            }
</span><span id="14117" class="l"><a href="#14117">14117: </a>                            <span class="php-comment">// check for height attribute</span>
</span><span id="14118" class="l"><a href="#14118">14118: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'height'</span>])) {
</span><span id="14119" class="l"><a href="#14119">14119: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'height'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'height'</span>];
</span><span id="14120" class="l"><a href="#14120">14120: </a>                            }
</span><span id="14121" class="l"><a href="#14121">14121: </a>                            <span class="php-comment">// check for text alignment</span>
</span><span id="14122" class="l"><a href="#14122">14122: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'text-align'</span>])) {
</span><span id="14123" class="l"><a href="#14123">14123: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = <span class="php-keyword2">strtoupper</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'text-align'</span>]{<span class="php-num">0</span>});
</span><span id="14124" class="l"><a href="#14124">14124: </a>                            }
</span><span id="14125" class="l"><a href="#14125">14125: </a>                            <span class="php-comment">// check for border attribute</span>
</span><span id="14126" class="l"><a href="#14126">14126: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'border'</span>])) {
</span><span id="14127" class="l"><a href="#14127">14127: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'border'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'border'</span>];
</span><span id="14128" class="l"><a href="#14128">14128: </a>                            }
</span><span id="14129" class="l"><a href="#14129">14129: </a>                            <span class="php-comment">// page-break-inside</span>
</span><span id="14130" class="l"><a href="#14130">14130: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-inside'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-inside'</span>] == <span class="php-quote">'avoid'</span>)) {
</span><span id="14131" class="l"><a href="#14131">14131: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>] = <span class="php-quote">'true'</span>;
</span><span id="14132" class="l"><a href="#14132">14132: </a>                            }
</span><span id="14133" class="l"><a href="#14133">14133: </a>                            <span class="php-comment">// page-break-before</span>
</span><span id="14134" class="l"><a href="#14134">14134: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-before'</span>])) {
</span><span id="14135" class="l"><a href="#14135">14135: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-before'</span>] == <span class="php-quote">'always'</span>) {
</span><span id="14136" class="l"><a href="#14136">14136: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] = <span class="php-quote">'true'</span>;
</span><span id="14137" class="l"><a href="#14137">14137: </a>                                } <span class="php-keyword1">elseif</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-before'</span>] == <span class="php-quote">'left'</span>) {
</span><span id="14138" class="l"><a href="#14138">14138: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] = <span class="php-quote">'left'</span>;
</span><span id="14139" class="l"><a href="#14139">14139: </a>                                } <span class="php-keyword1">elseif</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-before'</span>] == <span class="php-quote">'right'</span>) {
</span><span id="14140" class="l"><a href="#14140">14140: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] = <span class="php-quote">'right'</span>;
</span><span id="14141" class="l"><a href="#14141">14141: </a>                                }
</span><span id="14142" class="l"><a href="#14142">14142: </a>                            }
</span><span id="14143" class="l"><a href="#14143">14143: </a>                            <span class="php-comment">// page-break-after</span>
</span><span id="14144" class="l"><a href="#14144">14144: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-after'</span>])) {
</span><span id="14145" class="l"><a href="#14145">14145: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-after'</span>] == <span class="php-quote">'always'</span>) {
</span><span id="14146" class="l"><a href="#14146">14146: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreakafter'</span>] = <span class="php-quote">'true'</span>;
</span><span id="14147" class="l"><a href="#14147">14147: </a>                                } <span class="php-keyword1">elseif</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-after'</span>] == <span class="php-quote">'left'</span>) {
</span><span id="14148" class="l"><a href="#14148">14148: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreakafter'</span>] = <span class="php-quote">'left'</span>;
</span><span id="14149" class="l"><a href="#14149">14149: </a>                                } <span class="php-keyword1">elseif</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'style'</span>][<span class="php-quote">'page-break-after'</span>] == <span class="php-quote">'right'</span>) {
</span><span id="14150" class="l"><a href="#14150">14150: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreakafter'</span>] = <span class="php-quote">'right'</span>;
</span><span id="14151" class="l"><a href="#14151">14151: </a>                                }
</span><span id="14152" class="l"><a href="#14152">14152: </a>                            }
</span><span id="14153" class="l"><a href="#14153">14153: </a>                        }
</span><span id="14154" class="l"><a href="#14154">14154: </a>                        <span class="php-comment">// check for font tag</span>
</span><span id="14155" class="l"><a href="#14155">14155: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'font'</span>) {
</span><span id="14156" class="l"><a href="#14156">14156: </a>                            <span class="php-comment">// font family</span>
</span><span id="14157" class="l"><a href="#14157">14157: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'face'</span>])) {
</span><span id="14158" class="l"><a href="#14158">14158: </a>                                <span class="php-var">$fontslist</span> = <span class="php-keyword2">preg_split</span>(<span class="php-quote">'/[,]/'</span>, <span class="php-keyword2">strtolower</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'face'</span>]));
</span><span id="14159" class="l"><a href="#14159">14159: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$fontslist</span> <span class="php-keyword1">as</span> <span class="php-var">$font</span>) {
</span><span id="14160" class="l"><a href="#14160">14160: </a>                                    <span class="php-var">$font</span> = <span class="php-keyword2">trim</span>(<span class="php-keyword2">strtolower</span>(<span class="php-var">$font</span>));
</span><span id="14161" class="l"><a href="#14161">14161: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontlist) <span class="php-keyword1">OR</span> <span class="php-keyword2">in_array</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys)) {
</span><span id="14162" class="l"><a href="#14162">14162: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>] = <span class="php-var">$font</span>;
</span><span id="14163" class="l"><a href="#14163">14163: </a>                                        <span class="php-keyword1">break</span>;
</span><span id="14164" class="l"><a href="#14164">14164: </a>                                    }
</span><span id="14165" class="l"><a href="#14165">14165: </a>                                }
</span><span id="14166" class="l"><a href="#14166">14166: </a>                            }
</span><span id="14167" class="l"><a href="#14167">14167: </a>                            <span class="php-comment">// font size</span>
</span><span id="14168" class="l"><a href="#14168">14168: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>])) {
</span><span id="14169" class="l"><a href="#14169">14169: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$key</span> &gt; <span class="php-num">0</span>) {
</span><span id="14170" class="l"><a href="#14170">14170: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>]{<span class="php-num">0</span>} == <span class="php-quote">'+'</span>) {
</span><span id="14171" class="l"><a href="#14171">14171: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'fontsize'</span>] + <span class="php-keyword2">intval</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>], <span class="php-num">1</span>));
</span><span id="14172" class="l"><a href="#14172">14172: </a>                                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>]{<span class="php-num">0</span>} == <span class="php-quote">'-'</span>) {
</span><span id="14173" class="l"><a href="#14173">14173: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'fontsize'</span>] - <span class="php-keyword2">intval</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>], <span class="php-num">1</span>));
</span><span id="14174" class="l"><a href="#14174">14174: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="14175" class="l"><a href="#14175">14175: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-keyword2">intval</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>]);
</span><span id="14176" class="l"><a href="#14176">14176: </a>                                    }
</span><span id="14177" class="l"><a href="#14177">14177: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="14178" class="l"><a href="#14178">14178: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-keyword2">intval</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>]);
</span><span id="14179" class="l"><a href="#14179">14179: </a>                                }
</span><span id="14180" class="l"><a href="#14180">14180: </a>                            }
</span><span id="14181" class="l"><a href="#14181">14181: </a>                        }
</span><span id="14182" class="l"><a href="#14182">14182: </a>                        <span class="php-comment">// force natural alignment for lists</span>
</span><span id="14183" class="l"><a href="#14183">14183: </a>                        <span class="php-keyword1">if</span> (((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'ul'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'ol'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'dl'</span>))
</span><span id="14184" class="l"><a href="#14184">14184: </a>                            <span class="php-keyword1">AND</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>]) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>]) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] != <span class="php-quote">'J'</span>))) {
</span><span id="14185" class="l"><a href="#14185">14185: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="14186" class="l"><a href="#14186">14186: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = <span class="php-quote">'R'</span>;
</span><span id="14187" class="l"><a href="#14187">14187: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="14188" class="l"><a href="#14188">14188: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = <span class="php-quote">'L'</span>;
</span><span id="14189" class="l"><a href="#14189">14189: </a>                            }
</span><span id="14190" class="l"><a href="#14190">14190: </a>                        }
</span><span id="14191" class="l"><a href="#14191">14191: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'small'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'sup'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'sub'</span>)) {
</span><span id="14192" class="l"><a href="#14192">14192: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] * K_SMALL_RATIO;
</span><span id="14193" class="l"><a href="#14193">14193: </a>                        }
</span><span id="14194" class="l"><a href="#14194">14194: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'strong'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'b'</span>)) {
</span><span id="14195" class="l"><a href="#14195">14195: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'B'</span>;
</span><span id="14196" class="l"><a href="#14196">14196: </a>                        }
</span><span id="14197" class="l"><a href="#14197">14197: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'em'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'i'</span>)) {
</span><span id="14198" class="l"><a href="#14198">14198: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'I'</span>;
</span><span id="14199" class="l"><a href="#14199">14199: </a>                        }
</span><span id="14200" class="l"><a href="#14200">14200: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'u'</span>) {
</span><span id="14201" class="l"><a href="#14201">14201: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'U'</span>;
</span><span id="14202" class="l"><a href="#14202">14202: </a>                        }
</span><span id="14203" class="l"><a href="#14203">14203: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'del'</span>) {
</span><span id="14204" class="l"><a href="#14204">14204: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'D'</span>;
</span><span id="14205" class="l"><a href="#14205">14205: </a>                        }
</span><span id="14206" class="l"><a href="#14206">14206: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'pre'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'tt'</span>)) {
</span><span id="14207" class="l"><a href="#14207">14207: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>] = <span class="php-var">$this</span>-&gt;default_monospaced_font;
</span><span id="14208" class="l"><a href="#14208">14208: </a>                        }
</span><span id="14209" class="l"><a href="#14209">14209: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]{<span class="php-num">0</span>} == <span class="php-quote">'h'</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">intval</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]{<span class="php-num">1</span>}) &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">intval</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]{<span class="php-num">1</span>}) &lt; <span class="php-num">7</span>)) {
</span><span id="14210" class="l"><a href="#14210">14210: </a>                            <span class="php-var">$headsize</span> = (<span class="php-num">4</span> - <span class="php-keyword2">intval</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]{<span class="php-num">1</span>})) * <span class="php-num">2</span>;
</span><span id="14211" class="l"><a href="#14211">14211: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] = <span class="php-var">$dom</span>[<span class="php-num">0</span>][<span class="php-quote">'fontsize'</span>] + <span class="php-var">$headsize</span>;
</span><span id="14212" class="l"><a href="#14212">14212: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] .= <span class="php-quote">'B'</span>;
</span><span id="14213" class="l"><a href="#14213">14213: </a>                        }
</span><span id="14214" class="l"><a href="#14214">14214: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'table'</span>)) {
</span><span id="14215" class="l"><a href="#14215">14215: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'rows'</span>] = <span class="php-num">0</span>; <span class="php-comment">// number of rows</span>
</span><span id="14216" class="l"><a href="#14216">14216: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'trids'</span>] = <span class="php-keyword1">array</span>(); <span class="php-comment">// IDs of TR elements</span>
</span><span id="14217" class="l"><a href="#14217">14217: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>] = <span class="php-quote">''</span>; <span class="php-comment">// table header rows</span>
</span><span id="14218" class="l"><a href="#14218">14218: </a>                        }
</span><span id="14219" class="l"><a href="#14219">14219: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'tr'</span>)) {
</span><span id="14220" class="l"><a href="#14220">14220: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'cols'</span>] = <span class="php-num">0</span>;
</span><span id="14221" class="l"><a href="#14221">14221: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$thead</span>) {
</span><span id="14222" class="l"><a href="#14222">14222: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>] = <span class="php-keyword1">true</span>;
</span><span id="14223" class="l"><a href="#14223">14223: </a>                                <span class="php-comment">// rows on thead block are printed as a separate table</span>
</span><span id="14224" class="l"><a href="#14224">14224: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="14225" class="l"><a href="#14225">14225: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>] = <span class="php-keyword1">false</span>;
</span><span id="14226" class="l"><a href="#14226">14226: </a>                                <span class="php-comment">// store the number of rows on table element</span>
</span><span id="14227" class="l"><a href="#14227">14227: </a>                                ++<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rows'</span>];
</span><span id="14228" class="l"><a href="#14228">14228: </a>                                <span class="php-comment">// store the TR elements IDs on table element</span>
</span><span id="14229" class="l"><a href="#14229">14229: </a>                                <span class="php-keyword2">array_push</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'trids'</span>], <span class="php-var">$key</span>);
</span><span id="14230" class="l"><a href="#14230">14230: </a>                            }
</span><span id="14231" class="l"><a href="#14231">14231: </a>                        }
</span><span id="14232" class="l"><a href="#14232">14232: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'th'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'td'</span>)) {
</span><span id="14233" class="l"><a href="#14233">14233: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'colspan'</span>])) {
</span><span id="14234" class="l"><a href="#14234">14234: </a>                                <span class="php-var">$colspan</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'colspan'</span>]);
</span><span id="14235" class="l"><a href="#14235">14235: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="14236" class="l"><a href="#14236">14236: </a>                                <span class="php-var">$colspan</span> = <span class="php-num">1</span>;
</span><span id="14237" class="l"><a href="#14237">14237: </a>                            }
</span><span id="14238" class="l"><a href="#14238">14238: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'colspan'</span>] = <span class="php-var">$colspan</span>;
</span><span id="14239" class="l"><a href="#14239">14239: </a>                            <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'cols'</span>] += <span class="php-var">$colspan</span>;
</span><span id="14240" class="l"><a href="#14240">14240: </a>                        }
</span><span id="14241" class="l"><a href="#14241">14241: </a>                        <span class="php-comment">// set foreground color attribute</span>
</span><span id="14242" class="l"><a href="#14242">14242: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'color'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'color'</span>]))) {
</span><span id="14243" class="l"><a href="#14243">14243: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'color'</span>]);
</span><span id="14244" class="l"><a href="#14244">14244: </a>                        }
</span><span id="14245" class="l"><a href="#14245">14245: </a>                        <span class="php-comment">// set background color attribute</span>
</span><span id="14246" class="l"><a href="#14246">14246: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'bgcolor'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'bgcolor'</span>]))) {
</span><span id="14247" class="l"><a href="#14247">14247: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'bgcolor'</span>]);
</span><span id="14248" class="l"><a href="#14248">14248: </a>                        }
</span><span id="14249" class="l"><a href="#14249">14249: </a>                        <span class="php-comment">// set stroke color attribute</span>
</span><span id="14250" class="l"><a href="#14250">14250: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'strokecolor'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'strokecolor'</span>]))) {
</span><span id="14251" class="l"><a href="#14251">14251: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'strokecolor'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'strokecolor'</span>]);
</span><span id="14252" class="l"><a href="#14252">14252: </a>                        }
</span><span id="14253" class="l"><a href="#14253">14253: </a>                        <span class="php-comment">// check for width attribute</span>
</span><span id="14254" class="l"><a href="#14254">14254: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>])) {
</span><span id="14255" class="l"><a href="#14255">14255: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'width'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>];
</span><span id="14256" class="l"><a href="#14256">14256: </a>                        }
</span><span id="14257" class="l"><a href="#14257">14257: </a>                        <span class="php-comment">// check for height attribute</span>
</span><span id="14258" class="l"><a href="#14258">14258: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>])) {
</span><span id="14259" class="l"><a href="#14259">14259: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'height'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>];
</span><span id="14260" class="l"><a href="#14260">14260: </a>                        }
</span><span id="14261" class="l"><a href="#14261">14261: </a>                        <span class="php-comment">// check for text alignment</span>
</span><span id="14262" class="l"><a href="#14262">14262: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'align'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'align'</span>])) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] !== <span class="php-quote">'img'</span>)) {
</span><span id="14263" class="l"><a href="#14263">14263: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = <span class="php-keyword2">strtoupper</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'align'</span>]{<span class="php-num">0</span>});
</span><span id="14264" class="l"><a href="#14264">14264: </a>                        }
</span><span id="14265" class="l"><a href="#14265">14265: </a>                        <span class="php-comment">// check for text rendering mode (the following attributes do not exist in HTML)</span>
</span><span id="14266" class="l"><a href="#14266">14266: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'stroke'</span>])) {
</span><span id="14267" class="l"><a href="#14267">14267: </a>                            <span class="php-comment">// font stroke width</span>
</span><span id="14268" class="l"><a href="#14268">14268: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'stroke'</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'stroke'</span>], <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>], <span class="php-quote">'pt'</span>, <span class="php-keyword1">true</span>);
</span><span id="14269" class="l"><a href="#14269">14269: </a>                        }
</span><span id="14270" class="l"><a href="#14270">14270: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'fill'</span>])) {
</span><span id="14271" class="l"><a href="#14271">14271: </a>                            <span class="php-comment">// font fill</span>
</span><span id="14272" class="l"><a href="#14272">14272: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'fill'</span>] == <span class="php-quote">'true'</span>) {
</span><span id="14273" class="l"><a href="#14273">14273: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fill'</span>] = <span class="php-keyword1">true</span>;
</span><span id="14274" class="l"><a href="#14274">14274: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="14275" class="l"><a href="#14275">14275: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fill'</span>] = <span class="php-keyword1">false</span>;
</span><span id="14276" class="l"><a href="#14276">14276: </a>                            }
</span><span id="14277" class="l"><a href="#14277">14277: </a>                        }
</span><span id="14278" class="l"><a href="#14278">14278: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'clip'</span>])) {
</span><span id="14279" class="l"><a href="#14279">14279: </a>                            <span class="php-comment">// clipping mode</span>
</span><span id="14280" class="l"><a href="#14280">14280: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'clip'</span>] == <span class="php-quote">'true'</span>) {
</span><span id="14281" class="l"><a href="#14281">14281: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'clip'</span>] = <span class="php-keyword1">true</span>;
</span><span id="14282" class="l"><a href="#14282">14282: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="14283" class="l"><a href="#14283">14283: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'clip'</span>] = <span class="php-keyword1">false</span>;
</span><span id="14284" class="l"><a href="#14284">14284: </a>                            }
</span><span id="14285" class="l"><a href="#14285">14285: </a>                        }
</span><span id="14286" class="l"><a href="#14286">14286: </a>                    } <span class="php-comment">// end opening tag</span>
</span><span id="14287" class="l"><a href="#14287">14287: </a>                } <span class="php-keyword1">else</span> {
</span><span id="14288" class="l"><a href="#14288">14288: </a>                    <span class="php-comment">// text</span>
</span><span id="14289" class="l"><a href="#14289">14289: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] = <span class="php-keyword1">false</span>;
</span><span id="14290" class="l"><a href="#14290">14290: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'block'</span>] = <span class="php-keyword1">false</span>;
</span><span id="14291" class="l"><a href="#14291">14291: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-keyword2">stripslashes</span>(<span class="php-var">$this</span>-&gt;unhtmlentities(<span class="php-var">$element</span>));
</span><span id="14292" class="l"><a href="#14292">14292: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>] = <span class="php-keyword2">end</span>(<span class="php-var">$level</span>);
</span><span id="14293" class="l"><a href="#14293">14293: </a>                }
</span><span id="14294" class="l"><a href="#14294">14294: </a>                ++<span class="php-var">$elkey</span>;
</span><span id="14295" class="l"><a href="#14295">14295: </a>                ++<span class="php-var">$key</span>;
</span><span id="14296" class="l"><a href="#14296">14296: </a>            }
</span><span id="14297" class="l"><a href="#14297">14297: </a>            <span class="php-keyword1">return</span> <span class="php-var">$dom</span>;
</span><span id="14298" class="l"><a href="#14298">14298: </a>        }
</span><span id="14299" class="l"><a href="#14299">14299: </a>
</span><span id="14300" class="l"><a href="#14300">14300: </a>        <span class="php-comment">/**
</span></span><span id="14301" class="l"><a href="#14301">14301: </a><span class="php-comment">         * Returns the string used to find spaces
</span></span><span id="14302" class="l"><a href="#14302">14302: </a><span class="php-comment">         * @return string
</span></span><span id="14303" class="l"><a href="#14303">14303: </a><span class="php-comment">         * @access protected
</span></span><span id="14304" class="l"><a href="#14304">14304: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="14305" class="l"><a href="#14305">14305: </a><span class="php-comment">         * @since 4.8.024 (2010-01-15)
</span></span><span id="14306" class="l"><a href="#14306">14306: </a><span class="php-comment">         */</span>
</span><span id="14307" class="l"><a href="#14307">14307: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getSpaceString() {
</span><span id="14308" class="l"><a href="#14308">14308: </a>            <span class="php-var">$spacestr</span> = <span class="php-keyword2">chr</span>(<span class="php-num">32</span>);
</span><span id="14309" class="l"><a href="#14309">14309: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="14310" class="l"><a href="#14310">14310: </a>                <span class="php-var">$spacestr</span> = <span class="php-keyword2">chr</span>(<span class="php-num">0</span>).<span class="php-keyword2">chr</span>(<span class="php-num">32</span>);
</span><span id="14311" class="l"><a href="#14311">14311: </a>            }
</span><span id="14312" class="l"><a href="#14312">14312: </a>            <span class="php-keyword1">return</span> <span class="php-var">$spacestr</span>;
</span><span id="14313" class="l"><a href="#14313">14313: </a>        }
</span><span id="14314" class="l"><a href="#14314">14314: </a>
</span><span id="14315" class="l"><a href="#14315">14315: </a>        <span class="php-comment">/**
</span></span><span id="14316" class="l"><a href="#14316">14316: </a><span class="php-comment">         * Allows to preserve some HTML formatting (limited support).&lt;br /&gt;
</span></span><span id="14317" class="l"><a href="#14317">14317: </a><span class="php-comment">         * IMPORTANT: The HTML must be well formatted - try to clean-up it using an application like HTML-Tidy before submitting.
</span></span><span id="14318" class="l"><a href="#14318">14318: </a><span class="php-comment">         * Supported tags are: a, b, blockquote, br, dd, del, div, dl, dt, em, font, h1, h2, h3, h4, h5, h6, hr, i, img, li, ol, p, pre, small, span, strong, sub, sup, table, tcpdf, td, th, thead, tr, tt, u, ul
</span></span><span id="14319" class="l"><a href="#14319">14319: </a><span class="php-comment">         * @param string $html text to display
</span></span><span id="14320" class="l"><a href="#14320">14320: </a><span class="php-comment">         * @param boolean $ln if true add a new line after text (default = true)
</span></span><span id="14321" class="l"><a href="#14321">14321: </a><span class="php-comment">         * @param int $fill Indicates if the background must be painted (true) or transparent (false).
</span></span><span id="14322" class="l"><a href="#14322">14322: </a><span class="php-comment">         * @param boolean $reseth if true reset the last cell height (default false).
</span></span><span id="14323" class="l"><a href="#14323">14323: </a><span class="php-comment">         * @param boolean $cell if true add the default cMargin space to each Write (default false).
</span></span><span id="14324" class="l"><a href="#14324">14324: </a><span class="php-comment">         * @param string $align Allows to center or align the text. Possible values are:&lt;ul&gt;&lt;li&gt;L : left align&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;R : right align&lt;/li&gt;&lt;li&gt;'' : empty string : left for LTR or right for RTL&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="14325" class="l"><a href="#14325">14325: </a><span class="php-comment">         * @access public
</span></span><span id="14326" class="l"><a href="#14326">14326: </a><span class="php-comment">         */</span>
</span><span id="14327" class="l"><a href="#14327">14327: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> writeHTML(<span class="php-var">$html</span>, <span class="php-var">$ln</span>=<span class="php-keyword1">true</span>, <span class="php-var">$fill</span>=<span class="php-keyword1">false</span>, <span class="php-var">$reseth</span>=<span class="php-keyword1">false</span>, <span class="php-var">$cell</span>=<span class="php-keyword1">false</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>) {
</span><span id="14328" class="l"><a href="#14328">14328: </a>            <span class="php-var">$gvars</span> = <span class="php-var">$this</span>-&gt;getGraphicVars();
</span><span id="14329" class="l"><a href="#14329">14329: </a>            <span class="php-comment">// store current values</span>
</span><span id="14330" class="l"><a href="#14330">14330: </a>            <span class="php-var">$prevPage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="14331" class="l"><a href="#14331">14331: </a>            <span class="php-var">$prevlMargin</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="14332" class="l"><a href="#14332">14332: </a>            <span class="php-var">$prevrMargin</span> = <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="14333" class="l"><a href="#14333">14333: </a>            <span class="php-var">$curfontname</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="14334" class="l"><a href="#14334">14334: </a>            <span class="php-var">$curfontstyle</span> = <span class="php-var">$this</span>-&gt;FontStyle;
</span><span id="14335" class="l"><a href="#14335">14335: </a>            <span class="php-var">$curfontsize</span> = <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="14336" class="l"><a href="#14336">14336: </a>            <span class="php-var">$curfontascent</span> = <span class="php-var">$this</span>-&gt;getFontAscent(<span class="php-var">$curfontname</span>, <span class="php-var">$curfontstyle</span>, <span class="php-var">$curfontsize</span>);
</span><span id="14337" class="l"><a href="#14337">14337: </a>            <span class="php-var">$curfontdescent</span> = <span class="php-var">$this</span>-&gt;getFontDescent(<span class="php-var">$curfontname</span>, <span class="php-var">$curfontstyle</span>, <span class="php-var">$curfontsize</span>);
</span><span id="14338" class="l"><a href="#14338">14338: </a>            <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">true</span>;
</span><span id="14339" class="l"><a href="#14339">14339: </a>            <span class="php-var">$startlinepage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="14340" class="l"><a href="#14340">14340: </a>            <span class="php-var">$minstartliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14341" class="l"><a href="#14341">14341: </a>            <span class="php-var">$maxbottomliney</span> = <span class="php-num">0</span>;
</span><span id="14342" class="l"><a href="#14342">14342: </a>            <span class="php-var">$startlinex</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="14343" class="l"><a href="#14343">14343: </a>            <span class="php-var">$startliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14344" class="l"><a href="#14344">14344: </a>            <span class="php-var">$yshift</span> = <span class="php-num">0</span>;
</span><span id="14345" class="l"><a href="#14345">14345: </a>            <span class="php-var">$newline</span> = <span class="php-keyword1">true</span>;
</span><span id="14346" class="l"><a href="#14346">14346: </a>            <span class="php-var">$loop</span> = <span class="php-num">0</span>;
</span><span id="14347" class="l"><a href="#14347">14347: </a>            <span class="php-var">$curpos</span> = <span class="php-num">0</span>;
</span><span id="14348" class="l"><a href="#14348">14348: </a>            <span class="php-var">$this_method_vars</span> = <span class="php-keyword1">array</span>();
</span><span id="14349" class="l"><a href="#14349">14349: </a>            <span class="php-var">$undo</span> = <span class="php-keyword1">false</span>;
</span><span id="14350" class="l"><a href="#14350">14350: </a>            <span class="php-var">$fontaligned</span> = <span class="php-keyword1">false</span>;
</span><span id="14351" class="l"><a href="#14351">14351: </a>            <span class="php-var">$this</span>-&gt;premode = <span class="php-keyword1">false</span>;
</span><span id="14352" class="l"><a href="#14352">14352: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="14353" class="l"><a href="#14353">14353: </a>                <span class="php-var">$pask</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page]);
</span><span id="14354" class="l"><a href="#14354">14354: </a>            } <span class="php-keyword1">else</span> {
</span><span id="14355" class="l"><a href="#14355">14355: </a>                <span class="php-var">$pask</span> = <span class="php-num">0</span>;
</span><span id="14356" class="l"><a href="#14356">14356: </a>            }
</span><span id="14357" class="l"><a href="#14357">14357: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;InFooter) {
</span><span id="14358" class="l"><a href="#14358">14358: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="14359" class="l"><a href="#14359">14359: </a>                    <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page];
</span><span id="14360" class="l"><a href="#14360">14360: </a>                } <span class="php-keyword1">else</span> {
</span><span id="14361" class="l"><a href="#14361">14361: </a>                    <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="14362" class="l"><a href="#14362">14362: </a>                }
</span><span id="14363" class="l"><a href="#14363">14363: </a>                <span class="php-var">$startlinepos</span> = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page];
</span><span id="14364" class="l"><a href="#14364">14364: </a>            } <span class="php-keyword1">else</span> {
</span><span id="14365" class="l"><a href="#14365">14365: </a>                <span class="php-var">$startlinepos</span> = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="14366" class="l"><a href="#14366">14366: </a>            }
</span><span id="14367" class="l"><a href="#14367">14367: </a>            <span class="php-var">$lalign</span> = <span class="php-var">$align</span>;
</span><span id="14368" class="l"><a href="#14368">14368: </a>            <span class="php-var">$plalign</span> = <span class="php-var">$align</span>;
</span><span id="14369" class="l"><a href="#14369">14369: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="14370" class="l"><a href="#14370">14370: </a>                <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="14371" class="l"><a href="#14371">14371: </a>            } <span class="php-keyword1">else</span> {
</span><span id="14372" class="l"><a href="#14372">14372: </a>                <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x;
</span><span id="14373" class="l"><a href="#14373">14373: </a>            }
</span><span id="14374" class="l"><a href="#14374">14374: </a>            <span class="php-var">$w</span> -= (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;cMargin);
</span><span id="14375" class="l"><a href="#14375">14375: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$cell</span>) {
</span><span id="14376" class="l"><a href="#14376">14376: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="14377" class="l"><a href="#14377">14377: </a>                    <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="14378" class="l"><a href="#14378">14378: </a>                } <span class="php-keyword1">else</span> {
</span><span id="14379" class="l"><a href="#14379">14379: </a>                    <span class="php-var">$this</span>-&gt;x += <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="14380" class="l"><a href="#14380">14380: </a>                }
</span><span id="14381" class="l"><a href="#14381">14381: </a>            }
</span><span id="14382" class="l"><a href="#14382">14382: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;customlistindent &gt;= <span class="php-num">0</span>) {
</span><span id="14383" class="l"><a href="#14383">14383: </a>                <span class="php-var">$this</span>-&gt;listindent = <span class="php-var">$this</span>-&gt;customlistindent;
</span><span id="14384" class="l"><a href="#14384">14384: </a>            } <span class="php-keyword1">else</span> {
</span><span id="14385" class="l"><a href="#14385">14385: </a>                <span class="php-var">$this</span>-&gt;listindent = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-quote">'0000'</span>);
</span><span id="14386" class="l"><a href="#14386">14386: </a>            }
</span><span id="14387" class="l"><a href="#14387">14387: </a>            <span class="php-var">$this</span>-&gt;listindentlevel = <span class="php-num">0</span>;
</span><span id="14388" class="l"><a href="#14388">14388: </a>            <span class="php-comment">// save previous states</span>
</span><span id="14389" class="l"><a href="#14389">14389: </a>            <span class="php-var">$prev_cell_height_ratio</span> = <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="14390" class="l"><a href="#14390">14390: </a>            <span class="php-var">$prev_listnum</span> = <span class="php-var">$this</span>-&gt;listnum;
</span><span id="14391" class="l"><a href="#14391">14391: </a>            <span class="php-var">$prev_listordered</span> = <span class="php-var">$this</span>-&gt;listordered;
</span><span id="14392" class="l"><a href="#14392">14392: </a>            <span class="php-var">$prev_listcount</span> = <span class="php-var">$this</span>-&gt;listcount;
</span><span id="14393" class="l"><a href="#14393">14393: </a>            <span class="php-var">$prev_lispacer</span> = <span class="php-var">$this</span>-&gt;lispacer;
</span><span id="14394" class="l"><a href="#14394">14394: </a>            <span class="php-var">$this</span>-&gt;listnum = <span class="php-num">0</span>;
</span><span id="14395" class="l"><a href="#14395">14395: </a>            <span class="php-var">$this</span>-&gt;listordered = <span class="php-keyword1">array</span>();
</span><span id="14396" class="l"><a href="#14396">14396: </a>            <span class="php-var">$this</span>-&gt;listcount = <span class="php-keyword1">array</span>();
</span><span id="14397" class="l"><a href="#14397">14397: </a>            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">''</span>;
</span><span id="14398" class="l"><a href="#14398">14398: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;lasth)) <span class="php-keyword1">OR</span> (<span class="php-var">$reseth</span>)) {
</span><span id="14399" class="l"><a href="#14399">14399: </a>                <span class="php-comment">//set row height</span>
</span><span id="14400" class="l"><a href="#14400">14400: </a>                <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="14401" class="l"><a href="#14401">14401: </a>            }
</span><span id="14402" class="l"><a href="#14402">14402: </a>            <span class="php-var">$dom</span> = <span class="php-var">$this</span>-&gt;getHtmlDomArray(<span class="php-var">$html</span>);
</span><span id="14403" class="l"><a href="#14403">14403: </a>            <span class="php-var">$maxel</span> = <span class="php-keyword2">count</span>(<span class="php-var">$dom</span>);
</span><span id="14404" class="l"><a href="#14404">14404: </a>            <span class="php-var">$key</span> = <span class="php-num">0</span>;
</span><span id="14405" class="l"><a href="#14405">14405: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$key</span> &lt; <span class="php-var">$maxel</span>) {
</span><span id="14406" class="l"><a href="#14406">14406: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>])) {
</span><span id="14407" class="l"><a href="#14407">14407: </a>                    <span class="php-comment">// check for pagebreak</span>
</span><span id="14408" class="l"><a href="#14408">14408: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] == <span class="php-quote">'true'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] == <span class="php-quote">'left'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] == <span class="php-quote">'right'</span>)) {
</span><span id="14409" class="l"><a href="#14409">14409: </a>                        <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="14410" class="l"><a href="#14410">14410: </a>                        <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>);
</span><span id="14411" class="l"><a href="#14411">14411: </a>                    }
</span><span id="14412" class="l"><a href="#14412">14412: </a>                    <span class="php-keyword1">if</span> (((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] == <span class="php-quote">'left'</span>) <span class="php-keyword1">AND</span> (((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) == <span class="php-num">0</span>)) <span class="php-keyword1">OR</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) != <span class="php-num">0</span>))))
</span><span id="14413" class="l"><a href="#14413">14413: </a>                        <span class="php-keyword1">OR</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreak'</span>] == <span class="php-quote">'right'</span>) <span class="php-keyword1">AND</span> (((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) != <span class="php-num">0</span>)) <span class="php-keyword1">OR</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) == <span class="php-num">0</span>))))) {
</span><span id="14414" class="l"><a href="#14414">14414: </a>                        <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="14415" class="l"><a href="#14415">14415: </a>                        <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>);
</span><span id="14416" class="l"><a href="#14416">14416: </a>                    }
</span><span id="14417" class="l"><a href="#14417">14417: </a>                }
</span><span id="14418" class="l"><a href="#14418">14418: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] <span class="php-keyword1">AND</span> <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>] <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="14419" class="l"><a href="#14419">14419: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="14420" class="l"><a href="#14420">14420: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>] = <span class="php-keyword1">false</span>;
</span><span id="14421" class="l"><a href="#14421">14421: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="14422" class="l"><a href="#14422">14422: </a>                        <span class="php-comment">// store current object</span>
</span><span id="14423" class="l"><a href="#14423">14423: </a>                        <span class="php-var">$this</span>-&gt;startTransaction();
</span><span id="14424" class="l"><a href="#14424">14424: </a>                        <span class="php-comment">// save this method vars</span>
</span><span id="14425" class="l"><a href="#14425">14425: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'html'</span>] = <span class="php-var">$html</span>;
</span><span id="14426" class="l"><a href="#14426">14426: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'ln'</span>] = <span class="php-var">$ln</span>;
</span><span id="14427" class="l"><a href="#14427">14427: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'fill'</span>] = <span class="php-var">$fill</span>;
</span><span id="14428" class="l"><a href="#14428">14428: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'reseth'</span>] = <span class="php-var">$reseth</span>;
</span><span id="14429" class="l"><a href="#14429">14429: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'cell'</span>] = <span class="php-var">$cell</span>;
</span><span id="14430" class="l"><a href="#14430">14430: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'align'</span>] = <span class="php-var">$align</span>;
</span><span id="14431" class="l"><a href="#14431">14431: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'gvars'</span>] = <span class="php-var">$gvars</span>;
</span><span id="14432" class="l"><a href="#14432">14432: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prevPage'</span>] = <span class="php-var">$prevPage</span>;
</span><span id="14433" class="l"><a href="#14433">14433: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prevlMargin'</span>] = <span class="php-var">$prevlMargin</span>;
</span><span id="14434" class="l"><a href="#14434">14434: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prevrMargin'</span>] = <span class="php-var">$prevrMargin</span>;
</span><span id="14435" class="l"><a href="#14435">14435: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'curfontname'</span>] = <span class="php-var">$curfontname</span>;
</span><span id="14436" class="l"><a href="#14436">14436: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'curfontstyle'</span>] = <span class="php-var">$curfontstyle</span>;
</span><span id="14437" class="l"><a href="#14437">14437: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'curfontsize'</span>] = <span class="php-var">$curfontsize</span>;
</span><span id="14438" class="l"><a href="#14438">14438: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'curfontascent'</span>] = <span class="php-var">$curfontascent</span>;
</span><span id="14439" class="l"><a href="#14439">14439: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'curfontdescent'</span>] = <span class="php-var">$curfontdescent</span>;
</span><span id="14440" class="l"><a href="#14440">14440: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'minstartliney'</span>] = <span class="php-var">$minstartliney</span>;
</span><span id="14441" class="l"><a href="#14441">14441: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'maxbottomliney'</span>] = <span class="php-var">$maxbottomliney</span>;
</span><span id="14442" class="l"><a href="#14442">14442: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'yshift'</span>] = <span class="php-var">$yshift</span>;
</span><span id="14443" class="l"><a href="#14443">14443: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'startlinepage'</span>] = <span class="php-var">$startlinepage</span>;
</span><span id="14444" class="l"><a href="#14444">14444: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'startlinepos'</span>] = <span class="php-var">$startlinepos</span>;
</span><span id="14445" class="l"><a href="#14445">14445: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'startlinex'</span>] = <span class="php-var">$startlinex</span>;
</span><span id="14446" class="l"><a href="#14446">14446: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'startliney'</span>] = <span class="php-var">$startliney</span>;
</span><span id="14447" class="l"><a href="#14447">14447: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'newline'</span>] = <span class="php-var">$newline</span>;
</span><span id="14448" class="l"><a href="#14448">14448: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'loop'</span>] = <span class="php-var">$loop</span>;
</span><span id="14449" class="l"><a href="#14449">14449: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'curpos'</span>] = <span class="php-var">$curpos</span>;
</span><span id="14450" class="l"><a href="#14450">14450: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'pask'</span>] = <span class="php-var">$pask</span>;
</span><span id="14451" class="l"><a href="#14451">14451: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'lalign'</span>] = <span class="php-var">$lalign</span>;
</span><span id="14452" class="l"><a href="#14452">14452: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'plalign'</span>] = <span class="php-var">$plalign</span>;
</span><span id="14453" class="l"><a href="#14453">14453: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'w'</span>] = <span class="php-var">$w</span>;
</span><span id="14454" class="l"><a href="#14454">14454: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prev_cell_height_ratio'</span>] = <span class="php-var">$prev_cell_height_ratio</span>;
</span><span id="14455" class="l"><a href="#14455">14455: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prev_listnum'</span>] = <span class="php-var">$prev_listnum</span>;
</span><span id="14456" class="l"><a href="#14456">14456: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prev_listordered'</span>] = <span class="php-var">$prev_listordered</span>;
</span><span id="14457" class="l"><a href="#14457">14457: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prev_listcount'</span>] = <span class="php-var">$prev_listcount</span>;
</span><span id="14458" class="l"><a href="#14458">14458: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'prev_lispacer'</span>] = <span class="php-var">$prev_lispacer</span>;
</span><span id="14459" class="l"><a href="#14459">14459: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'fontaligned'</span>] = <span class="php-var">$fontaligned</span>;
</span><span id="14460" class="l"><a href="#14460">14460: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'key'</span>] = <span class="php-var">$key</span>;
</span><span id="14461" class="l"><a href="#14461">14461: </a>                        <span class="php-var">$this_method_vars</span>[<span class="php-quote">'dom'</span>] = <span class="php-var">$dom</span>;
</span><span id="14462" class="l"><a href="#14462">14462: </a>                    }
</span><span id="14463" class="l"><a href="#14463">14463: </a>                }
</span><span id="14464" class="l"><a href="#14464">14464: </a>                <span class="php-comment">// print THEAD block</span>
</span><span id="14465" class="l"><a href="#14465">14465: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'tr'</span>) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>]) {
</span><span id="14466" class="l"><a href="#14466">14466: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>]][<span class="php-quote">'thead'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>]][<span class="php-quote">'thead'</span>])) {
</span><span id="14467" class="l"><a href="#14467">14467: </a>                        <span class="php-var">$this</span>-&gt;inthead = <span class="php-keyword1">true</span>;
</span><span id="14468" class="l"><a href="#14468">14468: </a>                        <span class="php-comment">// print table header (thead)</span>
</span><span id="14469" class="l"><a href="#14469">14469: </a>                        <span class="php-var">$this</span>-&gt;writeHTML(<span class="php-var">$this</span>-&gt;thead, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-quote">''</span>);
</span><span id="14470" class="l"><a href="#14470">14470: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;start_transaction_page == (<span class="php-var">$this</span>-&gt;numpages - <span class="php-num">1</span>)) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$this</span>-&gt;start_transaction_y) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;lasth, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>))) {
</span><span id="14471" class="l"><a href="#14471">14471: </a>                            <span class="php-comment">// restore previous object</span>
</span><span id="14472" class="l"><a href="#14472">14472: </a>                            <span class="php-var">$this</span>-&gt;rollbackTransaction(<span class="php-keyword1">true</span>);
</span><span id="14473" class="l"><a href="#14473">14473: </a>                            <span class="php-comment">// restore previous values</span>
</span><span id="14474" class="l"><a href="#14474">14474: </a>                            <span class="php-keyword1">foreach</span> (<span class="php-var">$this_method_vars</span> <span class="php-keyword1">as</span> <span class="php-var">$vkey</span> =&gt; <span class="php-var">$vval</span>) {
</span><span id="14475" class="l"><a href="#14475">14475: </a>                                <span class="php-var">$$vkey</span> = <span class="php-var">$vval</span>;
</span><span id="14476" class="l"><a href="#14476">14476: </a>                            }
</span><span id="14477" class="l"><a href="#14477">14477: </a>                            <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="14478" class="l"><a href="#14478">14478: </a>                            <span class="php-var">$pre_y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14479" class="l"><a href="#14479">14479: </a>                            <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$pre_y</span>)) {
</span><span id="14480" class="l"><a href="#14480">14480: </a>                                <span class="php-comment">// fix for multicolumn mode</span>
</span><span id="14481" class="l"><a href="#14481">14481: </a>                                <span class="php-var">$startliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14482" class="l"><a href="#14482">14482: </a>                            }
</span><span id="14483" class="l"><a href="#14483">14483: </a>                            <span class="php-var">$this</span>-&gt;start_transaction_page = <span class="php-var">$this</span>-&gt;page;
</span><span id="14484" class="l"><a href="#14484">14484: </a>                            <span class="php-var">$this</span>-&gt;start_transaction_y = <span class="php-var">$this</span>-&gt;y;
</span><span id="14485" class="l"><a href="#14485">14485: </a>                        }
</span><span id="14486" class="l"><a href="#14486">14486: </a>                    }
</span><span id="14487" class="l"><a href="#14487">14487: </a>                    <span class="php-comment">// move $key index forward to skip THEAD block</span>
</span><span id="14488" class="l"><a href="#14488">14488: </a>                    <span class="php-keyword1">while</span> ( (<span class="php-var">$key</span> &lt; <span class="php-var">$maxel</span>) <span class="php-keyword1">AND</span> (!(
</span><span id="14489" class="l"><a href="#14489">14489: </a>                        (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] <span class="php-keyword1">AND</span> <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>] <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'tr'</span>) <span class="php-keyword1">AND</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>]) <span class="php-keyword1">OR</span> !<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>]))
</span><span id="14490" class="l"><a href="#14490">14490: </a>                        <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] <span class="php-keyword1">AND</span> (!<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'table'</span>))) )) {
</span><span id="14491" class="l"><a href="#14491">14491: </a>                        ++<span class="php-var">$key</span>;
</span><span id="14492" class="l"><a href="#14492">14492: </a>                    }
</span><span id="14493" class="l"><a href="#14493">14493: </a>                }
</span><span id="14494" class="l"><a href="#14494">14494: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] <span class="php-keyword1">OR</span> (<span class="php-var">$key</span> == <span class="php-num">0</span>)) {
</span><span id="14495" class="l"><a href="#14495">14495: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'line-height'</span>])) {
</span><span id="14496" class="l"><a href="#14496">14496: </a>                        <span class="php-comment">// set line height</span>
</span><span id="14497" class="l"><a href="#14497">14497: </a>                        <span class="php-var">$this</span>-&gt;cell_height_ratio = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'line-height'</span>];
</span><span id="14498" class="l"><a href="#14498">14498: </a>                        <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="14499" class="l"><a href="#14499">14499: </a>                    }
</span><span id="14500" class="l"><a href="#14500">14500: </a>                    <span class="php-keyword1">if</span> (((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'table'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'tr'</span>)) <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>]))) {
</span><span id="14501" class="l"><a href="#14501">14501: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>] = (<span class="php-var">$this</span>-&gt;rtl) ? <span class="php-quote">'R'</span> : <span class="php-quote">'L'</span>;
</span><span id="14502" class="l"><a href="#14502">14502: </a>                    }
</span><span id="14503" class="l"><a href="#14503">14503: </a>                    <span class="php-comment">// vertically align image in line</span>
</span><span id="14504" class="l"><a href="#14504">14504: </a>                    <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;newline) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'img'</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>])) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>] &gt; <span class="php-num">0</span>)) {
</span><span id="14505" class="l"><a href="#14505">14505: </a>                        <span class="php-comment">// get image height</span>
</span><span id="14506" class="l"><a href="#14506">14506: </a>                        <span class="php-var">$imgh</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>], <span class="php-var">$this</span>-&gt;lasth, <span class="php-quote">'px'</span>);
</span><span id="14507" class="l"><a href="#14507">14507: </a>                        <span class="php-comment">// check for automatic line break</span>
</span><span id="14508" class="l"><a href="#14508">14508: </a>                        <span class="php-var">$autolinebreak</span> = <span class="php-keyword1">false</span>;
</span><span id="14509" class="l"><a href="#14509">14509: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>] &gt; <span class="php-num">0</span>)) {
</span><span id="14510" class="l"><a href="#14510">14510: </a>                            <span class="php-var">$imgw</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>, <span class="php-keyword1">false</span>);
</span><span id="14511" class="l"><a href="#14511">14511: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;rtl <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;x - <span class="php-var">$imgw</span>) &lt; (<span class="php-var">$this</span>-&gt;lMargin + <span class="php-var">$this</span>-&gt;cMargin)))
</span><span id="14512" class="l"><a href="#14512">14512: </a>                                <span class="php-keyword1">OR</span> (!<span class="php-var">$this</span>-&gt;rtl <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;x + <span class="php-var">$imgw</span>) &gt; (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;cMargin)))) {
</span><span id="14513" class="l"><a href="#14513">14513: </a>                                <span class="php-comment">// add automatic line break</span>
</span><span id="14514" class="l"><a href="#14514">14514: </a>                                <span class="php-var">$autolinebreak</span> = <span class="php-keyword1">true</span>;
</span><span id="14515" class="l"><a href="#14515">14515: </a>                                <span class="php-var">$this</span>-&gt;Ln(<span class="php-quote">''</span>, <span class="php-var">$cell</span>);
</span><span id="14516" class="l"><a href="#14516">14516: </a>                                <span class="php-comment">// go back to evaluate this line break</span>
</span><span id="14517" class="l"><a href="#14517">14517: </a>                                --<span class="php-var">$key</span>;
</span><span id="14518" class="l"><a href="#14518">14518: </a>                            }
</span><span id="14519" class="l"><a href="#14519">14519: </a>                        }
</span><span id="14520" class="l"><a href="#14520">14520: </a>                        <span class="php-keyword1">if</span> (!<span class="php-var">$autolinebreak</span>) {
</span><span id="14521" class="l"><a href="#14521">14521: </a>                            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;InFooter) {
</span><span id="14522" class="l"><a href="#14522">14522: </a>                                <span class="php-var">$pre_y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14523" class="l"><a href="#14523">14523: </a>                                <span class="php-comment">// check for page break</span>
</span><span id="14524" class="l"><a href="#14524">14524: </a>                                <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$imgh</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$pre_y</span>)) {
</span><span id="14525" class="l"><a href="#14525">14525: </a>                                    <span class="php-comment">// fix for multicolumn mode</span>
</span><span id="14526" class="l"><a href="#14526">14526: </a>                                    <span class="php-var">$startliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14527" class="l"><a href="#14527">14527: </a>                                }
</span><span id="14528" class="l"><a href="#14528">14528: </a>                            }
</span><span id="14529" class="l"><a href="#14529">14529: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-var">$startlinepage</span>) {
</span><span id="14530" class="l"><a href="#14530">14530: </a>                                <span class="php-comment">// fix line splitted over two pages</span>
</span><span id="14531" class="l"><a href="#14531">14531: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>])) {
</span><span id="14532" class="l"><a href="#14532">14532: </a>                                    <span class="php-var">$curpos</span> = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$startlinepage</span>] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>];
</span><span id="14533" class="l"><a href="#14533">14533: </a>                                }
</span><span id="14534" class="l"><a href="#14534">14534: </a>                                <span class="php-comment">// line to be moved one page forward</span>
</span><span id="14535" class="l"><a href="#14535">14535: </a>                                <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>);
</span><span id="14536" class="l"><a href="#14536">14536: </a>                                <span class="php-var">$linebeg</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$startlinepos</span>, (<span class="php-var">$curpos</span> - <span class="php-var">$startlinepos</span>));
</span><span id="14537" class="l"><a href="#14537">14537: </a>                                <span class="php-var">$tstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$startlinepos</span>);
</span><span id="14538" class="l"><a href="#14538">14538: </a>                                <span class="php-var">$tend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$curpos</span>);
</span><span id="14539" class="l"><a href="#14539">14539: </a>                                <span class="php-comment">// remove line from previous page</span>
</span><span id="14540" class="l"><a href="#14540">14540: </a>                                <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$startlinepage</span>, <span class="php-var">$tstart</span>.<span class="php-quote">''</span>.<span class="php-var">$tend</span>);
</span><span id="14541" class="l"><a href="#14541">14541: </a>                                <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$this</span>-&gt;page);
</span><span id="14542" class="l"><a href="#14542">14542: </a>                                <span class="php-var">$tstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="14543" class="l"><a href="#14543">14543: </a>                                <span class="php-var">$tend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="14544" class="l"><a href="#14544">14544: </a>                                <span class="php-comment">// add line start to current page</span>
</span><span id="14545" class="l"><a href="#14545">14545: </a>                                <span class="php-var">$yshift</span> = <span class="php-var">$minstartliney</span> - <span class="php-var">$this</span>-&gt;y;
</span><span id="14546" class="l"><a href="#14546">14546: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$fontaligned</span>) {
</span><span id="14547" class="l"><a href="#14547">14547: </a>                                    <span class="php-var">$yshift</span> += (<span class="php-var">$curfontsize</span> / <span class="php-var">$this</span>-&gt;k);
</span><span id="14548" class="l"><a href="#14548">14548: </a>                                }
</span><span id="14549" class="l"><a href="#14549">14549: </a>                                <span class="php-var">$try</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'1 0 0 1 0 %.3F cm'</span>, (<span class="php-var">$yshift</span> * <span class="php-var">$this</span>-&gt;k));
</span><span id="14550" class="l"><a href="#14550">14550: </a>                                <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$tstart</span>.<span class="php-quote">&quot;\nq\n&quot;</span>.<span class="php-var">$try</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$linebeg</span>.<span class="php-quote">&quot;\nQ\n&quot;</span>.<span class="php-var">$tend</span>);
</span><span id="14551" class="l"><a href="#14551">14551: </a>                                <span class="php-comment">// shift the annotations and links</span>
</span><span id="14552" class="l"><a href="#14552">14552: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="14553" class="l"><a href="#14553">14553: </a>                                    <span class="php-var">$next_pask</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page]);
</span><span id="14554" class="l"><a href="#14554">14554: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="14555" class="l"><a href="#14555">14555: </a>                                    <span class="php-var">$next_pask</span> = <span class="php-num">0</span>;
</span><span id="14556" class="l"><a href="#14556">14556: </a>                                }
</span><span id="14557" class="l"><a href="#14557">14557: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$startlinepage</span>])) {
</span><span id="14558" class="l"><a href="#14558">14558: </a>                                    <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$startlinepage</span>] <span class="php-keyword1">as</span> <span class="php-var">$pak</span> =&gt; <span class="php-var">$pac</span>) {
</span><span id="14559" class="l"><a href="#14559">14559: </a>                                        <span class="php-keyword1">if</span> (<span class="php-var">$pak</span> &gt;= <span class="php-var">$pask</span>) {
</span><span id="14560" class="l"><a href="#14560">14560: </a>                                            <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][] = <span class="php-var">$pac</span>;
</span><span id="14561" class="l"><a href="#14561">14561: </a>                                            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$startlinepage</span>][<span class="php-var">$pak</span>]);
</span><span id="14562" class="l"><a href="#14562">14562: </a>                                            <span class="php-var">$npak</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page]) - <span class="php-num">1</span>;
</span><span id="14563" class="l"><a href="#14563">14563: </a>                                            <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$npak</span>][<span class="php-quote">'y'</span>] -= <span class="php-var">$yshift</span>;
</span><span id="14564" class="l"><a href="#14564">14564: </a>                                        }
</span><span id="14565" class="l"><a href="#14565">14565: </a>                                    }
</span><span id="14566" class="l"><a href="#14566">14566: </a>                                }
</span><span id="14567" class="l"><a href="#14567">14567: </a>                                <span class="php-var">$pask</span> = <span class="php-var">$next_pask</span>;
</span><span id="14568" class="l"><a href="#14568">14568: </a>                                <span class="php-var">$startlinepos</span> = <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$this</span>-&gt;page];
</span><span id="14569" class="l"><a href="#14569">14569: </a>                                <span class="php-var">$startlinepage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="14570" class="l"><a href="#14570">14570: </a>                                <span class="php-var">$startliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14571" class="l"><a href="#14571">14571: </a>                            }
</span><span id="14572" class="l"><a href="#14572">14572: </a>                            <span class="php-var">$this</span>-&gt;y += (((<span class="php-var">$curfontsize</span> * <span class="php-var">$this</span>-&gt;cell_height_ratio / <span class="php-var">$this</span>-&gt;k) + <span class="php-var">$curfontascent</span> - <span class="php-var">$curfontdescent</span>) / <span class="php-num">2</span>) - <span class="php-var">$imgh</span>;
</span><span id="14573" class="l"><a href="#14573">14573: </a>                            <span class="php-var">$minstartliney</span> = <span class="php-keyword2">min</span>(<span class="php-var">$this</span>-&gt;y, <span class="php-var">$minstartliney</span>);
</span><span id="14574" class="l"><a href="#14574">14574: </a>                            <span class="php-var">$maxbottomliney</span> = (<span class="php-var">$startliney</span> + (<span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio));
</span><span id="14575" class="l"><a href="#14575">14575: </a>                        }
</span><span id="14576" class="l"><a href="#14576">14576: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>]) <span class="php-keyword1">OR</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>]) <span class="php-keyword1">OR</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>])) {
</span><span id="14577" class="l"><a href="#14577">14577: </a>                        <span class="php-comment">// account for different font size</span>
</span><span id="14578" class="l"><a href="#14578">14578: </a>                        <span class="php-var">$pfontname</span> = <span class="php-var">$curfontname</span>;
</span><span id="14579" class="l"><a href="#14579">14579: </a>                        <span class="php-var">$pfontstyle</span> = <span class="php-var">$curfontstyle</span>;
</span><span id="14580" class="l"><a href="#14580">14580: </a>                        <span class="php-var">$pfontsize</span> = <span class="php-var">$curfontsize</span>;
</span><span id="14581" class="l"><a href="#14581">14581: </a>                        <span class="php-var">$fontname</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>]) ? <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontname'</span>] : <span class="php-var">$curfontname</span>;
</span><span id="14582" class="l"><a href="#14582">14582: </a>                        <span class="php-var">$fontstyle</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>]) ? <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontstyle'</span>] : <span class="php-var">$curfontstyle</span>;
</span><span id="14583" class="l"><a href="#14583">14583: </a>                        <span class="php-var">$fontsize</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>]) ? <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fontsize'</span>] : <span class="php-var">$curfontsize</span>;
</span><span id="14584" class="l"><a href="#14584">14584: </a>                        <span class="php-var">$fontascent</span> = <span class="php-var">$this</span>-&gt;getFontAscent(<span class="php-var">$fontname</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span>);
</span><span id="14585" class="l"><a href="#14585">14585: </a>                        <span class="php-var">$fontdescent</span> = <span class="php-var">$this</span>-&gt;getFontDescent(<span class="php-var">$fontname</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span>);
</span><span id="14586" class="l"><a href="#14586">14586: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$fontname</span> != <span class="php-var">$curfontname</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$fontstyle</span> != <span class="php-var">$curfontstyle</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$fontsize</span> != <span class="php-var">$curfontsize</span>)) {
</span><span id="14587" class="l"><a href="#14587">14587: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_numeric</span>(<span class="php-var">$fontsize</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$fontsize</span> &gt;= <span class="php-num">0</span>)
</span><span id="14588" class="l"><a href="#14588">14588: </a>                                <span class="php-keyword1">AND</span> <span class="php-keyword2">is_numeric</span>(<span class="php-var">$curfontsize</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$curfontsize</span> &gt;= <span class="php-num">0</span>)
</span><span id="14589" class="l"><a href="#14589">14589: </a>                                <span class="php-keyword1">AND</span> (<span class="php-var">$fontsize</span> != <span class="php-var">$curfontsize</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;newline)
</span><span id="14590" class="l"><a href="#14590">14590: </a>                                <span class="php-keyword1">AND</span> (<span class="php-var">$key</span> &lt; (<span class="php-var">$maxel</span> - <span class="php-num">1</span>))
</span><span id="14591" class="l"><a href="#14591">14591: </a>                                ) {
</span><span id="14592" class="l"><a href="#14592">14592: </a>                                <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;newline) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-var">$startlinepage</span>)) {
</span><span id="14593" class="l"><a href="#14593">14593: </a>                                    <span class="php-comment">// fix lines splitted over two pages</span>
</span><span id="14594" class="l"><a href="#14594">14594: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>])) {
</span><span id="14595" class="l"><a href="#14595">14595: </a>                                        <span class="php-var">$curpos</span> = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$startlinepage</span>] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>];
</span><span id="14596" class="l"><a href="#14596">14596: </a>                                    }
</span><span id="14597" class="l"><a href="#14597">14597: </a>                                    <span class="php-comment">// line to be moved one page forward</span>
</span><span id="14598" class="l"><a href="#14598">14598: </a>                                    <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>);
</span><span id="14599" class="l"><a href="#14599">14599: </a>                                    <span class="php-var">$linebeg</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$startlinepos</span>, (<span class="php-var">$curpos</span> - <span class="php-var">$startlinepos</span>));
</span><span id="14600" class="l"><a href="#14600">14600: </a>                                    <span class="php-var">$tstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$startlinepos</span>);
</span><span id="14601" class="l"><a href="#14601">14601: </a>                                    <span class="php-var">$tend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$curpos</span>);
</span><span id="14602" class="l"><a href="#14602">14602: </a>                                    <span class="php-comment">// remove line start from previous page</span>
</span><span id="14603" class="l"><a href="#14603">14603: </a>                                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$startlinepage</span>, <span class="php-var">$tstart</span>.<span class="php-quote">''</span>.<span class="php-var">$tend</span>);
</span><span id="14604" class="l"><a href="#14604">14604: </a>                                    <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$this</span>-&gt;page);
</span><span id="14605" class="l"><a href="#14605">14605: </a>                                    <span class="php-var">$tstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="14606" class="l"><a href="#14606">14606: </a>                                    <span class="php-var">$tend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="14607" class="l"><a href="#14607">14607: </a>                                    <span class="php-comment">// add line start to current page</span>
</span><span id="14608" class="l"><a href="#14608">14608: </a>                                    <span class="php-var">$yshift</span> = <span class="php-var">$minstartliney</span> - <span class="php-var">$this</span>-&gt;y;
</span><span id="14609" class="l"><a href="#14609">14609: </a>                                    <span class="php-var">$try</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'1 0 0 1 0 %.3F cm'</span>, (<span class="php-var">$yshift</span> * <span class="php-var">$this</span>-&gt;k));
</span><span id="14610" class="l"><a href="#14610">14610: </a>                                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$tstart</span>.<span class="php-quote">&quot;\nq\n&quot;</span>.<span class="php-var">$try</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$linebeg</span>.<span class="php-quote">&quot;\nQ\n&quot;</span>.<span class="php-var">$tend</span>);
</span><span id="14611" class="l"><a href="#14611">14611: </a>                                    <span class="php-comment">// shift the annotations and links</span>
</span><span id="14612" class="l"><a href="#14612">14612: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="14613" class="l"><a href="#14613">14613: </a>                                        <span class="php-var">$next_pask</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page]);
</span><span id="14614" class="l"><a href="#14614">14614: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="14615" class="l"><a href="#14615">14615: </a>                                        <span class="php-var">$next_pask</span> = <span class="php-num">0</span>;
</span><span id="14616" class="l"><a href="#14616">14616: </a>                                    }
</span><span id="14617" class="l"><a href="#14617">14617: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$startlinepage</span>])) {
</span><span id="14618" class="l"><a href="#14618">14618: </a>                                        <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$startlinepage</span>] <span class="php-keyword1">as</span> <span class="php-var">$pak</span> =&gt; <span class="php-var">$pac</span>) {
</span><span id="14619" class="l"><a href="#14619">14619: </a>                                            <span class="php-keyword1">if</span> (<span class="php-var">$pak</span> &gt;= <span class="php-var">$pask</span>) {
</span><span id="14620" class="l"><a href="#14620">14620: </a>                                                <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][] = <span class="php-var">$pac</span>;
</span><span id="14621" class="l"><a href="#14621">14621: </a>                                                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$startlinepage</span>][<span class="php-var">$pak</span>]);
</span><span id="14622" class="l"><a href="#14622">14622: </a>                                                <span class="php-var">$npak</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page]) - <span class="php-num">1</span>;
</span><span id="14623" class="l"><a href="#14623">14623: </a>                                                <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$npak</span>][<span class="php-quote">'y'</span>] -= <span class="php-var">$yshift</span>;
</span><span id="14624" class="l"><a href="#14624">14624: </a>                                            }
</span><span id="14625" class="l"><a href="#14625">14625: </a>                                        }
</span><span id="14626" class="l"><a href="#14626">14626: </a>                                    }
</span><span id="14627" class="l"><a href="#14627">14627: </a>                                    <span class="php-var">$pask</span> = <span class="php-var">$next_pask</span>;
</span><span id="14628" class="l"><a href="#14628">14628: </a>                                    <span class="php-var">$startlinepos</span> = <span class="php-var">$this</span>-&gt;cntmrk[<span class="php-var">$this</span>-&gt;page];
</span><span id="14629" class="l"><a href="#14629">14629: </a>                                    <span class="php-var">$startlinepage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="14630" class="l"><a href="#14630">14630: </a>                                    <span class="php-var">$startliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14631" class="l"><a href="#14631">14631: </a>                                }
</span><span id="14632" class="l"><a href="#14632">14632: </a>                                <span class="php-keyword1">if</span> (!<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'block'</span>]) {
</span><span id="14633" class="l"><a href="#14633">14633: </a>                                    <span class="php-var">$this</span>-&gt;y += (((<span class="php-var">$curfontsize</span> - <span class="php-var">$fontsize</span>) * <span class="php-var">$this</span>-&gt;cell_height_ratio / <span class="php-var">$this</span>-&gt;k) + <span class="php-var">$curfontascent</span> - <span class="php-var">$fontascent</span> - <span class="php-var">$curfontdescent</span> + <span class="php-var">$fontdescent</span>) / <span class="php-num">2</span>;
</span><span id="14634" class="l"><a href="#14634">14634: </a>                                    <span class="php-var">$minstartliney</span> = <span class="php-keyword2">min</span>(<span class="php-var">$this</span>-&gt;y, <span class="php-var">$minstartliney</span>);
</span><span id="14635" class="l"><a href="#14635">14635: </a>                                    <span class="php-var">$maxbottomliney</span> = <span class="php-keyword2">max</span>((<span class="php-var">$this</span>-&gt;y + ((<span class="php-var">$fontsize</span> * <span class="php-var">$this</span>-&gt;cell_height_ratio) / <span class="php-var">$this</span>-&gt;k)), <span class="php-var">$maxbottomliney</span>);
</span><span id="14636" class="l"><a href="#14636">14636: </a>                                }
</span><span id="14637" class="l"><a href="#14637">14637: </a>                                <span class="php-var">$fontaligned</span> = <span class="php-keyword1">true</span>;
</span><span id="14638" class="l"><a href="#14638">14638: </a>                            }
</span><span id="14639" class="l"><a href="#14639">14639: </a>                            <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$fontname</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span>);
</span><span id="14640" class="l"><a href="#14640">14640: </a>                            <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="14641" class="l"><a href="#14641">14641: </a>                            <span class="php-var">$curfontname</span> = <span class="php-var">$fontname</span>;
</span><span id="14642" class="l"><a href="#14642">14642: </a>                            <span class="php-var">$curfontstyle</span> = <span class="php-var">$fontstyle</span>;
</span><span id="14643" class="l"><a href="#14643">14643: </a>                            <span class="php-var">$curfontsize</span> = <span class="php-var">$fontsize</span>;
</span><span id="14644" class="l"><a href="#14644">14644: </a>                            <span class="php-var">$curfontascent</span> = <span class="php-var">$fontascent</span>;
</span><span id="14645" class="l"><a href="#14645">14645: </a>                            <span class="php-var">$curfontdescent</span> = <span class="php-var">$fontdescent</span>;
</span><span id="14646" class="l"><a href="#14646">14646: </a>                        }
</span><span id="14647" class="l"><a href="#14647">14647: </a>                    }
</span><span id="14648" class="l"><a href="#14648">14648: </a>                    <span class="php-comment">// set text rendering mode</span>
</span><span id="14649" class="l"><a href="#14649">14649: </a>                    <span class="php-var">$textstroke</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'stroke'</span>]) ? <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'stroke'</span>] : <span class="php-var">$this</span>-&gt;textstrokewidth;
</span><span id="14650" class="l"><a href="#14650">14650: </a>                    <span class="php-var">$textfill</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fill'</span>]) ? <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fill'</span>] : ((<span class="php-var">$this</span>-&gt;textrendermode % <span class="php-num">2</span>) == <span class="php-num">0</span>);
</span><span id="14651" class="l"><a href="#14651">14651: </a>                    <span class="php-var">$textclip</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'clip'</span>]) ? <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'clip'</span>] : (<span class="php-var">$this</span>-&gt;textrendermode &gt; <span class="php-num">3</span>);
</span><span id="14652" class="l"><a href="#14652">14652: </a>                    <span class="php-var">$this</span>-&gt;setTextRenderingMode(<span class="php-var">$textstroke</span>, <span class="php-var">$textfill</span>, <span class="php-var">$textclip</span>);
</span><span id="14653" class="l"><a href="#14653">14653: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'J'</span>) <span class="php-keyword1">AND</span> <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'block'</span>]) {
</span><span id="14654" class="l"><a href="#14654">14654: </a>                        <span class="php-var">$plalign</span> = <span class="php-quote">''</span>;
</span><span id="14655" class="l"><a href="#14655">14655: </a>                    }
</span><span id="14656" class="l"><a href="#14656">14656: </a>                    <span class="php-comment">// get current position on page buffer</span>
</span><span id="14657" class="l"><a href="#14657">14657: </a>                    <span class="php-var">$curpos</span> = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$startlinepage</span>];
</span><span id="14658" class="l"><a href="#14658">14658: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>] !== <span class="php-keyword1">false</span>)) {
</span><span id="14659" class="l"><a href="#14659">14659: </a>                        <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'bgcolor'</span>]);
</span><span id="14660" class="l"><a href="#14660">14660: </a>                        <span class="php-var">$wfill</span> = <span class="php-keyword1">true</span>;
</span><span id="14661" class="l"><a href="#14661">14661: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="14662" class="l"><a href="#14662">14662: </a>                        <span class="php-var">$wfill</span> = <span class="php-var">$fill</span> | <span class="php-keyword1">false</span>;
</span><span id="14663" class="l"><a href="#14663">14663: </a>                    }
</span><span id="14664" class="l"><a href="#14664">14664: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>] !== <span class="php-keyword1">false</span>)) {
</span><span id="14665" class="l"><a href="#14665">14665: </a>                        <span class="php-var">$this</span>-&gt;SetTextColorArray(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'fgcolor'</span>]);
</span><span id="14666" class="l"><a href="#14666">14666: </a>                    }
</span><span id="14667" class="l"><a href="#14667">14667: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'strokecolor'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'strokecolor'</span>] !== <span class="php-keyword1">false</span>)) {
</span><span id="14668" class="l"><a href="#14668">14668: </a>                        <span class="php-var">$this</span>-&gt;SetDrawColorArray(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'strokecolor'</span>]);
</span><span id="14669" class="l"><a href="#14669">14669: </a>                    }
</span><span id="14670" class="l"><a href="#14670">14670: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>])) {
</span><span id="14671" class="l"><a href="#14671">14671: </a>                        <span class="php-var">$lalign</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'align'</span>];
</span><span id="14672" class="l"><a href="#14672">14672: </a>                    }
</span><span id="14673" class="l"><a href="#14673">14673: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$lalign</span>)) {
</span><span id="14674" class="l"><a href="#14674">14674: </a>                        <span class="php-var">$lalign</span> = <span class="php-var">$align</span>;
</span><span id="14675" class="l"><a href="#14675">14675: </a>                    }
</span><span id="14676" class="l"><a href="#14676">14676: </a>                }
</span><span id="14677" class="l"><a href="#14677">14677: </a>                <span class="php-comment">// align lines</span>
</span><span id="14678" class="l"><a href="#14678">14678: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;newline <span class="php-keyword1">AND</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]) &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] != <span class="php-quote">'td'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] != <span class="php-quote">'th'</span>)) {
</span><span id="14679" class="l"><a href="#14679">14679: </a>                    <span class="php-var">$newline</span> = <span class="php-keyword1">true</span>;
</span><span id="14680" class="l"><a href="#14680">14680: </a>                    <span class="php-var">$fontaligned</span> = <span class="php-keyword1">false</span>;
</span><span id="14681" class="l"><a href="#14681">14681: </a>                    <span class="php-comment">// we are at the beginning of a new line</span>
</span><span id="14682" class="l"><a href="#14682">14682: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$startlinex</span>)) {
</span><span id="14683" class="l"><a href="#14683">14683: </a>                        <span class="php-var">$yshift</span> = <span class="php-var">$minstartliney</span> - <span class="php-var">$startliney</span>;
</span><span id="14684" class="l"><a href="#14684">14684: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$yshift</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-var">$startlinepage</span>)) {
</span><span id="14685" class="l"><a href="#14685">14685: </a>                            <span class="php-var">$yshift</span> = <span class="php-num">0</span>;
</span><span id="14686" class="l"><a href="#14686">14686: </a>                        }
</span><span id="14687" class="l"><a href="#14687">14687: </a>                        <span class="php-var">$t_x</span> = <span class="php-num">0</span>;
</span><span id="14688" class="l"><a href="#14688">14688: </a>                        <span class="php-comment">// the last line must be shifted to be aligned as requested</span>
</span><span id="14689" class="l"><a href="#14689">14689: </a>                        <span class="php-var">$linew</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$this</span>-&gt;endlinex - <span class="php-var">$startlinex</span>);
</span><span id="14690" class="l"><a href="#14690">14690: </a>                        <span class="php-var">$pstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-num">0</span>, <span class="php-var">$startlinepos</span>);
</span><span id="14691" class="l"><a href="#14691">14691: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opentagpos</span>) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;InFooter)) {
</span><span id="14692" class="l"><a href="#14692">14692: </a>                            <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$startlinepage</span>] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>];
</span><span id="14693" class="l"><a href="#14693">14693: </a>                            <span class="php-var">$midpos</span> = <span class="php-keyword2">min</span>(<span class="php-var">$opentagpos</span>, <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>]);
</span><span id="14694" class="l"><a href="#14694">14694: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opentagpos</span>)) {
</span><span id="14695" class="l"><a href="#14695">14695: </a>                            <span class="php-var">$midpos</span> = <span class="php-var">$opentagpos</span>;
</span><span id="14696" class="l"><a href="#14696">14696: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;InFooter)) {
</span><span id="14697" class="l"><a href="#14697">14697: </a>                            <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$startlinepage</span>] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>];
</span><span id="14698" class="l"><a href="#14698">14698: </a>                            <span class="php-var">$midpos</span> = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>];
</span><span id="14699" class="l"><a href="#14699">14699: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="14700" class="l"><a href="#14700">14700: </a>                            <span class="php-var">$midpos</span> = <span class="php-num">0</span>;
</span><span id="14701" class="l"><a href="#14701">14701: </a>                        }
</span><span id="14702" class="l"><a href="#14702">14702: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$midpos</span> &gt; <span class="php-num">0</span>) {
</span><span id="14703" class="l"><a href="#14703">14703: </a>                            <span class="php-var">$pmid</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$startlinepos</span>, (<span class="php-var">$midpos</span> - <span class="php-var">$startlinepos</span>));
</span><span id="14704" class="l"><a href="#14704">14704: </a>                            <span class="php-var">$pend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$midpos</span>);
</span><span id="14705" class="l"><a href="#14705">14705: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="14706" class="l"><a href="#14706">14706: </a>                            <span class="php-var">$pmid</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$startlinepos</span>);
</span><span id="14707" class="l"><a href="#14707">14707: </a>                            <span class="php-var">$pend</span> = <span class="php-quote">''</span>;
</span><span id="14708" class="l"><a href="#14708">14708: </a>                        }
</span><span id="14709" class="l"><a href="#14709">14709: </a>                        <span class="php-keyword1">if</span> ((<span class="php-keyword1">isset</span>(<span class="php-var">$plalign</span>) <span class="php-keyword1">AND</span> (((<span class="php-var">$plalign</span> == <span class="php-quote">'C'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$plalign</span> == <span class="php-quote">'J'</span>) <span class="php-keyword1">OR</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'R'</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;rtl)) <span class="php-keyword1">OR</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'L'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;rtl))))) <span class="php-keyword1">OR</span> (<span class="php-var">$yshift</span> &lt; <span class="php-num">0</span>)) {
</span><span id="14710" class="l"><a href="#14710">14710: </a>                            <span class="php-comment">// calculate shifting amount</span>
</span><span id="14711" class="l"><a href="#14711">14711: </a>                            <span class="php-var">$tw</span> = <span class="php-var">$w</span>;
</span><span id="14712" class="l"><a href="#14712">14712: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'J'</span>) <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;isRTLTextDir() <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;num_columns &gt; <span class="php-num">1</span>)) {
</span><span id="14713" class="l"><a href="#14713">14713: </a>                                <span class="php-var">$tw</span> += <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="14714" class="l"><a href="#14714">14714: </a>                            }
</span><span id="14715" class="l"><a href="#14715">14715: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;lMargin != <span class="php-var">$prevlMargin</span>) {
</span><span id="14716" class="l"><a href="#14716">14716: </a>                                <span class="php-var">$tw</span> += (<span class="php-var">$prevlMargin</span> - <span class="php-var">$this</span>-&gt;lMargin);
</span><span id="14717" class="l"><a href="#14717">14717: </a>                            }
</span><span id="14718" class="l"><a href="#14718">14718: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rMargin != <span class="php-var">$prevrMargin</span>) {
</span><span id="14719" class="l"><a href="#14719">14719: </a>                                <span class="php-var">$tw</span> += (<span class="php-var">$prevrMargin</span> - <span class="php-var">$this</span>-&gt;rMargin);
</span><span id="14720" class="l"><a href="#14720">14720: </a>                            }
</span><span id="14721" class="l"><a href="#14721">14721: </a>                            <span class="php-var">$one_space_width</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>));
</span><span id="14722" class="l"><a href="#14722">14722: </a>                            <span class="php-var">$mdiff</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$tw</span> - <span class="php-var">$linew</span>);
</span><span id="14723" class="l"><a href="#14723">14723: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$plalign</span> == <span class="php-quote">'C'</span>) {
</span><span id="14724" class="l"><a href="#14724">14724: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="14725" class="l"><a href="#14725">14725: </a>                                    <span class="php-var">$t_x</span> = -(<span class="php-var">$mdiff</span> / <span class="php-num">2</span>);
</span><span id="14726" class="l"><a href="#14726">14726: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="14727" class="l"><a href="#14727">14727: </a>                                    <span class="php-var">$t_x</span> = (<span class="php-var">$mdiff</span> / <span class="php-num">2</span>);
</span><span id="14728" class="l"><a href="#14728">14728: </a>                                }
</span><span id="14729" class="l"><a href="#14729">14729: </a>                            } <span class="php-keyword1">elseif</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'R'</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;rtl)) {
</span><span id="14730" class="l"><a href="#14730">14730: </a>                                <span class="php-comment">// right alignment on LTR document</span>
</span><span id="14731" class="l"><a href="#14731">14731: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">')]'</span>)) == (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">' )]'</span>)) + <span class="php-num">1</span>)) {
</span><span id="14732" class="l"><a href="#14732">14732: </a>                                    <span class="php-comment">// remove last space (if any)</span>
</span><span id="14733" class="l"><a href="#14733">14733: </a>                                    <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="14734" class="l"><a href="#14734">14734: </a>                                    <span class="php-var">$mdiff</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$tw</span> - <span class="php-var">$linew</span>);
</span><span id="14735" class="l"><a href="#14735">14735: </a>                                }
</span><span id="14736" class="l"><a href="#14736">14736: </a>                                <span class="php-var">$t_x</span> = <span class="php-var">$mdiff</span>;
</span><span id="14737" class="l"><a href="#14737">14737: </a>                            } <span class="php-keyword1">elseif</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'L'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;rtl)) {
</span><span id="14738" class="l"><a href="#14738">14738: </a>                                <span class="php-comment">// left alignment on RTL document</span>
</span><span id="14739" class="l"><a href="#14739">14739: </a>                                <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>) &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[( '</span>)) == <span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>))) <span class="php-keyword1">OR</span> (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>.<span class="php-keyword2">chr</span>(<span class="php-num">0</span>).<span class="php-keyword2">chr</span>(<span class="php-num">32</span>))) == <span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>))))) {
</span><span id="14740" class="l"><a href="#14740">14740: </a>                                    <span class="php-comment">// remove first space (if any)</span>
</span><span id="14741" class="l"><a href="#14741">14741: </a>                                    <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="14742" class="l"><a href="#14742">14742: </a>                                }
</span><span id="14743" class="l"><a href="#14743">14743: </a>                                <span class="php-keyword1">if</span> ((<span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>) &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">intval</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>)) == (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>))))) {
</span><span id="14744" class="l"><a href="#14744">14744: </a>                                    <span class="php-comment">// remove last space (if any)</span>
</span><span id="14745" class="l"><a href="#14745">14745: </a>                                    <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="14746" class="l"><a href="#14746">14746: </a>                                    <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="14747" class="l"><a href="#14747">14747: </a>                                        <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="14748" class="l"><a href="#14748">14748: </a>                                    }
</span><span id="14749" class="l"><a href="#14749">14749: </a>                                }
</span><span id="14750" class="l"><a href="#14750">14750: </a>                                <span class="php-var">$mdiff</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$tw</span> - <span class="php-var">$linew</span>);
</span><span id="14751" class="l"><a href="#14751">14751: </a>                                <span class="php-var">$t_x</span> = -<span class="php-var">$mdiff</span>;
</span><span id="14752" class="l"><a href="#14752">14752: </a>                            } <span class="php-keyword1">elseif</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'J'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$plalign</span> == <span class="php-var">$lalign</span>)) {
</span><span id="14753" class="l"><a href="#14753">14753: </a>                                <span class="php-comment">// Justification</span>
</span><span id="14754" class="l"><a href="#14754">14754: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="14755" class="l"><a href="#14755">14755: </a>                                    <span class="php-var">$t_x</span> = <span class="php-var">$this</span>-&gt;lMargin - <span class="php-var">$this</span>-&gt;endlinex + <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="14756" class="l"><a href="#14756">14756: </a>                                }
</span><span id="14757" class="l"><a href="#14757">14757: </a>                                <span class="php-var">$no</span> = <span class="php-num">0</span>; <span class="php-comment">// spaces without trim</span>
</span><span id="14758" class="l"><a href="#14758">14758: </a>                                <span class="php-var">$ns</span> = <span class="php-num">0</span>; <span class="php-comment">// spaces with trim</span>
</span><span id="14759" class="l"><a href="#14759">14759: </a>                                <span class="php-var">$pmidtemp</span> = <span class="php-var">$pmid</span>;
</span><span id="14760" class="l"><a href="#14760">14760: </a>                                <span class="php-comment">// escape special characters</span>
</span><span id="14761" class="l"><a href="#14761">14761: </a>                                <span class="php-var">$pmidtemp</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\\\][\(]/x'</span>, <span class="php-quote">'\\#!#OP#!#'</span>, <span class="php-var">$pmidtemp</span>);
</span><span id="14762" class="l"><a href="#14762">14762: </a>                                <span class="php-var">$pmidtemp</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\\\][\)]/x'</span>, <span class="php-quote">'\\#!#CP#!#'</span>, <span class="php-var">$pmidtemp</span>);
</span><span id="14763" class="l"><a href="#14763">14763: </a>                                <span class="php-comment">// search spaces</span>
</span><span id="14764" class="l"><a href="#14764">14764: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match_all</span>(<span class="php-quote">'/\[\(([^\)]*)\)\]/x'</span>, <span class="php-var">$pmidtemp</span>, <span class="php-var">$lnstring</span>, PREG_PATTERN_ORDER)) {
</span><span id="14765" class="l"><a href="#14765">14765: </a>                                    <span class="php-var">$spacestr</span> = <span class="php-var">$this</span>-&gt;getSpaceString();
</span><span id="14766" class="l"><a href="#14766">14766: </a>                                    <span class="php-var">$maxkk</span> = <span class="php-keyword2">count</span>(<span class="php-var">$lnstring</span>[<span class="php-num">1</span>]) - <span class="php-num">1</span>;
</span><span id="14767" class="l"><a href="#14767">14767: </a>                                    <span class="php-keyword1">for</span> (<span class="php-var">$kk</span>=<span class="php-num">0</span>; <span class="php-var">$kk</span> &lt;= <span class="php-var">$maxkk</span>; ++<span class="php-var">$kk</span>) {
</span><span id="14768" class="l"><a href="#14768">14768: </a>                                        <span class="php-comment">// restore special characters</span>
</span><span id="14769" class="l"><a href="#14769">14769: </a>                                        <span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>] = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'#!#OP#!#'</span>, <span class="php-quote">'('</span>, <span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>]);
</span><span id="14770" class="l"><a href="#14770">14770: </a>                                        <span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>] = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'#!#CP#!#'</span>, <span class="php-quote">')'</span>, <span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>]);
</span><span id="14771" class="l"><a href="#14771">14771: </a>                                        <span class="php-keyword1">if</span> (<span class="php-var">$kk</span> == <span class="php-var">$maxkk</span>) {
</span><span id="14772" class="l"><a href="#14772">14772: </a>                                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="14773" class="l"><a href="#14773">14773: </a>                                                <span class="php-var">$tvalue</span> = <span class="php-keyword2">ltrim</span>(<span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>]);
</span><span id="14774" class="l"><a href="#14774">14774: </a>                                            } <span class="php-keyword1">else</span> {
</span><span id="14775" class="l"><a href="#14775">14775: </a>                                                <span class="php-var">$tvalue</span> = <span class="php-keyword2">rtrim</span>(<span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>]);
</span><span id="14776" class="l"><a href="#14776">14776: </a>                                            }
</span><span id="14777" class="l"><a href="#14777">14777: </a>                                        } <span class="php-keyword1">else</span> {
</span><span id="14778" class="l"><a href="#14778">14778: </a>                                            <span class="php-var">$tvalue</span> = <span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>];
</span><span id="14779" class="l"><a href="#14779">14779: </a>                                        }
</span><span id="14780" class="l"><a href="#14780">14780: </a>                                        <span class="php-comment">// store number of spaces on the strings</span>
</span><span id="14781" class="l"><a href="#14781">14781: </a>                                        <span class="php-var">$lnstring</span>[<span class="php-num">2</span>][<span class="php-var">$kk</span>] = <span class="php-keyword2">substr_count</span>(<span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$kk</span>], <span class="php-var">$spacestr</span>);
</span><span id="14782" class="l"><a href="#14782">14782: </a>                                        <span class="php-var">$lnstring</span>[<span class="php-num">3</span>][<span class="php-var">$kk</span>] = <span class="php-keyword2">substr_count</span>(<span class="php-var">$tvalue</span>, <span class="php-var">$spacestr</span>);
</span><span id="14783" class="l"><a href="#14783">14783: </a>                                        <span class="php-comment">// count total spaces on line</span>
</span><span id="14784" class="l"><a href="#14784">14784: </a>                                        <span class="php-var">$no</span> += <span class="php-var">$lnstring</span>[<span class="php-num">2</span>][<span class="php-var">$kk</span>];
</span><span id="14785" class="l"><a href="#14785">14785: </a>                                        <span class="php-var">$ns</span> += <span class="php-var">$lnstring</span>[<span class="php-num">3</span>][<span class="php-var">$kk</span>];
</span><span id="14786" class="l"><a href="#14786">14786: </a>                                        <span class="php-var">$lnstring</span>[<span class="php-num">4</span>][<span class="php-var">$kk</span>] = <span class="php-var">$no</span>;
</span><span id="14787" class="l"><a href="#14787">14787: </a>                                        <span class="php-var">$lnstring</span>[<span class="php-num">5</span>][<span class="php-var">$kk</span>] = <span class="php-var">$ns</span>;
</span><span id="14788" class="l"><a href="#14788">14788: </a>                                    }
</span><span id="14789" class="l"><a href="#14789">14789: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="14790" class="l"><a href="#14790">14790: </a>                                        <span class="php-var">$t_x</span> = <span class="php-var">$this</span>-&gt;lMargin - <span class="php-var">$this</span>-&gt;endlinex + <span class="php-var">$this</span>-&gt;cMargin - ((<span class="php-var">$no</span> - <span class="php-var">$ns</span>) * <span class="php-var">$one_space_width</span>);
</span><span id="14791" class="l"><a href="#14791">14791: </a>                                    }
</span><span id="14792" class="l"><a href="#14792">14792: </a>                                    <span class="php-comment">// calculate additional space to add to each space</span>
</span><span id="14793" class="l"><a href="#14793">14793: </a>                                    <span class="php-var">$spacelen</span> = <span class="php-var">$one_space_width</span>;
</span><span id="14794" class="l"><a href="#14794">14794: </a>                                    <span class="php-var">$spacewidth</span> = (((<span class="php-var">$tw</span> - <span class="php-var">$linew</span>) + ((<span class="php-var">$no</span> - <span class="php-var">$ns</span>) * <span class="php-var">$spacelen</span>)) / (<span class="php-var">$ns</span>?<span class="php-var">$ns</span>:<span class="php-num">1</span>)) * <span class="php-var">$this</span>-&gt;k;
</span><span id="14795" class="l"><a href="#14795">14795: </a>                                    <span class="php-var">$spacewidthu</span> = -<span class="php-num">1000</span> * ((<span class="php-var">$tw</span> - <span class="php-var">$linew</span>) + (<span class="php-var">$no</span> * <span class="php-var">$spacelen</span>)) / (<span class="php-var">$ns</span>?<span class="php-var">$ns</span>:<span class="php-num">1</span>) / <span class="php-var">$this</span>-&gt;FontSize;
</span><span id="14796" class="l"><a href="#14796">14796: </a>                                    <span class="php-var">$nsmax</span> = <span class="php-var">$ns</span>;
</span><span id="14797" class="l"><a href="#14797">14797: </a>                                    <span class="php-var">$ns</span> = <span class="php-num">0</span>;
</span><span id="14798" class="l"><a href="#14798">14798: </a>                                    <span class="php-keyword2">reset</span>(<span class="php-var">$lnstring</span>);
</span><span id="14799" class="l"><a href="#14799">14799: </a>                                    <span class="php-var">$offset</span> = <span class="php-num">0</span>;
</span><span id="14800" class="l"><a href="#14800">14800: </a>                                    <span class="php-var">$strcount</span> = <span class="php-num">0</span>;
</span><span id="14801" class="l"><a href="#14801">14801: </a>                                    <span class="php-var">$prev_epsposbeg</span> = <span class="php-num">0</span>;
</span><span id="14802" class="l"><a href="#14802">14802: </a>                                    <span class="php-var">$textpos</span> = <span class="php-num">0</span>;
</span><span id="14803" class="l"><a href="#14803">14803: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="14804" class="l"><a href="#14804">14804: </a>                                        <span class="php-var">$textpos</span> = <span class="php-var">$this</span>-&gt;wPt;
</span><span id="14805" class="l"><a href="#14805">14805: </a>                                    }
</span><span id="14806" class="l"><a href="#14806">14806: </a>                                    <span class="php-keyword1">global</span> <span class="php-var">$spacew</span>;
</span><span id="14807" class="l"><a href="#14807">14807: </a>                                    <span class="php-keyword1">while</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/([0-9\.\+\-]*)[\s](Td|cm|m|l|c|re)[\s]/x'</span>, <span class="php-var">$pmid</span>, <span class="php-var">$strpiece</span>, PREG_OFFSET_CAPTURE, <span class="php-var">$offset</span>) == <span class="php-num">1</span>) {
</span><span id="14808" class="l"><a href="#14808">14808: </a>                                        <span class="php-comment">// check if we are inside a string section '[( ... )]'</span>
</span><span id="14809" class="l"><a href="#14809">14809: </a>                                        <span class="php-var">$stroffset</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>, <span class="php-var">$offset</span>);
</span><span id="14810" class="l"><a href="#14810">14810: </a>                                        <span class="php-keyword1">if</span> ((<span class="php-var">$stroffset</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$stroffset</span> &lt;= <span class="php-var">$strpiece</span>[<span class="php-num">2</span>][<span class="php-num">1</span>])) {
</span><span id="14811" class="l"><a href="#14811">14811: </a>                                            <span class="php-comment">// set offset to the end of string section</span>
</span><span id="14812" class="l"><a href="#14812">14812: </a>                                            <span class="php-var">$offset</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">')]'</span>, <span class="php-var">$stroffset</span>);
</span><span id="14813" class="l"><a href="#14813">14813: </a>                                            <span class="php-keyword1">while</span> ((<span class="php-var">$offset</span> !== <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pmid</span>{(<span class="php-var">$offset</span> - <span class="php-num">1</span>)} == <span class="php-quote">'\\'</span>)) {
</span><span id="14814" class="l"><a href="#14814">14814: </a>                                                <span class="php-var">$offset</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">')]'</span>, (<span class="php-var">$offset</span> + <span class="php-num">1</span>));
</span><span id="14815" class="l"><a href="#14815">14815: </a>                                            }
</span><span id="14816" class="l"><a href="#14816">14816: </a>                                            <span class="php-keyword1">if</span> (<span class="php-var">$offset</span> === <span class="php-keyword1">false</span>) {
</span><span id="14817" class="l"><a href="#14817">14817: </a>                                                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'HTML Justification: malformed PDF code.'</span>);
</span><span id="14818" class="l"><a href="#14818">14818: </a>                                            }
</span><span id="14819" class="l"><a href="#14819">14819: </a>                                            <span class="php-keyword1">continue</span>;
</span><span id="14820" class="l"><a href="#14820">14820: </a>                                        }
</span><span id="14821" class="l"><a href="#14821">14821: </a>                                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="14822" class="l"><a href="#14822">14822: </a>                                            <span class="php-var">$spacew</span> = (<span class="php-var">$spacewidth</span> * (<span class="php-var">$nsmax</span> - <span class="php-var">$ns</span>));
</span><span id="14823" class="l"><a href="#14823">14823: </a>                                        } <span class="php-keyword1">else</span> {
</span><span id="14824" class="l"><a href="#14824">14824: </a>                                            <span class="php-var">$spacew</span> = (<span class="php-var">$spacewidth</span> * <span class="php-var">$ns</span>);
</span><span id="14825" class="l"><a href="#14825">14825: </a>                                        }
</span><span id="14826" class="l"><a href="#14826">14826: </a>                                        <span class="php-var">$offset</span> = <span class="php-var">$strpiece</span>[<span class="php-num">2</span>][<span class="php-num">1</span>] + <span class="php-keyword2">strlen</span>(<span class="php-var">$strpiece</span>[<span class="php-num">2</span>][<span class="php-num">0</span>]);
</span><span id="14827" class="l"><a href="#14827">14827: </a>                                        <span class="php-var">$epsposbeg</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">'q'</span>.<span class="php-var">$this</span>-&gt;epsmarker, <span class="php-var">$offset</span>);
</span><span id="14828" class="l"><a href="#14828">14828: </a>                                        <span class="php-var">$epsposend</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-var">$this</span>-&gt;epsmarker.<span class="php-quote">'Q'</span>, <span class="php-var">$offset</span>) + <span class="php-keyword2">strlen</span>(<span class="php-var">$this</span>-&gt;epsmarker.<span class="php-quote">'Q'</span>);
</span><span id="14829" class="l"><a href="#14829">14829: </a>                                        <span class="php-keyword1">if</span> (((<span class="php-var">$epsposbeg</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$epsposend</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$offset</span> &gt; <span class="php-var">$epsposbeg</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$offset</span> &lt; <span class="php-var">$epsposend</span>))
</span><span id="14830" class="l"><a href="#14830">14830: </a>                                            <span class="php-keyword1">OR</span> ((<span class="php-var">$epsposbeg</span> === <span class="php-keyword1">false</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$epsposend</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$offset</span> &lt; <span class="php-var">$epsposend</span>))) {
</span><span id="14831" class="l"><a href="#14831">14831: </a>                                            <span class="php-comment">// shift EPS images</span>
</span><span id="14832" class="l"><a href="#14832">14832: </a>                                            <span class="php-var">$trx</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'1 0 0 1 %.3F 0 cm'</span>, <span class="php-var">$spacew</span>);
</span><span id="14833" class="l"><a href="#14833">14833: </a>                                            <span class="php-var">$epsposbeg</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">'q'</span>.<span class="php-var">$this</span>-&gt;epsmarker, (<span class="php-var">$prev_epsposbeg</span> - <span class="php-num">6</span>));
</span><span id="14834" class="l"><a href="#14834">14834: </a>                                            <span class="php-var">$pmid_b</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pmid</span>, <span class="php-num">0</span>, <span class="php-var">$epsposbeg</span>);
</span><span id="14835" class="l"><a href="#14835">14835: </a>                                            <span class="php-var">$pmid_m</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pmid</span>, <span class="php-var">$epsposbeg</span>, (<span class="php-var">$epsposend</span> - <span class="php-var">$epsposbeg</span>));
</span><span id="14836" class="l"><a href="#14836">14836: </a>                                            <span class="php-var">$pmid_e</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pmid</span>, <span class="php-var">$epsposend</span>);
</span><span id="14837" class="l"><a href="#14837">14837: </a>                                            <span class="php-var">$pmid</span> = <span class="php-var">$pmid_b</span>.<span class="php-quote">&quot;\nq\n&quot;</span>.<span class="php-var">$trx</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid_m</span>.<span class="php-quote">&quot;\nQ\n&quot;</span>.<span class="php-var">$pmid_e</span>;
</span><span id="14838" class="l"><a href="#14838">14838: </a>                                            <span class="php-var">$offset</span> = <span class="php-var">$epsposend</span>;
</span><span id="14839" class="l"><a href="#14839">14839: </a>                                            <span class="php-keyword1">continue</span>;
</span><span id="14840" class="l"><a href="#14840">14840: </a>
</span><span id="14841" class="l"><a href="#14841">14841: </a>                                        }
</span><span id="14842" class="l"><a href="#14842">14842: </a>                                        <span class="php-var">$prev_epsposbeg</span> = <span class="php-var">$epsposbeg</span>;
</span><span id="14843" class="l"><a href="#14843">14843: </a>                                        <span class="php-var">$currentxpos</span> = <span class="php-num">0</span>;
</span><span id="14844" class="l"><a href="#14844">14844: </a>                                        <span class="php-comment">// shift blocks of code</span>
</span><span id="14845" class="l"><a href="#14845">14845: </a>                                        <span class="php-keyword1">switch</span> (<span class="php-var">$strpiece</span>[<span class="php-num">2</span>][<span class="php-num">0</span>]) {
</span><span id="14846" class="l"><a href="#14846">14846: </a>                                            <span class="php-keyword1">case</span> <span class="php-quote">'Td'</span>:
</span><span id="14847" class="l"><a href="#14847">14847: </a>                                            <span class="php-keyword1">case</span> <span class="php-quote">'cm'</span>:
</span><span id="14848" class="l"><a href="#14848">14848: </a>                                            <span class="php-keyword1">case</span> <span class="php-quote">'m'</span>:
</span><span id="14849" class="l"><a href="#14849">14849: </a>                                            <span class="php-keyword1">case</span> <span class="php-quote">'l'</span>: {
</span><span id="14850" class="l"><a href="#14850">14850: </a>                                                <span class="php-comment">// get current X position</span>
</span><span id="14851" class="l"><a href="#14851">14851: </a>                                                <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/([0-9\.\+\-]*)[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">1</span>][<span class="php-num">0</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">2</span>][<span class="php-num">0</span>].<span class="php-quote">')([\s]*)/x'</span>, <span class="php-var">$pmid</span>, <span class="php-var">$xmatches</span>);
</span><span id="14852" class="l"><a href="#14852">14852: </a>                                                <span class="php-var">$currentxpos</span> = <span class="php-var">$xmatches</span>[<span class="php-num">1</span>];
</span><span id="14853" class="l"><a href="#14853">14853: </a>                                                <span class="php-var">$textpos</span> = <span class="php-var">$currentxpos</span>;
</span><span id="14854" class="l"><a href="#14854">14854: </a>                                                <span class="php-keyword1">if</span> ((<span class="php-var">$strcount</span> &lt;= <span class="php-var">$maxkk</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$strpiece</span>[<span class="php-num">2</span>][<span class="php-num">0</span>] == <span class="php-quote">'Td'</span>)) {
</span><span id="14855" class="l"><a href="#14855">14855: </a>                                                    <span class="php-keyword1">if</span> (<span class="php-var">$strcount</span> == <span class="php-var">$maxkk</span>) {
</span><span id="14856" class="l"><a href="#14856">14856: </a>                                                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="14857" class="l"><a href="#14857">14857: </a>                                                            <span class="php-var">$tvalue</span> = <span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$strcount</span>];
</span><span id="14858" class="l"><a href="#14858">14858: </a>                                                        } <span class="php-keyword1">else</span> {
</span><span id="14859" class="l"><a href="#14859">14859: </a>                                                            <span class="php-var">$tvalue</span> = <span class="php-keyword2">rtrim</span>(<span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$strcount</span>]);
</span><span id="14860" class="l"><a href="#14860">14860: </a>                                                        }
</span><span id="14861" class="l"><a href="#14861">14861: </a>                                                    } <span class="php-keyword1">else</span> {
</span><span id="14862" class="l"><a href="#14862">14862: </a>                                                        <span class="php-var">$tvalue</span> = <span class="php-var">$lnstring</span>[<span class="php-num">1</span>][<span class="php-var">$strcount</span>];
</span><span id="14863" class="l"><a href="#14863">14863: </a>                                                    }
</span><span id="14864" class="l"><a href="#14864">14864: </a>                                                    <span class="php-var">$ns</span> += <span class="php-keyword2">substr_count</span>(<span class="php-var">$tvalue</span>, <span class="php-var">$spacestr</span>);
</span><span id="14865" class="l"><a href="#14865">14865: </a>                                                    ++<span class="php-var">$strcount</span>;
</span><span id="14866" class="l"><a href="#14866">14866: </a>                                                }
</span><span id="14867" class="l"><a href="#14867">14867: </a>                                                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="14868" class="l"><a href="#14868">14868: </a>                                                    <span class="php-var">$spacew</span> = (<span class="php-var">$spacewidth</span> * (<span class="php-var">$nsmax</span> - <span class="php-var">$ns</span>));
</span><span id="14869" class="l"><a href="#14869">14869: </a>                                                }
</span><span id="14870" class="l"><a href="#14870">14870: </a>                                                <span class="php-comment">// justify block</span>
</span><span id="14871" class="l"><a href="#14871">14871: </a>                                                <span class="php-var">$pmid</span> = <span class="php-keyword2">preg_replace_callback</span>(<span class="php-quote">'/([0-9\.\+\-]*)[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">1</span>][<span class="php-num">0</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">2</span>][<span class="php-num">0</span>].<span class="php-quote">')([\s]*)/x'</span>,
</span><span id="14872" class="l"><a href="#14872">14872: </a>                                                    <span class="php-keyword2">create_function</span>(<span class="php-quote">'$matches'</span>, <span class="php-quote">'global $spacew;
</span></span><span id="14873" class="l"><a href="#14873">14873: </a><span class="php-quote">                                                    $newx = sprintf(&quot;%.2F&quot;,(floatval($matches[1]) + $spacew));
</span></span><span id="14874" class="l"><a href="#14874">14874: </a><span class="php-quote">                                                    return &quot;&quot;.$newx.&quot; &quot;.$matches[2].&quot; x*#!#*x&quot;.$matches[3].$matches[4];'</span>), <span class="php-var">$pmid</span>, <span class="php-num">1</span>);
</span><span id="14875" class="l"><a href="#14875">14875: </a>                                                <span class="php-keyword1">break</span>;
</span><span id="14876" class="l"><a href="#14876">14876: </a>                                            }
</span><span id="14877" class="l"><a href="#14877">14877: </a>                                            <span class="php-keyword1">case</span> <span class="php-quote">'re'</span>: {
</span><span id="14878" class="l"><a href="#14878">14878: </a>                                                <span class="php-comment">// justify block</span>
</span><span id="14879" class="l"><a href="#14879">14879: </a>                                                <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/([0-9\.\+\-]*)[\s]([0-9\.\+\-]*)[\s]([0-9\.\+\-]*)[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">1</span>][<span class="php-num">0</span>].<span class="php-quote">')[\s](re)([\s]*)/x'</span>, <span class="php-var">$pmid</span>, <span class="php-var">$xmatches</span>);
</span><span id="14880" class="l"><a href="#14880">14880: </a>                                                <span class="php-var">$currentxpos</span> = <span class="php-var">$xmatches</span>[<span class="php-num">1</span>];
</span><span id="14881" class="l"><a href="#14881">14881: </a>                                                <span class="php-keyword1">global</span> <span class="php-var">$x_diff</span>, <span class="php-var">$w_diff</span>;
</span><span id="14882" class="l"><a href="#14882">14882: </a>                                                <span class="php-var">$x_diff</span> = <span class="php-num">0</span>;
</span><span id="14883" class="l"><a href="#14883">14883: </a>                                                <span class="php-var">$w_diff</span> = <span class="php-num">0</span>;
</span><span id="14884" class="l"><a href="#14884">14884: </a>                                                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) { <span class="php-comment">// RTL</span>
</span><span id="14885" class="l"><a href="#14885">14885: </a>                                                    <span class="php-keyword1">if</span> (<span class="php-var">$currentxpos</span> &lt; <span class="php-var">$textpos</span>) {
</span><span id="14886" class="l"><a href="#14886">14886: </a>                                                        <span class="php-var">$x_diff</span> = (<span class="php-var">$spacewidth</span> * (<span class="php-var">$nsmax</span> - <span class="php-var">$lnstring</span>[<span class="php-num">5</span>][<span class="php-var">$strcount</span>]));
</span><span id="14887" class="l"><a href="#14887">14887: </a>                                                        <span class="php-var">$w_diff</span> = (<span class="php-var">$spacewidth</span> * <span class="php-var">$lnstring</span>[<span class="php-num">3</span>][<span class="php-var">$strcount</span>]);
</span><span id="14888" class="l"><a href="#14888">14888: </a>                                                    } <span class="php-keyword1">else</span> {
</span><span id="14889" class="l"><a href="#14889">14889: </a>                                                        <span class="php-keyword1">if</span> (<span class="php-var">$strcount</span> &gt; <span class="php-num">0</span>) {
</span><span id="14890" class="l"><a href="#14890">14890: </a>                                                            <span class="php-var">$x_diff</span> = (<span class="php-var">$spacewidth</span> * (<span class="php-var">$nsmax</span> - <span class="php-var">$lnstring</span>[<span class="php-num">5</span>][(<span class="php-var">$strcount</span> - <span class="php-num">1</span>)]));
</span><span id="14891" class="l"><a href="#14891">14891: </a>                                                            <span class="php-var">$w_diff</span> = (<span class="php-var">$spacewidth</span> * <span class="php-var">$lnstring</span>[<span class="php-num">3</span>][(<span class="php-var">$strcount</span> - <span class="php-num">1</span>)]);
</span><span id="14892" class="l"><a href="#14892">14892: </a>                                                        }
</span><span id="14893" class="l"><a href="#14893">14893: </a>                                                    }
</span><span id="14894" class="l"><a href="#14894">14894: </a>                                                } <span class="php-keyword1">else</span> { <span class="php-comment">// LTR</span>
</span><span id="14895" class="l"><a href="#14895">14895: </a>                                                    <span class="php-keyword1">if</span> (<span class="php-var">$currentxpos</span> &gt; <span class="php-var">$textpos</span>) {
</span><span id="14896" class="l"><a href="#14896">14896: </a>                                                        <span class="php-keyword1">if</span> (<span class="php-var">$strcount</span> &gt; <span class="php-num">0</span>) {
</span><span id="14897" class="l"><a href="#14897">14897: </a>                                                            <span class="php-var">$x_diff</span> = (<span class="php-var">$spacewidth</span> * <span class="php-var">$lnstring</span>[<span class="php-num">4</span>][(<span class="php-var">$strcount</span> - <span class="php-num">1</span>)]);
</span><span id="14898" class="l"><a href="#14898">14898: </a>                                                        }
</span><span id="14899" class="l"><a href="#14899">14899: </a>                                                        <span class="php-var">$w_diff</span> = (<span class="php-var">$spacewidth</span> * <span class="php-var">$lnstring</span>[<span class="php-num">3</span>][<span class="php-var">$strcount</span>]);
</span><span id="14900" class="l"><a href="#14900">14900: </a>                                                    } <span class="php-keyword1">else</span> {
</span><span id="14901" class="l"><a href="#14901">14901: </a>                                                        <span class="php-keyword1">if</span> (<span class="php-var">$strcount</span> &gt; <span class="php-num">1</span>) {
</span><span id="14902" class="l"><a href="#14902">14902: </a>                                                            <span class="php-var">$x_diff</span> = (<span class="php-var">$spacewidth</span> * <span class="php-var">$lnstring</span>[<span class="php-num">4</span>][(<span class="php-var">$strcount</span> - <span class="php-num">2</span>)]);
</span><span id="14903" class="l"><a href="#14903">14903: </a>                                                        }
</span><span id="14904" class="l"><a href="#14904">14904: </a>                                                        <span class="php-keyword1">if</span> (<span class="php-var">$strcount</span> &gt; <span class="php-num">0</span>) {
</span><span id="14905" class="l"><a href="#14905">14905: </a>                                                            <span class="php-var">$w_diff</span> = (<span class="php-var">$spacewidth</span> * <span class="php-var">$lnstring</span>[<span class="php-num">3</span>][(<span class="php-var">$strcount</span> - <span class="php-num">1</span>)]);
</span><span id="14906" class="l"><a href="#14906">14906: </a>                                                        }
</span><span id="14907" class="l"><a href="#14907">14907: </a>                                                    }
</span><span id="14908" class="l"><a href="#14908">14908: </a>                                                }
</span><span id="14909" class="l"><a href="#14909">14909: </a>                                                <span class="php-var">$pmid</span> = <span class="php-keyword2">preg_replace_callback</span>(<span class="php-quote">'/('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">1</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">2</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">3</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">1</span>][<span class="php-num">0</span>].<span class="php-quote">')[\s](re)([\s]*)/x'</span>,
</span><span id="14910" class="l"><a href="#14910">14910: </a>                                                    <span class="php-keyword2">create_function</span>(<span class="php-quote">'$matches'</span>, <span class="php-quote">'global $x_diff, $w_diff;
</span></span><span id="14911" class="l"><a href="#14911">14911: </a><span class="php-quote">                                                    $newx = sprintf(&quot;%.2F&quot;,(floatval($matches[1]) + $x_diff));
</span></span><span id="14912" class="l"><a href="#14912">14912: </a><span class="php-quote">                                                    $neww = sprintf(&quot;%.2F&quot;,(floatval($matches[3]) + $w_diff));
</span></span><span id="14913" class="l"><a href="#14913">14913: </a><span class="php-quote">                                                    return &quot;&quot;.$newx.&quot; &quot;.$matches[2].&quot; &quot;.$neww.&quot; &quot;.$matches[4].&quot; x*#!#*x&quot;.$matches[5].$matches[6];'</span>), <span class="php-var">$pmid</span>, <span class="php-num">1</span>);
</span><span id="14914" class="l"><a href="#14914">14914: </a>                                                <span class="php-keyword1">break</span>;
</span><span id="14915" class="l"><a href="#14915">14915: </a>                                            }
</span><span id="14916" class="l"><a href="#14916">14916: </a>                                            <span class="php-keyword1">case</span> <span class="php-quote">'c'</span>: {
</span><span id="14917" class="l"><a href="#14917">14917: </a>                                                <span class="php-comment">// get current X position</span>
</span><span id="14918" class="l"><a href="#14918">14918: </a>                                                <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/([0-9\.\+\-]*)[\s]([0-9\.\+\-]*)[\s]([0-9\.\+\-]*)[\s]([0-9\.\+\-]*)[\s]([0-9\.\+\-]*)[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">1</span>][<span class="php-num">0</span>].<span class="php-quote">')[\s](c)([\s]*)/x'</span>, <span class="php-var">$pmid</span>, <span class="php-var">$xmatches</span>);
</span><span id="14919" class="l"><a href="#14919">14919: </a>                                                <span class="php-var">$currentxpos</span> = <span class="php-var">$xmatches</span>[<span class="php-num">1</span>];
</span><span id="14920" class="l"><a href="#14920">14920: </a>                                                <span class="php-comment">// justify block</span>
</span><span id="14921" class="l"><a href="#14921">14921: </a>                                                <span class="php-var">$pmid</span> = <span class="php-keyword2">preg_replace_callback</span>(<span class="php-quote">'/('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">1</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">2</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">3</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">4</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$xmatches</span>[<span class="php-num">5</span>].<span class="php-quote">')[\s]('</span>.<span class="php-var">$strpiece</span>[<span class="php-num">1</span>][<span class="php-num">0</span>].<span class="php-quote">')[\s](c)([\s]*)/x'</span>,
</span><span id="14922" class="l"><a href="#14922">14922: </a>                                                    <span class="php-keyword2">create_function</span>(<span class="php-quote">'$matches'</span>, <span class="php-quote">'global $spacew;
</span></span><span id="14923" class="l"><a href="#14923">14923: </a><span class="php-quote">                                                    $newx1 = sprintf(&quot;%.3F&quot;,(floatval($matches[1]) + $spacew));
</span></span><span id="14924" class="l"><a href="#14924">14924: </a><span class="php-quote">                                                    $newx2 = sprintf(&quot;%.3F&quot;,(floatval($matches[3]) + $spacew));
</span></span><span id="14925" class="l"><a href="#14925">14925: </a><span class="php-quote">                                                    $newx3 = sprintf(&quot;%.3F&quot;,(floatval($matches[5]) + $spacew));
</span></span><span id="14926" class="l"><a href="#14926">14926: </a><span class="php-quote">                                                    return &quot;&quot;.$newx1.&quot; &quot;.$matches[2].&quot; &quot;.$newx2.&quot; &quot;.$matches[4].&quot; &quot;.$newx3.&quot; &quot;.$matches[6].&quot; x*#!#*x&quot;.$matches[7].$matches[8];'</span>), <span class="php-var">$pmid</span>, <span class="php-num">1</span>);
</span><span id="14927" class="l"><a href="#14927">14927: </a>                                                <span class="php-keyword1">break</span>;
</span><span id="14928" class="l"><a href="#14928">14928: </a>                                            }
</span><span id="14929" class="l"><a href="#14929">14929: </a>                                        }
</span><span id="14930" class="l"><a href="#14930">14930: </a>                                        <span class="php-comment">// shift the annotations and links</span>
</span><span id="14931" class="l"><a href="#14931">14931: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="14932" class="l"><a href="#14932">14932: </a>                                            <span class="php-var">$cxpos</span> = (<span class="php-var">$currentxpos</span> / <span class="php-var">$this</span>-&gt;k);
</span><span id="14933" class="l"><a href="#14933">14933: </a>                                            <span class="php-var">$lmpos</span> = (<span class="php-var">$this</span>-&gt;lMargin + <span class="php-var">$this</span>-&gt;cMargin + <span class="php-var">$this</span>-&gt;feps);
</span><span id="14934" class="l"><a href="#14934">14934: </a>                                            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page] <span class="php-keyword1">as</span> <span class="php-var">$pak</span> =&gt; <span class="php-var">$pac</span>) {
</span><span id="14935" class="l"><a href="#14935">14935: </a>                                                <span class="php-keyword1">if</span> ((<span class="php-var">$pac</span>[<span class="php-quote">'y'</span>] &gt;= <span class="php-var">$minstartliney</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$pac</span>[<span class="php-quote">'x'</span>] * <span class="php-var">$this</span>-&gt;k) &gt;= (<span class="php-var">$currentxpos</span> - <span class="php-var">$this</span>-&gt;feps)) <span class="php-keyword1">AND</span> ((<span class="php-var">$pac</span>[<span class="php-quote">'x'</span>] * <span class="php-var">$this</span>-&gt;k) &lt;= (<span class="php-var">$currentxpos</span> + <span class="php-var">$this</span>-&gt;feps))) {
</span><span id="14936" class="l"><a href="#14936">14936: </a>                                                    <span class="php-keyword1">if</span> (<span class="php-var">$cxpos</span> &gt; <span class="php-var">$lmpos</span>) {
</span><span id="14937" class="l"><a href="#14937">14937: </a>                                                        <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pak</span>][<span class="php-quote">'x'</span>] += ((<span class="php-var">$spacew</span> - <span class="php-var">$one_space_width</span>) / <span class="php-var">$this</span>-&gt;k);
</span><span id="14938" class="l"><a href="#14938">14938: </a>                                                        <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pak</span>][<span class="php-quote">'w'</span>] += ((<span class="php-var">$spacewidth</span> * <span class="php-var">$pac</span>[<span class="php-quote">'numspaces'</span>]) / <span class="php-var">$this</span>-&gt;k);
</span><span id="14939" class="l"><a href="#14939">14939: </a>                                                    } <span class="php-keyword1">else</span> {
</span><span id="14940" class="l"><a href="#14940">14940: </a>                                                        <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pak</span>][<span class="php-quote">'w'</span>] += (((<span class="php-var">$spacewidth</span> * <span class="php-var">$pac</span>[<span class="php-quote">'numspaces'</span>]) - <span class="php-var">$one_space_width</span>) / <span class="php-var">$this</span>-&gt;k);
</span><span id="14941" class="l"><a href="#14941">14941: </a>                                                    }
</span><span id="14942" class="l"><a href="#14942">14942: </a>                                                    <span class="php-keyword1">break</span>;
</span><span id="14943" class="l"><a href="#14943">14943: </a>                                                }
</span><span id="14944" class="l"><a href="#14944">14944: </a>                                            }
</span><span id="14945" class="l"><a href="#14945">14945: </a>                                        }
</span><span id="14946" class="l"><a href="#14946">14946: </a>                                    } <span class="php-comment">// end of while</span>
</span><span id="14947" class="l"><a href="#14947">14947: </a>                                    <span class="php-comment">// remove markers</span>
</span><span id="14948" class="l"><a href="#14948">14948: </a>                                    <span class="php-var">$pmid</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'x*#!#*x'</span>, <span class="php-quote">''</span>, <span class="php-var">$pmid</span>);
</span><span id="14949" class="l"><a href="#14949">14949: </a>                                    <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="14950" class="l"><a href="#14950">14950: </a>                                        <span class="php-comment">// multibyte characters</span>
</span><span id="14951" class="l"><a href="#14951">14951: </a>                                        <span class="php-var">$spacew</span> = <span class="php-var">$spacewidthu</span>;
</span><span id="14952" class="l"><a href="#14952">14952: </a>                                        <span class="php-var">$pmidtemp</span> = <span class="php-var">$pmid</span>;
</span><span id="14953" class="l"><a href="#14953">14953: </a>                                        <span class="php-comment">// escape special characters</span>
</span><span id="14954" class="l"><a href="#14954">14954: </a>                                        <span class="php-var">$pmidtemp</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\\\][\(]/x'</span>, <span class="php-quote">'\\#!#OP#!#'</span>, <span class="php-var">$pmidtemp</span>);
</span><span id="14955" class="l"><a href="#14955">14955: </a>                                        <span class="php-var">$pmidtemp</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[\\\][\)]/x'</span>, <span class="php-quote">'\\#!#CP#!#'</span>, <span class="php-var">$pmidtemp</span>);
</span><span id="14956" class="l"><a href="#14956">14956: </a>                                        <span class="php-var">$pmid</span> = <span class="php-keyword2">preg_replace_callback</span>(<span class="php-quote">&quot;/\[\(([^\)]*)\)\]/x&quot;</span>,
</span><span id="14957" class="l"><a href="#14957">14957: </a>                                                    <span class="php-keyword2">create_function</span>(<span class="php-quote">'$matches'</span>, <span class="php-quote">'global $spacew;
</span></span><span id="14958" class="l"><a href="#14958">14958: </a><span class="php-quote">                                                    $matches[1] = str_replace(&quot;#!#OP#!#&quot;, &quot;(&quot;, $matches[1]);
</span></span><span id="14959" class="l"><a href="#14959">14959: </a><span class="php-quote">                                                    $matches[1] = str_replace(&quot;#!#CP#!#&quot;, &quot;)&quot;, $matches[1]);
</span></span><span id="14960" class="l"><a href="#14960">14960: </a><span class="php-quote">                                                    return &quot;[(&quot;.str_replace(chr(0).chr(32), &quot;) &quot;.sprintf(&quot;%.3F&quot;, $spacew).&quot; (&quot;, $matches[1]).&quot;)]&quot;;'</span>), <span class="php-var">$pmidtemp</span>);
</span><span id="14961" class="l"><a href="#14961">14961: </a>                                        <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$startlinepage</span>, <span class="php-var">$pstart</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="14962" class="l"><a href="#14962">14962: </a>                                        <span class="php-var">$endlinepos</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$pstart</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="14963" class="l"><a href="#14963">14963: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="14964" class="l"><a href="#14964">14964: </a>                                        <span class="php-comment">// non-unicode (single-byte characters)</span>
</span><span id="14965" class="l"><a href="#14965">14965: </a>                                        <span class="php-var">$rs</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F Tw'</span>, <span class="php-var">$spacewidth</span>);
</span><span id="14966" class="l"><a href="#14966">14966: </a>                                        <span class="php-var">$pmid</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">&quot;/\[\(/x&quot;</span>, <span class="php-var">$rs</span>.<span class="php-quote">' [('</span>, <span class="php-var">$pmid</span>);
</span><span id="14967" class="l"><a href="#14967">14967: </a>                                        <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$startlinepage</span>, <span class="php-var">$pstart</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\nBT 0 Tw ET\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="14968" class="l"><a href="#14968">14968: </a>                                        <span class="php-var">$endlinepos</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$pstart</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\nBT 0 Tw ET\n&quot;</span>);
</span><span id="14969" class="l"><a href="#14969">14969: </a>                                    }
</span><span id="14970" class="l"><a href="#14970">14970: </a>                                }
</span><span id="14971" class="l"><a href="#14971">14971: </a>                            } <span class="php-comment">// end of J</span>
</span><span id="14972" class="l"><a href="#14972">14972: </a>                        } <span class="php-comment">// end if $startlinex</span>
</span><span id="14973" class="l"><a href="#14973">14973: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$t_x</span> != <span class="php-num">0</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$yshift</span> &lt; <span class="php-num">0</span>)) {
</span><span id="14974" class="l"><a href="#14974">14974: </a>                            <span class="php-comment">// shift the line</span>
</span><span id="14975" class="l"><a href="#14975">14975: </a>                            <span class="php-var">$trx</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'1 0 0 1 %.3F %.3F cm'</span>, (<span class="php-var">$t_x</span> * <span class="php-var">$this</span>-&gt;k), (<span class="php-var">$yshift</span> * <span class="php-var">$this</span>-&gt;k));
</span><span id="14976" class="l"><a href="#14976">14976: </a>                            <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$startlinepage</span>, <span class="php-var">$pstart</span>.<span class="php-quote">&quot;\nq\n&quot;</span>.<span class="php-var">$trx</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\nQ\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="14977" class="l"><a href="#14977">14977: </a>                            <span class="php-var">$endlinepos</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$pstart</span>.<span class="php-quote">&quot;\nq\n&quot;</span>.<span class="php-var">$trx</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\nQ\n&quot;</span>);
</span><span id="14978" class="l"><a href="#14978">14978: </a>                            <span class="php-comment">// shift the annotations and links</span>
</span><span id="14979" class="l"><a href="#14979">14979: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="14980" class="l"><a href="#14980">14980: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page] <span class="php-keyword1">as</span> <span class="php-var">$pak</span> =&gt; <span class="php-var">$pac</span>) {
</span><span id="14981" class="l"><a href="#14981">14981: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$pak</span> &gt;= <span class="php-var">$pask</span>) {
</span><span id="14982" class="l"><a href="#14982">14982: </a>                                        <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pak</span>][<span class="php-quote">'x'</span>] += <span class="php-var">$t_x</span>;
</span><span id="14983" class="l"><a href="#14983">14983: </a>                                        <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pak</span>][<span class="php-quote">'y'</span>] -= <span class="php-var">$yshift</span>;
</span><span id="14984" class="l"><a href="#14984">14984: </a>                                    }
</span><span id="14985" class="l"><a href="#14985">14985: </a>                                }
</span><span id="14986" class="l"><a href="#14986">14986: </a>                            }
</span><span id="14987" class="l"><a href="#14987">14987: </a>                            <span class="php-var">$this</span>-&gt;y -= <span class="php-var">$yshift</span>;
</span><span id="14988" class="l"><a href="#14988">14988: </a>                        }
</span><span id="14989" class="l"><a href="#14989">14989: </a>                    }
</span><span id="14990" class="l"><a href="#14990">14990: </a>                    <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">false</span>;
</span><span id="14991" class="l"><a href="#14991">14991: </a>                    <span class="php-var">$pbrk</span> = <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;lasth);
</span><span id="14992" class="l"><a href="#14992">14992: </a>                    <span class="php-var">$startlinex</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="14993" class="l"><a href="#14993">14993: </a>                    <span class="php-var">$startliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="14994" class="l"><a href="#14994">14994: </a>                    <span class="php-var">$minstartliney</span> = <span class="php-var">$startliney</span>;
</span><span id="14995" class="l"><a href="#14995">14995: </a>                    <span class="php-var">$maxbottomliney</span> = (<span class="php-var">$this</span>-&gt;y + ((<span class="php-var">$fontsize</span> * <span class="php-var">$this</span>-&gt;cell_height_ratio) / <span class="php-var">$this</span>-&gt;k));
</span><span id="14996" class="l"><a href="#14996">14996: </a>                    <span class="php-var">$startlinepage</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="14997" class="l"><a href="#14997">14997: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$endlinepos</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$pbrk</span>)) {
</span><span id="14998" class="l"><a href="#14998">14998: </a>                        <span class="php-var">$startlinepos</span> = <span class="php-var">$endlinepos</span>;
</span><span id="14999" class="l"><a href="#14999">14999: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15000" class="l"><a href="#15000">15000: </a>                        <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;InFooter) {
</span><span id="15001" class="l"><a href="#15001">15001: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="15002" class="l"><a href="#15002">15002: </a>                                <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page];
</span><span id="15003" class="l"><a href="#15003">15003: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15004" class="l"><a href="#15004">15004: </a>                                <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="15005" class="l"><a href="#15005">15005: </a>                            }
</span><span id="15006" class="l"><a href="#15006">15006: </a>                            <span class="php-var">$startlinepos</span> = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page];
</span><span id="15007" class="l"><a href="#15007">15007: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="15008" class="l"><a href="#15008">15008: </a>                            <span class="php-var">$startlinepos</span> = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="15009" class="l"><a href="#15009">15009: </a>                        }
</span><span id="15010" class="l"><a href="#15010">15010: </a>                    }
</span><span id="15011" class="l"><a href="#15011">15011: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$endlinepos</span>);
</span><span id="15012" class="l"><a href="#15012">15012: </a>                    <span class="php-var">$plalign</span> = <span class="php-var">$lalign</span>;
</span><span id="15013" class="l"><a href="#15013">15013: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="15014" class="l"><a href="#15014">15014: </a>                        <span class="php-var">$pask</span> = <span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page]);
</span><span id="15015" class="l"><a href="#15015">15015: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15016" class="l"><a href="#15016">15016: </a>                        <span class="php-var">$pask</span> = <span class="php-num">0</span>;
</span><span id="15017" class="l"><a href="#15017">15017: </a>                    }
</span><span id="15018" class="l"><a href="#15018">15018: </a>                    <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$fontname</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span>);
</span><span id="15019" class="l"><a href="#15019">15019: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$wfill</span>) {
</span><span id="15020" class="l"><a href="#15020">15020: </a>                        <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$this</span>-&gt;bgcolor);
</span><span id="15021" class="l"><a href="#15021">15021: </a>                    }
</span><span id="15022" class="l"><a href="#15022">15022: </a>                } <span class="php-comment">// end newline</span>
</span><span id="15023" class="l"><a href="#15023">15023: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opentagpos</span>)) {
</span><span id="15024" class="l"><a href="#15024">15024: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$opentagpos</span>);
</span><span id="15025" class="l"><a href="#15025">15025: </a>                }
</span><span id="15026" class="l"><a href="#15026">15026: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>]) {
</span><span id="15027" class="l"><a href="#15027">15027: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>]) {
</span><span id="15028" class="l"><a href="#15028">15028: </a>                        <span class="php-comment">// get text indentation (if any)</span>
</span><span id="15029" class="l"><a href="#15029">15029: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'text-indent'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'block'</span>]) {
</span><span id="15030" class="l"><a href="#15030">15030: </a>                            <span class="php-var">$this</span>-&gt;textindent = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'text-indent'</span>];
</span><span id="15031" class="l"><a href="#15031">15031: </a>                            <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">true</span>;
</span><span id="15032" class="l"><a href="#15032">15032: </a>                        }
</span><span id="15033" class="l"><a href="#15033">15033: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'table'</span>) {
</span><span id="15034" class="l"><a href="#15034">15034: </a>                            <span class="php-comment">// available page width</span>
</span><span id="15035" class="l"><a href="#15035">15035: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15036" class="l"><a href="#15036">15036: </a>                                <span class="php-var">$wtmp</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="15037" class="l"><a href="#15037">15037: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15038" class="l"><a href="#15038">15038: </a>                                <span class="php-var">$wtmp</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x;
</span><span id="15039" class="l"><a href="#15039">15039: </a>                            }
</span><span id="15040" class="l"><a href="#15040">15040: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nested'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nested'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="15041" class="l"><a href="#15041">15041: </a>                                <span class="php-comment">// add margin for nested tables</span>
</span><span id="15042" class="l"><a href="#15042">15042: </a>                                <span class="php-var">$wtmp</span> -= <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="15043" class="l"><a href="#15043">15043: </a>                            }
</span><span id="15044" class="l"><a href="#15044">15044: </a>                            <span class="php-comment">// table width</span>
</span><span id="15045" class="l"><a href="#15045">15045: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'width'</span>])) {
</span><span id="15046" class="l"><a href="#15046">15046: </a>                                <span class="php-var">$table_width</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'width'</span>], <span class="php-var">$wtmp</span>, <span class="php-quote">'px'</span>);
</span><span id="15047" class="l"><a href="#15047">15047: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15048" class="l"><a href="#15048">15048: </a>                                <span class="php-var">$table_width</span> = <span class="php-var">$wtmp</span>;
</span><span id="15049" class="l"><a href="#15049">15049: </a>                            }
</span><span id="15050" class="l"><a href="#15050">15050: </a>                        }
</span><span id="15051" class="l"><a href="#15051">15051: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'td'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'th'</span>)) {
</span><span id="15052" class="l"><a href="#15052">15052: </a>                            <span class="php-var">$trid</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>];
</span><span id="15053" class="l"><a href="#15053">15053: </a>                            <span class="php-var">$table_el</span> = <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'parent'</span>];
</span><span id="15054" class="l"><a href="#15054">15054: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'cols'</span>])) {
</span><span id="15055" class="l"><a href="#15055">15055: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'cols'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'cols'</span>];
</span><span id="15056" class="l"><a href="#15056">15056: </a>                            }
</span><span id="15057" class="l"><a href="#15057">15057: </a>                            <span class="php-var">$oldmargin</span> = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="15058" class="l"><a href="#15058">15058: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellpadding'</span>])) {
</span><span id="15059" class="l"><a href="#15059">15059: </a>                                <span class="php-var">$currentcmargin</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellpadding'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>);
</span><span id="15060" class="l"><a href="#15060">15060: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15061" class="l"><a href="#15061">15061: </a>                                <span class="php-var">$currentcmargin</span> = <span class="php-num">0</span>;
</span><span id="15062" class="l"><a href="#15062">15062: </a>                            }
</span><span id="15063" class="l"><a href="#15063">15063: </a>                            <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$currentcmargin</span>;
</span><span id="15064" class="l"><a href="#15064">15064: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>])) {
</span><span id="15065" class="l"><a href="#15065">15065: </a>                                <span class="php-var">$cellspacing</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>);
</span><span id="15066" class="l"><a href="#15066">15066: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15067" class="l"><a href="#15067">15067: </a>                                <span class="php-var">$cellspacing</span> = <span class="php-num">0</span>;
</span><span id="15068" class="l"><a href="#15068">15068: </a>                            }
</span><span id="15069" class="l"><a href="#15069">15069: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15070" class="l"><a href="#15070">15070: </a>                                <span class="php-var">$cellspacingx</span> = -<span class="php-var">$cellspacing</span>;
</span><span id="15071" class="l"><a href="#15071">15071: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15072" class="l"><a href="#15072">15072: </a>                                <span class="php-var">$cellspacingx</span> = <span class="php-var">$cellspacing</span>;
</span><span id="15073" class="l"><a href="#15073">15073: </a>                            }
</span><span id="15074" class="l"><a href="#15074">15074: </a>                            <span class="php-var">$colspan</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'colspan'</span>];
</span><span id="15075" class="l"><a href="#15075">15075: </a>                            <span class="php-var">$table_columns_width</span> = (<span class="php-var">$table_width</span> - (<span class="php-var">$cellspacing</span> * (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'cols'</span>] - <span class="php-num">1</span>)));
</span><span id="15076" class="l"><a href="#15076">15076: </a>                            <span class="php-var">$wtmp</span> = (<span class="php-var">$colspan</span> * (<span class="php-var">$table_columns_width</span> / <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'cols'</span>])) + ((<span class="php-var">$colspan</span> - <span class="php-num">1</span>) * <span class="php-var">$cellspacing</span>);
</span><span id="15077" class="l"><a href="#15077">15077: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'width'</span>])) {
</span><span id="15078" class="l"><a href="#15078">15078: </a>                                <span class="php-var">$cellw</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'width'</span>], <span class="php-var">$table_columns_width</span>, <span class="php-quote">'px'</span>);
</span><span id="15079" class="l"><a href="#15079">15079: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15080" class="l"><a href="#15080">15080: </a>                                <span class="php-var">$cellw</span> = <span class="php-var">$wtmp</span>;
</span><span id="15081" class="l"><a href="#15081">15081: </a>                            }
</span><span id="15082" class="l"><a href="#15082">15082: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'height'</span>])) {
</span><span id="15083" class="l"><a href="#15083">15083: </a>                                <span class="php-comment">// minimum cell height</span>
</span><span id="15084" class="l"><a href="#15084">15084: </a>                                <span class="php-var">$cellh</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'height'</span>], <span class="php-num">0</span>, <span class="php-quote">'px'</span>);
</span><span id="15085" class="l"><a href="#15085">15085: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15086" class="l"><a href="#15086">15086: </a>                                <span class="php-var">$cellh</span> = <span class="php-num">0</span>;
</span><span id="15087" class="l"><a href="#15087">15087: </a>                            }
</span><span id="15088" class="l"><a href="#15088">15088: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'content'</span>])) {
</span><span id="15089" class="l"><a href="#15089">15089: </a>                                <span class="php-var">$cell_content</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'content'</span>];
</span><span id="15090" class="l"><a href="#15090">15090: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15091" class="l"><a href="#15091">15091: </a>                                <span class="php-var">$cell_content</span> = <span class="php-quote">'&amp;nbsp;'</span>;
</span><span id="15092" class="l"><a href="#15092">15092: </a>                            }
</span><span id="15093" class="l"><a href="#15093">15093: </a>                            <span class="php-var">$tagtype</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>];
</span><span id="15094" class="l"><a href="#15094">15094: </a>                            <span class="php-var">$parentid</span> = <span class="php-var">$key</span>;
</span><span id="15095" class="l"><a href="#15095">15095: </a>                            <span class="php-keyword1">while</span> ((<span class="php-var">$key</span> &lt; <span class="php-var">$maxel</span>) <span class="php-keyword1">AND</span> (!((<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] == <span class="php-var">$tagtype</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>] == <span class="php-var">$parentid</span>)))) {
</span><span id="15096" class="l"><a href="#15096">15096: </a>                                <span class="php-comment">// move $key index forward</span>
</span><span id="15097" class="l"><a href="#15097">15097: </a>                                ++<span class="php-var">$key</span>;
</span><span id="15098" class="l"><a href="#15098">15098: </a>                            }
</span><span id="15099" class="l"><a href="#15099">15099: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'startpage'</span>])) {
</span><span id="15100" class="l"><a href="#15100">15100: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'startpage'</span>] = <span class="php-var">$this</span>-&gt;page;
</span><span id="15101" class="l"><a href="#15101">15101: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15102" class="l"><a href="#15102">15102: </a>                                <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'startpage'</span>]);
</span><span id="15103" class="l"><a href="#15103">15103: </a>                            }
</span><span id="15104" class="l"><a href="#15104">15104: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'starty'</span>])) {
</span><span id="15105" class="l"><a href="#15105">15105: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'starty'</span>] = <span class="php-var">$this</span>-&gt;y;
</span><span id="15106" class="l"><a href="#15106">15106: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15107" class="l"><a href="#15107">15107: </a>                                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'starty'</span>];
</span><span id="15108" class="l"><a href="#15108">15108: </a>                            }
</span><span id="15109" class="l"><a href="#15109">15109: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'startx'</span>])) {
</span><span id="15110" class="l"><a href="#15110">15110: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'startx'</span>] = <span class="php-var">$this</span>-&gt;x;
</span><span id="15111" class="l"><a href="#15111">15111: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15112" class="l"><a href="#15112">15112: </a>                                <span class="php-var">$this</span>-&gt;x += (<span class="php-var">$cellspacingx</span> / <span class="php-num">2</span>);
</span><span id="15113" class="l"><a href="#15113">15113: </a>                            }
</span><span id="15114" class="l"><a href="#15114">15114: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$parentid</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'rowspan'</span>])) {
</span><span id="15115" class="l"><a href="#15115">15115: </a>                                <span class="php-var">$rowspan</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$dom</span>[<span class="php-var">$parentid</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'rowspan'</span>]);
</span><span id="15116" class="l"><a href="#15116">15116: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15117" class="l"><a href="#15117">15117: </a>                                <span class="php-var">$rowspan</span> = <span class="php-num">1</span>;
</span><span id="15118" class="l"><a href="#15118">15118: </a>                            }
</span><span id="15119" class="l"><a href="#15119">15119: </a>                            <span class="php-comment">// skip row-spanned cells started on the previous rows</span>
</span><span id="15120" class="l"><a href="#15120">15120: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>])) {
</span><span id="15121" class="l"><a href="#15121">15121: </a>                                <span class="php-var">$rsk</span> = <span class="php-num">0</span>;
</span><span id="15122" class="l"><a href="#15122">15122: </a>                                <span class="php-var">$rskmax</span> = <span class="php-keyword2">count</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>]);
</span><span id="15123" class="l"><a href="#15123">15123: </a>                                <span class="php-keyword1">while</span> (<span class="php-var">$rsk</span> &lt; <span class="php-var">$rskmax</span>) {
</span><span id="15124" class="l"><a href="#15124">15124: </a>                                    <span class="php-var">$trwsp</span> = <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$rsk</span>];
</span><span id="15125" class="l"><a href="#15125">15125: </a>                                    <span class="php-var">$rsstartx</span> = <span class="php-var">$trwsp</span>[<span class="php-quote">'startx'</span>];
</span><span id="15126" class="l"><a href="#15126">15126: </a>                                    <span class="php-var">$rsendx</span> = <span class="php-var">$trwsp</span>[<span class="php-quote">'endx'</span>];
</span><span id="15127" class="l"><a href="#15127">15127: </a>                                    <span class="php-comment">// account for margin changes</span>
</span><span id="15128" class="l"><a href="#15128">15128: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'startpage'</span>] &lt; <span class="php-var">$this</span>-&gt;page) {
</span><span id="15129" class="l"><a href="#15129">15129: </a>                                        <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$trwsp</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'orm'</span>])) {
</span><span id="15130" class="l"><a href="#15130">15130: </a>                                            <span class="php-var">$dl</span> = (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$trwsp</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'orm'</span>]);
</span><span id="15131" class="l"><a href="#15131">15131: </a>                                            <span class="php-var">$rsstartx</span> -= <span class="php-var">$dl</span>;
</span><span id="15132" class="l"><a href="#15132">15132: </a>                                            <span class="php-var">$rsendx</span> -= <span class="php-var">$dl</span>;
</span><span id="15133" class="l"><a href="#15133">15133: </a>                                        } <span class="php-keyword1">elseif</span> ((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$trwsp</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'olm'</span>])) {
</span><span id="15134" class="l"><a href="#15134">15134: </a>                                            <span class="php-var">$dl</span> = (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$trwsp</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'olm'</span>]);
</span><span id="15135" class="l"><a href="#15135">15135: </a>                                            <span class="php-var">$rsstartx</span> += <span class="php-var">$dl</span>;
</span><span id="15136" class="l"><a href="#15136">15136: </a>                                            <span class="php-var">$rsendx</span> += <span class="php-var">$dl</span>;
</span><span id="15137" class="l"><a href="#15137">15137: </a>                                        }
</span><span id="15138" class="l"><a href="#15138">15138: </a>                                    }
</span><span id="15139" class="l"><a href="#15139">15139: </a>                                    <span class="php-keyword1">if</span>  ((<span class="php-var">$trwsp</span>[<span class="php-quote">'rowspan'</span>] &gt; <span class="php-num">0</span>)
</span><span id="15140" class="l"><a href="#15140">15140: </a>                                        <span class="php-keyword1">AND</span> (<span class="php-var">$rsstartx</span> &gt; (<span class="php-var">$this</span>-&gt;x - <span class="php-var">$cellspacing</span> - <span class="php-var">$currentcmargin</span> - <span class="php-var">$this</span>-&gt;feps))
</span><span id="15141" class="l"><a href="#15141">15141: </a>                                        <span class="php-keyword1">AND</span> (<span class="php-var">$rsstartx</span> &lt; (<span class="php-var">$this</span>-&gt;x + <span class="php-var">$cellspacing</span> + <span class="php-var">$currentcmargin</span> + <span class="php-var">$this</span>-&gt;feps))
</span><span id="15142" class="l"><a href="#15142">15142: </a>                                        <span class="php-keyword1">AND</span> ((<span class="php-var">$trwsp</span>[<span class="php-quote">'starty'</span>] &lt; (<span class="php-var">$this</span>-&gt;y - <span class="php-var">$this</span>-&gt;feps)) <span class="php-keyword1">OR</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'startpage'</span>] &lt; <span class="php-var">$this</span>-&gt;page))) {
</span><span id="15143" class="l"><a href="#15143">15143: </a>                                        <span class="php-comment">// set the starting X position of the current cell</span>
</span><span id="15144" class="l"><a href="#15144">15144: </a>                                        <span class="php-var">$this</span>-&gt;x = <span class="php-var">$rsendx</span> + <span class="php-var">$cellspacingx</span>;
</span><span id="15145" class="l"><a href="#15145">15145: </a>                                        <span class="php-keyword1">if</span> ((<span class="php-var">$trwsp</span>[<span class="php-quote">'rowspan'</span>] == <span class="php-num">1</span>)
</span><span id="15146" class="l"><a href="#15146">15146: </a>                                            <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>]))
</span><span id="15147" class="l"><a href="#15147">15147: </a>                                            <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]))
</span><span id="15148" class="l"><a href="#15148">15148: </a>                                            <span class="php-keyword1">AND</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'endpage'</span>] == <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>])) {
</span><span id="15149" class="l"><a href="#15149">15149: </a>                                            <span class="php-comment">// set ending Y position for row</span>
</span><span id="15150" class="l"><a href="#15150">15150: </a>                                            <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$rsk</span>][<span class="php-quote">'endy'</span>] = <span class="php-keyword2">max</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>], <span class="php-var">$trwsp</span>[<span class="php-quote">'endy'</span>]);
</span><span id="15151" class="l"><a href="#15151">15151: </a>                                            <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$rsk</span>][<span class="php-quote">'endy'</span>];
</span><span id="15152" class="l"><a href="#15152">15152: </a>                                        }
</span><span id="15153" class="l"><a href="#15153">15153: </a>                                        <span class="php-var">$rsk</span> = <span class="php-num">0</span>;
</span><span id="15154" class="l"><a href="#15154">15154: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="15155" class="l"><a href="#15155">15155: </a>                                        ++<span class="php-var">$rsk</span>;
</span><span id="15156" class="l"><a href="#15156">15156: </a>                                    }
</span><span id="15157" class="l"><a href="#15157">15157: </a>                                }
</span><span id="15158" class="l"><a href="#15158">15158: </a>                            }
</span><span id="15159" class="l"><a href="#15159">15159: </a>                            <span class="php-comment">// add rowspan information to table element</span>
</span><span id="15160" class="l"><a href="#15160">15160: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$rowspan</span> &gt; <span class="php-num">1</span>) {
</span><span id="15161" class="l"><a href="#15161">15161: </a>                                <span class="php-var">$trsid</span> = <span class="php-keyword2">array_push</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>], <span class="php-keyword1">array</span>(<span class="php-quote">'trid'</span> =&gt; <span class="php-var">$trid</span>, <span class="php-quote">'rowspan'</span> =&gt; <span class="php-var">$rowspan</span>, <span class="php-quote">'mrowspan'</span> =&gt; <span class="php-var">$rowspan</span>, <span class="php-quote">'colspan'</span> =&gt; <span class="php-var">$colspan</span>, <span class="php-quote">'startpage'</span> =&gt; <span class="php-var">$this</span>-&gt;page, <span class="php-quote">'startx'</span> =&gt; <span class="php-var">$this</span>-&gt;x, <span class="php-quote">'starty'</span> =&gt; <span class="php-var">$this</span>-&gt;y));
</span><span id="15162" class="l"><a href="#15162">15162: </a>                            }
</span><span id="15163" class="l"><a href="#15163">15163: </a>                            <span class="php-var">$cellid</span> = <span class="php-keyword2">array_push</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'cellpos'</span>], <span class="php-keyword1">array</span>(<span class="php-quote">'startx'</span> =&gt; <span class="php-var">$this</span>-&gt;x));
</span><span id="15164" class="l"><a href="#15164">15164: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$rowspan</span> &gt; <span class="php-num">1</span>) {
</span><span id="15165" class="l"><a href="#15165">15165: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'cellpos'</span>][(<span class="php-var">$cellid</span> - <span class="php-num">1</span>)][<span class="php-quote">'rowspanid'</span>] = (<span class="php-var">$trsid</span> - <span class="php-num">1</span>);
</span><span id="15166" class="l"><a href="#15166">15166: </a>                            }
</span><span id="15167" class="l"><a href="#15167">15167: </a>                            <span class="php-comment">// push background colors</span>
</span><span id="15168" class="l"><a href="#15168">15168: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$parentid</span>][<span class="php-quote">'bgcolor'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$parentid</span>][<span class="php-quote">'bgcolor'</span>] !== <span class="php-keyword1">false</span>)) {
</span><span id="15169" class="l"><a href="#15169">15169: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'cellpos'</span>][(<span class="php-var">$cellid</span> - <span class="php-num">1</span>)][<span class="php-quote">'bgcolor'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$parentid</span>][<span class="php-quote">'bgcolor'</span>];
</span><span id="15170" class="l"><a href="#15170">15170: </a>                            }
</span><span id="15171" class="l"><a href="#15171">15171: </a>                            <span class="php-var">$prevLastH</span> = <span class="php-var">$this</span>-&gt;lasth;
</span><span id="15172" class="l"><a href="#15172">15172: </a>                            <span class="php-comment">// ****** write the cell content ******</span>
</span><span id="15173" class="l"><a href="#15173">15173: </a>                            <span class="php-var">$this</span>-&gt;MultiCell(<span class="php-var">$cellw</span>, <span class="php-var">$cellh</span>, <span class="php-var">$cell_content</span>, <span class="php-keyword1">false</span>, <span class="php-var">$lalign</span>, <span class="php-keyword1">false</span>, <span class="php-num">2</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">true</span>, <span class="php-num">0</span>, <span class="php-keyword1">true</span>);
</span><span id="15174" class="l"><a href="#15174">15174: </a>                            <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$prevLastH</span>;
</span><span id="15175" class="l"><a href="#15175">15175: </a>                            <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$oldmargin</span>;
</span><span id="15176" class="l"><a href="#15176">15176: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'cellpos'</span>][(<span class="php-var">$cellid</span> - <span class="php-num">1</span>)][<span class="php-quote">'endx'</span>] = <span class="php-var">$this</span>-&gt;x;
</span><span id="15177" class="l"><a href="#15177">15177: </a>                            <span class="php-comment">// update the end of row position</span>
</span><span id="15178" class="l"><a href="#15178">15178: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$rowspan</span> &lt;= <span class="php-num">1</span>) {
</span><span id="15179" class="l"><a href="#15179">15179: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>])) {
</span><span id="15180" class="l"><a href="#15180">15180: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page == <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]) {
</span><span id="15181" class="l"><a href="#15181">15181: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>] = <span class="php-keyword2">max</span>(<span class="php-var">$this</span>-&gt;y, <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>]);
</span><span id="15182" class="l"><a href="#15182">15182: </a>                                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]) {
</span><span id="15183" class="l"><a href="#15183">15183: </a>                                        <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$this</span>-&gt;y;
</span><span id="15184" class="l"><a href="#15184">15184: </a>                                    }
</span><span id="15185" class="l"><a href="#15185">15185: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="15186" class="l"><a href="#15186">15186: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$this</span>-&gt;y;
</span><span id="15187" class="l"><a href="#15187">15187: </a>                                }
</span><span id="15188" class="l"><a href="#15188">15188: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>])) {
</span><span id="15189" class="l"><a href="#15189">15189: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>] = <span class="php-keyword2">max</span>(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]);
</span><span id="15190" class="l"><a href="#15190">15190: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="15191" class="l"><a href="#15191">15191: </a>                                    <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>] = <span class="php-var">$this</span>-&gt;page;
</span><span id="15192" class="l"><a href="#15192">15192: </a>                                }
</span><span id="15193" class="l"><a href="#15193">15193: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15194" class="l"><a href="#15194">15194: </a>                                <span class="php-comment">// account for row-spanned cells</span>
</span><span id="15195" class="l"><a href="#15195">15195: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][(<span class="php-var">$trsid</span> - <span class="php-num">1</span>)][<span class="php-quote">'endx'</span>] = <span class="php-var">$this</span>-&gt;x;
</span><span id="15196" class="l"><a href="#15196">15196: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][(<span class="php-var">$trsid</span> - <span class="php-num">1</span>)][<span class="php-quote">'endy'</span>] = <span class="php-var">$this</span>-&gt;y;
</span><span id="15197" class="l"><a href="#15197">15197: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][(<span class="php-var">$trsid</span> - <span class="php-num">1</span>)][<span class="php-quote">'endpage'</span>] = <span class="php-var">$this</span>-&gt;page;
</span><span id="15198" class="l"><a href="#15198">15198: </a>                            }
</span><span id="15199" class="l"><a href="#15199">15199: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>])) {
</span><span id="15200" class="l"><a href="#15200">15200: </a>                                <span class="php-comment">// update endy and endpage on rowspanned cells</span>
</span><span id="15201" class="l"><a href="#15201">15201: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$trwsp</span>) {
</span><span id="15202" class="l"><a href="#15202">15202: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'rowspan'</span>] &gt; <span class="php-num">0</span>) {
</span><span id="15203" class="l"><a href="#15203">15203: </a>                                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>])) {
</span><span id="15204" class="l"><a href="#15204">15204: </a>                                            <span class="php-keyword1">if</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'endpage'</span>] == <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]) {
</span><span id="15205" class="l"><a href="#15205">15205: </a>                                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>] = <span class="php-keyword2">max</span>(<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>], <span class="php-var">$trwsp</span>[<span class="php-quote">'endy'</span>]);
</span><span id="15206" class="l"><a href="#15206">15206: </a>                                            } <span class="php-keyword1">elseif</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'endpage'</span>] &lt; <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]) {
</span><span id="15207" class="l"><a href="#15207">15207: </a>                                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>];
</span><span id="15208" class="l"><a href="#15208">15208: </a>                                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>];
</span><span id="15209" class="l"><a href="#15209">15209: </a>                                            } <span class="php-keyword1">else</span> {
</span><span id="15210" class="l"><a href="#15210">15210: </a>                                                <span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]][<span class="php-quote">'hk'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$dom</span>[<span class="php-var">$trid</span>][<span class="php-quote">'endpage'</span>]][<span class="php-quote">'bm'</span>];
</span><span id="15211" class="l"><a href="#15211">15211: </a>                                            }
</span><span id="15212" class="l"><a href="#15212">15212: </a>                                        }
</span><span id="15213" class="l"><a href="#15213">15213: </a>                                    }
</span><span id="15214" class="l"><a href="#15214">15214: </a>                                }
</span><span id="15215" class="l"><a href="#15215">15215: </a>                            }
</span><span id="15216" class="l"><a href="#15216">15216: </a>                            <span class="php-var">$this</span>-&gt;x += (<span class="php-var">$cellspacingx</span> / <span class="php-num">2</span>);
</span><span id="15217" class="l"><a href="#15217">15217: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="15218" class="l"><a href="#15218">15218: </a>                            <span class="php-comment">// opening tag (or self-closing tag)</span>
</span><span id="15219" class="l"><a href="#15219">15219: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$opentagpos</span>)) {
</span><span id="15220" class="l"><a href="#15220">15220: </a>                                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;InFooter) {
</span><span id="15221" class="l"><a href="#15221">15221: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="15222" class="l"><a href="#15222">15222: </a>                                        <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page];
</span><span id="15223" class="l"><a href="#15223">15223: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="15224" class="l"><a href="#15224">15224: </a>                                        <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page];
</span><span id="15225" class="l"><a href="#15225">15225: </a>                                    }
</span><span id="15226" class="l"><a href="#15226">15226: </a>                                    <span class="php-var">$opentagpos</span> = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page];
</span><span id="15227" class="l"><a href="#15227">15227: </a>                                }
</span><span id="15228" class="l"><a href="#15228">15228: </a>                            }
</span><span id="15229" class="l"><a href="#15229">15229: </a>                            <span class="php-var">$this</span>-&gt;openHTMLTagHandler(<span class="php-var">$dom</span>, <span class="php-var">$key</span>, <span class="php-var">$cell</span>);
</span><span id="15230" class="l"><a href="#15230">15230: </a>                        }
</span><span id="15231" class="l"><a href="#15231">15231: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15232" class="l"><a href="#15232">15232: </a>                        <span class="php-comment">// closing tag</span>
</span><span id="15233" class="l"><a href="#15233">15233: </a>                        <span class="php-var">$this</span>-&gt;closeHTMLTagHandler(<span class="php-var">$dom</span>, <span class="php-var">$key</span>, <span class="php-var">$cell</span>, <span class="php-var">$maxbottomliney</span>);
</span><span id="15234" class="l"><a href="#15234">15234: </a>                    }
</span><span id="15235" class="l"><a href="#15235">15235: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]) &gt; <span class="php-num">0</span>) {
</span><span id="15236" class="l"><a href="#15236">15236: </a>                    <span class="php-comment">// print list-item</span>
</span><span id="15237" class="l"><a href="#15237">15237: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;lispacer)) {
</span><span id="15238" class="l"><a href="#15238">15238: </a>                        <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$pfontname</span>, <span class="php-var">$pfontstyle</span>, <span class="php-var">$pfontsize</span>);
</span><span id="15239" class="l"><a href="#15239">15239: </a>                        <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="15240" class="l"><a href="#15240">15240: </a>                        <span class="php-var">$minstartliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="15241" class="l"><a href="#15241">15241: </a>                        <span class="php-var">$maxbottomliney</span> = (<span class="php-var">$startliney</span> + (<span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio));
</span><span id="15242" class="l"><a href="#15242">15242: </a>                        <span class="php-var">$this</span>-&gt;putHtmlListBullet(<span class="php-var">$this</span>-&gt;listnum, <span class="php-var">$this</span>-&gt;lispacer, <span class="php-var">$pfontsize</span>);
</span><span id="15243" class="l"><a href="#15243">15243: </a>                        <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$curfontname</span>, <span class="php-var">$curfontstyle</span>, <span class="php-var">$curfontsize</span>);
</span><span id="15244" class="l"><a href="#15244">15244: </a>                        <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="15245" class="l"><a href="#15245">15245: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">is_numeric</span>(<span class="php-var">$pfontsize</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pfontsize</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">is_numeric</span>(<span class="php-var">$curfontsize</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$curfontsize</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pfontsize</span> != <span class="php-var">$curfontsize</span>)) {
</span><span id="15246" class="l"><a href="#15246">15246: </a>                            <span class="php-var">$pfontascent</span> = <span class="php-var">$this</span>-&gt;getFontAscent(<span class="php-var">$pfontname</span>, <span class="php-var">$pfontstyle</span>, <span class="php-var">$pfontsize</span>);
</span><span id="15247" class="l"><a href="#15247">15247: </a>                            <span class="php-var">$pfontdescent</span> = <span class="php-var">$this</span>-&gt;getFontDescent(<span class="php-var">$pfontname</span>, <span class="php-var">$pfontstyle</span>, <span class="php-var">$pfontsize</span>);
</span><span id="15248" class="l"><a href="#15248">15248: </a>                            <span class="php-var">$this</span>-&gt;y += (((<span class="php-var">$pfontsize</span> - <span class="php-var">$curfontsize</span>) * <span class="php-var">$this</span>-&gt;cell_height_ratio / <span class="php-var">$this</span>-&gt;k) + <span class="php-var">$pfontascent</span> - <span class="php-var">$curfontascent</span> - <span class="php-var">$pfontdescent</span> + <span class="php-var">$curfontdescent</span>) / <span class="php-num">2</span>;
</span><span id="15249" class="l"><a href="#15249">15249: </a>                            <span class="php-var">$minstartliney</span> = <span class="php-keyword2">min</span>(<span class="php-var">$this</span>-&gt;y, <span class="php-var">$minstartliney</span>);
</span><span id="15250" class="l"><a href="#15250">15250: </a>                            <span class="php-var">$maxbottomliney</span> = <span class="php-keyword2">max</span>((<span class="php-var">$this</span>-&gt;y + ((<span class="php-var">$pfontsize</span> * <span class="php-var">$this</span>-&gt;cell_height_ratio) / <span class="php-var">$this</span>-&gt;k)), <span class="php-var">$maxbottomliney</span>);
</span><span id="15251" class="l"><a href="#15251">15251: </a>                        }
</span><span id="15252" class="l"><a href="#15252">15252: </a>                    }
</span><span id="15253" class="l"><a href="#15253">15253: </a>                    <span class="php-comment">// text</span>
</span><span id="15254" class="l"><a href="#15254">15254: </a>                    <span class="php-var">$this</span>-&gt;htmlvspace = <span class="php-num">0</span>;
</span><span id="15255" class="l"><a href="#15255">15255: </a>                    <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;premode) <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="15256" class="l"><a href="#15256">15256: </a>                        <span class="php-comment">// reverse spaces order</span>
</span><span id="15257" class="l"><a href="#15257">15257: </a>                        <span class="php-var">$len1</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]);
</span><span id="15258" class="l"><a href="#15258">15258: </a>                        <span class="php-var">$lsp</span> = <span class="php-var">$len1</span> - <span class="php-keyword2">strlen</span>(<span class="php-keyword2">ltrim</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]));
</span><span id="15259" class="l"><a href="#15259">15259: </a>                        <span class="php-var">$rsp</span> = <span class="php-var">$len1</span> - <span class="php-keyword2">strlen</span>(<span class="php-keyword2">rtrim</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]));
</span><span id="15260" class="l"><a href="#15260">15260: </a>                        <span class="php-var">$tmpstr</span> = <span class="php-quote">''</span>;
</span><span id="15261" class="l"><a href="#15261">15261: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$rsp</span> &gt; <span class="php-num">0</span>) {
</span><span id="15262" class="l"><a href="#15262">15262: </a>                            <span class="php-var">$tmpstr</span> .= <span class="php-keyword2">substr</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>], -<span class="php-var">$rsp</span>);
</span><span id="15263" class="l"><a href="#15263">15263: </a>                        }
</span><span id="15264" class="l"><a href="#15264">15264: </a>                        <span class="php-var">$tmpstr</span> .= <span class="php-keyword2">trim</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]);
</span><span id="15265" class="l"><a href="#15265">15265: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$lsp</span> &gt; <span class="php-num">0</span>) {
</span><span id="15266" class="l"><a href="#15266">15266: </a>                            <span class="php-var">$tmpstr</span> .= <span class="php-keyword2">substr</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>], <span class="php-num">0</span>, <span class="php-var">$lsp</span>);
</span><span id="15267" class="l"><a href="#15267">15267: </a>                        }
</span><span id="15268" class="l"><a href="#15268">15268: </a>                        <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-var">$tmpstr</span>;
</span><span id="15269" class="l"><a href="#15269">15269: </a>                    }
</span><span id="15270" class="l"><a href="#15270">15270: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$newline</span>) {
</span><span id="15271" class="l"><a href="#15271">15271: </a>                        <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;premode) {
</span><span id="15272" class="l"><a href="#15272">15272: </a>                            <span class="php-var">$prelen</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]);
</span><span id="15273" class="l"><a href="#15273">15273: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="15274" class="l"><a href="#15274">15274: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-keyword2">rtrim</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]).<span class="php-keyword2">chr</span>(<span class="php-num">0</span>);
</span><span id="15275" class="l"><a href="#15275">15275: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15276" class="l"><a href="#15276">15276: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-keyword2">ltrim</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]);
</span><span id="15277" class="l"><a href="#15277">15277: </a>                            }
</span><span id="15278" class="l"><a href="#15278">15278: </a>                            <span class="php-var">$postlen</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]);
</span><span id="15279" class="l"><a href="#15279">15279: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$postlen</span> == <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$prelen</span> &gt; <span class="php-num">0</span>)) {
</span><span id="15280" class="l"><a href="#15280">15280: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'trimmed_space'</span>] = <span class="php-keyword1">true</span>;
</span><span id="15281" class="l"><a href="#15281">15281: </a>                            }
</span><span id="15282" class="l"><a href="#15282">15282: </a>                        }
</span><span id="15283" class="l"><a href="#15283">15283: </a>                        <span class="php-var">$newline</span> = <span class="php-keyword1">false</span>;
</span><span id="15284" class="l"><a href="#15284">15284: </a>                        <span class="php-var">$firstblock</span> = <span class="php-keyword1">true</span>;
</span><span id="15285" class="l"><a href="#15285">15285: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15286" class="l"><a href="#15286">15286: </a>                        <span class="php-var">$firstblock</span> = <span class="php-keyword1">false</span>;
</span><span id="15287" class="l"><a href="#15287">15287: </a>                    }
</span><span id="15288" class="l"><a href="#15288">15288: </a>                    <span class="php-var">$strrest</span> = <span class="php-quote">''</span>;
</span><span id="15289" class="l"><a href="#15289">15289: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15290" class="l"><a href="#15290">15290: </a>                        <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$this</span>-&gt;textindent;
</span><span id="15291" class="l"><a href="#15291">15291: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15292" class="l"><a href="#15292">15292: </a>                        <span class="php-var">$this</span>-&gt;x += <span class="php-var">$this</span>-&gt;textindent;
</span><span id="15293" class="l"><a href="#15293">15293: </a>                    }
</span><span id="15294" class="l"><a href="#15294">15294: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;HREF) <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'url'</span>]))) {
</span><span id="15295" class="l"><a href="#15295">15295: </a>                        <span class="php-comment">// HTML &lt;a&gt; Link</span>
</span><span id="15296" class="l"><a href="#15296">15296: </a>                        <span class="php-var">$strrest</span> = <span class="php-var">$this</span>-&gt;addHtmlLink(<span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'url'</span>], <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>], <span class="php-var">$wfill</span>, <span class="php-keyword1">true</span>, <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'color'</span>], <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'style'</span>], <span class="php-keyword1">true</span>);
</span><span id="15297" class="l"><a href="#15297">15297: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15298" class="l"><a href="#15298">15298: </a>                        <span class="php-comment">// ****** write only until the end of the line and get the rest ******</span>
</span><span id="15299" class="l"><a href="#15299">15299: </a>                        <span class="php-var">$strrest</span> = <span class="php-var">$this</span>-&gt;Write(<span class="php-var">$this</span>-&gt;lasth, <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>], <span class="php-quote">''</span>, <span class="php-var">$wfill</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>, <span class="php-keyword1">true</span>, <span class="php-var">$firstblock</span>, <span class="php-num">0</span>);
</span><span id="15300" class="l"><a href="#15300">15300: </a>                    }
</span><span id="15301" class="l"><a href="#15301">15301: </a>                    <span class="php-var">$this</span>-&gt;textindent = <span class="php-num">0</span>;
</span><span id="15302" class="l"><a href="#15302">15302: </a>
</span><span id="15303" class="l"><a href="#15303">15303: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$strrest</span>) &gt; <span class="php-num">0</span>) {
</span><span id="15304" class="l"><a href="#15304">15304: </a>                        <span class="php-comment">// store the remaining string on the previous $key position</span>
</span><span id="15305" class="l"><a href="#15305">15305: </a>                        <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">true</span>;
</span><span id="15306" class="l"><a href="#15306">15306: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$cell</span>) {
</span><span id="15307" class="l"><a href="#15307">15307: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15308" class="l"><a href="#15308">15308: </a>                                <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="15309" class="l"><a href="#15309">15309: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15310" class="l"><a href="#15310">15310: </a>                                <span class="php-var">$this</span>-&gt;x += <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="15311" class="l"><a href="#15311">15311: </a>                            }
</span><span id="15312" class="l"><a href="#15312">15312: </a>                        }
</span><span id="15313" class="l"><a href="#15313">15313: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$strrest</span> == <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>]) {
</span><span id="15314" class="l"><a href="#15314">15314: </a>                            <span class="php-comment">// used to avoid infinite loop</span>
</span><span id="15315" class="l"><a href="#15315">15315: </a>                            ++<span class="php-var">$loop</span>;
</span><span id="15316" class="l"><a href="#15316">15316: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="15317" class="l"><a href="#15317">15317: </a>                            <span class="php-var">$loop</span> = <span class="php-num">0</span>;
</span><span id="15318" class="l"><a href="#15318">15318: </a>                        }
</span><span id="15319" class="l"><a href="#15319">15319: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;HREF) <span class="php-keyword1">AND</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'url'</span>]))) {
</span><span id="15320" class="l"><a href="#15320">15320: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-keyword2">trim</span>(<span class="php-var">$strrest</span>);
</span><span id="15321" class="l"><a href="#15321">15321: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;premode) {
</span><span id="15322" class="l"><a href="#15322">15322: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-var">$strrest</span>;
</span><span id="15323" class="l"><a href="#15323">15323: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;isRTLTextDir()) {
</span><span id="15324" class="l"><a href="#15324">15324: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-keyword2">rtrim</span>(<span class="php-var">$strrest</span>);
</span><span id="15325" class="l"><a href="#15325">15325: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="15326" class="l"><a href="#15326">15326: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'value'</span>] = <span class="php-keyword2">ltrim</span>(<span class="php-var">$strrest</span>);
</span><span id="15327" class="l"><a href="#15327">15327: </a>                        }
</span><span id="15328" class="l"><a href="#15328">15328: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$loop</span> &lt; <span class="php-num">3</span>) {
</span><span id="15329" class="l"><a href="#15329">15329: </a>                            --<span class="php-var">$key</span>;
</span><span id="15330" class="l"><a href="#15330">15330: </a>                        }
</span><span id="15331" class="l"><a href="#15331">15331: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15332" class="l"><a href="#15332">15332: </a>                        <span class="php-var">$loop</span> = <span class="php-num">0</span>;
</span><span id="15333" class="l"><a href="#15333">15333: </a>                    }
</span><span id="15334" class="l"><a href="#15334">15334: </a>                }
</span><span id="15335" class="l"><a href="#15335">15335: </a>                ++<span class="php-var">$key</span>;
</span><span id="15336" class="l"><a href="#15336">15336: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>]) <span class="php-keyword1">AND</span> <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'tag'</span>] <span class="php-keyword1">AND</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>]) <span class="php-keyword1">OR</span> !<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'opening'</span>]) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nobr'</span>] == <span class="php-quote">'true'</span>)) {
</span><span id="15337" class="l"><a href="#15337">15337: </a>                    <span class="php-keyword1">if</span> ( (!<span class="php-var">$undo</span>) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;start_transaction_page == (<span class="php-var">$this</span>-&gt;numpages - <span class="php-num">1</span>)) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$this</span>-&gt;start_transaction_y))) {
</span><span id="15338" class="l"><a href="#15338">15338: </a>                        <span class="php-comment">// restore previous object</span>
</span><span id="15339" class="l"><a href="#15339">15339: </a>                        <span class="php-var">$this</span>-&gt;rollbackTransaction(<span class="php-keyword1">true</span>);
</span><span id="15340" class="l"><a href="#15340">15340: </a>                        <span class="php-comment">// restore previous values</span>
</span><span id="15341" class="l"><a href="#15341">15341: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$this_method_vars</span> <span class="php-keyword1">as</span> <span class="php-var">$vkey</span> =&gt; <span class="php-var">$vval</span>) {
</span><span id="15342" class="l"><a href="#15342">15342: </a>                            <span class="php-var">$$vkey</span> = <span class="php-var">$vval</span>;
</span><span id="15343" class="l"><a href="#15343">15343: </a>                        }
</span><span id="15344" class="l"><a href="#15344">15344: </a>                        <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="15345" class="l"><a href="#15345">15345: </a>                        <span class="php-var">$pre_y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="15346" class="l"><a href="#15346">15346: </a>                        <span class="php-keyword1">if</span> ((!<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>)) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$pre_y</span>)) {
</span><span id="15347" class="l"><a href="#15347">15347: </a>                            <span class="php-var">$startliney</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="15348" class="l"><a href="#15348">15348: </a>                        }
</span><span id="15349" class="l"><a href="#15349">15349: </a>                        <span class="php-var">$undo</span> = <span class="php-keyword1">true</span>; <span class="php-comment">// avoid infinite loop</span>
</span><span id="15350" class="l"><a href="#15350">15350: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15351" class="l"><a href="#15351">15351: </a>                        <span class="php-var">$undo</span> = <span class="php-keyword1">false</span>;
</span><span id="15352" class="l"><a href="#15352">15352: </a>                    }
</span><span id="15353" class="l"><a href="#15353">15353: </a>                }
</span><span id="15354" class="l"><a href="#15354">15354: </a>            } <span class="php-comment">// end for each $key</span>
</span><span id="15355" class="l"><a href="#15355">15355: </a>            <span class="php-comment">// align the last line</span>
</span><span id="15356" class="l"><a href="#15356">15356: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$startlinex</span>)) {
</span><span id="15357" class="l"><a href="#15357">15357: </a>                <span class="php-var">$yshift</span> = <span class="php-var">$minstartliney</span> - <span class="php-var">$startliney</span>;
</span><span id="15358" class="l"><a href="#15358">15358: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$yshift</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-var">$startlinepage</span>)) {
</span><span id="15359" class="l"><a href="#15359">15359: </a>                    <span class="php-var">$yshift</span> = <span class="php-num">0</span>;
</span><span id="15360" class="l"><a href="#15360">15360: </a>                }
</span><span id="15361" class="l"><a href="#15361">15361: </a>                <span class="php-var">$t_x</span> = <span class="php-num">0</span>;
</span><span id="15362" class="l"><a href="#15362">15362: </a>                <span class="php-comment">// the last line must be shifted to be aligned as requested</span>
</span><span id="15363" class="l"><a href="#15363">15363: </a>                <span class="php-var">$linew</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$this</span>-&gt;endlinex - <span class="php-var">$startlinex</span>);
</span><span id="15364" class="l"><a href="#15364">15364: </a>                <span class="php-var">$pstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-num">0</span>, <span class="php-var">$startlinepos</span>);
</span><span id="15365" class="l"><a href="#15365">15365: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opentagpos</span>) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;InFooter)) {
</span><span id="15366" class="l"><a href="#15366">15366: </a>                    <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$startlinepage</span>] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>];
</span><span id="15367" class="l"><a href="#15367">15367: </a>                    <span class="php-var">$midpos</span> = <span class="php-keyword2">min</span>(<span class="php-var">$opentagpos</span>, <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>]);
</span><span id="15368" class="l"><a href="#15368">15368: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$opentagpos</span>)) {
</span><span id="15369" class="l"><a href="#15369">15369: </a>                    <span class="php-var">$midpos</span> = <span class="php-var">$opentagpos</span>;
</span><span id="15370" class="l"><a href="#15370">15370: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>]) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;InFooter)) {
</span><span id="15371" class="l"><a href="#15371">15371: </a>                    <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$startlinepage</span>] - <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$startlinepage</span>];
</span><span id="15372" class="l"><a href="#15372">15372: </a>                    <span class="php-var">$midpos</span> = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$startlinepage</span>];
</span><span id="15373" class="l"><a href="#15373">15373: </a>                } <span class="php-keyword1">else</span> {
</span><span id="15374" class="l"><a href="#15374">15374: </a>                    <span class="php-var">$midpos</span> = <span class="php-num">0</span>;
</span><span id="15375" class="l"><a href="#15375">15375: </a>                }
</span><span id="15376" class="l"><a href="#15376">15376: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$midpos</span> &gt; <span class="php-num">0</span>) {
</span><span id="15377" class="l"><a href="#15377">15377: </a>                    <span class="php-var">$pmid</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$startlinepos</span>, (<span class="php-var">$midpos</span> - <span class="php-var">$startlinepos</span>));
</span><span id="15378" class="l"><a href="#15378">15378: </a>                    <span class="php-var">$pend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$midpos</span>);
</span><span id="15379" class="l"><a href="#15379">15379: </a>                } <span class="php-keyword1">else</span> {
</span><span id="15380" class="l"><a href="#15380">15380: </a>                    <span class="php-var">$pmid</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$startlinepage</span>), <span class="php-var">$startlinepos</span>);
</span><span id="15381" class="l"><a href="#15381">15381: </a>                    <span class="php-var">$pend</span> = <span class="php-quote">''</span>;
</span><span id="15382" class="l"><a href="#15382">15382: </a>                }
</span><span id="15383" class="l"><a href="#15383">15383: </a>                <span class="php-keyword1">if</span> ((<span class="php-keyword1">isset</span>(<span class="php-var">$plalign</span>) <span class="php-keyword1">AND</span> (((<span class="php-var">$plalign</span> == <span class="php-quote">'C'</span>) <span class="php-keyword1">OR</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'R'</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;rtl)) <span class="php-keyword1">OR</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'L'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;rtl))))) <span class="php-keyword1">OR</span> (<span class="php-var">$yshift</span> &lt; <span class="php-num">0</span>)) {
</span><span id="15384" class="l"><a href="#15384">15384: </a>                    <span class="php-comment">// calculate shifting amount</span>
</span><span id="15385" class="l"><a href="#15385">15385: </a>                    <span class="php-var">$tw</span> = <span class="php-var">$w</span>;
</span><span id="15386" class="l"><a href="#15386">15386: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;lMargin != <span class="php-var">$prevlMargin</span>) {
</span><span id="15387" class="l"><a href="#15387">15387: </a>                        <span class="php-var">$tw</span> += (<span class="php-var">$prevlMargin</span> - <span class="php-var">$this</span>-&gt;lMargin);
</span><span id="15388" class="l"><a href="#15388">15388: </a>                    }
</span><span id="15389" class="l"><a href="#15389">15389: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rMargin != <span class="php-var">$prevrMargin</span>) {
</span><span id="15390" class="l"><a href="#15390">15390: </a>                        <span class="php-var">$tw</span> += (<span class="php-var">$prevrMargin</span> - <span class="php-var">$this</span>-&gt;rMargin);
</span><span id="15391" class="l"><a href="#15391">15391: </a>                    }
</span><span id="15392" class="l"><a href="#15392">15392: </a>                    <span class="php-var">$one_space_width</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>));
</span><span id="15393" class="l"><a href="#15393">15393: </a>                    <span class="php-var">$mdiff</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$tw</span> - <span class="php-var">$linew</span>);
</span><span id="15394" class="l"><a href="#15394">15394: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$plalign</span> == <span class="php-quote">'C'</span>) {
</span><span id="15395" class="l"><a href="#15395">15395: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15396" class="l"><a href="#15396">15396: </a>                            <span class="php-var">$t_x</span> = -(<span class="php-var">$mdiff</span> / <span class="php-num">2</span>);
</span><span id="15397" class="l"><a href="#15397">15397: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="15398" class="l"><a href="#15398">15398: </a>                            <span class="php-var">$t_x</span> = (<span class="php-var">$mdiff</span> / <span class="php-num">2</span>);
</span><span id="15399" class="l"><a href="#15399">15399: </a>                        }
</span><span id="15400" class="l"><a href="#15400">15400: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'R'</span>) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;rtl)) {
</span><span id="15401" class="l"><a href="#15401">15401: </a>                        <span class="php-comment">// right alignment on LTR document</span>
</span><span id="15402" class="l"><a href="#15402">15402: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">')]'</span>)) == (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">' )]'</span>)) + <span class="php-num">1</span>)) {
</span><span id="15403" class="l"><a href="#15403">15403: </a>                            <span class="php-comment">// remove last space (if any)</span>
</span><span id="15404" class="l"><a href="#15404">15404: </a>                            <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="15405" class="l"><a href="#15405">15405: </a>                            <span class="php-var">$mdiff</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$tw</span> - <span class="php-var">$linew</span>);
</span><span id="15406" class="l"><a href="#15406">15406: </a>                        }
</span><span id="15407" class="l"><a href="#15407">15407: </a>                        <span class="php-var">$t_x</span> = <span class="php-var">$mdiff</span>;
</span><span id="15408" class="l"><a href="#15408">15408: </a>                    } <span class="php-keyword1">elseif</span> ((<span class="php-var">$plalign</span> == <span class="php-quote">'L'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;rtl)) {
</span><span id="15409" class="l"><a href="#15409">15409: </a>                        <span class="php-comment">// left alignment on RTL document</span>
</span><span id="15410" class="l"><a href="#15410">15410: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>) &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[( '</span>)) == <span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>))) <span class="php-keyword1">OR</span> (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>.<span class="php-keyword2">chr</span>(<span class="php-num">0</span>).<span class="php-keyword2">chr</span>(<span class="php-num">32</span>))) == <span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>))))) {
</span><span id="15411" class="l"><a href="#15411">15411: </a>                            <span class="php-comment">// remove first space (if any)</span>
</span><span id="15412" class="l"><a href="#15412">15412: </a>                            <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="15413" class="l"><a href="#15413">15413: </a>                        }
</span><span id="15414" class="l"><a href="#15414">15414: </a>                        <span class="php-keyword1">if</span> ((<span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>) &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">intval</span>(<span class="php-keyword2">strpos</span>(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>)) == (<span class="php-keyword2">intval</span>(<span class="php-var">$this</span>-&gt;revstrpos(<span class="php-var">$pmid</span>, <span class="php-quote">'[('</span>))))) {
</span><span id="15415" class="l"><a href="#15415">15415: </a>                            <span class="php-comment">// remove last space (if any)</span>
</span><span id="15416" class="l"><a href="#15416">15416: </a>                            <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="15417" class="l"><a href="#15417">15417: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="15418" class="l"><a href="#15418">15418: </a>                                <span class="php-var">$linew</span> -= <span class="php-var">$one_space_width</span>;
</span><span id="15419" class="l"><a href="#15419">15419: </a>                            }
</span><span id="15420" class="l"><a href="#15420">15420: </a>                        }
</span><span id="15421" class="l"><a href="#15421">15421: </a>                        <span class="php-var">$mdiff</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$tw</span> - <span class="php-var">$linew</span>);
</span><span id="15422" class="l"><a href="#15422">15422: </a>                        <span class="php-var">$t_x</span> = -<span class="php-var">$mdiff</span>;
</span><span id="15423" class="l"><a href="#15423">15423: </a>                    }
</span><span id="15424" class="l"><a href="#15424">15424: </a>                } <span class="php-comment">// end if startlinex</span>
</span><span id="15425" class="l"><a href="#15425">15425: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$t_x</span> != <span class="php-num">0</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$yshift</span> &lt; <span class="php-num">0</span>)) {
</span><span id="15426" class="l"><a href="#15426">15426: </a>                    <span class="php-comment">// shift the line</span>
</span><span id="15427" class="l"><a href="#15427">15427: </a>                    <span class="php-var">$trx</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'1 0 0 1 %.3F %.3F cm'</span>, (<span class="php-var">$t_x</span> * <span class="php-var">$this</span>-&gt;k), (<span class="php-var">$yshift</span> * <span class="php-var">$this</span>-&gt;k));
</span><span id="15428" class="l"><a href="#15428">15428: </a>                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$startlinepage</span>, <span class="php-var">$pstart</span>.<span class="php-quote">&quot;\nq\n&quot;</span>.<span class="php-var">$trx</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\nQ\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="15429" class="l"><a href="#15429">15429: </a>                    <span class="php-var">$endlinepos</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$pstart</span>.<span class="php-quote">&quot;\nq\n&quot;</span>.<span class="php-var">$trx</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pmid</span>.<span class="php-quote">&quot;\nQ\n&quot;</span>);
</span><span id="15430" class="l"><a href="#15430">15430: </a>                    <span class="php-comment">// shift the annotations and links</span>
</span><span id="15431" class="l"><a href="#15431">15431: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page])) {
</span><span id="15432" class="l"><a href="#15432">15432: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page] <span class="php-keyword1">as</span> <span class="php-var">$pak</span> =&gt; <span class="php-var">$pac</span>) {
</span><span id="15433" class="l"><a href="#15433">15433: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$pak</span> &gt;= <span class="php-var">$pask</span>) {
</span><span id="15434" class="l"><a href="#15434">15434: </a>                                <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pak</span>][<span class="php-quote">'x'</span>] += <span class="php-var">$t_x</span>;
</span><span id="15435" class="l"><a href="#15435">15435: </a>                                <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pak</span>][<span class="php-quote">'y'</span>] -= <span class="php-var">$yshift</span>;
</span><span id="15436" class="l"><a href="#15436">15436: </a>                            }
</span><span id="15437" class="l"><a href="#15437">15437: </a>                        }
</span><span id="15438" class="l"><a href="#15438">15438: </a>                    }
</span><span id="15439" class="l"><a href="#15439">15439: </a>                    <span class="php-var">$this</span>-&gt;y -= <span class="php-var">$yshift</span>;
</span><span id="15440" class="l"><a href="#15440">15440: </a>                }
</span><span id="15441" class="l"><a href="#15441">15441: </a>            }
</span><span id="15442" class="l"><a href="#15442">15442: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$ln</span> <span class="php-keyword1">AND</span> (!(<span class="php-var">$cell</span> <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>-<span class="php-num">1</span>][<span class="php-quote">'value'</span>] == <span class="php-quote">'table'</span>)))) {
</span><span id="15443" class="l"><a href="#15443">15443: </a>                <span class="php-var">$this</span>-&gt;Ln(<span class="php-var">$this</span>-&gt;lasth);
</span><span id="15444" class="l"><a href="#15444">15444: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$maxbottomliney</span>) {
</span><span id="15445" class="l"><a href="#15445">15445: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$maxbottomliney</span>;
</span><span id="15446" class="l"><a href="#15446">15446: </a>                }
</span><span id="15447" class="l"><a href="#15447">15447: </a>            }
</span><span id="15448" class="l"><a href="#15448">15448: </a>            <span class="php-comment">// restore previous values</span>
</span><span id="15449" class="l"><a href="#15449">15449: </a>            <span class="php-var">$this</span>-&gt;setGraphicVars(<span class="php-var">$gvars</span>);
</span><span id="15450" class="l"><a href="#15450">15450: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-var">$prevPage</span>) {
</span><span id="15451" class="l"><a href="#15451">15451: </a>                <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>];
</span><span id="15452" class="l"><a href="#15452">15452: </a>                <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>];
</span><span id="15453" class="l"><a href="#15453">15453: </a>            }
</span><span id="15454" class="l"><a href="#15454">15454: </a>            <span class="php-comment">// restore previous list state</span>
</span><span id="15455" class="l"><a href="#15455">15455: </a>            <span class="php-var">$this</span>-&gt;cell_height_ratio = <span class="php-var">$prev_cell_height_ratio</span>;
</span><span id="15456" class="l"><a href="#15456">15456: </a>            <span class="php-var">$this</span>-&gt;listnum = <span class="php-var">$prev_listnum</span>;
</span><span id="15457" class="l"><a href="#15457">15457: </a>            <span class="php-var">$this</span>-&gt;listordered = <span class="php-var">$prev_listordered</span>;
</span><span id="15458" class="l"><a href="#15458">15458: </a>            <span class="php-var">$this</span>-&gt;listcount = <span class="php-var">$prev_listcount</span>;
</span><span id="15459" class="l"><a href="#15459">15459: </a>            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-var">$prev_lispacer</span>;
</span><span id="15460" class="l"><a href="#15460">15460: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$dom</span>);
</span><span id="15461" class="l"><a href="#15461">15461: </a>        }
</span><span id="15462" class="l"><a href="#15462">15462: </a>
</span><span id="15463" class="l"><a href="#15463">15463: </a>        <span class="php-comment">/**
</span></span><span id="15464" class="l"><a href="#15464">15464: </a><span class="php-comment">         * Process opening tags.
</span></span><span id="15465" class="l"><a href="#15465">15465: </a><span class="php-comment">         * @param array $dom html dom array
</span></span><span id="15466" class="l"><a href="#15466">15466: </a><span class="php-comment">         * @param int $key current element id
</span></span><span id="15467" class="l"><a href="#15467">15467: </a><span class="php-comment">         * @param boolean $cell if true add the default cMargin space to each new line (default false).
</span></span><span id="15468" class="l"><a href="#15468">15468: </a><span class="php-comment">         * @access protected
</span></span><span id="15469" class="l"><a href="#15469">15469: </a><span class="php-comment">         */</span>
</span><span id="15470" class="l"><a href="#15470">15470: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> openHTMLTagHandler(&amp;<span class="php-var">$dom</span>, <span class="php-var">$key</span>, <span class="php-var">$cell</span>) {
</span><span id="15471" class="l"><a href="#15471">15471: </a>            <span class="php-var">$tag</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>];
</span><span id="15472" class="l"><a href="#15472">15472: </a>            <span class="php-var">$parent</span> = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])];
</span><span id="15473" class="l"><a href="#15473">15473: </a>            <span class="php-var">$firstorlast</span> = (<span class="php-var">$key</span> == <span class="php-num">1</span>);
</span><span id="15474" class="l"><a href="#15474">15474: </a>            <span class="php-comment">// check for text direction attribute</span>
</span><span id="15475" class="l"><a href="#15475">15475: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'dir'</span>])) {
</span><span id="15476" class="l"><a href="#15476">15476: </a>                <span class="php-var">$this</span>-&gt;setTempRTL(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'dir'</span>]);
</span><span id="15477" class="l"><a href="#15477">15477: </a>            } <span class="php-keyword1">else</span> {
</span><span id="15478" class="l"><a href="#15478">15478: </a>                <span class="php-var">$this</span>-&gt;tmprtl = <span class="php-keyword1">false</span>;
</span><span id="15479" class="l"><a href="#15479">15479: </a>            }
</span><span id="15480" class="l"><a href="#15480">15480: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$tag</span>[<span class="php-quote">'block'</span>]) {
</span><span id="15481" class="l"><a href="#15481">15481: </a>                <span class="php-var">$hbz</span> = <span class="php-num">0</span>; <span class="php-comment">// distance from y to line bottom</span>
</span><span id="15482" class="l"><a href="#15482">15482: </a>                <span class="php-var">$hb</span> = <span class="php-num">0</span>; <span class="php-comment">// vertical space between block tags</span>
</span><span id="15483" class="l"><a href="#15483">15483: </a>                <span class="php-comment">// calculate vertical space for block tags</span>
</span><span id="15484" class="l"><a href="#15484">15484: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">0</span>][<span class="php-quote">'h'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">0</span>][<span class="php-quote">'h'</span>] &gt;= <span class="php-num">0</span>)) {
</span><span id="15485" class="l"><a href="#15485">15485: </a>                    <span class="php-var">$cur_h</span> = <span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">0</span>][<span class="php-quote">'h'</span>];
</span><span id="15486" class="l"><a href="#15486">15486: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'fontsize'</span>])) {
</span><span id="15487" class="l"><a href="#15487">15487: </a>                    <span class="php-var">$cur_h</span> = (<span class="php-var">$tag</span>[<span class="php-quote">'fontsize'</span>] / <span class="php-var">$this</span>-&gt;k) * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="15488" class="l"><a href="#15488">15488: </a>                } <span class="php-keyword1">else</span> {
</span><span id="15489" class="l"><a href="#15489">15489: </a>                    <span class="php-var">$cur_h</span> = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="15490" class="l"><a href="#15490">15490: </a>                }
</span><span id="15491" class="l"><a href="#15491">15491: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">0</span>][<span class="php-quote">'n'</span>])) {
</span><span id="15492" class="l"><a href="#15492">15492: </a>                    <span class="php-var">$n</span> = <span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">0</span>][<span class="php-quote">'n'</span>];
</span><span id="15493" class="l"><a href="#15493">15493: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[h][0-9]/'</span>, <span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]) &gt; <span class="php-num">0</span>) {
</span><span id="15494" class="l"><a href="#15494">15494: </a>                    <span class="php-var">$n</span> = <span class="php-num">0.6</span>;
</span><span id="15495" class="l"><a href="#15495">15495: </a>                } <span class="php-keyword1">else</span> {
</span><span id="15496" class="l"><a href="#15496">15496: </a>                    <span class="php-var">$n</span> = <span class="php-num">1</span>;
</span><span id="15497" class="l"><a href="#15497">15497: </a>                }
</span><span id="15498" class="l"><a href="#15498">15498: </a>                <span class="php-var">$hb</span> = (<span class="php-var">$n</span> * <span class="php-var">$cur_h</span>);
</span><span id="15499" class="l"><a href="#15499">15499: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;htmlvspace &lt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$n</span> &gt; <span class="php-num">0</span>)) {
</span><span id="15500" class="l"><a href="#15500">15500: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'fontsize'</span>])) {
</span><span id="15501" class="l"><a href="#15501">15501: </a>                        <span class="php-var">$hbz</span> = ((<span class="php-var">$parent</span>[<span class="php-quote">'fontsize'</span>] / <span class="php-var">$this</span>-&gt;k) * <span class="php-var">$this</span>-&gt;cell_height_ratio);
</span><span id="15502" class="l"><a href="#15502">15502: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15503" class="l"><a href="#15503">15503: </a>                        <span class="php-var">$hbz</span> = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="15504" class="l"><a href="#15504">15504: </a>                    }
</span><span id="15505" class="l"><a href="#15505">15505: </a>                }
</span><span id="15506" class="l"><a href="#15506">15506: </a>            }
</span><span id="15507" class="l"><a href="#15507">15507: </a>            <span class="php-comment">//Opening tag</span>
</span><span id="15508" class="l"><a href="#15508">15508: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]) {
</span><span id="15509" class="l"><a href="#15509">15509: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'table'</span>: {
</span><span id="15510" class="l"><a href="#15510">15510: </a>                    <span class="php-var">$cp</span> = <span class="php-num">0</span>;
</span><span id="15511" class="l"><a href="#15511">15511: </a>                    <span class="php-var">$cs</span> = <span class="php-num">0</span>;
</span><span id="15512" class="l"><a href="#15512">15512: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'rowspans'</span>] = <span class="php-keyword1">array</span>();
</span><span id="15513" class="l"><a href="#15513">15513: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nested'</span>]) <span class="php-keyword1">OR</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'nested'</span>] != <span class="php-quote">'true'</span>)) {
</span><span id="15514" class="l"><a href="#15514">15514: </a>                        <span class="php-comment">// set table header</span>
</span><span id="15515" class="l"><a href="#15515">15515: </a>                        <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>])) {
</span><span id="15516" class="l"><a href="#15516">15516: </a>                            <span class="php-comment">// set table header</span>
</span><span id="15517" class="l"><a href="#15517">15517: </a>                            <span class="php-var">$this</span>-&gt;thead = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'thead'</span>];
</span><span id="15518" class="l"><a href="#15518">15518: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;theadMargins) <span class="php-keyword1">OR</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$this</span>-&gt;theadMargins))) {
</span><span id="15519" class="l"><a href="#15519">15519: </a>                                <span class="php-var">$this</span>-&gt;theadMargins = <span class="php-keyword1">array</span>();
</span><span id="15520" class="l"><a href="#15520">15520: </a>                                <span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'cmargin'</span>] = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="15521" class="l"><a href="#15521">15521: </a>                            }
</span><span id="15522" class="l"><a href="#15522">15522: </a>                        }
</span><span id="15523" class="l"><a href="#15523">15523: </a>                    }
</span><span id="15524" class="l"><a href="#15524">15524: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellpadding'</span>])) {
</span><span id="15525" class="l"><a href="#15525">15525: </a>                        <span class="php-var">$cp</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellpadding'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>);
</span><span id="15526" class="l"><a href="#15526">15526: </a>                        <span class="php-var">$this</span>-&gt;oldcMargin = <span class="php-var">$this</span>-&gt;cMargin;
</span><span id="15527" class="l"><a href="#15527">15527: </a>                        <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$cp</span>;
</span><span id="15528" class="l"><a href="#15528">15528: </a>                    }
</span><span id="15529" class="l"><a href="#15529">15529: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>])) {
</span><span id="15530" class="l"><a href="#15530">15530: </a>                        <span class="php-var">$cs</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>);
</span><span id="15531" class="l"><a href="#15531">15531: </a>                    }
</span><span id="15532" class="l"><a href="#15532">15532: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;checkPageBreak(((<span class="php-num">2</span> * <span class="php-var">$cp</span>) + (<span class="php-num">2</span> * <span class="php-var">$cs</span>) + <span class="php-var">$this</span>-&gt;lasth), <span class="php-quote">''</span>, <span class="php-keyword1">false</span>)) {
</span><span id="15533" class="l"><a href="#15533">15533: </a>                        <span class="php-var">$this</span>-&gt;inthead = <span class="php-keyword1">true</span>;
</span><span id="15534" class="l"><a href="#15534">15534: </a>                        <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="15535" class="l"><a href="#15535">15535: </a>                        <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>);
</span><span id="15536" class="l"><a href="#15536">15536: </a>                    }
</span><span id="15537" class="l"><a href="#15537">15537: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15538" class="l"><a href="#15538">15538: </a>                }
</span><span id="15539" class="l"><a href="#15539">15539: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'tr'</span>: {
</span><span id="15540" class="l"><a href="#15540">15540: </a>                    <span class="php-comment">// array of columns positions</span>
</span><span id="15541" class="l"><a href="#15541">15541: </a>                    <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'cellpos'</span>] = <span class="php-keyword1">array</span>();
</span><span id="15542" class="l"><a href="#15542">15542: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15543" class="l"><a href="#15543">15543: </a>                }
</span><span id="15544" class="l"><a href="#15544">15544: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'hr'</span>: {
</span><span id="15545" class="l"><a href="#15545">15545: </a>                    <span class="php-var">$wtmp</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;lMargin - <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="15546" class="l"><a href="#15546">15546: </a>                    <span class="php-keyword1">if</span> ((<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>])) <span class="php-keyword1">AND</span> (<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>] != <span class="php-quote">''</span>)) {
</span><span id="15547" class="l"><a href="#15547">15547: </a>                        <span class="php-var">$hrWidth</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>], <span class="php-var">$wtmp</span>, <span class="php-quote">'px'</span>);
</span><span id="15548" class="l"><a href="#15548">15548: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15549" class="l"><a href="#15549">15549: </a>                        <span class="php-var">$hrWidth</span> = <span class="php-var">$wtmp</span>;
</span><span id="15550" class="l"><a href="#15550">15550: </a>                    }
</span><span id="15551" class="l"><a href="#15551">15551: </a>                    <span class="php-keyword1">if</span> ((<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'height'</span>])) <span class="php-keyword1">AND</span> (<span class="php-var">$tag</span>[<span class="php-quote">'height'</span>] != <span class="php-quote">''</span>)) {
</span><span id="15552" class="l"><a href="#15552">15552: </a>                        <span class="php-var">$hrHeight</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tag</span>[<span class="php-quote">'height'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>);
</span><span id="15553" class="l"><a href="#15553">15553: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15554" class="l"><a href="#15554">15554: </a>                        <span class="php-var">$hrHeight</span> = <span class="php-var">$this</span>-&gt;GetLineWidth();
</span><span id="15555" class="l"><a href="#15555">15555: </a>                    }
</span><span id="15556" class="l"><a href="#15556">15556: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, (<span class="php-var">$hrHeight</span> / <span class="php-num">2</span>), <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15557" class="l"><a href="#15557">15557: </a>                    <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;GetX();
</span><span id="15558" class="l"><a href="#15558">15558: </a>                    <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;GetY();
</span><span id="15559" class="l"><a href="#15559">15559: </a>                    <span class="php-var">$prevlinewidth</span> = <span class="php-var">$this</span>-&gt;GetLineWidth();
</span><span id="15560" class="l"><a href="#15560">15560: </a>                    <span class="php-var">$this</span>-&gt;SetLineWidth(<span class="php-var">$hrHeight</span>);
</span><span id="15561" class="l"><a href="#15561">15561: </a>                    <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$x</span> + <span class="php-var">$hrWidth</span>, <span class="php-var">$y</span>);
</span><span id="15562" class="l"><a href="#15562">15562: </a>                    <span class="php-var">$this</span>-&gt;SetLineWidth(<span class="php-var">$prevlinewidth</span>);
</span><span id="15563" class="l"><a href="#15563">15563: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace((<span class="php-var">$hrHeight</span> / <span class="php-num">2</span>), <span class="php-num">0</span>, <span class="php-var">$cell</span>, !<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$key</span> + <span class="php-num">1</span>)]));
</span><span id="15564" class="l"><a href="#15564">15564: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15565" class="l"><a href="#15565">15565: </a>                }
</span><span id="15566" class="l"><a href="#15566">15566: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'a'</span>: {
</span><span id="15567" class="l"><a href="#15567">15567: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">array_key_exists</span>(<span class="php-quote">'href'</span>, <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>])) {
</span><span id="15568" class="l"><a href="#15568">15568: </a>                        <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'url'</span>] = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'href'</span>];
</span><span id="15569" class="l"><a href="#15569">15569: </a>                    }
</span><span id="15570" class="l"><a href="#15570">15570: </a>                    <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'color'</span>] = <span class="php-var">$this</span>-&gt;htmlLinkColorArray;
</span><span id="15571" class="l"><a href="#15571">15571: </a>                    <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'style'</span>] = <span class="php-var">$this</span>-&gt;htmlLinkFontStyle;
</span><span id="15572" class="l"><a href="#15572">15572: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">array_key_exists</span>(<span class="php-quote">'style'</span>, <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>])) {
</span><span id="15573" class="l"><a href="#15573">15573: </a>                        <span class="php-comment">// get style attributes</span>
</span><span id="15574" class="l"><a href="#15574">15574: </a>                        <span class="php-keyword2">preg_match_all</span>(<span class="php-quote">'/([^;:\s]*):([^;]*)/'</span>, <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'style'</span>], <span class="php-var">$style_array</span>, PREG_PATTERN_ORDER);
</span><span id="15575" class="l"><a href="#15575">15575: </a>                        <span class="php-var">$astyle</span> = <span class="php-keyword1">array</span>();
</span><span id="15576" class="l"><a href="#15576">15576: </a>                        <span class="php-keyword1">while</span> (<span class="php-keyword1">list</span>(<span class="php-var">$id</span>, <span class="php-var">$name</span>) = <span class="php-keyword2">each</span>(<span class="php-var">$style_array</span>[<span class="php-num">1</span>])) {
</span><span id="15577" class="l"><a href="#15577">15577: </a>                            <span class="php-var">$name</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$name</span>);
</span><span id="15578" class="l"><a href="#15578">15578: </a>                            <span class="php-var">$astyle</span>[<span class="php-var">$name</span>] = <span class="php-keyword2">trim</span>(<span class="php-var">$style_array</span>[<span class="php-num">2</span>][<span class="php-var">$id</span>]);
</span><span id="15579" class="l"><a href="#15579">15579: </a>                        }
</span><span id="15580" class="l"><a href="#15580">15580: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$astyle</span>[<span class="php-quote">'color'</span>])) {
</span><span id="15581" class="l"><a href="#15581">15581: </a>                            <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'color'</span>] = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$astyle</span>[<span class="php-quote">'color'</span>]);
</span><span id="15582" class="l"><a href="#15582">15582: </a>                        }
</span><span id="15583" class="l"><a href="#15583">15583: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$astyle</span>[<span class="php-quote">'text-decoration'</span>])) {
</span><span id="15584" class="l"><a href="#15584">15584: </a>                            <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'style'</span>] = <span class="php-quote">''</span>;
</span><span id="15585" class="l"><a href="#15585">15585: </a>                            <span class="php-var">$decors</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">' '</span>, <span class="php-keyword2">strtolower</span>(<span class="php-var">$astyle</span>[<span class="php-quote">'text-decoration'</span>]));
</span><span id="15586" class="l"><a href="#15586">15586: </a>                            <span class="php-keyword1">foreach</span> (<span class="php-var">$decors</span> <span class="php-keyword1">as</span> <span class="php-var">$dec</span>) {
</span><span id="15587" class="l"><a href="#15587">15587: </a>                                <span class="php-var">$dec</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$dec</span>);
</span><span id="15588" class="l"><a href="#15588">15588: </a>                                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$dec</span>)) {
</span><span id="15589" class="l"><a href="#15589">15589: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$dec</span>{<span class="php-num">0</span>} == <span class="php-quote">'u'</span>) {
</span><span id="15590" class="l"><a href="#15590">15590: </a>                                        <span class="php-comment">// underline</span>
</span><span id="15591" class="l"><a href="#15591">15591: </a>                                        <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'style'</span>] .= <span class="php-quote">'U'</span>;
</span><span id="15592" class="l"><a href="#15592">15592: </a>                                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$dec</span>{<span class="php-num">0</span>} == <span class="php-quote">'l'</span>) {
</span><span id="15593" class="l"><a href="#15593">15593: </a>                                        <span class="php-comment">// line-trough</span>
</span><span id="15594" class="l"><a href="#15594">15594: </a>                                        <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'style'</span>] .= <span class="php-quote">'D'</span>;
</span><span id="15595" class="l"><a href="#15595">15595: </a>                                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$dec</span>{<span class="php-num">0</span>} == <span class="php-quote">'o'</span>) {
</span><span id="15596" class="l"><a href="#15596">15596: </a>                                        <span class="php-comment">// overline</span>
</span><span id="15597" class="l"><a href="#15597">15597: </a>                                        <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'style'</span>] .= <span class="php-quote">'O'</span>;
</span><span id="15598" class="l"><a href="#15598">15598: </a>                                    }
</span><span id="15599" class="l"><a href="#15599">15599: </a>                                }
</span><span id="15600" class="l"><a href="#15600">15600: </a>                            }
</span><span id="15601" class="l"><a href="#15601">15601: </a>                        }
</span><span id="15602" class="l"><a href="#15602">15602: </a>                    }
</span><span id="15603" class="l"><a href="#15603">15603: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15604" class="l"><a href="#15604">15604: </a>                }
</span><span id="15605" class="l"><a href="#15605">15605: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'img'</span>: {
</span><span id="15606" class="l"><a href="#15606">15606: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>])) {
</span><span id="15607" class="l"><a href="#15607">15607: </a>                        <span class="php-comment">// replace relative path with real server path</span>
</span><span id="15608" class="l"><a href="#15608">15608: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>][<span class="php-num">0</span>] == <span class="php-quote">'/'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$_SERVER</span>[<span class="php-quote">'DOCUMENT_ROOT'</span>] != <span class="php-quote">'/'</span>)) {
</span><span id="15609" class="l"><a href="#15609">15609: </a>                            <span class="php-var">$findroot</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>], <span class="php-var">$_SERVER</span>[<span class="php-quote">'DOCUMENT_ROOT'</span>]);
</span><span id="15610" class="l"><a href="#15610">15610: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$findroot</span> === <span class="php-keyword1">false</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$findroot</span> &gt; <span class="php-num">1</span>)) {
</span><span id="15611" class="l"><a href="#15611">15611: </a>                                <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>] = <span class="php-var">$_SERVER</span>[<span class="php-quote">'DOCUMENT_ROOT'</span>].<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>];
</span><span id="15612" class="l"><a href="#15612">15612: </a>                            }
</span><span id="15613" class="l"><a href="#15613">15613: </a>                        }
</span><span id="15614" class="l"><a href="#15614">15614: </a>                        <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>] = <span class="php-keyword2">urldecode</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>]);
</span><span id="15615" class="l"><a href="#15615">15615: </a>                        <span class="php-var">$type</span> = <span class="php-var">$this</span>-&gt;getImageFileType(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>]);
</span><span id="15616" class="l"><a href="#15616">15616: </a>                        <span class="php-var">$testscrtype</span> = @<span class="php-keyword2">parse_url</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>]);
</span><span id="15617" class="l"><a href="#15617">15617: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$testscrtype</span>[<span class="php-quote">'query'</span>]) <span class="php-keyword1">OR</span> <span class="php-keyword1">empty</span>(<span class="php-var">$testscrtype</span>[<span class="php-quote">'query'</span>])) {
</span><span id="15618" class="l"><a href="#15618">15618: </a>                            <span class="php-comment">// convert URL to server path</span>
</span><span id="15619" class="l"><a href="#15619">15619: </a>                            <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>] = <span class="php-keyword2">str_replace</span>(K_PATH_URL, K_PATH_MAIN, <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>]);
</span><span id="15620" class="l"><a href="#15620">15620: </a>                        }
</span><span id="15621" class="l"><a href="#15621">15621: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>])) {
</span><span id="15622" class="l"><a href="#15622">15622: </a>                            <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>] = <span class="php-num">0</span>;
</span><span id="15623" class="l"><a href="#15623">15623: </a>                        }
</span><span id="15624" class="l"><a href="#15624">15624: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>])) {
</span><span id="15625" class="l"><a href="#15625">15625: </a>                            <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>] = <span class="php-num">0</span>;
</span><span id="15626" class="l"><a href="#15626">15626: </a>                        }
</span><span id="15627" class="l"><a href="#15627">15627: </a>                        <span class="php-comment">//if (!isset($tag['attribute']['align'])) {</span>
</span><span id="15628" class="l"><a href="#15628">15628: </a>                            <span class="php-comment">// the only alignment supported is &quot;bottom&quot;</span>
</span><span id="15629" class="l"><a href="#15629">15629: </a>                            <span class="php-comment">// further development is required for other modes.</span>
</span><span id="15630" class="l"><a href="#15630">15630: </a>                            <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'align'</span>] = <span class="php-quote">'bottom'</span>;
</span><span id="15631" class="l"><a href="#15631">15631: </a>                        <span class="php-comment">//}</span>
</span><span id="15632" class="l"><a href="#15632">15632: </a>                        <span class="php-keyword1">switch</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'align'</span>]) {
</span><span id="15633" class="l"><a href="#15633">15633: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'top'</span>: {
</span><span id="15634" class="l"><a href="#15634">15634: </a>                                <span class="php-var">$align</span> = <span class="php-quote">'T'</span>;
</span><span id="15635" class="l"><a href="#15635">15635: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15636" class="l"><a href="#15636">15636: </a>                            }
</span><span id="15637" class="l"><a href="#15637">15637: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'middle'</span>: {
</span><span id="15638" class="l"><a href="#15638">15638: </a>                                <span class="php-var">$align</span> = <span class="php-quote">'M'</span>;
</span><span id="15639" class="l"><a href="#15639">15639: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15640" class="l"><a href="#15640">15640: </a>                            }
</span><span id="15641" class="l"><a href="#15641">15641: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'bottom'</span>: {
</span><span id="15642" class="l"><a href="#15642">15642: </a>                                <span class="php-var">$align</span> = <span class="php-quote">'B'</span>;
</span><span id="15643" class="l"><a href="#15643">15643: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15644" class="l"><a href="#15644">15644: </a>                            }
</span><span id="15645" class="l"><a href="#15645">15645: </a>                            <span class="php-keyword1">default</span>: {
</span><span id="15646" class="l"><a href="#15646">15646: </a>                                <span class="php-var">$align</span> = <span class="php-quote">'B'</span>;
</span><span id="15647" class="l"><a href="#15647">15647: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15648" class="l"><a href="#15648">15648: </a>                            }
</span><span id="15649" class="l"><a href="#15649">15649: </a>                        }
</span><span id="15650" class="l"><a href="#15650">15650: </a>                        <span class="php-var">$prevy</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="15651" class="l"><a href="#15651">15651: </a>                        <span class="php-var">$xpos</span> = <span class="php-var">$this</span>-&gt;GetX();
</span><span id="15652" class="l"><a href="#15652">15652: </a>                        <span class="php-comment">// eliminate marker spaces</span>
</span><span id="15653" class="l"><a href="#15653">15653: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)])) {
</span><span id="15654" class="l"><a href="#15654">15654: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$dom</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-quote">'value'</span>] == <span class="php-quote">' '</span>) <span class="php-keyword1">OR</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-quote">'trimmed_space'</span>]))) {
</span><span id="15655" class="l"><a href="#15655">15655: </a>                                <span class="php-var">$xpos</span> -= <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>));
</span><span id="15656" class="l"><a href="#15656">15656: </a>                            } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;rtl <span class="php-keyword1">AND</span> <span class="php-var">$dom</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-quote">'value'</span>] == <span class="php-quote">'  '</span>) {
</span><span id="15657" class="l"><a href="#15657">15657: </a>                                <span class="php-var">$xpos</span> -= (<span class="php-num">2</span> * <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>)));
</span><span id="15658" class="l"><a href="#15658">15658: </a>                            }
</span><span id="15659" class="l"><a href="#15659">15659: </a>                        }
</span><span id="15660" class="l"><a href="#15660">15660: </a>                        <span class="php-var">$imglink</span> = <span class="php-quote">''</span>;
</span><span id="15661" class="l"><a href="#15661">15661: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'url'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'url'</span>])) {
</span><span id="15662" class="l"><a href="#15662">15662: </a>                            <span class="php-var">$imglink</span> = <span class="php-var">$this</span>-&gt;HREF[<span class="php-quote">'url'</span>];
</span><span id="15663" class="l"><a href="#15663">15663: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$imglink</span>{<span class="php-num">0</span>} == <span class="php-quote">'#'</span>) {
</span><span id="15664" class="l"><a href="#15664">15664: </a>                                <span class="php-comment">// convert url to internal link</span>
</span><span id="15665" class="l"><a href="#15665">15665: </a>                                <span class="php-var">$page</span> = <span class="php-keyword2">intval</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$imglink</span>, <span class="php-num">1</span>));
</span><span id="15666" class="l"><a href="#15666">15666: </a>                                <span class="php-var">$imglink</span> = <span class="php-var">$this</span>-&gt;AddLink();
</span><span id="15667" class="l"><a href="#15667">15667: </a>                                <span class="php-var">$this</span>-&gt;SetLink(<span class="php-var">$imglink</span>, <span class="php-num">0</span>, <span class="php-var">$page</span>);
</span><span id="15668" class="l"><a href="#15668">15668: </a>                            }
</span><span id="15669" class="l"><a href="#15669">15669: </a>                        }
</span><span id="15670" class="l"><a href="#15670">15670: </a>                        <span class="php-var">$border</span> = <span class="php-num">0</span>;
</span><span id="15671" class="l"><a href="#15671">15671: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'border'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'border'</span>])) {
</span><span id="15672" class="l"><a href="#15672">15672: </a>                            <span class="php-comment">// currently only support 1 (frame) or a combination of 'LTRB'</span>
</span><span id="15673" class="l"><a href="#15673">15673: </a>                            <span class="php-var">$border</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'border'</span>];
</span><span id="15674" class="l"><a href="#15674">15674: </a>                        }
</span><span id="15675" class="l"><a href="#15675">15675: </a>                        <span class="php-var">$iw</span> = <span class="php-quote">''</span>;
</span><span id="15676" class="l"><a href="#15676">15676: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>])) {
</span><span id="15677" class="l"><a href="#15677">15677: </a>                            <span class="php-var">$iw</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'width'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>, <span class="php-keyword1">false</span>);
</span><span id="15678" class="l"><a href="#15678">15678: </a>                        }
</span><span id="15679" class="l"><a href="#15679">15679: </a>                        <span class="php-var">$ih</span> = <span class="php-quote">''</span>;
</span><span id="15680" class="l"><a href="#15680">15680: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>])) {
</span><span id="15681" class="l"><a href="#15681">15681: </a>                            <span class="php-var">$ih</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'height'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>, <span class="php-keyword1">false</span>);
</span><span id="15682" class="l"><a href="#15682">15682: </a>                        }
</span><span id="15683" class="l"><a href="#15683">15683: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$type</span> == <span class="php-quote">'eps'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$type</span> == <span class="php-quote">'ai'</span>)) {
</span><span id="15684" class="l"><a href="#15684">15684: </a>                            <span class="php-var">$this</span>-&gt;ImageEps(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>], <span class="php-var">$xpos</span>, <span class="php-var">$this</span>-&gt;y, <span class="php-var">$iw</span>, <span class="php-var">$ih</span>, <span class="php-var">$imglink</span>, <span class="php-keyword1">true</span>, <span class="php-var">$align</span>, <span class="php-quote">''</span>, <span class="php-var">$border</span>, <span class="php-keyword1">true</span>);
</span><span id="15685" class="l"><a href="#15685">15685: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$type</span> == <span class="php-quote">'svg'</span>) {
</span><span id="15686" class="l"><a href="#15686">15686: </a>                            <span class="php-var">$this</span>-&gt;ImageSVG(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>], <span class="php-var">$xpos</span>, <span class="php-var">$this</span>-&gt;y, <span class="php-var">$iw</span>, <span class="php-var">$ih</span>, <span class="php-var">$imglink</span>, <span class="php-var">$align</span>, <span class="php-quote">''</span>, <span class="php-var">$border</span>, <span class="php-keyword1">true</span>);
</span><span id="15687" class="l"><a href="#15687">15687: </a>                        } <span class="php-keyword1">else</span>  {
</span><span id="15688" class="l"><a href="#15688">15688: </a>                            <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>], <span class="php-var">$xpos</span>, <span class="php-var">$this</span>-&gt;y, <span class="php-var">$iw</span>, <span class="php-var">$ih</span>, <span class="php-quote">''</span>, <span class="php-var">$imglink</span>, <span class="php-var">$align</span>, <span class="php-keyword1">false</span>, <span class="php-num">300</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-var">$border</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">true</span>);
</span><span id="15689" class="l"><a href="#15689">15689: </a>                        }
</span><span id="15690" class="l"><a href="#15690">15690: </a>                        <span class="php-keyword1">switch</span>(<span class="php-var">$align</span>) {
</span><span id="15691" class="l"><a href="#15691">15691: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: {
</span><span id="15692" class="l"><a href="#15692">15692: </a>                                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$prevy</span>;
</span><span id="15693" class="l"><a href="#15693">15693: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15694" class="l"><a href="#15694">15694: </a>                            }
</span><span id="15695" class="l"><a href="#15695">15695: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: {
</span><span id="15696" class="l"><a href="#15696">15696: </a>                                <span class="php-var">$this</span>-&gt;y = ((<span class="php-var">$this</span>-&gt;img_rb_y + <span class="php-var">$prevy</span> - (<span class="php-var">$tag</span>[<span class="php-quote">'fontsize'</span>] / <span class="php-var">$this</span>-&gt;k)) / <span class="php-num">2</span>) ;
</span><span id="15697" class="l"><a href="#15697">15697: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15698" class="l"><a href="#15698">15698: </a>                            }
</span><span id="15699" class="l"><a href="#15699">15699: </a>                            <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>: {
</span><span id="15700" class="l"><a href="#15700">15700: </a>                                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;img_rb_y - (<span class="php-var">$tag</span>[<span class="php-quote">'fontsize'</span>] / <span class="php-var">$this</span>-&gt;k);
</span><span id="15701" class="l"><a href="#15701">15701: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15702" class="l"><a href="#15702">15702: </a>                            }
</span><span id="15703" class="l"><a href="#15703">15703: </a>                        }
</span><span id="15704" class="l"><a href="#15704">15704: </a>                    }
</span><span id="15705" class="l"><a href="#15705">15705: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15706" class="l"><a href="#15706">15706: </a>                }
</span><span id="15707" class="l"><a href="#15707">15707: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'dl'</span>: {
</span><span id="15708" class="l"><a href="#15708">15708: </a>                    ++<span class="php-var">$this</span>-&gt;listnum;
</span><span id="15709" class="l"><a href="#15709">15709: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;listnum == <span class="php-num">1</span>) {
</span><span id="15710" class="l"><a href="#15710">15710: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15711" class="l"><a href="#15711">15711: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15712" class="l"><a href="#15712">15712: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15713" class="l"><a href="#15713">15713: </a>                    }
</span><span id="15714" class="l"><a href="#15714">15714: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15715" class="l"><a href="#15715">15715: </a>                }
</span><span id="15716" class="l"><a href="#15716">15716: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'dt'</span>: {
</span><span id="15717" class="l"><a href="#15717">15717: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15718" class="l"><a href="#15718">15718: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15719" class="l"><a href="#15719">15719: </a>                }
</span><span id="15720" class="l"><a href="#15720">15720: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'dd'</span>: {
</span><span id="15721" class="l"><a href="#15721">15721: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15722" class="l"><a href="#15722">15722: </a>                        <span class="php-var">$this</span>-&gt;rMargin += <span class="php-var">$this</span>-&gt;listindent;
</span><span id="15723" class="l"><a href="#15723">15723: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15724" class="l"><a href="#15724">15724: </a>                        <span class="php-var">$this</span>-&gt;lMargin += <span class="php-var">$this</span>-&gt;listindent;
</span><span id="15725" class="l"><a href="#15725">15725: </a>                    }
</span><span id="15726" class="l"><a href="#15726">15726: </a>                    ++<span class="php-var">$this</span>-&gt;listindentlevel;
</span><span id="15727" class="l"><a href="#15727">15727: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15728" class="l"><a href="#15728">15728: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15729" class="l"><a href="#15729">15729: </a>                }
</span><span id="15730" class="l"><a href="#15730">15730: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'ul'</span>:
</span><span id="15731" class="l"><a href="#15731">15731: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'ol'</span>: {
</span><span id="15732" class="l"><a href="#15732">15732: </a>                    ++<span class="php-var">$this</span>-&gt;listnum;
</span><span id="15733" class="l"><a href="#15733">15733: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>] == <span class="php-quote">'ol'</span>) {
</span><span id="15734" class="l"><a href="#15734">15734: </a>                        <span class="php-var">$this</span>-&gt;listordered[<span class="php-var">$this</span>-&gt;listnum] = <span class="php-keyword1">true</span>;
</span><span id="15735" class="l"><a href="#15735">15735: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15736" class="l"><a href="#15736">15736: </a>                        <span class="php-var">$this</span>-&gt;listordered[<span class="php-var">$this</span>-&gt;listnum] = <span class="php-keyword1">false</span>;
</span><span id="15737" class="l"><a href="#15737">15737: </a>                    }
</span><span id="15738" class="l"><a href="#15738">15738: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'start'</span>])) {
</span><span id="15739" class="l"><a href="#15739">15739: </a>                        <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum] = <span class="php-keyword2">intval</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'start'</span>]) - <span class="php-num">1</span>;
</span><span id="15740" class="l"><a href="#15740">15740: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15741" class="l"><a href="#15741">15741: </a>                        <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum] = <span class="php-num">0</span>;
</span><span id="15742" class="l"><a href="#15742">15742: </a>                    }
</span><span id="15743" class="l"><a href="#15743">15743: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15744" class="l"><a href="#15744">15744: </a>                        <span class="php-var">$this</span>-&gt;rMargin += <span class="php-var">$this</span>-&gt;listindent;
</span><span id="15745" class="l"><a href="#15745">15745: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15746" class="l"><a href="#15746">15746: </a>                        <span class="php-var">$this</span>-&gt;lMargin += <span class="php-var">$this</span>-&gt;listindent;
</span><span id="15747" class="l"><a href="#15747">15747: </a>                    }
</span><span id="15748" class="l"><a href="#15748">15748: </a>                    ++<span class="php-var">$this</span>-&gt;listindentlevel;
</span><span id="15749" class="l"><a href="#15749">15749: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;listnum == <span class="php-num">1</span>) {
</span><span id="15750" class="l"><a href="#15750">15750: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15751" class="l"><a href="#15751">15751: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15752" class="l"><a href="#15752">15752: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15753" class="l"><a href="#15753">15753: </a>                    }
</span><span id="15754" class="l"><a href="#15754">15754: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15755" class="l"><a href="#15755">15755: </a>                }
</span><span id="15756" class="l"><a href="#15756">15756: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'li'</span>: {
</span><span id="15757" class="l"><a href="#15757">15757: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15758" class="l"><a href="#15758">15758: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;listordered[<span class="php-var">$this</span>-&gt;listnum]) {
</span><span id="15759" class="l"><a href="#15759">15759: </a>                        <span class="php-comment">// ordered item</span>
</span><span id="15760" class="l"><a href="#15760">15760: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'type'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$parent</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'type'</span>])) {
</span><span id="15761" class="l"><a href="#15761">15761: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-var">$parent</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'type'</span>];
</span><span id="15762" class="l"><a href="#15762">15762: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'listtype'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$parent</span>[<span class="php-quote">'listtype'</span>])) {
</span><span id="15763" class="l"><a href="#15763">15763: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-var">$parent</span>[<span class="php-quote">'listtype'</span>];
</span><span id="15764" class="l"><a href="#15764">15764: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;lisymbol) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;lisymbol)) {
</span><span id="15765" class="l"><a href="#15765">15765: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-var">$this</span>-&gt;lisymbol;
</span><span id="15766" class="l"><a href="#15766">15766: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="15767" class="l"><a href="#15767">15767: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">'#'</span>;
</span><span id="15768" class="l"><a href="#15768">15768: </a>                        }
</span><span id="15769" class="l"><a href="#15769">15769: </a>                        ++<span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum];
</span><span id="15770" class="l"><a href="#15770">15770: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>])) {
</span><span id="15771" class="l"><a href="#15771">15771: </a>                            <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum] = <span class="php-keyword2">intval</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>]);
</span><span id="15772" class="l"><a href="#15772">15772: </a>                        }
</span><span id="15773" class="l"><a href="#15773">15773: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15774" class="l"><a href="#15774">15774: </a>                        <span class="php-comment">// unordered item</span>
</span><span id="15775" class="l"><a href="#15775">15775: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'type'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$parent</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'type'</span>])) {
</span><span id="15776" class="l"><a href="#15776">15776: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-var">$parent</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'type'</span>];
</span><span id="15777" class="l"><a href="#15777">15777: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'listtype'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$parent</span>[<span class="php-quote">'listtype'</span>])) {
</span><span id="15778" class="l"><a href="#15778">15778: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-var">$parent</span>[<span class="php-quote">'listtype'</span>];
</span><span id="15779" class="l"><a href="#15779">15779: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;lisymbol) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;lisymbol)) {
</span><span id="15780" class="l"><a href="#15780">15780: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-var">$this</span>-&gt;lisymbol;
</span><span id="15781" class="l"><a href="#15781">15781: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="15782" class="l"><a href="#15782">15782: </a>                            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">'!'</span>;
</span><span id="15783" class="l"><a href="#15783">15783: </a>                        }
</span><span id="15784" class="l"><a href="#15784">15784: </a>                    }
</span><span id="15785" class="l"><a href="#15785">15785: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15786" class="l"><a href="#15786">15786: </a>                }
</span><span id="15787" class="l"><a href="#15787">15787: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'blockquote'</span>: {
</span><span id="15788" class="l"><a href="#15788">15788: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="15789" class="l"><a href="#15789">15789: </a>                        <span class="php-var">$this</span>-&gt;rMargin += <span class="php-var">$this</span>-&gt;listindent;
</span><span id="15790" class="l"><a href="#15790">15790: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15791" class="l"><a href="#15791">15791: </a>                        <span class="php-var">$this</span>-&gt;lMargin += <span class="php-var">$this</span>-&gt;listindent;
</span><span id="15792" class="l"><a href="#15792">15792: </a>                    }
</span><span id="15793" class="l"><a href="#15793">15793: </a>                    ++<span class="php-var">$this</span>-&gt;listindentlevel;
</span><span id="15794" class="l"><a href="#15794">15794: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15795" class="l"><a href="#15795">15795: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15796" class="l"><a href="#15796">15796: </a>                }
</span><span id="15797" class="l"><a href="#15797">15797: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'br'</span>: {
</span><span id="15798" class="l"><a href="#15798">15798: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15799" class="l"><a href="#15799">15799: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15800" class="l"><a href="#15800">15800: </a>                }
</span><span id="15801" class="l"><a href="#15801">15801: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'div'</span>: {
</span><span id="15802" class="l"><a href="#15802">15802: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15803" class="l"><a href="#15803">15803: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15804" class="l"><a href="#15804">15804: </a>                }
</span><span id="15805" class="l"><a href="#15805">15805: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'p'</span>: {
</span><span id="15806" class="l"><a href="#15806">15806: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15807" class="l"><a href="#15807">15807: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15808" class="l"><a href="#15808">15808: </a>                }
</span><span id="15809" class="l"><a href="#15809">15809: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'pre'</span>: {
</span><span id="15810" class="l"><a href="#15810">15810: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15811" class="l"><a href="#15811">15811: </a>                    <span class="php-var">$this</span>-&gt;premode = <span class="php-keyword1">true</span>;
</span><span id="15812" class="l"><a href="#15812">15812: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15813" class="l"><a href="#15813">15813: </a>                }
</span><span id="15814" class="l"><a href="#15814">15814: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'sup'</span>: {
</span><span id="15815" class="l"><a href="#15815">15815: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;GetX(), <span class="php-var">$this</span>-&gt;GetY() - ((<span class="php-num">0.7</span> * <span class="php-var">$this</span>-&gt;FontSizePt) / <span class="php-var">$this</span>-&gt;k));
</span><span id="15816" class="l"><a href="#15816">15816: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15817" class="l"><a href="#15817">15817: </a>                }
</span><span id="15818" class="l"><a href="#15818">15818: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'sub'</span>: {
</span><span id="15819" class="l"><a href="#15819">15819: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;GetX(), <span class="php-var">$this</span>-&gt;GetY() + ((<span class="php-num">0.3</span> * <span class="php-var">$this</span>-&gt;FontSizePt) / <span class="php-var">$this</span>-&gt;k));
</span><span id="15820" class="l"><a href="#15820">15820: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15821" class="l"><a href="#15821">15821: </a>                }
</span><span id="15822" class="l"><a href="#15822">15822: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h1'</span>:
</span><span id="15823" class="l"><a href="#15823">15823: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h2'</span>:
</span><span id="15824" class="l"><a href="#15824">15824: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h3'</span>:
</span><span id="15825" class="l"><a href="#15825">15825: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h4'</span>:
</span><span id="15826" class="l"><a href="#15826">15826: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h5'</span>:
</span><span id="15827" class="l"><a href="#15827">15827: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h6'</span>: {
</span><span id="15828" class="l"><a href="#15828">15828: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="15829" class="l"><a href="#15829">15829: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15830" class="l"><a href="#15830">15830: </a>                }
</span><span id="15831" class="l"><a href="#15831">15831: </a>                <span class="php-comment">// Form fields (since 4.8.000 - 2009-09-07)</span>
</span><span id="15832" class="l"><a href="#15832">15832: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'form'</span>: {
</span><span id="15833" class="l"><a href="#15833">15833: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'action'</span>])) {
</span><span id="15834" class="l"><a href="#15834">15834: </a>                        <span class="php-var">$this</span>-&gt;form_action = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'action'</span>];
</span><span id="15835" class="l"><a href="#15835">15835: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15836" class="l"><a href="#15836">15836: </a>                        <span class="php-var">$this</span>-&gt;form_action = K_PATH_URL.<span class="php-var">$_SERVER</span>[<span class="php-quote">'SCRIPT_NAME'</span>];
</span><span id="15837" class="l"><a href="#15837">15837: </a>                    }
</span><span id="15838" class="l"><a href="#15838">15838: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'enctype'</span>])) {
</span><span id="15839" class="l"><a href="#15839">15839: </a>                        <span class="php-var">$this</span>-&gt;form_enctype = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'enctype'</span>];
</span><span id="15840" class="l"><a href="#15840">15840: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15841" class="l"><a href="#15841">15841: </a>                        <span class="php-var">$this</span>-&gt;form_enctype = <span class="php-quote">'application/x-www-form-urlencoded'</span>;
</span><span id="15842" class="l"><a href="#15842">15842: </a>                    }
</span><span id="15843" class="l"><a href="#15843">15843: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'method'</span>])) {
</span><span id="15844" class="l"><a href="#15844">15844: </a>                        <span class="php-var">$this</span>-&gt;form_mode = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'method'</span>];
</span><span id="15845" class="l"><a href="#15845">15845: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15846" class="l"><a href="#15846">15846: </a>                        <span class="php-var">$this</span>-&gt;form_mode = <span class="php-quote">'post'</span>;
</span><span id="15847" class="l"><a href="#15847">15847: </a>                    }
</span><span id="15848" class="l"><a href="#15848">15848: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15849" class="l"><a href="#15849">15849: </a>                }
</span><span id="15850" class="l"><a href="#15850">15850: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'input'</span>: {
</span><span id="15851" class="l"><a href="#15851">15851: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>])) {
</span><span id="15852" class="l"><a href="#15852">15852: </a>                        <span class="php-var">$name</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>];
</span><span id="15853" class="l"><a href="#15853">15853: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15854" class="l"><a href="#15854">15854: </a>                        <span class="php-keyword1">break</span>;
</span><span id="15855" class="l"><a href="#15855">15855: </a>                    }
</span><span id="15856" class="l"><a href="#15856">15856: </a>                    <span class="php-var">$prop</span> = <span class="php-keyword1">array</span>();
</span><span id="15857" class="l"><a href="#15857">15857: </a>                    <span class="php-var">$opt</span> = <span class="php-keyword1">array</span>();
</span><span id="15858" class="l"><a href="#15858">15858: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>])) {
</span><span id="15859" class="l"><a href="#15859">15859: </a>                        <span class="php-var">$value</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>];
</span><span id="15860" class="l"><a href="#15860">15860: </a>                    }
</span><span id="15861" class="l"><a href="#15861">15861: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'maxlength'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'maxlength'</span>])) {
</span><span id="15862" class="l"><a href="#15862">15862: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'maxlen'</span>] = <span class="php-keyword2">intval</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>]);
</span><span id="15863" class="l"><a href="#15863">15863: </a>                    }
</span><span id="15864" class="l"><a href="#15864">15864: </a>                    <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="15865" class="l"><a href="#15865">15865: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>])) {
</span><span id="15866" class="l"><a href="#15866">15866: </a>                        <span class="php-var">$w</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>]) * <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>)) * <span class="php-num">2</span>;
</span><span id="15867" class="l"><a href="#15867">15867: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15868" class="l"><a href="#15868">15868: </a>                        <span class="php-var">$w</span> = <span class="php-var">$h</span>;
</span><span id="15869" class="l"><a href="#15869">15869: </a>                    }
</span><span id="15870" class="l"><a href="#15870">15870: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'checked'</span>]) <span class="php-keyword1">AND</span> ((<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'checked'</span>] == <span class="php-quote">'checked'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'checked'</span>] == <span class="php-quote">'true'</span>))) {
</span><span id="15871" class="l"><a href="#15871">15871: </a>                        <span class="php-var">$checked</span> = <span class="php-keyword1">true</span>;
</span><span id="15872" class="l"><a href="#15872">15872: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15873" class="l"><a href="#15873">15873: </a>                        <span class="php-var">$checked</span> = <span class="php-keyword1">false</span>;
</span><span id="15874" class="l"><a href="#15874">15874: </a>                    }
</span><span id="15875" class="l"><a href="#15875">15875: </a>                    <span class="php-keyword1">switch</span> (<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'type'</span>]) {
</span><span id="15876" class="l"><a href="#15876">15876: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'text'</span>: {
</span><span id="15877" class="l"><a href="#15877">15877: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$value</span>)) {
</span><span id="15878" class="l"><a href="#15878">15878: </a>                                <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-var">$value</span>;
</span><span id="15879" class="l"><a href="#15879">15879: </a>                            }
</span><span id="15880" class="l"><a href="#15880">15880: </a>                            <span class="php-var">$this</span>-&gt;TextField(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15881" class="l"><a href="#15881">15881: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15882" class="l"><a href="#15882">15882: </a>                        }
</span><span id="15883" class="l"><a href="#15883">15883: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'password'</span>: {
</span><span id="15884" class="l"><a href="#15884">15884: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$value</span>)) {
</span><span id="15885" class="l"><a href="#15885">15885: </a>                                <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-var">$value</span>;
</span><span id="15886" class="l"><a href="#15886">15886: </a>                            }
</span><span id="15887" class="l"><a href="#15887">15887: </a>                            <span class="php-var">$prop</span>[<span class="php-quote">'password'</span>] = <span class="php-quote">'true'</span>;
</span><span id="15888" class="l"><a href="#15888">15888: </a>                            <span class="php-var">$this</span>-&gt;TextField(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15889" class="l"><a href="#15889">15889: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15890" class="l"><a href="#15890">15890: </a>                        }
</span><span id="15891" class="l"><a href="#15891">15891: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'checkbox'</span>: {
</span><span id="15892" class="l"><a href="#15892">15892: </a>                            <span class="php-var">$this</span>-&gt;CheckBox(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$checked</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-var">$value</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15893" class="l"><a href="#15893">15893: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15894" class="l"><a href="#15894">15894: </a>                        }
</span><span id="15895" class="l"><a href="#15895">15895: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'radio'</span>: {
</span><span id="15896" class="l"><a href="#15896">15896: </a>                            <span class="php-var">$this</span>-&gt;RadioButton(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-var">$value</span>, <span class="php-var">$checked</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15897" class="l"><a href="#15897">15897: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15898" class="l"><a href="#15898">15898: </a>                        }
</span><span id="15899" class="l"><a href="#15899">15899: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'submit'</span>: {
</span><span id="15900" class="l"><a href="#15900">15900: </a>                            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$value</span>) * <span class="php-num">1.5</span>;
</span><span id="15901" class="l"><a href="#15901">15901: </a>                            <span class="php-var">$h</span> *= <span class="php-num">1.6</span>;
</span><span id="15902" class="l"><a href="#15902">15902: </a>                            <span class="php-var">$prop</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'lineWidth'</span>=&gt;<span class="php-num">1</span>, <span class="php-quote">'borderStyle'</span>=&gt;<span class="php-quote">'beveled'</span>, <span class="php-quote">'fillColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">196</span>, <span class="php-num">196</span>, <span class="php-num">196</span>), <span class="php-quote">'strokeColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">255</span>, <span class="php-num">255</span>, <span class="php-num">255</span>));
</span><span id="15903" class="l"><a href="#15903">15903: </a>                            <span class="php-var">$action</span> = <span class="php-keyword1">array</span>();
</span><span id="15904" class="l"><a href="#15904">15904: </a>                            <span class="php-var">$action</span>[<span class="php-quote">'S'</span>] = <span class="php-quote">'SubmitForm'</span>;
</span><span id="15905" class="l"><a href="#15905">15905: </a>                            <span class="php-var">$action</span>[<span class="php-quote">'F'</span>] = <span class="php-var">$this</span>-&gt;form_action;
</span><span id="15906" class="l"><a href="#15906">15906: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;form_enctype != <span class="php-quote">'FDF'</span>) {
</span><span id="15907" class="l"><a href="#15907">15907: </a>                                <span class="php-var">$action</span>[<span class="php-quote">'Flags'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'ExportFormat'</span>);
</span><span id="15908" class="l"><a href="#15908">15908: </a>                            }
</span><span id="15909" class="l"><a href="#15909">15909: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;form_mode == <span class="php-quote">'get'</span>) {
</span><span id="15910" class="l"><a href="#15910">15910: </a>                                <span class="php-var">$action</span>[<span class="php-quote">'Flags'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'GetMethod'</span>);
</span><span id="15911" class="l"><a href="#15911">15911: </a>                            }
</span><span id="15912" class="l"><a href="#15912">15912: </a>                            <span class="php-var">$this</span>-&gt;Button(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$value</span>, <span class="php-var">$action</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15913" class="l"><a href="#15913">15913: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15914" class="l"><a href="#15914">15914: </a>                        }
</span><span id="15915" class="l"><a href="#15915">15915: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'reset'</span>: {
</span><span id="15916" class="l"><a href="#15916">15916: </a>                            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$value</span>) * <span class="php-num">1.5</span>;
</span><span id="15917" class="l"><a href="#15917">15917: </a>                            <span class="php-var">$h</span> *= <span class="php-num">1.6</span>;
</span><span id="15918" class="l"><a href="#15918">15918: </a>                            <span class="php-var">$prop</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'lineWidth'</span>=&gt;<span class="php-num">1</span>, <span class="php-quote">'borderStyle'</span>=&gt;<span class="php-quote">'beveled'</span>, <span class="php-quote">'fillColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">196</span>, <span class="php-num">196</span>, <span class="php-num">196</span>), <span class="php-quote">'strokeColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">255</span>, <span class="php-num">255</span>, <span class="php-num">255</span>));
</span><span id="15919" class="l"><a href="#15919">15919: </a>                            <span class="php-var">$this</span>-&gt;Button(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$value</span>, <span class="php-keyword1">array</span>(<span class="php-quote">'S'</span>=&gt;<span class="php-quote">'ResetForm'</span>), <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15920" class="l"><a href="#15920">15920: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15921" class="l"><a href="#15921">15921: </a>                        }
</span><span id="15922" class="l"><a href="#15922">15922: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'file'</span>: {
</span><span id="15923" class="l"><a href="#15923">15923: </a>                            <span class="php-var">$prop</span>[<span class="php-quote">'fileSelect'</span>] = <span class="php-quote">'true'</span>;
</span><span id="15924" class="l"><a href="#15924">15924: </a>                            <span class="php-var">$this</span>-&gt;TextField(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15925" class="l"><a href="#15925">15925: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$value</span>)) {
</span><span id="15926" class="l"><a href="#15926">15926: </a>                                <span class="php-var">$value</span> = <span class="php-quote">'*'</span>;
</span><span id="15927" class="l"><a href="#15927">15927: </a>                            }
</span><span id="15928" class="l"><a href="#15928">15928: </a>                            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$value</span>) * <span class="php-num">2</span>;
</span><span id="15929" class="l"><a href="#15929">15929: </a>                            <span class="php-var">$h</span> *= <span class="php-num">1.2</span>;
</span><span id="15930" class="l"><a href="#15930">15930: </a>                            <span class="php-var">$prop</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'lineWidth'</span>=&gt;<span class="php-num">1</span>, <span class="php-quote">'borderStyle'</span>=&gt;<span class="php-quote">'beveled'</span>, <span class="php-quote">'fillColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">196</span>, <span class="php-num">196</span>, <span class="php-num">196</span>), <span class="php-quote">'strokeColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">255</span>, <span class="php-num">255</span>, <span class="php-num">255</span>));
</span><span id="15931" class="l"><a href="#15931">15931: </a>                            <span class="php-var">$jsaction</span> = <span class="php-quote">'var f=this.getField(\''</span>.<span class="php-var">$name</span>.<span class="php-quote">'\'); f.browseForFileToSubmit();'</span>;
</span><span id="15932" class="l"><a href="#15932">15932: </a>                            <span class="php-var">$this</span>-&gt;Button(<span class="php-quote">'FB_'</span>.<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$value</span>, <span class="php-var">$jsaction</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15933" class="l"><a href="#15933">15933: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15934" class="l"><a href="#15934">15934: </a>                        }
</span><span id="15935" class="l"><a href="#15935">15935: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'hidden'</span>: {
</span><span id="15936" class="l"><a href="#15936">15936: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$value</span>)) {
</span><span id="15937" class="l"><a href="#15937">15937: </a>                                <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-var">$value</span>;
</span><span id="15938" class="l"><a href="#15938">15938: </a>                            }
</span><span id="15939" class="l"><a href="#15939">15939: </a>                            <span class="php-var">$opt</span>[<span class="php-quote">'f'</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'invisible'</span>, <span class="php-quote">'hidden'</span>);
</span><span id="15940" class="l"><a href="#15940">15940: </a>                            <span class="php-var">$this</span>-&gt;TextField(<span class="php-var">$name</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15941" class="l"><a href="#15941">15941: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15942" class="l"><a href="#15942">15942: </a>                        }
</span><span id="15943" class="l"><a href="#15943">15943: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'image'</span>: {
</span><span id="15944" class="l"><a href="#15944">15944: </a>                            <span class="php-comment">// THIS TYPE MUST BE FIXED</span>
</span><span id="15945" class="l"><a href="#15945">15945: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>])) {
</span><span id="15946" class="l"><a href="#15946">15946: </a>                                <span class="php-var">$img</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'src'</span>];
</span><span id="15947" class="l"><a href="#15947">15947: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15948" class="l"><a href="#15948">15948: </a>                                <span class="php-keyword1">break</span>;
</span><span id="15949" class="l"><a href="#15949">15949: </a>                            }
</span><span id="15950" class="l"><a href="#15950">15950: </a>                            <span class="php-var">$value</span> = <span class="php-quote">'img'</span>;
</span><span id="15951" class="l"><a href="#15951">15951: </a>                            <span class="php-comment">//$opt['mk'] = array('i'=&gt;$img, 'tp'=&gt;1, 'if'=&gt;array('sw'=&gt;'A', 's'=&gt;'A', 'fb'=&gt;false));</span>
</span><span id="15952" class="l"><a href="#15952">15952: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'onclick'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'onclick'</span>])) {
</span><span id="15953" class="l"><a href="#15953">15953: </a>                                <span class="php-var">$jsaction</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'onclick'</span>];
</span><span id="15954" class="l"><a href="#15954">15954: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15955" class="l"><a href="#15955">15955: </a>                                <span class="php-var">$jsaction</span> = <span class="php-quote">''</span>;
</span><span id="15956" class="l"><a href="#15956">15956: </a>                            }
</span><span id="15957" class="l"><a href="#15957">15957: </a>                            <span class="php-var">$this</span>-&gt;Button(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$value</span>, <span class="php-var">$jsaction</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15958" class="l"><a href="#15958">15958: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15959" class="l"><a href="#15959">15959: </a>                        }
</span><span id="15960" class="l"><a href="#15960">15960: </a>                        <span class="php-keyword1">case</span> <span class="php-quote">'button'</span>: {
</span><span id="15961" class="l"><a href="#15961">15961: </a>                            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$value</span>) * <span class="php-num">1.5</span>;
</span><span id="15962" class="l"><a href="#15962">15962: </a>                            <span class="php-var">$h</span> *= <span class="php-num">1.6</span>;
</span><span id="15963" class="l"><a href="#15963">15963: </a>                            <span class="php-var">$prop</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'lineWidth'</span>=&gt;<span class="php-num">1</span>, <span class="php-quote">'borderStyle'</span>=&gt;<span class="php-quote">'beveled'</span>, <span class="php-quote">'fillColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">196</span>, <span class="php-num">196</span>, <span class="php-num">196</span>), <span class="php-quote">'strokeColor'</span>=&gt;<span class="php-keyword1">array</span>(<span class="php-num">255</span>, <span class="php-num">255</span>, <span class="php-num">255</span>));
</span><span id="15964" class="l"><a href="#15964">15964: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'onclick'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'onclick'</span>])) {
</span><span id="15965" class="l"><a href="#15965">15965: </a>                                <span class="php-var">$jsaction</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'onclick'</span>];
</span><span id="15966" class="l"><a href="#15966">15966: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="15967" class="l"><a href="#15967">15967: </a>                                <span class="php-var">$jsaction</span> = <span class="php-quote">''</span>;
</span><span id="15968" class="l"><a href="#15968">15968: </a>                            }
</span><span id="15969" class="l"><a href="#15969">15969: </a>                            <span class="php-var">$this</span>-&gt;Button(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$value</span>, <span class="php-var">$jsaction</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15970" class="l"><a href="#15970">15970: </a>                            <span class="php-keyword1">break</span>;
</span><span id="15971" class="l"><a href="#15971">15971: </a>                        }
</span><span id="15972" class="l"><a href="#15972">15972: </a>                    }
</span><span id="15973" class="l"><a href="#15973">15973: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15974" class="l"><a href="#15974">15974: </a>                }
</span><span id="15975" class="l"><a href="#15975">15975: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'textarea'</span>: {
</span><span id="15976" class="l"><a href="#15976">15976: </a>                    <span class="php-var">$prop</span> = <span class="php-keyword1">array</span>();
</span><span id="15977" class="l"><a href="#15977">15977: </a>                    <span class="php-var">$opt</span> = <span class="php-keyword1">array</span>();
</span><span id="15978" class="l"><a href="#15978">15978: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>])) {
</span><span id="15979" class="l"><a href="#15979">15979: </a>                        <span class="php-var">$name</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>];
</span><span id="15980" class="l"><a href="#15980">15980: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15981" class="l"><a href="#15981">15981: </a>                        <span class="php-keyword1">break</span>;
</span><span id="15982" class="l"><a href="#15982">15982: </a>                    }
</span><span id="15983" class="l"><a href="#15983">15983: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>])) {
</span><span id="15984" class="l"><a href="#15984">15984: </a>                        <span class="php-var">$opt</span>[<span class="php-quote">'v'</span>] = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'value'</span>];
</span><span id="15985" class="l"><a href="#15985">15985: </a>                    }
</span><span id="15986" class="l"><a href="#15986">15986: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cols'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cols'</span>])) {
</span><span id="15987" class="l"><a href="#15987">15987: </a>                        <span class="php-var">$w</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cols'</span>]) * <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>)) * <span class="php-num">2</span>;
</span><span id="15988" class="l"><a href="#15988">15988: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15989" class="l"><a href="#15989">15989: </a>                        <span class="php-var">$w</span> = <span class="php-num">40</span>;
</span><span id="15990" class="l"><a href="#15990">15990: </a>                    }
</span><span id="15991" class="l"><a href="#15991">15991: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'rows'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'rows'</span>])) {
</span><span id="15992" class="l"><a href="#15992">15992: </a>                        <span class="php-var">$h</span> = <span class="php-keyword2">intval</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'rows'</span>]) * <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="15993" class="l"><a href="#15993">15993: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="15994" class="l"><a href="#15994">15994: </a>                        <span class="php-var">$h</span> = <span class="php-num">10</span>;
</span><span id="15995" class="l"><a href="#15995">15995: </a>                    }
</span><span id="15996" class="l"><a href="#15996">15996: </a>                    <span class="php-var">$prop</span>[<span class="php-quote">'multiline'</span>] = <span class="php-quote">'true'</span>;
</span><span id="15997" class="l"><a href="#15997">15997: </a>                    <span class="php-var">$this</span>-&gt;TextField(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="15998" class="l"><a href="#15998">15998: </a>                    <span class="php-keyword1">break</span>;
</span><span id="15999" class="l"><a href="#15999">15999: </a>                }
</span><span id="16000" class="l"><a href="#16000">16000: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'select'</span>: {
</span><span id="16001" class="l"><a href="#16001">16001: </a>                    <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="16002" class="l"><a href="#16002">16002: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>])) {
</span><span id="16003" class="l"><a href="#16003">16003: </a>                        <span class="php-var">$h</span> *= (<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'size'</span>] + <span class="php-num">1</span>);
</span><span id="16004" class="l"><a href="#16004">16004: </a>                    }
</span><span id="16005" class="l"><a href="#16005">16005: </a>                    <span class="php-var">$prop</span> = <span class="php-keyword1">array</span>();
</span><span id="16006" class="l"><a href="#16006">16006: </a>                    <span class="php-var">$opt</span> = <span class="php-keyword1">array</span>();
</span><span id="16007" class="l"><a href="#16007">16007: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>])) {
</span><span id="16008" class="l"><a href="#16008">16008: </a>                        <span class="php-var">$name</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'name'</span>];
</span><span id="16009" class="l"><a href="#16009">16009: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16010" class="l"><a href="#16010">16010: </a>                        <span class="php-keyword1">break</span>;
</span><span id="16011" class="l"><a href="#16011">16011: </a>                    }
</span><span id="16012" class="l"><a href="#16012">16012: </a>                    <span class="php-var">$w</span> = <span class="php-num">0</span>;
</span><span id="16013" class="l"><a href="#16013">16013: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'opt'</span>]) <span class="php-keyword1">AND</span> !<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'opt'</span>])) {
</span><span id="16014" class="l"><a href="#16014">16014: </a>                        <span class="php-var">$options</span> = <span class="php-keyword2">explode</span> (<span class="php-quote">&quot;\r&quot;</span>, <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'opt'</span>]);
</span><span id="16015" class="l"><a href="#16015">16015: </a>                        <span class="php-var">$values</span> = <span class="php-keyword1">array</span>();
</span><span id="16016" class="l"><a href="#16016">16016: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$options</span> <span class="php-keyword1">as</span> <span class="php-var">$val</span>) {
</span><span id="16017" class="l"><a href="#16017">16017: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">strpos</span>(<span class="php-var">$val</span>, <span class="php-quote">&quot;\t&quot;</span>) !== <span class="php-keyword1">false</span>) {
</span><span id="16018" class="l"><a href="#16018">16018: </a>                                <span class="php-var">$opts</span> = <span class="php-keyword2">explode</span>(<span class="php-quote">&quot;\t&quot;</span>, <span class="php-var">$val</span>);
</span><span id="16019" class="l"><a href="#16019">16019: </a>                                <span class="php-var">$values</span>[] = <span class="php-var">$opts</span>;
</span><span id="16020" class="l"><a href="#16020">16020: </a>                                <span class="php-var">$w</span> = <span class="php-keyword2">max</span>(<span class="php-var">$w</span>, <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$opts</span>[<span class="php-num">1</span>]));
</span><span id="16021" class="l"><a href="#16021">16021: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="16022" class="l"><a href="#16022">16022: </a>                                <span class="php-var">$values</span>[] = <span class="php-var">$val</span>;
</span><span id="16023" class="l"><a href="#16023">16023: </a>                                <span class="php-var">$w</span> = <span class="php-keyword2">max</span>(<span class="php-var">$w</span>, <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$val</span>));
</span><span id="16024" class="l"><a href="#16024">16024: </a>                            }
</span><span id="16025" class="l"><a href="#16025">16025: </a>                        }
</span><span id="16026" class="l"><a href="#16026">16026: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16027" class="l"><a href="#16027">16027: </a>                        <span class="php-keyword1">break</span>;
</span><span id="16028" class="l"><a href="#16028">16028: </a>                    }
</span><span id="16029" class="l"><a href="#16029">16029: </a>                    <span class="php-var">$w</span> *= <span class="php-num">2</span>;
</span><span id="16030" class="l"><a href="#16030">16030: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'multiple'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'multiple'</span>]=<span class="php-quote">'multiple'</span>)) {
</span><span id="16031" class="l"><a href="#16031">16031: </a>                        <span class="php-var">$prop</span>[<span class="php-quote">'multipleSelection'</span>] = <span class="php-quote">'true'</span>;
</span><span id="16032" class="l"><a href="#16032">16032: </a>                        <span class="php-var">$this</span>-&gt;ListBox(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$values</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="16033" class="l"><a href="#16033">16033: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16034" class="l"><a href="#16034">16034: </a>                        <span class="php-var">$this</span>-&gt;ComboBox(<span class="php-var">$name</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$values</span>, <span class="php-var">$prop</span>, <span class="php-var">$opt</span>, <span class="php-quote">''</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>);
</span><span id="16035" class="l"><a href="#16035">16035: </a>                    }
</span><span id="16036" class="l"><a href="#16036">16036: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16037" class="l"><a href="#16037">16037: </a>                }
</span><span id="16038" class="l"><a href="#16038">16038: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'tcpdf'</span>: {
</span><span id="16039" class="l"><a href="#16039">16039: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">defined</span>(<span class="php-quote">'K_TCPDF_CALLS_IN_HTML'</span>) <span class="php-keyword1">AND</span> (K_TCPDF_CALLS_IN_HTML === <span class="php-keyword1">true</span>)) {
</span><span id="16040" class="l"><a href="#16040">16040: </a>                        <span class="php-comment">// Special tag used to call TCPDF methods</span>
</span><span id="16041" class="l"><a href="#16041">16041: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'method'</span>])) {
</span><span id="16042" class="l"><a href="#16042">16042: </a>                            <span class="php-var">$tcpdf_method</span> = <span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'method'</span>];
</span><span id="16043" class="l"><a href="#16043">16043: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword2">method_exists</span>(<span class="php-var">$this</span>, <span class="php-var">$tcpdf_method</span>)) {
</span><span id="16044" class="l"><a href="#16044">16044: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'params'</span>]) <span class="php-keyword1">AND</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'params'</span>]))) {
</span><span id="16045" class="l"><a href="#16045">16045: </a>                                    <span class="php-var">$params</span> = <span class="php-keyword2">unserialize</span>(<span class="php-keyword2">urldecode</span>(<span class="php-var">$tag</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'params'</span>]));
</span><span id="16046" class="l"><a href="#16046">16046: </a>                                    <span class="php-keyword2">call_user_func_array</span>(<span class="php-keyword1">array</span>(<span class="php-var">$this</span>, <span class="php-var">$tcpdf_method</span>), <span class="php-var">$params</span>);
</span><span id="16047" class="l"><a href="#16047">16047: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="16048" class="l"><a href="#16048">16048: </a>                                    <span class="php-var">$this</span>-&gt;<span class="php-var">$tcpdf_method</span>();
</span><span id="16049" class="l"><a href="#16049">16049: </a>                                }
</span><span id="16050" class="l"><a href="#16050">16050: </a>                                <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">true</span>;
</span><span id="16051" class="l"><a href="#16051">16051: </a>                            }
</span><span id="16052" class="l"><a href="#16052">16052: </a>                        }
</span><span id="16053" class="l"><a href="#16053">16053: </a>                    }
</span><span id="16054" class="l"><a href="#16054">16054: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16055" class="l"><a href="#16055">16055: </a>                }
</span><span id="16056" class="l"><a href="#16056">16056: </a>                <span class="php-keyword1">default</span>: {
</span><span id="16057" class="l"><a href="#16057">16057: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16058" class="l"><a href="#16058">16058: </a>                }
</span><span id="16059" class="l"><a href="#16059">16059: </a>            }
</span><span id="16060" class="l"><a href="#16060">16060: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'self'</span>] <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreakafter'</span>])) {
</span><span id="16061" class="l"><a href="#16061">16061: </a>                <span class="php-var">$pba</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreakafter'</span>];
</span><span id="16062" class="l"><a href="#16062">16062: </a>                <span class="php-comment">// check for pagebreak</span>
</span><span id="16063" class="l"><a href="#16063">16063: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$pba</span> == <span class="php-quote">'true'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$pba</span> == <span class="php-quote">'left'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$pba</span> == <span class="php-quote">'right'</span>)) {
</span><span id="16064" class="l"><a href="#16064">16064: </a>                    <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="16065" class="l"><a href="#16065">16065: </a>                    <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>);
</span><span id="16066" class="l"><a href="#16066">16066: </a>                }
</span><span id="16067" class="l"><a href="#16067">16067: </a>                <span class="php-keyword1">if</span> (((<span class="php-var">$pba</span> == <span class="php-quote">'left'</span>) <span class="php-keyword1">AND</span> (((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) == <span class="php-num">0</span>)) <span class="php-keyword1">OR</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) != <span class="php-num">0</span>))))
</span><span id="16068" class="l"><a href="#16068">16068: </a>                    <span class="php-keyword1">OR</span> ((<span class="php-var">$pba</span> == <span class="php-quote">'right'</span>) <span class="php-keyword1">AND</span> (((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) != <span class="php-num">0</span>)) <span class="php-keyword1">OR</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) == <span class="php-num">0</span>))))) {
</span><span id="16069" class="l"><a href="#16069">16069: </a>                    <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="16070" class="l"><a href="#16070">16070: </a>                    <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>);
</span><span id="16071" class="l"><a href="#16071">16071: </a>                }
</span><span id="16072" class="l"><a href="#16072">16072: </a>            }
</span><span id="16073" class="l"><a href="#16073">16073: </a>        }
</span><span id="16074" class="l"><a href="#16074">16074: </a>
</span><span id="16075" class="l"><a href="#16075">16075: </a>        <span class="php-comment">/**
</span></span><span id="16076" class="l"><a href="#16076">16076: </a><span class="php-comment">         * Process closing tags.
</span></span><span id="16077" class="l"><a href="#16077">16077: </a><span class="php-comment">         * @param array $dom html dom array
</span></span><span id="16078" class="l"><a href="#16078">16078: </a><span class="php-comment">         * @param int $key current element id
</span></span><span id="16079" class="l"><a href="#16079">16079: </a><span class="php-comment">         * @param boolean $cell if true add the default cMargin space to each new line (default false).
</span></span><span id="16080" class="l"><a href="#16080">16080: </a><span class="php-comment">         * @param int $maxbottomliney maximum y value of current line
</span></span><span id="16081" class="l"><a href="#16081">16081: </a><span class="php-comment">         * @access protected
</span></span><span id="16082" class="l"><a href="#16082">16082: </a><span class="php-comment">         */</span>
</span><span id="16083" class="l"><a href="#16083">16083: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> closeHTMLTagHandler(&amp;<span class="php-var">$dom</span>, <span class="php-var">$key</span>, <span class="php-var">$cell</span>, <span class="php-var">$maxbottomliney</span>=<span class="php-num">0</span>) {
</span><span id="16084" class="l"><a href="#16084">16084: </a>            <span class="php-var">$tag</span> = <span class="php-var">$dom</span>[<span class="php-var">$key</span>];
</span><span id="16085" class="l"><a href="#16085">16085: </a>            <span class="php-var">$parent</span> = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])];
</span><span id="16086" class="l"><a href="#16086">16086: </a>            <span class="php-var">$firstorlast</span> = ((!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$key</span> + <span class="php-num">1</span>)])) <span class="php-keyword1">OR</span> ((!<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$key</span> + <span class="php-num">2</span>)])) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[(<span class="php-var">$key</span> + <span class="php-num">1</span>)][<span class="php-quote">'value'</span>] == <span class="php-quote">'marker'</span>)));
</span><span id="16087" class="l"><a href="#16087">16087: </a>            <span class="php-var">$in_table_head</span> = <span class="php-keyword1">false</span>;
</span><span id="16088" class="l"><a href="#16088">16088: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$tag</span>[<span class="php-quote">'block'</span>]) {
</span><span id="16089" class="l"><a href="#16089">16089: </a>                <span class="php-var">$hbz</span> = <span class="php-num">0</span>; <span class="php-comment">// distance from y to line bottom</span>
</span><span id="16090" class="l"><a href="#16090">16090: </a>                <span class="php-var">$hb</span> = <span class="php-num">0</span>; <span class="php-comment">// vertical space between block tags</span>
</span><span id="16091" class="l"><a href="#16091">16091: </a>                <span class="php-comment">// calculate vertical space for block tags</span>
</span><span id="16092" class="l"><a href="#16092">16092: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">1</span>][<span class="php-quote">'h'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">1</span>][<span class="php-quote">'h'</span>] &gt;= <span class="php-num">0</span>)) {
</span><span id="16093" class="l"><a href="#16093">16093: </a>                    <span class="php-var">$pre_h</span> = <span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">1</span>][<span class="php-quote">'h'</span>];
</span><span id="16094" class="l"><a href="#16094">16094: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'fontsize'</span>])) {
</span><span id="16095" class="l"><a href="#16095">16095: </a>                    <span class="php-var">$pre_h</span> = ((<span class="php-var">$parent</span>[<span class="php-quote">'fontsize'</span>] / <span class="php-var">$this</span>-&gt;k) * <span class="php-var">$this</span>-&gt;cell_height_ratio);
</span><span id="16096" class="l"><a href="#16096">16096: </a>                } <span class="php-keyword1">else</span> {
</span><span id="16097" class="l"><a href="#16097">16097: </a>                    <span class="php-var">$pre_h</span> = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="16098" class="l"><a href="#16098">16098: </a>                }
</span><span id="16099" class="l"><a href="#16099">16099: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">1</span>][<span class="php-quote">'n'</span>])) {
</span><span id="16100" class="l"><a href="#16100">16100: </a>                    <span class="php-var">$n</span> = <span class="php-var">$this</span>-&gt;tagvspaces[<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]][<span class="php-num">1</span>][<span class="php-quote">'n'</span>];
</span><span id="16101" class="l"><a href="#16101">16101: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[h][0-9]/'</span>, <span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]) &gt; <span class="php-num">0</span>) {
</span><span id="16102" class="l"><a href="#16102">16102: </a>                    <span class="php-var">$n</span> = <span class="php-num">0.6</span>;
</span><span id="16103" class="l"><a href="#16103">16103: </a>                } <span class="php-keyword1">else</span> {
</span><span id="16104" class="l"><a href="#16104">16104: </a>                    <span class="php-var">$n</span> = <span class="php-num">1</span>;
</span><span id="16105" class="l"><a href="#16105">16105: </a>                }
</span><span id="16106" class="l"><a href="#16106">16106: </a>                <span class="php-var">$hb</span> = (<span class="php-var">$n</span> * <span class="php-var">$pre_h</span>);
</span><span id="16107" class="l"><a href="#16107">16107: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$maxbottomliney</span>) {
</span><span id="16108" class="l"><a href="#16108">16108: </a>                    <span class="php-var">$hbz</span> = (<span class="php-var">$maxbottomliney</span> - <span class="php-var">$this</span>-&gt;y);
</span><span id="16109" class="l"><a href="#16109">16109: </a>                }
</span><span id="16110" class="l"><a href="#16110">16110: </a>            }
</span><span id="16111" class="l"><a href="#16111">16111: </a>            <span class="php-comment">//Closing tag</span>
</span><span id="16112" class="l"><a href="#16112">16112: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$tag</span>[<span class="php-quote">'value'</span>]) {
</span><span id="16113" class="l"><a href="#16113">16113: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'tr'</span>: {
</span><span id="16114" class="l"><a href="#16114">16114: </a>                    <span class="php-var">$table_el</span> = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'parent'</span>];
</span><span id="16115" class="l"><a href="#16115">16115: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'endy'</span>])) {
</span><span id="16116" class="l"><a href="#16116">16116: </a>                        <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>] = <span class="php-var">$this</span>-&gt;y;
</span><span id="16117" class="l"><a href="#16117">16117: </a>                        <span class="php-var">$parent</span>[<span class="php-quote">'endy'</span>] = <span class="php-var">$this</span>-&gt;y;
</span><span id="16118" class="l"><a href="#16118">16118: </a>                    }
</span><span id="16119" class="l"><a href="#16119">16119: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'endpage'</span>])) {
</span><span id="16120" class="l"><a href="#16120">16120: </a>                        <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endpage'</span>] = <span class="php-var">$this</span>-&gt;page;
</span><span id="16121" class="l"><a href="#16121">16121: </a>                        <span class="php-var">$parent</span>[<span class="php-quote">'endpage'</span>] = <span class="php-var">$this</span>-&gt;page;
</span><span id="16122" class="l"><a href="#16122">16122: </a>                    }
</span><span id="16123" class="l"><a href="#16123">16123: </a>                    <span class="php-comment">// update row-spanned cells</span>
</span><span id="16124" class="l"><a href="#16124">16124: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>])) {
</span><span id="16125" class="l"><a href="#16125">16125: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$trwsp</span>) {
</span><span id="16126" class="l"><a href="#16126">16126: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'rowspan'</span>] -= <span class="php-num">1</span>;
</span><span id="16127" class="l"><a href="#16127">16127: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'rowspan'</span>] == <span class="php-num">0</span>) {
</span><span id="16128" class="l"><a href="#16128">16128: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>] == <span class="php-var">$parent</span>[<span class="php-quote">'endpage'</span>]) {
</span><span id="16129" class="l"><a href="#16129">16129: </a>                                    <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>] = <span class="php-keyword2">max</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>], <span class="php-var">$parent</span>[<span class="php-quote">'endy'</span>]);
</span><span id="16130" class="l"><a href="#16130">16130: </a>                                } <span class="php-keyword1">elseif</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>] &gt; <span class="php-var">$parent</span>[<span class="php-quote">'endpage'</span>]) {
</span><span id="16131" class="l"><a href="#16131">16131: </a>                                    <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>];
</span><span id="16132" class="l"><a href="#16132">16132: </a>                                    <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endpage'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>];
</span><span id="16133" class="l"><a href="#16133">16133: </a>                                }
</span><span id="16134" class="l"><a href="#16134">16134: </a>                            }
</span><span id="16135" class="l"><a href="#16135">16135: </a>                        }
</span><span id="16136" class="l"><a href="#16136">16136: </a>                        <span class="php-comment">// report new endy and endpage to the rowspanned cells</span>
</span><span id="16137" class="l"><a href="#16137">16137: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$trwsp</span>) {
</span><span id="16138" class="l"><a href="#16138">16138: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'rowspan'</span>] == <span class="php-num">0</span>) {
</span><span id="16139" class="l"><a href="#16139">16139: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>] = <span class="php-keyword2">max</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>], <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endpage'</span>]);
</span><span id="16140" class="l"><a href="#16140">16140: </a>                                <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endpage'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>];
</span><span id="16141" class="l"><a href="#16141">16141: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>] = <span class="php-keyword2">max</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>], <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>]);
</span><span id="16142" class="l"><a href="#16142">16142: </a>                                <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>] = <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>];
</span><span id="16143" class="l"><a href="#16143">16143: </a>                            }
</span><span id="16144" class="l"><a href="#16144">16144: </a>                        }
</span><span id="16145" class="l"><a href="#16145">16145: </a>                        <span class="php-comment">// update remaining rowspanned cells</span>
</span><span id="16146" class="l"><a href="#16146">16146: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$trwsp</span>) {
</span><span id="16147" class="l"><a href="#16147">16147: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'rowspan'</span>] == <span class="php-num">0</span>) {
</span><span id="16148" class="l"><a href="#16148">16148: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endpage'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endpage'</span>];
</span><span id="16149" class="l"><a href="#16149">16149: </a>                                <span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>];
</span><span id="16150" class="l"><a href="#16150">16150: </a>                            }
</span><span id="16151" class="l"><a href="#16151">16151: </a>                        }
</span><span id="16152" class="l"><a href="#16152">16152: </a>                    }
</span><span id="16153" class="l"><a href="#16153">16153: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;num_columns &gt; <span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>] &gt;= (<span class="php-var">$this</span>-&gt;PageBreakTrigger - <span class="php-var">$this</span>-&gt;lasth)) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;y &lt; <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>])) {
</span><span id="16154" class="l"><a href="#16154">16154: </a>                        <span class="php-var">$this</span>-&gt;Ln(<span class="php-num">0</span>, <span class="php-var">$cell</span>);
</span><span id="16155" class="l"><a href="#16155">16155: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16156" class="l"><a href="#16156">16156: </a>                        <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endpage'</span>]);
</span><span id="16157" class="l"><a href="#16157">16157: </a>                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'endy'</span>];
</span><span id="16158" class="l"><a href="#16158">16158: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>])) {
</span><span id="16159" class="l"><a href="#16159">16159: </a>                            <span class="php-var">$cellspacing</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$dom</span>[<span class="php-var">$table_el</span>][<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>);
</span><span id="16160" class="l"><a href="#16160">16160: </a>                            <span class="php-var">$this</span>-&gt;y += <span class="php-var">$cellspacing</span>;
</span><span id="16161" class="l"><a href="#16161">16161: </a>                        }
</span><span id="16162" class="l"><a href="#16162">16162: </a>                        <span class="php-var">$this</span>-&gt;Ln(<span class="php-num">0</span>, <span class="php-var">$cell</span>);
</span><span id="16163" class="l"><a href="#16163">16163: </a>                        <span class="php-var">$this</span>-&gt;x = <span class="php-var">$parent</span>[<span class="php-quote">'startx'</span>];
</span><span id="16164" class="l"><a href="#16164">16164: </a>                        <span class="php-comment">// account for booklet mode</span>
</span><span id="16165" class="l"><a href="#16165">16165: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;page &gt; <span class="php-var">$parent</span>[<span class="php-quote">'startpage'</span>]) {
</span><span id="16166" class="l"><a href="#16166">16166: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$parent</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'orm'</span>])) {
</span><span id="16167" class="l"><a href="#16167">16167: </a>                                <span class="php-var">$this</span>-&gt;x -= (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'orm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$parent</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'orm'</span>]);
</span><span id="16168" class="l"><a href="#16168">16168: </a>                            } <span class="php-keyword1">elseif</span> ((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$parent</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'olm'</span>])) {
</span><span id="16169" class="l"><a href="#16169">16169: </a>                                <span class="php-var">$this</span>-&gt;x += (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'olm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$parent</span>[<span class="php-quote">'startpage'</span>]][<span class="php-quote">'olm'</span>]);
</span><span id="16170" class="l"><a href="#16170">16170: </a>                            }
</span><span id="16171" class="l"><a href="#16171">16171: </a>                        }
</span><span id="16172" class="l"><a href="#16172">16172: </a>                    }
</span><span id="16173" class="l"><a href="#16173">16173: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16174" class="l"><a href="#16174">16174: </a>                }
</span><span id="16175" class="l"><a href="#16175">16175: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'tablehead'</span>:
</span><span id="16176" class="l"><a href="#16176">16176: </a>                    <span class="php-comment">// closing tag used for the thead part</span>
</span><span id="16177" class="l"><a href="#16177">16177: </a>                    <span class="php-var">$in_table_head</span> = <span class="php-keyword1">true</span>;
</span><span id="16178" class="l"><a href="#16178">16178: </a>                    <span class="php-var">$this</span>-&gt;inthead = <span class="php-keyword1">false</span>;
</span><span id="16179" class="l"><a href="#16179">16179: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'table'</span>: {
</span><span id="16180" class="l"><a href="#16180">16180: </a>                    <span class="php-var">$table_el</span> = <span class="php-var">$parent</span>;
</span><span id="16181" class="l"><a href="#16181">16181: </a>                    <span class="php-comment">// draw borders</span>
</span><span id="16182" class="l"><a href="#16182">16182: </a>                    <span class="php-keyword1">if</span> ((<span class="php-keyword1">isset</span>(<span class="php-var">$table_el</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'border'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$table_el</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'border'</span>] &gt; <span class="php-num">0</span>))
</span><span id="16183" class="l"><a href="#16183">16183: </a>                        <span class="php-keyword1">OR</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$table_el</span>[<span class="php-quote">'style'</span>][<span class="php-quote">'border'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$table_el</span>[<span class="php-quote">'style'</span>][<span class="php-quote">'border'</span>] &gt; <span class="php-num">0</span>))) {
</span><span id="16184" class="l"><a href="#16184">16184: </a>                            <span class="php-var">$border</span> = <span class="php-num">1</span>;
</span><span id="16185" class="l"><a href="#16185">16185: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16186" class="l"><a href="#16186">16186: </a>                        <span class="php-var">$border</span> = <span class="php-num">0</span>;
</span><span id="16187" class="l"><a href="#16187">16187: </a>                    }
</span><span id="16188" class="l"><a href="#16188">16188: </a>                    <span class="php-comment">// fix bottom line alignment of last line before page break</span>
</span><span id="16189" class="l"><a href="#16189">16189: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'trids'</span>] <span class="php-keyword1">as</span> <span class="php-var">$j</span> =&gt; <span class="php-var">$trkey</span>) {
</span><span id="16190" class="l"><a href="#16190">16190: </a>                        <span class="php-comment">// update row-spanned cells</span>
</span><span id="16191" class="l"><a href="#16191">16191: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>])) {
</span><span id="16192" class="l"><a href="#16192">16192: </a>                            <span class="php-keyword1">foreach</span> (<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$trwsp</span>) {
</span><span id="16193" class="l"><a href="#16193">16193: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'trid'</span>] == <span class="php-var">$trkey</span>) {
</span><span id="16194" class="l"><a href="#16194">16194: </a>                                    <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'mrowspan'</span>] -= <span class="php-num">1</span>;
</span><span id="16195" class="l"><a href="#16195">16195: </a>                                }
</span><span id="16196" class="l"><a href="#16196">16196: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prevtrkey</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'trid'</span>] == <span class="php-var">$prevtrkey</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'mrowspan'</span>] &gt;= <span class="php-num">0</span>)) {
</span><span id="16197" class="l"><a href="#16197">16197: </a>                                    <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'trid'</span>] = <span class="php-var">$trkey</span>;
</span><span id="16198" class="l"><a href="#16198">16198: </a>                                }
</span><span id="16199" class="l"><a href="#16199">16199: </a>                            }
</span><span id="16200" class="l"><a href="#16200">16200: </a>                        }
</span><span id="16201" class="l"><a href="#16201">16201: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$prevtrkey</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dom</span>[<span class="php-var">$trkey</span>][<span class="php-quote">'startpage'</span>] &gt; <span class="php-var">$dom</span>[<span class="php-var">$prevtrkey</span>][<span class="php-quote">'endpage'</span>])) {
</span><span id="16202" class="l"><a href="#16202">16202: </a>                            <span class="php-var">$pgendy</span> = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$dom</span>[<span class="php-var">$prevtrkey</span>][<span class="php-quote">'endpage'</span>]][<span class="php-quote">'hk'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$dom</span>[<span class="php-var">$prevtrkey</span>][<span class="php-quote">'endpage'</span>]][<span class="php-quote">'bm'</span>];
</span><span id="16203" class="l"><a href="#16203">16203: </a>                            <span class="php-var">$dom</span>[<span class="php-var">$prevtrkey</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$pgendy</span>;
</span><span id="16204" class="l"><a href="#16204">16204: </a>                            <span class="php-comment">// update row-spanned cells</span>
</span><span id="16205" class="l"><a href="#16205">16205: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>])) {
</span><span id="16206" class="l"><a href="#16206">16206: </a>                                <span class="php-keyword1">foreach</span> (<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$trwsp</span>) {
</span><span id="16207" class="l"><a href="#16207">16207: </a>                                    <span class="php-keyword1">if</span> ((<span class="php-var">$trwsp</span>[<span class="php-quote">'trid'</span>] == <span class="php-var">$trkey</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'mrowspan'</span>] &gt; <span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$trwsp</span>[<span class="php-quote">'endpage'</span>] == <span class="php-var">$dom</span>[<span class="php-var">$prevtrkey</span>][<span class="php-quote">'endpage'</span>])) {
</span><span id="16208" class="l"><a href="#16208">16208: </a>                                        <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'endy'</span>] = <span class="php-var">$pgendy</span>;
</span><span id="16209" class="l"><a href="#16209">16209: </a>                                        <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'rowspans'</span>][<span class="php-var">$k</span>][<span class="php-quote">'mrowspan'</span>] = -<span class="php-num">1</span>;
</span><span id="16210" class="l"><a href="#16210">16210: </a>                                    }
</span><span id="16211" class="l"><a href="#16211">16211: </a>                                }
</span><span id="16212" class="l"><a href="#16212">16212: </a>                            }
</span><span id="16213" class="l"><a href="#16213">16213: </a>                        }
</span><span id="16214" class="l"><a href="#16214">16214: </a>                        <span class="php-var">$prevtrkey</span> = <span class="php-var">$trkey</span>;
</span><span id="16215" class="l"><a href="#16215">16215: </a>                        <span class="php-var">$table_el</span> = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])];
</span><span id="16216" class="l"><a href="#16216">16216: </a>                    }
</span><span id="16217" class="l"><a href="#16217">16217: </a>                    <span class="php-comment">// for each row</span>
</span><span id="16218" class="l"><a href="#16218">16218: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$table_el</span>[<span class="php-quote">'trids'</span>] <span class="php-keyword1">as</span> <span class="php-var">$j</span> =&gt; <span class="php-var">$trkey</span>) {
</span><span id="16219" class="l"><a href="#16219">16219: </a>                        <span class="php-var">$parent</span> = <span class="php-var">$dom</span>[<span class="php-var">$trkey</span>];
</span><span id="16220" class="l"><a href="#16220">16220: </a>                        <span class="php-comment">// for each cell on the row</span>
</span><span id="16221" class="l"><a href="#16221">16221: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$parent</span>[<span class="php-quote">'cellpos'</span>] <span class="php-keyword1">as</span> <span class="php-var">$k</span> =&gt; <span class="php-var">$cellpos</span>) {
</span><span id="16222" class="l"><a href="#16222">16222: </a>                            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cellpos</span>[<span class="php-quote">'rowspanid'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$cellpos</span>[<span class="php-quote">'rowspanid'</span>] &gt;= <span class="php-num">0</span>)) {
</span><span id="16223" class="l"><a href="#16223">16223: </a>                                <span class="php-var">$cellpos</span>[<span class="php-quote">'startx'</span>] = <span class="php-var">$table_el</span>[<span class="php-quote">'rowspans'</span>][(<span class="php-var">$cellpos</span>[<span class="php-quote">'rowspanid'</span>])][<span class="php-quote">'startx'</span>];
</span><span id="16224" class="l"><a href="#16224">16224: </a>                                <span class="php-var">$cellpos</span>[<span class="php-quote">'endx'</span>] = <span class="php-var">$table_el</span>[<span class="php-quote">'rowspans'</span>][(<span class="php-var">$cellpos</span>[<span class="php-quote">'rowspanid'</span>])][<span class="php-quote">'endx'</span>];
</span><span id="16225" class="l"><a href="#16225">16225: </a>                                <span class="php-var">$endy</span> = <span class="php-var">$table_el</span>[<span class="php-quote">'rowspans'</span>][(<span class="php-var">$cellpos</span>[<span class="php-quote">'rowspanid'</span>])][<span class="php-quote">'endy'</span>];
</span><span id="16226" class="l"><a href="#16226">16226: </a>                                <span class="php-var">$startpage</span> = <span class="php-var">$table_el</span>[<span class="php-quote">'rowspans'</span>][(<span class="php-var">$cellpos</span>[<span class="php-quote">'rowspanid'</span>])][<span class="php-quote">'startpage'</span>];
</span><span id="16227" class="l"><a href="#16227">16227: </a>                                <span class="php-var">$endpage</span> = <span class="php-var">$table_el</span>[<span class="php-quote">'rowspans'</span>][(<span class="php-var">$cellpos</span>[<span class="php-quote">'rowspanid'</span>])][<span class="php-quote">'endpage'</span>];
</span><span id="16228" class="l"><a href="#16228">16228: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="16229" class="l"><a href="#16229">16229: </a>                                <span class="php-var">$endy</span> = <span class="php-var">$parent</span>[<span class="php-quote">'endy'</span>];
</span><span id="16230" class="l"><a href="#16230">16230: </a>                                <span class="php-var">$startpage</span> = <span class="php-var">$parent</span>[<span class="php-quote">'startpage'</span>];
</span><span id="16231" class="l"><a href="#16231">16231: </a>                                <span class="php-var">$endpage</span> = <span class="php-var">$parent</span>[<span class="php-quote">'endpage'</span>];
</span><span id="16232" class="l"><a href="#16232">16232: </a>                            }
</span><span id="16233" class="l"><a href="#16233">16233: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$endpage</span> &gt; <span class="php-var">$startpage</span>) {
</span><span id="16234" class="l"><a href="#16234">16234: </a>                                <span class="php-comment">// design borders around HTML cells.</span>
</span><span id="16235" class="l"><a href="#16235">16235: </a>                                <span class="php-keyword1">for</span> (<span class="php-var">$page</span>=<span class="php-var">$startpage</span>; <span class="php-var">$page</span> &lt;= <span class="php-var">$endpage</span>; ++<span class="php-var">$page</span>) {
</span><span id="16236" class="l"><a href="#16236">16236: </a>                                    <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$page</span>);
</span><span id="16237" class="l"><a href="#16237">16237: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$page</span> == <span class="php-var">$startpage</span>) {
</span><span id="16238" class="l"><a href="#16238">16238: </a>                                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$parent</span>[<span class="php-quote">'starty'</span>]; <span class="php-comment">// put cursor at the beginning of row on the first page</span>
</span><span id="16239" class="l"><a href="#16239">16239: </a>                                        <span class="php-var">$ch</span> = <span class="php-var">$this</span>-&gt;getPageHeight() - <span class="php-var">$parent</span>[<span class="php-quote">'starty'</span>] - <span class="php-var">$this</span>-&gt;getBreakMargin();
</span><span id="16240" class="l"><a href="#16240">16240: </a>                                        <span class="php-var">$cborder</span> = <span class="php-var">$this</span>-&gt;getBorderMode(<span class="php-var">$border</span>, <span class="php-var">$position</span>=<span class="php-quote">'start'</span>);
</span><span id="16241" class="l"><a href="#16241">16241: </a>                                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$page</span> == <span class="php-var">$endpage</span>) {
</span><span id="16242" class="l"><a href="#16242">16242: </a>                                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin; <span class="php-comment">// put cursor at the beginning of last page</span>
</span><span id="16243" class="l"><a href="#16243">16243: </a>                                        <span class="php-var">$ch</span> = <span class="php-var">$endy</span> - <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="16244" class="l"><a href="#16244">16244: </a>                                        <span class="php-var">$cborder</span> = <span class="php-var">$this</span>-&gt;getBorderMode(<span class="php-var">$border</span>, <span class="php-var">$position</span>=<span class="php-quote">'end'</span>);
</span><span id="16245" class="l"><a href="#16245">16245: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="16246" class="l"><a href="#16246">16246: </a>                                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin; <span class="php-comment">// put cursor at the beginning of the current page</span>
</span><span id="16247" class="l"><a href="#16247">16247: </a>                                        <span class="php-var">$ch</span> = <span class="php-var">$this</span>-&gt;getPageHeight() - <span class="php-var">$this</span>-&gt;tMargin - <span class="php-var">$this</span>-&gt;getBreakMargin();
</span><span id="16248" class="l"><a href="#16248">16248: </a>                                        <span class="php-var">$cborder</span> = <span class="php-var">$this</span>-&gt;getBorderMode(<span class="php-var">$border</span>, <span class="php-var">$position</span>=<span class="php-quote">'middle'</span>);
</span><span id="16249" class="l"><a href="#16249">16249: </a>                                    }
</span><span id="16250" class="l"><a href="#16250">16250: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cellpos</span>[<span class="php-quote">'bgcolor'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$cellpos</span>[<span class="php-quote">'bgcolor'</span>]) !== <span class="php-keyword1">false</span>) {
</span><span id="16251" class="l"><a href="#16251">16251: </a>                                        <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$cellpos</span>[<span class="php-quote">'bgcolor'</span>]);
</span><span id="16252" class="l"><a href="#16252">16252: </a>                                        <span class="php-var">$fill</span> = <span class="php-keyword1">true</span>;
</span><span id="16253" class="l"><a href="#16253">16253: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="16254" class="l"><a href="#16254">16254: </a>                                        <span class="php-var">$fill</span> = <span class="php-keyword1">false</span>;
</span><span id="16255" class="l"><a href="#16255">16255: </a>                                    }
</span><span id="16256" class="l"><a href="#16256">16256: </a>                                    <span class="php-var">$cw</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$cellpos</span>[<span class="php-quote">'endx'</span>] - <span class="php-var">$cellpos</span>[<span class="php-quote">'startx'</span>]);
</span><span id="16257" class="l"><a href="#16257">16257: </a>                                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$cellpos</span>[<span class="php-quote">'startx'</span>];
</span><span id="16258" class="l"><a href="#16258">16258: </a>                                    <span class="php-comment">// account for margin changes</span>
</span><span id="16259" class="l"><a href="#16259">16259: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$page</span> &gt; <span class="php-var">$startpage</span>) {
</span><span id="16260" class="l"><a href="#16260">16260: </a>                                        <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'orm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'orm'</span>])) {
</span><span id="16261" class="l"><a href="#16261">16261: </a>                                            <span class="php-var">$this</span>-&gt;x -= (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'orm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'orm'</span>]);
</span><span id="16262" class="l"><a href="#16262">16262: </a>                                        } <span class="php-keyword1">elseif</span> ((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'lm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'olm'</span>])) {
</span><span id="16263" class="l"><a href="#16263">16263: </a>                                            <span class="php-var">$this</span>-&gt;x += (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>][<span class="php-quote">'olm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'olm'</span>]);
</span><span id="16264" class="l"><a href="#16264">16264: </a>                                        }
</span><span id="16265" class="l"><a href="#16265">16265: </a>                                    }
</span><span id="16266" class="l"><a href="#16266">16266: </a>                                    <span class="php-comment">// design a cell around the text</span>
</span><span id="16267" class="l"><a href="#16267">16267: </a>                                    <span class="php-var">$ccode</span> = <span class="php-var">$this</span>-&gt;FillColor.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$this</span>-&gt;getCellCode(<span class="php-var">$cw</span>, <span class="php-var">$ch</span>, <span class="php-quote">''</span>, <span class="php-var">$cborder</span>, <span class="php-num">1</span>, <span class="php-quote">''</span>, <span class="php-var">$fill</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-keyword1">true</span>);
</span><span id="16268" class="l"><a href="#16268">16268: </a>                                    <span class="php-keyword1">if</span> (<span class="php-var">$cborder</span> <span class="php-keyword1">OR</span> <span class="php-var">$fill</span>) {
</span><span id="16269" class="l"><a href="#16269">16269: </a>                                        <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$this</span>-&gt;page);
</span><span id="16270" class="l"><a href="#16270">16270: </a>                                        <span class="php-var">$pstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="16271" class="l"><a href="#16271">16271: </a>                                        <span class="php-var">$pend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="16272" class="l"><a href="#16272">16272: </a>                                        <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$pstart</span>.<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="16273" class="l"><a href="#16273">16273: </a>                                        <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page] += <span class="php-keyword2">strlen</span>(<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="16274" class="l"><a href="#16274">16274: </a>                                    }
</span><span id="16275" class="l"><a href="#16275">16275: </a>                                }
</span><span id="16276" class="l"><a href="#16276">16276: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="16277" class="l"><a href="#16277">16277: </a>                                <span class="php-var">$this</span>-&gt;setPage(<span class="php-var">$startpage</span>);
</span><span id="16278" class="l"><a href="#16278">16278: </a>                                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$cellpos</span>[<span class="php-quote">'bgcolor'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$cellpos</span>[<span class="php-quote">'bgcolor'</span>]) !== <span class="php-keyword1">false</span>) {
</span><span id="16279" class="l"><a href="#16279">16279: </a>                                    <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$cellpos</span>[<span class="php-quote">'bgcolor'</span>]);
</span><span id="16280" class="l"><a href="#16280">16280: </a>                                    <span class="php-var">$fill</span> = <span class="php-keyword1">true</span>;
</span><span id="16281" class="l"><a href="#16281">16281: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="16282" class="l"><a href="#16282">16282: </a>                                    <span class="php-var">$fill</span> = <span class="php-keyword1">false</span>;
</span><span id="16283" class="l"><a href="#16283">16283: </a>                                }
</span><span id="16284" class="l"><a href="#16284">16284: </a>                                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$cellpos</span>[<span class="php-quote">'startx'</span>];
</span><span id="16285" class="l"><a href="#16285">16285: </a>                                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$parent</span>[<span class="php-quote">'starty'</span>];
</span><span id="16286" class="l"><a href="#16286">16286: </a>                                <span class="php-var">$cw</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$cellpos</span>[<span class="php-quote">'endx'</span>] - <span class="php-var">$cellpos</span>[<span class="php-quote">'startx'</span>]);
</span><span id="16287" class="l"><a href="#16287">16287: </a>                                <span class="php-var">$ch</span> = <span class="php-var">$endy</span> - <span class="php-var">$parent</span>[<span class="php-quote">'starty'</span>];
</span><span id="16288" class="l"><a href="#16288">16288: </a>                                <span class="php-comment">// design a cell around the text</span>
</span><span id="16289" class="l"><a href="#16289">16289: </a>                                <span class="php-var">$ccode</span> = <span class="php-var">$this</span>-&gt;FillColor.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$this</span>-&gt;getCellCode(<span class="php-var">$cw</span>, <span class="php-var">$ch</span>, <span class="php-quote">''</span>, <span class="php-var">$border</span>, <span class="php-num">1</span>, <span class="php-quote">''</span>, <span class="php-var">$fill</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-keyword1">true</span>);
</span><span id="16290" class="l"><a href="#16290">16290: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$border</span> <span class="php-keyword1">OR</span> <span class="php-var">$fill</span>) {
</span><span id="16291" class="l"><a href="#16291">16291: </a>                                    <span class="php-keyword1">if</span> (<span class="php-keyword2">end</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page]) !== <span class="php-keyword1">false</span>) {
</span><span id="16292" class="l"><a href="#16292">16292: </a>                                        <span class="php-var">$pagemarkkey</span> = <span class="php-keyword2">key</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page]);
</span><span id="16293" class="l"><a href="#16293">16293: </a>                                        <span class="php-var">$pagemark</span> = &amp;<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page][<span class="php-var">$pagemarkkey</span>];
</span><span id="16294" class="l"><a href="#16294">16294: </a>                                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$this</span>-&gt;InFooter) {
</span><span id="16295" class="l"><a href="#16295">16295: </a>                                        <span class="php-var">$pagemark</span> = &amp;<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page];
</span><span id="16296" class="l"><a href="#16296">16296: </a>                                    } <span class="php-keyword1">else</span> {
</span><span id="16297" class="l"><a href="#16297">16297: </a>                                        <span class="php-var">$pagemark</span> = &amp;<span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page];
</span><span id="16298" class="l"><a href="#16298">16298: </a>                                    }
</span><span id="16299" class="l"><a href="#16299">16299: </a>                                    <span class="php-var">$pagebuff</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$this</span>-&gt;page);
</span><span id="16300" class="l"><a href="#16300">16300: </a>                                    <span class="php-var">$pstart</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-num">0</span>, <span class="php-var">$pagemark</span>);
</span><span id="16301" class="l"><a href="#16301">16301: </a>                                    <span class="php-var">$pend</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$pagebuff</span>, <span class="php-var">$pagemark</span>);
</span><span id="16302" class="l"><a href="#16302">16302: </a>                                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$pstart</span>.<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>.<span class="php-var">$pend</span>);
</span><span id="16303" class="l"><a href="#16303">16303: </a>                                    <span class="php-var">$pagemark</span> += <span class="php-keyword2">strlen</span>(<span class="php-var">$ccode</span>.<span class="php-quote">&quot;\n&quot;</span>);
</span><span id="16304" class="l"><a href="#16304">16304: </a>                                }
</span><span id="16305" class="l"><a href="#16305">16305: </a>                            }
</span><span id="16306" class="l"><a href="#16306">16306: </a>                        }
</span><span id="16307" class="l"><a href="#16307">16307: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$table_el</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>])) {
</span><span id="16308" class="l"><a href="#16308">16308: </a>                            <span class="php-var">$cellspacing</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$table_el</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'cellspacing'</span>], <span class="php-num">1</span>, <span class="php-quote">'px'</span>);
</span><span id="16309" class="l"><a href="#16309">16309: </a>                            <span class="php-var">$this</span>-&gt;y += <span class="php-var">$cellspacing</span>;
</span><span id="16310" class="l"><a href="#16310">16310: </a>                        }
</span><span id="16311" class="l"><a href="#16311">16311: </a>                        <span class="php-var">$this</span>-&gt;Ln(<span class="php-num">0</span>, <span class="php-var">$cell</span>);
</span><span id="16312" class="l"><a href="#16312">16312: </a>                        <span class="php-var">$this</span>-&gt;x = <span class="php-var">$parent</span>[<span class="php-quote">'startx'</span>];
</span><span id="16313" class="l"><a href="#16313">16313: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$endpage</span> &gt; <span class="php-var">$startpage</span>) {
</span><span id="16314" class="l"><a href="#16314">16314: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$endpage</span>][<span class="php-quote">'orm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'orm'</span>])) {
</span><span id="16315" class="l"><a href="#16315">16315: </a>                                <span class="php-var">$this</span>-&gt;x += (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$endpage</span>][<span class="php-quote">'orm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'orm'</span>]);
</span><span id="16316" class="l"><a href="#16316">16316: </a>                            } <span class="php-keyword1">elseif</span> ((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$endpage</span>][<span class="php-quote">'olm'</span>] != <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'olm'</span>])) {
</span><span id="16317" class="l"><a href="#16317">16317: </a>                                <span class="php-var">$this</span>-&gt;x += (<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$endpage</span>][<span class="php-quote">'olm'</span>] - <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$startpage</span>][<span class="php-quote">'olm'</span>]);
</span><span id="16318" class="l"><a href="#16318">16318: </a>                            }
</span><span id="16319" class="l"><a href="#16319">16319: </a>                        }
</span><span id="16320" class="l"><a href="#16320">16320: </a>                    }
</span><span id="16321" class="l"><a href="#16321">16321: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$in_table_head</span>) {
</span><span id="16322" class="l"><a href="#16322">16322: </a>                        <span class="php-comment">// we are not inside a thead section</span>
</span><span id="16323" class="l"><a href="#16323">16323: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$parent</span>[<span class="php-quote">'cellpadding'</span>])) {
</span><span id="16324" class="l"><a href="#16324">16324: </a>                            <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$this</span>-&gt;oldcMargin;
</span><span id="16325" class="l"><a href="#16325">16325: </a>                        }
</span><span id="16326" class="l"><a href="#16326">16326: </a>                        <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="16327" class="l"><a href="#16327">16327: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'top'</span>])) {
</span><span id="16328" class="l"><a href="#16328">16328: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'top'</span>] == <span class="php-var">$this</span>-&gt;tMargin) <span class="php-keyword1">AND</span> (<span class="php-var">$this</span>-&gt;page == (<span class="php-var">$this</span>-&gt;numpages - <span class="php-num">1</span>))) {
</span><span id="16329" class="l"><a href="#16329">16329: </a>                                <span class="php-comment">// remove last page containing only THEAD</span>
</span><span id="16330" class="l"><a href="#16330">16330: </a>                                <span class="php-var">$this</span>-&gt;deletePage(<span class="php-var">$this</span>-&gt;numpages);
</span><span id="16331" class="l"><a href="#16331">16331: </a>                            }
</span><span id="16332" class="l"><a href="#16332">16332: </a>                            <span class="php-comment">// restore top margin</span>
</span><span id="16333" class="l"><a href="#16333">16333: </a>                            <span class="php-var">$this</span>-&gt;tMargin = <span class="php-var">$this</span>-&gt;theadMargins[<span class="php-quote">'top'</span>];
</span><span id="16334" class="l"><a href="#16334">16334: </a>                            <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page][<span class="php-quote">'tm'</span>] = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="16335" class="l"><a href="#16335">16335: </a>                        }
</span><span id="16336" class="l"><a href="#16336">16336: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$table_el</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'nested'</span>]) <span class="php-keyword1">OR</span> (<span class="php-var">$table_el</span>[<span class="php-quote">'attribute'</span>][<span class="php-quote">'nested'</span>] != <span class="php-quote">'true'</span>)) {
</span><span id="16337" class="l"><a href="#16337">16337: </a>                            <span class="php-comment">// reset main table header</span>
</span><span id="16338" class="l"><a href="#16338">16338: </a>                            <span class="php-var">$this</span>-&gt;thead = <span class="php-quote">''</span>;
</span><span id="16339" class="l"><a href="#16339">16339: </a>                            <span class="php-var">$this</span>-&gt;theadMargins = <span class="php-keyword1">array</span>();
</span><span id="16340" class="l"><a href="#16340">16340: </a>                        }
</span><span id="16341" class="l"><a href="#16341">16341: </a>                    }
</span><span id="16342" class="l"><a href="#16342">16342: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16343" class="l"><a href="#16343">16343: </a>                }
</span><span id="16344" class="l"><a href="#16344">16344: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'a'</span>: {
</span><span id="16345" class="l"><a href="#16345">16345: </a>                    <span class="php-var">$this</span>-&gt;HREF = <span class="php-quote">''</span>;
</span><span id="16346" class="l"><a href="#16346">16346: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16347" class="l"><a href="#16347">16347: </a>                }
</span><span id="16348" class="l"><a href="#16348">16348: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'sup'</span>: {
</span><span id="16349" class="l"><a href="#16349">16349: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;GetX(), <span class="php-var">$this</span>-&gt;GetY() + ((<span class="php-num">0.7</span> * <span class="php-var">$parent</span>[<span class="php-quote">'fontsize'</span>]) / <span class="php-var">$this</span>-&gt;k));
</span><span id="16350" class="l"><a href="#16350">16350: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16351" class="l"><a href="#16351">16351: </a>                }
</span><span id="16352" class="l"><a href="#16352">16352: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'sub'</span>: {
</span><span id="16353" class="l"><a href="#16353">16353: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$this</span>-&gt;GetX(), <span class="php-var">$this</span>-&gt;GetY() - ((<span class="php-num">0.3</span> * <span class="php-var">$parent</span>[<span class="php-quote">'fontsize'</span>])/<span class="php-var">$this</span>-&gt;k));
</span><span id="16354" class="l"><a href="#16354">16354: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16355" class="l"><a href="#16355">16355: </a>                }
</span><span id="16356" class="l"><a href="#16356">16356: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'div'</span>: {
</span><span id="16357" class="l"><a href="#16357">16357: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16358" class="l"><a href="#16358">16358: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16359" class="l"><a href="#16359">16359: </a>                }
</span><span id="16360" class="l"><a href="#16360">16360: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'blockquote'</span>: {
</span><span id="16361" class="l"><a href="#16361">16361: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="16362" class="l"><a href="#16362">16362: </a>                        <span class="php-var">$this</span>-&gt;rMargin -= <span class="php-var">$this</span>-&gt;listindent;
</span><span id="16363" class="l"><a href="#16363">16363: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16364" class="l"><a href="#16364">16364: </a>                        <span class="php-var">$this</span>-&gt;lMargin -= <span class="php-var">$this</span>-&gt;listindent;
</span><span id="16365" class="l"><a href="#16365">16365: </a>                    }
</span><span id="16366" class="l"><a href="#16366">16366: </a>                    --<span class="php-var">$this</span>-&gt;listindentlevel;
</span><span id="16367" class="l"><a href="#16367">16367: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16368" class="l"><a href="#16368">16368: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16369" class="l"><a href="#16369">16369: </a>                }
</span><span id="16370" class="l"><a href="#16370">16370: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'p'</span>: {
</span><span id="16371" class="l"><a href="#16371">16371: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16372" class="l"><a href="#16372">16372: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16373" class="l"><a href="#16373">16373: </a>                }
</span><span id="16374" class="l"><a href="#16374">16374: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'pre'</span>: {
</span><span id="16375" class="l"><a href="#16375">16375: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16376" class="l"><a href="#16376">16376: </a>                    <span class="php-var">$this</span>-&gt;premode = <span class="php-keyword1">false</span>;
</span><span id="16377" class="l"><a href="#16377">16377: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16378" class="l"><a href="#16378">16378: </a>                }
</span><span id="16379" class="l"><a href="#16379">16379: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'dl'</span>: {
</span><span id="16380" class="l"><a href="#16380">16380: </a>                    --<span class="php-var">$this</span>-&gt;listnum;
</span><span id="16381" class="l"><a href="#16381">16381: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;listnum &lt;= <span class="php-num">0</span>) {
</span><span id="16382" class="l"><a href="#16382">16382: </a>                        <span class="php-var">$this</span>-&gt;listnum = <span class="php-num">0</span>;
</span><span id="16383" class="l"><a href="#16383">16383: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16384" class="l"><a href="#16384">16384: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16385" class="l"><a href="#16385">16385: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16386" class="l"><a href="#16386">16386: </a>                    }
</span><span id="16387" class="l"><a href="#16387">16387: </a>                    <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="16388" class="l"><a href="#16388">16388: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16389" class="l"><a href="#16389">16389: </a>                }
</span><span id="16390" class="l"><a href="#16390">16390: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'dt'</span>: {
</span><span id="16391" class="l"><a href="#16391">16391: </a>                    <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">''</span>;
</span><span id="16392" class="l"><a href="#16392">16392: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16393" class="l"><a href="#16393">16393: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16394" class="l"><a href="#16394">16394: </a>                }
</span><span id="16395" class="l"><a href="#16395">16395: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'dd'</span>: {
</span><span id="16396" class="l"><a href="#16396">16396: </a>                    <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">''</span>;
</span><span id="16397" class="l"><a href="#16397">16397: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="16398" class="l"><a href="#16398">16398: </a>                        <span class="php-var">$this</span>-&gt;rMargin -= <span class="php-var">$this</span>-&gt;listindent;
</span><span id="16399" class="l"><a href="#16399">16399: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16400" class="l"><a href="#16400">16400: </a>                        <span class="php-var">$this</span>-&gt;lMargin -= <span class="php-var">$this</span>-&gt;listindent;
</span><span id="16401" class="l"><a href="#16401">16401: </a>                    }
</span><span id="16402" class="l"><a href="#16402">16402: </a>                    --<span class="php-var">$this</span>-&gt;listindentlevel;
</span><span id="16403" class="l"><a href="#16403">16403: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16404" class="l"><a href="#16404">16404: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16405" class="l"><a href="#16405">16405: </a>                }
</span><span id="16406" class="l"><a href="#16406">16406: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'ul'</span>:
</span><span id="16407" class="l"><a href="#16407">16407: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'ol'</span>: {
</span><span id="16408" class="l"><a href="#16408">16408: </a>                    --<span class="php-var">$this</span>-&gt;listnum;
</span><span id="16409" class="l"><a href="#16409">16409: </a>                    <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">''</span>;
</span><span id="16410" class="l"><a href="#16410">16410: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="16411" class="l"><a href="#16411">16411: </a>                        <span class="php-var">$this</span>-&gt;rMargin -= <span class="php-var">$this</span>-&gt;listindent;
</span><span id="16412" class="l"><a href="#16412">16412: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16413" class="l"><a href="#16413">16413: </a>                        <span class="php-var">$this</span>-&gt;lMargin -= <span class="php-var">$this</span>-&gt;listindent;
</span><span id="16414" class="l"><a href="#16414">16414: </a>                    }
</span><span id="16415" class="l"><a href="#16415">16415: </a>                    --<span class="php-var">$this</span>-&gt;listindentlevel;
</span><span id="16416" class="l"><a href="#16416">16416: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;listnum &lt;= <span class="php-num">0</span>) {
</span><span id="16417" class="l"><a href="#16417">16417: </a>                        <span class="php-var">$this</span>-&gt;listnum = <span class="php-num">0</span>;
</span><span id="16418" class="l"><a href="#16418">16418: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16419" class="l"><a href="#16419">16419: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16420" class="l"><a href="#16420">16420: </a>                        <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16421" class="l"><a href="#16421">16421: </a>                    }
</span><span id="16422" class="l"><a href="#16422">16422: </a>                    <span class="php-var">$this</span>-&gt;lasth = <span class="php-var">$this</span>-&gt;FontSize * <span class="php-var">$this</span>-&gt;cell_height_ratio;
</span><span id="16423" class="l"><a href="#16423">16423: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16424" class="l"><a href="#16424">16424: </a>                }
</span><span id="16425" class="l"><a href="#16425">16425: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'li'</span>: {
</span><span id="16426" class="l"><a href="#16426">16426: </a>                    <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">''</span>;
</span><span id="16427" class="l"><a href="#16427">16427: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16428" class="l"><a href="#16428">16428: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16429" class="l"><a href="#16429">16429: </a>                }
</span><span id="16430" class="l"><a href="#16430">16430: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h1'</span>:
</span><span id="16431" class="l"><a href="#16431">16431: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h2'</span>:
</span><span id="16432" class="l"><a href="#16432">16432: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h3'</span>:
</span><span id="16433" class="l"><a href="#16433">16433: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h4'</span>:
</span><span id="16434" class="l"><a href="#16434">16434: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h5'</span>:
</span><span id="16435" class="l"><a href="#16435">16435: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'h6'</span>: {
</span><span id="16436" class="l"><a href="#16436">16436: </a>                    <span class="php-var">$this</span>-&gt;addHTMLVertSpace(<span class="php-var">$hbz</span>, <span class="php-var">$hb</span>, <span class="php-var">$cell</span>, <span class="php-var">$firstorlast</span>);
</span><span id="16437" class="l"><a href="#16437">16437: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16438" class="l"><a href="#16438">16438: </a>                }
</span><span id="16439" class="l"><a href="#16439">16439: </a>                <span class="php-comment">// Form fields (since 4.8.000 - 2009-09-07)</span>
</span><span id="16440" class="l"><a href="#16440">16440: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'form'</span>: {
</span><span id="16441" class="l"><a href="#16441">16441: </a>                    <span class="php-var">$this</span>-&gt;form_action = <span class="php-quote">''</span>;
</span><span id="16442" class="l"><a href="#16442">16442: </a>                    <span class="php-var">$this</span>-&gt;form_enctype = <span class="php-quote">'application/x-www-form-urlencoded'</span>;
</span><span id="16443" class="l"><a href="#16443">16443: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16444" class="l"><a href="#16444">16444: </a>                }
</span><span id="16445" class="l"><a href="#16445">16445: </a>                <span class="php-keyword1">default</span> : {
</span><span id="16446" class="l"><a href="#16446">16446: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16447" class="l"><a href="#16447">16447: </a>                }
</span><span id="16448" class="l"><a href="#16448">16448: </a>            }
</span><span id="16449" class="l"><a href="#16449">16449: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreakafter'</span>])) {
</span><span id="16450" class="l"><a href="#16450">16450: </a>                <span class="php-var">$pba</span> = <span class="php-var">$dom</span>[(<span class="php-var">$dom</span>[<span class="php-var">$key</span>][<span class="php-quote">'parent'</span>])][<span class="php-quote">'attribute'</span>][<span class="php-quote">'pagebreakafter'</span>];
</span><span id="16451" class="l"><a href="#16451">16451: </a>                <span class="php-comment">// check for pagebreak</span>
</span><span id="16452" class="l"><a href="#16452">16452: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$pba</span> == <span class="php-quote">'true'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$pba</span> == <span class="php-quote">'left'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$pba</span> == <span class="php-quote">'right'</span>)) {
</span><span id="16453" class="l"><a href="#16453">16453: </a>                    <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="16454" class="l"><a href="#16454">16454: </a>                    <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>);
</span><span id="16455" class="l"><a href="#16455">16455: </a>                }
</span><span id="16456" class="l"><a href="#16456">16456: </a>                <span class="php-keyword1">if</span> (((<span class="php-var">$pba</span> == <span class="php-quote">'left'</span>) <span class="php-keyword1">AND</span> (((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) == <span class="php-num">0</span>)) <span class="php-keyword1">OR</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) != <span class="php-num">0</span>))))
</span><span id="16457" class="l"><a href="#16457">16457: </a>                    <span class="php-keyword1">OR</span> ((<span class="php-var">$pba</span> == <span class="php-quote">'right'</span>) <span class="php-keyword1">AND</span> (((!<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) != <span class="php-num">0</span>)) <span class="php-keyword1">OR</span> ((<span class="php-var">$this</span>-&gt;rtl) <span class="php-keyword1">AND</span> ((<span class="php-var">$this</span>-&gt;page % <span class="php-num">2</span>) == <span class="php-num">0</span>))))) {
</span><span id="16458" class="l"><a href="#16458">16458: </a>                    <span class="php-comment">// add a page (or trig AcceptPageBreak() for multicolumn mode)</span>
</span><span id="16459" class="l"><a href="#16459">16459: </a>                    <span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$this</span>-&gt;PageBreakTrigger + <span class="php-num">1</span>);
</span><span id="16460" class="l"><a href="#16460">16460: </a>                }
</span><span id="16461" class="l"><a href="#16461">16461: </a>            }
</span><span id="16462" class="l"><a href="#16462">16462: </a>            <span class="php-var">$this</span>-&gt;tmprtl = <span class="php-keyword1">false</span>;
</span><span id="16463" class="l"><a href="#16463">16463: </a>        }
</span><span id="16464" class="l"><a href="#16464">16464: </a>
</span><span id="16465" class="l"><a href="#16465">16465: </a>        <span class="php-comment">/**
</span></span><span id="16466" class="l"><a href="#16466">16466: </a><span class="php-comment">         * Add vertical spaces if needed.
</span></span><span id="16467" class="l"><a href="#16467">16467: </a><span class="php-comment">         * @param string $hbz Distance between current y and line bottom.
</span></span><span id="16468" class="l"><a href="#16468">16468: </a><span class="php-comment">         * @param string $hb The height of the break.
</span></span><span id="16469" class="l"><a href="#16469">16469: </a><span class="php-comment">         * @param boolean $cell if true add the default cMargin space to each new line (default false).
</span></span><span id="16470" class="l"><a href="#16470">16470: </a><span class="php-comment">         * @param boolean $firstorlast if true do not print additional empty lines.
</span></span><span id="16471" class="l"><a href="#16471">16471: </a><span class="php-comment">         * @access protected
</span></span><span id="16472" class="l"><a href="#16472">16472: </a><span class="php-comment">         */</span>
</span><span id="16473" class="l"><a href="#16473">16473: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> addHTMLVertSpace(<span class="php-var">$hbz</span>=<span class="php-num">0</span>, <span class="php-var">$hb</span>=<span class="php-num">0</span>, <span class="php-var">$cell</span>=<span class="php-keyword1">false</span>, <span class="php-var">$firstorlast</span>=<span class="php-keyword1">false</span>) {
</span><span id="16474" class="l"><a href="#16474">16474: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$firstorlast</span>) {
</span><span id="16475" class="l"><a href="#16475">16475: </a>                <span class="php-var">$this</span>-&gt;Ln(<span class="php-num">0</span>, <span class="php-var">$cell</span>);
</span><span id="16476" class="l"><a href="#16476">16476: </a>                <span class="php-var">$this</span>-&gt;htmlvspace = <span class="php-num">0</span>;
</span><span id="16477" class="l"><a href="#16477">16477: </a>                <span class="php-keyword1">return</span>;
</span><span id="16478" class="l"><a href="#16478">16478: </a>            }
</span><span id="16479" class="l"><a href="#16479">16479: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$hb</span> &lt; <span class="php-var">$this</span>-&gt;htmlvspace) {
</span><span id="16480" class="l"><a href="#16480">16480: </a>                <span class="php-var">$hd</span> = <span class="php-num">0</span>;
</span><span id="16481" class="l"><a href="#16481">16481: </a>            } <span class="php-keyword1">else</span> {
</span><span id="16482" class="l"><a href="#16482">16482: </a>                <span class="php-var">$hd</span> = <span class="php-var">$hb</span> - <span class="php-var">$this</span>-&gt;htmlvspace;
</span><span id="16483" class="l"><a href="#16483">16483: </a>                <span class="php-var">$this</span>-&gt;htmlvspace = <span class="php-var">$hb</span>;
</span><span id="16484" class="l"><a href="#16484">16484: </a>            }
</span><span id="16485" class="l"><a href="#16485">16485: </a>            <span class="php-var">$this</span>-&gt;Ln((<span class="php-var">$hbz</span> + <span class="php-var">$hd</span>), <span class="php-var">$cell</span>);
</span><span id="16486" class="l"><a href="#16486">16486: </a>        }
</span><span id="16487" class="l"><a href="#16487">16487: </a>
</span><span id="16488" class="l"><a href="#16488">16488: </a>        <span class="php-comment">/**
</span></span><span id="16489" class="l"><a href="#16489">16489: </a><span class="php-comment">         * Set the default bullet to be used as LI bullet symbol
</span></span><span id="16490" class="l"><a href="#16490">16490: </a><span class="php-comment">         * @param string $symbol character or string to be used (legal values are: '' = automatic, '!' = auto bullet, '#' = auto numbering, 'disc', 'disc', 'circle', 'square', '1', 'decimal', 'decimal-leading-zero', 'i', 'lower-roman', 'I', 'upper-roman', 'a', 'lower-alpha', 'lower-latin', 'A', 'upper-alpha', 'upper-latin', 'lower-greek')
</span></span><span id="16491" class="l"><a href="#16491">16491: </a><span class="php-comment">         * @access public
</span></span><span id="16492" class="l"><a href="#16492">16492: </a><span class="php-comment">         * @since 4.0.028 (2008-09-26)
</span></span><span id="16493" class="l"><a href="#16493">16493: </a><span class="php-comment">         */</span>
</span><span id="16494" class="l"><a href="#16494">16494: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setLIsymbol(<span class="php-var">$symbol</span>=<span class="php-quote">'!'</span>) {
</span><span id="16495" class="l"><a href="#16495">16495: </a>            <span class="php-var">$symbol</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$symbol</span>);
</span><span id="16496" class="l"><a href="#16496">16496: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$symbol</span>) {
</span><span id="16497" class="l"><a href="#16497">16497: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'!'</span> :
</span><span id="16498" class="l"><a href="#16498">16498: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'#'</span> :
</span><span id="16499" class="l"><a href="#16499">16499: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'disc'</span> :
</span><span id="16500" class="l"><a href="#16500">16500: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'circle'</span> :
</span><span id="16501" class="l"><a href="#16501">16501: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'square'</span> :
</span><span id="16502" class="l"><a href="#16502">16502: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'1'</span>:
</span><span id="16503" class="l"><a href="#16503">16503: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'decimal'</span>:
</span><span id="16504" class="l"><a href="#16504">16504: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'decimal-leading-zero'</span>:
</span><span id="16505" class="l"><a href="#16505">16505: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'i'</span>:
</span><span id="16506" class="l"><a href="#16506">16506: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-roman'</span>:
</span><span id="16507" class="l"><a href="#16507">16507: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'I'</span>:
</span><span id="16508" class="l"><a href="#16508">16508: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'upper-roman'</span>:
</span><span id="16509" class="l"><a href="#16509">16509: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'a'</span>:
</span><span id="16510" class="l"><a href="#16510">16510: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-alpha'</span>:
</span><span id="16511" class="l"><a href="#16511">16511: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-latin'</span>:
</span><span id="16512" class="l"><a href="#16512">16512: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'A'</span>:
</span><span id="16513" class="l"><a href="#16513">16513: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'upper-alpha'</span>:
</span><span id="16514" class="l"><a href="#16514">16514: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'upper-latin'</span>:
</span><span id="16515" class="l"><a href="#16515">16515: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-greek'</span>: {
</span><span id="16516" class="l"><a href="#16516">16516: </a>                    <span class="php-var">$this</span>-&gt;lisymbol = <span class="php-var">$symbol</span>;
</span><span id="16517" class="l"><a href="#16517">16517: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16518" class="l"><a href="#16518">16518: </a>                }
</span><span id="16519" class="l"><a href="#16519">16519: </a>                <span class="php-keyword1">default</span> : {
</span><span id="16520" class="l"><a href="#16520">16520: </a>                    <span class="php-var">$this</span>-&gt;lisymbol = <span class="php-quote">''</span>;
</span><span id="16521" class="l"><a href="#16521">16521: </a>                }
</span><span id="16522" class="l"><a href="#16522">16522: </a>            }
</span><span id="16523" class="l"><a href="#16523">16523: </a>        }
</span><span id="16524" class="l"><a href="#16524">16524: </a>
</span><span id="16525" class="l"><a href="#16525">16525: </a>        <span class="php-comment">/**
</span></span><span id="16526" class="l"><a href="#16526">16526: </a><span class="php-comment">         * Set the booklet mode for double-sided pages.
</span></span><span id="16527" class="l"><a href="#16527">16527: </a><span class="php-comment">         * @param boolean $booklet true set the booklet mode on, fals eotherwise.
</span></span><span id="16528" class="l"><a href="#16528">16528: </a><span class="php-comment">         * @param float $inner Inner page margin.
</span></span><span id="16529" class="l"><a href="#16529">16529: </a><span class="php-comment">         * @param float $outer Outer page margin.
</span></span><span id="16530" class="l"><a href="#16530">16530: </a><span class="php-comment">         * @access public
</span></span><span id="16531" class="l"><a href="#16531">16531: </a><span class="php-comment">         * @since 4.2.000 (2008-10-29)
</span></span><span id="16532" class="l"><a href="#16532">16532: </a><span class="php-comment">         */</span>
</span><span id="16533" class="l"><a href="#16533">16533: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> SetBooklet(<span class="php-var">$booklet</span>=<span class="php-keyword1">true</span>, <span class="php-var">$inner</span>=-<span class="php-num">1</span>, <span class="php-var">$outer</span>=-<span class="php-num">1</span>) {
</span><span id="16534" class="l"><a href="#16534">16534: </a>            <span class="php-var">$this</span>-&gt;booklet = <span class="php-var">$booklet</span>;
</span><span id="16535" class="l"><a href="#16535">16535: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$inner</span> &gt;= <span class="php-num">0</span>) {
</span><span id="16536" class="l"><a href="#16536">16536: </a>                <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$inner</span>;
</span><span id="16537" class="l"><a href="#16537">16537: </a>            }
</span><span id="16538" class="l"><a href="#16538">16538: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$outer</span> &gt;= <span class="php-num">0</span>) {
</span><span id="16539" class="l"><a href="#16539">16539: </a>                <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$outer</span>;
</span><span id="16540" class="l"><a href="#16540">16540: </a>            }
</span><span id="16541" class="l"><a href="#16541">16541: </a>        }
</span><span id="16542" class="l"><a href="#16542">16542: </a>
</span><span id="16543" class="l"><a href="#16543">16543: </a>        <span class="php-comment">/**
</span></span><span id="16544" class="l"><a href="#16544">16544: </a><span class="php-comment">         * Swap the left and right margins.
</span></span><span id="16545" class="l"><a href="#16545">16545: </a><span class="php-comment">         * @param boolean $reverse if true swap left and right margins.
</span></span><span id="16546" class="l"><a href="#16546">16546: </a><span class="php-comment">         * @access protected
</span></span><span id="16547" class="l"><a href="#16547">16547: </a><span class="php-comment">         * @since 4.2.000 (2008-10-29)
</span></span><span id="16548" class="l"><a href="#16548">16548: </a><span class="php-comment">         */</span>
</span><span id="16549" class="l"><a href="#16549">16549: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> swapMargins(<span class="php-var">$reverse</span>=<span class="php-keyword1">true</span>) {
</span><span id="16550" class="l"><a href="#16550">16550: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$reverse</span>) {
</span><span id="16551" class="l"><a href="#16551">16551: </a>                <span class="php-comment">// swap left and right margins</span>
</span><span id="16552" class="l"><a href="#16552">16552: </a>                <span class="php-var">$mtemp</span> = <span class="php-var">$this</span>-&gt;original_lMargin;
</span><span id="16553" class="l"><a href="#16553">16553: </a>                <span class="php-var">$this</span>-&gt;original_lMargin = <span class="php-var">$this</span>-&gt;original_rMargin;
</span><span id="16554" class="l"><a href="#16554">16554: </a>                <span class="php-var">$this</span>-&gt;original_rMargin = <span class="php-var">$mtemp</span>;
</span><span id="16555" class="l"><a href="#16555">16555: </a>                <span class="php-var">$deltam</span> = <span class="php-var">$this</span>-&gt;original_lMargin - <span class="php-var">$this</span>-&gt;original_rMargin;
</span><span id="16556" class="l"><a href="#16556">16556: </a>                <span class="php-var">$this</span>-&gt;lMargin += <span class="php-var">$deltam</span>;
</span><span id="16557" class="l"><a href="#16557">16557: </a>                <span class="php-var">$this</span>-&gt;rMargin -= <span class="php-var">$deltam</span>;
</span><span id="16558" class="l"><a href="#16558">16558: </a>            }
</span><span id="16559" class="l"><a href="#16559">16559: </a>        }
</span><span id="16560" class="l"><a href="#16560">16560: </a>
</span><span id="16561" class="l"><a href="#16561">16561: </a>        <span class="php-comment">/**
</span></span><span id="16562" class="l"><a href="#16562">16562: </a><span class="php-comment">         * Set the vertical spaces for HTML tags.
</span></span><span id="16563" class="l"><a href="#16563">16563: </a><span class="php-comment">         * The array must have the following structure (example):
</span></span><span id="16564" class="l"><a href="#16564">16564: </a><span class="php-comment">         * $tagvs = array('h1' =&gt; array(0 =&gt; array('h' =&gt; '', 'n' =&gt; 2), 1 =&gt; array('h' =&gt; 1.3, 'n' =&gt; 1)));
</span></span><span id="16565" class="l"><a href="#16565">16565: </a><span class="php-comment">         * The first array level contains the tag names,
</span></span><span id="16566" class="l"><a href="#16566">16566: </a><span class="php-comment">         * the second level contains 0 for opening tags or 1 for closing tags,
</span></span><span id="16567" class="l"><a href="#16567">16567: </a><span class="php-comment">         * the third level contains the vertical space unit (h) and the number spaces to add (n).
</span></span><span id="16568" class="l"><a href="#16568">16568: </a><span class="php-comment">         * If the h parameter is not specified, default values are used.
</span></span><span id="16569" class="l"><a href="#16569">16569: </a><span class="php-comment">         * @param array $tagvs array of tags and relative vertical spaces.
</span></span><span id="16570" class="l"><a href="#16570">16570: </a><span class="php-comment">         * @access public
</span></span><span id="16571" class="l"><a href="#16571">16571: </a><span class="php-comment">         * @since 4.2.001 (2008-10-30)
</span></span><span id="16572" class="l"><a href="#16572">16572: </a><span class="php-comment">         */</span>
</span><span id="16573" class="l"><a href="#16573">16573: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setHtmlVSpace(<span class="php-var">$tagvs</span>) {
</span><span id="16574" class="l"><a href="#16574">16574: </a>            <span class="php-var">$this</span>-&gt;tagvspaces = <span class="php-var">$tagvs</span>;
</span><span id="16575" class="l"><a href="#16575">16575: </a>        }
</span><span id="16576" class="l"><a href="#16576">16576: </a>
</span><span id="16577" class="l"><a href="#16577">16577: </a>        <span class="php-comment">/**
</span></span><span id="16578" class="l"><a href="#16578">16578: </a><span class="php-comment">         * Set custom width for list indentation.
</span></span><span id="16579" class="l"><a href="#16579">16579: </a><span class="php-comment">         * @param float $width width of the indentation. Use negative value to disable it.
</span></span><span id="16580" class="l"><a href="#16580">16580: </a><span class="php-comment">         * @access public
</span></span><span id="16581" class="l"><a href="#16581">16581: </a><span class="php-comment">         * @since 4.2.007 (2008-11-12)
</span></span><span id="16582" class="l"><a href="#16582">16582: </a><span class="php-comment">         */</span>
</span><span id="16583" class="l"><a href="#16583">16583: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setListIndentWidth(<span class="php-var">$width</span>) {
</span><span id="16584" class="l"><a href="#16584">16584: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;customlistindent = <span class="php-keyword2">floatval</span>(<span class="php-var">$width</span>);
</span><span id="16585" class="l"><a href="#16585">16585: </a>        }
</span><span id="16586" class="l"><a href="#16586">16586: </a>
</span><span id="16587" class="l"><a href="#16587">16587: </a>        <span class="php-comment">/**
</span></span><span id="16588" class="l"><a href="#16588">16588: </a><span class="php-comment">         * Set the top/bottom cell sides to be open or closed when the cell cross the page.
</span></span><span id="16589" class="l"><a href="#16589">16589: </a><span class="php-comment">         * @param boolean $isopen if true keeps the top/bottom border open for the cell sides that cross the page.
</span></span><span id="16590" class="l"><a href="#16590">16590: </a><span class="php-comment">         * @access public
</span></span><span id="16591" class="l"><a href="#16591">16591: </a><span class="php-comment">         * @since 4.2.010 (2008-11-14)
</span></span><span id="16592" class="l"><a href="#16592">16592: </a><span class="php-comment">         */</span>
</span><span id="16593" class="l"><a href="#16593">16593: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setOpenCell(<span class="php-var">$isopen</span>) {
</span><span id="16594" class="l"><a href="#16594">16594: </a>            <span class="php-var">$this</span>-&gt;opencell = <span class="php-var">$isopen</span>;
</span><span id="16595" class="l"><a href="#16595">16595: </a>        }
</span><span id="16596" class="l"><a href="#16596">16596: </a>
</span><span id="16597" class="l"><a href="#16597">16597: </a>        <span class="php-comment">/**
</span></span><span id="16598" class="l"><a href="#16598">16598: </a><span class="php-comment">         * Set the color and font style for HTML links.
</span></span><span id="16599" class="l"><a href="#16599">16599: </a><span class="php-comment">         * @param array $color RGB array of colors
</span></span><span id="16600" class="l"><a href="#16600">16600: </a><span class="php-comment">         * @param string $fontstyle additional font styles to add
</span></span><span id="16601" class="l"><a href="#16601">16601: </a><span class="php-comment">         * @access public
</span></span><span id="16602" class="l"><a href="#16602">16602: </a><span class="php-comment">         * @since 4.4.003 (2008-12-09)
</span></span><span id="16603" class="l"><a href="#16603">16603: </a><span class="php-comment">         */</span>
</span><span id="16604" class="l"><a href="#16604">16604: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setHtmlLinksStyle(<span class="php-var">$color</span>=<span class="php-keyword1">array</span>(<span class="php-num">0</span>,<span class="php-num">0</span>,<span class="php-num">255</span>), <span class="php-var">$fontstyle</span>=<span class="php-quote">'U'</span>) {
</span><span id="16605" class="l"><a href="#16605">16605: </a>            <span class="php-var">$this</span>-&gt;htmlLinkColorArray = <span class="php-var">$color</span>;
</span><span id="16606" class="l"><a href="#16606">16606: </a>            <span class="php-var">$this</span>-&gt;htmlLinkFontStyle = <span class="php-var">$fontstyle</span>;
</span><span id="16607" class="l"><a href="#16607">16607: </a>        }
</span><span id="16608" class="l"><a href="#16608">16608: </a>
</span><span id="16609" class="l"><a href="#16609">16609: </a>        <span class="php-comment">/**
</span></span><span id="16610" class="l"><a href="#16610">16610: </a><span class="php-comment">         * Convert HTML string containing value and unit of measure to user's units or points.
</span></span><span id="16611" class="l"><a href="#16611">16611: </a><span class="php-comment">         * @param string $htmlval string containing values and unit
</span></span><span id="16612" class="l"><a href="#16612">16612: </a><span class="php-comment">         * @param string $refsize reference value in points
</span></span><span id="16613" class="l"><a href="#16613">16613: </a><span class="php-comment">         * @param string $defaultunit default unit (can be one of the following: %, em, ex, px, in, mm, pc, pt).
</span></span><span id="16614" class="l"><a href="#16614">16614: </a><span class="php-comment">         * @param boolean $point if true returns points, otherwise returns value in user's units
</span></span><span id="16615" class="l"><a href="#16615">16615: </a><span class="php-comment">         * @return float value in user's unit or point if $points=true
</span></span><span id="16616" class="l"><a href="#16616">16616: </a><span class="php-comment">         * @access public
</span></span><span id="16617" class="l"><a href="#16617">16617: </a><span class="php-comment">         * @since 4.4.004 (2008-12-10)
</span></span><span id="16618" class="l"><a href="#16618">16618: </a><span class="php-comment">         */</span>
</span><span id="16619" class="l"><a href="#16619">16619: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getHTMLUnitToUnits(<span class="php-var">$htmlval</span>, <span class="php-var">$refsize</span>=<span class="php-num">1</span>, <span class="php-var">$defaultunit</span>=<span class="php-quote">'px'</span>, <span class="php-var">$points</span>=<span class="php-keyword1">false</span>) {
</span><span id="16620" class="l"><a href="#16620">16620: </a>            <span class="php-var">$supportedunits</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'%'</span>, <span class="php-quote">'em'</span>, <span class="php-quote">'ex'</span>, <span class="php-quote">'px'</span>, <span class="php-quote">'in'</span>, <span class="php-quote">'cm'</span>, <span class="php-quote">'mm'</span>, <span class="php-quote">'pc'</span>, <span class="php-quote">'pt'</span>);
</span><span id="16621" class="l"><a href="#16621">16621: </a>            <span class="php-var">$retval</span> = <span class="php-num">0</span>;
</span><span id="16622" class="l"><a href="#16622">16622: </a>            <span class="php-var">$value</span> = <span class="php-num">0</span>;
</span><span id="16623" class="l"><a href="#16623">16623: </a>            <span class="php-var">$unit</span> = <span class="php-quote">'px'</span>;
</span><span id="16624" class="l"><a href="#16624">16624: </a>            <span class="php-var">$k</span> = <span class="php-var">$this</span>-&gt;k;
</span><span id="16625" class="l"><a href="#16625">16625: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$points</span>) {
</span><span id="16626" class="l"><a href="#16626">16626: </a>                <span class="php-var">$k</span> = <span class="php-num">1</span>;
</span><span id="16627" class="l"><a href="#16627">16627: </a>            }
</span><span id="16628" class="l"><a href="#16628">16628: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$defaultunit</span>, <span class="php-var">$supportedunits</span>)) {
</span><span id="16629" class="l"><a href="#16629">16629: </a>                <span class="php-var">$unit</span> = <span class="php-var">$defaultunit</span>;
</span><span id="16630" class="l"><a href="#16630">16630: </a>            }
</span><span id="16631" class="l"><a href="#16631">16631: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_numeric</span>(<span class="php-var">$htmlval</span>)) {
</span><span id="16632" class="l"><a href="#16632">16632: </a>                <span class="php-var">$value</span> = <span class="php-keyword2">floatval</span>(<span class="php-var">$htmlval</span>);
</span><span id="16633" class="l"><a href="#16633">16633: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/([0-9\.\-\+]+)/'</span>, <span class="php-var">$htmlval</span>, <span class="php-var">$mnum</span>)) {
</span><span id="16634" class="l"><a href="#16634">16634: </a>                <span class="php-var">$value</span> = <span class="php-keyword2">floatval</span>(<span class="php-var">$mnum</span>[<span class="php-num">1</span>]);
</span><span id="16635" class="l"><a href="#16635">16635: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/([a-z%]+)/'</span>, <span class="php-var">$htmlval</span>, <span class="php-var">$munit</span>)) {
</span><span id="16636" class="l"><a href="#16636">16636: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$munit</span>[<span class="php-num">1</span>], <span class="php-var">$supportedunits</span>)) {
</span><span id="16637" class="l"><a href="#16637">16637: </a>                        <span class="php-var">$unit</span> = <span class="php-var">$munit</span>[<span class="php-num">1</span>];
</span><span id="16638" class="l"><a href="#16638">16638: </a>                    }
</span><span id="16639" class="l"><a href="#16639">16639: </a>                }
</span><span id="16640" class="l"><a href="#16640">16640: </a>            }
</span><span id="16641" class="l"><a href="#16641">16641: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$unit</span>) {
</span><span id="16642" class="l"><a href="#16642">16642: </a>                <span class="php-comment">// percentage</span>
</span><span id="16643" class="l"><a href="#16643">16643: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'%'</span>: {
</span><span id="16644" class="l"><a href="#16644">16644: </a>                    <span class="php-var">$retval</span> = ((<span class="php-var">$value</span> * <span class="php-var">$refsize</span>) / <span class="php-num">100</span>);
</span><span id="16645" class="l"><a href="#16645">16645: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16646" class="l"><a href="#16646">16646: </a>                }
</span><span id="16647" class="l"><a href="#16647">16647: </a>                <span class="php-comment">// relative-size</span>
</span><span id="16648" class="l"><a href="#16648">16648: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'em'</span>: {
</span><span id="16649" class="l"><a href="#16649">16649: </a>                    <span class="php-var">$retval</span> = (<span class="php-var">$value</span> * <span class="php-var">$refsize</span>);
</span><span id="16650" class="l"><a href="#16650">16650: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16651" class="l"><a href="#16651">16651: </a>                }
</span><span id="16652" class="l"><a href="#16652">16652: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'ex'</span>: {
</span><span id="16653" class="l"><a href="#16653">16653: </a>                    <span class="php-var">$retval</span> = <span class="php-var">$value</span> * (<span class="php-var">$refsize</span> / <span class="php-num">2</span>);
</span><span id="16654" class="l"><a href="#16654">16654: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16655" class="l"><a href="#16655">16655: </a>                }
</span><span id="16656" class="l"><a href="#16656">16656: </a>                <span class="php-comment">// absolute-size</span>
</span><span id="16657" class="l"><a href="#16657">16657: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'in'</span>: {
</span><span id="16658" class="l"><a href="#16658">16658: </a>                    <span class="php-var">$retval</span> = (<span class="php-var">$value</span> * <span class="php-var">$this</span>-&gt;dpi) / <span class="php-var">$k</span>;
</span><span id="16659" class="l"><a href="#16659">16659: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16660" class="l"><a href="#16660">16660: </a>                }
</span><span id="16661" class="l"><a href="#16661">16661: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'cm'</span>: {
</span><span id="16662" class="l"><a href="#16662">16662: </a>                    <span class="php-var">$retval</span> = (<span class="php-var">$value</span> / <span class="php-num">2.54</span> * <span class="php-var">$this</span>-&gt;dpi) / <span class="php-var">$k</span>;
</span><span id="16663" class="l"><a href="#16663">16663: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16664" class="l"><a href="#16664">16664: </a>                }
</span><span id="16665" class="l"><a href="#16665">16665: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'mm'</span>: {
</span><span id="16666" class="l"><a href="#16666">16666: </a>                    <span class="php-var">$retval</span> = (<span class="php-var">$value</span> / <span class="php-num">25.4</span> * <span class="php-var">$this</span>-&gt;dpi) / <span class="php-var">$k</span>;
</span><span id="16667" class="l"><a href="#16667">16667: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16668" class="l"><a href="#16668">16668: </a>                }
</span><span id="16669" class="l"><a href="#16669">16669: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'pc'</span>: {
</span><span id="16670" class="l"><a href="#16670">16670: </a>                    <span class="php-comment">// one pica is 12 points</span>
</span><span id="16671" class="l"><a href="#16671">16671: </a>                    <span class="php-var">$retval</span> = (<span class="php-var">$value</span> * <span class="php-num">12</span>) / <span class="php-var">$k</span>;
</span><span id="16672" class="l"><a href="#16672">16672: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16673" class="l"><a href="#16673">16673: </a>                }
</span><span id="16674" class="l"><a href="#16674">16674: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'pt'</span>: {
</span><span id="16675" class="l"><a href="#16675">16675: </a>                    <span class="php-var">$retval</span> = <span class="php-var">$value</span> / <span class="php-var">$k</span>;
</span><span id="16676" class="l"><a href="#16676">16676: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16677" class="l"><a href="#16677">16677: </a>                }
</span><span id="16678" class="l"><a href="#16678">16678: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'px'</span>: {
</span><span id="16679" class="l"><a href="#16679">16679: </a>                    <span class="php-var">$retval</span> = <span class="php-var">$this</span>-&gt;pixelsToUnits(<span class="php-var">$value</span>);
</span><span id="16680" class="l"><a href="#16680">16680: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16681" class="l"><a href="#16681">16681: </a>                }
</span><span id="16682" class="l"><a href="#16682">16682: </a>            }
</span><span id="16683" class="l"><a href="#16683">16683: </a>            <span class="php-keyword1">return</span> <span class="php-var">$retval</span>;
</span><span id="16684" class="l"><a href="#16684">16684: </a>        }
</span><span id="16685" class="l"><a href="#16685">16685: </a>
</span><span id="16686" class="l"><a href="#16686">16686: </a>        <span class="php-comment">/**
</span></span><span id="16687" class="l"><a href="#16687">16687: </a><span class="php-comment">         * Returns the Roman representation of an integer number
</span></span><span id="16688" class="l"><a href="#16688">16688: </a><span class="php-comment">         * @param int number to convert
</span></span><span id="16689" class="l"><a href="#16689">16689: </a><span class="php-comment">         * @return string roman representation of the specified number
</span></span><span id="16690" class="l"><a href="#16690">16690: </a><span class="php-comment">         * @access public
</span></span><span id="16691" class="l"><a href="#16691">16691: </a><span class="php-comment">         * @since 4.4.004 (2008-12-10)
</span></span><span id="16692" class="l"><a href="#16692">16692: </a><span class="php-comment">         */</span>
</span><span id="16693" class="l"><a href="#16693">16693: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> intToRoman(<span class="php-var">$number</span>) {
</span><span id="16694" class="l"><a href="#16694">16694: </a>            <span class="php-var">$roman</span> = <span class="php-quote">''</span>;
</span><span id="16695" class="l"><a href="#16695">16695: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">1000</span>) {
</span><span id="16696" class="l"><a href="#16696">16696: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'M'</span>;
</span><span id="16697" class="l"><a href="#16697">16697: </a>                <span class="php-var">$number</span> -= <span class="php-num">1000</span>;
</span><span id="16698" class="l"><a href="#16698">16698: </a>            }
</span><span id="16699" class="l"><a href="#16699">16699: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">900</span>) {
</span><span id="16700" class="l"><a href="#16700">16700: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'CM'</span>;
</span><span id="16701" class="l"><a href="#16701">16701: </a>                <span class="php-var">$number</span> -= <span class="php-num">900</span>;
</span><span id="16702" class="l"><a href="#16702">16702: </a>            }
</span><span id="16703" class="l"><a href="#16703">16703: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">500</span>) {
</span><span id="16704" class="l"><a href="#16704">16704: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'D'</span>;
</span><span id="16705" class="l"><a href="#16705">16705: </a>                <span class="php-var">$number</span> -= <span class="php-num">500</span>;
</span><span id="16706" class="l"><a href="#16706">16706: </a>            }
</span><span id="16707" class="l"><a href="#16707">16707: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">400</span>) {
</span><span id="16708" class="l"><a href="#16708">16708: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'CD'</span>;
</span><span id="16709" class="l"><a href="#16709">16709: </a>                <span class="php-var">$number</span> -= <span class="php-num">400</span>;
</span><span id="16710" class="l"><a href="#16710">16710: </a>            }
</span><span id="16711" class="l"><a href="#16711">16711: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">100</span>) {
</span><span id="16712" class="l"><a href="#16712">16712: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'C'</span>;
</span><span id="16713" class="l"><a href="#16713">16713: </a>                <span class="php-var">$number</span> -= <span class="php-num">100</span>;
</span><span id="16714" class="l"><a href="#16714">16714: </a>            }
</span><span id="16715" class="l"><a href="#16715">16715: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">90</span>) {
</span><span id="16716" class="l"><a href="#16716">16716: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'XC'</span>;
</span><span id="16717" class="l"><a href="#16717">16717: </a>                <span class="php-var">$number</span> -= <span class="php-num">90</span>;
</span><span id="16718" class="l"><a href="#16718">16718: </a>            }
</span><span id="16719" class="l"><a href="#16719">16719: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">50</span>) {
</span><span id="16720" class="l"><a href="#16720">16720: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'L'</span>;
</span><span id="16721" class="l"><a href="#16721">16721: </a>                <span class="php-var">$number</span> -= <span class="php-num">50</span>;
</span><span id="16722" class="l"><a href="#16722">16722: </a>            }
</span><span id="16723" class="l"><a href="#16723">16723: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">40</span>) {
</span><span id="16724" class="l"><a href="#16724">16724: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'XL'</span>;
</span><span id="16725" class="l"><a href="#16725">16725: </a>                <span class="php-var">$number</span> -= <span class="php-num">40</span>;
</span><span id="16726" class="l"><a href="#16726">16726: </a>            }
</span><span id="16727" class="l"><a href="#16727">16727: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">10</span>) {
</span><span id="16728" class="l"><a href="#16728">16728: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'X'</span>;
</span><span id="16729" class="l"><a href="#16729">16729: </a>                <span class="php-var">$number</span> -= <span class="php-num">10</span>;
</span><span id="16730" class="l"><a href="#16730">16730: </a>            }
</span><span id="16731" class="l"><a href="#16731">16731: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">9</span>) {
</span><span id="16732" class="l"><a href="#16732">16732: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'IX'</span>;
</span><span id="16733" class="l"><a href="#16733">16733: </a>                <span class="php-var">$number</span> -= <span class="php-num">9</span>;
</span><span id="16734" class="l"><a href="#16734">16734: </a>            }
</span><span id="16735" class="l"><a href="#16735">16735: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">5</span>) {
</span><span id="16736" class="l"><a href="#16736">16736: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'V'</span>;
</span><span id="16737" class="l"><a href="#16737">16737: </a>                <span class="php-var">$number</span> -= <span class="php-num">5</span>;
</span><span id="16738" class="l"><a href="#16738">16738: </a>            }
</span><span id="16739" class="l"><a href="#16739">16739: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">4</span>) {
</span><span id="16740" class="l"><a href="#16740">16740: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'IV'</span>;
</span><span id="16741" class="l"><a href="#16741">16741: </a>                <span class="php-var">$number</span> -= <span class="php-num">4</span>;
</span><span id="16742" class="l"><a href="#16742">16742: </a>            }
</span><span id="16743" class="l"><a href="#16743">16743: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$number</span> &gt;= <span class="php-num">1</span>) {
</span><span id="16744" class="l"><a href="#16744">16744: </a>                <span class="php-var">$roman</span> .= <span class="php-quote">'I'</span>;
</span><span id="16745" class="l"><a href="#16745">16745: </a>                --<span class="php-var">$number</span>;
</span><span id="16746" class="l"><a href="#16746">16746: </a>            }
</span><span id="16747" class="l"><a href="#16747">16747: </a>            <span class="php-keyword1">return</span> <span class="php-var">$roman</span>;
</span><span id="16748" class="l"><a href="#16748">16748: </a>        }
</span><span id="16749" class="l"><a href="#16749">16749: </a>
</span><span id="16750" class="l"><a href="#16750">16750: </a>        <span class="php-comment">/**
</span></span><span id="16751" class="l"><a href="#16751">16751: </a><span class="php-comment">         * Output an HTML list bullet or ordered item symbol
</span></span><span id="16752" class="l"><a href="#16752">16752: </a><span class="php-comment">         * @param int $listdepth list nesting level
</span></span><span id="16753" class="l"><a href="#16753">16753: </a><span class="php-comment">         * @param string $listtype type of list
</span></span><span id="16754" class="l"><a href="#16754">16754: </a><span class="php-comment">         * @param float $size current font size
</span></span><span id="16755" class="l"><a href="#16755">16755: </a><span class="php-comment">         * @access protected
</span></span><span id="16756" class="l"><a href="#16756">16756: </a><span class="php-comment">         * @since 4.4.004 (2008-12-10)
</span></span><span id="16757" class="l"><a href="#16757">16757: </a><span class="php-comment">         */</span>
</span><span id="16758" class="l"><a href="#16758">16758: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> putHtmlListBullet(<span class="php-var">$listdepth</span>, <span class="php-var">$listtype</span>=<span class="php-quote">''</span>, <span class="php-var">$size</span>=<span class="php-num">10</span>) {
</span><span id="16759" class="l"><a href="#16759">16759: </a>            <span class="php-var">$size</span> /= <span class="php-var">$this</span>-&gt;k;
</span><span id="16760" class="l"><a href="#16760">16760: </a>            <span class="php-var">$fill</span> = <span class="php-quote">''</span>;
</span><span id="16761" class="l"><a href="#16761">16761: </a>            <span class="php-var">$color</span> = <span class="php-var">$this</span>-&gt;fgcolor;
</span><span id="16762" class="l"><a href="#16762">16762: </a>            <span class="php-var">$width</span> = <span class="php-num">0</span>;
</span><span id="16763" class="l"><a href="#16763">16763: </a>            <span class="php-var">$textitem</span> = <span class="php-quote">''</span>;
</span><span id="16764" class="l"><a href="#16764">16764: </a>            <span class="php-var">$tmpx</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="16765" class="l"><a href="#16765">16765: </a>            <span class="php-var">$lspace</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-quote">'  '</span>);
</span><span id="16766" class="l"><a href="#16766">16766: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$listtype</span> == <span class="php-quote">'!'</span>) {
</span><span id="16767" class="l"><a href="#16767">16767: </a>                <span class="php-comment">// set default list type for unordered list</span>
</span><span id="16768" class="l"><a href="#16768">16768: </a>                <span class="php-var">$deftypes</span> = <span class="php-keyword1">array</span>(<span class="php-quote">'disc'</span>, <span class="php-quote">'circle'</span>, <span class="php-quote">'square'</span>);
</span><span id="16769" class="l"><a href="#16769">16769: </a>                <span class="php-var">$listtype</span> = <span class="php-var">$deftypes</span>[(<span class="php-var">$listdepth</span> - <span class="php-num">1</span>) % <span class="php-num">3</span>];
</span><span id="16770" class="l"><a href="#16770">16770: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$listtype</span> == <span class="php-quote">'#'</span>) {
</span><span id="16771" class="l"><a href="#16771">16771: </a>                <span class="php-comment">// set default list type for ordered list</span>
</span><span id="16772" class="l"><a href="#16772">16772: </a>                <span class="php-var">$listtype</span> = <span class="php-quote">'decimal'</span>;
</span><span id="16773" class="l"><a href="#16773">16773: </a>            }
</span><span id="16774" class="l"><a href="#16774">16774: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$listtype</span>) {
</span><span id="16775" class="l"><a href="#16775">16775: </a>                <span class="php-comment">// unordered types</span>
</span><span id="16776" class="l"><a href="#16776">16776: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'none'</span>: {
</span><span id="16777" class="l"><a href="#16777">16777: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16778" class="l"><a href="#16778">16778: </a>                }
</span><span id="16779" class="l"><a href="#16779">16779: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'disc'</span>: {
</span><span id="16780" class="l"><a href="#16780">16780: </a>                    <span class="php-var">$fill</span> = <span class="php-quote">'F'</span>;
</span><span id="16781" class="l"><a href="#16781">16781: </a>                }
</span><span id="16782" class="l"><a href="#16782">16782: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'circle'</span>: {
</span><span id="16783" class="l"><a href="#16783">16783: </a>                    <span class="php-var">$fill</span> .= <span class="php-quote">'D'</span>;
</span><span id="16784" class="l"><a href="#16784">16784: </a>                    <span class="php-var">$r</span> = <span class="php-var">$size</span> / <span class="php-num">6</span>;
</span><span id="16785" class="l"><a href="#16785">16785: </a>                    <span class="php-var">$lspace</span> += (<span class="php-num">2</span> * <span class="php-var">$r</span>);
</span><span id="16786" class="l"><a href="#16786">16786: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="16787" class="l"><a href="#16787">16787: </a>                        <span class="php-var">$this</span>-&gt;x += <span class="php-var">$lspace</span>;
</span><span id="16788" class="l"><a href="#16788">16788: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16789" class="l"><a href="#16789">16789: </a>                        <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$lspace</span>;
</span><span id="16790" class="l"><a href="#16790">16790: </a>                    }
</span><span id="16791" class="l"><a href="#16791">16791: </a>                    <span class="php-var">$this</span>-&gt;Circle((<span class="php-var">$this</span>-&gt;x + <span class="php-var">$r</span>), (<span class="php-var">$this</span>-&gt;y + (<span class="php-var">$this</span>-&gt;lasth / <span class="php-num">2</span>)), <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-var">$fill</span>, <span class="php-keyword1">array</span>(<span class="php-quote">'color'</span>=&gt;<span class="php-var">$color</span>), <span class="php-var">$color</span>, <span class="php-num">8</span>);
</span><span id="16792" class="l"><a href="#16792">16792: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16793" class="l"><a href="#16793">16793: </a>                }
</span><span id="16794" class="l"><a href="#16794">16794: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'square'</span>: {
</span><span id="16795" class="l"><a href="#16795">16795: </a>                    <span class="php-var">$l</span> = <span class="php-var">$size</span> / <span class="php-num">3</span>;
</span><span id="16796" class="l"><a href="#16796">16796: </a>                    <span class="php-var">$lspace</span> += <span class="php-var">$l</span>;
</span><span id="16797" class="l"><a href="#16797">16797: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {;
</span><span id="16798" class="l"><a href="#16798">16798: </a>                        <span class="php-var">$this</span>-&gt;x += <span class="php-var">$lspace</span>;
</span><span id="16799" class="l"><a href="#16799">16799: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="16800" class="l"><a href="#16800">16800: </a>                        <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$lspace</span>;
</span><span id="16801" class="l"><a href="#16801">16801: </a>                    }
</span><span id="16802" class="l"><a href="#16802">16802: </a>                    <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$this</span>-&gt;x, (<span class="php-var">$this</span>-&gt;y + ((<span class="php-var">$this</span>-&gt;lasth - <span class="php-var">$l</span>)/ <span class="php-num">2</span>)), <span class="php-var">$l</span>, <span class="php-var">$l</span>, <span class="php-quote">'F'</span>, <span class="php-keyword1">array</span>(), <span class="php-var">$color</span>);
</span><span id="16803" class="l"><a href="#16803">16803: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16804" class="l"><a href="#16804">16804: </a>                }
</span><span id="16805" class="l"><a href="#16805">16805: </a>                <span class="php-comment">// ordered types</span>
</span><span id="16806" class="l"><a href="#16806">16806: </a>                <span class="php-comment">// $this-&gt;listcount[$this-&gt;listnum];</span>
</span><span id="16807" class="l"><a href="#16807">16807: </a>                <span class="php-comment">// $textitem</span>
</span><span id="16808" class="l"><a href="#16808">16808: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'1'</span>:
</span><span id="16809" class="l"><a href="#16809">16809: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'decimal'</span>: {
</span><span id="16810" class="l"><a href="#16810">16810: </a>                    <span class="php-var">$textitem</span> = <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum];
</span><span id="16811" class="l"><a href="#16811">16811: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16812" class="l"><a href="#16812">16812: </a>                }
</span><span id="16813" class="l"><a href="#16813">16813: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'decimal-leading-zero'</span>: {
</span><span id="16814" class="l"><a href="#16814">16814: </a>                    <span class="php-var">$textitem</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">'%02d'</span>, <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum]);
</span><span id="16815" class="l"><a href="#16815">16815: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16816" class="l"><a href="#16816">16816: </a>                }
</span><span id="16817" class="l"><a href="#16817">16817: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'i'</span>:
</span><span id="16818" class="l"><a href="#16818">16818: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-roman'</span>: {
</span><span id="16819" class="l"><a href="#16819">16819: </a>                    <span class="php-var">$textitem</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$this</span>-&gt;intToRoman(<span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum]));
</span><span id="16820" class="l"><a href="#16820">16820: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16821" class="l"><a href="#16821">16821: </a>                }
</span><span id="16822" class="l"><a href="#16822">16822: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'I'</span>:
</span><span id="16823" class="l"><a href="#16823">16823: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'upper-roman'</span>: {
</span><span id="16824" class="l"><a href="#16824">16824: </a>                    <span class="php-var">$textitem</span> = <span class="php-var">$this</span>-&gt;intToRoman(<span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum]);
</span><span id="16825" class="l"><a href="#16825">16825: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16826" class="l"><a href="#16826">16826: </a>                }
</span><span id="16827" class="l"><a href="#16827">16827: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'a'</span>:
</span><span id="16828" class="l"><a href="#16828">16828: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-alpha'</span>:
</span><span id="16829" class="l"><a href="#16829">16829: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-latin'</span>: {
</span><span id="16830" class="l"><a href="#16830">16830: </a>                    <span class="php-var">$textitem</span> = <span class="php-keyword2">chr</span>(<span class="php-num">97</span> + <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum] - <span class="php-num">1</span>);
</span><span id="16831" class="l"><a href="#16831">16831: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16832" class="l"><a href="#16832">16832: </a>                }
</span><span id="16833" class="l"><a href="#16833">16833: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'A'</span>:
</span><span id="16834" class="l"><a href="#16834">16834: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'upper-alpha'</span>:
</span><span id="16835" class="l"><a href="#16835">16835: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'upper-latin'</span>: {
</span><span id="16836" class="l"><a href="#16836">16836: </a>                    <span class="php-var">$textitem</span> = <span class="php-keyword2">chr</span>(<span class="php-num">65</span> + <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum] - <span class="php-num">1</span>);
</span><span id="16837" class="l"><a href="#16837">16837: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16838" class="l"><a href="#16838">16838: </a>                }
</span><span id="16839" class="l"><a href="#16839">16839: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'lower-greek'</span>: {
</span><span id="16840" class="l"><a href="#16840">16840: </a>                    <span class="php-var">$textitem</span> = <span class="php-var">$this</span>-&gt;unichr(<span class="php-num">945</span> + <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum] - <span class="php-num">1</span>);
</span><span id="16841" class="l"><a href="#16841">16841: </a>                    <span class="php-keyword1">break</span>;
</span><span id="16842" class="l"><a href="#16842">16842: </a>                }
</span><span id="16843" class="l"><a href="#16843">16843: </a>                <span class="php-comment">/*
</span></span><span id="16844" class="l"><a href="#16844">16844: </a><span class="php-comment">                // Types to be implemented (special handling)
</span></span><span id="16845" class="l"><a href="#16845">16845: </a><span class="php-comment">                case 'hebrew': {
</span></span><span id="16846" class="l"><a href="#16846">16846: </a><span class="php-comment">                    break;
</span></span><span id="16847" class="l"><a href="#16847">16847: </a><span class="php-comment">                }
</span></span><span id="16848" class="l"><a href="#16848">16848: </a><span class="php-comment">                case 'armenian': {
</span></span><span id="16849" class="l"><a href="#16849">16849: </a><span class="php-comment">                    break;
</span></span><span id="16850" class="l"><a href="#16850">16850: </a><span class="php-comment">                }
</span></span><span id="16851" class="l"><a href="#16851">16851: </a><span class="php-comment">                case 'georgian': {
</span></span><span id="16852" class="l"><a href="#16852">16852: </a><span class="php-comment">                    break;
</span></span><span id="16853" class="l"><a href="#16853">16853: </a><span class="php-comment">                }
</span></span><span id="16854" class="l"><a href="#16854">16854: </a><span class="php-comment">                case 'cjk-ideographic': {
</span></span><span id="16855" class="l"><a href="#16855">16855: </a><span class="php-comment">                    break;
</span></span><span id="16856" class="l"><a href="#16856">16856: </a><span class="php-comment">                }
</span></span><span id="16857" class="l"><a href="#16857">16857: </a><span class="php-comment">                case 'hiragana': {
</span></span><span id="16858" class="l"><a href="#16858">16858: </a><span class="php-comment">                    break;
</span></span><span id="16859" class="l"><a href="#16859">16859: </a><span class="php-comment">                }
</span></span><span id="16860" class="l"><a href="#16860">16860: </a><span class="php-comment">                case 'katakana': {
</span></span><span id="16861" class="l"><a href="#16861">16861: </a><span class="php-comment">                    break;
</span></span><span id="16862" class="l"><a href="#16862">16862: </a><span class="php-comment">                }
</span></span><span id="16863" class="l"><a href="#16863">16863: </a><span class="php-comment">                case 'hiragana-iroha': {
</span></span><span id="16864" class="l"><a href="#16864">16864: </a><span class="php-comment">                    break;
</span></span><span id="16865" class="l"><a href="#16865">16865: </a><span class="php-comment">                }
</span></span><span id="16866" class="l"><a href="#16866">16866: </a><span class="php-comment">                case 'katakana-iroha': {
</span></span><span id="16867" class="l"><a href="#16867">16867: </a><span class="php-comment">                    break;
</span></span><span id="16868" class="l"><a href="#16868">16868: </a><span class="php-comment">                }
</span></span><span id="16869" class="l"><a href="#16869">16869: </a><span class="php-comment">                */</span>
</span><span id="16870" class="l"><a href="#16870">16870: </a>                <span class="php-keyword1">default</span>: {
</span><span id="16871" class="l"><a href="#16871">16871: </a>                    <span class="php-var">$textitem</span> = <span class="php-var">$this</span>-&gt;listcount[<span class="php-var">$this</span>-&gt;listnum];
</span><span id="16872" class="l"><a href="#16872">16872: </a>                }
</span><span id="16873" class="l"><a href="#16873">16873: </a>            }
</span><span id="16874" class="l"><a href="#16874">16874: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$textitem</span>)) {
</span><span id="16875" class="l"><a href="#16875">16875: </a>                <span class="php-comment">// print ordered item</span>
</span><span id="16876" class="l"><a href="#16876">16876: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="16877" class="l"><a href="#16877">16877: </a>                    <span class="php-var">$textitem</span> = <span class="php-quote">'.'</span>.<span class="php-var">$textitem</span>;
</span><span id="16878" class="l"><a href="#16878">16878: </a>                } <span class="php-keyword1">else</span> {
</span><span id="16879" class="l"><a href="#16879">16879: </a>                    <span class="php-var">$textitem</span> = <span class="php-var">$textitem</span>.<span class="php-quote">'.'</span>;
</span><span id="16880" class="l"><a href="#16880">16880: </a>                }
</span><span id="16881" class="l"><a href="#16881">16881: </a>                <span class="php-var">$lspace</span> += <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$textitem</span>);
</span><span id="16882" class="l"><a href="#16882">16882: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="16883" class="l"><a href="#16883">16883: </a>                    <span class="php-var">$this</span>-&gt;x += <span class="php-var">$lspace</span>;
</span><span id="16884" class="l"><a href="#16884">16884: </a>                } <span class="php-keyword1">else</span> {
</span><span id="16885" class="l"><a href="#16885">16885: </a>                    <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$lspace</span>;
</span><span id="16886" class="l"><a href="#16886">16886: </a>                }
</span><span id="16887" class="l"><a href="#16887">16887: </a>                <span class="php-var">$this</span>-&gt;Write(<span class="php-var">$this</span>-&gt;lasth, <span class="php-var">$textitem</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-quote">''</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>);
</span><span id="16888" class="l"><a href="#16888">16888: </a>            }
</span><span id="16889" class="l"><a href="#16889">16889: </a>            <span class="php-var">$this</span>-&gt;x = <span class="php-var">$tmpx</span>;
</span><span id="16890" class="l"><a href="#16890">16890: </a>            <span class="php-var">$this</span>-&gt;lispacer = <span class="php-quote">''</span>;
</span><span id="16891" class="l"><a href="#16891">16891: </a>        }
</span><span id="16892" class="l"><a href="#16892">16892: </a>
</span><span id="16893" class="l"><a href="#16893">16893: </a>        <span class="php-comment">/**
</span></span><span id="16894" class="l"><a href="#16894">16894: </a><span class="php-comment">         * Returns current graphic variables as array.
</span></span><span id="16895" class="l"><a href="#16895">16895: </a><span class="php-comment">         * @return array graphic variables
</span></span><span id="16896" class="l"><a href="#16896">16896: </a><span class="php-comment">         * @access protected
</span></span><span id="16897" class="l"><a href="#16897">16897: </a><span class="php-comment">         * @since 4.2.010 (2008-11-14)
</span></span><span id="16898" class="l"><a href="#16898">16898: </a><span class="php-comment">         */</span>
</span><span id="16899" class="l"><a href="#16899">16899: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getGraphicVars() {
</span><span id="16900" class="l"><a href="#16900">16900: </a>            <span class="php-var">$grapvars</span> = <span class="php-keyword1">array</span>(
</span><span id="16901" class="l"><a href="#16901">16901: </a>                <span class="php-quote">'FontFamily'</span> =&gt; <span class="php-var">$this</span>-&gt;FontFamily,
</span><span id="16902" class="l"><a href="#16902">16902: </a>                <span class="php-quote">'FontStyle'</span> =&gt; <span class="php-var">$this</span>-&gt;FontStyle,
</span><span id="16903" class="l"><a href="#16903">16903: </a>                <span class="php-quote">'FontSizePt'</span> =&gt; <span class="php-var">$this</span>-&gt;FontSizePt,
</span><span id="16904" class="l"><a href="#16904">16904: </a>                <span class="php-quote">'rMargin'</span> =&gt; <span class="php-var">$this</span>-&gt;rMargin,
</span><span id="16905" class="l"><a href="#16905">16905: </a>                <span class="php-quote">'lMargin'</span> =&gt; <span class="php-var">$this</span>-&gt;lMargin,
</span><span id="16906" class="l"><a href="#16906">16906: </a>                <span class="php-quote">'cMargin'</span> =&gt; <span class="php-var">$this</span>-&gt;cMargin,
</span><span id="16907" class="l"><a href="#16907">16907: </a>                <span class="php-quote">'LineWidth'</span> =&gt; <span class="php-var">$this</span>-&gt;LineWidth,
</span><span id="16908" class="l"><a href="#16908">16908: </a>                <span class="php-quote">'linestyleWidth'</span> =&gt; <span class="php-var">$this</span>-&gt;linestyleWidth,
</span><span id="16909" class="l"><a href="#16909">16909: </a>                <span class="php-quote">'linestyleCap'</span> =&gt; <span class="php-var">$this</span>-&gt;linestyleCap,
</span><span id="16910" class="l"><a href="#16910">16910: </a>                <span class="php-quote">'linestyleJoin'</span> =&gt; <span class="php-var">$this</span>-&gt;linestyleJoin,
</span><span id="16911" class="l"><a href="#16911">16911: </a>                <span class="php-quote">'linestyleDash'</span> =&gt; <span class="php-var">$this</span>-&gt;linestyleDash,
</span><span id="16912" class="l"><a href="#16912">16912: </a>                <span class="php-quote">'textrendermode'</span> =&gt; <span class="php-var">$this</span>-&gt;textrendermode,
</span><span id="16913" class="l"><a href="#16913">16913: </a>                <span class="php-quote">'textstrokewidth'</span> =&gt; <span class="php-var">$this</span>-&gt;textstrokewidth,
</span><span id="16914" class="l"><a href="#16914">16914: </a>                <span class="php-quote">'DrawColor'</span> =&gt; <span class="php-var">$this</span>-&gt;DrawColor,
</span><span id="16915" class="l"><a href="#16915">16915: </a>                <span class="php-quote">'FillColor'</span> =&gt; <span class="php-var">$this</span>-&gt;FillColor,
</span><span id="16916" class="l"><a href="#16916">16916: </a>                <span class="php-quote">'TextColor'</span> =&gt; <span class="php-var">$this</span>-&gt;TextColor,
</span><span id="16917" class="l"><a href="#16917">16917: </a>                <span class="php-quote">'ColorFlag'</span> =&gt; <span class="php-var">$this</span>-&gt;ColorFlag,
</span><span id="16918" class="l"><a href="#16918">16918: </a>                <span class="php-quote">'bgcolor'</span> =&gt; <span class="php-var">$this</span>-&gt;bgcolor,
</span><span id="16919" class="l"><a href="#16919">16919: </a>                <span class="php-quote">'fgcolor'</span> =&gt; <span class="php-var">$this</span>-&gt;fgcolor,
</span><span id="16920" class="l"><a href="#16920">16920: </a>                <span class="php-quote">'htmlvspace'</span> =&gt; <span class="php-var">$this</span>-&gt;htmlvspace,
</span><span id="16921" class="l"><a href="#16921">16921: </a>                <span class="php-quote">'lasth'</span> =&gt; <span class="php-var">$this</span>-&gt;lasth
</span><span id="16922" class="l"><a href="#16922">16922: </a>                );
</span><span id="16923" class="l"><a href="#16923">16923: </a>            <span class="php-keyword1">return</span> <span class="php-var">$grapvars</span>;
</span><span id="16924" class="l"><a href="#16924">16924: </a>        }
</span><span id="16925" class="l"><a href="#16925">16925: </a>
</span><span id="16926" class="l"><a href="#16926">16926: </a>        <span class="php-comment">/**
</span></span><span id="16927" class="l"><a href="#16927">16927: </a><span class="php-comment">         * Set graphic variables.
</span></span><span id="16928" class="l"><a href="#16928">16928: </a><span class="php-comment">         * @param $gvars array graphic variables
</span></span><span id="16929" class="l"><a href="#16929">16929: </a><span class="php-comment">         * @access protected
</span></span><span id="16930" class="l"><a href="#16930">16930: </a><span class="php-comment">         * @since 4.2.010 (2008-11-14)
</span></span><span id="16931" class="l"><a href="#16931">16931: </a><span class="php-comment">         */</span>
</span><span id="16932" class="l"><a href="#16932">16932: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setGraphicVars(<span class="php-var">$gvars</span>) {
</span><span id="16933" class="l"><a href="#16933">16933: </a>            <span class="php-var">$this</span>-&gt;FontFamily = <span class="php-var">$gvars</span>[<span class="php-quote">'FontFamily'</span>];
</span><span id="16934" class="l"><a href="#16934">16934: </a>            <span class="php-var">$this</span>-&gt;FontStyle = <span class="php-var">$gvars</span>[<span class="php-quote">'FontStyle'</span>];
</span><span id="16935" class="l"><a href="#16935">16935: </a>            <span class="php-var">$this</span>-&gt;FontSizePt = <span class="php-var">$gvars</span>[<span class="php-quote">'FontSizePt'</span>];
</span><span id="16936" class="l"><a href="#16936">16936: </a>            <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$gvars</span>[<span class="php-quote">'rMargin'</span>];
</span><span id="16937" class="l"><a href="#16937">16937: </a>            <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$gvars</span>[<span class="php-quote">'lMargin'</span>];
</span><span id="16938" class="l"><a href="#16938">16938: </a>            <span class="php-var">$this</span>-&gt;cMargin = <span class="php-var">$gvars</span>[<span class="php-quote">'cMargin'</span>];
</span><span id="16939" class="l"><a href="#16939">16939: </a>            <span class="php-var">$this</span>-&gt;LineWidth = <span class="php-var">$gvars</span>[<span class="php-quote">'LineWidth'</span>];
</span><span id="16940" class="l"><a href="#16940">16940: </a>            <span class="php-var">$this</span>-&gt;linestyleWidth = <span class="php-var">$gvars</span>[<span class="php-quote">'linestyleWidth'</span>];
</span><span id="16941" class="l"><a href="#16941">16941: </a>            <span class="php-var">$this</span>-&gt;linestyleCap = <span class="php-var">$gvars</span>[<span class="php-quote">'linestyleCap'</span>];
</span><span id="16942" class="l"><a href="#16942">16942: </a>            <span class="php-var">$this</span>-&gt;linestyleJoin = <span class="php-var">$gvars</span>[<span class="php-quote">'linestyleJoin'</span>];
</span><span id="16943" class="l"><a href="#16943">16943: </a>            <span class="php-var">$this</span>-&gt;linestyleDash = <span class="php-var">$gvars</span>[<span class="php-quote">'linestyleDash'</span>];
</span><span id="16944" class="l"><a href="#16944">16944: </a>            <span class="php-var">$this</span>-&gt;textrendermode = <span class="php-var">$gvars</span>[<span class="php-quote">'textrendermode'</span>];
</span><span id="16945" class="l"><a href="#16945">16945: </a>            <span class="php-var">$this</span>-&gt;textstrokewidth = <span class="php-var">$gvars</span>[<span class="php-quote">'textstrokewidth'</span>];
</span><span id="16946" class="l"><a href="#16946">16946: </a>            <span class="php-var">$this</span>-&gt;DrawColor = <span class="php-var">$gvars</span>[<span class="php-quote">'DrawColor'</span>];
</span><span id="16947" class="l"><a href="#16947">16947: </a>            <span class="php-var">$this</span>-&gt;FillColor = <span class="php-var">$gvars</span>[<span class="php-quote">'FillColor'</span>];
</span><span id="16948" class="l"><a href="#16948">16948: </a>            <span class="php-var">$this</span>-&gt;TextColor = <span class="php-var">$gvars</span>[<span class="php-quote">'TextColor'</span>];
</span><span id="16949" class="l"><a href="#16949">16949: </a>            <span class="php-var">$this</span>-&gt;ColorFlag = <span class="php-var">$gvars</span>[<span class="php-quote">'ColorFlag'</span>];
</span><span id="16950" class="l"><a href="#16950">16950: </a>            <span class="php-var">$this</span>-&gt;bgcolor = <span class="php-var">$gvars</span>[<span class="php-quote">'bgcolor'</span>];
</span><span id="16951" class="l"><a href="#16951">16951: </a>            <span class="php-var">$this</span>-&gt;fgcolor = <span class="php-var">$gvars</span>[<span class="php-quote">'fgcolor'</span>];
</span><span id="16952" class="l"><a href="#16952">16952: </a>            <span class="php-var">$this</span>-&gt;htmlvspace = <span class="php-var">$gvars</span>[<span class="php-quote">'htmlvspace'</span>];
</span><span id="16953" class="l"><a href="#16953">16953: </a>            <span class="php-comment">//$this-&gt;lasth = $gvars['lasth'];</span>
</span><span id="16954" class="l"><a href="#16954">16954: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">''</span>.<span class="php-var">$this</span>-&gt;linestyleWidth.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;linestyleCap.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;linestyleJoin.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;linestyleDash.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;DrawColor.<span class="php-quote">' '</span>.<span class="php-var">$this</span>-&gt;FillColor.<span class="php-quote">''</span>);
</span><span id="16955" class="l"><a href="#16955">16955: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;FontFamily)) {
</span><span id="16956" class="l"><a href="#16956">16956: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$this</span>-&gt;FontFamily, <span class="php-var">$this</span>-&gt;FontStyle, <span class="php-var">$this</span>-&gt;FontSizePt);
</span><span id="16957" class="l"><a href="#16957">16957: </a>            }
</span><span id="16958" class="l"><a href="#16958">16958: </a>        }
</span><span id="16959" class="l"><a href="#16959">16959: </a>
</span><span id="16960" class="l"><a href="#16960">16960: </a>        <span class="php-comment">/**
</span></span><span id="16961" class="l"><a href="#16961">16961: </a><span class="php-comment">         * Returns a temporary filename for caching object on filesystem.
</span></span><span id="16962" class="l"><a href="#16962">16962: </a><span class="php-comment">         * @param string $prefix prefix to add to filename
</span></span><span id="16963" class="l"><a href="#16963">16963: </a><span class="php-comment">         * return string filename.
</span></span><span id="16964" class="l"><a href="#16964">16964: </a><span class="php-comment">         * @access protected
</span></span><span id="16965" class="l"><a href="#16965">16965: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="16966" class="l"><a href="#16966">16966: </a><span class="php-comment">         */</span>
</span><span id="16967" class="l"><a href="#16967">16967: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getObjFilename(<span class="php-var">$name</span>) {
</span><span id="16968" class="l"><a href="#16968">16968: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">tempnam</span>(K_PATH_CACHE, <span class="php-var">$name</span>.<span class="php-quote">'_'</span>);
</span><span id="16969" class="l"><a href="#16969">16969: </a>        }
</span><span id="16970" class="l"><a href="#16970">16970: </a>
</span><span id="16971" class="l"><a href="#16971">16971: </a>        <span class="php-comment">/**
</span></span><span id="16972" class="l"><a href="#16972">16972: </a><span class="php-comment">         * Writes data to a temporary file on filesystem.
</span></span><span id="16973" class="l"><a href="#16973">16973: </a><span class="php-comment">         * @param string $file file name
</span></span><span id="16974" class="l"><a href="#16974">16974: </a><span class="php-comment">         * @param mixed $data data to write on file
</span></span><span id="16975" class="l"><a href="#16975">16975: </a><span class="php-comment">         * @param boolean $append if true append data, false replace.
</span></span><span id="16976" class="l"><a href="#16976">16976: </a><span class="php-comment">         * @access protected
</span></span><span id="16977" class="l"><a href="#16977">16977: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="16978" class="l"><a href="#16978">16978: </a><span class="php-comment">         */</span>
</span><span id="16979" class="l"><a href="#16979">16979: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> writeDiskCache(<span class="php-var">$filename</span>, <span class="php-var">$data</span>, <span class="php-var">$append</span>=<span class="php-keyword1">false</span>) {
</span><span id="16980" class="l"><a href="#16980">16980: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$append</span>) {
</span><span id="16981" class="l"><a href="#16981">16981: </a>                <span class="php-var">$fmode</span> = <span class="php-quote">'ab+'</span>;
</span><span id="16982" class="l"><a href="#16982">16982: </a>            } <span class="php-keyword1">else</span> {
</span><span id="16983" class="l"><a href="#16983">16983: </a>                <span class="php-var">$fmode</span> = <span class="php-quote">'wb+'</span>;
</span><span id="16984" class="l"><a href="#16984">16984: </a>            }
</span><span id="16985" class="l"><a href="#16985">16985: </a>            <span class="php-var">$f</span> = @<span class="php-keyword2">fopen</span>(<span class="php-var">$filename</span>, <span class="php-var">$fmode</span>);
</span><span id="16986" class="l"><a href="#16986">16986: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$f</span>) {
</span><span id="16987" class="l"><a href="#16987">16987: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'Unable to write cache file: '</span>.<span class="php-var">$filename</span>);
</span><span id="16988" class="l"><a href="#16988">16988: </a>            } <span class="php-keyword1">else</span> {
</span><span id="16989" class="l"><a href="#16989">16989: </a>                <span class="php-keyword2">fwrite</span>(<span class="php-var">$f</span>, <span class="php-var">$data</span>);
</span><span id="16990" class="l"><a href="#16990">16990: </a>                <span class="php-keyword2">fclose</span>(<span class="php-var">$f</span>);
</span><span id="16991" class="l"><a href="#16991">16991: </a>            }
</span><span id="16992" class="l"><a href="#16992">16992: </a>            <span class="php-comment">// update file length (needed for transactions)</span>
</span><span id="16993" class="l"><a href="#16993">16993: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;cache_file_length[<span class="php-quote">'_'</span>.<span class="php-var">$filename</span>])) {
</span><span id="16994" class="l"><a href="#16994">16994: </a>                <span class="php-var">$this</span>-&gt;cache_file_length[<span class="php-quote">'_'</span>.<span class="php-var">$filename</span>] = <span class="php-keyword2">strlen</span>(<span class="php-var">$data</span>);
</span><span id="16995" class="l"><a href="#16995">16995: </a>            } <span class="php-keyword1">else</span> {
</span><span id="16996" class="l"><a href="#16996">16996: </a>                <span class="php-var">$this</span>-&gt;cache_file_length[<span class="php-quote">'_'</span>.<span class="php-var">$filename</span>] += <span class="php-keyword2">strlen</span>(<span class="php-var">$data</span>);
</span><span id="16997" class="l"><a href="#16997">16997: </a>            }
</span><span id="16998" class="l"><a href="#16998">16998: </a>        }
</span><span id="16999" class="l"><a href="#16999">16999: </a>
</span><span id="17000" class="l"><a href="#17000">17000: </a>        <span class="php-comment">/**
</span></span><span id="17001" class="l"><a href="#17001">17001: </a><span class="php-comment">         * Read data from a temporary file on filesystem.
</span></span><span id="17002" class="l"><a href="#17002">17002: </a><span class="php-comment">         * @param string $file file name
</span></span><span id="17003" class="l"><a href="#17003">17003: </a><span class="php-comment">         * @return mixed retrieved data
</span></span><span id="17004" class="l"><a href="#17004">17004: </a><span class="php-comment">         * @access protected
</span></span><span id="17005" class="l"><a href="#17005">17005: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="17006" class="l"><a href="#17006">17006: </a><span class="php-comment">         */</span>
</span><span id="17007" class="l"><a href="#17007">17007: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> readDiskCache(<span class="php-var">$filename</span>) {
</span><span id="17008" class="l"><a href="#17008">17008: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$filename</span>);
</span><span id="17009" class="l"><a href="#17009">17009: </a>        }
</span><span id="17010" class="l"><a href="#17010">17010: </a>
</span><span id="17011" class="l"><a href="#17011">17011: </a>        <span class="php-comment">/**
</span></span><span id="17012" class="l"><a href="#17012">17012: </a><span class="php-comment">         * Set buffer content (always append data).
</span></span><span id="17013" class="l"><a href="#17013">17013: </a><span class="php-comment">         * @param string $data data
</span></span><span id="17014" class="l"><a href="#17014">17014: </a><span class="php-comment">         * @access protected
</span></span><span id="17015" class="l"><a href="#17015">17015: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="17016" class="l"><a href="#17016">17016: </a><span class="php-comment">         */</span>
</span><span id="17017" class="l"><a href="#17017">17017: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setBuffer(<span class="php-var">$data</span>) {
</span><span id="17018" class="l"><a href="#17018">17018: </a>            <span class="php-var">$this</span>-&gt;bufferlen += <span class="php-keyword2">strlen</span>(<span class="php-var">$data</span>);
</span><span id="17019" class="l"><a href="#17019">17019: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17020" class="l"><a href="#17020">17020: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;buffer) <span class="php-keyword1">OR</span> <span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;buffer)) {
</span><span id="17021" class="l"><a href="#17021">17021: </a>                    <span class="php-var">$this</span>-&gt;buffer = <span class="php-var">$this</span>-&gt;getObjFilename(<span class="php-quote">'buffer'</span>);
</span><span id="17022" class="l"><a href="#17022">17022: </a>                }
</span><span id="17023" class="l"><a href="#17023">17023: </a>                <span class="php-var">$this</span>-&gt;writeDiskCache(<span class="php-var">$this</span>-&gt;buffer, <span class="php-var">$data</span>, <span class="php-keyword1">true</span>);
</span><span id="17024" class="l"><a href="#17024">17024: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17025" class="l"><a href="#17025">17025: </a>                <span class="php-var">$this</span>-&gt;buffer .= <span class="php-var">$data</span>;
</span><span id="17026" class="l"><a href="#17026">17026: </a>            }
</span><span id="17027" class="l"><a href="#17027">17027: </a>        }
</span><span id="17028" class="l"><a href="#17028">17028: </a>
</span><span id="17029" class="l"><a href="#17029">17029: </a>        <span class="php-comment">/**
</span></span><span id="17030" class="l"><a href="#17030">17030: </a><span class="php-comment">         * Get buffer content.
</span></span><span id="17031" class="l"><a href="#17031">17031: </a><span class="php-comment">         * @return string buffer content
</span></span><span id="17032" class="l"><a href="#17032">17032: </a><span class="php-comment">         * @access protected
</span></span><span id="17033" class="l"><a href="#17033">17033: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="17034" class="l"><a href="#17034">17034: </a><span class="php-comment">         */</span>
</span><span id="17035" class="l"><a href="#17035">17035: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getBuffer() {
</span><span id="17036" class="l"><a href="#17036">17036: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17037" class="l"><a href="#17037">17037: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;readDiskCache(<span class="php-var">$this</span>-&gt;buffer);
</span><span id="17038" class="l"><a href="#17038">17038: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17039" class="l"><a href="#17039">17039: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;buffer;
</span><span id="17040" class="l"><a href="#17040">17040: </a>            }
</span><span id="17041" class="l"><a href="#17041">17041: </a>        }
</span><span id="17042" class="l"><a href="#17042">17042: </a>
</span><span id="17043" class="l"><a href="#17043">17043: </a>        <span class="php-comment">/**
</span></span><span id="17044" class="l"><a href="#17044">17044: </a><span class="php-comment">         * Set page buffer content.
</span></span><span id="17045" class="l"><a href="#17045">17045: </a><span class="php-comment">         * @param int $page page number
</span></span><span id="17046" class="l"><a href="#17046">17046: </a><span class="php-comment">         * @param string $data page data
</span></span><span id="17047" class="l"><a href="#17047">17047: </a><span class="php-comment">         * @param boolean $append if true append data, false replace.
</span></span><span id="17048" class="l"><a href="#17048">17048: </a><span class="php-comment">         * @access protected
</span></span><span id="17049" class="l"><a href="#17049">17049: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="17050" class="l"><a href="#17050">17050: </a><span class="php-comment">         */</span>
</span><span id="17051" class="l"><a href="#17051">17051: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setPageBuffer(<span class="php-var">$page</span>, <span class="php-var">$data</span>, <span class="php-var">$append</span>=<span class="php-keyword1">false</span>) {
</span><span id="17052" class="l"><a href="#17052">17052: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17053" class="l"><a href="#17053">17053: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>])) {
</span><span id="17054" class="l"><a href="#17054">17054: </a>                    <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>] = <span class="php-var">$this</span>-&gt;getObjFilename(<span class="php-quote">'page'</span>.<span class="php-var">$page</span>);
</span><span id="17055" class="l"><a href="#17055">17055: </a>                }
</span><span id="17056" class="l"><a href="#17056">17056: </a>                <span class="php-var">$this</span>-&gt;writeDiskCache(<span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>], <span class="php-var">$data</span>, <span class="php-var">$append</span>);
</span><span id="17057" class="l"><a href="#17057">17057: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17058" class="l"><a href="#17058">17058: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$append</span>) {
</span><span id="17059" class="l"><a href="#17059">17059: </a>                    <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>] .= <span class="php-var">$data</span>;
</span><span id="17060" class="l"><a href="#17060">17060: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17061" class="l"><a href="#17061">17061: </a>                    <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>] = <span class="php-var">$data</span>;
</span><span id="17062" class="l"><a href="#17062">17062: </a>                }
</span><span id="17063" class="l"><a href="#17063">17063: </a>            }
</span><span id="17064" class="l"><a href="#17064">17064: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$append</span> <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$page</span>])) {
</span><span id="17065" class="l"><a href="#17065">17065: </a>                <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$page</span>] += <span class="php-keyword2">strlen</span>(<span class="php-var">$data</span>);
</span><span id="17066" class="l"><a href="#17066">17066: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17067" class="l"><a href="#17067">17067: </a>                <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$page</span>] = <span class="php-keyword2">strlen</span>(<span class="php-var">$data</span>);
</span><span id="17068" class="l"><a href="#17068">17068: </a>            }
</span><span id="17069" class="l"><a href="#17069">17069: </a>        }
</span><span id="17070" class="l"><a href="#17070">17070: </a>
</span><span id="17071" class="l"><a href="#17071">17071: </a>        <span class="php-comment">/**
</span></span><span id="17072" class="l"><a href="#17072">17072: </a><span class="php-comment">         * Get page buffer content.
</span></span><span id="17073" class="l"><a href="#17073">17073: </a><span class="php-comment">         * @param int $page page number
</span></span><span id="17074" class="l"><a href="#17074">17074: </a><span class="php-comment">         * @return string page buffer content or false in case of error
</span></span><span id="17075" class="l"><a href="#17075">17075: </a><span class="php-comment">         * @access protected
</span></span><span id="17076" class="l"><a href="#17076">17076: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="17077" class="l"><a href="#17077">17077: </a><span class="php-comment">         */</span>
</span><span id="17078" class="l"><a href="#17078">17078: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getPageBuffer(<span class="php-var">$page</span>) {
</span><span id="17079" class="l"><a href="#17079">17079: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17080" class="l"><a href="#17080">17080: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;readDiskCache(<span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>]);
</span><span id="17081" class="l"><a href="#17081">17081: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>])) {
</span><span id="17082" class="l"><a href="#17082">17082: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>];
</span><span id="17083" class="l"><a href="#17083">17083: </a>            }
</span><span id="17084" class="l"><a href="#17084">17084: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="17085" class="l"><a href="#17085">17085: </a>        }
</span><span id="17086" class="l"><a href="#17086">17086: </a>
</span><span id="17087" class="l"><a href="#17087">17087: </a>        <span class="php-comment">/**
</span></span><span id="17088" class="l"><a href="#17088">17088: </a><span class="php-comment">         * Set image buffer content.
</span></span><span id="17089" class="l"><a href="#17089">17089: </a><span class="php-comment">         * @param string $image image key
</span></span><span id="17090" class="l"><a href="#17090">17090: </a><span class="php-comment">         * @param array $data image data
</span></span><span id="17091" class="l"><a href="#17091">17091: </a><span class="php-comment">         * @access protected
</span></span><span id="17092" class="l"><a href="#17092">17092: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="17093" class="l"><a href="#17093">17093: </a><span class="php-comment">         */</span>
</span><span id="17094" class="l"><a href="#17094">17094: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setImageBuffer(<span class="php-var">$image</span>, <span class="php-var">$data</span>) {
</span><span id="17095" class="l"><a href="#17095">17095: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17096" class="l"><a href="#17096">17096: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>])) {
</span><span id="17097" class="l"><a href="#17097">17097: </a>                    <span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>] = <span class="php-var">$this</span>-&gt;getObjFilename(<span class="php-quote">'image'</span>.<span class="php-var">$image</span>);
</span><span id="17098" class="l"><a href="#17098">17098: </a>                }
</span><span id="17099" class="l"><a href="#17099">17099: </a>                <span class="php-var">$this</span>-&gt;writeDiskCache(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>], <span class="php-keyword2">serialize</span>(<span class="php-var">$data</span>));
</span><span id="17100" class="l"><a href="#17100">17100: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17101" class="l"><a href="#17101">17101: </a>                <span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>] = <span class="php-var">$data</span>;
</span><span id="17102" class="l"><a href="#17102">17102: </a>            }
</span><span id="17103" class="l"><a href="#17103">17103: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$image</span>, <span class="php-var">$this</span>-&gt;imagekeys)) {
</span><span id="17104" class="l"><a href="#17104">17104: </a>                <span class="php-var">$this</span>-&gt;imagekeys[] = <span class="php-var">$image</span>;
</span><span id="17105" class="l"><a href="#17105">17105: </a>                ++<span class="php-var">$this</span>-&gt;numimages;
</span><span id="17106" class="l"><a href="#17106">17106: </a>            }
</span><span id="17107" class="l"><a href="#17107">17107: </a>        }
</span><span id="17108" class="l"><a href="#17108">17108: </a>
</span><span id="17109" class="l"><a href="#17109">17109: </a>        <span class="php-comment">/**
</span></span><span id="17110" class="l"><a href="#17110">17110: </a><span class="php-comment">         * Set image buffer content for a specified sub-key.
</span></span><span id="17111" class="l"><a href="#17111">17111: </a><span class="php-comment">         * @param string $image image key
</span></span><span id="17112" class="l"><a href="#17112">17112: </a><span class="php-comment">         * @param string $key image sub-key
</span></span><span id="17113" class="l"><a href="#17113">17113: </a><span class="php-comment">         * @param array $data image data
</span></span><span id="17114" class="l"><a href="#17114">17114: </a><span class="php-comment">         * @access protected
</span></span><span id="17115" class="l"><a href="#17115">17115: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="17116" class="l"><a href="#17116">17116: </a><span class="php-comment">         */</span>
</span><span id="17117" class="l"><a href="#17117">17117: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setImageSubBuffer(<span class="php-var">$image</span>, <span class="php-var">$key</span>, <span class="php-var">$data</span>) {
</span><span id="17118" class="l"><a href="#17118">17118: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>])) {
</span><span id="17119" class="l"><a href="#17119">17119: </a>                <span class="php-var">$this</span>-&gt;setImageBuffer(<span class="php-var">$image</span>, <span class="php-keyword1">array</span>());
</span><span id="17120" class="l"><a href="#17120">17120: </a>            }
</span><span id="17121" class="l"><a href="#17121">17121: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17122" class="l"><a href="#17122">17122: </a>                <span class="php-var">$tmpimg</span> = <span class="php-var">$this</span>-&gt;getImageBuffer(<span class="php-var">$image</span>);
</span><span id="17123" class="l"><a href="#17123">17123: </a>                <span class="php-var">$tmpimg</span>[<span class="php-var">$key</span>] = <span class="php-var">$data</span>;
</span><span id="17124" class="l"><a href="#17124">17124: </a>                <span class="php-var">$this</span>-&gt;writeDiskCache(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>], <span class="php-keyword2">serialize</span>(<span class="php-var">$tmpimg</span>));
</span><span id="17125" class="l"><a href="#17125">17125: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17126" class="l"><a href="#17126">17126: </a>                <span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>][<span class="php-var">$key</span>] = <span class="php-var">$data</span>;
</span><span id="17127" class="l"><a href="#17127">17127: </a>            }
</span><span id="17128" class="l"><a href="#17128">17128: </a>        }
</span><span id="17129" class="l"><a href="#17129">17129: </a>
</span><span id="17130" class="l"><a href="#17130">17130: </a>        <span class="php-comment">/**
</span></span><span id="17131" class="l"><a href="#17131">17131: </a><span class="php-comment">         * Get image buffer content.
</span></span><span id="17132" class="l"><a href="#17132">17132: </a><span class="php-comment">         * @param string $image image key
</span></span><span id="17133" class="l"><a href="#17133">17133: </a><span class="php-comment">         * @return string image buffer content or false in case of error
</span></span><span id="17134" class="l"><a href="#17134">17134: </a><span class="php-comment">         * @access protected
</span></span><span id="17135" class="l"><a href="#17135">17135: </a><span class="php-comment">         * @since 4.5.000 (2008-12-31)
</span></span><span id="17136" class="l"><a href="#17136">17136: </a><span class="php-comment">         */</span>
</span><span id="17137" class="l"><a href="#17137">17137: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getImageBuffer(<span class="php-var">$image</span>) {
</span><span id="17138" class="l"><a href="#17138">17138: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>])) {
</span><span id="17139" class="l"><a href="#17139">17139: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">unserialize</span>(<span class="php-var">$this</span>-&gt;readDiskCache(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>]));
</span><span id="17140" class="l"><a href="#17140">17140: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>])) {
</span><span id="17141" class="l"><a href="#17141">17141: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;images[<span class="php-var">$image</span>];
</span><span id="17142" class="l"><a href="#17142">17142: </a>            }
</span><span id="17143" class="l"><a href="#17143">17143: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="17144" class="l"><a href="#17144">17144: </a>        }
</span><span id="17145" class="l"><a href="#17145">17145: </a>
</span><span id="17146" class="l"><a href="#17146">17146: </a>        <span class="php-comment">/**
</span></span><span id="17147" class="l"><a href="#17147">17147: </a><span class="php-comment">         * Set font buffer content.
</span></span><span id="17148" class="l"><a href="#17148">17148: </a><span class="php-comment">         * @param string $font font key
</span></span><span id="17149" class="l"><a href="#17149">17149: </a><span class="php-comment">         * @param array $data font data
</span></span><span id="17150" class="l"><a href="#17150">17150: </a><span class="php-comment">         * @access protected
</span></span><span id="17151" class="l"><a href="#17151">17151: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="17152" class="l"><a href="#17152">17152: </a><span class="php-comment">         */</span>
</span><span id="17153" class="l"><a href="#17153">17153: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setFontBuffer(<span class="php-var">$font</span>, <span class="php-var">$data</span>) {
</span><span id="17154" class="l"><a href="#17154">17154: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17155" class="l"><a href="#17155">17155: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>])) {
</span><span id="17156" class="l"><a href="#17156">17156: </a>                    <span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>] = <span class="php-var">$this</span>-&gt;getObjFilename(<span class="php-quote">'font'</span>);
</span><span id="17157" class="l"><a href="#17157">17157: </a>                }
</span><span id="17158" class="l"><a href="#17158">17158: </a>                <span class="php-var">$this</span>-&gt;writeDiskCache(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>], <span class="php-keyword2">serialize</span>(<span class="php-var">$data</span>));
</span><span id="17159" class="l"><a href="#17159">17159: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17160" class="l"><a href="#17160">17160: </a>                <span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>] = <span class="php-var">$data</span>;
</span><span id="17161" class="l"><a href="#17161">17161: </a>            }
</span><span id="17162" class="l"><a href="#17162">17162: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">in_array</span>(<span class="php-var">$font</span>, <span class="php-var">$this</span>-&gt;fontkeys)) {
</span><span id="17163" class="l"><a href="#17163">17163: </a>                <span class="php-var">$this</span>-&gt;fontkeys[] = <span class="php-var">$font</span>;
</span><span id="17164" class="l"><a href="#17164">17164: </a>            }
</span><span id="17165" class="l"><a href="#17165">17165: </a>        }
</span><span id="17166" class="l"><a href="#17166">17166: </a>
</span><span id="17167" class="l"><a href="#17167">17167: </a>        <span class="php-comment">/**
</span></span><span id="17168" class="l"><a href="#17168">17168: </a><span class="php-comment">         * Set font buffer content.
</span></span><span id="17169" class="l"><a href="#17169">17169: </a><span class="php-comment">         * @param string $font font key
</span></span><span id="17170" class="l"><a href="#17170">17170: </a><span class="php-comment">         * @param string $key font sub-key
</span></span><span id="17171" class="l"><a href="#17171">17171: </a><span class="php-comment">         * @param array $data font data
</span></span><span id="17172" class="l"><a href="#17172">17172: </a><span class="php-comment">         * @access protected
</span></span><span id="17173" class="l"><a href="#17173">17173: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="17174" class="l"><a href="#17174">17174: </a><span class="php-comment">         */</span>
</span><span id="17175" class="l"><a href="#17175">17175: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setFontSubBuffer(<span class="php-var">$font</span>, <span class="php-var">$key</span>, <span class="php-var">$data</span>) {
</span><span id="17176" class="l"><a href="#17176">17176: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>])) {
</span><span id="17177" class="l"><a href="#17177">17177: </a>                <span class="php-var">$this</span>-&gt;setFontBuffer(<span class="php-var">$font</span>, <span class="php-keyword1">array</span>());
</span><span id="17178" class="l"><a href="#17178">17178: </a>            }
</span><span id="17179" class="l"><a href="#17179">17179: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache) {
</span><span id="17180" class="l"><a href="#17180">17180: </a>                <span class="php-var">$tmpfont</span> = <span class="php-var">$this</span>-&gt;getFontBuffer(<span class="php-var">$font</span>);
</span><span id="17181" class="l"><a href="#17181">17181: </a>                <span class="php-var">$tmpfont</span>[<span class="php-var">$key</span>] = <span class="php-var">$data</span>;
</span><span id="17182" class="l"><a href="#17182">17182: </a>                <span class="php-var">$this</span>-&gt;writeDiskCache(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>], <span class="php-keyword2">serialize</span>(<span class="php-var">$tmpfont</span>));
</span><span id="17183" class="l"><a href="#17183">17183: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17184" class="l"><a href="#17184">17184: </a>                <span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>][<span class="php-var">$key</span>] = <span class="php-var">$data</span>;
</span><span id="17185" class="l"><a href="#17185">17185: </a>            }
</span><span id="17186" class="l"><a href="#17186">17186: </a>        }
</span><span id="17187" class="l"><a href="#17187">17187: </a>
</span><span id="17188" class="l"><a href="#17188">17188: </a>        <span class="php-comment">/**
</span></span><span id="17189" class="l"><a href="#17189">17189: </a><span class="php-comment">         * Get font buffer content.
</span></span><span id="17190" class="l"><a href="#17190">17190: </a><span class="php-comment">         * @param string $font font key
</span></span><span id="17191" class="l"><a href="#17191">17191: </a><span class="php-comment">         * @return string font buffer content or false in case of error
</span></span><span id="17192" class="l"><a href="#17192">17192: </a><span class="php-comment">         * @access protected
</span></span><span id="17193" class="l"><a href="#17193">17193: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="17194" class="l"><a href="#17194">17194: </a><span class="php-comment">         */</span>
</span><span id="17195" class="l"><a href="#17195">17195: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getFontBuffer(<span class="php-var">$font</span>) {
</span><span id="17196" class="l"><a href="#17196">17196: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;diskcache <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>])) {
</span><span id="17197" class="l"><a href="#17197">17197: </a>                <span class="php-keyword1">return</span> <span class="php-keyword2">unserialize</span>(<span class="php-var">$this</span>-&gt;readDiskCache(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>]));
</span><span id="17198" class="l"><a href="#17198">17198: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>])) {
</span><span id="17199" class="l"><a href="#17199">17199: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;fonts[<span class="php-var">$font</span>];
</span><span id="17200" class="l"><a href="#17200">17200: </a>            }
</span><span id="17201" class="l"><a href="#17201">17201: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="17202" class="l"><a href="#17202">17202: </a>        }
</span><span id="17203" class="l"><a href="#17203">17203: </a>
</span><span id="17204" class="l"><a href="#17204">17204: </a>        <span class="php-comment">/**
</span></span><span id="17205" class="l"><a href="#17205">17205: </a><span class="php-comment">         * Move a page to a previous position.
</span></span><span id="17206" class="l"><a href="#17206">17206: </a><span class="php-comment">         * @param int $frompage number of the source page
</span></span><span id="17207" class="l"><a href="#17207">17207: </a><span class="php-comment">         * @param int $topage number of the destination page (must be less than $frompage)
</span></span><span id="17208" class="l"><a href="#17208">17208: </a><span class="php-comment">         * @return true in case of success, false in case of error.
</span></span><span id="17209" class="l"><a href="#17209">17209: </a><span class="php-comment">         * @access public
</span></span><span id="17210" class="l"><a href="#17210">17210: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="17211" class="l"><a href="#17211">17211: </a><span class="php-comment">         */</span>
</span><span id="17212" class="l"><a href="#17212">17212: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> movePage(<span class="php-var">$frompage</span>, <span class="php-var">$topage</span>) {
</span><span id="17213" class="l"><a href="#17213">17213: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$frompage</span> &gt; <span class="php-var">$this</span>-&gt;numpages) <span class="php-keyword1">OR</span> (<span class="php-var">$frompage</span> &lt;= <span class="php-var">$topage</span>)) {
</span><span id="17214" class="l"><a href="#17214">17214: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="17215" class="l"><a href="#17215">17215: </a>            }
</span><span id="17216" class="l"><a href="#17216">17216: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$frompage</span> == <span class="php-var">$this</span>-&gt;page) {
</span><span id="17217" class="l"><a href="#17217">17217: </a>                <span class="php-comment">// close the page before moving it</span>
</span><span id="17218" class="l"><a href="#17218">17218: </a>                <span class="php-var">$this</span>-&gt;endPage();
</span><span id="17219" class="l"><a href="#17219">17219: </a>            }
</span><span id="17220" class="l"><a href="#17220">17220: </a>            <span class="php-comment">// move all page-related states</span>
</span><span id="17221" class="l"><a href="#17221">17221: </a>            <span class="php-var">$tmppage</span> = <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$frompage</span>];
</span><span id="17222" class="l"><a href="#17222">17222: </a>            <span class="php-var">$tmppagedim</span> = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$frompage</span>];
</span><span id="17223" class="l"><a href="#17223">17223: </a>            <span class="php-var">$tmppagelen</span> = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$frompage</span>];
</span><span id="17224" class="l"><a href="#17224">17224: </a>            <span class="php-var">$tmpintmrk</span> = <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$frompage</span>];
</span><span id="17225" class="l"><a href="#17225">17225: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$frompage</span>])) {
</span><span id="17226" class="l"><a href="#17226">17226: </a>                <span class="php-var">$tmpfooterpos</span> = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$frompage</span>];
</span><span id="17227" class="l"><a href="#17227">17227: </a>            }
</span><span id="17228" class="l"><a href="#17228">17228: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$frompage</span>])) {
</span><span id="17229" class="l"><a href="#17229">17229: </a>                <span class="php-var">$tmpfooterlen</span> = <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$frompage</span>];
</span><span id="17230" class="l"><a href="#17230">17230: </a>            }
</span><span id="17231" class="l"><a href="#17231">17231: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$frompage</span>])) {
</span><span id="17232" class="l"><a href="#17232">17232: </a>                <span class="php-var">$tmptransfmrk</span> = <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$frompage</span>];
</span><span id="17233" class="l"><a href="#17233">17233: </a>            }
</span><span id="17234" class="l"><a href="#17234">17234: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$frompage</span>])) {
</span><span id="17235" class="l"><a href="#17235">17235: </a>                <span class="php-var">$tmpannots</span> = <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$frompage</span>];
</span><span id="17236" class="l"><a href="#17236">17236: </a>            }
</span><span id="17237" class="l"><a href="#17237">17237: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$frompage</span>])) {
</span><span id="17238" class="l"><a href="#17238">17238: </a>                <span class="php-var">$tmpnewpagegroup</span> = <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$frompage</span>];
</span><span id="17239" class="l"><a href="#17239">17239: </a>            }
</span><span id="17240" class="l"><a href="#17240">17240: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-var">$frompage</span>; <span class="php-var">$i</span> &gt; <span class="php-var">$topage</span>; --<span class="php-var">$i</span>) {
</span><span id="17241" class="l"><a href="#17241">17241: </a>                <span class="php-var">$j</span> = <span class="php-var">$i</span> - <span class="php-num">1</span>;
</span><span id="17242" class="l"><a href="#17242">17242: </a>                <span class="php-comment">// shift pages down</span>
</span><span id="17243" class="l"><a href="#17243">17243: </a>                <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$j</span>];
</span><span id="17244" class="l"><a href="#17244">17244: </a>                <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$j</span>];
</span><span id="17245" class="l"><a href="#17245">17245: </a>                <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$j</span>];
</span><span id="17246" class="l"><a href="#17246">17246: </a>                <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$j</span>];
</span><span id="17247" class="l"><a href="#17247">17247: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$j</span>])) {
</span><span id="17248" class="l"><a href="#17248">17248: </a>                    <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$j</span>];
</span><span id="17249" class="l"><a href="#17249">17249: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$i</span>])) {
</span><span id="17250" class="l"><a href="#17250">17250: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$i</span>]);
</span><span id="17251" class="l"><a href="#17251">17251: </a>                }
</span><span id="17252" class="l"><a href="#17252">17252: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$j</span>])) {
</span><span id="17253" class="l"><a href="#17253">17253: </a>                    <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$j</span>];
</span><span id="17254" class="l"><a href="#17254">17254: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$i</span>])) {
</span><span id="17255" class="l"><a href="#17255">17255: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$i</span>]);
</span><span id="17256" class="l"><a href="#17256">17256: </a>                }
</span><span id="17257" class="l"><a href="#17257">17257: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$j</span>])) {
</span><span id="17258" class="l"><a href="#17258">17258: </a>                    <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$j</span>];
</span><span id="17259" class="l"><a href="#17259">17259: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$i</span>])) {
</span><span id="17260" class="l"><a href="#17260">17260: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$i</span>]);
</span><span id="17261" class="l"><a href="#17261">17261: </a>                }
</span><span id="17262" class="l"><a href="#17262">17262: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$j</span>])) {
</span><span id="17263" class="l"><a href="#17263">17263: </a>                    <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$j</span>];
</span><span id="17264" class="l"><a href="#17264">17264: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$i</span>])) {
</span><span id="17265" class="l"><a href="#17265">17265: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$i</span>]);
</span><span id="17266" class="l"><a href="#17266">17266: </a>                }
</span><span id="17267" class="l"><a href="#17267">17267: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$j</span>])) {
</span><span id="17268" class="l"><a href="#17268">17268: </a>                    <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$j</span>];
</span><span id="17269" class="l"><a href="#17269">17269: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$i</span>])) {
</span><span id="17270" class="l"><a href="#17270">17270: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$i</span>]);
</span><span id="17271" class="l"><a href="#17271">17271: </a>                }
</span><span id="17272" class="l"><a href="#17272">17272: </a>            }
</span><span id="17273" class="l"><a href="#17273">17273: </a>            <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$topage</span>] = <span class="php-var">$tmppage</span>;
</span><span id="17274" class="l"><a href="#17274">17274: </a>            <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$topage</span>] = <span class="php-var">$tmppagedim</span>;
</span><span id="17275" class="l"><a href="#17275">17275: </a>            <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$topage</span>] = <span class="php-var">$tmppagelen</span>;
</span><span id="17276" class="l"><a href="#17276">17276: </a>            <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$topage</span>] = <span class="php-var">$tmpintmrk</span>;
</span><span id="17277" class="l"><a href="#17277">17277: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tmpfooterpos</span>)) {
</span><span id="17278" class="l"><a href="#17278">17278: </a>                <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$topage</span>] = <span class="php-var">$tmpfooterpos</span>;
</span><span id="17279" class="l"><a href="#17279">17279: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$topage</span>])) {
</span><span id="17280" class="l"><a href="#17280">17280: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$topage</span>]);
</span><span id="17281" class="l"><a href="#17281">17281: </a>            }
</span><span id="17282" class="l"><a href="#17282">17282: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tmpfooterlen</span>)) {
</span><span id="17283" class="l"><a href="#17283">17283: </a>                <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$topage</span>] = <span class="php-var">$tmpfooterlen</span>;
</span><span id="17284" class="l"><a href="#17284">17284: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$topage</span>])) {
</span><span id="17285" class="l"><a href="#17285">17285: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$topage</span>]);
</span><span id="17286" class="l"><a href="#17286">17286: </a>            }
</span><span id="17287" class="l"><a href="#17287">17287: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tmptransfmrk</span>)) {
</span><span id="17288" class="l"><a href="#17288">17288: </a>                <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$topage</span>] = <span class="php-var">$tmptransfmrk</span>;
</span><span id="17289" class="l"><a href="#17289">17289: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$topage</span>])) {
</span><span id="17290" class="l"><a href="#17290">17290: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$topage</span>]);
</span><span id="17291" class="l"><a href="#17291">17291: </a>            }
</span><span id="17292" class="l"><a href="#17292">17292: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tmpannots</span>)) {
</span><span id="17293" class="l"><a href="#17293">17293: </a>                <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$topage</span>] = <span class="php-var">$tmpannots</span>;
</span><span id="17294" class="l"><a href="#17294">17294: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$topage</span>])) {
</span><span id="17295" class="l"><a href="#17295">17295: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$topage</span>]);
</span><span id="17296" class="l"><a href="#17296">17296: </a>            }
</span><span id="17297" class="l"><a href="#17297">17297: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$tmpnewpagegroup</span>)) {
</span><span id="17298" class="l"><a href="#17298">17298: </a>                <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$topage</span>] = <span class="php-var">$tmpnewpagegroup</span>;
</span><span id="17299" class="l"><a href="#17299">17299: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$topage</span>])) {
</span><span id="17300" class="l"><a href="#17300">17300: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$topage</span>]);
</span><span id="17301" class="l"><a href="#17301">17301: </a>            }
</span><span id="17302" class="l"><a href="#17302">17302: </a>            <span class="php-comment">// adjust outlines</span>
</span><span id="17303" class="l"><a href="#17303">17303: </a>            <span class="php-var">$tmpoutlines</span> = <span class="php-var">$this</span>-&gt;outlines;
</span><span id="17304" class="l"><a href="#17304">17304: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$tmpoutlines</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$outline</span>) {
</span><span id="17305" class="l"><a href="#17305">17305: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] &gt;= <span class="php-var">$topage</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] &lt; <span class="php-var">$frompage</span>)) {
</span><span id="17306" class="l"><a href="#17306">17306: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$key</span>][<span class="php-quote">'p'</span>] = <span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] + <span class="php-num">1</span>;
</span><span id="17307" class="l"><a href="#17307">17307: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] == <span class="php-var">$frompage</span>) {
</span><span id="17308" class="l"><a href="#17308">17308: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$key</span>][<span class="php-quote">'p'</span>] = <span class="php-var">$topage</span>;
</span><span id="17309" class="l"><a href="#17309">17309: </a>                }
</span><span id="17310" class="l"><a href="#17310">17310: </a>            }
</span><span id="17311" class="l"><a href="#17311">17311: </a>            <span class="php-comment">// adjust links</span>
</span><span id="17312" class="l"><a href="#17312">17312: </a>            <span class="php-var">$tmplinks</span> = <span class="php-var">$this</span>-&gt;links;
</span><span id="17313" class="l"><a href="#17313">17313: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$tmplinks</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$link</span>) {
</span><span id="17314" class="l"><a href="#17314">17314: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$link</span>[<span class="php-num">0</span>] &gt;= <span class="php-var">$topage</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$link</span>[<span class="php-num">0</span>] &lt; <span class="php-var">$frompage</span>)) {
</span><span id="17315" class="l"><a href="#17315">17315: </a>                    <span class="php-var">$this</span>-&gt;links[<span class="php-var">$key</span>][<span class="php-num">0</span>] = <span class="php-var">$link</span>[<span class="php-num">0</span>] + <span class="php-num">1</span>;
</span><span id="17316" class="l"><a href="#17316">17316: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$link</span>[<span class="php-num">0</span>] == <span class="php-var">$frompage</span>) {
</span><span id="17317" class="l"><a href="#17317">17317: </a>                    <span class="php-var">$this</span>-&gt;links[<span class="php-var">$key</span>][<span class="php-num">0</span>] = <span class="php-var">$topage</span>;
</span><span id="17318" class="l"><a href="#17318">17318: </a>                }
</span><span id="17319" class="l"><a href="#17319">17319: </a>            }
</span><span id="17320" class="l"><a href="#17320">17320: </a>            <span class="php-comment">// adjust javascript</span>
</span><span id="17321" class="l"><a href="#17321">17321: </a>            <span class="php-var">$tmpjavascript</span> = <span class="php-var">$this</span>-&gt;javascript;
</span><span id="17322" class="l"><a href="#17322">17322: </a>            <span class="php-keyword1">global</span> <span class="php-var">$jfrompage</span>, <span class="php-var">$jtopage</span>;
</span><span id="17323" class="l"><a href="#17323">17323: </a>            <span class="php-var">$jfrompage</span> = <span class="php-var">$frompage</span>;
</span><span id="17324" class="l"><a href="#17324">17324: </a>            <span class="php-var">$jtopage</span> = <span class="php-var">$topage</span>;
</span><span id="17325" class="l"><a href="#17325">17325: </a>            <span class="php-var">$this</span>-&gt;javascript = <span class="php-keyword2">preg_replace_callback</span>(<span class="php-quote">'/this\.addField\(\'([^\']*)\',\'([^\']*)\',([0-9]+)/'</span>,
</span><span id="17326" class="l"><a href="#17326">17326: </a>                <span class="php-keyword2">create_function</span>(<span class="php-quote">'$matches'</span>, <span class="php-quote">'global $jfrompage, $jtopage;
</span></span><span id="17327" class="l"><a href="#17327">17327: </a><span class="php-quote">                $pagenum = intval($matches[3]) + 1;
</span></span><span id="17328" class="l"><a href="#17328">17328: </a><span class="php-quote">                if (($pagenum &gt;= $jtopage) AND ($pagenum &lt; $jfrompage)) {
</span></span><span id="17329" class="l"><a href="#17329">17329: </a><span class="php-quote">                    $newpage = ($pagenum + 1);
</span></span><span id="17330" class="l"><a href="#17330">17330: </a><span class="php-quote">                } elseif ($pagenum == $jfrompage) {
</span></span><span id="17331" class="l"><a href="#17331">17331: </a><span class="php-quote">                    $newpage = $jtopage;
</span></span><span id="17332" class="l"><a href="#17332">17332: </a><span class="php-quote">                } else {
</span></span><span id="17333" class="l"><a href="#17333">17333: </a><span class="php-quote">                    $newpage = $pagenum;
</span></span><span id="17334" class="l"><a href="#17334">17334: </a><span class="php-quote">                }
</span></span><span id="17335" class="l"><a href="#17335">17335: </a><span class="php-quote">                --$newpage;
</span></span><span id="17336" class="l"><a href="#17336">17336: </a><span class="php-quote">                return &quot;this.addField(\'&quot;.$matches[1].&quot;\',\'&quot;.$matches[2].&quot;\',&quot;.$newpage.&quot;&quot;;'</span>), <span class="php-var">$tmpjavascript</span>);
</span><span id="17337" class="l"><a href="#17337">17337: </a>            <span class="php-comment">// return to last page</span>
</span><span id="17338" class="l"><a href="#17338">17338: </a>            <span class="php-var">$this</span>-&gt;lastPage(<span class="php-keyword1">true</span>);
</span><span id="17339" class="l"><a href="#17339">17339: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="17340" class="l"><a href="#17340">17340: </a>        }
</span><span id="17341" class="l"><a href="#17341">17341: </a>
</span><span id="17342" class="l"><a href="#17342">17342: </a>        <span class="php-comment">/**
</span></span><span id="17343" class="l"><a href="#17343">17343: </a><span class="php-comment">         * Remove the specified page.
</span></span><span id="17344" class="l"><a href="#17344">17344: </a><span class="php-comment">         * @param int $page page to remove
</span></span><span id="17345" class="l"><a href="#17345">17345: </a><span class="php-comment">         * @return true in case of success, false in case of error.
</span></span><span id="17346" class="l"><a href="#17346">17346: </a><span class="php-comment">         * @access public
</span></span><span id="17347" class="l"><a href="#17347">17347: </a><span class="php-comment">         * @since 4.6.004 (2009-04-23)
</span></span><span id="17348" class="l"><a href="#17348">17348: </a><span class="php-comment">         */</span>
</span><span id="17349" class="l"><a href="#17349">17349: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> deletePage(<span class="php-var">$page</span>) {
</span><span id="17350" class="l"><a href="#17350">17350: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$page</span> &gt; <span class="php-var">$this</span>-&gt;numpages) {
</span><span id="17351" class="l"><a href="#17351">17351: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="17352" class="l"><a href="#17352">17352: </a>            }
</span><span id="17353" class="l"><a href="#17353">17353: </a>            <span class="php-comment">// delete current page</span>
</span><span id="17354" class="l"><a href="#17354">17354: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>]);
</span><span id="17355" class="l"><a href="#17355">17355: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>]);
</span><span id="17356" class="l"><a href="#17356">17356: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$page</span>]);
</span><span id="17357" class="l"><a href="#17357">17357: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$page</span>]);
</span><span id="17358" class="l"><a href="#17358">17358: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$page</span>])) {
</span><span id="17359" class="l"><a href="#17359">17359: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$page</span>]);
</span><span id="17360" class="l"><a href="#17360">17360: </a>            }
</span><span id="17361" class="l"><a href="#17361">17361: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$page</span>])) {
</span><span id="17362" class="l"><a href="#17362">17362: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$page</span>]);
</span><span id="17363" class="l"><a href="#17363">17363: </a>            }
</span><span id="17364" class="l"><a href="#17364">17364: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$page</span>])) {
</span><span id="17365" class="l"><a href="#17365">17365: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$page</span>]);
</span><span id="17366" class="l"><a href="#17366">17366: </a>            }
</span><span id="17367" class="l"><a href="#17367">17367: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$page</span>])) {
</span><span id="17368" class="l"><a href="#17368">17368: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$page</span>]);
</span><span id="17369" class="l"><a href="#17369">17369: </a>            }
</span><span id="17370" class="l"><a href="#17370">17370: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$page</span>])) {
</span><span id="17371" class="l"><a href="#17371">17371: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$page</span>]);
</span><span id="17372" class="l"><a href="#17372">17372: </a>            }
</span><span id="17373" class="l"><a href="#17373">17373: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$page</span>])) {
</span><span id="17374" class="l"><a href="#17374">17374: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$page</span>]);
</span><span id="17375" class="l"><a href="#17375">17375: </a>            }
</span><span id="17376" class="l"><a href="#17376">17376: </a>            <span class="php-comment">// update remaining pages</span>
</span><span id="17377" class="l"><a href="#17377">17377: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-var">$page</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$this</span>-&gt;numpages; ++<span class="php-var">$i</span>) {
</span><span id="17378" class="l"><a href="#17378">17378: </a>                <span class="php-var">$j</span> = <span class="php-var">$i</span> + <span class="php-num">1</span>;
</span><span id="17379" class="l"><a href="#17379">17379: </a>                <span class="php-comment">// shift pages</span>
</span><span id="17380" class="l"><a href="#17380">17380: </a>                <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$j</span>];
</span><span id="17381" class="l"><a href="#17381">17381: </a>                <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$j</span>];
</span><span id="17382" class="l"><a href="#17382">17382: </a>                <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$j</span>];
</span><span id="17383" class="l"><a href="#17383">17383: </a>                <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$j</span>];
</span><span id="17384" class="l"><a href="#17384">17384: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$j</span>])) {
</span><span id="17385" class="l"><a href="#17385">17385: </a>                    <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$j</span>];
</span><span id="17386" class="l"><a href="#17386">17386: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$i</span>])) {
</span><span id="17387" class="l"><a href="#17387">17387: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$i</span>]);
</span><span id="17388" class="l"><a href="#17388">17388: </a>                }
</span><span id="17389" class="l"><a href="#17389">17389: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$j</span>])) {
</span><span id="17390" class="l"><a href="#17390">17390: </a>                    <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$j</span>];
</span><span id="17391" class="l"><a href="#17391">17391: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$i</span>])) {
</span><span id="17392" class="l"><a href="#17392">17392: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$i</span>]);
</span><span id="17393" class="l"><a href="#17393">17393: </a>                }
</span><span id="17394" class="l"><a href="#17394">17394: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$j</span>])) {
</span><span id="17395" class="l"><a href="#17395">17395: </a>                    <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$j</span>];
</span><span id="17396" class="l"><a href="#17396">17396: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$i</span>])) {
</span><span id="17397" class="l"><a href="#17397">17397: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$i</span>]);
</span><span id="17398" class="l"><a href="#17398">17398: </a>                }
</span><span id="17399" class="l"><a href="#17399">17399: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$j</span>])) {
</span><span id="17400" class="l"><a href="#17400">17400: </a>                    <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$j</span>];
</span><span id="17401" class="l"><a href="#17401">17401: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$i</span>])) {
</span><span id="17402" class="l"><a href="#17402">17402: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$i</span>]);
</span><span id="17403" class="l"><a href="#17403">17403: </a>                }
</span><span id="17404" class="l"><a href="#17404">17404: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$j</span>])) {
</span><span id="17405" class="l"><a href="#17405">17405: </a>                    <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$j</span>];
</span><span id="17406" class="l"><a href="#17406">17406: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$i</span>])) {
</span><span id="17407" class="l"><a href="#17407">17407: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$i</span>]);
</span><span id="17408" class="l"><a href="#17408">17408: </a>                }
</span><span id="17409" class="l"><a href="#17409">17409: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$j</span>])) {
</span><span id="17410" class="l"><a href="#17410">17410: </a>                    <span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$i</span>] = <span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$j</span>];
</span><span id="17411" class="l"><a href="#17411">17411: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$i</span>])) {
</span><span id="17412" class="l"><a href="#17412">17412: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$i</span>]);
</span><span id="17413" class="l"><a href="#17413">17413: </a>                }
</span><span id="17414" class="l"><a href="#17414">17414: </a>            }
</span><span id="17415" class="l"><a href="#17415">17415: </a>            <span class="php-comment">// remove last page</span>
</span><span id="17416" class="l"><a href="#17416">17416: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pages[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17417" class="l"><a href="#17417">17417: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17418" class="l"><a href="#17418">17418: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17419" class="l"><a href="#17419">17419: </a>            <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17420" class="l"><a href="#17420">17420: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;numpages])) {
</span><span id="17421" class="l"><a href="#17421">17421: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17422" class="l"><a href="#17422">17422: </a>            }
</span><span id="17423" class="l"><a href="#17423">17423: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;numpages])) {
</span><span id="17424" class="l"><a href="#17424">17424: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17425" class="l"><a href="#17425">17425: </a>            }
</span><span id="17426" class="l"><a href="#17426">17426: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;numpages])) {
</span><span id="17427" class="l"><a href="#17427">17427: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17428" class="l"><a href="#17428">17428: </a>            }
</span><span id="17429" class="l"><a href="#17429">17429: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;numpages])) {
</span><span id="17430" class="l"><a href="#17430">17430: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17431" class="l"><a href="#17431">17431: </a>            }
</span><span id="17432" class="l"><a href="#17432">17432: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$this</span>-&gt;numpages])) {
</span><span id="17433" class="l"><a href="#17433">17433: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17434" class="l"><a href="#17434">17434: </a>            }
</span><span id="17435" class="l"><a href="#17435">17435: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$this</span>-&gt;numpages])) {
</span><span id="17436" class="l"><a href="#17436">17436: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$this</span>-&gt;numpages]);
</span><span id="17437" class="l"><a href="#17437">17437: </a>            }
</span><span id="17438" class="l"><a href="#17438">17438: </a>            --<span class="php-var">$this</span>-&gt;numpages;
</span><span id="17439" class="l"><a href="#17439">17439: </a>            <span class="php-var">$this</span>-&gt;page = <span class="php-var">$this</span>-&gt;numpages;
</span><span id="17440" class="l"><a href="#17440">17440: </a>            <span class="php-comment">// adjust outlines</span>
</span><span id="17441" class="l"><a href="#17441">17441: </a>            <span class="php-var">$tmpoutlines</span> = <span class="php-var">$this</span>-&gt;outlines;
</span><span id="17442" class="l"><a href="#17442">17442: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$tmpoutlines</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$outline</span>) {
</span><span id="17443" class="l"><a href="#17443">17443: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] &gt; <span class="php-var">$page</span>) {
</span><span id="17444" class="l"><a href="#17444">17444: </a>                    <span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$key</span>][<span class="php-quote">'p'</span>] = <span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] - <span class="php-num">1</span>;
</span><span id="17445" class="l"><a href="#17445">17445: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] == <span class="php-var">$page</span>) {
</span><span id="17446" class="l"><a href="#17446">17446: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;outlines[<span class="php-var">$key</span>]);
</span><span id="17447" class="l"><a href="#17447">17447: </a>                }
</span><span id="17448" class="l"><a href="#17448">17448: </a>            }
</span><span id="17449" class="l"><a href="#17449">17449: </a>            <span class="php-comment">// adjust links</span>
</span><span id="17450" class="l"><a href="#17450">17450: </a>            <span class="php-var">$tmplinks</span> = <span class="php-var">$this</span>-&gt;links;
</span><span id="17451" class="l"><a href="#17451">17451: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$tmplinks</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$link</span>) {
</span><span id="17452" class="l"><a href="#17452">17452: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$link</span>[<span class="php-num">0</span>] &gt; <span class="php-var">$page</span>) {
</span><span id="17453" class="l"><a href="#17453">17453: </a>                    <span class="php-var">$this</span>-&gt;links[<span class="php-var">$key</span>][<span class="php-num">0</span>] = <span class="php-var">$link</span>[<span class="php-num">0</span>] - <span class="php-num">1</span>;
</span><span id="17454" class="l"><a href="#17454">17454: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$link</span>[<span class="php-num">0</span>] == <span class="php-var">$page</span>) {
</span><span id="17455" class="l"><a href="#17455">17455: </a>                    <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;links[<span class="php-var">$key</span>]);
</span><span id="17456" class="l"><a href="#17456">17456: </a>                }
</span><span id="17457" class="l"><a href="#17457">17457: </a>            }
</span><span id="17458" class="l"><a href="#17458">17458: </a>            <span class="php-comment">// adjust javascript</span>
</span><span id="17459" class="l"><a href="#17459">17459: </a>            <span class="php-var">$tmpjavascript</span> = <span class="php-var">$this</span>-&gt;javascript;
</span><span id="17460" class="l"><a href="#17460">17460: </a>            <span class="php-keyword1">global</span> <span class="php-var">$jpage</span>;
</span><span id="17461" class="l"><a href="#17461">17461: </a>            <span class="php-var">$jpage</span> = <span class="php-var">$page</span>;
</span><span id="17462" class="l"><a href="#17462">17462: </a>            <span class="php-var">$this</span>-&gt;javascript = <span class="php-keyword2">preg_replace_callback</span>(<span class="php-quote">'/this\.addField\(\'([^\']*)\',\'([^\']*)\',([0-9]+)/'</span>,
</span><span id="17463" class="l"><a href="#17463">17463: </a>                <span class="php-keyword2">create_function</span>(<span class="php-quote">'$matches'</span>, <span class="php-quote">'global $jpage;
</span></span><span id="17464" class="l"><a href="#17464">17464: </a><span class="php-quote">                $pagenum = intval($matches[3]) + 1;
</span></span><span id="17465" class="l"><a href="#17465">17465: </a><span class="php-quote">                if ($pagenum &gt;= $jpage) {
</span></span><span id="17466" class="l"><a href="#17466">17466: </a><span class="php-quote">                    $newpage = ($pagenum - 1);
</span></span><span id="17467" class="l"><a href="#17467">17467: </a><span class="php-quote">                } elseif ($pagenum == $jpage) {
</span></span><span id="17468" class="l"><a href="#17468">17468: </a><span class="php-quote">                    $newpage = 1;
</span></span><span id="17469" class="l"><a href="#17469">17469: </a><span class="php-quote">                } else {
</span></span><span id="17470" class="l"><a href="#17470">17470: </a><span class="php-quote">                    $newpage = $pagenum;
</span></span><span id="17471" class="l"><a href="#17471">17471: </a><span class="php-quote">                }
</span></span><span id="17472" class="l"><a href="#17472">17472: </a><span class="php-quote">                --$newpage;
</span></span><span id="17473" class="l"><a href="#17473">17473: </a><span class="php-quote">                return &quot;this.addField(\'&quot;.$matches[1].&quot;\',\'&quot;.$matches[2].&quot;\',&quot;.$newpage.&quot;&quot;;'</span>), <span class="php-var">$tmpjavascript</span>);
</span><span id="17474" class="l"><a href="#17474">17474: </a>            <span class="php-comment">// return to last page</span>
</span><span id="17475" class="l"><a href="#17475">17475: </a>            <span class="php-var">$this</span>-&gt;lastPage(<span class="php-keyword1">true</span>);
</span><span id="17476" class="l"><a href="#17476">17476: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="17477" class="l"><a href="#17477">17477: </a>        }
</span><span id="17478" class="l"><a href="#17478">17478: </a>
</span><span id="17479" class="l"><a href="#17479">17479: </a>        <span class="php-comment">/**
</span></span><span id="17480" class="l"><a href="#17480">17480: </a><span class="php-comment">         * Clone the specified page to a new page.
</span></span><span id="17481" class="l"><a href="#17481">17481: </a><span class="php-comment">         * @param int $page number of page to copy (0 = current page)
</span></span><span id="17482" class="l"><a href="#17482">17482: </a><span class="php-comment">         * @return true in case of success, false in case of error.
</span></span><span id="17483" class="l"><a href="#17483">17483: </a><span class="php-comment">         * @access public
</span></span><span id="17484" class="l"><a href="#17484">17484: </a><span class="php-comment">         * @since 4.9.015 (2010-04-20)
</span></span><span id="17485" class="l"><a href="#17485">17485: </a><span class="php-comment">         */</span>
</span><span id="17486" class="l"><a href="#17486">17486: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> copyPage(<span class="php-var">$page</span>=<span class="php-num">0</span>) {
</span><span id="17487" class="l"><a href="#17487">17487: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$page</span> == <span class="php-num">0</span>) {
</span><span id="17488" class="l"><a href="#17488">17488: </a>                <span class="php-comment">// default value</span>
</span><span id="17489" class="l"><a href="#17489">17489: </a>                <span class="php-var">$page</span> = <span class="php-var">$this</span>-&gt;page;
</span><span id="17490" class="l"><a href="#17490">17490: </a>            }
</span><span id="17491" class="l"><a href="#17491">17491: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$page</span> &gt; <span class="php-var">$this</span>-&gt;numpages) {
</span><span id="17492" class="l"><a href="#17492">17492: </a>                <span class="php-keyword1">return</span> <span class="php-keyword1">false</span>;
</span><span id="17493" class="l"><a href="#17493">17493: </a>            }
</span><span id="17494" class="l"><a href="#17494">17494: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$page</span> == <span class="php-var">$this</span>-&gt;page) {
</span><span id="17495" class="l"><a href="#17495">17495: </a>                <span class="php-comment">// close the page before cloning it</span>
</span><span id="17496" class="l"><a href="#17496">17496: </a>                <span class="php-var">$this</span>-&gt;endPage();
</span><span id="17497" class="l"><a href="#17497">17497: </a>            }
</span><span id="17498" class="l"><a href="#17498">17498: </a>            <span class="php-comment">// copy all page-related states</span>
</span><span id="17499" class="l"><a href="#17499">17499: </a>            ++<span class="php-var">$this</span>-&gt;numpages;
</span><span id="17500" class="l"><a href="#17500">17500: </a>            <span class="php-var">$this</span>-&gt;page = <span class="php-var">$this</span>-&gt;numpages;
</span><span id="17501" class="l"><a href="#17501">17501: </a>            <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pages[<span class="php-var">$page</span>];
</span><span id="17502" class="l"><a href="#17502">17502: </a>            <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagedim[<span class="php-var">$page</span>];
</span><span id="17503" class="l"><a href="#17503">17503: </a>            <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;pagelen[<span class="php-var">$page</span>];
</span><span id="17504" class="l"><a href="#17504">17504: </a>            <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;intmrk[<span class="php-var">$page</span>];
</span><span id="17505" class="l"><a href="#17505">17505: </a>            <span class="php-var">$this</span>-&gt;pageopen[<span class="php-var">$this</span>-&gt;page] = <span class="php-keyword1">false</span>;
</span><span id="17506" class="l"><a href="#17506">17506: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$page</span>])) {
</span><span id="17507" class="l"><a href="#17507">17507: </a>                <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;footerpos[<span class="php-var">$page</span>];
</span><span id="17508" class="l"><a href="#17508">17508: </a>            }
</span><span id="17509" class="l"><a href="#17509">17509: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$page</span>])) {
</span><span id="17510" class="l"><a href="#17510">17510: </a>                <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;footerlen[<span class="php-var">$page</span>];
</span><span id="17511" class="l"><a href="#17511">17511: </a>            }
</span><span id="17512" class="l"><a href="#17512">17512: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$page</span>])) {
</span><span id="17513" class="l"><a href="#17513">17513: </a>                <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;transfmrk[<span class="php-var">$page</span>];
</span><span id="17514" class="l"><a href="#17514">17514: </a>            }
</span><span id="17515" class="l"><a href="#17515">17515: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$page</span>])) {
</span><span id="17516" class="l"><a href="#17516">17516: </a>                <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;PageAnnots[<span class="php-var">$page</span>];
</span><span id="17517" class="l"><a href="#17517">17517: </a>            }
</span><span id="17518" class="l"><a href="#17518">17518: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$page</span>])) {
</span><span id="17519" class="l"><a href="#17519">17519: </a>                <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$this</span>-&gt;page] = <span class="php-var">$this</span>-&gt;newpagegroup[<span class="php-var">$page</span>];
</span><span id="17520" class="l"><a href="#17520">17520: </a>            }
</span><span id="17521" class="l"><a href="#17521">17521: </a>            <span class="php-comment">// copy outlines</span>
</span><span id="17522" class="l"><a href="#17522">17522: </a>            <span class="php-var">$tmpoutlines</span> = <span class="php-var">$this</span>-&gt;outlines;
</span><span id="17523" class="l"><a href="#17523">17523: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$tmpoutlines</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$outline</span>) {
</span><span id="17524" class="l"><a href="#17524">17524: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>] == <span class="php-var">$page</span>) {
</span><span id="17525" class="l"><a href="#17525">17525: </a>                    <span class="php-var">$this</span>-&gt;outlines[] = <span class="php-keyword1">array</span>(<span class="php-quote">'t'</span> =&gt; <span class="php-var">$outline</span>[<span class="php-quote">'t'</span>], <span class="php-quote">'l'</span> =&gt; <span class="php-var">$outline</span>[<span class="php-quote">'l'</span>], <span class="php-quote">'y'</span> =&gt; <span class="php-var">$outline</span>[<span class="php-quote">'y'</span>], <span class="php-quote">'p'</span> =&gt; <span class="php-var">$this</span>-&gt;page);
</span><span id="17526" class="l"><a href="#17526">17526: </a>                }
</span><span id="17527" class="l"><a href="#17527">17527: </a>            }
</span><span id="17528" class="l"><a href="#17528">17528: </a>            <span class="php-comment">// copy links</span>
</span><span id="17529" class="l"><a href="#17529">17529: </a>            <span class="php-var">$tmplinks</span> = <span class="php-var">$this</span>-&gt;links;
</span><span id="17530" class="l"><a href="#17530">17530: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$tmplinks</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$link</span>) {
</span><span id="17531" class="l"><a href="#17531">17531: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$link</span>[<span class="php-num">0</span>] == <span class="php-var">$page</span>) {
</span><span id="17532" class="l"><a href="#17532">17532: </a>                    <span class="php-var">$this</span>-&gt;links[] = <span class="php-keyword1">array</span>(<span class="php-var">$this</span>-&gt;page, <span class="php-var">$link</span>[<span class="php-num">1</span>]);
</span><span id="17533" class="l"><a href="#17533">17533: </a>                }
</span><span id="17534" class="l"><a href="#17534">17534: </a>            }
</span><span id="17535" class="l"><a href="#17535">17535: </a>            <span class="php-comment">// return to last page</span>
</span><span id="17536" class="l"><a href="#17536">17536: </a>            <span class="php-var">$this</span>-&gt;lastPage(<span class="php-keyword1">true</span>);
</span><span id="17537" class="l"><a href="#17537">17537: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">true</span>;
</span><span id="17538" class="l"><a href="#17538">17538: </a>        }
</span><span id="17539" class="l"><a href="#17539">17539: </a>
</span><span id="17540" class="l"><a href="#17540">17540: </a>        <span class="php-comment">/**
</span></span><span id="17541" class="l"><a href="#17541">17541: </a><span class="php-comment">         * Output a Table of Content Index (TOC).
</span></span><span id="17542" class="l"><a href="#17542">17542: </a><span class="php-comment">         * Before calling this method you have to open the page using the addTOCPage() method.
</span></span><span id="17543" class="l"><a href="#17543">17543: </a><span class="php-comment">         * After calling this method you have to call endTOCPage() to close the TOC page.
</span></span><span id="17544" class="l"><a href="#17544">17544: </a><span class="php-comment">         * You can override this method to achieve different styles.
</span></span><span id="17545" class="l"><a href="#17545">17545: </a><span class="php-comment">         * @param int $page page number where this TOC should be inserted (leave empty for current page).
</span></span><span id="17546" class="l"><a href="#17546">17546: </a><span class="php-comment">         * @param string $numbersfont set the font for page numbers (please use monospaced font for better alignment).
</span></span><span id="17547" class="l"><a href="#17547">17547: </a><span class="php-comment">         * @param string $filler string used to fill the space between text and page number.
</span></span><span id="17548" class="l"><a href="#17548">17548: </a><span class="php-comment">         * @param string $toc_name name to use for TOC bookmark.
</span></span><span id="17549" class="l"><a href="#17549">17549: </a><span class="php-comment">         * @access public
</span></span><span id="17550" class="l"><a href="#17550">17550: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="17551" class="l"><a href="#17551">17551: </a><span class="php-comment">         * @since 4.5.000 (2009-01-02)
</span></span><span id="17552" class="l"><a href="#17552">17552: </a><span class="php-comment">         * @see addTOCPage(), endTOCPage(), addHTMLTOC()
</span></span><span id="17553" class="l"><a href="#17553">17553: </a><span class="php-comment">         */</span>
</span><span id="17554" class="l"><a href="#17554">17554: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> addTOC(<span class="php-var">$page</span>=<span class="php-quote">''</span>, <span class="php-var">$numbersfont</span>=<span class="php-quote">''</span>, <span class="php-var">$filler</span>=<span class="php-quote">'.'</span>, <span class="php-var">$toc_name</span>=<span class="php-quote">'TOC'</span>) {
</span><span id="17555" class="l"><a href="#17555">17555: </a>            <span class="php-var">$fontsize</span> = <span class="php-var">$this</span>-&gt;FontSizePt;
</span><span id="17556" class="l"><a href="#17556">17556: </a>            <span class="php-var">$fontfamily</span> = <span class="php-var">$this</span>-&gt;FontFamily;
</span><span id="17557" class="l"><a href="#17557">17557: </a>            <span class="php-var">$fontstyle</span> = <span class="php-var">$this</span>-&gt;FontStyle;
</span><span id="17558" class="l"><a href="#17558">17558: </a>            <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;lMargin - <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="17559" class="l"><a href="#17559">17559: </a>            <span class="php-var">$spacer</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>)) * <span class="php-num">4</span>;
</span><span id="17560" class="l"><a href="#17560">17560: </a>            <span class="php-var">$page_first</span> = <span class="php-var">$this</span>-&gt;getPage();
</span><span id="17561" class="l"><a href="#17561">17561: </a>            <span class="php-var">$lmargin</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="17562" class="l"><a href="#17562">17562: </a>            <span class="php-var">$rmargin</span> = <span class="php-var">$this</span>-&gt;rMargin;
</span><span id="17563" class="l"><a href="#17563">17563: </a>            <span class="php-var">$x_start</span> = <span class="php-var">$this</span>-&gt;GetX();
</span><span id="17564" class="l"><a href="#17564">17564: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$numbersfont</span>)) {
</span><span id="17565" class="l"><a href="#17565">17565: </a>                <span class="php-var">$numbersfont</span> = <span class="php-var">$this</span>-&gt;default_monospaced_font;
</span><span id="17566" class="l"><a href="#17566">17566: </a>            }
</span><span id="17567" class="l"><a href="#17567">17567: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$filler</span>)) {
</span><span id="17568" class="l"><a href="#17568">17568: </a>                <span class="php-var">$filler</span> = <span class="php-quote">' '</span>;
</span><span id="17569" class="l"><a href="#17569">17569: </a>            }
</span><span id="17570" class="l"><a href="#17570">17570: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$page</span>)) {
</span><span id="17571" class="l"><a href="#17571">17571: </a>                <span class="php-var">$gap</span> = <span class="php-quote">' '</span>;
</span><span id="17572" class="l"><a href="#17572">17572: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17573" class="l"><a href="#17573">17573: </a>                <span class="php-var">$gap</span> = <span class="php-quote">''</span>;
</span><span id="17574" class="l"><a href="#17574">17574: </a>            }
</span><span id="17575" class="l"><a href="#17575">17575: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;outlines <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$outline</span>) {
</span><span id="17576" class="l"><a href="#17576">17576: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="17577" class="l"><a href="#17577">17577: </a>                    <span class="php-var">$aligntext</span> = <span class="php-quote">'R'</span>;
</span><span id="17578" class="l"><a href="#17578">17578: </a>                    <span class="php-var">$alignnum</span> = <span class="php-quote">'L'</span>;
</span><span id="17579" class="l"><a href="#17579">17579: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17580" class="l"><a href="#17580">17580: </a>                    <span class="php-var">$aligntext</span> = <span class="php-quote">'L'</span>;
</span><span id="17581" class="l"><a href="#17581">17581: </a>                    <span class="php-var">$alignnum</span> = <span class="php-quote">'R'</span>;
</span><span id="17582" class="l"><a href="#17582">17582: </a>                }
</span><span id="17583" class="l"><a href="#17583">17583: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$outline</span>[<span class="php-quote">'l'</span>] == <span class="php-num">0</span>) {
</span><span id="17584" class="l"><a href="#17584">17584: </a>                    <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$fontfamily</span>, <span class="php-var">$fontstyle</span>.<span class="php-quote">'B'</span>, <span class="php-var">$fontsize</span>);
</span><span id="17585" class="l"><a href="#17585">17585: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17586" class="l"><a href="#17586">17586: </a>                    <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$fontfamily</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span> - <span class="php-var">$outline</span>[<span class="php-quote">'l'</span>]);
</span><span id="17587" class="l"><a href="#17587">17587: </a>                }
</span><span id="17588" class="l"><a href="#17588">17588: </a>                <span class="php-var">$indent</span> = (<span class="php-var">$spacer</span> * <span class="php-var">$outline</span>[<span class="php-quote">'l'</span>]);
</span><span id="17589" class="l"><a href="#17589">17589: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="17590" class="l"><a href="#17590">17590: </a>                    <span class="php-var">$this</span>-&gt;rMargin += <span class="php-var">$indent</span>;
</span><span id="17591" class="l"><a href="#17591">17591: </a>                    <span class="php-var">$this</span>-&gt;x -= <span class="php-var">$indent</span>;
</span><span id="17592" class="l"><a href="#17592">17592: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17593" class="l"><a href="#17593">17593: </a>                    <span class="php-var">$this</span>-&gt;lMargin += <span class="php-var">$indent</span>;
</span><span id="17594" class="l"><a href="#17594">17594: </a>                    <span class="php-var">$this</span>-&gt;x += <span class="php-var">$indent</span>;
</span><span id="17595" class="l"><a href="#17595">17595: </a>                }
</span><span id="17596" class="l"><a href="#17596">17596: </a>                <span class="php-var">$link</span> = <span class="php-var">$this</span>-&gt;AddLink();
</span><span id="17597" class="l"><a href="#17597">17597: </a>                <span class="php-var">$this</span>-&gt;SetLink(<span class="php-var">$link</span>, <span class="php-num">0</span>, <span class="php-var">$outline</span>[<span class="php-quote">'p'</span>]);
</span><span id="17598" class="l"><a href="#17598">17598: </a>                <span class="php-comment">// write the text</span>
</span><span id="17599" class="l"><a href="#17599">17599: </a>                <span class="php-var">$this</span>-&gt;Write(<span class="php-num">0</span>, <span class="php-var">$outline</span>[<span class="php-quote">'t'</span>], <span class="php-var">$link</span>, <span class="php-num">0</span>, <span class="php-var">$aligntext</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-num">0</span>);
</span><span id="17600" class="l"><a href="#17600">17600: </a>                <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$numbersfont</span>, <span class="php-var">$fontstyle</span>, <span class="php-var">$fontsize</span>);
</span><span id="17601" class="l"><a href="#17601">17601: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$page</span>)) {
</span><span id="17602" class="l"><a href="#17602">17602: </a>                    <span class="php-var">$pagenum</span> = <span class="php-var">$outline</span>[<span class="php-quote">'p'</span>];
</span><span id="17603" class="l"><a href="#17603">17603: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17604" class="l"><a href="#17604">17604: </a>                    <span class="php-comment">// placemark to be replaced with the correct number</span>
</span><span id="17605" class="l"><a href="#17605">17605: </a>                    <span class="php-var">$pagenum</span> = <span class="php-quote">'{#'</span>.(<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>]).<span class="php-quote">'}'</span>;
</span><span id="17606" class="l"><a href="#17606">17606: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="17607" class="l"><a href="#17607">17607: </a>                        <span class="php-var">$pagenum</span> = <span class="php-quote">'{'</span>.<span class="php-var">$pagenum</span>.<span class="php-quote">'}'</span>;
</span><span id="17608" class="l"><a href="#17608">17608: </a>                    }
</span><span id="17609" class="l"><a href="#17609">17609: </a>                }
</span><span id="17610" class="l"><a href="#17610">17610: </a>                <span class="php-var">$numwidth</span> = <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$pagenum</span>);
</span><span id="17611" class="l"><a href="#17611">17611: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="17612" class="l"><a href="#17612">17612: </a>                    <span class="php-var">$tw</span> = <span class="php-var">$this</span>-&gt;x - <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="17613" class="l"><a href="#17613">17613: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17614" class="l"><a href="#17614">17614: </a>                    <span class="php-var">$tw</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$this</span>-&gt;x;
</span><span id="17615" class="l"><a href="#17615">17615: </a>                }
</span><span id="17616" class="l"><a href="#17616">17616: </a>                <span class="php-var">$fw</span> = <span class="php-var">$tw</span> - <span class="php-var">$numwidth</span> - <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-keyword2">chr</span>(<span class="php-num">32</span>));
</span><span id="17617" class="l"><a href="#17617">17617: </a>                <span class="php-var">$numfills</span> = <span class="php-keyword2">floor</span>(<span class="php-var">$fw</span> / <span class="php-var">$this</span>-&gt;GetStringWidth(<span class="php-var">$filler</span>));
</span><span id="17618" class="l"><a href="#17618">17618: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$numfills</span> &gt; <span class="php-num">0</span>) {
</span><span id="17619" class="l"><a href="#17619">17619: </a>                    <span class="php-var">$rowfill</span> = <span class="php-keyword2">str_repeat</span>(<span class="php-var">$filler</span>, <span class="php-var">$numfills</span>);
</span><span id="17620" class="l"><a href="#17620">17620: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17621" class="l"><a href="#17621">17621: </a>                    <span class="php-var">$rowfill</span> = <span class="php-quote">''</span>;
</span><span id="17622" class="l"><a href="#17622">17622: </a>                }
</span><span id="17623" class="l"><a href="#17623">17623: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="17624" class="l"><a href="#17624">17624: </a>                    <span class="php-var">$pagenum</span> = <span class="php-var">$pagenum</span>.<span class="php-var">$gap</span>.<span class="php-var">$rowfill</span>.<span class="php-quote">' '</span>;
</span><span id="17625" class="l"><a href="#17625">17625: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17626" class="l"><a href="#17626">17626: </a>                    <span class="php-var">$pagenum</span> = <span class="php-quote">' '</span>.<span class="php-var">$rowfill</span>.<span class="php-var">$gap</span>.<span class="php-var">$pagenum</span>;
</span><span id="17627" class="l"><a href="#17627">17627: </a>                }
</span><span id="17628" class="l"><a href="#17628">17628: </a>                <span class="php-comment">// write the number</span>
</span><span id="17629" class="l"><a href="#17629">17629: </a>                <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$tw</span>, <span class="php-num">0</span>, <span class="php-var">$pagenum</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-var">$alignnum</span>, <span class="php-num">0</span>, <span class="php-var">$link</span>, <span class="php-num">0</span>);
</span><span id="17630" class="l"><a href="#17630">17630: </a>                <span class="php-var">$this</span>-&gt;SetX(<span class="php-var">$x_start</span>);
</span><span id="17631" class="l"><a href="#17631">17631: </a>                <span class="php-var">$this</span>-&gt;lMargin = <span class="php-var">$lmargin</span>;
</span><span id="17632" class="l"><a href="#17632">17632: </a>                <span class="php-var">$this</span>-&gt;rMargin = <span class="php-var">$rmargin</span>;
</span><span id="17633" class="l"><a href="#17633">17633: </a>            }
</span><span id="17634" class="l"><a href="#17634">17634: </a>            <span class="php-var">$page_last</span> = <span class="php-var">$this</span>-&gt;getPage();
</span><span id="17635" class="l"><a href="#17635">17635: </a>            <span class="php-var">$numpages</span> = <span class="php-var">$page_last</span> - <span class="php-var">$page_first</span> + <span class="php-num">1</span>;
</span><span id="17636" class="l"><a href="#17636">17636: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$page</span>)) {
</span><span id="17637" class="l"><a href="#17637">17637: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$p</span> = <span class="php-var">$page_first</span>; <span class="php-var">$p</span> &lt;= <span class="php-var">$page_last</span>; ++<span class="php-var">$p</span>) {
</span><span id="17638" class="l"><a href="#17638">17638: </a>                    <span class="php-comment">// get page data</span>
</span><span id="17639" class="l"><a href="#17639">17639: </a>                    <span class="php-var">$temppage</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$p</span>);
</span><span id="17640" class="l"><a href="#17640">17640: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$n</span> = <span class="php-num">1</span>; <span class="php-var">$n</span> &lt;= <span class="php-var">$this</span>-&gt;numpages; ++<span class="php-var">$n</span>) {
</span><span id="17641" class="l"><a href="#17641">17641: </a>                        <span class="php-comment">// update page numbers</span>
</span><span id="17642" class="l"><a href="#17642">17642: </a>                        <span class="php-var">$k</span> = <span class="php-quote">'{#'</span>.<span class="php-var">$n</span>.<span class="php-quote">'}'</span>;
</span><span id="17643" class="l"><a href="#17643">17643: </a>                        <span class="php-var">$ku</span> = <span class="php-quote">'{'</span>.<span class="php-var">$k</span>.<span class="php-quote">'}'</span>;
</span><span id="17644" class="l"><a href="#17644">17644: </a>                        <span class="php-var">$alias_a</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$k</span>);
</span><span id="17645" class="l"><a href="#17645">17645: </a>                        <span class="php-var">$alias_au</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-quote">'{'</span>.<span class="php-var">$k</span>.<span class="php-quote">'}'</span>);
</span><span id="17646" class="l"><a href="#17646">17646: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="17647" class="l"><a href="#17647">17647: </a>                            <span class="php-var">$alias_b</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$k</span>));
</span><span id="17648" class="l"><a href="#17648">17648: </a>                            <span class="php-var">$alias_bu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$ku</span>));
</span><span id="17649" class="l"><a href="#17649">17649: </a>                            <span class="php-var">$alias_c</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$k</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="17650" class="l"><a href="#17650">17650: </a>                            <span class="php-var">$alias_cu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$ku</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="17651" class="l"><a href="#17651">17651: </a>                        }
</span><span id="17652" class="l"><a href="#17652">17652: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$n</span> &gt;= <span class="php-var">$page</span>) {
</span><span id="17653" class="l"><a href="#17653">17653: </a>                            <span class="php-var">$np</span> = <span class="php-var">$n</span> + <span class="php-var">$numpages</span>;
</span><span id="17654" class="l"><a href="#17654">17654: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="17655" class="l"><a href="#17655">17655: </a>                            <span class="php-var">$np</span> = <span class="php-var">$n</span>;
</span><span id="17656" class="l"><a href="#17656">17656: </a>                        }
</span><span id="17657" class="l"><a href="#17657">17657: </a>                        <span class="php-var">$ns</span> = <span class="php-var">$this</span>-&gt;formatTOCPageNumber(<span class="php-var">$np</span>);
</span><span id="17658" class="l"><a href="#17658">17658: </a>                        <span class="php-var">$nu</span> = <span class="php-var">$ns</span>;
</span><span id="17659" class="l"><a href="#17659">17659: </a>                        <span class="php-var">$sdiff</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$k</span>) - <span class="php-keyword2">strlen</span>(<span class="php-var">$ns</span>) - <span class="php-num">1</span>;
</span><span id="17660" class="l"><a href="#17660">17660: </a>                        <span class="php-var">$sdiffu</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$ku</span>) - <span class="php-keyword2">strlen</span>(<span class="php-var">$ns</span>) - <span class="php-num">1</span>;
</span><span id="17661" class="l"><a href="#17661">17661: </a>                        <span class="php-var">$sfill</span> = <span class="php-keyword2">str_repeat</span>(<span class="php-var">$filler</span>, <span class="php-var">$sdiff</span>);
</span><span id="17662" class="l"><a href="#17662">17662: </a>                        <span class="php-var">$sfillu</span> = <span class="php-keyword2">str_repeat</span>(<span class="php-var">$filler</span>, <span class="php-var">$sdiffu</span>);
</span><span id="17663" class="l"><a href="#17663">17663: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="17664" class="l"><a href="#17664">17664: </a>                            <span class="php-var">$ns</span> = <span class="php-var">$ns</span>.<span class="php-quote">' '</span>.<span class="php-var">$sfill</span>;
</span><span id="17665" class="l"><a href="#17665">17665: </a>                            <span class="php-var">$nu</span> = <span class="php-var">$nu</span>.<span class="php-quote">' '</span>.<span class="php-var">$sfillu</span>;
</span><span id="17666" class="l"><a href="#17666">17666: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="17667" class="l"><a href="#17667">17667: </a>                            <span class="php-var">$ns</span> = <span class="php-var">$sfill</span>.<span class="php-quote">' '</span>.<span class="php-var">$ns</span>;
</span><span id="17668" class="l"><a href="#17668">17668: </a>                            <span class="php-var">$nu</span> = <span class="php-var">$sfillu</span>.<span class="php-quote">' '</span>.<span class="php-var">$nu</span>;
</span><span id="17669" class="l"><a href="#17669">17669: </a>                        }
</span><span id="17670" class="l"><a href="#17670">17670: </a>                        <span class="php-var">$nu</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$nu</span>, <span class="php-keyword1">false</span>);
</span><span id="17671" class="l"><a href="#17671">17671: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_au</span>, <span class="php-var">$nu</span>, <span class="php-var">$temppage</span>);
</span><span id="17672" class="l"><a href="#17672">17672: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="17673" class="l"><a href="#17673">17673: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_bu</span>, <span class="php-var">$nu</span>, <span class="php-var">$temppage</span>);
</span><span id="17674" class="l"><a href="#17674">17674: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_cu</span>, <span class="php-var">$nu</span>, <span class="php-var">$temppage</span>);
</span><span id="17675" class="l"><a href="#17675">17675: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_b</span>, <span class="php-var">$ns</span>, <span class="php-var">$temppage</span>);
</span><span id="17676" class="l"><a href="#17676">17676: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_c</span>, <span class="php-var">$ns</span>, <span class="php-var">$temppage</span>);
</span><span id="17677" class="l"><a href="#17677">17677: </a>                        }
</span><span id="17678" class="l"><a href="#17678">17678: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_a</span>, <span class="php-var">$ns</span>, <span class="php-var">$temppage</span>);
</span><span id="17679" class="l"><a href="#17679">17679: </a>                    }
</span><span id="17680" class="l"><a href="#17680">17680: </a>                    <span class="php-comment">// save changes</span>
</span><span id="17681" class="l"><a href="#17681">17681: </a>                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$p</span>, <span class="php-var">$temppage</span>);
</span><span id="17682" class="l"><a href="#17682">17682: </a>                }
</span><span id="17683" class="l"><a href="#17683">17683: </a>                <span class="php-comment">// move pages</span>
</span><span id="17684" class="l"><a href="#17684">17684: </a>                <span class="php-var">$this</span>-&gt;Bookmark(<span class="php-var">$toc_name</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$page_first</span>);
</span><span id="17685" class="l"><a href="#17685">17685: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numpages</span>; ++<span class="php-var">$i</span>) {
</span><span id="17686" class="l"><a href="#17686">17686: </a>                    <span class="php-var">$this</span>-&gt;movePage(<span class="php-var">$page_last</span>, <span class="php-var">$page</span>);
</span><span id="17687" class="l"><a href="#17687">17687: </a>                }
</span><span id="17688" class="l"><a href="#17688">17688: </a>            }
</span><span id="17689" class="l"><a href="#17689">17689: </a>        }
</span><span id="17690" class="l"><a href="#17690">17690: </a>
</span><span id="17691" class="l"><a href="#17691">17691: </a>        <span class="php-comment">/**
</span></span><span id="17692" class="l"><a href="#17692">17692: </a><span class="php-comment">         * Output a Table Of Content Index (TOC) using HTML templates.
</span></span><span id="17693" class="l"><a href="#17693">17693: </a><span class="php-comment">         * Before calling this method you have to open the page using the addTOCPage() method.
</span></span><span id="17694" class="l"><a href="#17694">17694: </a><span class="php-comment">         * After calling this method you have to call endTOCPage() to close the TOC page.
</span></span><span id="17695" class="l"><a href="#17695">17695: </a><span class="php-comment">         * @param int $page page number where this TOC should be inserted (leave empty for current page).
</span></span><span id="17696" class="l"><a href="#17696">17696: </a><span class="php-comment">         * @param string $toc_name name to use for TOC bookmark.
</span></span><span id="17697" class="l"><a href="#17697">17697: </a><span class="php-comment">         * @param array $templates array of html templates. Use: #TOC_DESCRIPTION# for bookmark title, #TOC_PAGE_NUMBER# for page number.
</span></span><span id="17698" class="l"><a href="#17698">17698: </a><span class="php-comment">         * @parma boolean $correct_align if true correct the number alignment (numbers must be in monospaced font like courier and right aligned on LTR, or left aligned on RTL)
</span></span><span id="17699" class="l"><a href="#17699">17699: </a><span class="php-comment">         * @access public
</span></span><span id="17700" class="l"><a href="#17700">17700: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="17701" class="l"><a href="#17701">17701: </a><span class="php-comment">         * @since 5.0.001 (2010-05-06)
</span></span><span id="17702" class="l"><a href="#17702">17702: </a><span class="php-comment">         * @see addTOCPage(), endTOCPage(), addTOC()
</span></span><span id="17703" class="l"><a href="#17703">17703: </a><span class="php-comment">         */</span>
</span><span id="17704" class="l"><a href="#17704">17704: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> addHTMLTOC(<span class="php-var">$page</span>=<span class="php-quote">''</span>, <span class="php-var">$toc_name</span>=<span class="php-quote">'TOC'</span>, <span class="php-var">$templates</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$correct_align</span>=<span class="php-keyword1">true</span>) {
</span><span id="17705" class="l"><a href="#17705">17705: </a>            <span class="php-var">$prev_htmlLinkColorArray</span> = <span class="php-var">$this</span>-&gt;htmlLinkColorArray;
</span><span id="17706" class="l"><a href="#17706">17706: </a>            <span class="php-var">$prev_htmlLinkFontStyle</span> = <span class="php-var">$this</span>-&gt;htmlLinkFontStyle;
</span><span id="17707" class="l"><a href="#17707">17707: </a>            <span class="php-comment">// set new style for link</span>
</span><span id="17708" class="l"><a href="#17708">17708: </a>            <span class="php-var">$this</span>-&gt;htmlLinkColorArray = <span class="php-keyword1">array</span>();
</span><span id="17709" class="l"><a href="#17709">17709: </a>            <span class="php-var">$this</span>-&gt;htmlLinkFontStyle = <span class="php-quote">''</span>;
</span><span id="17710" class="l"><a href="#17710">17710: </a>            <span class="php-var">$page_first</span> = <span class="php-var">$this</span>-&gt;getPage();
</span><span id="17711" class="l"><a href="#17711">17711: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;outlines <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$outline</span>) {
</span><span id="17712" class="l"><a href="#17712">17712: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$page</span>)) {
</span><span id="17713" class="l"><a href="#17713">17713: </a>                    <span class="php-var">$pagenum</span> = <span class="php-var">$outline</span>[<span class="php-quote">'p'</span>];
</span><span id="17714" class="l"><a href="#17714">17714: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17715" class="l"><a href="#17715">17715: </a>                    <span class="php-comment">// placemark to be replaced with the correct number</span>
</span><span id="17716" class="l"><a href="#17716">17716: </a>                    <span class="php-var">$pagenum</span> = <span class="php-quote">'{#'</span>.(<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>]).<span class="php-quote">'}'</span>;
</span><span id="17717" class="l"><a href="#17717">17717: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'TrueTypeUnicode'</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$this</span>-&gt;CurrentFont[<span class="php-quote">'type'</span>] == <span class="php-quote">'cidfont0'</span>)) {
</span><span id="17718" class="l"><a href="#17718">17718: </a>                        <span class="php-var">$pagenum</span> = <span class="php-quote">'{'</span>.<span class="php-var">$pagenum</span>.<span class="php-quote">'}'</span>;
</span><span id="17719" class="l"><a href="#17719">17719: </a>                    }
</span><span id="17720" class="l"><a href="#17720">17720: </a>                }
</span><span id="17721" class="l"><a href="#17721">17721: </a>                <span class="php-comment">// get HTML template</span>
</span><span id="17722" class="l"><a href="#17722">17722: </a>                <span class="php-var">$row</span> = <span class="php-var">$templates</span>[<span class="php-var">$outline</span>[<span class="php-quote">'l'</span>]];
</span><span id="17723" class="l"><a href="#17723">17723: </a>                <span class="php-comment">// replace templates with current values</span>
</span><span id="17724" class="l"><a href="#17724">17724: </a>                <span class="php-var">$row</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'#TOC_DESCRIPTION#'</span>, <span class="php-var">$outline</span>[<span class="php-quote">'t'</span>], <span class="php-var">$row</span>);
</span><span id="17725" class="l"><a href="#17725">17725: </a>                <span class="php-var">$row</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'#TOC_PAGE_NUMBER#'</span>, <span class="php-var">$pagenum</span>, <span class="php-var">$row</span>);
</span><span id="17726" class="l"><a href="#17726">17726: </a>                <span class="php-comment">// add link to page</span>
</span><span id="17727" class="l"><a href="#17727">17727: </a>                <span class="php-var">$row</span> = <span class="php-quote">'&lt;a href=&quot;#'</span>.<span class="php-var">$outline</span>[<span class="php-quote">'p'</span>].<span class="php-quote">'&quot;&gt;'</span>.<span class="php-var">$row</span>.<span class="php-quote">'&lt;/a&gt;'</span>;
</span><span id="17728" class="l"><a href="#17728">17728: </a>                <span class="php-comment">// write bookmark entry</span>
</span><span id="17729" class="l"><a href="#17729">17729: </a>                <span class="php-var">$this</span>-&gt;writeHTML(<span class="php-var">$row</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">true</span>, <span class="php-keyword1">false</span>, <span class="php-quote">''</span>);
</span><span id="17730" class="l"><a href="#17730">17730: </a>            }
</span><span id="17731" class="l"><a href="#17731">17731: </a>            <span class="php-comment">// restore link styles</span>
</span><span id="17732" class="l"><a href="#17732">17732: </a>            <span class="php-var">$this</span>-&gt;htmlLinkColorArray = <span class="php-var">$prev_htmlLinkColorArray</span>;
</span><span id="17733" class="l"><a href="#17733">17733: </a>            <span class="php-var">$this</span>-&gt;htmlLinkFontStyle = <span class="php-var">$prev_htmlLinkFontStyle</span>;
</span><span id="17734" class="l"><a href="#17734">17734: </a>            <span class="php-comment">// move TOC page and replace numbers</span>
</span><span id="17735" class="l"><a href="#17735">17735: </a>            <span class="php-var">$page_last</span> = <span class="php-var">$this</span>-&gt;getPage();
</span><span id="17736" class="l"><a href="#17736">17736: </a>            <span class="php-var">$numpages</span> = <span class="php-var">$page_last</span> - <span class="php-var">$page_first</span> + <span class="php-num">1</span>;
</span><span id="17737" class="l"><a href="#17737">17737: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$page</span>)) {
</span><span id="17738" class="l"><a href="#17738">17738: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$p</span> = <span class="php-var">$page_first</span>; <span class="php-var">$p</span> &lt;= <span class="php-var">$page_last</span>; ++<span class="php-var">$p</span>) {
</span><span id="17739" class="l"><a href="#17739">17739: </a>                    <span class="php-comment">// get page data</span>
</span><span id="17740" class="l"><a href="#17740">17740: </a>                    <span class="php-var">$temppage</span> = <span class="php-var">$this</span>-&gt;getPageBuffer(<span class="php-var">$p</span>);
</span><span id="17741" class="l"><a href="#17741">17741: </a>                    <span class="php-keyword1">for</span> (<span class="php-var">$n</span> = <span class="php-num">1</span>; <span class="php-var">$n</span> &lt;= <span class="php-var">$this</span>-&gt;numpages; ++<span class="php-var">$n</span>) {
</span><span id="17742" class="l"><a href="#17742">17742: </a>                        <span class="php-comment">// update page numbers</span>
</span><span id="17743" class="l"><a href="#17743">17743: </a>                        <span class="php-var">$k</span> = <span class="php-quote">'{#'</span>.<span class="php-var">$n</span>.<span class="php-quote">'}'</span>;
</span><span id="17744" class="l"><a href="#17744">17744: </a>                        <span class="php-var">$ku</span> = <span class="php-quote">'{'</span>.<span class="php-var">$k</span>.<span class="php-quote">'}'</span>;
</span><span id="17745" class="l"><a href="#17745">17745: </a>                        <span class="php-var">$alias_a</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$k</span>);
</span><span id="17746" class="l"><a href="#17746">17746: </a>                        <span class="php-var">$alias_au</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-quote">'{'</span>.<span class="php-var">$k</span>.<span class="php-quote">'}'</span>);
</span><span id="17747" class="l"><a href="#17747">17747: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="17748" class="l"><a href="#17748">17748: </a>                            <span class="php-var">$alias_b</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$k</span>));
</span><span id="17749" class="l"><a href="#17749">17749: </a>                            <span class="php-var">$alias_bu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;UTF8ToLatin1(<span class="php-var">$ku</span>));
</span><span id="17750" class="l"><a href="#17750">17750: </a>                            <span class="php-var">$alias_c</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$k</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="17751" class="l"><a href="#17751">17751: </a>                            <span class="php-var">$alias_cu</span> = <span class="php-var">$this</span>-&gt;_escape(<span class="php-var">$this</span>-&gt;utf8StrRev(<span class="php-var">$ku</span>, <span class="php-keyword1">false</span>, <span class="php-var">$this</span>-&gt;tmprtl));
</span><span id="17752" class="l"><a href="#17752">17752: </a>                        }
</span><span id="17753" class="l"><a href="#17753">17753: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$n</span> &gt;= <span class="php-var">$page</span>) {
</span><span id="17754" class="l"><a href="#17754">17754: </a>                            <span class="php-var">$np</span> = <span class="php-var">$n</span> + <span class="php-var">$numpages</span>;
</span><span id="17755" class="l"><a href="#17755">17755: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="17756" class="l"><a href="#17756">17756: </a>                            <span class="php-var">$np</span> = <span class="php-var">$n</span>;
</span><span id="17757" class="l"><a href="#17757">17757: </a>                        }
</span><span id="17758" class="l"><a href="#17758">17758: </a>                        <span class="php-var">$ns</span> = <span class="php-var">$this</span>-&gt;formatTOCPageNumber(<span class="php-var">$np</span>);
</span><span id="17759" class="l"><a href="#17759">17759: </a>                        <span class="php-var">$nu</span> = <span class="php-var">$ns</span>;
</span><span id="17760" class="l"><a href="#17760">17760: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$correct_align</span>) {
</span><span id="17761" class="l"><a href="#17761">17761: </a>                            <span class="php-var">$sdiff</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$k</span>) - <span class="php-keyword2">strlen</span>(<span class="php-var">$ns</span>);
</span><span id="17762" class="l"><a href="#17762">17762: </a>                            <span class="php-var">$sdiffu</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$ku</span>) - <span class="php-keyword2">strlen</span>(<span class="php-var">$ns</span>);
</span><span id="17763" class="l"><a href="#17763">17763: </a>                            <span class="php-var">$sfill</span> = <span class="php-keyword2">str_repeat</span>(<span class="php-quote">' '</span>, <span class="php-var">$sdiff</span>);
</span><span id="17764" class="l"><a href="#17764">17764: </a>                            <span class="php-var">$sfillu</span> = <span class="php-keyword2">str_repeat</span>(<span class="php-quote">' '</span>, <span class="php-var">$sdiffu</span>);
</span><span id="17765" class="l"><a href="#17765">17765: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="17766" class="l"><a href="#17766">17766: </a>                                <span class="php-var">$ns</span> = <span class="php-var">$ns</span>.<span class="php-var">$sfill</span>;
</span><span id="17767" class="l"><a href="#17767">17767: </a>                                <span class="php-var">$nu</span> = <span class="php-var">$nu</span>.<span class="php-var">$sfillu</span>;
</span><span id="17768" class="l"><a href="#17768">17768: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="17769" class="l"><a href="#17769">17769: </a>                                <span class="php-var">$ns</span> = <span class="php-var">$sfill</span>.<span class="php-var">$ns</span>;
</span><span id="17770" class="l"><a href="#17770">17770: </a>                                <span class="php-var">$nu</span> = <span class="php-var">$sfillu</span>.<span class="php-var">$nu</span>;
</span><span id="17771" class="l"><a href="#17771">17771: </a>                            }
</span><span id="17772" class="l"><a href="#17772">17772: </a>                        }
</span><span id="17773" class="l"><a href="#17773">17773: </a>                        <span class="php-var">$nu</span> = <span class="php-var">$this</span>-&gt;UTF8ToUTF16BE(<span class="php-var">$nu</span>, <span class="php-keyword1">false</span>);
</span><span id="17774" class="l"><a href="#17774">17774: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_au</span>, <span class="php-var">$nu</span>, <span class="php-var">$temppage</span>);
</span><span id="17775" class="l"><a href="#17775">17775: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;isunicode) {
</span><span id="17776" class="l"><a href="#17776">17776: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_bu</span>, <span class="php-var">$nu</span>, <span class="php-var">$temppage</span>);
</span><span id="17777" class="l"><a href="#17777">17777: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_cu</span>, <span class="php-var">$nu</span>, <span class="php-var">$temppage</span>);
</span><span id="17778" class="l"><a href="#17778">17778: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_b</span>, <span class="php-var">$ns</span>, <span class="php-var">$temppage</span>);
</span><span id="17779" class="l"><a href="#17779">17779: </a>                            <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_c</span>, <span class="php-var">$ns</span>, <span class="php-var">$temppage</span>);
</span><span id="17780" class="l"><a href="#17780">17780: </a>                        }
</span><span id="17781" class="l"><a href="#17781">17781: </a>                        <span class="php-var">$temppage</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$alias_a</span>, <span class="php-var">$ns</span>, <span class="php-var">$temppage</span>);
</span><span id="17782" class="l"><a href="#17782">17782: </a>                    }
</span><span id="17783" class="l"><a href="#17783">17783: </a>                    <span class="php-comment">// save changes</span>
</span><span id="17784" class="l"><a href="#17784">17784: </a>                    <span class="php-var">$this</span>-&gt;setPageBuffer(<span class="php-var">$p</span>, <span class="php-var">$temppage</span>);
</span><span id="17785" class="l"><a href="#17785">17785: </a>                }
</span><span id="17786" class="l"><a href="#17786">17786: </a>                <span class="php-comment">// move pages</span>
</span><span id="17787" class="l"><a href="#17787">17787: </a>                <span class="php-var">$this</span>-&gt;Bookmark(<span class="php-var">$toc_name</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$page_first</span>);
</span><span id="17788" class="l"><a href="#17788">17788: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numpages</span>; ++<span class="php-var">$i</span>) {
</span><span id="17789" class="l"><a href="#17789">17789: </a>                    <span class="php-var">$this</span>-&gt;movePage(<span class="php-var">$page_last</span>, <span class="php-var">$page</span>);
</span><span id="17790" class="l"><a href="#17790">17790: </a>                }
</span><span id="17791" class="l"><a href="#17791">17791: </a>            }
</span><span id="17792" class="l"><a href="#17792">17792: </a>        }
</span><span id="17793" class="l"><a href="#17793">17793: </a>
</span><span id="17794" class="l"><a href="#17794">17794: </a>        <span class="php-comment">/**
</span></span><span id="17795" class="l"><a href="#17795">17795: </a><span class="php-comment">         * Stores a copy of the current TCPDF object used for undo operation.
</span></span><span id="17796" class="l"><a href="#17796">17796: </a><span class="php-comment">         * @access public
</span></span><span id="17797" class="l"><a href="#17797">17797: </a><span class="php-comment">         * @since 4.5.029 (2009-03-19)
</span></span><span id="17798" class="l"><a href="#17798">17798: </a><span class="php-comment">         */</span>
</span><span id="17799" class="l"><a href="#17799">17799: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> startTransaction() {
</span><span id="17800" class="l"><a href="#17800">17800: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;objcopy)) {
</span><span id="17801" class="l"><a href="#17801">17801: </a>                <span class="php-comment">// remove previous copy</span>
</span><span id="17802" class="l"><a href="#17802">17802: </a>                <span class="php-var">$this</span>-&gt;commitTransaction();
</span><span id="17803" class="l"><a href="#17803">17803: </a>            }
</span><span id="17804" class="l"><a href="#17804">17804: </a>            <span class="php-comment">// record current page number and Y position</span>
</span><span id="17805" class="l"><a href="#17805">17805: </a>            <span class="php-var">$this</span>-&gt;start_transaction_page = <span class="php-var">$this</span>-&gt;page;
</span><span id="17806" class="l"><a href="#17806">17806: </a>            <span class="php-var">$this</span>-&gt;start_transaction_y = <span class="php-var">$this</span>-&gt;y;
</span><span id="17807" class="l"><a href="#17807">17807: </a>            <span class="php-comment">// clone current object</span>
</span><span id="17808" class="l"><a href="#17808">17808: </a>            <span class="php-var">$this</span>-&gt;objcopy = <span class="php-var">$this</span>-&gt;objclone(<span class="php-var">$this</span>);
</span><span id="17809" class="l"><a href="#17809">17809: </a>        }
</span><span id="17810" class="l"><a href="#17810">17810: </a>
</span><span id="17811" class="l"><a href="#17811">17811: </a>        <span class="php-comment">/**
</span></span><span id="17812" class="l"><a href="#17812">17812: </a><span class="php-comment">         * Delete the copy of the current TCPDF object used for undo operation.
</span></span><span id="17813" class="l"><a href="#17813">17813: </a><span class="php-comment">         * @access public
</span></span><span id="17814" class="l"><a href="#17814">17814: </a><span class="php-comment">         * @since 4.5.029 (2009-03-19)
</span></span><span id="17815" class="l"><a href="#17815">17815: </a><span class="php-comment">         */</span>
</span><span id="17816" class="l"><a href="#17816">17816: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> commitTransaction() {
</span><span id="17817" class="l"><a href="#17817">17817: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;objcopy)) {
</span><span id="17818" class="l"><a href="#17818">17818: </a>                <span class="php-var">$this</span>-&gt;objcopy-&gt;_destroy(<span class="php-keyword1">true</span>, <span class="php-keyword1">true</span>);
</span><span id="17819" class="l"><a href="#17819">17819: </a>                <span class="php-keyword1">unset</span>(<span class="php-var">$this</span>-&gt;objcopy);
</span><span id="17820" class="l"><a href="#17820">17820: </a>            }
</span><span id="17821" class="l"><a href="#17821">17821: </a>        }
</span><span id="17822" class="l"><a href="#17822">17822: </a>
</span><span id="17823" class="l"><a href="#17823">17823: </a>        <span class="php-comment">/**
</span></span><span id="17824" class="l"><a href="#17824">17824: </a><span class="php-comment">         * This method allows to undo the latest transaction by returning the latest saved TCPDF object with startTransaction().
</span></span><span id="17825" class="l"><a href="#17825">17825: </a><span class="php-comment">         * @param boolean $self if true restores current class object to previous state without the need of reassignment via the returned value.
</span></span><span id="17826" class="l"><a href="#17826">17826: </a><span class="php-comment">         * @return TCPDF object.
</span></span><span id="17827" class="l"><a href="#17827">17827: </a><span class="php-comment">         * @access public
</span></span><span id="17828" class="l"><a href="#17828">17828: </a><span class="php-comment">         * @since 4.5.029 (2009-03-19)
</span></span><span id="17829" class="l"><a href="#17829">17829: </a><span class="php-comment">         */</span>
</span><span id="17830" class="l"><a href="#17830">17830: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> rollbackTransaction(<span class="php-var">$self</span>=<span class="php-keyword1">false</span>) {
</span><span id="17831" class="l"><a href="#17831">17831: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;objcopy)) {
</span><span id="17832" class="l"><a href="#17832">17832: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$this</span>-&gt;objcopy-&gt;diskcache) <span class="php-keyword1">AND</span> <span class="php-var">$this</span>-&gt;objcopy-&gt;diskcache) {
</span><span id="17833" class="l"><a href="#17833">17833: </a>                    <span class="php-comment">// truncate files to previous values</span>
</span><span id="17834" class="l"><a href="#17834">17834: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$this</span>-&gt;objcopy-&gt;cache_file_length <span class="php-keyword1">as</span> <span class="php-var">$file</span> =&gt; <span class="php-var">$length</span>) {
</span><span id="17835" class="l"><a href="#17835">17835: </a>                        <span class="php-var">$file</span> = <span class="php-keyword2">substr</span>(<span class="php-var">$file</span>, <span class="php-num">1</span>);
</span><span id="17836" class="l"><a href="#17836">17836: </a>                        <span class="php-var">$handle</span> = <span class="php-keyword2">fopen</span>(<span class="php-var">$file</span>, <span class="php-quote">'r+'</span>);
</span><span id="17837" class="l"><a href="#17837">17837: </a>                        <span class="php-keyword2">ftruncate</span>(<span class="php-var">$handle</span>, <span class="php-var">$length</span>);
</span><span id="17838" class="l"><a href="#17838">17838: </a>                    }
</span><span id="17839" class="l"><a href="#17839">17839: </a>                }
</span><span id="17840" class="l"><a href="#17840">17840: </a>                <span class="php-var">$this</span>-&gt;_destroy(<span class="php-keyword1">true</span>, <span class="php-keyword1">true</span>);
</span><span id="17841" class="l"><a href="#17841">17841: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$self</span>) {
</span><span id="17842" class="l"><a href="#17842">17842: </a>                    <span class="php-var">$objvars</span> = <span class="php-keyword2">get_object_vars</span>(<span class="php-var">$this</span>-&gt;objcopy);
</span><span id="17843" class="l"><a href="#17843">17843: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$objvars</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$value</span>) {
</span><span id="17844" class="l"><a href="#17844">17844: </a>                        <span class="php-var">$this</span>-&gt;<span class="php-var">$key</span> = <span class="php-var">$value</span>;
</span><span id="17845" class="l"><a href="#17845">17845: </a>                    }
</span><span id="17846" class="l"><a href="#17846">17846: </a>                }
</span><span id="17847" class="l"><a href="#17847">17847: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;objcopy;
</span><span id="17848" class="l"><a href="#17848">17848: </a>            }
</span><span id="17849" class="l"><a href="#17849">17849: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>;
</span><span id="17850" class="l"><a href="#17850">17850: </a>        }
</span><span id="17851" class="l"><a href="#17851">17851: </a>
</span><span id="17852" class="l"><a href="#17852">17852: </a>        <span class="php-comment">/**
</span></span><span id="17853" class="l"><a href="#17853">17853: </a><span class="php-comment">         * Creates a copy of a class object
</span></span><span id="17854" class="l"><a href="#17854">17854: </a><span class="php-comment">         * @param object $object class object to be cloned
</span></span><span id="17855" class="l"><a href="#17855">17855: </a><span class="php-comment">         * @return cloned object
</span></span><span id="17856" class="l"><a href="#17856">17856: </a><span class="php-comment">         * @access public
</span></span><span id="17857" class="l"><a href="#17857">17857: </a><span class="php-comment">         * @since 4.5.029 (2009-03-19)
</span></span><span id="17858" class="l"><a href="#17858">17858: </a><span class="php-comment">         */</span>
</span><span id="17859" class="l"><a href="#17859">17859: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> objclone(<span class="php-var">$object</span>) {
</span><span id="17860" class="l"><a href="#17860">17860: </a>            <span class="php-keyword1">return</span> @<span class="php-keyword1">clone</span>(<span class="php-var">$object</span>);
</span><span id="17861" class="l"><a href="#17861">17861: </a>        }
</span><span id="17862" class="l"><a href="#17862">17862: </a>
</span><span id="17863" class="l"><a href="#17863">17863: </a>        <span class="php-comment">/**
</span></span><span id="17864" class="l"><a href="#17864">17864: </a><span class="php-comment">         * Determine whether a string is empty.
</span></span><span id="17865" class="l"><a href="#17865">17865: </a><span class="php-comment">         * @param string $str string to be checked
</span></span><span id="17866" class="l"><a href="#17866">17866: </a><span class="php-comment">         * @return boolean true if string is empty
</span></span><span id="17867" class="l"><a href="#17867">17867: </a><span class="php-comment">         * @access public
</span></span><span id="17868" class="l"><a href="#17868">17868: </a><span class="php-comment">         * @since 4.5.044 (2009-04-16)
</span></span><span id="17869" class="l"><a href="#17869">17869: </a><span class="php-comment">         */</span>
</span><span id="17870" class="l"><a href="#17870">17870: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> empty_string(<span class="php-var">$str</span>) {
</span><span id="17871" class="l"><a href="#17871">17871: </a>            <span class="php-keyword1">return</span> (<span class="php-keyword2">is_null</span>(<span class="php-var">$str</span>) <span class="php-keyword1">OR</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$str</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">strlen</span>(<span class="php-var">$str</span>) == <span class="php-num">0</span>)));
</span><span id="17872" class="l"><a href="#17872">17872: </a>        }
</span><span id="17873" class="l"><a href="#17873">17873: </a>
</span><span id="17874" class="l"><a href="#17874">17874: </a>        <span class="php-comment">/**
</span></span><span id="17875" class="l"><a href="#17875">17875: </a><span class="php-comment">         * Find position of last occurrence of a substring in a string
</span></span><span id="17876" class="l"><a href="#17876">17876: </a><span class="php-comment">         * @param string $haystack The string to search in.
</span></span><span id="17877" class="l"><a href="#17877">17877: </a><span class="php-comment">         * @param string $needle substring to search.
</span></span><span id="17878" class="l"><a href="#17878">17878: </a><span class="php-comment">         * @param int $offset May be specified to begin searching an arbitrary number of characters into the string.
</span></span><span id="17879" class="l"><a href="#17879">17879: </a><span class="php-comment">         * @return Returns the position where the needle exists. Returns FALSE if the needle was not found.
</span></span><span id="17880" class="l"><a href="#17880">17880: </a><span class="php-comment">         * @access public
</span></span><span id="17881" class="l"><a href="#17881">17881: </a><span class="php-comment">         * @since 4.8.038 (2010-03-13)
</span></span><span id="17882" class="l"><a href="#17882">17882: </a><span class="php-comment">         */</span>
</span><span id="17883" class="l"><a href="#17883">17883: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> revstrpos(<span class="php-var">$haystack</span>, <span class="php-var">$needle</span>, <span class="php-var">$offset</span> = <span class="php-num">0</span>) {
</span><span id="17884" class="l"><a href="#17884">17884: </a>            <span class="php-var">$length</span> = <span class="php-keyword2">strlen</span>(<span class="php-var">$haystack</span>);
</span><span id="17885" class="l"><a href="#17885">17885: </a>            <span class="php-var">$offset</span> = (<span class="php-var">$offset</span> &gt; <span class="php-num">0</span>)?(<span class="php-var">$length</span> - <span class="php-var">$offset</span>):<span class="php-keyword2">abs</span>(<span class="php-var">$offset</span>);
</span><span id="17886" class="l"><a href="#17886">17886: </a>            <span class="php-var">$pos</span> = <span class="php-keyword2">strpos</span>(<span class="php-keyword2">strrev</span>(<span class="php-var">$haystack</span>), <span class="php-keyword2">strrev</span>(<span class="php-var">$needle</span>), <span class="php-var">$offset</span>);
</span><span id="17887" class="l"><a href="#17887">17887: </a>            <span class="php-keyword1">return</span> (<span class="php-var">$pos</span> === <span class="php-keyword1">false</span>)?<span class="php-keyword1">false</span>:(<span class="php-var">$length</span> - <span class="php-var">$pos</span> - <span class="php-keyword2">strlen</span>(<span class="php-var">$needle</span>));
</span><span id="17888" class="l"><a href="#17888">17888: </a>        }
</span><span id="17889" class="l"><a href="#17889">17889: </a>
</span><span id="17890" class="l"><a href="#17890">17890: </a>        <span class="php-comment">// --- MULTI COLUMNS METHODS -----------------------</span>
</span><span id="17891" class="l"><a href="#17891">17891: </a>
</span><span id="17892" class="l"><a href="#17892">17892: </a>        <span class="php-comment">/**
</span></span><span id="17893" class="l"><a href="#17893">17893: </a><span class="php-comment">         * Set multiple columns of the same size
</span></span><span id="17894" class="l"><a href="#17894">17894: </a><span class="php-comment">         * @param int $numcols number of columns (set to zero to disable columns mode)
</span></span><span id="17895" class="l"><a href="#17895">17895: </a><span class="php-comment">         * @param int $width column width
</span></span><span id="17896" class="l"><a href="#17896">17896: </a><span class="php-comment">         * @param int $y column starting Y position (leave empty for current Y position)
</span></span><span id="17897" class="l"><a href="#17897">17897: </a><span class="php-comment">         * @access public
</span></span><span id="17898" class="l"><a href="#17898">17898: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="17899" class="l"><a href="#17899">17899: </a><span class="php-comment">         */</span>
</span><span id="17900" class="l"><a href="#17900">17900: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setEqualColumns(<span class="php-var">$numcols</span>=<span class="php-num">0</span>, <span class="php-var">$width</span>=<span class="php-num">0</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>) {
</span><span id="17901" class="l"><a href="#17901">17901: </a>            <span class="php-var">$this</span>-&gt;columns = <span class="php-keyword1">array</span>();
</span><span id="17902" class="l"><a href="#17902">17902: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$numcols</span> &lt; <span class="php-num">2</span>) {
</span><span id="17903" class="l"><a href="#17903">17903: </a>                <span class="php-var">$numcols</span> = <span class="php-num">0</span>;
</span><span id="17904" class="l"><a href="#17904">17904: </a>                <span class="php-var">$this</span>-&gt;columns = <span class="php-keyword1">array</span>();
</span><span id="17905" class="l"><a href="#17905">17905: </a>            } <span class="php-keyword1">else</span> {
</span><span id="17906" class="l"><a href="#17906">17906: </a>                <span class="php-comment">// maximum column width</span>
</span><span id="17907" class="l"><a href="#17907">17907: </a>                <span class="php-var">$maxwidth</span> = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;original_lMargin - <span class="php-var">$this</span>-&gt;original_rMargin) / <span class="php-var">$numcols</span>;
</span><span id="17908" class="l"><a href="#17908">17908: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$width</span> &gt; <span class="php-var">$maxwidth</span>) {
</span><span id="17909" class="l"><a href="#17909">17909: </a>                    <span class="php-var">$width</span> = <span class="php-var">$maxwidth</span>;
</span><span id="17910" class="l"><a href="#17910">17910: </a>                }
</span><span id="17911" class="l"><a href="#17911">17911: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$y</span>)) {
</span><span id="17912" class="l"><a href="#17912">17912: </a>                    <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="17913" class="l"><a href="#17913">17913: </a>                }
</span><span id="17914" class="l"><a href="#17914">17914: </a>                <span class="php-comment">// space between columns</span>
</span><span id="17915" class="l"><a href="#17915">17915: </a>                <span class="php-var">$space</span> = ((<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;original_lMargin - <span class="php-var">$this</span>-&gt;original_rMargin - (<span class="php-var">$numcols</span> * <span class="php-var">$width</span>)) / (<span class="php-var">$numcols</span> - <span class="php-num">1</span>));
</span><span id="17916" class="l"><a href="#17916">17916: </a>                <span class="php-comment">// fill the columns array (with, space, starting Y position)</span>
</span><span id="17917" class="l"><a href="#17917">17917: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-num">0</span>; <span class="php-var">$i</span> &lt; <span class="php-var">$numcols</span>; ++<span class="php-var">$i</span>) {
</span><span id="17918" class="l"><a href="#17918">17918: </a>                    <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$i</span>] = <span class="php-keyword1">array</span>(<span class="php-quote">'w'</span> =&gt; <span class="php-var">$width</span>, <span class="php-quote">'s'</span> =&gt; <span class="php-var">$space</span>, <span class="php-quote">'y'</span> =&gt; <span class="php-var">$y</span>);
</span><span id="17919" class="l"><a href="#17919">17919: </a>                }
</span><span id="17920" class="l"><a href="#17920">17920: </a>            }
</span><span id="17921" class="l"><a href="#17921">17921: </a>            <span class="php-var">$this</span>-&gt;num_columns = <span class="php-var">$numcols</span>;
</span><span id="17922" class="l"><a href="#17922">17922: </a>            <span class="php-var">$this</span>-&gt;current_column = <span class="php-num">0</span>;
</span><span id="17923" class="l"><a href="#17923">17923: </a>            <span class="php-var">$this</span>-&gt;column_start_page = <span class="php-var">$this</span>-&gt;page;
</span><span id="17924" class="l"><a href="#17924">17924: </a>        }
</span><span id="17925" class="l"><a href="#17925">17925: </a>
</span><span id="17926" class="l"><a href="#17926">17926: </a>        <span class="php-comment">/**
</span></span><span id="17927" class="l"><a href="#17927">17927: </a><span class="php-comment">         * Set columns array.
</span></span><span id="17928" class="l"><a href="#17928">17928: </a><span class="php-comment">         * Each column is represented by and array with the following keys: (w = width, s = space between columns, y = column top position).
</span></span><span id="17929" class="l"><a href="#17929">17929: </a><span class="php-comment">         * @param array $columns
</span></span><span id="17930" class="l"><a href="#17930">17930: </a><span class="php-comment">         * @access public
</span></span><span id="17931" class="l"><a href="#17931">17931: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="17932" class="l"><a href="#17932">17932: </a><span class="php-comment">         */</span>
</span><span id="17933" class="l"><a href="#17933">17933: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setColumnsArray(<span class="php-var">$columns</span>) {
</span><span id="17934" class="l"><a href="#17934">17934: </a>            <span class="php-var">$this</span>-&gt;columns = <span class="php-var">$columns</span>;
</span><span id="17935" class="l"><a href="#17935">17935: </a>            <span class="php-var">$this</span>-&gt;num_columns = <span class="php-keyword2">count</span>(<span class="php-var">$columns</span>);
</span><span id="17936" class="l"><a href="#17936">17936: </a>            <span class="php-var">$this</span>-&gt;current_column = <span class="php-num">0</span>;
</span><span id="17937" class="l"><a href="#17937">17937: </a>            <span class="php-var">$this</span>-&gt;column_start_page = <span class="php-var">$this</span>-&gt;page;
</span><span id="17938" class="l"><a href="#17938">17938: </a>        }
</span><span id="17939" class="l"><a href="#17939">17939: </a>
</span><span id="17940" class="l"><a href="#17940">17940: </a>        <span class="php-comment">/**
</span></span><span id="17941" class="l"><a href="#17941">17941: </a><span class="php-comment">         * Set position at a given column
</span></span><span id="17942" class="l"><a href="#17942">17942: </a><span class="php-comment">         * @param int $col column number (from 0 to getNumberOfColumns()-1); empty string = current column.
</span></span><span id="17943" class="l"><a href="#17943">17943: </a><span class="php-comment">         * @access public
</span></span><span id="17944" class="l"><a href="#17944">17944: </a><span class="php-comment">         * @since 4.9.001 (2010-03-28)
</span></span><span id="17945" class="l"><a href="#17945">17945: </a><span class="php-comment">         */</span>
</span><span id="17946" class="l"><a href="#17946">17946: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> selectColumn(<span class="php-var">$col</span>=<span class="php-quote">''</span>) {
</span><span id="17947" class="l"><a href="#17947">17947: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_string</span>(<span class="php-var">$col</span>)) {
</span><span id="17948" class="l"><a href="#17948">17948: </a>                <span class="php-var">$col</span> = <span class="php-var">$this</span>-&gt;current_column;
</span><span id="17949" class="l"><a href="#17949">17949: </a>            } <span class="php-keyword1">elseif</span>(<span class="php-var">$col</span> &gt;= <span class="php-var">$this</span>-&gt;num_columns) {
</span><span id="17950" class="l"><a href="#17950">17950: </a>                <span class="php-var">$col</span> = <span class="php-num">0</span>;
</span><span id="17951" class="l"><a href="#17951">17951: </a>            }
</span><span id="17952" class="l"><a href="#17952">17952: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;num_columns &gt; <span class="php-num">1</span>) {
</span><span id="17953" class="l"><a href="#17953">17953: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$col</span> != <span class="php-var">$this</span>-&gt;current_column) {
</span><span id="17954" class="l"><a href="#17954">17954: </a>                    <span class="php-comment">// move pointer at column top on the first page</span>
</span><span id="17955" class="l"><a href="#17955">17955: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;column_start_page == <span class="php-var">$this</span>-&gt;page) {
</span><span id="17956" class="l"><a href="#17956">17956: </a>                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'y'</span>];
</span><span id="17957" class="l"><a href="#17957">17957: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="17958" class="l"><a href="#17958">17958: </a>                        <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;tMargin;
</span><span id="17959" class="l"><a href="#17959">17959: </a>                    }
</span><span id="17960" class="l"><a href="#17960">17960: </a>                }
</span><span id="17961" class="l"><a href="#17961">17961: </a>                <span class="php-comment">// set X position of the current column by case</span>
</span><span id="17962" class="l"><a href="#17962">17962: </a>                <span class="php-var">$listindent</span> = (<span class="php-var">$this</span>-&gt;listindentlevel * <span class="php-var">$this</span>-&gt;listindent);
</span><span id="17963" class="l"><a href="#17963">17963: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="17964" class="l"><a href="#17964">17964: </a>                    <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;original_rMargin - (<span class="php-var">$col</span> * (<span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'w'</span>] + <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'s'</span>]));
</span><span id="17965" class="l"><a href="#17965">17965: </a>                    <span class="php-var">$this</span>-&gt;SetRightMargin(<span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> + <span class="php-var">$listindent</span>);
</span><span id="17966" class="l"><a href="#17966">17966: </a>                    <span class="php-var">$this</span>-&gt;SetLeftMargin(<span class="php-var">$x</span> - <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'w'</span>]);
</span><span id="17967" class="l"><a href="#17967">17967: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$x</span> - <span class="php-var">$listindent</span>;
</span><span id="17968" class="l"><a href="#17968">17968: </a>                } <span class="php-keyword1">else</span> {
</span><span id="17969" class="l"><a href="#17969">17969: </a>                    <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;original_lMargin + (<span class="php-var">$col</span> * (<span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'w'</span>] + <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'s'</span>]));
</span><span id="17970" class="l"><a href="#17970">17970: </a>                    <span class="php-var">$this</span>-&gt;SetLeftMargin(<span class="php-var">$x</span> + <span class="php-var">$listindent</span>);
</span><span id="17971" class="l"><a href="#17971">17971: </a>                    <span class="php-var">$this</span>-&gt;SetRightMargin(<span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> - <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'w'</span>]);
</span><span id="17972" class="l"><a href="#17972">17972: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$x</span> + <span class="php-var">$listindent</span>;
</span><span id="17973" class="l"><a href="#17973">17973: </a>                }
</span><span id="17974" class="l"><a href="#17974">17974: </a>                <span class="php-var">$this</span>-&gt;columns[<span class="php-var">$col</span>][<span class="php-quote">'x'</span>] = <span class="php-var">$x</span>;
</span><span id="17975" class="l"><a href="#17975">17975: </a>            }
</span><span id="17976" class="l"><a href="#17976">17976: </a>            <span class="php-var">$this</span>-&gt;current_column = <span class="php-var">$col</span>;
</span><span id="17977" class="l"><a href="#17977">17977: </a>            <span class="php-comment">// fix for HTML mode</span>
</span><span id="17978" class="l"><a href="#17978">17978: </a>            <span class="php-var">$this</span>-&gt;newline = <span class="php-keyword1">true</span>;
</span><span id="17979" class="l"><a href="#17979">17979: </a>            <span class="php-comment">// print HTML table header (if any)</span>
</span><span id="17980" class="l"><a href="#17980">17980: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;thead) <span class="php-keyword1">AND</span> (!<span class="php-var">$this</span>-&gt;inthead)) {
</span><span id="17981" class="l"><a href="#17981">17981: </a>                <span class="php-comment">// print table header</span>
</span><span id="17982" class="l"><a href="#17982">17982: </a>                <span class="php-var">$this</span>-&gt;writeHTML(<span class="php-var">$this</span>-&gt;thead, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-quote">''</span>);
</span><span id="17983" class="l"><a href="#17983">17983: </a>            }
</span><span id="17984" class="l"><a href="#17984">17984: </a>        }
</span><span id="17985" class="l"><a href="#17985">17985: </a>
</span><span id="17986" class="l"><a href="#17986">17986: </a>        <span class="php-comment">/**
</span></span><span id="17987" class="l"><a href="#17987">17987: </a><span class="php-comment">         * Serialize an array of parameters to be used with TCPDF tag in HTML code.
</span></span><span id="17988" class="l"><a href="#17988">17988: </a><span class="php-comment">         * @param array $pararray parameters array
</span></span><span id="17989" class="l"><a href="#17989">17989: </a><span class="php-comment">         * @return sting containing serialized data
</span></span><span id="17990" class="l"><a href="#17990">17990: </a><span class="php-comment">         * @access public
</span></span><span id="17991" class="l"><a href="#17991">17991: </a><span class="php-comment">         * @since 4.9.006 (2010-04-02)
</span></span><span id="17992" class="l"><a href="#17992">17992: </a><span class="php-comment">         */</span>
</span><span id="17993" class="l"><a href="#17993">17993: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> serializeTCPDFtagParameters(<span class="php-var">$pararray</span>) {
</span><span id="17994" class="l"><a href="#17994">17994: </a>            <span class="php-keyword1">return</span> <span class="php-keyword2">urlencode</span>(<span class="php-keyword2">serialize</span>(<span class="php-var">$pararray</span>));
</span><span id="17995" class="l"><a href="#17995">17995: </a>        }
</span><span id="17996" class="l"><a href="#17996">17996: </a>
</span><span id="17997" class="l"><a href="#17997">17997: </a>        <span class="php-comment">/**
</span></span><span id="17998" class="l"><a href="#17998">17998: </a><span class="php-comment">         * Set Text rendering mode.
</span></span><span id="17999" class="l"><a href="#17999">17999: </a><span class="php-comment">         * @param int $stroke outline size in user units (0 = disable).
</span></span><span id="18000" class="l"><a href="#18000">18000: </a><span class="php-comment">         * @param boolean $fill if true fills the text (default).
</span></span><span id="18001" class="l"><a href="#18001">18001: </a><span class="php-comment">         * @param boolean $clip if true activate clipping mode
</span></span><span id="18002" class="l"><a href="#18002">18002: </a><span class="php-comment">         * @access public
</span></span><span id="18003" class="l"><a href="#18003">18003: </a><span class="php-comment">         * @since 4.9.008 (2009-04-02)
</span></span><span id="18004" class="l"><a href="#18004">18004: </a><span class="php-comment">         */</span>
</span><span id="18005" class="l"><a href="#18005">18005: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setTextRenderingMode(<span class="php-var">$stroke</span>=<span class="php-num">0</span>, <span class="php-var">$fill</span>=<span class="php-keyword1">true</span>, <span class="php-var">$clip</span>=<span class="php-keyword1">false</span>) {
</span><span id="18006" class="l"><a href="#18006">18006: </a>            <span class="php-comment">// Ref.: PDF 32000-1:2008 - 9.3.6 Text Rendering Mode</span>
</span><span id="18007" class="l"><a href="#18007">18007: </a>            <span class="php-comment">// convert text rendering parameters</span>
</span><span id="18008" class="l"><a href="#18008">18008: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$stroke</span> &lt; <span class="php-num">0</span>) {
</span><span id="18009" class="l"><a href="#18009">18009: </a>                <span class="php-var">$stroke</span> = <span class="php-num">0</span>;
</span><span id="18010" class="l"><a href="#18010">18010: </a>            }
</span><span id="18011" class="l"><a href="#18011">18011: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$fill</span> === <span class="php-keyword1">true</span>) {
</span><span id="18012" class="l"><a href="#18012">18012: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$stroke</span> &gt; <span class="php-num">0</span>) {
</span><span id="18013" class="l"><a href="#18013">18013: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clip</span> === <span class="php-keyword1">true</span>) {
</span><span id="18014" class="l"><a href="#18014">18014: </a>                        <span class="php-comment">// Fill, then stroke text and add to path for clipping</span>
</span><span id="18015" class="l"><a href="#18015">18015: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">6</span>;
</span><span id="18016" class="l"><a href="#18016">18016: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="18017" class="l"><a href="#18017">18017: </a>                        <span class="php-comment">// Fill, then stroke text</span>
</span><span id="18018" class="l"><a href="#18018">18018: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">2</span>;
</span><span id="18019" class="l"><a href="#18019">18019: </a>                    }
</span><span id="18020" class="l"><a href="#18020">18020: </a>                    <span class="php-var">$textstrokewidth</span> = <span class="php-var">$stroke</span>;
</span><span id="18021" class="l"><a href="#18021">18021: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18022" class="l"><a href="#18022">18022: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clip</span> === <span class="php-keyword1">true</span>) {
</span><span id="18023" class="l"><a href="#18023">18023: </a>                        <span class="php-comment">// Fill text and add to path for clipping</span>
</span><span id="18024" class="l"><a href="#18024">18024: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">4</span>;
</span><span id="18025" class="l"><a href="#18025">18025: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="18026" class="l"><a href="#18026">18026: </a>                        <span class="php-comment">// Fill text</span>
</span><span id="18027" class="l"><a href="#18027">18027: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">0</span>;
</span><span id="18028" class="l"><a href="#18028">18028: </a>                    }
</span><span id="18029" class="l"><a href="#18029">18029: </a>                }
</span><span id="18030" class="l"><a href="#18030">18030: </a>            } <span class="php-keyword1">else</span> {
</span><span id="18031" class="l"><a href="#18031">18031: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$stroke</span> &gt; <span class="php-num">0</span>) {
</span><span id="18032" class="l"><a href="#18032">18032: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clip</span> === <span class="php-keyword1">true</span>) {
</span><span id="18033" class="l"><a href="#18033">18033: </a>                        <span class="php-comment">// Stroke text and add to path for clipping</span>
</span><span id="18034" class="l"><a href="#18034">18034: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">5</span>;
</span><span id="18035" class="l"><a href="#18035">18035: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="18036" class="l"><a href="#18036">18036: </a>                        <span class="php-comment">// Stroke text</span>
</span><span id="18037" class="l"><a href="#18037">18037: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">1</span>;
</span><span id="18038" class="l"><a href="#18038">18038: </a>                    }
</span><span id="18039" class="l"><a href="#18039">18039: </a>                    <span class="php-var">$textstrokewidth</span> = <span class="php-var">$stroke</span>;
</span><span id="18040" class="l"><a href="#18040">18040: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18041" class="l"><a href="#18041">18041: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clip</span> === <span class="php-keyword1">true</span>) {
</span><span id="18042" class="l"><a href="#18042">18042: </a>                        <span class="php-comment">// Add text to path for clipping</span>
</span><span id="18043" class="l"><a href="#18043">18043: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">7</span>;
</span><span id="18044" class="l"><a href="#18044">18044: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="18045" class="l"><a href="#18045">18045: </a>                        <span class="php-comment">// Neither fill nor stroke text (invisible)</span>
</span><span id="18046" class="l"><a href="#18046">18046: </a>                        <span class="php-var">$textrendermode</span> = <span class="php-num">3</span>;
</span><span id="18047" class="l"><a href="#18047">18047: </a>                    }
</span><span id="18048" class="l"><a href="#18048">18048: </a>                }
</span><span id="18049" class="l"><a href="#18049">18049: </a>            }
</span><span id="18050" class="l"><a href="#18050">18050: </a>            <span class="php-var">$this</span>-&gt;textrendermode = <span class="php-var">$textrendermode</span>;
</span><span id="18051" class="l"><a href="#18051">18051: </a>            <span class="php-var">$this</span>-&gt;textstrokewidth = <span class="php-var">$stroke</span> * <span class="php-var">$this</span>-&gt;k;
</span><span id="18052" class="l"><a href="#18052">18052: </a>        }
</span><span id="18053" class="l"><a href="#18053">18053: </a>
</span><span id="18054" class="l"><a href="#18054">18054: </a>        <span class="php-comment">/**
</span></span><span id="18055" class="l"><a href="#18055">18055: </a><span class="php-comment">         * Returns an array of chars containing soft hyphens.
</span></span><span id="18056" class="l"><a href="#18056">18056: </a><span class="php-comment">         * @param array $word array of chars
</span></span><span id="18057" class="l"><a href="#18057">18057: </a><span class="php-comment">         * @param array $patterns Array of hypenation patterns.
</span></span><span id="18058" class="l"><a href="#18058">18058: </a><span class="php-comment">         * @param array $dictionary Array of words to be returned without applying the hyphenation algoritm.
</span></span><span id="18059" class="l"><a href="#18059">18059: </a><span class="php-comment">         * @param int $leftmin Minimum number of character to leave on the left of the word without applying the hyphens.
</span></span><span id="18060" class="l"><a href="#18060">18060: </a><span class="php-comment">         * @param int $rightmin Minimum number of character to leave on the right of the word without applying the hyphens.
</span></span><span id="18061" class="l"><a href="#18061">18061: </a><span class="php-comment">         * @param int $charmin Minimum word lenght to apply the hyphenation algoritm.
</span></span><span id="18062" class="l"><a href="#18062">18062: </a><span class="php-comment">         * @param int $charmax Maximum lenght of broken piece of word.
</span></span><span id="18063" class="l"><a href="#18063">18063: </a><span class="php-comment">         * @return array text with soft hyphens
</span></span><span id="18064" class="l"><a href="#18064">18064: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18065" class="l"><a href="#18065">18065: </a><span class="php-comment">         * @since 4.9.012 (2010-04-12)
</span></span><span id="18066" class="l"><a href="#18066">18066: </a><span class="php-comment">         * @access protected
</span></span><span id="18067" class="l"><a href="#18067">18067: </a><span class="php-comment">         */</span>
</span><span id="18068" class="l"><a href="#18068">18068: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> hyphenateWord(<span class="php-var">$word</span>, <span class="php-var">$patterns</span>, <span class="php-var">$dictionary</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$leftmin</span>=<span class="php-num">1</span>, <span class="php-var">$rightmin</span>=<span class="php-num">2</span>, <span class="php-var">$charmin</span>=<span class="php-num">1</span>, <span class="php-var">$charmax</span>=<span class="php-num">8</span>) {
</span><span id="18069" class="l"><a href="#18069">18069: </a>            <span class="php-var">$hyphenword</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// hyphens positions</span>
</span><span id="18070" class="l"><a href="#18070">18070: </a>            <span class="php-var">$numchars</span> = <span class="php-keyword2">count</span>(<span class="php-var">$word</span>);
</span><span id="18071" class="l"><a href="#18071">18071: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$numchars</span> &lt;= <span class="php-var">$charmin</span>) {
</span><span id="18072" class="l"><a href="#18072">18072: </a>                <span class="php-keyword1">return</span> <span class="php-var">$word</span>;
</span><span id="18073" class="l"><a href="#18073">18073: </a>            }
</span><span id="18074" class="l"><a href="#18074">18074: </a>            <span class="php-var">$word_string</span> = <span class="php-var">$this</span>-&gt;UTF8ArrSubString(<span class="php-var">$word</span>);
</span><span id="18075" class="l"><a href="#18075">18075: </a>            <span class="php-comment">// some words will be returned as-is</span>
</span><span id="18076" class="l"><a href="#18076">18076: </a>            <span class="php-var">$pattern</span> = <span class="php-quote">'/^([a-zA-Z0-9_\.\-]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/'</span>;
</span><span id="18077" class="l"><a href="#18077">18077: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-var">$pattern</span>, <span class="php-var">$word_string</span>) &gt; <span class="php-num">0</span>) {
</span><span id="18078" class="l"><a href="#18078">18078: </a>                <span class="php-comment">// email</span>
</span><span id="18079" class="l"><a href="#18079">18079: </a>                <span class="php-keyword1">return</span> <span class="php-var">$word</span>;
</span><span id="18080" class="l"><a href="#18080">18080: </a>            }
</span><span id="18081" class="l"><a href="#18081">18081: </a>            <span class="php-var">$pattern</span> = <span class="php-quote">'/(([a-zA-Z0-9\-]+\.)?)((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/'</span>;
</span><span id="18082" class="l"><a href="#18082">18082: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-var">$pattern</span>, <span class="php-var">$word_string</span>) &gt; <span class="php-num">0</span>) {
</span><span id="18083" class="l"><a href="#18083">18083: </a>                <span class="php-comment">// URL</span>
</span><span id="18084" class="l"><a href="#18084">18084: </a>                <span class="php-keyword1">return</span> <span class="php-var">$word</span>;
</span><span id="18085" class="l"><a href="#18085">18085: </a>            }
</span><span id="18086" class="l"><a href="#18086">18086: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$dictionary</span>[<span class="php-var">$word_string</span>])) {
</span><span id="18087" class="l"><a href="#18087">18087: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$dictionary</span>[<span class="php-var">$word_string</span>]);
</span><span id="18088" class="l"><a href="#18088">18088: </a>            }
</span><span id="18089" class="l"><a href="#18089">18089: </a>            <span class="php-comment">// suround word with '_' characters</span>
</span><span id="18090" class="l"><a href="#18090">18090: </a>            <span class="php-var">$tmpword</span> = <span class="php-keyword2">array_merge</span>(<span class="php-keyword1">array</span>(<span class="php-num">95</span>), <span class="php-var">$word</span>, <span class="php-keyword1">array</span>(<span class="php-num">95</span>));
</span><span id="18091" class="l"><a href="#18091">18091: </a>            <span class="php-var">$tmpnumchars</span> = <span class="php-var">$numchars</span> + <span class="php-num">2</span>;
</span><span id="18092" class="l"><a href="#18092">18092: </a>            <span class="php-var">$maxpos</span> = <span class="php-var">$tmpnumchars</span> - <span class="php-var">$charmin</span>;
</span><span id="18093" class="l"><a href="#18093">18093: </a>            <span class="php-keyword1">for</span> (<span class="php-var">$pos</span> = <span class="php-num">0</span>; <span class="php-var">$pos</span> &lt; <span class="php-var">$maxpos</span>; ++<span class="php-var">$pos</span>) {
</span><span id="18094" class="l"><a href="#18094">18094: </a>                <span class="php-var">$imax</span> = <span class="php-keyword2">min</span>((<span class="php-var">$tmpnumchars</span> - <span class="php-var">$pos</span>), <span class="php-var">$charmax</span>);
</span><span id="18095" class="l"><a href="#18095">18095: </a>                <span class="php-keyword1">for</span> (<span class="php-var">$i</span> = <span class="php-var">$charmin</span>; <span class="php-var">$i</span> &lt;= <span class="php-var">$imax</span>; ++<span class="php-var">$i</span>) {
</span><span id="18096" class="l"><a href="#18096">18096: </a>                    <span class="php-var">$subword</span> = <span class="php-keyword2">strtolower</span>(<span class="php-var">$this</span>-&gt;UTF8ArrSubString(<span class="php-var">$tmpword</span>, <span class="php-var">$pos</span>, <span class="php-var">$pos</span> + <span class="php-var">$i</span>));
</span><span id="18097" class="l"><a href="#18097">18097: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$patterns</span>[<span class="php-var">$subword</span>])) {
</span><span id="18098" class="l"><a href="#18098">18098: </a>                        <span class="php-var">$pattern</span> = <span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$patterns</span>[<span class="php-var">$subword</span>]);
</span><span id="18099" class="l"><a href="#18099">18099: </a>                        <span class="php-var">$pattern_length</span> = <span class="php-keyword2">count</span>(<span class="php-var">$pattern</span>);
</span><span id="18100" class="l"><a href="#18100">18100: </a>                        <span class="php-var">$digits</span> = <span class="php-num">1</span>;
</span><span id="18101" class="l"><a href="#18101">18101: </a>                        <span class="php-keyword1">for</span> (<span class="php-var">$j</span> = <span class="php-num">0</span>; <span class="php-var">$j</span> &lt; <span class="php-var">$pattern_length</span>; ++<span class="php-var">$j</span>) {
</span><span id="18102" class="l"><a href="#18102">18102: </a>                            <span class="php-comment">// check if $pattern[$j] is a number</span>
</span><span id="18103" class="l"><a href="#18103">18103: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$pattern</span>[<span class="php-var">$j</span>] &gt;= <span class="php-num">48</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$pattern</span>[<span class="php-var">$j</span>] &lt;= <span class="php-num">57</span>)) {
</span><span id="18104" class="l"><a href="#18104">18104: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$j</span> == <span class="php-num">0</span>) {
</span><span id="18105" class="l"><a href="#18105">18105: </a>                                    <span class="php-var">$zero</span> = <span class="php-var">$pos</span> - <span class="php-num">1</span>;
</span><span id="18106" class="l"><a href="#18106">18106: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="18107" class="l"><a href="#18107">18107: </a>                                    <span class="php-var">$zero</span> = <span class="php-var">$pos</span> + <span class="php-var">$j</span> - <span class="php-var">$digits</span>;
</span><span id="18108" class="l"><a href="#18108">18108: </a>                                }
</span><span id="18109" class="l"><a href="#18109">18109: </a>                                <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$hyphenword</span>[<span class="php-var">$zero</span>]) <span class="php-keyword1">OR</span> (<span class="php-var">$hyphenword</span>[<span class="php-var">$zero</span>] != <span class="php-var">$pattern</span>[<span class="php-var">$j</span>])) {
</span><span id="18110" class="l"><a href="#18110">18110: </a>                                    <span class="php-var">$hyphenword</span>[<span class="php-var">$zero</span>] = <span class="php-var">$this</span>-&gt;unichr(<span class="php-var">$pattern</span>[<span class="php-var">$j</span>]);
</span><span id="18111" class="l"><a href="#18111">18111: </a>                                }
</span><span id="18112" class="l"><a href="#18112">18112: </a>                                ++<span class="php-var">$digits</span>;
</span><span id="18113" class="l"><a href="#18113">18113: </a>                            }
</span><span id="18114" class="l"><a href="#18114">18114: </a>                        }
</span><span id="18115" class="l"><a href="#18115">18115: </a>                    }
</span><span id="18116" class="l"><a href="#18116">18116: </a>                }
</span><span id="18117" class="l"><a href="#18117">18117: </a>            }
</span><span id="18118" class="l"><a href="#18118">18118: </a>            <span class="php-var">$inserted</span> = <span class="php-num">0</span>;
</span><span id="18119" class="l"><a href="#18119">18119: </a>            <span class="php-var">$maxpos</span> = <span class="php-var">$numchars</span> - <span class="php-var">$rightmin</span>;
</span><span id="18120" class="l"><a href="#18120">18120: </a>            <span class="php-keyword1">for</span>(<span class="php-var">$i</span> = <span class="php-var">$leftmin</span>; <span class="php-var">$i</span> &lt;= <span class="php-var">$maxpos</span>; ++<span class="php-var">$i</span>) {
</span><span id="18121" class="l"><a href="#18121">18121: </a>                <span class="php-keyword1">if</span>(<span class="php-keyword1">isset</span>(<span class="php-var">$hyphenword</span>[<span class="php-var">$i</span>]) <span class="php-keyword1">AND</span> ((<span class="php-var">$hyphenword</span>[<span class="php-var">$i</span>] % <span class="php-num">2</span>) != <span class="php-num">0</span>)) {
</span><span id="18122" class="l"><a href="#18122">18122: </a>                    <span class="php-comment">// 173 = soft hyphen character</span>
</span><span id="18123" class="l"><a href="#18123">18123: </a>                    <span class="php-keyword2">array_splice</span>(<span class="php-var">$word</span>, <span class="php-var">$i</span> + <span class="php-var">$inserted</span>, <span class="php-num">0</span>, <span class="php-num">173</span>);
</span><span id="18124" class="l"><a href="#18124">18124: </a>                    ++<span class="php-var">$inserted</span>;
</span><span id="18125" class="l"><a href="#18125">18125: </a>                }
</span><span id="18126" class="l"><a href="#18126">18126: </a>            }
</span><span id="18127" class="l"><a href="#18127">18127: </a>            <span class="php-keyword1">return</span> <span class="php-var">$word</span>;
</span><span id="18128" class="l"><a href="#18128">18128: </a>        }
</span><span id="18129" class="l"><a href="#18129">18129: </a>
</span><span id="18130" class="l"><a href="#18130">18130: </a>        <span class="php-comment">/**
</span></span><span id="18131" class="l"><a href="#18131">18131: </a><span class="php-comment">         * Returns an array of hyphenation patterns.
</span></span><span id="18132" class="l"><a href="#18132">18132: </a><span class="php-comment">         * @param string $file TEX file containing hypenation patterns. TEX pattrns can be downloaded from http://www.ctan.org/tex-archive/language/hyph-utf8/tex/generic/hyph-utf8/patterns/
</span></span><span id="18133" class="l"><a href="#18133">18133: </a><span class="php-comment">         * @return array of hyphenation patterns
</span></span><span id="18134" class="l"><a href="#18134">18134: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18135" class="l"><a href="#18135">18135: </a><span class="php-comment">         * @since 4.9.012 (2010-04-12)
</span></span><span id="18136" class="l"><a href="#18136">18136: </a><span class="php-comment">         * @access public
</span></span><span id="18137" class="l"><a href="#18137">18137: </a><span class="php-comment">         */</span>
</span><span id="18138" class="l"><a href="#18138">18138: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> getHyphenPatternsFromTEX(<span class="php-var">$file</span>) {
</span><span id="18139" class="l"><a href="#18139">18139: </a>            <span class="php-comment">// TEX patterns are available at:</span>
</span><span id="18140" class="l"><a href="#18140">18140: </a>            <span class="php-comment">// http://www.ctan.org/tex-archive/language/hyph-utf8/tex/generic/hyph-utf8/patterns/</span>
</span><span id="18141" class="l"><a href="#18141">18141: </a>            <span class="php-var">$data</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$file</span>);
</span><span id="18142" class="l"><a href="#18142">18142: </a>            <span class="php-var">$patterns</span> = <span class="php-keyword1">array</span>();
</span><span id="18143" class="l"><a href="#18143">18143: </a>            <span class="php-comment">// remove comments</span>
</span><span id="18144" class="l"><a href="#18144">18144: </a>            <span class="php-var">$data</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/\%[^\n]*/'</span>, <span class="php-quote">''</span>, <span class="php-var">$data</span>);
</span><span id="18145" class="l"><a href="#18145">18145: </a>            <span class="php-comment">// extract the patterns part</span>
</span><span id="18146" class="l"><a href="#18146">18146: </a>            <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/\\\\patterns\{([^\}]*)\}/i'</span>, <span class="php-var">$data</span>, <span class="php-var">$matches</span>);
</span><span id="18147" class="l"><a href="#18147">18147: </a>            <span class="php-var">$data</span> = <span class="php-keyword2">trim</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$matches</span>[<span class="php-num">0</span>], <span class="php-num">10</span>, -<span class="php-num">1</span>));
</span><span id="18148" class="l"><a href="#18148">18148: </a>            <span class="php-comment">// extract each pattern</span>
</span><span id="18149" class="l"><a href="#18149">18149: </a>            <span class="php-var">$patterns_array</span> = <span class="php-keyword2">preg_split</span>(<span class="php-quote">'/[\s]+/'</span>, <span class="php-var">$data</span>);
</span><span id="18150" class="l"><a href="#18150">18150: </a>            <span class="php-comment">// create new language array of patterns</span>
</span><span id="18151" class="l"><a href="#18151">18151: </a>            <span class="php-var">$patterns</span> = <span class="php-keyword1">array</span>();
</span><span id="18152" class="l"><a href="#18152">18152: </a>            <span class="php-keyword1">foreach</span>(<span class="php-var">$patterns_array</span> <span class="php-keyword1">as</span> <span class="php-var">$val</span>) {
</span><span id="18153" class="l"><a href="#18153">18153: </a>                <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$val</span>)) {
</span><span id="18154" class="l"><a href="#18154">18154: </a>                    <span class="php-var">$val</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$val</span>);
</span><span id="18155" class="l"><a href="#18155">18155: </a>                    <span class="php-var">$val</span> = <span class="php-keyword2">str_replace</span>(<span class="php-quote">'\''</span>, <span class="php-quote">'\\\''</span>, <span class="php-var">$val</span>);
</span><span id="18156" class="l"><a href="#18156">18156: </a>                    <span class="php-var">$key</span> = <span class="php-keyword2">preg_replace</span>(<span class="php-quote">'/[0-9]+/'</span>, <span class="php-quote">''</span>, <span class="php-var">$val</span>);
</span><span id="18157" class="l"><a href="#18157">18157: </a>                    <span class="php-var">$patterns</span>[<span class="php-var">$key</span>] = <span class="php-var">$val</span>;
</span><span id="18158" class="l"><a href="#18158">18158: </a>                }
</span><span id="18159" class="l"><a href="#18159">18159: </a>            }
</span><span id="18160" class="l"><a href="#18160">18160: </a>            <span class="php-keyword1">return</span> <span class="php-var">$patterns</span>;
</span><span id="18161" class="l"><a href="#18161">18161: </a>        }
</span><span id="18162" class="l"><a href="#18162">18162: </a>
</span><span id="18163" class="l"><a href="#18163">18163: </a>        <span class="php-comment">/**
</span></span><span id="18164" class="l"><a href="#18164">18164: </a><span class="php-comment">         * Returns text with soft hyphens.
</span></span><span id="18165" class="l"><a href="#18165">18165: </a><span class="php-comment">         * @param string $text text to process
</span></span><span id="18166" class="l"><a href="#18166">18166: </a><span class="php-comment">         * @param mixed $patterns Array of hypenation patterns or a TEX file containing hypenation patterns. TEX patterns can be downloaded from http://www.ctan.org/tex-archive/language/hyph-utf8/tex/generic/hyph-utf8/patterns/
</span></span><span id="18167" class="l"><a href="#18167">18167: </a><span class="php-comment">         * @param array $dictionary Array of words to be returned without applying the hyphenation algoritm.
</span></span><span id="18168" class="l"><a href="#18168">18168: </a><span class="php-comment">         * @param int $leftmin Minimum number of character to leave on the left of the word without applying the hyphens.
</span></span><span id="18169" class="l"><a href="#18169">18169: </a><span class="php-comment">         * @param int $rightmin Minimum number of character to leave on the right of the word without applying the hyphens.
</span></span><span id="18170" class="l"><a href="#18170">18170: </a><span class="php-comment">         * @param int $charmin Minimum word lenght to apply the hyphenation algoritm.
</span></span><span id="18171" class="l"><a href="#18171">18171: </a><span class="php-comment">         * @param int $charmax Maximum lenght of broken piece of word.
</span></span><span id="18172" class="l"><a href="#18172">18172: </a><span class="php-comment">         * @return array text with soft hyphens
</span></span><span id="18173" class="l"><a href="#18173">18173: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18174" class="l"><a href="#18174">18174: </a><span class="php-comment">         * @since 4.9.012 (2010-04-12)
</span></span><span id="18175" class="l"><a href="#18175">18175: </a><span class="php-comment">         * @access public
</span></span><span id="18176" class="l"><a href="#18176">18176: </a><span class="php-comment">         */</span>
</span><span id="18177" class="l"><a href="#18177">18177: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> hyphenateText(<span class="php-var">$text</span>, <span class="php-var">$patterns</span>, <span class="php-var">$dictionary</span>=<span class="php-keyword1">array</span>(), <span class="php-var">$leftmin</span>=<span class="php-num">1</span>, <span class="php-var">$rightmin</span>=<span class="php-num">2</span>, <span class="php-var">$charmin</span>=<span class="php-num">1</span>, <span class="php-var">$charmax</span>=<span class="php-num">8</span>) {
</span><span id="18178" class="l"><a href="#18178">18178: </a>            <span class="php-keyword1">global</span> <span class="php-var">$unicode</span>;
</span><span id="18179" class="l"><a href="#18179">18179: </a>            <span class="php-var">$text</span> = <span class="php-var">$this</span>-&gt;unhtmlentities(<span class="php-var">$text</span>);
</span><span id="18180" class="l"><a href="#18180">18180: </a>            <span class="php-var">$word</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// last word</span>
</span><span id="18181" class="l"><a href="#18181">18181: </a>            <span class="php-var">$txtarr</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// text to be returned</span>
</span><span id="18182" class="l"><a href="#18182">18182: </a>            <span class="php-var">$intag</span> = <span class="php-keyword1">false</span>; <span class="php-comment">// true if we are inside an HTML tag</span>
</span><span id="18183" class="l"><a href="#18183">18183: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword2">is_array</span>(<span class="php-var">$patterns</span>)) {
</span><span id="18184" class="l"><a href="#18184">18184: </a>                <span class="php-var">$patterns</span> = <span class="php-var">$this</span>-&gt;getHyphenPatternsFromTEX(<span class="php-var">$patterns</span>);
</span><span id="18185" class="l"><a href="#18185">18185: </a>            }
</span><span id="18186" class="l"><a href="#18186">18186: </a>            <span class="php-comment">// get array of characters</span>
</span><span id="18187" class="l"><a href="#18187">18187: </a>            <span class="php-var">$unichars</span> = <span class="php-var">$this</span>-&gt;UTF8StringToArray(<span class="php-var">$text</span>);
</span><span id="18188" class="l"><a href="#18188">18188: </a>            <span class="php-comment">// for each char</span>
</span><span id="18189" class="l"><a href="#18189">18189: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$unichars</span> <span class="php-keyword1">as</span> <span class="php-var">$char</span>) {
</span><span id="18190" class="l"><a href="#18190">18190: </a>                <span class="php-keyword1">if</span> ((!<span class="php-var">$intag</span>) <span class="php-keyword1">AND</span> <span class="php-var">$unicode</span>[<span class="php-var">$char</span>] == <span class="php-quote">'L'</span>) {
</span><span id="18191" class="l"><a href="#18191">18191: </a>                    <span class="php-comment">// letter character</span>
</span><span id="18192" class="l"><a href="#18192">18192: </a>                    <span class="php-var">$word</span>[] = <span class="php-var">$char</span>;
</span><span id="18193" class="l"><a href="#18193">18193: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18194" class="l"><a href="#18194">18194: </a>                    <span class="php-comment">// other type of character</span>
</span><span id="18195" class="l"><a href="#18195">18195: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$word</span>)) {
</span><span id="18196" class="l"><a href="#18196">18196: </a>                        <span class="php-comment">// hypenate the word</span>
</span><span id="18197" class="l"><a href="#18197">18197: </a>                        <span class="php-var">$txtarr</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$txtarr</span>, <span class="php-var">$this</span>-&gt;hyphenateWord(<span class="php-var">$word</span>, <span class="php-var">$patterns</span>, <span class="php-var">$dictionary</span>, <span class="php-var">$leftmin</span>, <span class="php-var">$rightmin</span>, <span class="php-var">$charmin</span>, <span class="php-var">$charmax</span>));
</span><span id="18198" class="l"><a href="#18198">18198: </a>                        <span class="php-var">$word</span> = <span class="php-keyword1">array</span>();
</span><span id="18199" class="l"><a href="#18199">18199: </a>                    }
</span><span id="18200" class="l"><a href="#18200">18200: </a>                    <span class="php-var">$txtarr</span>[] = <span class="php-var">$char</span>;
</span><span id="18201" class="l"><a href="#18201">18201: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">chr</span>(<span class="php-var">$char</span>) == <span class="php-quote">'&lt;'</span>) {
</span><span id="18202" class="l"><a href="#18202">18202: </a>                        <span class="php-comment">// we are inside an HTML tag</span>
</span><span id="18203" class="l"><a href="#18203">18203: </a>                        <span class="php-var">$intag</span> = <span class="php-keyword1">true</span>;
</span><span id="18204" class="l"><a href="#18204">18204: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$intag</span> <span class="php-keyword1">AND</span> (<span class="php-keyword2">chr</span>(<span class="php-var">$char</span>) == <span class="php-quote">'&gt;'</span>)) {
</span><span id="18205" class="l"><a href="#18205">18205: </a>                        <span class="php-comment">// end of HTML tag</span>
</span><span id="18206" class="l"><a href="#18206">18206: </a>                        <span class="php-var">$intag</span> = <span class="php-keyword1">false</span>;
</span><span id="18207" class="l"><a href="#18207">18207: </a>                    }
</span><span id="18208" class="l"><a href="#18208">18208: </a>                }
</span><span id="18209" class="l"><a href="#18209">18209: </a>            }
</span><span id="18210" class="l"><a href="#18210">18210: </a>            <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$word</span>)) {
</span><span id="18211" class="l"><a href="#18211">18211: </a>                <span class="php-comment">// hypenate the word</span>
</span><span id="18212" class="l"><a href="#18212">18212: </a>                <span class="php-var">$txtarr</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$txtarr</span>, <span class="php-var">$this</span>-&gt;hyphenateWord(<span class="php-var">$word</span>, <span class="php-var">$patterns</span>, <span class="php-var">$dictionary</span>, <span class="php-var">$leftmin</span>, <span class="php-var">$rightmin</span>, <span class="php-var">$charmin</span>, <span class="php-var">$charmax</span>));
</span><span id="18213" class="l"><a href="#18213">18213: </a>            }
</span><span id="18214" class="l"><a href="#18214">18214: </a>            <span class="php-comment">// convert char array to string and return</span>
</span><span id="18215" class="l"><a href="#18215">18215: </a>            <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;UTF8ArrSubString(<span class="php-var">$txtarr</span>);
</span><span id="18216" class="l"><a href="#18216">18216: </a>        }
</span><span id="18217" class="l"><a href="#18217">18217: </a>
</span><span id="18218" class="l"><a href="#18218">18218: </a>        <span class="php-comment">/**
</span></span><span id="18219" class="l"><a href="#18219">18219: </a><span class="php-comment">         * Enable/disable rasterization of SVG images using ImageMagick library.
</span></span><span id="18220" class="l"><a href="#18220">18220: </a><span class="php-comment">         * @param boolean $mode if true enable rasterization, false otherwise.
</span></span><span id="18221" class="l"><a href="#18221">18221: </a><span class="php-comment">         * @access public
</span></span><span id="18222" class="l"><a href="#18222">18222: </a><span class="php-comment">         * @since 5.0.000 (2010-04-27)
</span></span><span id="18223" class="l"><a href="#18223">18223: </a><span class="php-comment">         */</span>
</span><span id="18224" class="l"><a href="#18224">18224: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> setRasterizeVectorImages(<span class="php-var">$mode</span>) {
</span><span id="18225" class="l"><a href="#18225">18225: </a>            <span class="php-var">$this</span>-&gt;rasterize_vector_images = <span class="php-var">$mode</span>;
</span><span id="18226" class="l"><a href="#18226">18226: </a>        }
</span><span id="18227" class="l"><a href="#18227">18227: </a>
</span><span id="18228" class="l"><a href="#18228">18228: </a>        <span class="php-comment">/**
</span></span><span id="18229" class="l"><a href="#18229">18229: </a><span class="php-comment">         * Get the Path-Painting Operators.
</span></span><span id="18230" class="l"><a href="#18230">18230: </a><span class="php-comment">         * @param string $style Style of rendering. Possible values are:
</span></span><span id="18231" class="l"><a href="#18231">18231: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="18232" class="l"><a href="#18232">18232: </a><span class="php-comment">         *   &lt;li&gt;S or D: Stroke the path.&lt;/li&gt;
</span></span><span id="18233" class="l"><a href="#18233">18233: </a><span class="php-comment">         *   &lt;li&gt;s or d: Close and stroke the path.&lt;/li&gt;
</span></span><span id="18234" class="l"><a href="#18234">18234: </a><span class="php-comment">         *   &lt;li&gt;f or F: Fill the path, using the nonzero winding number rule to determine the region to fill.&lt;/li&gt;
</span></span><span id="18235" class="l"><a href="#18235">18235: </a><span class="php-comment">         *   &lt;li&gt;f* or F*: Fill the path, using the even-odd rule to determine the region to fill.&lt;/li&gt;
</span></span><span id="18236" class="l"><a href="#18236">18236: </a><span class="php-comment">         *   &lt;li&gt;B or FD or DF: Fill and then stroke the path, using the nonzero winding number rule to determine the region to fill.&lt;/li&gt;
</span></span><span id="18237" class="l"><a href="#18237">18237: </a><span class="php-comment">         *   &lt;li&gt;B* or F*D or DF*: Fill and then stroke the path, using the even-odd rule to determine the region to fill.&lt;/li&gt;
</span></span><span id="18238" class="l"><a href="#18238">18238: </a><span class="php-comment">         *   &lt;li&gt;b or fd or df: Close, fill, and then stroke the path, using the nonzero winding number rule to determine the region to fill.&lt;/li&gt;
</span></span><span id="18239" class="l"><a href="#18239">18239: </a><span class="php-comment">         *   &lt;li&gt;b or f*d or df*: Close, fill, and then stroke the path, using the even-odd rule to determine the region to fill.&lt;/li&gt;
</span></span><span id="18240" class="l"><a href="#18240">18240: </a><span class="php-comment">         *   &lt;li&gt;CNZ: Clipping mode using the even-odd rule to determine which regions lie inside the clipping path.&lt;/li&gt;
</span></span><span id="18241" class="l"><a href="#18241">18241: </a><span class="php-comment">         *   &lt;li&gt;CEO: Clipping mode using the nonzero winding number rule to determine which regions lie inside the clipping path&lt;/li&gt;
</span></span><span id="18242" class="l"><a href="#18242">18242: </a><span class="php-comment">         *   &lt;li&gt;n: End the path object without filling or stroking it.&lt;/li&gt;
</span></span><span id="18243" class="l"><a href="#18243">18243: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="18244" class="l"><a href="#18244">18244: </a><span class="php-comment">         * @param string $default default style
</span></span><span id="18245" class="l"><a href="#18245">18245: </a><span class="php-comment">         * @param boolean $mode if true enable rasterization, false otherwise.
</span></span><span id="18246" class="l"><a href="#18246">18246: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18247" class="l"><a href="#18247">18247: </a><span class="php-comment">         * @access protected
</span></span><span id="18248" class="l"><a href="#18248">18248: </a><span class="php-comment">         * @since 5.0.000 (2010-04-30)
</span></span><span id="18249" class="l"><a href="#18249">18249: </a><span class="php-comment">         */</span>
</span><span id="18250" class="l"><a href="#18250">18250: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getPathPaintOperator(<span class="php-var">$style</span>, <span class="php-var">$default</span>=<span class="php-quote">'S'</span>) {
</span><span id="18251" class="l"><a href="#18251">18251: </a>            <span class="php-var">$op</span> = <span class="php-quote">''</span>;
</span><span id="18252" class="l"><a href="#18252">18252: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$style</span>) {
</span><span id="18253" class="l"><a href="#18253">18253: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'S'</span>:
</span><span id="18254" class="l"><a href="#18254">18254: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'D'</span>: {
</span><span id="18255" class="l"><a href="#18255">18255: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'S'</span>;
</span><span id="18256" class="l"><a href="#18256">18256: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18257" class="l"><a href="#18257">18257: </a>                }
</span><span id="18258" class="l"><a href="#18258">18258: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'s'</span>:
</span><span id="18259" class="l"><a href="#18259">18259: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'d'</span>: {
</span><span id="18260" class="l"><a href="#18260">18260: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'s'</span>;
</span><span id="18261" class="l"><a href="#18261">18261: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18262" class="l"><a href="#18262">18262: </a>                }
</span><span id="18263" class="l"><a href="#18263">18263: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'f'</span>:
</span><span id="18264" class="l"><a href="#18264">18264: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'F'</span>: {
</span><span id="18265" class="l"><a href="#18265">18265: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'f'</span>;
</span><span id="18266" class="l"><a href="#18266">18266: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18267" class="l"><a href="#18267">18267: </a>                }
</span><span id="18268" class="l"><a href="#18268">18268: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'f*'</span>:
</span><span id="18269" class="l"><a href="#18269">18269: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'F*'</span>: {
</span><span id="18270" class="l"><a href="#18270">18270: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'f*'</span>;
</span><span id="18271" class="l"><a href="#18271">18271: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18272" class="l"><a href="#18272">18272: </a>                }
</span><span id="18273" class="l"><a href="#18273">18273: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>:
</span><span id="18274" class="l"><a href="#18274">18274: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'FD'</span>:
</span><span id="18275" class="l"><a href="#18275">18275: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'DF'</span>: {
</span><span id="18276" class="l"><a href="#18276">18276: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'B'</span>;
</span><span id="18277" class="l"><a href="#18277">18277: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18278" class="l"><a href="#18278">18278: </a>                }
</span><span id="18279" class="l"><a href="#18279">18279: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B*'</span>:
</span><span id="18280" class="l"><a href="#18280">18280: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'F*D'</span>:
</span><span id="18281" class="l"><a href="#18281">18281: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'DF*'</span>: {
</span><span id="18282" class="l"><a href="#18282">18282: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'B*'</span>;
</span><span id="18283" class="l"><a href="#18283">18283: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18284" class="l"><a href="#18284">18284: </a>                }
</span><span id="18285" class="l"><a href="#18285">18285: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'b'</span>:
</span><span id="18286" class="l"><a href="#18286">18286: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'fd'</span>:
</span><span id="18287" class="l"><a href="#18287">18287: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'df'</span>: {
</span><span id="18288" class="l"><a href="#18288">18288: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'b'</span>;
</span><span id="18289" class="l"><a href="#18289">18289: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18290" class="l"><a href="#18290">18290: </a>                }
</span><span id="18291" class="l"><a href="#18291">18291: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'b*'</span>:
</span><span id="18292" class="l"><a href="#18292">18292: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'f*d'</span>:
</span><span id="18293" class="l"><a href="#18293">18293: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'df*'</span>: {
</span><span id="18294" class="l"><a href="#18294">18294: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'b*'</span>;
</span><span id="18295" class="l"><a href="#18295">18295: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18296" class="l"><a href="#18296">18296: </a>                }
</span><span id="18297" class="l"><a href="#18297">18297: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'CNZ'</span>: {
</span><span id="18298" class="l"><a href="#18298">18298: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'W n'</span>;
</span><span id="18299" class="l"><a href="#18299">18299: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18300" class="l"><a href="#18300">18300: </a>                }
</span><span id="18301" class="l"><a href="#18301">18301: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'CEO'</span>: {
</span><span id="18302" class="l"><a href="#18302">18302: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'W* n'</span>;
</span><span id="18303" class="l"><a href="#18303">18303: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18304" class="l"><a href="#18304">18304: </a>                }
</span><span id="18305" class="l"><a href="#18305">18305: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'n'</span>: {
</span><span id="18306" class="l"><a href="#18306">18306: </a>                    <span class="php-var">$op</span> = <span class="php-quote">'n'</span>;
</span><span id="18307" class="l"><a href="#18307">18307: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18308" class="l"><a href="#18308">18308: </a>                }
</span><span id="18309" class="l"><a href="#18309">18309: </a>                <span class="php-keyword1">default</span>: {
</span><span id="18310" class="l"><a href="#18310">18310: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$default</span>)) {
</span><span id="18311" class="l"><a href="#18311">18311: </a>                        <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$default</span>, <span class="php-quote">''</span>);
</span><span id="18312" class="l"><a href="#18312">18312: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="18313" class="l"><a href="#18313">18313: </a>                        <span class="php-var">$op</span> = <span class="php-quote">''</span>;
</span><span id="18314" class="l"><a href="#18314">18314: </a>                    }
</span><span id="18315" class="l"><a href="#18315">18315: </a>                }
</span><span id="18316" class="l"><a href="#18316">18316: </a>            }
</span><span id="18317" class="l"><a href="#18317">18317: </a>            <span class="php-keyword1">return</span> <span class="php-var">$op</span>;
</span><span id="18318" class="l"><a href="#18318">18318: </a>        }
</span><span id="18319" class="l"><a href="#18319">18319: </a>
</span><span id="18320" class="l"><a href="#18320">18320: </a>        <span class="php-comment">// -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-</span>
</span><span id="18321" class="l"><a href="#18321">18321: </a>        <span class="php-comment">// SVG METHODS</span>
</span><span id="18322" class="l"><a href="#18322">18322: </a>        <span class="php-comment">// -.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-</span>
</span><span id="18323" class="l"><a href="#18323">18323: </a>
</span><span id="18324" class="l"><a href="#18324">18324: </a>        <span class="php-comment">/**
</span></span><span id="18325" class="l"><a href="#18325">18325: </a><span class="php-comment">         * Embedd a Scalable Vector Graphics (SVG) image.
</span></span><span id="18326" class="l"><a href="#18326">18326: </a><span class="php-comment">         * NOTE: SVG standard is not yet fully implemented, use the setRasterizeVectorImages() method to enable/disable rasterization of SVG images using ImageMagick library.
</span></span><span id="18327" class="l"><a href="#18327">18327: </a><span class="php-comment">         * @param string $file Name of the SVG file.
</span></span><span id="18328" class="l"><a href="#18328">18328: </a><span class="php-comment">         * @param float $x Abscissa of the upper-left corner.
</span></span><span id="18329" class="l"><a href="#18329">18329: </a><span class="php-comment">         * @param float $y Ordinate of the upper-left corner.
</span></span><span id="18330" class="l"><a href="#18330">18330: </a><span class="php-comment">         * @param float $w Width of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="18331" class="l"><a href="#18331">18331: </a><span class="php-comment">         * @param float $h Height of the image in the page. If not specified or equal to zero, it is automatically calculated.
</span></span><span id="18332" class="l"><a href="#18332">18332: </a><span class="php-comment">         * @param mixed $link URL or identifier returned by AddLink().
</span></span><span id="18333" class="l"><a href="#18333">18333: </a><span class="php-comment">         * @param string $align Indicates the alignment of the pointer next to image insertion relative to image height. The value can be:&lt;ul&gt;&lt;li&gt;T: top-right for LTR or top-left for RTL&lt;/li&gt;&lt;li&gt;M: middle-right for LTR or middle-left for RTL&lt;/li&gt;&lt;li&gt;B: bottom-right for LTR or bottom-left for RTL&lt;/li&gt;&lt;li&gt;N: next line&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="18334" class="l"><a href="#18334">18334: </a><span class="php-comment">         * @param string $palign Allows to center or align the image on the current line. Possible values are:&lt;ul&gt;&lt;li&gt;L : left align&lt;/li&gt;&lt;li&gt;C : center&lt;/li&gt;&lt;li&gt;R : right align&lt;/li&gt;&lt;li&gt;'' : empty string : left for LTR or right for RTL&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="18335" class="l"><a href="#18335">18335: </a><span class="php-comment">         * @param mixed $border Indicates if borders must be drawn around the image. The value can be either a number:&lt;ul&gt;&lt;li&gt;0: no border (default)&lt;/li&gt;&lt;li&gt;1: frame&lt;/li&gt;&lt;/ul&gt;or a string containing some or all of the following characters (in any order):&lt;ul&gt;&lt;li&gt;L: left&lt;/li&gt;&lt;li&gt;T: top&lt;/li&gt;&lt;li&gt;R: right&lt;/li&gt;&lt;li&gt;B: bottom&lt;/li&gt;&lt;/ul&gt;
</span></span><span id="18336" class="l"><a href="#18336">18336: </a><span class="php-comment">         * @param boolean $fitonpage if true the image is resized to not exceed page dimensions.
</span></span><span id="18337" class="l"><a href="#18337">18337: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18338" class="l"><a href="#18338">18338: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="18339" class="l"><a href="#18339">18339: </a><span class="php-comment">         * @access public
</span></span><span id="18340" class="l"><a href="#18340">18340: </a><span class="php-comment">         */</span>
</span><span id="18341" class="l"><a href="#18341">18341: </a>        <span class="php-keyword1">public</span> <span class="php-keyword1">function</span> ImageSVG(<span class="php-var">$file</span>, <span class="php-var">$x</span>=<span class="php-quote">''</span>, <span class="php-var">$y</span>=<span class="php-quote">''</span>, <span class="php-var">$w</span>=<span class="php-num">0</span>, <span class="php-var">$h</span>=<span class="php-num">0</span>, <span class="php-var">$link</span>=<span class="php-quote">''</span>, <span class="php-var">$align</span>=<span class="php-quote">''</span>, <span class="php-var">$palign</span>=<span class="php-quote">''</span>, <span class="php-var">$border</span>=<span class="php-num">0</span>, <span class="php-var">$fitonpage</span>=<span class="php-keyword1">false</span>) {
</span><span id="18342" class="l"><a href="#18342">18342: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rasterize_vector_images) {
</span><span id="18343" class="l"><a href="#18343">18343: </a>                <span class="php-comment">// convert SVG to raster image using GD or ImageMagick libraries</span>
</span><span id="18344" class="l"><a href="#18344">18344: </a>                <span class="php-keyword1">return</span> <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$file</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'SVG'</span>, <span class="php-var">$link</span>, <span class="php-var">$align</span>, <span class="php-keyword1">true</span>, <span class="php-num">300</span>, <span class="php-var">$palign</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-var">$border</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>, <span class="php-keyword1">false</span>);
</span><span id="18345" class="l"><a href="#18345">18345: </a>            }
</span><span id="18346" class="l"><a href="#18346">18346: </a>            <span class="php-var">$this</span>-&gt;svgdir = <span class="php-keyword2">dirname</span>(<span class="php-var">$file</span>);
</span><span id="18347" class="l"><a href="#18347">18347: </a>            <span class="php-var">$svgdata</span> = <span class="php-keyword2">file_get_contents</span>(<span class="php-var">$file</span>);
</span><span id="18348" class="l"><a href="#18348">18348: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$svgdata</span> === <span class="php-keyword1">false</span>) {
</span><span id="18349" class="l"><a href="#18349">18349: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-quote">'SVG file not found: '</span>.<span class="php-var">$file</span>);
</span><span id="18350" class="l"><a href="#18350">18350: </a>            }
</span><span id="18351" class="l"><a href="#18351">18351: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$x</span> === <span class="php-quote">''</span>) {
</span><span id="18352" class="l"><a href="#18352">18352: </a>                <span class="php-var">$x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="18353" class="l"><a href="#18353">18353: </a>            }
</span><span id="18354" class="l"><a href="#18354">18354: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$y</span> === <span class="php-quote">''</span>) {
</span><span id="18355" class="l"><a href="#18355">18355: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="18356" class="l"><a href="#18356">18356: </a>            }
</span><span id="18357" class="l"><a href="#18357">18357: </a>            <span class="php-var">$k</span> = <span class="php-var">$this</span>-&gt;k;
</span><span id="18358" class="l"><a href="#18358">18358: </a>            <span class="php-var">$ox</span> = <span class="php-num">0</span>;
</span><span id="18359" class="l"><a href="#18359">18359: </a>            <span class="php-var">$oy</span> = <span class="php-num">0</span>;
</span><span id="18360" class="l"><a href="#18360">18360: </a>            <span class="php-var">$ow</span> = <span class="php-var">$w</span>;
</span><span id="18361" class="l"><a href="#18361">18361: </a>            <span class="php-var">$oh</span> = <span class="php-var">$h</span>;
</span><span id="18362" class="l"><a href="#18362">18362: </a>            <span class="php-var">$aspect_ratio_align</span> = <span class="php-quote">'xMidYMid'</span>;
</span><span id="18363" class="l"><a href="#18363">18363: </a>            <span class="php-var">$aspect_ratio_ms</span> = <span class="php-quote">'meet'</span>;
</span><span id="18364" class="l"><a href="#18364">18364: </a>            <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18365" class="l"><a href="#18365">18365: </a>            <span class="php-comment">// get original image width and height</span>
</span><span id="18366" class="l"><a href="#18366">18366: </a>            <span class="php-keyword2">preg_match</span>(<span class="php-quote">'/&lt;svg([^\&gt;]*)&gt;/si'</span>, <span class="php-var">$svgdata</span>, <span class="php-var">$regs</span>);
</span><span id="18367" class="l"><a href="#18367">18367: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>])) {
</span><span id="18368" class="l"><a href="#18368">18368: </a>                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="18369" class="l"><a href="#18369">18369: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+x[\s]*=[\s]*&quot;([^&quot;]*)&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="18370" class="l"><a href="#18370">18370: </a>                    <span class="php-var">$ox</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tmp</span>[<span class="php-num">1</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18371" class="l"><a href="#18371">18371: </a>                }
</span><span id="18372" class="l"><a href="#18372">18372: </a>                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="18373" class="l"><a href="#18373">18373: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+y[\s]*=[\s]*&quot;([^&quot;]*)&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="18374" class="l"><a href="#18374">18374: </a>                    <span class="php-var">$oy</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tmp</span>[<span class="php-num">1</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18375" class="l"><a href="#18375">18375: </a>                }
</span><span id="18376" class="l"><a href="#18376">18376: </a>                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="18377" class="l"><a href="#18377">18377: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+width[\s]*=[\s]*&quot;([^&quot;]*)&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="18378" class="l"><a href="#18378">18378: </a>                    <span class="php-var">$ow</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tmp</span>[<span class="php-num">1</span>], <span class="php-num">1</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18379" class="l"><a href="#18379">18379: </a>                }
</span><span id="18380" class="l"><a href="#18380">18380: </a>                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="18381" class="l"><a href="#18381">18381: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+height[\s]*=[\s]*&quot;([^&quot;]*)&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="18382" class="l"><a href="#18382">18382: </a>                    <span class="php-var">$oh</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tmp</span>[<span class="php-num">1</span>], <span class="php-num">1</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18383" class="l"><a href="#18383">18383: </a>                }
</span><span id="18384" class="l"><a href="#18384">18384: </a>                <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="18385" class="l"><a href="#18385">18385: </a>                <span class="php-var">$view_box</span> = <span class="php-keyword1">array</span>();
</span><span id="18386" class="l"><a href="#18386">18386: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+viewBox[\s]*=[\s]*&quot;[\s]*([0-9\.\-]+)[\s]+([0-9\.\-]+)[\s]+([0-9\.]+)[\s]+([0-9\.]+)[\s]*&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="18387" class="l"><a href="#18387">18387: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$tmp</span>) == <span class="php-num">5</span>) {
</span><span id="18388" class="l"><a href="#18388">18388: </a>                        <span class="php-keyword2">array_shift</span>(<span class="php-var">$tmp</span>);
</span><span id="18389" class="l"><a href="#18389">18389: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$tmp</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="18390" class="l"><a href="#18390">18390: </a>                            <span class="php-var">$view_box</span>[<span class="php-var">$key</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$val</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18391" class="l"><a href="#18391">18391: </a>                        }
</span><span id="18392" class="l"><a href="#18392">18392: </a>                        <span class="php-var">$ox</span> = <span class="php-var">$view_box</span>[<span class="php-num">0</span>];
</span><span id="18393" class="l"><a href="#18393">18393: </a>                        <span class="php-var">$oy</span> = <span class="php-var">$view_box</span>[<span class="php-num">1</span>];
</span><span id="18394" class="l"><a href="#18394">18394: </a>                    }
</span><span id="18395" class="l"><a href="#18395">18395: </a>                    <span class="php-comment">// get aspect ratio</span>
</span><span id="18396" class="l"><a href="#18396">18396: </a>                    <span class="php-var">$tmp</span> = <span class="php-keyword1">array</span>();
</span><span id="18397" class="l"><a href="#18397">18397: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[\s]+preserveAspectRatio[\s]*=[\s]*&quot;([^&quot;]*)&quot;/si'</span>, <span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-var">$tmp</span>)) {
</span><span id="18398" class="l"><a href="#18398">18398: </a>                        <span class="php-var">$aspect_ratio</span> = <span class="php-keyword2">preg_split</span>(<span class="php-quote">&quot;/[\s]+/si&quot;</span>, <span class="php-var">$tmp</span>[<span class="php-num">1</span>]);
</span><span id="18399" class="l"><a href="#18399">18399: </a>                        <span class="php-keyword1">switch</span> (<span class="php-keyword2">count</span>(<span class="php-var">$aspect_ratio</span>)) {
</span><span id="18400" class="l"><a href="#18400">18400: </a>                            <span class="php-keyword1">case</span> <span class="php-num">3</span>: {
</span><span id="18401" class="l"><a href="#18401">18401: </a>                                <span class="php-var">$aspect_ratio_align</span> = <span class="php-var">$aspect_ratio</span>[<span class="php-num">1</span>];
</span><span id="18402" class="l"><a href="#18402">18402: </a>                                <span class="php-var">$aspect_ratio_ms</span> = <span class="php-var">$aspect_ratio</span>[<span class="php-num">2</span>];
</span><span id="18403" class="l"><a href="#18403">18403: </a>                                <span class="php-keyword1">break</span>;
</span><span id="18404" class="l"><a href="#18404">18404: </a>                            }
</span><span id="18405" class="l"><a href="#18405">18405: </a>                            <span class="php-keyword1">case</span> <span class="php-num">2</span>: {
</span><span id="18406" class="l"><a href="#18406">18406: </a>                                <span class="php-var">$aspect_ratio_align</span> = <span class="php-var">$aspect_ratio</span>[<span class="php-num">0</span>];
</span><span id="18407" class="l"><a href="#18407">18407: </a>                                <span class="php-var">$aspect_ratio_ms</span> = <span class="php-var">$aspect_ratio</span>[<span class="php-num">1</span>];
</span><span id="18408" class="l"><a href="#18408">18408: </a>                                <span class="php-keyword1">break</span>;
</span><span id="18409" class="l"><a href="#18409">18409: </a>                            }
</span><span id="18410" class="l"><a href="#18410">18410: </a>                            <span class="php-keyword1">case</span> <span class="php-num">1</span>: {
</span><span id="18411" class="l"><a href="#18411">18411: </a>                                <span class="php-var">$aspect_ratio_align</span> = <span class="php-var">$aspect_ratio</span>[<span class="php-num">0</span>];
</span><span id="18412" class="l"><a href="#18412">18412: </a>                                <span class="php-var">$aspect_ratio_ms</span> = <span class="php-quote">'meet'</span>;
</span><span id="18413" class="l"><a href="#18413">18413: </a>                                <span class="php-keyword1">break</span>;
</span><span id="18414" class="l"><a href="#18414">18414: </a>                            }
</span><span id="18415" class="l"><a href="#18415">18415: </a>                        }
</span><span id="18416" class="l"><a href="#18416">18416: </a>                    }
</span><span id="18417" class="l"><a href="#18417">18417: </a>                }
</span><span id="18418" class="l"><a href="#18418">18418: </a>            }
</span><span id="18419" class="l"><a href="#18419">18419: </a>            <span class="php-comment">// calculate image width and height on document</span>
</span><span id="18420" class="l"><a href="#18420">18420: </a>            <span class="php-keyword1">if</span> ((<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>)) {
</span><span id="18421" class="l"><a href="#18421">18421: </a>                <span class="php-comment">// convert image size to document unit</span>
</span><span id="18422" class="l"><a href="#18422">18422: </a>                <span class="php-var">$w</span> = <span class="php-var">$ow</span>;
</span><span id="18423" class="l"><a href="#18423">18423: </a>                <span class="php-var">$h</span> = <span class="php-var">$oh</span>;
</span><span id="18424" class="l"><a href="#18424">18424: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$w</span> &lt;= <span class="php-num">0</span>) {
</span><span id="18425" class="l"><a href="#18425">18425: </a>                <span class="php-var">$w</span> = <span class="php-var">$h</span> * <span class="php-var">$ow</span> / <span class="php-var">$oh</span>;
</span><span id="18426" class="l"><a href="#18426">18426: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$h</span> &lt;= <span class="php-num">0</span>) {
</span><span id="18427" class="l"><a href="#18427">18427: </a>                <span class="php-var">$h</span> = <span class="php-var">$w</span> * <span class="php-var">$oh</span> / <span class="php-var">$ow</span>;
</span><span id="18428" class="l"><a href="#18428">18428: </a>            }
</span><span id="18429" class="l"><a href="#18429">18429: </a>            <span class="php-comment">// Check whether we need a new page first as this does not fit</span>
</span><span id="18430" class="l"><a href="#18430">18430: </a>            <span class="php-var">$prev_x</span> = <span class="php-var">$this</span>-&gt;x;
</span><span id="18431" class="l"><a href="#18431">18431: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;checkPageBreak(<span class="php-var">$h</span>, <span class="php-var">$y</span>)) {
</span><span id="18432" class="l"><a href="#18432">18432: </a>                <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;y;
</span><span id="18433" class="l"><a href="#18433">18433: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="18434" class="l"><a href="#18434">18434: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$prev_x</span> - <span class="php-var">$this</span>-&gt;x);
</span><span id="18435" class="l"><a href="#18435">18435: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18436" class="l"><a href="#18436">18436: </a>                    <span class="php-var">$x</span> += (<span class="php-var">$this</span>-&gt;x - <span class="php-var">$prev_x</span>);
</span><span id="18437" class="l"><a href="#18437">18437: </a>                }
</span><span id="18438" class="l"><a href="#18438">18438: </a>            }
</span><span id="18439" class="l"><a href="#18439">18439: </a>            <span class="php-comment">// resize image to be contained on a single page</span>
</span><span id="18440" class="l"><a href="#18440">18440: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$fitonpage</span>) {
</span><span id="18441" class="l"><a href="#18441">18441: </a>                <span class="php-var">$ratio_wh</span> = <span class="php-var">$w</span> / <span class="php-var">$h</span>;
</span><span id="18442" class="l"><a href="#18442">18442: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$y</span> + <span class="php-var">$h</span>) &gt; <span class="php-var">$this</span>-&gt;PageBreakTrigger) {
</span><span id="18443" class="l"><a href="#18443">18443: </a>                    <span class="php-var">$h</span> = <span class="php-var">$this</span>-&gt;PageBreakTrigger - <span class="php-var">$y</span>;
</span><span id="18444" class="l"><a href="#18444">18444: </a>                    <span class="php-var">$w</span> = <span class="php-var">$h</span> * <span class="php-var">$ratio_wh</span>;
</span><span id="18445" class="l"><a href="#18445">18445: </a>                }
</span><span id="18446" class="l"><a href="#18446">18446: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$x</span> + <span class="php-var">$w</span>) &gt; (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin)) {
</span><span id="18447" class="l"><a href="#18447">18447: </a>                    <span class="php-var">$w</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$x</span>;
</span><span id="18448" class="l"><a href="#18448">18448: </a>                    <span class="php-var">$h</span> = <span class="php-var">$w</span> / <span class="php-var">$ratio_wh</span>;
</span><span id="18449" class="l"><a href="#18449">18449: </a>                }
</span><span id="18450" class="l"><a href="#18450">18450: </a>            }
</span><span id="18451" class="l"><a href="#18451">18451: </a>            <span class="php-comment">// set alignment</span>
</span><span id="18452" class="l"><a href="#18452">18452: </a>            <span class="php-var">$this</span>-&gt;img_rb_y = <span class="php-var">$y</span> + <span class="php-var">$h</span>;
</span><span id="18453" class="l"><a href="#18453">18453: </a>            <span class="php-comment">// set alignment</span>
</span><span id="18454" class="l"><a href="#18454">18454: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="18455" class="l"><a href="#18455">18455: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$palign</span> == <span class="php-quote">'L'</span>) {
</span><span id="18456" class="l"><a href="#18456">18456: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="18457" class="l"><a href="#18457">18457: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'C'</span>) {
</span><span id="18458" class="l"><a href="#18458">18458: </a>                    <span class="php-var">$ximg</span> = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$w</span>) / <span class="php-num">2</span>;
</span><span id="18459" class="l"><a href="#18459">18459: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'R'</span>) {
</span><span id="18460" class="l"><a href="#18460">18460: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$w</span>;
</span><span id="18461" class="l"><a href="#18461">18461: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18462" class="l"><a href="#18462">18462: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$x</span> - <span class="php-var">$w</span>;
</span><span id="18463" class="l"><a href="#18463">18463: </a>                }
</span><span id="18464" class="l"><a href="#18464">18464: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$ximg</span>;
</span><span id="18465" class="l"><a href="#18465">18465: </a>            } <span class="php-keyword1">else</span> {
</span><span id="18466" class="l"><a href="#18466">18466: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$palign</span> == <span class="php-quote">'L'</span>) {
</span><span id="18467" class="l"><a href="#18467">18467: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;lMargin;
</span><span id="18468" class="l"><a href="#18468">18468: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'C'</span>) {
</span><span id="18469" class="l"><a href="#18469">18469: </a>                    <span class="php-var">$ximg</span> = (<span class="php-var">$this</span>-&gt;w - <span class="php-var">$w</span>) / <span class="php-num">2</span>;
</span><span id="18470" class="l"><a href="#18470">18470: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-var">$palign</span> == <span class="php-quote">'R'</span>) {
</span><span id="18471" class="l"><a href="#18471">18471: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$this</span>-&gt;w - <span class="php-var">$this</span>-&gt;rMargin - <span class="php-var">$w</span>;
</span><span id="18472" class="l"><a href="#18472">18472: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18473" class="l"><a href="#18473">18473: </a>                    <span class="php-var">$ximg</span> = <span class="php-var">$x</span>;
</span><span id="18474" class="l"><a href="#18474">18474: </a>                }
</span><span id="18475" class="l"><a href="#18475">18475: </a>                <span class="php-var">$this</span>-&gt;img_rb_x = <span class="php-var">$ximg</span> + <span class="php-var">$w</span>;
</span><span id="18476" class="l"><a href="#18476">18476: </a>            }
</span><span id="18477" class="l"><a href="#18477">18477: </a>            <span class="php-comment">// store current graphic vars</span>
</span><span id="18478" class="l"><a href="#18478">18478: </a>            <span class="php-var">$gvars</span> = <span class="php-var">$this</span>-&gt;getGraphicVars();
</span><span id="18479" class="l"><a href="#18479">18479: </a>            <span class="php-comment">// store SVG position and scale factors</span>
</span><span id="18480" class="l"><a href="#18480">18480: </a>            <span class="php-var">$svgoffset_x</span> = (<span class="php-var">$ximg</span> - <span class="php-var">$ox</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="18481" class="l"><a href="#18481">18481: </a>            <span class="php-var">$svgoffset_y</span> = -(<span class="php-var">$y</span> - <span class="php-var">$oy</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="18482" class="l"><a href="#18482">18482: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$view_box</span>[<span class="php-num">2</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$view_box</span>[<span class="php-num">2</span>] &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$view_box</span>[<span class="php-num">3</span>] &gt; <span class="php-num">0</span>)) {
</span><span id="18483" class="l"><a href="#18483">18483: </a>                <span class="php-var">$ow</span> = <span class="php-var">$view_box</span>[<span class="php-num">2</span>];
</span><span id="18484" class="l"><a href="#18484">18484: </a>                <span class="php-var">$oh</span> = <span class="php-var">$view_box</span>[<span class="php-num">3</span>];
</span><span id="18485" class="l"><a href="#18485">18485: </a>            }
</span><span id="18486" class="l"><a href="#18486">18486: </a>            <span class="php-var">$svgscale_x</span> = <span class="php-var">$w</span> / <span class="php-var">$ow</span>;
</span><span id="18487" class="l"><a href="#18487">18487: </a>            <span class="php-var">$svgscale_y</span> = <span class="php-var">$h</span> / <span class="php-var">$oh</span>;
</span><span id="18488" class="l"><a href="#18488">18488: </a>            <span class="php-comment">// scaling and alignment</span>
</span><span id="18489" class="l"><a href="#18489">18489: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$aspect_ratio_align</span> != <span class="php-quote">'none'</span>) {
</span><span id="18490" class="l"><a href="#18490">18490: </a>                <span class="php-comment">// store current scaling values</span>
</span><span id="18491" class="l"><a href="#18491">18491: </a>                <span class="php-var">$svgscale_old_x</span> = <span class="php-var">$svgscale_x</span>;
</span><span id="18492" class="l"><a href="#18492">18492: </a>                <span class="php-var">$svgscale_old_y</span> = <span class="php-var">$svgscale_y</span>;
</span><span id="18493" class="l"><a href="#18493">18493: </a>                <span class="php-comment">// force uniform scaling</span>
</span><span id="18494" class="l"><a href="#18494">18494: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$aspect_ratio_ms</span> == <span class="php-quote">'slice'</span>) {
</span><span id="18495" class="l"><a href="#18495">18495: </a>                    <span class="php-comment">// the entire viewport is covered by the viewBox</span>
</span><span id="18496" class="l"><a href="#18496">18496: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$svgscale_x</span> &gt; <span class="php-var">$svgscale_y</span>) {
</span><span id="18497" class="l"><a href="#18497">18497: </a>                        <span class="php-var">$svgscale_y</span> = <span class="php-var">$svgscale_x</span>;
</span><span id="18498" class="l"><a href="#18498">18498: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$svgscale_x</span> &lt; <span class="php-var">$svgscale_y</span>) {
</span><span id="18499" class="l"><a href="#18499">18499: </a>                        <span class="php-var">$svgscale_x</span> = <span class="php-var">$svgscale_y</span>;
</span><span id="18500" class="l"><a href="#18500">18500: </a>                    }
</span><span id="18501" class="l"><a href="#18501">18501: </a>                } <span class="php-keyword1">else</span> { <span class="php-comment">// meet</span>
</span><span id="18502" class="l"><a href="#18502">18502: </a>                    <span class="php-comment">// the entire viewBox is visible within the viewport</span>
</span><span id="18503" class="l"><a href="#18503">18503: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$svgscale_x</span> &lt; <span class="php-var">$svgscale_y</span>) {
</span><span id="18504" class="l"><a href="#18504">18504: </a>                        <span class="php-var">$svgscale_y</span> = <span class="php-var">$svgscale_x</span>;
</span><span id="18505" class="l"><a href="#18505">18505: </a>                    } <span class="php-keyword1">elseif</span> (<span class="php-var">$svgscale_x</span> &gt; <span class="php-var">$svgscale_y</span>) {
</span><span id="18506" class="l"><a href="#18506">18506: </a>                        <span class="php-var">$svgscale_x</span> = <span class="php-var">$svgscale_y</span>;
</span><span id="18507" class="l"><a href="#18507">18507: </a>                    }
</span><span id="18508" class="l"><a href="#18508">18508: </a>                }
</span><span id="18509" class="l"><a href="#18509">18509: </a>                <span class="php-comment">// correct X alignment</span>
</span><span id="18510" class="l"><a href="#18510">18510: </a>                <span class="php-keyword1">switch</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$aspect_ratio_align</span>, <span class="php-num">1</span>, <span class="php-num">3</span>)) {
</span><span id="18511" class="l"><a href="#18511">18511: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Min'</span>: {
</span><span id="18512" class="l"><a href="#18512">18512: </a>                        <span class="php-comment">// do nothing</span>
</span><span id="18513" class="l"><a href="#18513">18513: </a>                        <span class="php-keyword1">break</span>;
</span><span id="18514" class="l"><a href="#18514">18514: </a>                    }
</span><span id="18515" class="l"><a href="#18515">18515: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Max'</span>: {
</span><span id="18516" class="l"><a href="#18516">18516: </a>                        <span class="php-var">$svgoffset_x</span> += ((<span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k) - (<span class="php-var">$ow</span> * <span class="php-var">$this</span>-&gt;k * <span class="php-var">$svgscale_x</span>));
</span><span id="18517" class="l"><a href="#18517">18517: </a>                        <span class="php-keyword1">break</span>;
</span><span id="18518" class="l"><a href="#18518">18518: </a>                    }
</span><span id="18519" class="l"><a href="#18519">18519: </a>                    <span class="php-keyword1">default</span>:
</span><span id="18520" class="l"><a href="#18520">18520: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Mid'</span>: {
</span><span id="18521" class="l"><a href="#18521">18521: </a>                        <span class="php-var">$svgoffset_x</span> += (((<span class="php-var">$w</span> * <span class="php-var">$this</span>-&gt;k) - (<span class="php-var">$ow</span> * <span class="php-var">$this</span>-&gt;k * <span class="php-var">$svgscale_x</span>)) / <span class="php-num">2</span>);
</span><span id="18522" class="l"><a href="#18522">18522: </a>                        <span class="php-keyword1">break</span>;
</span><span id="18523" class="l"><a href="#18523">18523: </a>                    }
</span><span id="18524" class="l"><a href="#18524">18524: </a>                }
</span><span id="18525" class="l"><a href="#18525">18525: </a>                <span class="php-comment">// correct Y alignment</span>
</span><span id="18526" class="l"><a href="#18526">18526: </a>                <span class="php-keyword1">switch</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$aspect_ratio_align</span>, <span class="php-num">5</span>)) {
</span><span id="18527" class="l"><a href="#18527">18527: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Min'</span>: {
</span><span id="18528" class="l"><a href="#18528">18528: </a>                        <span class="php-comment">// do nothing</span>
</span><span id="18529" class="l"><a href="#18529">18529: </a>                        <span class="php-keyword1">break</span>;
</span><span id="18530" class="l"><a href="#18530">18530: </a>                    }
</span><span id="18531" class="l"><a href="#18531">18531: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Max'</span>: {
</span><span id="18532" class="l"><a href="#18532">18532: </a>                        <span class="php-var">$svgoffset_y</span> -= ((<span class="php-var">$h</span> * <span class="php-var">$this</span>-&gt;k) - (<span class="php-var">$oh</span> * <span class="php-var">$this</span>-&gt;k * <span class="php-var">$svgscale_y</span>));
</span><span id="18533" class="l"><a href="#18533">18533: </a>                        <span class="php-keyword1">break</span>;
</span><span id="18534" class="l"><a href="#18534">18534: </a>                    }
</span><span id="18535" class="l"><a href="#18535">18535: </a>                    <span class="php-keyword1">default</span>:
</span><span id="18536" class="l"><a href="#18536">18536: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Mid'</span>: {
</span><span id="18537" class="l"><a href="#18537">18537: </a>                        <span class="php-var">$svgoffset_y</span> -= (((<span class="php-var">$h</span> * <span class="php-var">$this</span>-&gt;k) - (<span class="php-var">$oh</span> * <span class="php-var">$this</span>-&gt;k * <span class="php-var">$svgscale_y</span>)) / <span class="php-num">2</span>);
</span><span id="18538" class="l"><a href="#18538">18538: </a>                        <span class="php-keyword1">break</span>;
</span><span id="18539" class="l"><a href="#18539">18539: </a>                    }
</span><span id="18540" class="l"><a href="#18540">18540: </a>                }
</span><span id="18541" class="l"><a href="#18541">18541: </a>            }
</span><span id="18542" class="l"><a href="#18542">18542: </a>            <span class="php-comment">// save the current graphic state</span>
</span><span id="18543" class="l"><a href="#18543">18543: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'q'</span>.<span class="php-var">$this</span>-&gt;epsmarker);
</span><span id="18544" class="l"><a href="#18544">18544: </a>            <span class="php-comment">// set initial clipping mask</span>
</span><span id="18545" class="l"><a href="#18545">18545: </a>            <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'CNZ'</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>());
</span><span id="18546" class="l"><a href="#18546">18546: </a>            <span class="php-comment">// scale and translate</span>
</span><span id="18547" class="l"><a href="#18547">18547: </a>            <span class="php-var">$e</span> = <span class="php-var">$ox</span> * <span class="php-var">$this</span>-&gt;k * (<span class="php-num">1</span> - <span class="php-var">$svgscale_x</span>);
</span><span id="18548" class="l"><a href="#18548">18548: </a>            <span class="php-var">$f</span> = (<span class="php-var">$this</span>-&gt;h - <span class="php-var">$oy</span>) * <span class="php-var">$this</span>-&gt;k * (<span class="php-num">1</span> - <span class="php-var">$svgscale_y</span>);
</span><span id="18549" class="l"><a href="#18549">18549: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F %.3F %.3F %.3F %.3F %.3F cm'</span>, <span class="php-var">$svgscale_x</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$svgscale_y</span>, <span class="php-var">$e</span> + <span class="php-var">$svgoffset_x</span>, <span class="php-var">$f</span> + <span class="php-var">$svgoffset_y</span>));
</span><span id="18550" class="l"><a href="#18550">18550: </a>            <span class="php-comment">// creates a new XML parser to be used by the other XML functions</span>
</span><span id="18551" class="l"><a href="#18551">18551: </a>            <span class="php-var">$this</span>-&gt;parser = <span class="php-keyword2">xml_parser_create</span>(<span class="php-quote">'UTF-8'</span>);
</span><span id="18552" class="l"><a href="#18552">18552: </a>            <span class="php-comment">// the following function allows to use parser inside object</span>
</span><span id="18553" class="l"><a href="#18553">18553: </a>            <span class="php-keyword2">xml_set_object</span>(<span class="php-var">$this</span>-&gt;parser, <span class="php-var">$this</span>);
</span><span id="18554" class="l"><a href="#18554">18554: </a>            <span class="php-comment">// disable case-folding for this XML parser</span>
</span><span id="18555" class="l"><a href="#18555">18555: </a>            <span class="php-keyword2">xml_parser_set_option</span>(<span class="php-var">$this</span>-&gt;parser, XML_OPTION_CASE_FOLDING, <span class="php-num">0</span>);
</span><span id="18556" class="l"><a href="#18556">18556: </a>            <span class="php-comment">// sets the element handler functions for the XML parser</span>
</span><span id="18557" class="l"><a href="#18557">18557: </a>            <span class="php-keyword2">xml_set_element_handler</span>(<span class="php-var">$this</span>-&gt;parser, <span class="php-quote">'startSVGElementHandler'</span>, <span class="php-quote">'endSVGElementHandler'</span>);
</span><span id="18558" class="l"><a href="#18558">18558: </a>            <span class="php-comment">// sets the character data handler function for the XML parser</span>
</span><span id="18559" class="l"><a href="#18559">18559: </a>            <span class="php-keyword2">xml_set_character_data_handler</span>(<span class="php-var">$this</span>-&gt;parser, <span class="php-quote">'segSVGContentHandler'</span>);
</span><span id="18560" class="l"><a href="#18560">18560: </a>            <span class="php-comment">// start parsing an XML document</span>
</span><span id="18561" class="l"><a href="#18561">18561: </a>            <span class="php-keyword1">if</span>(!<span class="php-keyword2">xml_parse</span>(<span class="php-var">$this</span>-&gt;parser, <span class="php-var">$svgdata</span>)) {
</span><span id="18562" class="l"><a href="#18562">18562: </a>                <span class="php-var">$error_message</span> = <span class="php-keyword2">sprintf</span>(<span class="php-quote">&quot;SVG Error: %s at line %d&quot;</span>, <span class="php-keyword2">xml_error_string</span>(<span class="php-keyword2">xml_get_error_code</span>(<span class="php-var">$this</span>-&gt;parser)), <span class="php-keyword2">xml_get_current_line_number</span>(<span class="php-var">$this</span>-&gt;parser));
</span><span id="18563" class="l"><a href="#18563">18563: </a>                <span class="php-var">$this</span>-&gt;Error(<span class="php-var">$error_message</span>);
</span><span id="18564" class="l"><a href="#18564">18564: </a>            }
</span><span id="18565" class="l"><a href="#18565">18565: </a>            <span class="php-comment">// free this XML parser</span>
</span><span id="18566" class="l"><a href="#18566">18566: </a>            <span class="php-keyword2">xml_parser_free</span>(<span class="php-var">$this</span>-&gt;parser);
</span><span id="18567" class="l"><a href="#18567">18567: </a>            <span class="php-comment">// restore previous graphic state</span>
</span><span id="18568" class="l"><a href="#18568">18568: </a>            <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$this</span>-&gt;epsmarker.<span class="php-quote">'Q'</span>);
</span><span id="18569" class="l"><a href="#18569">18569: </a>            <span class="php-comment">// restore  graphic vars</span>
</span><span id="18570" class="l"><a href="#18570">18570: </a>            <span class="php-var">$this</span>-&gt;setGraphicVars(<span class="php-var">$gvars</span>);
</span><span id="18571" class="l"><a href="#18571">18571: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$border</span>)) {
</span><span id="18572" class="l"><a href="#18572">18572: </a>                <span class="php-var">$bx</span> = <span class="php-var">$x</span>;
</span><span id="18573" class="l"><a href="#18573">18573: </a>                <span class="php-var">$by</span> = <span class="php-var">$y</span>;
</span><span id="18574" class="l"><a href="#18574">18574: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$ximg</span>;
</span><span id="18575" class="l"><a href="#18575">18575: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;rtl) {
</span><span id="18576" class="l"><a href="#18576">18576: </a>                    <span class="php-var">$this</span>-&gt;x += <span class="php-var">$w</span>;
</span><span id="18577" class="l"><a href="#18577">18577: </a>                }
</span><span id="18578" class="l"><a href="#18578">18578: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="18579" class="l"><a href="#18579">18579: </a>                <span class="php-var">$this</span>-&gt;Cell(<span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">''</span>, <span class="php-var">$border</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>);
</span><span id="18580" class="l"><a href="#18580">18580: </a>                <span class="php-var">$this</span>-&gt;x = <span class="php-var">$bx</span>;
</span><span id="18581" class="l"><a href="#18581">18581: </a>                <span class="php-var">$this</span>-&gt;y = <span class="php-var">$by</span>;
</span><span id="18582" class="l"><a href="#18582">18582: </a>            }
</span><span id="18583" class="l"><a href="#18583">18583: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$link</span>) {
</span><span id="18584" class="l"><a href="#18584">18584: </a>                <span class="php-var">$this</span>-&gt;<span class="php-keyword2">Link</span>(<span class="php-var">$ximg</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$link</span>, <span class="php-num">0</span>);
</span><span id="18585" class="l"><a href="#18585">18585: </a>            }
</span><span id="18586" class="l"><a href="#18586">18586: </a>            <span class="php-comment">// set pointer to align the successive text/objects</span>
</span><span id="18587" class="l"><a href="#18587">18587: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$align</span>) {
</span><span id="18588" class="l"><a href="#18588">18588: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>:{
</span><span id="18589" class="l"><a href="#18589">18589: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span>;
</span><span id="18590" class="l"><a href="#18590">18590: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="18591" class="l"><a href="#18591">18591: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18592" class="l"><a href="#18592">18592: </a>                }
</span><span id="18593" class="l"><a href="#18593">18593: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>:{
</span><span id="18594" class="l"><a href="#18594">18594: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$y</span> + <span class="php-keyword2">round</span>(<span class="php-var">$h</span>/<span class="php-num">2</span>);
</span><span id="18595" class="l"><a href="#18595">18595: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="18596" class="l"><a href="#18596">18596: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18597" class="l"><a href="#18597">18597: </a>                }
</span><span id="18598" class="l"><a href="#18598">18598: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'B'</span>:{
</span><span id="18599" class="l"><a href="#18599">18599: </a>                    <span class="php-var">$this</span>-&gt;y = <span class="php-var">$this</span>-&gt;img_rb_y;
</span><span id="18600" class="l"><a href="#18600">18600: </a>                    <span class="php-var">$this</span>-&gt;x = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="18601" class="l"><a href="#18601">18601: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18602" class="l"><a href="#18602">18602: </a>                }
</span><span id="18603" class="l"><a href="#18603">18603: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'N'</span>:{
</span><span id="18604" class="l"><a href="#18604">18604: </a>                    <span class="php-var">$this</span>-&gt;SetY(<span class="php-var">$this</span>-&gt;img_rb_y);
</span><span id="18605" class="l"><a href="#18605">18605: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18606" class="l"><a href="#18606">18606: </a>                }
</span><span id="18607" class="l"><a href="#18607">18607: </a>                <span class="php-keyword1">default</span>:{
</span><span id="18608" class="l"><a href="#18608">18608: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18609" class="l"><a href="#18609">18609: </a>                }
</span><span id="18610" class="l"><a href="#18610">18610: </a>            }
</span><span id="18611" class="l"><a href="#18611">18611: </a>            <span class="php-var">$this</span>-&gt;endlinex = <span class="php-var">$this</span>-&gt;img_rb_x;
</span><span id="18612" class="l"><a href="#18612">18612: </a>        }
</span><span id="18613" class="l"><a href="#18613">18613: </a>
</span><span id="18614" class="l"><a href="#18614">18614: </a>        <span class="php-comment">/**
</span></span><span id="18615" class="l"><a href="#18615">18615: </a><span class="php-comment">         * Get the tranformation matrix from SVG transform attribute
</span></span><span id="18616" class="l"><a href="#18616">18616: </a><span class="php-comment">         * @param string transformation
</span></span><span id="18617" class="l"><a href="#18617">18617: </a><span class="php-comment">         * @return array of transformations
</span></span><span id="18618" class="l"><a href="#18618">18618: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18619" class="l"><a href="#18619">18619: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="18620" class="l"><a href="#18620">18620: </a><span class="php-comment">         * @access protected
</span></span><span id="18621" class="l"><a href="#18621">18621: </a><span class="php-comment">         */</span>
</span><span id="18622" class="l"><a href="#18622">18622: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getSVGTransformMatrix(<span class="php-var">$attribute</span>) {
</span><span id="18623" class="l"><a href="#18623">18623: </a>            <span class="php-comment">// identity matrix</span>
</span><span id="18624" class="l"><a href="#18624">18624: </a>            <span class="php-var">$tm</span> = <span class="php-keyword1">array</span>(<span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>);
</span><span id="18625" class="l"><a href="#18625">18625: </a>            <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18626" class="l"><a href="#18626">18626: </a>            <span class="php-keyword1">while</span> (<span class="php-var">$continue</span>) {
</span><span id="18627" class="l"><a href="#18627">18627: </a>                <span class="php-var">$continue</span> = <span class="php-keyword1">false</span>;
</span><span id="18628" class="l"><a href="#18628">18628: </a>                <span class="php-comment">// matrix</span>
</span><span id="18629" class="l"><a href="#18629">18629: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18630" class="l"><a href="#18630">18630: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/matrix\(([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18631" class="l"><a href="#18631">18631: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">''</span>, <span class="php-var">$attribute</span>);
</span><span id="18632" class="l"><a href="#18632">18632: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18633" class="l"><a href="#18633">18633: </a>                    <span class="php-var">$a</span> = <span class="php-var">$regs</span>[<span class="php-num">1</span>];
</span><span id="18634" class="l"><a href="#18634">18634: </a>                    <span class="php-var">$b</span> = <span class="php-var">$regs</span>[<span class="php-num">2</span>];
</span><span id="18635" class="l"><a href="#18635">18635: </a>                    <span class="php-var">$c</span> = <span class="php-var">$regs</span>[<span class="php-num">3</span>];
</span><span id="18636" class="l"><a href="#18636">18636: </a>                    <span class="php-var">$d</span> = <span class="php-var">$regs</span>[<span class="php-num">4</span>];
</span><span id="18637" class="l"><a href="#18637">18637: </a>                    <span class="php-var">$e</span> = <span class="php-var">$regs</span>[<span class="php-num">5</span>];
</span><span id="18638" class="l"><a href="#18638">18638: </a>                    <span class="php-var">$f</span> = <span class="php-var">$regs</span>[<span class="php-num">6</span>];
</span><span id="18639" class="l"><a href="#18639">18639: </a>                    <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;getTransformationMatrixProduct(<span class="php-var">$tm</span>, <span class="php-keyword1">array</span>(<span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-var">$c</span>, <span class="php-var">$d</span>, <span class="php-var">$e</span>, <span class="php-var">$f</span>));
</span><span id="18640" class="l"><a href="#18640">18640: </a>                }
</span><span id="18641" class="l"><a href="#18641">18641: </a>                <span class="php-comment">// translate x</span>
</span><span id="18642" class="l"><a href="#18642">18642: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18643" class="l"><a href="#18643">18643: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/translate\(([a-z0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18644" class="l"><a href="#18644">18644: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">'translate('</span>.<span class="php-var">$regs</span>[<span class="php-num">1</span>].<span class="php-quote">',0)'</span>, <span class="php-var">$attribute</span>);
</span><span id="18645" class="l"><a href="#18645">18645: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18646" class="l"><a href="#18646">18646: </a>                }
</span><span id="18647" class="l"><a href="#18647">18647: </a>                <span class="php-comment">// translate x,y</span>
</span><span id="18648" class="l"><a href="#18648">18648: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18649" class="l"><a href="#18649">18649: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/translate\(([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18650" class="l"><a href="#18650">18650: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">''</span>, <span class="php-var">$attribute</span>);
</span><span id="18651" class="l"><a href="#18651">18651: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18652" class="l"><a href="#18652">18652: </a>                    <span class="php-var">$e</span> = <span class="php-var">$regs</span>[<span class="php-num">1</span>];
</span><span id="18653" class="l"><a href="#18653">18653: </a>                    <span class="php-var">$f</span> = <span class="php-var">$regs</span>[<span class="php-num">2</span>];
</span><span id="18654" class="l"><a href="#18654">18654: </a>                    <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;getTransformationMatrixProduct(<span class="php-var">$tm</span>, <span class="php-keyword1">array</span>(<span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-var">$e</span>, <span class="php-var">$f</span>));
</span><span id="18655" class="l"><a href="#18655">18655: </a>                }
</span><span id="18656" class="l"><a href="#18656">18656: </a>                <span class="php-comment">// scale x</span>
</span><span id="18657" class="l"><a href="#18657">18657: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18658" class="l"><a href="#18658">18658: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/scale\(([a-z0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18659" class="l"><a href="#18659">18659: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">'scale('</span>.<span class="php-var">$regs</span>[<span class="php-num">1</span>].<span class="php-quote">','</span>.<span class="php-var">$regs</span>[<span class="php-num">1</span>].<span class="php-quote">')'</span>, <span class="php-var">$attribute</span>);
</span><span id="18660" class="l"><a href="#18660">18660: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18661" class="l"><a href="#18661">18661: </a>                }
</span><span id="18662" class="l"><a href="#18662">18662: </a>                <span class="php-comment">// scale x,y</span>
</span><span id="18663" class="l"><a href="#18663">18663: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18664" class="l"><a href="#18664">18664: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/scale\(([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18665" class="l"><a href="#18665">18665: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">''</span>, <span class="php-var">$attribute</span>);
</span><span id="18666" class="l"><a href="#18666">18666: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18667" class="l"><a href="#18667">18667: </a>                    <span class="php-var">$a</span> = <span class="php-var">$regs</span>[<span class="php-num">1</span>];
</span><span id="18668" class="l"><a href="#18668">18668: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$regs</span>[<span class="php-num">2</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">strlen</span>(<span class="php-keyword2">trim</span>(<span class="php-var">$regs</span>[<span class="php-num">2</span>])) &gt; <span class="php-num">0</span>)) {
</span><span id="18669" class="l"><a href="#18669">18669: </a>                        <span class="php-var">$d</span> = <span class="php-var">$regs</span>[<span class="php-num">2</span>];
</span><span id="18670" class="l"><a href="#18670">18670: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="18671" class="l"><a href="#18671">18671: </a>                        <span class="php-var">$d</span> = <span class="php-var">$a</span>;
</span><span id="18672" class="l"><a href="#18672">18672: </a>                    }
</span><span id="18673" class="l"><a href="#18673">18673: </a>                    <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;getTransformationMatrixProduct(<span class="php-var">$tm</span>, <span class="php-keyword1">array</span>(<span class="php-var">$a</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-var">$d</span>, <span class="php-num">0</span>, <span class="php-num">0</span>));
</span><span id="18674" class="l"><a href="#18674">18674: </a>                }
</span><span id="18675" class="l"><a href="#18675">18675: </a>                <span class="php-comment">// rotate ang</span>
</span><span id="18676" class="l"><a href="#18676">18676: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18677" class="l"><a href="#18677">18677: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/rotate\(([a-z0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18678" class="l"><a href="#18678">18678: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">'rotate('</span>.<span class="php-var">$regs</span>[<span class="php-num">1</span>].<span class="php-quote">',0,0)'</span>, <span class="php-var">$attribute</span>);
</span><span id="18679" class="l"><a href="#18679">18679: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18680" class="l"><a href="#18680">18680: </a>                }
</span><span id="18681" class="l"><a href="#18681">18681: </a>                <span class="php-comment">// rotate ang,x,y</span>
</span><span id="18682" class="l"><a href="#18682">18682: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18683" class="l"><a href="#18683">18683: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/rotate\(([0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)[\,\s]+([a-z0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18684" class="l"><a href="#18684">18684: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">''</span>, <span class="php-var">$attribute</span>);
</span><span id="18685" class="l"><a href="#18685">18685: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18686" class="l"><a href="#18686">18686: </a>                    <span class="php-var">$ang</span> = <span class="php-keyword2">deg2rad</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]);
</span><span id="18687" class="l"><a href="#18687">18687: </a>                    <span class="php-var">$a</span> = <span class="php-keyword2">cos</span>(<span class="php-var">$ang</span>);
</span><span id="18688" class="l"><a href="#18688">18688: </a>                    <span class="php-var">$b</span> = <span class="php-keyword2">sin</span>(<span class="php-var">$ang</span>);
</span><span id="18689" class="l"><a href="#18689">18689: </a>                    <span class="php-var">$c</span> = -<span class="php-var">$b</span>;
</span><span id="18690" class="l"><a href="#18690">18690: </a>                    <span class="php-var">$d</span> = <span class="php-var">$a</span>;
</span><span id="18691" class="l"><a href="#18691">18691: </a>                    <span class="php-var">$x</span> = <span class="php-var">$regs</span>[<span class="php-num">2</span>];
</span><span id="18692" class="l"><a href="#18692">18692: </a>                    <span class="php-var">$y</span> = <span class="php-var">$regs</span>[<span class="php-num">3</span>];
</span><span id="18693" class="l"><a href="#18693">18693: </a>                    <span class="php-var">$e</span> = (<span class="php-var">$x</span> * (<span class="php-num">1</span> - <span class="php-var">$a</span>)) - (<span class="php-var">$y</span> * <span class="php-var">$c</span>);
</span><span id="18694" class="l"><a href="#18694">18694: </a>                    <span class="php-var">$f</span> = (<span class="php-var">$y</span> * (<span class="php-num">1</span> - <span class="php-var">$d</span>)) - (<span class="php-var">$x</span> * <span class="php-var">$b</span>);
</span><span id="18695" class="l"><a href="#18695">18695: </a>                    <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;getTransformationMatrixProduct(<span class="php-var">$tm</span>, <span class="php-keyword1">array</span>(<span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-var">$c</span>, <span class="php-var">$d</span>, <span class="php-var">$e</span>, <span class="php-var">$f</span>));
</span><span id="18696" class="l"><a href="#18696">18696: </a>                }
</span><span id="18697" class="l"><a href="#18697">18697: </a>                <span class="php-comment">// skewX</span>
</span><span id="18698" class="l"><a href="#18698">18698: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18699" class="l"><a href="#18699">18699: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/skewX\(([0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18700" class="l"><a href="#18700">18700: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">''</span>, <span class="php-var">$attribute</span>);
</span><span id="18701" class="l"><a href="#18701">18701: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18702" class="l"><a href="#18702">18702: </a>                    <span class="php-var">$c</span> = <span class="php-keyword2">tan</span>(<span class="php-keyword2">deg2rad</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]));
</span><span id="18703" class="l"><a href="#18703">18703: </a>                    <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;getTransformationMatrixProduct(<span class="php-var">$tm</span>, <span class="php-keyword1">array</span>(<span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-var">$c</span>, <span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>));
</span><span id="18704" class="l"><a href="#18704">18704: </a>                }
</span><span id="18705" class="l"><a href="#18705">18705: </a>                <span class="php-comment">// skewY</span>
</span><span id="18706" class="l"><a href="#18706">18706: </a>                <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18707" class="l"><a href="#18707">18707: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/skewY\(([0-9\-\.]+)\)/si'</span>, <span class="php-var">$attribute</span>, <span class="php-var">$regs</span>)) {
</span><span id="18708" class="l"><a href="#18708">18708: </a>                    <span class="php-var">$attribute</span> = <span class="php-keyword2">str_replace</span>(<span class="php-var">$regs</span>[<span class="php-num">0</span>], <span class="php-quote">''</span>, <span class="php-var">$attribute</span>);
</span><span id="18709" class="l"><a href="#18709">18709: </a>                    <span class="php-var">$continue</span> = <span class="php-keyword1">true</span>;
</span><span id="18710" class="l"><a href="#18710">18710: </a>                    <span class="php-var">$b</span> = <span class="php-keyword2">tan</span>(<span class="php-keyword2">deg2rad</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]));
</span><span id="18711" class="l"><a href="#18711">18711: </a>                    <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;getTransformationMatrixProduct(<span class="php-var">$tm</span>, <span class="php-keyword1">array</span>(<span class="php-num">1</span>, <span class="php-var">$b</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-num">0</span>, <span class="php-num">0</span>));
</span><span id="18712" class="l"><a href="#18712">18712: </a>                }
</span><span id="18713" class="l"><a href="#18713">18713: </a>            }
</span><span id="18714" class="l"><a href="#18714">18714: </a>            <span class="php-keyword1">return</span> <span class="php-var">$tm</span>;
</span><span id="18715" class="l"><a href="#18715">18715: </a>        }
</span><span id="18716" class="l"><a href="#18716">18716: </a>
</span><span id="18717" class="l"><a href="#18717">18717: </a>        <span class="php-comment">/**
</span></span><span id="18718" class="l"><a href="#18718">18718: </a><span class="php-comment">         * Get the product of two SVG tranformation matrices
</span></span><span id="18719" class="l"><a href="#18719">18719: </a><span class="php-comment">         * @param array $ta first SVG tranformation matrix
</span></span><span id="18720" class="l"><a href="#18720">18720: </a><span class="php-comment">         * @param array $tb second SVG tranformation matrix
</span></span><span id="18721" class="l"><a href="#18721">18721: </a><span class="php-comment">         * @return transformation array
</span></span><span id="18722" class="l"><a href="#18722">18722: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18723" class="l"><a href="#18723">18723: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="18724" class="l"><a href="#18724">18724: </a><span class="php-comment">         * @access protected
</span></span><span id="18725" class="l"><a href="#18725">18725: </a><span class="php-comment">         */</span>
</span><span id="18726" class="l"><a href="#18726">18726: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getTransformationMatrixProduct(<span class="php-var">$ta</span>, <span class="php-var">$tb</span>)  {
</span><span id="18727" class="l"><a href="#18727">18727: </a>            <span class="php-var">$tm</span> = <span class="php-keyword1">array</span>();
</span><span id="18728" class="l"><a href="#18728">18728: </a>            <span class="php-var">$tm</span>[<span class="php-num">0</span>] = (<span class="php-var">$ta</span>[<span class="php-num">0</span>] * <span class="php-var">$tb</span>[<span class="php-num">0</span>]) + (<span class="php-var">$ta</span>[<span class="php-num">2</span>] * <span class="php-var">$tb</span>[<span class="php-num">1</span>]);
</span><span id="18729" class="l"><a href="#18729">18729: </a>            <span class="php-var">$tm</span>[<span class="php-num">1</span>] = (<span class="php-var">$ta</span>[<span class="php-num">1</span>] * <span class="php-var">$tb</span>[<span class="php-num">0</span>]) + (<span class="php-var">$ta</span>[<span class="php-num">3</span>] * <span class="php-var">$tb</span>[<span class="php-num">1</span>]);
</span><span id="18730" class="l"><a href="#18730">18730: </a>            <span class="php-var">$tm</span>[<span class="php-num">2</span>] = (<span class="php-var">$ta</span>[<span class="php-num">0</span>] * <span class="php-var">$tb</span>[<span class="php-num">2</span>]) + (<span class="php-var">$ta</span>[<span class="php-num">2</span>] * <span class="php-var">$tb</span>[<span class="php-num">3</span>]);
</span><span id="18731" class="l"><a href="#18731">18731: </a>            <span class="php-var">$tm</span>[<span class="php-num">3</span>] = (<span class="php-var">$ta</span>[<span class="php-num">1</span>] * <span class="php-var">$tb</span>[<span class="php-num">2</span>]) + (<span class="php-var">$ta</span>[<span class="php-num">3</span>] * <span class="php-var">$tb</span>[<span class="php-num">3</span>]);
</span><span id="18732" class="l"><a href="#18732">18732: </a>            <span class="php-var">$tm</span>[<span class="php-num">4</span>] = (<span class="php-var">$ta</span>[<span class="php-num">0</span>] * <span class="php-var">$tb</span>[<span class="php-num">4</span>]) + (<span class="php-var">$ta</span>[<span class="php-num">2</span>] * <span class="php-var">$tb</span>[<span class="php-num">5</span>]) + <span class="php-var">$ta</span>[<span class="php-num">4</span>];
</span><span id="18733" class="l"><a href="#18733">18733: </a>            <span class="php-var">$tm</span>[<span class="php-num">5</span>] = (<span class="php-var">$ta</span>[<span class="php-num">1</span>] * <span class="php-var">$tb</span>[<span class="php-num">4</span>]) + (<span class="php-var">$ta</span>[<span class="php-num">3</span>] * <span class="php-var">$tb</span>[<span class="php-num">5</span>]) + <span class="php-var">$ta</span>[<span class="php-num">5</span>];
</span><span id="18734" class="l"><a href="#18734">18734: </a>            <span class="php-keyword1">return</span> <span class="php-var">$tm</span>;
</span><span id="18735" class="l"><a href="#18735">18735: </a>        }
</span><span id="18736" class="l"><a href="#18736">18736: </a>
</span><span id="18737" class="l"><a href="#18737">18737: </a>        <span class="php-comment">/**
</span></span><span id="18738" class="l"><a href="#18738">18738: </a><span class="php-comment">         * Convert SVG transformation matrix to PDF.
</span></span><span id="18739" class="l"><a href="#18739">18739: </a><span class="php-comment">         * @param array $tm original SVG transformation matrix
</span></span><span id="18740" class="l"><a href="#18740">18740: </a><span class="php-comment">         * @return array transformation matrix
</span></span><span id="18741" class="l"><a href="#18741">18741: </a><span class="php-comment">         * @access protected
</span></span><span id="18742" class="l"><a href="#18742">18742: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="18743" class="l"><a href="#18743">18743: </a><span class="php-comment">         */</span>
</span><span id="18744" class="l"><a href="#18744">18744: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> convertSVGtMatrix(<span class="php-var">$tm</span>) {
</span><span id="18745" class="l"><a href="#18745">18745: </a>            <span class="php-var">$a</span> = <span class="php-var">$tm</span>[<span class="php-num">0</span>];
</span><span id="18746" class="l"><a href="#18746">18746: </a>            <span class="php-var">$b</span> = -<span class="php-var">$tm</span>[<span class="php-num">1</span>];
</span><span id="18747" class="l"><a href="#18747">18747: </a>            <span class="php-var">$c</span> = -<span class="php-var">$tm</span>[<span class="php-num">2</span>];
</span><span id="18748" class="l"><a href="#18748">18748: </a>            <span class="php-var">$d</span> = <span class="php-var">$tm</span>[<span class="php-num">3</span>];
</span><span id="18749" class="l"><a href="#18749">18749: </a>            <span class="php-var">$e</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tm</span>[<span class="php-num">4</span>], <span class="php-num">1</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="18750" class="l"><a href="#18750">18750: </a>            <span class="php-var">$f</span> = -<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$tm</span>[<span class="php-num">5</span>], <span class="php-num">1</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="18751" class="l"><a href="#18751">18751: </a>            <span class="php-var">$x</span> = <span class="php-num">0</span>;
</span><span id="18752" class="l"><a href="#18752">18752: </a>            <span class="php-var">$y</span> = <span class="php-var">$this</span>-&gt;h * <span class="php-var">$this</span>-&gt;k;
</span><span id="18753" class="l"><a href="#18753">18753: </a>            <span class="php-var">$e</span> = (<span class="php-var">$x</span> * (<span class="php-num">1</span> - <span class="php-var">$a</span>)) - (<span class="php-var">$y</span> * <span class="php-var">$c</span>) + <span class="php-var">$e</span>;
</span><span id="18754" class="l"><a href="#18754">18754: </a>            <span class="php-var">$f</span> = (<span class="php-var">$y</span> * (<span class="php-num">1</span> - <span class="php-var">$d</span>)) - (<span class="php-var">$x</span> * <span class="php-var">$b</span>) + <span class="php-var">$f</span>;
</span><span id="18755" class="l"><a href="#18755">18755: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(<span class="php-var">$a</span>, <span class="php-var">$b</span>, <span class="php-var">$c</span>, <span class="php-var">$d</span>, <span class="php-var">$e</span>, <span class="php-var">$f</span>);
</span><span id="18756" class="l"><a href="#18756">18756: </a>        }
</span><span id="18757" class="l"><a href="#18757">18757: </a>
</span><span id="18758" class="l"><a href="#18758">18758: </a>        <span class="php-comment">/**
</span></span><span id="18759" class="l"><a href="#18759">18759: </a><span class="php-comment">         * Apply SVG graphic transformation matrix.
</span></span><span id="18760" class="l"><a href="#18760">18760: </a><span class="php-comment">         * @param array $tm original SVG transformation matrix
</span></span><span id="18761" class="l"><a href="#18761">18761: </a><span class="php-comment">         * @access protected
</span></span><span id="18762" class="l"><a href="#18762">18762: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="18763" class="l"><a href="#18763">18763: </a><span class="php-comment">         */</span>
</span><span id="18764" class="l"><a href="#18764">18764: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> SVGTransform(<span class="php-var">$tm</span>) {
</span><span id="18765" class="l"><a href="#18765">18765: </a>            <span class="php-var">$this</span>-&gt;Transform(<span class="php-var">$this</span>-&gt;convertSVGtMatrix(<span class="php-var">$tm</span>));
</span><span id="18766" class="l"><a href="#18766">18766: </a>        }
</span><span id="18767" class="l"><a href="#18767">18767: </a>
</span><span id="18768" class="l"><a href="#18768">18768: </a>        <span class="php-comment">/**
</span></span><span id="18769" class="l"><a href="#18769">18769: </a><span class="php-comment">         * Apply the requested SVG styles (*** TO BE COMPLETED ***)
</span></span><span id="18770" class="l"><a href="#18770">18770: </a><span class="php-comment">         * @param array $svgstyle array of SVG styles to apply
</span></span><span id="18771" class="l"><a href="#18771">18771: </a><span class="php-comment">         * @param array $prevsvgstyle array of previous SVG style
</span></span><span id="18772" class="l"><a href="#18772">18772: </a><span class="php-comment">         * @param int $x X origin of the bounding box
</span></span><span id="18773" class="l"><a href="#18773">18773: </a><span class="php-comment">         * @param int $y Y origin of the bounding box
</span></span><span id="18774" class="l"><a href="#18774">18774: </a><span class="php-comment">         * @param int $w width of the bounding box
</span></span><span id="18775" class="l"><a href="#18775">18775: </a><span class="php-comment">         * @param int $h height of the bounding box
</span></span><span id="18776" class="l"><a href="#18776">18776: </a><span class="php-comment">         * @param string $clip_function clip function
</span></span><span id="18777" class="l"><a href="#18777">18777: </a><span class="php-comment">         * @param array $clip_params array of parameters for clipping function
</span></span><span id="18778" class="l"><a href="#18778">18778: </a><span class="php-comment">         * @return object style
</span></span><span id="18779" class="l"><a href="#18779">18779: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="18780" class="l"><a href="#18780">18780: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="18781" class="l"><a href="#18781">18781: </a><span class="php-comment">         * @access protected
</span></span><span id="18782" class="l"><a href="#18782">18782: </a><span class="php-comment">         */</span>
</span><span id="18783" class="l"><a href="#18783">18783: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prevsvgstyle</span>, <span class="php-var">$x</span>=<span class="php-num">0</span>, <span class="php-var">$y</span>=<span class="php-num">0</span>, <span class="php-var">$w</span>=<span class="php-num">1</span>, <span class="php-var">$h</span>=<span class="php-num">1</span>, <span class="php-var">$clip_function</span>=<span class="php-quote">''</span>, <span class="php-var">$clip_params</span>=<span class="php-keyword1">array</span>())  {
</span><span id="18784" class="l"><a href="#18784">18784: </a>            <span class="php-var">$objstyle</span> = <span class="php-quote">''</span>;
</span><span id="18785" class="l"><a href="#18785">18785: </a>            <span class="php-keyword1">if</span>(!<span class="php-keyword1">isset</span>(<span class="php-var">$svgstyle</span>[<span class="php-quote">'opacity'</span>])) {
</span><span id="18786" class="l"><a href="#18786">18786: </a>                <span class="php-keyword1">return</span> <span class="php-var">$objstyle</span>;
</span><span id="18787" class="l"><a href="#18787">18787: </a>            }
</span><span id="18788" class="l"><a href="#18788">18788: </a>            <span class="php-comment">// clip-path</span>
</span><span id="18789" class="l"><a href="#18789">18789: </a>            <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18790" class="l"><a href="#18790">18790: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/url\([\s]*\#([^\)]*)\)/si'</span>, <span class="php-var">$svgstyle</span>[<span class="php-quote">'clip-path'</span>], <span class="php-var">$regs</span>)) {
</span><span id="18791" class="l"><a href="#18791">18791: </a>                <span class="php-var">$clip_path</span> = <span class="php-var">$this</span>-&gt;svgclippaths[<span class="php-var">$regs</span>[<span class="php-num">1</span>]];
</span><span id="18792" class="l"><a href="#18792">18792: </a>                <span class="php-keyword1">foreach</span> (<span class="php-var">$clip_path</span> <span class="php-keyword1">as</span> <span class="php-var">$cp</span>) {
</span><span id="18793" class="l"><a href="#18793">18793: </a>                    <span class="php-var">$this</span>-&gt;startSVGElementHandler(<span class="php-quote">'clip-path'</span>, <span class="php-var">$cp</span>[<span class="php-quote">'name'</span>], <span class="php-var">$cp</span>[<span class="php-quote">'attribs'</span>]);
</span><span id="18794" class="l"><a href="#18794">18794: </a>                }
</span><span id="18795" class="l"><a href="#18795">18795: </a>            }
</span><span id="18796" class="l"><a href="#18796">18796: </a>            <span class="php-comment">//$this-&gt;SetAlpha(1); // reset alpha</span>
</span><span id="18797" class="l"><a href="#18797">18797: </a>            <span class="php-comment">// opacity</span>
</span><span id="18798" class="l"><a href="#18798">18798: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'opacity'</span>] != <span class="php-num">1</span>) {
</span><span id="18799" class="l"><a href="#18799">18799: </a>                <span class="php-var">$this</span>-&gt;SetAlpha(<span class="php-var">$svgstyle</span>[<span class="php-quote">'opacity'</span>]);
</span><span id="18800" class="l"><a href="#18800">18800: </a>            }
</span><span id="18801" class="l"><a href="#18801">18801: </a>            <span class="php-comment">// color</span>
</span><span id="18802" class="l"><a href="#18802">18802: </a>            <span class="php-var">$fill_color</span> = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$svgstyle</span>[<span class="php-quote">'color'</span>]);
</span><span id="18803" class="l"><a href="#18803">18803: </a>            <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="18804" class="l"><a href="#18804">18804: </a>            <span class="php-comment">// text color</span>
</span><span id="18805" class="l"><a href="#18805">18805: </a>            <span class="php-var">$text_color</span> = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$svgstyle</span>[<span class="php-quote">'text-color'</span>]);
</span><span id="18806" class="l"><a href="#18806">18806: </a>            <span class="php-var">$this</span>-&gt;SetTextColorArray(<span class="php-var">$text_color</span>);
</span><span id="18807" class="l"><a href="#18807">18807: </a>            <span class="php-comment">// clip</span>
</span><span id="18808" class="l"><a href="#18808">18808: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/rect\(([a-z0-9\-\.]*)[\s]*([a-z0-9\-\.]*)[\s]*([a-z0-9\-\.]*)[\s]*([a-z0-9\-\.]*)\)/si'</span>, <span class="php-var">$svgstyle</span>[<span class="php-quote">'clip'</span>], <span class="php-var">$regs</span>)) {
</span><span id="18809" class="l"><a href="#18809">18809: </a>                <span class="php-var">$top</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$regs</span>[<span class="php-num">1</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="18810" class="l"><a href="#18810">18810: </a>                <span class="php-var">$right</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$regs</span>[<span class="php-num">2</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$regs</span>[<span class="php-num">2</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="18811" class="l"><a href="#18811">18811: </a>                <span class="php-var">$bottom</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$regs</span>[<span class="php-num">3</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$regs</span>[<span class="php-num">3</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="18812" class="l"><a href="#18812">18812: </a>                <span class="php-var">$left</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$regs</span>[<span class="php-num">4</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$regs</span>[<span class="php-num">4</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="18813" class="l"><a href="#18813">18813: </a>                <span class="php-var">$cx</span> = <span class="php-var">$x</span> + <span class="php-var">$left</span>;
</span><span id="18814" class="l"><a href="#18814">18814: </a>                <span class="php-var">$cy</span> = <span class="php-var">$y</span> + <span class="php-var">$top</span>;
</span><span id="18815" class="l"><a href="#18815">18815: </a>                <span class="php-var">$cw</span> = <span class="php-var">$w</span> - <span class="php-var">$left</span> - <span class="php-var">$right</span>;
</span><span id="18816" class="l"><a href="#18816">18816: </a>                <span class="php-var">$ch</span> = <span class="php-var">$h</span> - <span class="php-var">$top</span> - <span class="php-var">$bottom</span>;
</span><span id="18817" class="l"><a href="#18817">18817: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'clip-rule'</span>] == <span class="php-quote">'evenodd'</span>) {
</span><span id="18818" class="l"><a href="#18818">18818: </a>                    <span class="php-var">$clip_rule</span> = <span class="php-quote">'CNZ'</span>;
</span><span id="18819" class="l"><a href="#18819">18819: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18820" class="l"><a href="#18820">18820: </a>                    <span class="php-var">$clip_rule</span> = <span class="php-quote">'CEO'</span>;
</span><span id="18821" class="l"><a href="#18821">18821: </a>                }
</span><span id="18822" class="l"><a href="#18822">18822: </a>                <span class="php-var">$this</span>-&gt;Rect(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$cw</span>, <span class="php-var">$ch</span>, <span class="php-var">$clip_rule</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>());
</span><span id="18823" class="l"><a href="#18823">18823: </a>            }
</span><span id="18824" class="l"><a href="#18824">18824: </a>            <span class="php-comment">// fill</span>
</span><span id="18825" class="l"><a href="#18825">18825: </a>            <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18826" class="l"><a href="#18826">18826: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/url\([\s]*\#([^\)]*)\)/si'</span>, <span class="php-var">$svgstyle</span>[<span class="php-quote">'fill'</span>], <span class="php-var">$regs</span>)) {
</span><span id="18827" class="l"><a href="#18827">18827: </a>                <span class="php-comment">// gradient</span>
</span><span id="18828" class="l"><a href="#18828">18828: </a>                <span class="php-var">$gradient</span> = <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$regs</span>[<span class="php-num">1</span>]];
</span><span id="18829" class="l"><a href="#18829">18829: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'xref'</span>])) {
</span><span id="18830" class="l"><a href="#18830">18830: </a>                    <span class="php-comment">// reference to another gradient definition</span>
</span><span id="18831" class="l"><a href="#18831">18831: </a>                    <span class="php-var">$newgradient</span> = <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$gradient</span>[<span class="php-quote">'xref'</span>]];
</span><span id="18832" class="l"><a href="#18832">18832: </a>                    <span class="php-var">$newgradient</span>[<span class="php-quote">'coords'</span>] = <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>];
</span><span id="18833" class="l"><a href="#18833">18833: </a>                    <span class="php-var">$newgradient</span>[<span class="php-quote">'mode'</span>] = <span class="php-var">$gradient</span>[<span class="php-quote">'mode'</span>];
</span><span id="18834" class="l"><a href="#18834">18834: </a>                    <span class="php-var">$newgradient</span>[<span class="php-quote">'gradientUnits'</span>] = <span class="php-var">$gradient</span>[<span class="php-quote">'gradientUnits'</span>];
</span><span id="18835" class="l"><a href="#18835">18835: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'gradientTransform'</span>])) {
</span><span id="18836" class="l"><a href="#18836">18836: </a>                        <span class="php-var">$newgradient</span>[<span class="php-quote">'gradientTransform'</span>] = <span class="php-var">$gradient</span>[<span class="php-quote">'gradientTransform'</span>];
</span><span id="18837" class="l"><a href="#18837">18837: </a>                    }
</span><span id="18838" class="l"><a href="#18838">18838: </a>                    <span class="php-var">$gradient</span> = <span class="php-var">$newgradient</span>;
</span><span id="18839" class="l"><a href="#18839">18839: </a>                }
</span><span id="18840" class="l"><a href="#18840">18840: </a>                <span class="php-comment">//save current Graphic State</span>
</span><span id="18841" class="l"><a href="#18841">18841: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'q'</span>);
</span><span id="18842" class="l"><a href="#18842">18842: </a>                <span class="php-comment">//set clipping area</span>
</span><span id="18843" class="l"><a href="#18843">18843: </a>                <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$clip_function</span>) <span class="php-keyword1">AND</span> <span class="php-keyword2">method_exists</span>(<span class="php-var">$this</span>, <span class="php-var">$clip_function</span>)) {
</span><span id="18844" class="l"><a href="#18844">18844: </a>                    <span class="php-var">$bbox</span> = <span class="php-keyword2">call_user_func_array</span>(<span class="php-keyword1">array</span>(<span class="php-var">$this</span>, <span class="php-var">$clip_function</span>), <span class="php-var">$clip_params</span>);
</span><span id="18845" class="l"><a href="#18845">18845: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">is_array</span>(<span class="php-var">$bbox</span>) <span class="php-keyword1">AND</span> (<span class="php-keyword2">count</span>(<span class="php-var">$bbox</span>) == <span class="php-num">4</span>)) {
</span><span id="18846" class="l"><a href="#18846">18846: </a>                        <span class="php-keyword1">list</span>(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>) = <span class="php-var">$bbox</span>;
</span><span id="18847" class="l"><a href="#18847">18847: </a>                    }
</span><span id="18848" class="l"><a href="#18848">18848: </a>                }
</span><span id="18849" class="l"><a href="#18849">18849: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$gradient</span>[<span class="php-quote">'mode'</span>] == <span class="php-quote">'measure'</span>) {
</span><span id="18850" class="l"><a href="#18850">18850: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'gradientTransform'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'gradientTransform'</span>])) {
</span><span id="18851" class="l"><a href="#18851">18851: </a>                        <span class="php-var">$gtm</span> = <span class="php-var">$gradient</span>[<span class="php-quote">'gradientTransform'</span>];
</span><span id="18852" class="l"><a href="#18852">18852: </a>                        <span class="php-comment">// apply transformation matrix</span>
</span><span id="18853" class="l"><a href="#18853">18853: </a>                        <span class="php-var">$xa</span> = (<span class="php-var">$gtm</span>[<span class="php-num">0</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>]) + (<span class="php-var">$gtm</span>[<span class="php-num">2</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>]) + <span class="php-var">$gtm</span>[<span class="php-num">4</span>];
</span><span id="18854" class="l"><a href="#18854">18854: </a>                        <span class="php-var">$ya</span> = (<span class="php-var">$gtm</span>[<span class="php-num">1</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>]) + (<span class="php-var">$gtm</span>[<span class="php-num">3</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>]) + <span class="php-var">$gtm</span>[<span class="php-num">5</span>];
</span><span id="18855" class="l"><a href="#18855">18855: </a>                        <span class="php-var">$xb</span> = (<span class="php-var">$gtm</span>[<span class="php-num">0</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>]) + (<span class="php-var">$gtm</span>[<span class="php-num">2</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>]) + <span class="php-var">$gtm</span>[<span class="php-num">4</span>];
</span><span id="18856" class="l"><a href="#18856">18856: </a>                        <span class="php-var">$yb</span> = (<span class="php-var">$gtm</span>[<span class="php-num">1</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>]) + (<span class="php-var">$gtm</span>[<span class="php-num">3</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>]) + <span class="php-var">$gtm</span>[<span class="php-num">5</span>];
</span><span id="18857" class="l"><a href="#18857">18857: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>])) {
</span><span id="18858" class="l"><a href="#18858">18858: </a>                            <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>] = <span class="php-keyword2">sqrt</span>(<span class="php-keyword2">pow</span>((<span class="php-var">$gtm</span>[<span class="php-num">0</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>]), <span class="php-num">2</span>) + <span class="php-keyword2">pow</span>((<span class="php-var">$gtm</span>[<span class="php-num">1</span>] * <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>]), <span class="php-num">2</span>));
</span><span id="18859" class="l"><a href="#18859">18859: </a>                        }
</span><span id="18860" class="l"><a href="#18860">18860: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>] = <span class="php-var">$xa</span>;
</span><span id="18861" class="l"><a href="#18861">18861: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] = <span class="php-var">$ya</span>;
</span><span id="18862" class="l"><a href="#18862">18862: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>] = <span class="php-var">$xb</span>;
</span><span id="18863" class="l"><a href="#18863">18863: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>] = <span class="php-var">$yb</span>;
</span><span id="18864" class="l"><a href="#18864">18864: </a>
</span><span id="18865" class="l"><a href="#18865">18865: </a>                    }
</span><span id="18866" class="l"><a href="#18866">18866: </a>                    <span class="php-comment">// convert SVG coordinates to user units</span>
</span><span id="18867" class="l"><a href="#18867">18867: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18868" class="l"><a href="#18868">18868: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18869" class="l"><a href="#18869">18869: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18870" class="l"><a href="#18870">18870: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18871" class="l"><a href="#18871">18871: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>])) {
</span><span id="18872" class="l"><a href="#18872">18872: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="18873" class="l"><a href="#18873">18873: </a>                    }
</span><span id="18874" class="l"><a href="#18874">18874: </a>                    <span class="php-comment">// shift units</span>
</span><span id="18875" class="l"><a href="#18875">18875: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$gradient</span>[<span class="php-quote">'gradientUnits'</span>] == <span class="php-quote">'objectBoundingBox'</span>) {
</span><span id="18876" class="l"><a href="#18876">18876: </a>                        <span class="php-comment">// convert to SVG coordinate system</span>
</span><span id="18877" class="l"><a href="#18877">18877: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>] += <span class="php-var">$x</span>;
</span><span id="18878" class="l"><a href="#18878">18878: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] += <span class="php-var">$y</span>;
</span><span id="18879" class="l"><a href="#18879">18879: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>] += <span class="php-var">$x</span>;
</span><span id="18880" class="l"><a href="#18880">18880: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>] += <span class="php-var">$y</span>;
</span><span id="18881" class="l"><a href="#18881">18881: </a>                    }
</span><span id="18882" class="l"><a href="#18882">18882: </a>                    <span class="php-comment">// calculate percentages</span>
</span><span id="18883" class="l"><a href="#18883">18883: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>] = (<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>] - <span class="php-var">$x</span>) / <span class="php-var">$w</span>;
</span><span id="18884" class="l"><a href="#18884">18884: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] = (<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] - <span class="php-var">$y</span>) / <span class="php-var">$h</span>;
</span><span id="18885" class="l"><a href="#18885">18885: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>] = (<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>] - <span class="php-var">$x</span>) / <span class="php-var">$w</span>;
</span><span id="18886" class="l"><a href="#18886">18886: </a>                    <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>] = (<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>] - <span class="php-var">$y</span>) / <span class="php-var">$h</span>;
</span><span id="18887" class="l"><a href="#18887">18887: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>])) {
</span><span id="18888" class="l"><a href="#18888">18888: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">4</span>] /= <span class="php-var">$w</span>;
</span><span id="18889" class="l"><a href="#18889">18889: </a>                    }
</span><span id="18890" class="l"><a href="#18890">18890: </a>                    <span class="php-comment">// fix values</span>
</span><span id="18891" class="l"><a href="#18891">18891: </a>                    <span class="php-keyword1">foreach</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>] <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="18892" class="l"><a href="#18892">18892: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$val</span> &lt; <span class="php-num">0</span>) {
</span><span id="18893" class="l"><a href="#18893">18893: </a>                            <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-var">$key</span>] = <span class="php-num">0</span>;
</span><span id="18894" class="l"><a href="#18894">18894: </a>                        } <span class="php-keyword1">elseif</span> (<span class="php-var">$val</span> &gt; <span class="php-num">1</span>) {
</span><span id="18895" class="l"><a href="#18895">18895: </a>                            <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-var">$key</span>] = <span class="php-num">1</span>;
</span><span id="18896" class="l"><a href="#18896">18896: </a>                        }
</span><span id="18897" class="l"><a href="#18897">18897: </a>                    }
</span><span id="18898" class="l"><a href="#18898">18898: </a>                    <span class="php-keyword1">if</span> ((<span class="php-var">$gradient</span>[<span class="php-quote">'type'</span>] == <span class="php-num">2</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>] == <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] == <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>])) {
</span><span id="18899" class="l"><a href="#18899">18899: </a>                        <span class="php-comment">// single color (no shading)</span>
</span><span id="18900" class="l"><a href="#18900">18900: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">0</span>] = <span class="php-num">1</span>;
</span><span id="18901" class="l"><a href="#18901">18901: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] = <span class="php-num">0</span>;
</span><span id="18902" class="l"><a href="#18902">18902: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">2</span>] = <span class="php-num">0.999</span>;
</span><span id="18903" class="l"><a href="#18903">18903: </a>                        <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>] = <span class="php-num">0</span>;
</span><span id="18904" class="l"><a href="#18904">18904: </a>                    }
</span><span id="18905" class="l"><a href="#18905">18905: </a>                }
</span><span id="18906" class="l"><a href="#18906">18906: </a>                <span class="php-comment">// swap Y coordinates</span>
</span><span id="18907" class="l"><a href="#18907">18907: </a>                <span class="php-var">$tmp</span> = <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>];
</span><span id="18908" class="l"><a href="#18908">18908: </a>                <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] = <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>];
</span><span id="18909" class="l"><a href="#18909">18909: </a>                <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">3</span>] = <span class="php-var">$tmp</span>;
</span><span id="18910" class="l"><a href="#18910">18910: </a>                <span class="php-comment">// set transformation map for gradient</span>
</span><span id="18911" class="l"><a href="#18911">18911: </a>                <span class="php-keyword1">if</span> ((<span class="php-var">$gradient</span>[<span class="php-quote">'type'</span>] == <span class="php-num">3</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$gradient</span>[<span class="php-quote">'mode'</span>] == <span class="php-quote">'measure'</span>)) {
</span><span id="18912" class="l"><a href="#18912">18912: </a>                    <span class="php-comment">// gradient is always circular</span>
</span><span id="18913" class="l"><a href="#18913">18913: </a>                    <span class="php-var">$cy</span> = <span class="php-var">$this</span>-&gt;h - <span class="php-var">$y</span> - (<span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>][<span class="php-num">1</span>] * (<span class="php-var">$w</span> + <span class="php-var">$h</span>));
</span><span id="18914" class="l"><a href="#18914">18914: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F 0 0 %.3F %.3F %.3F cm'</span>, <span class="php-var">$w</span>*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$w</span>*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$x</span>*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$cy</span>*<span class="php-var">$this</span>-&gt;k));
</span><span id="18915" class="l"><a href="#18915">18915: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18916" class="l"><a href="#18916">18916: </a>                    <span class="php-var">$this</span>-&gt;_out(<span class="php-keyword2">sprintf</span>(<span class="php-quote">'%.3F 0 0 %.3F %.3F %.3F cm'</span>, <span class="php-var">$w</span>*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$h</span>*<span class="php-var">$this</span>-&gt;k, <span class="php-var">$x</span>*<span class="php-var">$this</span>-&gt;k, (<span class="php-var">$this</span>-&gt;h-(<span class="php-var">$y</span>+<span class="php-var">$h</span>))*<span class="php-var">$this</span>-&gt;k));
</span><span id="18917" class="l"><a href="#18917">18917: </a>                }
</span><span id="18918" class="l"><a href="#18918">18918: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$gradient</span>[<span class="php-quote">'stops'</span>]) &gt; <span class="php-num">1</span>) {
</span><span id="18919" class="l"><a href="#18919">18919: </a>                    <span class="php-var">$this</span>-&gt;Gradient(<span class="php-var">$gradient</span>[<span class="php-quote">'type'</span>], <span class="php-var">$gradient</span>[<span class="php-quote">'coords'</span>], <span class="php-var">$gradient</span>[<span class="php-quote">'stops'</span>], <span class="php-keyword1">array</span>(), <span class="php-keyword1">false</span>);
</span><span id="18920" class="l"><a href="#18920">18920: </a>                }
</span><span id="18921" class="l"><a href="#18921">18921: </a>            } <span class="php-keyword1">elseif</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'fill'</span>] != <span class="php-quote">'none'</span>) {
</span><span id="18922" class="l"><a href="#18922">18922: </a>                <span class="php-var">$fill_color</span> = <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$svgstyle</span>[<span class="php-quote">'fill'</span>]);
</span><span id="18923" class="l"><a href="#18923">18923: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'fill-opacity'</span>] != <span class="php-num">1</span>) {
</span><span id="18924" class="l"><a href="#18924">18924: </a>                    <span class="php-var">$this</span>-&gt;SetAlpha(<span class="php-var">$svgstyle</span>[<span class="php-quote">'fill-opacity'</span>]);
</span><span id="18925" class="l"><a href="#18925">18925: </a>                }
</span><span id="18926" class="l"><a href="#18926">18926: </a>                <span class="php-var">$this</span>-&gt;SetFillColorArray(<span class="php-var">$fill_color</span>);
</span><span id="18927" class="l"><a href="#18927">18927: </a>                <span class="php-keyword1">if</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'fill-rule'</span>] == <span class="php-quote">'evenodd'</span>) {
</span><span id="18928" class="l"><a href="#18928">18928: </a>                    <span class="php-var">$objstyle</span> .= <span class="php-quote">'F*'</span>;
</span><span id="18929" class="l"><a href="#18929">18929: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18930" class="l"><a href="#18930">18930: </a>                    <span class="php-var">$objstyle</span> .= <span class="php-quote">'F'</span>;
</span><span id="18931" class="l"><a href="#18931">18931: </a>                }
</span><span id="18932" class="l"><a href="#18932">18932: </a>            }
</span><span id="18933" class="l"><a href="#18933">18933: </a>            <span class="php-comment">// stroke</span>
</span><span id="18934" class="l"><a href="#18934">18934: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke'</span>] != <span class="php-quote">'none'</span>) {
</span><span id="18935" class="l"><a href="#18935">18935: </a>                <span class="php-var">$stroke_style</span> = <span class="php-keyword1">array</span>(
</span><span id="18936" class="l"><a href="#18936">18936: </a>                    <span class="php-quote">'color'</span> =&gt; <span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke'</span>]),
</span><span id="18937" class="l"><a href="#18937">18937: </a>                    <span class="php-quote">'width'</span> =&gt; <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke-width'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>),
</span><span id="18938" class="l"><a href="#18938">18938: </a>                    <span class="php-quote">'cap'</span> =&gt; <span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke-linecap'</span>],
</span><span id="18939" class="l"><a href="#18939">18939: </a>                    <span class="php-quote">'join'</span> =&gt; <span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke-linejoin'</span>]
</span><span id="18940" class="l"><a href="#18940">18940: </a>                    );
</span><span id="18941" class="l"><a href="#18941">18941: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke-dasharray'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke-dasharray'</span>]) <span class="php-keyword1">AND</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke-dasharray'</span>] != <span class="php-quote">'none'</span>)) {
</span><span id="18942" class="l"><a href="#18942">18942: </a>                    <span class="php-var">$stroke_style</span>[<span class="php-quote">'dash'</span>] = <span class="php-var">$svgstyle</span>[<span class="php-quote">'stroke-dasharray'</span>];
</span><span id="18943" class="l"><a href="#18943">18943: </a>                }
</span><span id="18944" class="l"><a href="#18944">18944: </a>                <span class="php-var">$this</span>-&gt;SetLineStyle(<span class="php-var">$stroke_style</span>);
</span><span id="18945" class="l"><a href="#18945">18945: </a>                <span class="php-var">$objstyle</span> .= <span class="php-quote">'D'</span>;
</span><span id="18946" class="l"><a href="#18946">18946: </a>            }
</span><span id="18947" class="l"><a href="#18947">18947: </a>            <span class="php-comment">// font</span>
</span><span id="18948" class="l"><a href="#18948">18948: </a>            <span class="php-var">$regs</span> = <span class="php-keyword1">array</span>();
</span><span id="18949" class="l"><a href="#18949">18949: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$svgstyle</span>[<span class="php-quote">'font'</span>])) {
</span><span id="18950" class="l"><a href="#18950">18950: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/font-family[\s]*:[\s]*([^\s\;\&quot;]*)/si'</span>, <span class="php-var">$svgstyle</span>[<span class="php-quote">'font'</span>], <span class="php-var">$regs</span>)) {
</span><span id="18951" class="l"><a href="#18951">18951: </a>                    <span class="php-var">$font_family</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]);
</span><span id="18952" class="l"><a href="#18952">18952: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18953" class="l"><a href="#18953">18953: </a>                    <span class="php-var">$font_family</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-family'</span>];
</span><span id="18954" class="l"><a href="#18954">18954: </a>                }
</span><span id="18955" class="l"><a href="#18955">18955: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/font-size[\s]*:[\s]*([^\s\;\&quot;]*)/si'</span>, <span class="php-var">$svgstyle</span>[<span class="php-quote">'font'</span>], <span class="php-var">$regs</span>)) {
</span><span id="18956" class="l"><a href="#18956">18956: </a>                    <span class="php-var">$font_size</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]);
</span><span id="18957" class="l"><a href="#18957">18957: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18958" class="l"><a href="#18958">18958: </a>                    <span class="php-var">$font_size</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-size'</span>];
</span><span id="18959" class="l"><a href="#18959">18959: </a>                }
</span><span id="18960" class="l"><a href="#18960">18960: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/font-style[\s]*:[\s]*([^\s\;\&quot;]*)/si'</span>, <span class="php-var">$svgstyle</span>[<span class="php-quote">'font'</span>], <span class="php-var">$regs</span>)) {
</span><span id="18961" class="l"><a href="#18961">18961: </a>                    <span class="php-var">$font_style</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]);
</span><span id="18962" class="l"><a href="#18962">18962: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18963" class="l"><a href="#18963">18963: </a>                    <span class="php-var">$font_style</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-style'</span>];
</span><span id="18964" class="l"><a href="#18964">18964: </a>                }
</span><span id="18965" class="l"><a href="#18965">18965: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/font-weight[\s]*:[\s]*([^\s\;\&quot;]*)/si'</span>, <span class="php-var">$svgstyle</span>[<span class="php-quote">'font'</span>], <span class="php-var">$regs</span>)) {
</span><span id="18966" class="l"><a href="#18966">18966: </a>                    <span class="php-var">$font_weight</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$regs</span>[<span class="php-num">1</span>]);
</span><span id="18967" class="l"><a href="#18967">18967: </a>                } <span class="php-keyword1">else</span> {
</span><span id="18968" class="l"><a href="#18968">18968: </a>                    <span class="php-var">$font_weight</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-weight'</span>];
</span><span id="18969" class="l"><a href="#18969">18969: </a>                }
</span><span id="18970" class="l"><a href="#18970">18970: </a>            } <span class="php-keyword1">else</span> {
</span><span id="18971" class="l"><a href="#18971">18971: </a>                <span class="php-var">$font_family</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-family'</span>];
</span><span id="18972" class="l"><a href="#18972">18972: </a>                <span class="php-var">$font_size</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-size'</span>];
</span><span id="18973" class="l"><a href="#18973">18973: </a>                <span class="php-var">$font_style</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-style'</span>];
</span><span id="18974" class="l"><a href="#18974">18974: </a>                <span class="php-var">$font_weight</span> = <span class="php-var">$svgstyle</span>[<span class="php-quote">'font-weight'</span>];
</span><span id="18975" class="l"><a href="#18975">18975: </a>            }
</span><span id="18976" class="l"><a href="#18976">18976: </a>            <span class="php-var">$font_size</span> = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$font_size</span>, <span class="php-var">$prevsvgstyle</span>[<span class="php-quote">'font-size'</span>], <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>) * <span class="php-var">$this</span>-&gt;k;
</span><span id="18977" class="l"><a href="#18977">18977: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$font_style</span>) {
</span><span id="18978" class="l"><a href="#18978">18978: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'italic'</span>: {
</span><span id="18979" class="l"><a href="#18979">18979: </a>                    <span class="php-var">$font_style</span> = <span class="php-quote">'I'</span>;
</span><span id="18980" class="l"><a href="#18980">18980: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18981" class="l"><a href="#18981">18981: </a>                }
</span><span id="18982" class="l"><a href="#18982">18982: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'oblique'</span>: {
</span><span id="18983" class="l"><a href="#18983">18983: </a>                    <span class="php-var">$font_style</span> = <span class="php-quote">'I'</span>;
</span><span id="18984" class="l"><a href="#18984">18984: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18985" class="l"><a href="#18985">18985: </a>                }
</span><span id="18986" class="l"><a href="#18986">18986: </a>                <span class="php-keyword1">default</span>:
</span><span id="18987" class="l"><a href="#18987">18987: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'normal'</span>: {
</span><span id="18988" class="l"><a href="#18988">18988: </a>                    <span class="php-var">$font_style</span> = <span class="php-quote">''</span>;
</span><span id="18989" class="l"><a href="#18989">18989: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18990" class="l"><a href="#18990">18990: </a>                }
</span><span id="18991" class="l"><a href="#18991">18991: </a>            }
</span><span id="18992" class="l"><a href="#18992">18992: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$font_weight</span>) {
</span><span id="18993" class="l"><a href="#18993">18993: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'bold'</span>:
</span><span id="18994" class="l"><a href="#18994">18994: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'bolder'</span>: {
</span><span id="18995" class="l"><a href="#18995">18995: </a>                    <span class="php-var">$font_style</span> .= <span class="php-quote">'B'</span>;
</span><span id="18996" class="l"><a href="#18996">18996: </a>                    <span class="php-keyword1">break</span>;
</span><span id="18997" class="l"><a href="#18997">18997: </a>                }
</span><span id="18998" class="l"><a href="#18998">18998: </a>            }
</span><span id="18999" class="l"><a href="#18999">18999: </a>            <span class="php-keyword1">switch</span> (<span class="php-var">$svgstyle</span>[<span class="php-quote">'text-decoration'</span>]) {
</span><span id="19000" class="l"><a href="#19000">19000: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'underline'</span>: {
</span><span id="19001" class="l"><a href="#19001">19001: </a>                    <span class="php-var">$font_style</span> .= <span class="php-quote">'U'</span>;
</span><span id="19002" class="l"><a href="#19002">19002: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19003" class="l"><a href="#19003">19003: </a>                }
</span><span id="19004" class="l"><a href="#19004">19004: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'overline'</span>: {
</span><span id="19005" class="l"><a href="#19005">19005: </a>                    <span class="php-var">$font_style</span> .= <span class="php-quote">'O'</span>;
</span><span id="19006" class="l"><a href="#19006">19006: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19007" class="l"><a href="#19007">19007: </a>                }
</span><span id="19008" class="l"><a href="#19008">19008: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'line-through'</span>: {
</span><span id="19009" class="l"><a href="#19009">19009: </a>                    <span class="php-var">$font_style</span> .= <span class="php-quote">'D'</span>;
</span><span id="19010" class="l"><a href="#19010">19010: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19011" class="l"><a href="#19011">19011: </a>                }
</span><span id="19012" class="l"><a href="#19012">19012: </a>                <span class="php-keyword1">default</span>:
</span><span id="19013" class="l"><a href="#19013">19013: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'none'</span>: {
</span><span id="19014" class="l"><a href="#19014">19014: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19015" class="l"><a href="#19015">19015: </a>                }
</span><span id="19016" class="l"><a href="#19016">19016: </a>            }
</span><span id="19017" class="l"><a href="#19017">19017: </a>            <span class="php-var">$this</span>-&gt;SetFont(<span class="php-var">$font_family</span>, <span class="php-var">$font_style</span>, <span class="php-var">$font_size</span>);
</span><span id="19018" class="l"><a href="#19018">19018: </a>            <span class="php-keyword1">return</span> <span class="php-var">$objstyle</span>;
</span><span id="19019" class="l"><a href="#19019">19019: </a>        }
</span><span id="19020" class="l"><a href="#19020">19020: </a>
</span><span id="19021" class="l"><a href="#19021">19021: </a>        <span class="php-comment">/**
</span></span><span id="19022" class="l"><a href="#19022">19022: </a><span class="php-comment">         * Draws an SVG path
</span></span><span id="19023" class="l"><a href="#19023">19023: </a><span class="php-comment">         * @param string $d attribute d of the path SVG element
</span></span><span id="19024" class="l"><a href="#19024">19024: </a><span class="php-comment">         * @param string $style Style of rendering. Possible values are:
</span></span><span id="19025" class="l"><a href="#19025">19025: </a><span class="php-comment">         * &lt;ul&gt;
</span></span><span id="19026" class="l"><a href="#19026">19026: </a><span class="php-comment">         *   &lt;li&gt;D or empty string: Draw (default).&lt;/li&gt;
</span></span><span id="19027" class="l"><a href="#19027">19027: </a><span class="php-comment">         *   &lt;li&gt;F: Fill.&lt;/li&gt;
</span></span><span id="19028" class="l"><a href="#19028">19028: </a><span class="php-comment">         *   &lt;li&gt;F*: Fill using the even-odd rule to determine which regions lie inside the clipping path.&lt;/li&gt;
</span></span><span id="19029" class="l"><a href="#19029">19029: </a><span class="php-comment">         *   &lt;li&gt;DF or FD: Draw and fill.&lt;/li&gt;
</span></span><span id="19030" class="l"><a href="#19030">19030: </a><span class="php-comment">         *   &lt;li&gt;DF* or FD*: Draw and fill using the even-odd rule to determine which regions lie inside the clipping path.&lt;/li&gt;
</span></span><span id="19031" class="l"><a href="#19031">19031: </a><span class="php-comment">         *   &lt;li&gt;CNZ: Clipping mode (using the even-odd rule to determine which regions lie inside the clipping path).&lt;/li&gt;
</span></span><span id="19032" class="l"><a href="#19032">19032: </a><span class="php-comment">         *   &lt;li&gt;CEO: Clipping mode (using the nonzero winding number rule to determine which regions lie inside the clipping path).&lt;/li&gt;
</span></span><span id="19033" class="l"><a href="#19033">19033: </a><span class="php-comment">         * &lt;/ul&gt;
</span></span><span id="19034" class="l"><a href="#19034">19034: </a><span class="php-comment">         * @return array of container box measures (x, y, w, h)
</span></span><span id="19035" class="l"><a href="#19035">19035: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="19036" class="l"><a href="#19036">19036: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="19037" class="l"><a href="#19037">19037: </a><span class="php-comment">         * @access protected
</span></span><span id="19038" class="l"><a href="#19038">19038: </a><span class="php-comment">         */</span>
</span><span id="19039" class="l"><a href="#19039">19039: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> SVGPath(<span class="php-var">$d</span>, <span class="php-var">$style</span>=<span class="php-quote">''</span>) {
</span><span id="19040" class="l"><a href="#19040">19040: </a>            <span class="php-comment">// set fill/stroke style</span>
</span><span id="19041" class="l"><a href="#19041">19041: </a>            <span class="php-var">$op</span> = <span class="php-var">$this</span>-&gt;getPathPaintOperator(<span class="php-var">$style</span>, <span class="php-quote">''</span>);
</span><span id="19042" class="l"><a href="#19042">19042: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">empty</span>(<span class="php-var">$op</span>)) {
</span><span id="19043" class="l"><a href="#19043">19043: </a>                <span class="php-keyword1">return</span>;
</span><span id="19044" class="l"><a href="#19044">19044: </a>            }
</span><span id="19045" class="l"><a href="#19045">19045: </a>            <span class="php-var">$paths</span> = <span class="php-keyword1">array</span>();
</span><span id="19046" class="l"><a href="#19046">19046: </a>            <span class="php-keyword2">preg_match_all</span>(<span class="php-quote">'/([a-zA-Z])[\s]*([^a-zA-Z\&quot;]*)/si'</span>, <span class="php-var">$d</span>, <span class="php-var">$paths</span>, PREG_SET_ORDER);
</span><span id="19047" class="l"><a href="#19047">19047: </a>            <span class="php-var">$x</span> = <span class="php-num">0</span>;
</span><span id="19048" class="l"><a href="#19048">19048: </a>            <span class="php-var">$y</span> = <span class="php-num">0</span>;
</span><span id="19049" class="l"><a href="#19049">19049: </a>            <span class="php-var">$x1</span> = <span class="php-num">0</span>;
</span><span id="19050" class="l"><a href="#19050">19050: </a>            <span class="php-var">$y1</span> = <span class="php-num">0</span>;
</span><span id="19051" class="l"><a href="#19051">19051: </a>            <span class="php-var">$x2</span> = <span class="php-num">0</span>;
</span><span id="19052" class="l"><a href="#19052">19052: </a>            <span class="php-var">$y2</span> = <span class="php-num">0</span>;
</span><span id="19053" class="l"><a href="#19053">19053: </a>            <span class="php-var">$xmin</span> = <span class="php-num">2147483647</span>;
</span><span id="19054" class="l"><a href="#19054">19054: </a>            <span class="php-var">$xmax</span> = <span class="php-num">0</span>;
</span><span id="19055" class="l"><a href="#19055">19055: </a>            <span class="php-var">$ymin</span> = <span class="php-num">2147483647</span>;
</span><span id="19056" class="l"><a href="#19056">19056: </a>            <span class="php-var">$ymax</span> = <span class="php-num">0</span>;
</span><span id="19057" class="l"><a href="#19057">19057: </a>            <span class="php-var">$relcoord</span> = <span class="php-keyword1">false</span>;
</span><span id="19058" class="l"><a href="#19058">19058: </a>            <span class="php-comment">// draw curve pieces</span>
</span><span id="19059" class="l"><a href="#19059">19059: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$paths</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="19060" class="l"><a href="#19060">19060: </a>                <span class="php-comment">// get curve type</span>
</span><span id="19061" class="l"><a href="#19061">19061: </a>                <span class="php-var">$cmd</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$val</span>[<span class="php-num">1</span>]);
</span><span id="19062" class="l"><a href="#19062">19062: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword2">strtolower</span>(<span class="php-var">$cmd</span>) == <span class="php-var">$cmd</span>) {
</span><span id="19063" class="l"><a href="#19063">19063: </a>                    <span class="php-comment">// use relative coordinated instead of absolute</span>
</span><span id="19064" class="l"><a href="#19064">19064: </a>                    <span class="php-var">$relcoord</span> = <span class="php-keyword1">true</span>;
</span><span id="19065" class="l"><a href="#19065">19065: </a>                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19066" class="l"><a href="#19066">19066: </a>                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19067" class="l"><a href="#19067">19067: </a>                } <span class="php-keyword1">else</span> {
</span><span id="19068" class="l"><a href="#19068">19068: </a>                    <span class="php-var">$relcoord</span> = <span class="php-keyword1">false</span>;
</span><span id="19069" class="l"><a href="#19069">19069: </a>                    <span class="php-var">$xoffset</span> = <span class="php-num">0</span>;
</span><span id="19070" class="l"><a href="#19070">19070: </a>                    <span class="php-var">$yoffset</span> = <span class="php-num">0</span>;
</span><span id="19071" class="l"><a href="#19071">19071: </a>                }
</span><span id="19072" class="l"><a href="#19072">19072: </a>                <span class="php-var">$params</span> = <span class="php-keyword1">array</span>();
</span><span id="19073" class="l"><a href="#19073">19073: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$val</span>[<span class="php-num">2</span>])) {
</span><span id="19074" class="l"><a href="#19074">19074: </a>                    <span class="php-comment">// get curve parameters</span>
</span><span id="19075" class="l"><a href="#19075">19075: </a>                    <span class="php-var">$rawparams</span> = <span class="php-keyword2">preg_split</span>(<span class="php-quote">'/([\,\s]+)/si'</span>, <span class="php-keyword2">trim</span>(<span class="php-var">$val</span>[<span class="php-num">2</span>]));
</span><span id="19076" class="l"><a href="#19076">19076: </a>                    <span class="php-var">$params</span> = <span class="php-keyword1">array</span>();
</span><span id="19077" class="l"><a href="#19077">19077: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$rawparams</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19078" class="l"><a href="#19078">19078: </a>                        <span class="php-var">$params</span>[<span class="php-var">$ck</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$cp</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="19079" class="l"><a href="#19079">19079: </a>                    }
</span><span id="19080" class="l"><a href="#19080">19080: </a>                }
</span><span id="19081" class="l"><a href="#19081">19081: </a>                <span class="php-keyword1">switch</span> (<span class="php-keyword2">strtoupper</span>(<span class="php-var">$cmd</span>)) {
</span><span id="19082" class="l"><a href="#19082">19082: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'M'</span>: { <span class="php-comment">// moveto</span>
</span><span id="19083" class="l"><a href="#19083">19083: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19084" class="l"><a href="#19084">19084: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$ck</span> % <span class="php-num">2</span>) == <span class="php-num">0</span>) {
</span><span id="19085" class="l"><a href="#19085">19085: </a>                                <span class="php-var">$x</span> = <span class="php-var">$cp</span> + <span class="php-var">$xoffset</span>;
</span><span id="19086" class="l"><a href="#19086">19086: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="19087" class="l"><a href="#19087">19087: </a>                                <span class="php-var">$y</span> = <span class="php-var">$cp</span> + <span class="php-var">$yoffset</span>;
</span><span id="19088" class="l"><a href="#19088">19088: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$ck</span> == <span class="php-num">1</span>) {
</span><span id="19089" class="l"><a href="#19089">19089: </a>                                    <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19090" class="l"><a href="#19090">19090: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="19091" class="l"><a href="#19091">19091: </a>                                    <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19092" class="l"><a href="#19092">19092: </a>                                }
</span><span id="19093" class="l"><a href="#19093">19093: </a>                                <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>);
</span><span id="19094" class="l"><a href="#19094">19094: </a>                                <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>);
</span><span id="19095" class="l"><a href="#19095">19095: </a>                                <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>);
</span><span id="19096" class="l"><a href="#19096">19096: </a>                                <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>);
</span><span id="19097" class="l"><a href="#19097">19097: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19098" class="l"><a href="#19098">19098: </a>                                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19099" class="l"><a href="#19099">19099: </a>                                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19100" class="l"><a href="#19100">19100: </a>                                }
</span><span id="19101" class="l"><a href="#19101">19101: </a>                            }
</span><span id="19102" class="l"><a href="#19102">19102: </a>                        }
</span><span id="19103" class="l"><a href="#19103">19103: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19104" class="l"><a href="#19104">19104: </a>                    }
</span><span id="19105" class="l"><a href="#19105">19105: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'L'</span>: { <span class="php-comment">// lineto</span>
</span><span id="19106" class="l"><a href="#19106">19106: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19107" class="l"><a href="#19107">19107: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$ck</span> % <span class="php-num">2</span>) == <span class="php-num">0</span>) {
</span><span id="19108" class="l"><a href="#19108">19108: </a>                                <span class="php-var">$x</span> = <span class="php-var">$cp</span> + <span class="php-var">$xoffset</span>;
</span><span id="19109" class="l"><a href="#19109">19109: </a>                            } <span class="php-keyword1">else</span> {
</span><span id="19110" class="l"><a href="#19110">19110: </a>                                <span class="php-var">$y</span> = <span class="php-var">$cp</span> + <span class="php-var">$yoffset</span>;
</span><span id="19111" class="l"><a href="#19111">19111: </a>                                <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19112" class="l"><a href="#19112">19112: </a>                                <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>);
</span><span id="19113" class="l"><a href="#19113">19113: </a>                                <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>);
</span><span id="19114" class="l"><a href="#19114">19114: </a>                                <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>);
</span><span id="19115" class="l"><a href="#19115">19115: </a>                                <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>);
</span><span id="19116" class="l"><a href="#19116">19116: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19117" class="l"><a href="#19117">19117: </a>                                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19118" class="l"><a href="#19118">19118: </a>                                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19119" class="l"><a href="#19119">19119: </a>                                }
</span><span id="19120" class="l"><a href="#19120">19120: </a>                            }
</span><span id="19121" class="l"><a href="#19121">19121: </a>                        }
</span><span id="19122" class="l"><a href="#19122">19122: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19123" class="l"><a href="#19123">19123: </a>                    }
</span><span id="19124" class="l"><a href="#19124">19124: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'H'</span>: { <span class="php-comment">// horizontal lineto</span>
</span><span id="19125" class="l"><a href="#19125">19125: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19126" class="l"><a href="#19126">19126: </a>                            <span class="php-var">$x</span> = <span class="php-var">$cp</span> + <span class="php-var">$xoffset</span>;
</span><span id="19127" class="l"><a href="#19127">19127: </a>                            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19128" class="l"><a href="#19128">19128: </a>                            <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>);
</span><span id="19129" class="l"><a href="#19129">19129: </a>                            <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>);
</span><span id="19130" class="l"><a href="#19130">19130: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19131" class="l"><a href="#19131">19131: </a>                                <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19132" class="l"><a href="#19132">19132: </a>                            }
</span><span id="19133" class="l"><a href="#19133">19133: </a>                        }
</span><span id="19134" class="l"><a href="#19134">19134: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19135" class="l"><a href="#19135">19135: </a>                    }
</span><span id="19136" class="l"><a href="#19136">19136: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'V'</span>: { <span class="php-comment">// vertical lineto</span>
</span><span id="19137" class="l"><a href="#19137">19137: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19138" class="l"><a href="#19138">19138: </a>                            <span class="php-var">$y</span> = <span class="php-var">$cp</span> + <span class="php-var">$yoffset</span>;
</span><span id="19139" class="l"><a href="#19139">19139: </a>                            <span class="php-var">$this</span>-&gt;_outLine(<span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19140" class="l"><a href="#19140">19140: </a>                            <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>);
</span><span id="19141" class="l"><a href="#19141">19141: </a>                            <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>);
</span><span id="19142" class="l"><a href="#19142">19142: </a>                            <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19143" class="l"><a href="#19143">19143: </a>                                <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19144" class="l"><a href="#19144">19144: </a>                            }
</span><span id="19145" class="l"><a href="#19145">19145: </a>                        }
</span><span id="19146" class="l"><a href="#19146">19146: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19147" class="l"><a href="#19147">19147: </a>                    }
</span><span id="19148" class="l"><a href="#19148">19148: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'C'</span>: { <span class="php-comment">// curveto</span>
</span><span id="19149" class="l"><a href="#19149">19149: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19150" class="l"><a href="#19150">19150: </a>                            <span class="php-var">$params</span>[<span class="php-var">$ck</span>] = <span class="php-var">$cp</span>;
</span><span id="19151" class="l"><a href="#19151">19151: </a>                            <span class="php-keyword1">if</span> (((<span class="php-var">$ck</span> + <span class="php-num">1</span>) % <span class="php-num">6</span>) == <span class="php-num">0</span>) {
</span><span id="19152" class="l"><a href="#19152">19152: </a>                                <span class="php-var">$x1</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">5</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19153" class="l"><a href="#19153">19153: </a>                                <span class="php-var">$y1</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">4</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19154" class="l"><a href="#19154">19154: </a>                                <span class="php-var">$x2</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">3</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19155" class="l"><a href="#19155">19155: </a>                                <span class="php-var">$y2</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">2</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19156" class="l"><a href="#19156">19156: </a>                                <span class="php-var">$x</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">1</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19157" class="l"><a href="#19157">19157: </a>                                <span class="php-var">$y</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19158" class="l"><a href="#19158">19158: </a>                                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19159" class="l"><a href="#19159">19159: </a>                                <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>, <span class="php-var">$x1</span>, <span class="php-var">$x2</span>);
</span><span id="19160" class="l"><a href="#19160">19160: </a>                                <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>, <span class="php-var">$y1</span>, <span class="php-var">$y2</span>);
</span><span id="19161" class="l"><a href="#19161">19161: </a>                                <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>, <span class="php-var">$x1</span>, <span class="php-var">$x2</span>);
</span><span id="19162" class="l"><a href="#19162">19162: </a>                                <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>, <span class="php-var">$y1</span>, <span class="php-var">$y2</span>);
</span><span id="19163" class="l"><a href="#19163">19163: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19164" class="l"><a href="#19164">19164: </a>                                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19165" class="l"><a href="#19165">19165: </a>                                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19166" class="l"><a href="#19166">19166: </a>                                }
</span><span id="19167" class="l"><a href="#19167">19167: </a>                            }
</span><span id="19168" class="l"><a href="#19168">19168: </a>                        }
</span><span id="19169" class="l"><a href="#19169">19169: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19170" class="l"><a href="#19170">19170: </a>                    }
</span><span id="19171" class="l"><a href="#19171">19171: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'S'</span>: { <span class="php-comment">// shorthand/smooth curveto</span>
</span><span id="19172" class="l"><a href="#19172">19172: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19173" class="l"><a href="#19173">19173: </a>                            <span class="php-var">$params</span>[<span class="php-var">$ck</span>] = <span class="php-var">$cp</span>;
</span><span id="19174" class="l"><a href="#19174">19174: </a>                            <span class="php-keyword1">if</span> (((<span class="php-var">$ck</span> + <span class="php-num">1</span>) % <span class="php-num">4</span>) == <span class="php-num">0</span>) {
</span><span id="19175" class="l"><a href="#19175">19175: </a>                                <span class="php-keyword1">if</span> ((<span class="php-var">$key</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-keyword2">strtoupper</span>(<span class="php-var">$paths</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-num">1</span>]) == <span class="php-quote">'C'</span>) <span class="php-keyword1">OR</span> (<span class="php-keyword2">strtoupper</span>(<span class="php-var">$paths</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-num">1</span>]) == <span class="php-quote">'S'</span>))) {
</span><span id="19176" class="l"><a href="#19176">19176: </a>                                    <span class="php-var">$x1</span> = (<span class="php-num">2</span> * <span class="php-var">$x</span>) - <span class="php-var">$x2</span>;
</span><span id="19177" class="l"><a href="#19177">19177: </a>                                    <span class="php-var">$y1</span> = (<span class="php-num">2</span> * <span class="php-var">$y</span>) - <span class="php-var">$y2</span>;
</span><span id="19178" class="l"><a href="#19178">19178: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="19179" class="l"><a href="#19179">19179: </a>                                    <span class="php-var">$x1</span> = <span class="php-var">$x</span>;
</span><span id="19180" class="l"><a href="#19180">19180: </a>                                    <span class="php-var">$y1</span> = <span class="php-var">$y</span>;
</span><span id="19181" class="l"><a href="#19181">19181: </a>                                }
</span><span id="19182" class="l"><a href="#19182">19182: </a>                                <span class="php-var">$x2</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">3</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19183" class="l"><a href="#19183">19183: </a>                                <span class="php-var">$y2</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">2</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19184" class="l"><a href="#19184">19184: </a>                                <span class="php-var">$x</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">1</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19185" class="l"><a href="#19185">19185: </a>                                <span class="php-var">$y</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19186" class="l"><a href="#19186">19186: </a>                                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19187" class="l"><a href="#19187">19187: </a>                                <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>, <span class="php-var">$x1</span>, <span class="php-var">$x2</span>);
</span><span id="19188" class="l"><a href="#19188">19188: </a>                                <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>, <span class="php-var">$y1</span>, <span class="php-var">$y2</span>);
</span><span id="19189" class="l"><a href="#19189">19189: </a>                                <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>, <span class="php-var">$x1</span>, <span class="php-var">$x2</span>);
</span><span id="19190" class="l"><a href="#19190">19190: </a>                                <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>, <span class="php-var">$y1</span>, <span class="php-var">$y2</span>);
</span><span id="19191" class="l"><a href="#19191">19191: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19192" class="l"><a href="#19192">19192: </a>                                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19193" class="l"><a href="#19193">19193: </a>                                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19194" class="l"><a href="#19194">19194: </a>                                }
</span><span id="19195" class="l"><a href="#19195">19195: </a>                            }
</span><span id="19196" class="l"><a href="#19196">19196: </a>                        }
</span><span id="19197" class="l"><a href="#19197">19197: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19198" class="l"><a href="#19198">19198: </a>                    }
</span><span id="19199" class="l"><a href="#19199">19199: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Q'</span>: { <span class="php-comment">//</span>
</span><span id="19200" class="l"><a href="#19200">19200: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19201" class="l"><a href="#19201">19201: </a>                            <span class="php-var">$params</span>[<span class="php-var">$ck</span>] = <span class="php-var">$cp</span>;
</span><span id="19202" class="l"><a href="#19202">19202: </a>                            <span class="php-keyword1">if</span> (((<span class="php-var">$ck</span> + <span class="php-num">1</span>) % <span class="php-num">4</span>) == <span class="php-num">0</span>) {
</span><span id="19203" class="l"><a href="#19203">19203: </a>                                <span class="php-comment">// convert quadratic points to cubic points</span>
</span><span id="19204" class="l"><a href="#19204">19204: </a>                                <span class="php-var">$x1</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">3</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19205" class="l"><a href="#19205">19205: </a>                                <span class="php-var">$y1</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">2</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19206" class="l"><a href="#19206">19206: </a>                                <span class="php-var">$xa</span> = (<span class="php-var">$x</span> + (<span class="php-num">2</span> * <span class="php-var">$x1</span>)) / <span class="php-num">3</span>;
</span><span id="19207" class="l"><a href="#19207">19207: </a>                                <span class="php-var">$ya</span> = (<span class="php-var">$y</span> + (<span class="php-num">2</span> * <span class="php-var">$y1</span>)) / <span class="php-num">3</span>;
</span><span id="19208" class="l"><a href="#19208">19208: </a>                                <span class="php-var">$x</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">1</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19209" class="l"><a href="#19209">19209: </a>                                <span class="php-var">$y</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19210" class="l"><a href="#19210">19210: </a>                                <span class="php-var">$xb</span> = (<span class="php-var">$x</span> + (<span class="php-num">2</span> * <span class="php-var">$x1</span>)) / <span class="php-num">3</span>;
</span><span id="19211" class="l"><a href="#19211">19211: </a>                                <span class="php-var">$yb</span> = (<span class="php-var">$y</span> + (<span class="php-num">2</span> * <span class="php-var">$y1</span>)) / <span class="php-num">3</span>;
</span><span id="19212" class="l"><a href="#19212">19212: </a>                                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$xa</span>, <span class="php-var">$ya</span>, <span class="php-var">$xb</span>, <span class="php-var">$yb</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19213" class="l"><a href="#19213">19213: </a>                                <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>, <span class="php-var">$xa</span>, <span class="php-var">$xb</span>);
</span><span id="19214" class="l"><a href="#19214">19214: </a>                                <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>, <span class="php-var">$ya</span>, <span class="php-var">$yb</span>);
</span><span id="19215" class="l"><a href="#19215">19215: </a>                                <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>, <span class="php-var">$xa</span>, <span class="php-var">$xb</span>);
</span><span id="19216" class="l"><a href="#19216">19216: </a>                                <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>, <span class="php-var">$ya</span>, <span class="php-var">$yb</span>);
</span><span id="19217" class="l"><a href="#19217">19217: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19218" class="l"><a href="#19218">19218: </a>                                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19219" class="l"><a href="#19219">19219: </a>                                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19220" class="l"><a href="#19220">19220: </a>                                }
</span><span id="19221" class="l"><a href="#19221">19221: </a>                            }
</span><span id="19222" class="l"><a href="#19222">19222: </a>                        }
</span><span id="19223" class="l"><a href="#19223">19223: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19224" class="l"><a href="#19224">19224: </a>                    }
</span><span id="19225" class="l"><a href="#19225">19225: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'T'</span>: { <span class="php-comment">//</span>
</span><span id="19226" class="l"><a href="#19226">19226: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19227" class="l"><a href="#19227">19227: </a>                            <span class="php-var">$params</span>[<span class="php-var">$ck</span>] = <span class="php-var">$cp</span>;
</span><span id="19228" class="l"><a href="#19228">19228: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$ck</span> % <span class="php-num">2</span>) != <span class="php-num">0</span>) {
</span><span id="19229" class="l"><a href="#19229">19229: </a>                                <span class="php-keyword1">if</span> ((<span class="php-var">$key</span> &gt; <span class="php-num">0</span>) <span class="php-keyword1">AND</span> ((<span class="php-keyword2">strtoupper</span>(<span class="php-var">$paths</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-num">1</span>]) == <span class="php-quote">'Q'</span>) <span class="php-keyword1">OR</span> (<span class="php-keyword2">strtoupper</span>(<span class="php-var">$paths</span>[(<span class="php-var">$key</span> - <span class="php-num">1</span>)][<span class="php-num">1</span>]) == <span class="php-quote">'T'</span>))) {
</span><span id="19230" class="l"><a href="#19230">19230: </a>                                    <span class="php-var">$x1</span> = (<span class="php-num">2</span> * <span class="php-var">$x</span>) - <span class="php-var">$x1</span>;
</span><span id="19231" class="l"><a href="#19231">19231: </a>                                    <span class="php-var">$y1</span> = (<span class="php-num">2</span> * <span class="php-var">$y</span>) - <span class="php-var">$y1</span>;
</span><span id="19232" class="l"><a href="#19232">19232: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="19233" class="l"><a href="#19233">19233: </a>                                    <span class="php-var">$x1</span> = <span class="php-var">$x</span>;
</span><span id="19234" class="l"><a href="#19234">19234: </a>                                    <span class="php-var">$y1</span> = <span class="php-var">$y</span>;
</span><span id="19235" class="l"><a href="#19235">19235: </a>                                }
</span><span id="19236" class="l"><a href="#19236">19236: </a>                                <span class="php-comment">// convert quadratic points to cubic points</span>
</span><span id="19237" class="l"><a href="#19237">19237: </a>                                <span class="php-var">$xa</span> = (<span class="php-var">$x</span> + (<span class="php-num">2</span> * <span class="php-var">$x1</span>)) / <span class="php-num">3</span>;
</span><span id="19238" class="l"><a href="#19238">19238: </a>                                <span class="php-var">$ya</span> = (<span class="php-var">$y</span> + (<span class="php-num">2</span> * <span class="php-var">$y1</span>)) / <span class="php-num">3</span>;
</span><span id="19239" class="l"><a href="#19239">19239: </a>                                <span class="php-var">$x</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">1</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19240" class="l"><a href="#19240">19240: </a>                                <span class="php-var">$y</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span>)] + <span class="php-var">$yoffset</span>;
</span><span id="19241" class="l"><a href="#19241">19241: </a>                                <span class="php-var">$xb</span> = (<span class="php-var">$x</span> + (<span class="php-num">2</span> * <span class="php-var">$x1</span>)) / <span class="php-num">3</span>;
</span><span id="19242" class="l"><a href="#19242">19242: </a>                                <span class="php-var">$yb</span> = (<span class="php-var">$y</span> + (<span class="php-num">2</span> * <span class="php-var">$y1</span>)) / <span class="php-num">3</span>;
</span><span id="19243" class="l"><a href="#19243">19243: </a>                                <span class="php-var">$this</span>-&gt;_outCurve(<span class="php-var">$xa</span>, <span class="php-var">$ya</span>, <span class="php-var">$xb</span>, <span class="php-var">$yb</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19244" class="l"><a href="#19244">19244: </a>                                <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>, <span class="php-var">$x1</span>, <span class="php-var">$x2</span>);
</span><span id="19245" class="l"><a href="#19245">19245: </a>                                <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>, <span class="php-var">$y1</span>, <span class="php-var">$y2</span>);
</span><span id="19246" class="l"><a href="#19246">19246: </a>                                <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>, <span class="php-var">$x1</span>, <span class="php-var">$x2</span>);
</span><span id="19247" class="l"><a href="#19247">19247: </a>                                <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>, <span class="php-var">$y1</span>, <span class="php-var">$y2</span>);
</span><span id="19248" class="l"><a href="#19248">19248: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19249" class="l"><a href="#19249">19249: </a>                                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19250" class="l"><a href="#19250">19250: </a>                                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19251" class="l"><a href="#19251">19251: </a>                                }
</span><span id="19252" class="l"><a href="#19252">19252: </a>                            }
</span><span id="19253" class="l"><a href="#19253">19253: </a>                        }
</span><span id="19254" class="l"><a href="#19254">19254: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19255" class="l"><a href="#19255">19255: </a>                    }
</span><span id="19256" class="l"><a href="#19256">19256: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'A'</span>: { <span class="php-comment">// elliptical arc</span>
</span><span id="19257" class="l"><a href="#19257">19257: </a>                        <span class="php-keyword1">foreach</span> (<span class="php-var">$params</span> <span class="php-keyword1">as</span> <span class="php-var">$ck</span> =&gt; <span class="php-var">$cp</span>) {
</span><span id="19258" class="l"><a href="#19258">19258: </a>                            <span class="php-var">$params</span>[<span class="php-var">$ck</span>] = <span class="php-var">$cp</span>;
</span><span id="19259" class="l"><a href="#19259">19259: </a>                            <span class="php-keyword1">if</span> (((<span class="php-var">$ck</span> + <span class="php-num">1</span>) % <span class="php-num">7</span>) == <span class="php-num">0</span>) {
</span><span id="19260" class="l"><a href="#19260">19260: </a>                                <span class="php-var">$x0</span> = <span class="php-var">$x</span>;
</span><span id="19261" class="l"><a href="#19261">19261: </a>                                <span class="php-var">$y0</span> = <span class="php-var">$y</span>;
</span><span id="19262" class="l"><a href="#19262">19262: </a>                                <span class="php-var">$rx</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">6</span>)]);
</span><span id="19263" class="l"><a href="#19263">19263: </a>                                <span class="php-var">$ry</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">5</span>)]);
</span><span id="19264" class="l"><a href="#19264">19264: </a>                                <span class="php-var">$ang</span> = -<span class="php-var">$rawparams</span>[(<span class="php-var">$ck</span> - <span class="php-num">4</span>)];
</span><span id="19265" class="l"><a href="#19265">19265: </a>                                <span class="php-var">$angle</span> = <span class="php-keyword2">deg2rad</span>(<span class="php-var">$ang</span>);
</span><span id="19266" class="l"><a href="#19266">19266: </a>                                <span class="php-var">$fa</span> = <span class="php-var">$rawparams</span>[(<span class="php-var">$ck</span> - <span class="php-num">3</span>)]; <span class="php-comment">// large-arc-flag</span>
</span><span id="19267" class="l"><a href="#19267">19267: </a>                                <span class="php-var">$fs</span> = <span class="php-var">$rawparams</span>[(<span class="php-var">$ck</span> - <span class="php-num">2</span>)]; <span class="php-comment">// sweep-flag</span>
</span><span id="19268" class="l"><a href="#19268">19268: </a>                                <span class="php-var">$x</span> = <span class="php-var">$params</span>[(<span class="php-var">$ck</span> - <span class="php-num">1</span>)] + <span class="php-var">$xoffset</span>;
</span><span id="19269" class="l"><a href="#19269">19269: </a>                                <span class="php-var">$y</span> = <span class="php-var">$params</span>[<span class="php-var">$ck</span>] + <span class="php-var">$yoffset</span>;
</span><span id="19270" class="l"><a href="#19270">19270: </a>                                <span class="php-var">$cos_ang</span> = <span class="php-keyword2">cos</span>(<span class="php-var">$angle</span>);
</span><span id="19271" class="l"><a href="#19271">19271: </a>                                <span class="php-var">$sin_ang</span> = <span class="php-keyword2">sin</span>(<span class="php-var">$angle</span>);
</span><span id="19272" class="l"><a href="#19272">19272: </a>                                <span class="php-var">$a</span> = (<span class="php-var">$x0</span> - <span class="php-var">$x</span>) / <span class="php-num">2</span>;
</span><span id="19273" class="l"><a href="#19273">19273: </a>                                <span class="php-var">$b</span> = (<span class="php-var">$y0</span> - <span class="php-var">$y</span>) / <span class="php-num">2</span>;
</span><span id="19274" class="l"><a href="#19274">19274: </a>                                <span class="php-var">$xa</span> = (<span class="php-var">$a</span> * <span class="php-var">$cos_ang</span>) - (<span class="php-var">$b</span> * <span class="php-var">$sin_ang</span>);
</span><span id="19275" class="l"><a href="#19275">19275: </a>                                <span class="php-var">$ya</span> = (<span class="php-var">$a</span> * <span class="php-var">$sin_ang</span>) + (<span class="php-var">$b</span> * <span class="php-var">$cos_ang</span>);
</span><span id="19276" class="l"><a href="#19276">19276: </a>                                <span class="php-var">$rx2</span> = <span class="php-var">$rx</span> * <span class="php-var">$rx</span>;
</span><span id="19277" class="l"><a href="#19277">19277: </a>                                <span class="php-var">$ry2</span> = <span class="php-var">$ry</span> * <span class="php-var">$ry</span>;
</span><span id="19278" class="l"><a href="#19278">19278: </a>                                <span class="php-var">$xa2</span> = <span class="php-var">$xa</span> * <span class="php-var">$xa</span>;
</span><span id="19279" class="l"><a href="#19279">19279: </a>                                <span class="php-var">$ya2</span> = <span class="php-var">$ya</span> * <span class="php-var">$ya</span>;
</span><span id="19280" class="l"><a href="#19280">19280: </a>                                <span class="php-var">$delta</span> = (<span class="php-var">$xa2</span> / <span class="php-var">$rx2</span>) + (<span class="php-var">$ya2</span> / <span class="php-var">$ry2</span>);
</span><span id="19281" class="l"><a href="#19281">19281: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$delta</span> &gt; <span class="php-num">1</span>) {
</span><span id="19282" class="l"><a href="#19282">19282: </a>                                    <span class="php-var">$rx</span> *= <span class="php-keyword2">sqrt</span>(<span class="php-var">$delta</span>);
</span><span id="19283" class="l"><a href="#19283">19283: </a>                                    <span class="php-var">$ry</span> *= <span class="php-keyword2">sqrt</span>(<span class="php-var">$delta</span>);
</span><span id="19284" class="l"><a href="#19284">19284: </a>                                    <span class="php-var">$rx2</span> = <span class="php-var">$rx</span> * <span class="php-var">$rx</span>;
</span><span id="19285" class="l"><a href="#19285">19285: </a>                                    <span class="php-var">$ry2</span> = <span class="php-var">$ry</span> * <span class="php-var">$ry</span>;
</span><span id="19286" class="l"><a href="#19286">19286: </a>                                }
</span><span id="19287" class="l"><a href="#19287">19287: </a>                                <span class="php-var">$numerator</span> = ((<span class="php-var">$rx2</span> * <span class="php-var">$ry2</span>) - (<span class="php-var">$rx2</span> * <span class="php-var">$ya2</span>) - (<span class="php-var">$ry2</span> * <span class="php-var">$xa2</span>));
</span><span id="19288" class="l"><a href="#19288">19288: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$numerator</span> &lt; <span class="php-num">0</span>) {
</span><span id="19289" class="l"><a href="#19289">19289: </a>                                    <span class="php-var">$root</span> = <span class="php-num">0</span>;
</span><span id="19290" class="l"><a href="#19290">19290: </a>                                } <span class="php-keyword1">else</span> {
</span><span id="19291" class="l"><a href="#19291">19291: </a>                                    <span class="php-var">$root</span> = <span class="php-keyword2">sqrt</span>(<span class="php-var">$numerator</span> / ((<span class="php-var">$rx2</span> * <span class="php-var">$ya2</span>) + (<span class="php-var">$ry2</span> * <span class="php-var">$xa2</span>)));
</span><span id="19292" class="l"><a href="#19292">19292: </a>                                }
</span><span id="19293" class="l"><a href="#19293">19293: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$fa</span> == <span class="php-var">$fs</span>) {
</span><span id="19294" class="l"><a href="#19294">19294: </a>                                    <span class="php-var">$root</span> *= -<span class="php-num">1</span>;
</span><span id="19295" class="l"><a href="#19295">19295: </a>                                }
</span><span id="19296" class="l"><a href="#19296">19296: </a>                                <span class="php-var">$cax</span> = <span class="php-var">$root</span> * ((<span class="php-var">$rx</span> * <span class="php-var">$ya</span>) / <span class="php-var">$ry</span>);
</span><span id="19297" class="l"><a href="#19297">19297: </a>                                <span class="php-var">$cay</span> = -<span class="php-var">$root</span> * ((<span class="php-var">$ry</span> * <span class="php-var">$xa</span>) / <span class="php-var">$rx</span>);
</span><span id="19298" class="l"><a href="#19298">19298: </a>                                <span class="php-comment">// coordinates of ellipse center</span>
</span><span id="19299" class="l"><a href="#19299">19299: </a>                                <span class="php-var">$cx</span> = (<span class="php-var">$cax</span> * <span class="php-var">$cos_ang</span>) - (<span class="php-var">$cay</span> * <span class="php-var">$sin_ang</span>) + ((<span class="php-var">$x0</span> + <span class="php-var">$x</span>) / <span class="php-num">2</span>);
</span><span id="19300" class="l"><a href="#19300">19300: </a>                                <span class="php-var">$cy</span> = (<span class="php-var">$cax</span> * <span class="php-var">$sin_ang</span>) + (<span class="php-var">$cay</span> * <span class="php-var">$cos_ang</span>) + ((<span class="php-var">$y0</span> + <span class="php-var">$y</span>) / <span class="php-num">2</span>);
</span><span id="19301" class="l"><a href="#19301">19301: </a>                                <span class="php-comment">// get angles</span>
</span><span id="19302" class="l"><a href="#19302">19302: </a>                                <span class="php-var">$angs</span> = <span class="php-var">$this</span>-&gt;getVectorsAngle(<span class="php-num">1</span>, <span class="php-num">0</span>, ((<span class="php-var">$xa</span> - <span class="php-var">$cax</span>) / <span class="php-var">$rx</span>), ((<span class="php-var">$cay</span> - <span class="php-var">$ya</span>) / <span class="php-var">$ry</span>));
</span><span id="19303" class="l"><a href="#19303">19303: </a>                                <span class="php-var">$dang</span> = <span class="php-var">$this</span>-&gt;getVectorsAngle(((<span class="php-var">$xa</span> - <span class="php-var">$cax</span>) / <span class="php-var">$rx</span>), ((<span class="php-var">$ya</span> - <span class="php-var">$cay</span>) / <span class="php-var">$ry</span>), ((-<span class="php-var">$xa</span> - <span class="php-var">$cax</span>) / <span class="php-var">$rx</span>), ((-<span class="php-var">$ya</span> - <span class="php-var">$cay</span>) / <span class="php-var">$ry</span>));
</span><span id="19304" class="l"><a href="#19304">19304: </a>                                <span class="php-keyword1">if</span> ((<span class="php-var">$fs</span> == <span class="php-num">0</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dang</span> &gt; <span class="php-num">0</span>)) {
</span><span id="19305" class="l"><a href="#19305">19305: </a>                                    <span class="php-var">$dang</span> -= (<span class="php-num">2</span> * M_PI);
</span><span id="19306" class="l"><a href="#19306">19306: </a>                                } <span class="php-keyword1">elseif</span> ((<span class="php-var">$fs</span> == <span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$dang</span> &lt; <span class="php-num">0</span>)) {
</span><span id="19307" class="l"><a href="#19307">19307: </a>                                    <span class="php-var">$dang</span> += (<span class="php-num">2</span> * M_PI);
</span><span id="19308" class="l"><a href="#19308">19308: </a>                                }
</span><span id="19309" class="l"><a href="#19309">19309: </a>                                <span class="php-var">$angf</span> = <span class="php-var">$angs</span> - <span class="php-var">$dang</span>;
</span><span id="19310" class="l"><a href="#19310">19310: </a>                                <span class="php-keyword1">if</span> ((<span class="php-var">$fs</span> == <span class="php-num">1</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$angs</span> &gt; <span class="php-var">$angf</span>)) {
</span><span id="19311" class="l"><a href="#19311">19311: </a>                                    <span class="php-var">$tmp</span> = <span class="php-var">$angs</span>;
</span><span id="19312" class="l"><a href="#19312">19312: </a>                                    <span class="php-var">$angs</span> = <span class="php-var">$angf</span>;
</span><span id="19313" class="l"><a href="#19313">19313: </a>                                    <span class="php-var">$angf</span> = <span class="php-var">$tmp</span>;
</span><span id="19314" class="l"><a href="#19314">19314: </a>                                }
</span><span id="19315" class="l"><a href="#19315">19315: </a>                                <span class="php-var">$angs</span> = <span class="php-keyword2">rad2deg</span>(<span class="php-var">$angs</span>);
</span><span id="19316" class="l"><a href="#19316">19316: </a>                                <span class="php-var">$angf</span> = <span class="php-keyword2">rad2deg</span>(<span class="php-var">$angf</span>);
</span><span id="19317" class="l"><a href="#19317">19317: </a>                                <span class="php-var">$pie</span> = <span class="php-keyword1">false</span>;
</span><span id="19318" class="l"><a href="#19318">19318: </a>                                <span class="php-keyword1">if</span> ((<span class="php-keyword1">isset</span>(<span class="php-var">$paths</span>[(<span class="php-var">$key</span> + <span class="php-num">1</span>)][<span class="php-num">1</span>])) <span class="php-keyword1">AND</span> (<span class="php-keyword2">trim</span>(<span class="php-var">$paths</span>[(<span class="php-var">$key</span> + <span class="php-num">1</span>)][<span class="php-num">1</span>]) == <span class="php-quote">'z'</span>)) {
</span><span id="19319" class="l"><a href="#19319">19319: </a>                                    <span class="php-var">$pie</span> = <span class="php-keyword1">true</span>;
</span><span id="19320" class="l"><a href="#19320">19320: </a>                                }
</span><span id="19321" class="l"><a href="#19321">19321: </a>                                <span class="php-var">$this</span>-&gt;_outellipticalarc(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-var">$ang</span>, <span class="php-var">$angs</span>, <span class="php-var">$angf</span>, <span class="php-var">$pie</span>, <span class="php-num">2</span>);
</span><span id="19322" class="l"><a href="#19322">19322: </a>                                <span class="php-var">$this</span>-&gt;_outPoint(<span class="php-var">$x</span>, <span class="php-var">$y</span>);
</span><span id="19323" class="l"><a href="#19323">19323: </a>                                <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$x</span>);
</span><span id="19324" class="l"><a href="#19324">19324: </a>                                <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$y</span>);
</span><span id="19325" class="l"><a href="#19325">19325: </a>                                <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$x</span>);
</span><span id="19326" class="l"><a href="#19326">19326: </a>                                <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$y</span>);
</span><span id="19327" class="l"><a href="#19327">19327: </a>                                <span class="php-keyword1">if</span> (<span class="php-var">$relcoord</span>) {
</span><span id="19328" class="l"><a href="#19328">19328: </a>                                    <span class="php-var">$xoffset</span> = <span class="php-var">$x</span>;
</span><span id="19329" class="l"><a href="#19329">19329: </a>                                    <span class="php-var">$yoffset</span> = <span class="php-var">$y</span>;
</span><span id="19330" class="l"><a href="#19330">19330: </a>                                }
</span><span id="19331" class="l"><a href="#19331">19331: </a>                            }
</span><span id="19332" class="l"><a href="#19332">19332: </a>                        }
</span><span id="19333" class="l"><a href="#19333">19333: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19334" class="l"><a href="#19334">19334: </a>                    }
</span><span id="19335" class="l"><a href="#19335">19335: </a>                    <span class="php-keyword1">case</span> <span class="php-quote">'Z'</span>: {
</span><span id="19336" class="l"><a href="#19336">19336: </a>                        <span class="php-var">$this</span>-&gt;_out(<span class="php-quote">'h'</span>);
</span><span id="19337" class="l"><a href="#19337">19337: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19338" class="l"><a href="#19338">19338: </a>                    }
</span><span id="19339" class="l"><a href="#19339">19339: </a>                }
</span><span id="19340" class="l"><a href="#19340">19340: </a>            } <span class="php-comment">// end foreach</span>
</span><span id="19341" class="l"><a href="#19341">19341: </a>            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$op</span>)) {
</span><span id="19342" class="l"><a href="#19342">19342: </a>                <span class="php-var">$this</span>-&gt;_out(<span class="php-var">$op</span>);
</span><span id="19343" class="l"><a href="#19343">19343: </a>            }
</span><span id="19344" class="l"><a href="#19344">19344: </a>            <span class="php-keyword1">return</span> <span class="php-keyword1">array</span>(<span class="php-var">$xmin</span>, <span class="php-var">$ymin</span>, (<span class="php-var">$xmax</span> - <span class="php-var">$xmin</span>), (<span class="php-var">$ymax</span> - <span class="php-var">$ymin</span>));
</span><span id="19345" class="l"><a href="#19345">19345: </a>        }
</span><span id="19346" class="l"><a href="#19346">19346: </a>
</span><span id="19347" class="l"><a href="#19347">19347: </a>        <span class="php-comment">/**
</span></span><span id="19348" class="l"><a href="#19348">19348: </a><span class="php-comment">         * Returns the angle in  radiants between two vectors
</span></span><span id="19349" class="l"><a href="#19349">19349: </a><span class="php-comment">         * @param int $x1 X coordiante of first vector point
</span></span><span id="19350" class="l"><a href="#19350">19350: </a><span class="php-comment">         * @param int $y1 Y coordiante of first vector point
</span></span><span id="19351" class="l"><a href="#19351">19351: </a><span class="php-comment">         * @param int $x2 X coordiante of second vector point
</span></span><span id="19352" class="l"><a href="#19352">19352: </a><span class="php-comment">         * @param int $y2 Y coordiante of second vector point
</span></span><span id="19353" class="l"><a href="#19353">19353: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="19354" class="l"><a href="#19354">19354: </a><span class="php-comment">         * @since 5.0.000 (2010-05-04)
</span></span><span id="19355" class="l"><a href="#19355">19355: </a><span class="php-comment">         * @access protected
</span></span><span id="19356" class="l"><a href="#19356">19356: </a><span class="php-comment">         */</span>
</span><span id="19357" class="l"><a href="#19357">19357: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> getVectorsAngle(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>) {
</span><span id="19358" class="l"><a href="#19358">19358: </a>            <span class="php-var">$dprod</span> = (<span class="php-var">$x1</span> * <span class="php-var">$x2</span>) + (<span class="php-var">$y1</span> * <span class="php-var">$y2</span>);
</span><span id="19359" class="l"><a href="#19359">19359: </a>            <span class="php-var">$dist1</span> = <span class="php-keyword2">sqrt</span>((<span class="php-var">$x1</span> * <span class="php-var">$x1</span>) + (<span class="php-var">$y1</span> * <span class="php-var">$y1</span>));
</span><span id="19360" class="l"><a href="#19360">19360: </a>            <span class="php-var">$dist2</span> = <span class="php-keyword2">sqrt</span>((<span class="php-var">$x2</span> * <span class="php-var">$x2</span>) + (<span class="php-var">$y2</span> * <span class="php-var">$y2</span>));
</span><span id="19361" class="l"><a href="#19361">19361: </a>            <span class="php-var">$angle</span> = <span class="php-keyword2">acos</span>(<span class="php-var">$dprod</span> / (<span class="php-var">$dist1</span> * <span class="php-var">$dist2</span>));
</span><span id="19362" class="l"><a href="#19362">19362: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword2">is_nan</span>(<span class="php-var">$angle</span>)) {
</span><span id="19363" class="l"><a href="#19363">19363: </a>                <span class="php-var">$angle</span> = M_PI;
</span><span id="19364" class="l"><a href="#19364">19364: </a>            }
</span><span id="19365" class="l"><a href="#19365">19365: </a>            <span class="php-keyword1">if</span> (((<span class="php-var">$x1</span> * <span class="php-var">$y2</span>) - (<span class="php-var">$x2</span> * <span class="php-var">$y1</span>)) &lt; <span class="php-num">0</span>) {
</span><span id="19366" class="l"><a href="#19366">19366: </a>                <span class="php-var">$angle</span> *= -<span class="php-num">1</span>;
</span><span id="19367" class="l"><a href="#19367">19367: </a>            }
</span><span id="19368" class="l"><a href="#19368">19368: </a>            <span class="php-keyword1">return</span> <span class="php-var">$angle</span>;
</span><span id="19369" class="l"><a href="#19369">19369: </a>        }
</span><span id="19370" class="l"><a href="#19370">19370: </a>
</span><span id="19371" class="l"><a href="#19371">19371: </a>        <span class="php-comment">/**
</span></span><span id="19372" class="l"><a href="#19372">19372: </a><span class="php-comment">         * Sets the opening SVG element handler function for the XML parser. (*** TO BE COMPLETED ***)
</span></span><span id="19373" class="l"><a href="#19373">19373: </a><span class="php-comment">         * @param resource $parser The first parameter, parser, is a reference to the XML parser calling the handler.
</span></span><span id="19374" class="l"><a href="#19374">19374: </a><span class="php-comment">         * @param string $name The second parameter, name, contains the name of the element for which this handler is called. If case-folding is in effect for this parser, the element name will be in uppercase letters. 
</span></span><span id="19375" class="l"><a href="#19375">19375: </a><span class="php-comment">         * @param array $attribs The third parameter, attribs, contains an associative array with the element's attributes (if any). The keys of this array are the attribute names, the values are the attribute values. Attribute names are case-folded on the same criteria as element names. Attribute values are not case-folded. The original order of the attributes can be retrieved by walking through attribs the normal way, using each(). The first key in the array was the first attribute, and so on. 
</span></span><span id="19376" class="l"><a href="#19376">19376: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="19377" class="l"><a href="#19377">19377: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="19378" class="l"><a href="#19378">19378: </a><span class="php-comment">         * @access protected
</span></span><span id="19379" class="l"><a href="#19379">19379: </a><span class="php-comment">         */</span>
</span><span id="19380" class="l"><a href="#19380">19380: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> startSVGElementHandler(<span class="php-var">$parser</span>, <span class="php-var">$name</span>, <span class="php-var">$attribs</span>) {
</span><span id="19381" class="l"><a href="#19381">19381: </a>            <span class="php-comment">// check if we are in clip mode</span>
</span><span id="19382" class="l"><a href="#19382">19382: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;svgclipmode) {
</span><span id="19383" class="l"><a href="#19383">19383: </a>                <span class="php-var">$this</span>-&gt;svgclippaths[<span class="php-var">$this</span>-&gt;svgclipid][] = <span class="php-keyword1">array</span>(<span class="php-quote">'name'</span> =&gt; <span class="php-var">$name</span>, <span class="php-quote">'attribs'</span> =&gt; <span class="php-var">$attribs</span>);
</span><span id="19384" class="l"><a href="#19384">19384: </a>                <span class="php-keyword1">return</span>;
</span><span id="19385" class="l"><a href="#19385">19385: </a>            }
</span><span id="19386" class="l"><a href="#19386">19386: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$this</span>-&gt;svgdefsmode <span class="php-keyword1">AND</span> !<span class="php-keyword2">in_array</span>(<span class="php-var">$name</span>, <span class="php-keyword1">array</span>(<span class="php-quote">'clipPath'</span>, <span class="php-quote">'linearGradient'</span>, <span class="php-quote">'radialGradient'</span>, <span class="php-quote">'stop'</span>))) {
</span><span id="19387" class="l"><a href="#19387">19387: </a>                <span class="php-var">$this</span>-&gt;svgdefs[<span class="php-var">$attribs</span>[<span class="php-quote">'id'</span>]] = <span class="php-keyword1">array</span>(<span class="php-quote">'name'</span> =&gt; <span class="php-var">$name</span>, <span class="php-quote">'attribs'</span> =&gt; <span class="php-var">$attribs</span>);
</span><span id="19388" class="l"><a href="#19388">19388: </a>                <span class="php-keyword1">return</span>;
</span><span id="19389" class="l"><a href="#19389">19389: </a>            }
</span><span id="19390" class="l"><a href="#19390">19390: </a>            <span class="php-var">$clipping</span> = <span class="php-keyword1">false</span>;
</span><span id="19391" class="l"><a href="#19391">19391: </a>            <span class="php-keyword1">if</span> (<span class="php-var">$parser</span> == <span class="php-quote">'clip-path'</span>) {
</span><span id="19392" class="l"><a href="#19392">19392: </a>                <span class="php-comment">// set clipping mode</span>
</span><span id="19393" class="l"><a href="#19393">19393: </a>                <span class="php-var">$clipping</span> = <span class="php-keyword1">true</span>;
</span><span id="19394" class="l"><a href="#19394">19394: </a>            }
</span><span id="19395" class="l"><a href="#19395">19395: </a>            <span class="php-comment">// get styling properties</span>
</span><span id="19396" class="l"><a href="#19396">19396: </a>            <span class="php-var">$prev_svgstyle</span> = <span class="php-var">$this</span>-&gt;svgstyles[(<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;svgstyles) - <span class="php-num">1</span>)]; <span class="php-comment">// previous style</span>
</span><span id="19397" class="l"><a href="#19397">19397: </a>            <span class="php-var">$svgstyle</span> = <span class="php-keyword1">array</span>(); <span class="php-comment">// current style</span>
</span><span id="19398" class="l"><a href="#19398">19398: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'style'</span>])) {
</span><span id="19399" class="l"><a href="#19399">19399: </a>                <span class="php-var">$attribs</span>[<span class="php-quote">'style'</span>] = <span class="php-quote">';'</span>.<span class="php-var">$attribs</span>[<span class="php-quote">'style'</span>];
</span><span id="19400" class="l"><a href="#19400">19400: </a>            }
</span><span id="19401" class="l"><a href="#19401">19401: </a>            <span class="php-keyword1">foreach</span> (<span class="php-var">$prev_svgstyle</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="19402" class="l"><a href="#19402">19402: </a>                <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-var">$key</span>])) {
</span><span id="19403" class="l"><a href="#19403">19403: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$attribs</span>[<span class="php-var">$key</span>] == <span class="php-quote">'inherit'</span>) {
</span><span id="19404" class="l"><a href="#19404">19404: </a>                        <span class="php-var">$svgstyle</span>[<span class="php-var">$key</span>] = <span class="php-var">$val</span>;
</span><span id="19405" class="l"><a href="#19405">19405: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19406" class="l"><a href="#19406">19406: </a>                        <span class="php-var">$svgstyle</span>[<span class="php-var">$key</span>] = <span class="php-var">$attribs</span>[<span class="php-var">$key</span>];
</span><span id="19407" class="l"><a href="#19407">19407: </a>                    }
</span><span id="19408" class="l"><a href="#19408">19408: </a>                } <span class="php-keyword1">elseif</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'style'</span>])) {
</span><span id="19409" class="l"><a href="#19409">19409: </a>                    <span class="php-comment">// CSS style syntax</span>
</span><span id="19410" class="l"><a href="#19410">19410: </a>                    <span class="php-var">$attrval</span> = <span class="php-keyword1">array</span>();
</span><span id="19411" class="l"><a href="#19411">19411: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">preg_match</span>(<span class="php-quote">'/[;\&quot;\s]{1}'</span>.<span class="php-var">$key</span>.<span class="php-quote">'[\s]*:[\s]*([^;\&quot;\s]*)/si'</span>, <span class="php-var">$attribs</span>[<span class="php-quote">'style'</span>], <span class="php-var">$attrval</span>) <span class="php-keyword1">AND</span> <span class="php-keyword1">isset</span>(<span class="php-var">$attrval</span>[<span class="php-num">1</span>])) {
</span><span id="19412" class="l"><a href="#19412">19412: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$attrval</span>[<span class="php-num">1</span>] == <span class="php-quote">'inherit'</span>) {
</span><span id="19413" class="l"><a href="#19413">19413: </a>                            <span class="php-var">$svgstyle</span>[<span class="php-var">$key</span>] = <span class="php-var">$val</span>;
</span><span id="19414" class="l"><a href="#19414">19414: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="19415" class="l"><a href="#19415">19415: </a>                            <span class="php-var">$svgstyle</span>[<span class="php-var">$key</span>] = <span class="php-var">$attrval</span>[<span class="php-num">1</span>];
</span><span id="19416" class="l"><a href="#19416">19416: </a>                        }
</span><span id="19417" class="l"><a href="#19417">19417: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19418" class="l"><a href="#19418">19418: </a>                        <span class="php-comment">// default value</span>
</span><span id="19419" class="l"><a href="#19419">19419: </a>                        <span class="php-var">$svgstyle</span>[<span class="php-var">$key</span>] = <span class="php-var">$this</span>-&gt;svgstyles[<span class="php-num">0</span>][<span class="php-var">$key</span>];
</span><span id="19420" class="l"><a href="#19420">19420: </a>                    }
</span><span id="19421" class="l"><a href="#19421">19421: </a>                } <span class="php-keyword1">else</span> {
</span><span id="19422" class="l"><a href="#19422">19422: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">in_array</span>(<span class="php-var">$key</span>, <span class="php-var">$this</span>-&gt;svginheritprop)) {
</span><span id="19423" class="l"><a href="#19423">19423: </a>                        <span class="php-comment">// inherit previous value</span>
</span><span id="19424" class="l"><a href="#19424">19424: </a>                        <span class="php-var">$svgstyle</span>[<span class="php-var">$key</span>] = <span class="php-var">$val</span>;
</span><span id="19425" class="l"><a href="#19425">19425: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19426" class="l"><a href="#19426">19426: </a>                        <span class="php-comment">// default value</span>
</span><span id="19427" class="l"><a href="#19427">19427: </a>                        <span class="php-var">$svgstyle</span>[<span class="php-var">$key</span>] = <span class="php-var">$this</span>-&gt;svgstyles[<span class="php-num">0</span>][<span class="php-var">$key</span>];
</span><span id="19428" class="l"><a href="#19428">19428: </a>                    }
</span><span id="19429" class="l"><a href="#19429">19429: </a>                }
</span><span id="19430" class="l"><a href="#19430">19430: </a>            }
</span><span id="19431" class="l"><a href="#19431">19431: </a>            <span class="php-comment">// transformation matrix</span>
</span><span id="19432" class="l"><a href="#19432">19432: </a>            <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;svgstyles[(<span class="php-keyword2">count</span>(<span class="php-var">$this</span>-&gt;svgstyles) - <span class="php-num">1</span>)][<span class="php-quote">'transfmatrix'</span>];
</span><span id="19433" class="l"><a href="#19433">19433: </a>            <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'transform'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'transform'</span>])) {
</span><span id="19434" class="l"><a href="#19434">19434: </a>                <span class="php-var">$tm</span> = <span class="php-var">$this</span>-&gt;getTransformationMatrixProduct(<span class="php-var">$tm</span>, <span class="php-var">$this</span>-&gt;getSVGTransformMatrix(<span class="php-var">$attribs</span>[<span class="php-quote">'transform'</span>]));
</span><span id="19435" class="l"><a href="#19435">19435: </a>            }
</span><span id="19436" class="l"><a href="#19436">19436: </a>            <span class="php-var">$svgstyle</span>[<span class="php-quote">'transfmatrix'</span>] = <span class="php-var">$tm</span>;
</span><span id="19437" class="l"><a href="#19437">19437: </a>            <span class="php-comment">// process tag</span>
</span><span id="19438" class="l"><a href="#19438">19438: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$name</span>) {
</span><span id="19439" class="l"><a href="#19439">19439: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'defs'</span>: {
</span><span id="19440" class="l"><a href="#19440">19440: </a>                    <span class="php-var">$this</span>-&gt;svgdefsmode = <span class="php-keyword1">true</span>;
</span><span id="19441" class="l"><a href="#19441">19441: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19442" class="l"><a href="#19442">19442: </a>                }
</span><span id="19443" class="l"><a href="#19443">19443: </a>                <span class="php-comment">// clipPath</span>
</span><span id="19444" class="l"><a href="#19444">19444: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'clipPath'</span>: {
</span><span id="19445" class="l"><a href="#19445">19445: </a>                    <span class="php-var">$this</span>-&gt;svgclipmode = <span class="php-keyword1">true</span>;
</span><span id="19446" class="l"><a href="#19446">19446: </a>                    <span class="php-var">$this</span>-&gt;svgclipid = <span class="php-var">$attribs</span>[<span class="php-quote">'id'</span>];
</span><span id="19447" class="l"><a href="#19447">19447: </a>                    <span class="php-var">$this</span>-&gt;svgclippaths[<span class="php-var">$this</span>-&gt;svgclipid] = <span class="php-keyword1">array</span>();
</span><span id="19448" class="l"><a href="#19448">19448: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19449" class="l"><a href="#19449">19449: </a>                }
</span><span id="19450" class="l"><a href="#19450">19450: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'svg'</span>: {
</span><span id="19451" class="l"><a href="#19451">19451: </a>                    <span class="php-comment">// start of SVG object</span>
</span><span id="19452" class="l"><a href="#19452">19452: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19453" class="l"><a href="#19453">19453: </a>                }
</span><span id="19454" class="l"><a href="#19454">19454: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'g'</span>: {
</span><span id="19455" class="l"><a href="#19455">19455: </a>                    <span class="php-comment">// group together related graphics elements</span>
</span><span id="19456" class="l"><a href="#19456">19456: </a>                    <span class="php-keyword2">array_push</span>(<span class="php-var">$this</span>-&gt;svgstyles, <span class="php-var">$svgstyle</span>);
</span><span id="19457" class="l"><a href="#19457">19457: </a>                    <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19458" class="l"><a href="#19458">19458: </a>                    <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>);
</span><span id="19459" class="l"><a href="#19459">19459: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19460" class="l"><a href="#19460">19460: </a>                }
</span><span id="19461" class="l"><a href="#19461">19461: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'linearGradient'</span>: {
</span><span id="19462" class="l"><a href="#19462">19462: </a>                    <span class="php-var">$this</span>-&gt;svggradientid = <span class="php-var">$attribs</span>[<span class="php-quote">'id'</span>];
</span><span id="19463" class="l"><a href="#19463">19463: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid] = <span class="php-keyword1">array</span>();
</span><span id="19464" class="l"><a href="#19464">19464: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'type'</span>] = <span class="php-num">2</span>;
</span><span id="19465" class="l"><a href="#19465">19465: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'stops'</span>] = <span class="php-keyword1">array</span>();
</span><span id="19466" class="l"><a href="#19466">19466: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'gradientUnits'</span>])) {
</span><span id="19467" class="l"><a href="#19467">19467: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'gradientUnits'</span>] = <span class="php-var">$attribs</span>[<span class="php-quote">'gradientUnits'</span>];
</span><span id="19468" class="l"><a href="#19468">19468: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19469" class="l"><a href="#19469">19469: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'gradientUnits'</span>] = <span class="php-quote">'objectBoundingBox'</span>;
</span><span id="19470" class="l"><a href="#19470">19470: </a>                    }
</span><span id="19471" class="l"><a href="#19471">19471: </a>                    <span class="php-comment">//$attribs['spreadMethod']</span>
</span><span id="19472" class="l"><a href="#19472">19472: </a>                    <span class="php-var">$x1</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x1'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'x1'</span>]:<span class="php-num">0</span>);
</span><span id="19473" class="l"><a href="#19473">19473: </a>                    <span class="php-var">$y1</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'y1'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'y1'</span>]:<span class="php-num">0</span>);
</span><span id="19474" class="l"><a href="#19474">19474: </a>                    <span class="php-var">$x2</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x2'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'x2'</span>]:<span class="php-num">1</span>);
</span><span id="19475" class="l"><a href="#19475">19475: </a>                    <span class="php-var">$y2</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'y2'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'y2'</span>]:<span class="php-num">0</span>);
</span><span id="19476" class="l"><a href="#19476">19476: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x1'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x1'</span>], -<span class="php-num">1</span>) != <span class="php-quote">'%'</span>)) {
</span><span id="19477" class="l"><a href="#19477">19477: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'mode'</span>] = <span class="php-quote">'measure'</span>;
</span><span id="19478" class="l"><a href="#19478">19478: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19479" class="l"><a href="#19479">19479: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'mode'</span>] = <span class="php-quote">'percentage'</span>;
</span><span id="19480" class="l"><a href="#19480">19480: </a>                    }
</span><span id="19481" class="l"><a href="#19481">19481: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'gradientTransform'</span>])) {
</span><span id="19482" class="l"><a href="#19482">19482: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'gradientTransform'</span>] = <span class="php-var">$this</span>-&gt;getSVGTransformMatrix(<span class="php-var">$attribs</span>[<span class="php-quote">'gradientTransform'</span>]);
</span><span id="19483" class="l"><a href="#19483">19483: </a>                    }
</span><span id="19484" class="l"><a href="#19484">19484: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'coords'</span>] = <span class="php-keyword1">array</span>(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>);
</span><span id="19485" class="l"><a href="#19485">19485: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>])) {
</span><span id="19486" class="l"><a href="#19486">19486: </a>                        <span class="php-comment">// gradient is defined on another place</span>
</span><span id="19487" class="l"><a href="#19487">19487: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'xref'</span>] = <span class="php-keyword2">substr</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>], <span class="php-num">1</span>);
</span><span id="19488" class="l"><a href="#19488">19488: </a>                    }
</span><span id="19489" class="l"><a href="#19489">19489: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19490" class="l"><a href="#19490">19490: </a>                }
</span><span id="19491" class="l"><a href="#19491">19491: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'radialGradient'</span>: {
</span><span id="19492" class="l"><a href="#19492">19492: </a>                    <span class="php-var">$this</span>-&gt;svggradientid = <span class="php-var">$attribs</span>[<span class="php-quote">'id'</span>];
</span><span id="19493" class="l"><a href="#19493">19493: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid] = <span class="php-keyword1">array</span>();
</span><span id="19494" class="l"><a href="#19494">19494: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'type'</span>] = <span class="php-num">3</span>;
</span><span id="19495" class="l"><a href="#19495">19495: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'stops'</span>] = <span class="php-keyword1">array</span>();
</span><span id="19496" class="l"><a href="#19496">19496: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'gradientUnits'</span>])) {
</span><span id="19497" class="l"><a href="#19497">19497: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'gradientUnits'</span>] = <span class="php-var">$attribs</span>[<span class="php-quote">'gradientUnits'</span>];
</span><span id="19498" class="l"><a href="#19498">19498: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19499" class="l"><a href="#19499">19499: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'gradientUnits'</span>] = <span class="php-quote">'objectBoundingBox'</span>;
</span><span id="19500" class="l"><a href="#19500">19500: </a>                    }
</span><span id="19501" class="l"><a href="#19501">19501: </a>                    <span class="php-comment">//$attribs['spreadMethod']</span>
</span><span id="19502" class="l"><a href="#19502">19502: </a>                    <span class="php-var">$cx</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>]:<span class="php-num">0.5</span>);
</span><span id="19503" class="l"><a href="#19503">19503: </a>                    <span class="php-var">$cy</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cy'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'cy'</span>]:<span class="php-num">0.5</span>);
</span><span id="19504" class="l"><a href="#19504">19504: </a>                    <span class="php-var">$fx</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'fx'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'fx'</span>]:<span class="php-var">$cx</span>);
</span><span id="19505" class="l"><a href="#19505">19505: </a>                    <span class="php-var">$fy</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'fy'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'fy'</span>]:<span class="php-var">$cy</span>);
</span><span id="19506" class="l"><a href="#19506">19506: </a>                    <span class="php-var">$r</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'r'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'r'</span>]:<span class="php-num">0.5</span>);
</span><span id="19507" class="l"><a href="#19507">19507: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>]) <span class="php-keyword1">AND</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>], -<span class="php-num">1</span>) != <span class="php-quote">'%'</span>)) {
</span><span id="19508" class="l"><a href="#19508">19508: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'mode'</span>] = <span class="php-quote">'measure'</span>;
</span><span id="19509" class="l"><a href="#19509">19509: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19510" class="l"><a href="#19510">19510: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'mode'</span>] = <span class="php-quote">'percentage'</span>;
</span><span id="19511" class="l"><a href="#19511">19511: </a>                    }
</span><span id="19512" class="l"><a href="#19512">19512: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'gradientTransform'</span>])) {
</span><span id="19513" class="l"><a href="#19513">19513: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'gradientTransform'</span>] = <span class="php-var">$this</span>-&gt;getSVGTransformMatrix(<span class="php-var">$attribs</span>[<span class="php-quote">'gradientTransform'</span>]);
</span><span id="19514" class="l"><a href="#19514">19514: </a>                    }
</span><span id="19515" class="l"><a href="#19515">19515: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'coords'</span>] = <span class="php-keyword1">array</span>(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$fx</span>, <span class="php-var">$fy</span>, <span class="php-var">$r</span>);
</span><span id="19516" class="l"><a href="#19516">19516: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>]) <span class="php-keyword1">AND</span> !<span class="php-keyword1">empty</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>])) {
</span><span id="19517" class="l"><a href="#19517">19517: </a>                        <span class="php-comment">// gradient is defined on another place</span>
</span><span id="19518" class="l"><a href="#19518">19518: </a>                        <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'xref'</span>] = <span class="php-keyword2">substr</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>], <span class="php-num">1</span>);
</span><span id="19519" class="l"><a href="#19519">19519: </a>                    }
</span><span id="19520" class="l"><a href="#19520">19520: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19521" class="l"><a href="#19521">19521: </a>                }
</span><span id="19522" class="l"><a href="#19522">19522: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'stop'</span>: {
</span><span id="19523" class="l"><a href="#19523">19523: </a>                    <span class="php-comment">// gradient stops</span>
</span><span id="19524" class="l"><a href="#19524">19524: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">substr</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'offset'</span>], -<span class="php-num">1</span>) == <span class="php-quote">'%'</span>) {
</span><span id="19525" class="l"><a href="#19525">19525: </a>                        <span class="php-var">$offset</span> = <span class="php-keyword2">floatval</span>(<span class="php-keyword2">substr</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'offset'</span>], -<span class="php-num">1</span>)) / <span class="php-num">100</span>;
</span><span id="19526" class="l"><a href="#19526">19526: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19527" class="l"><a href="#19527">19527: </a>                        <span class="php-var">$offset</span> = <span class="php-keyword2">floatval</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'offset'</span>]);
</span><span id="19528" class="l"><a href="#19528">19528: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$offset</span> &gt; <span class="php-num">1</span>) {
</span><span id="19529" class="l"><a href="#19529">19529: </a>                            <span class="php-var">$offset</span> /= <span class="php-num">100</span>;
</span><span id="19530" class="l"><a href="#19530">19530: </a>                        }
</span><span id="19531" class="l"><a href="#19531">19531: </a>                    }
</span><span id="19532" class="l"><a href="#19532">19532: </a>                    <span class="php-var">$stop_color</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$svgstyle</span>[<span class="php-quote">'stop-color'</span>])?<span class="php-var">$this</span>-&gt;convertHTMLColorToDec(<span class="php-var">$svgstyle</span>[<span class="php-quote">'stop-color'</span>]):<span class="php-quote">'black'</span>;
</span><span id="19533" class="l"><a href="#19533">19533: </a>                    <span class="php-var">$opacity</span> = <span class="php-keyword1">isset</span>(<span class="php-var">$svgstyle</span>[<span class="php-quote">'stop-opacity'</span>])?<span class="php-var">$svgstyle</span>[<span class="php-quote">'stop-opacity'</span>]:<span class="php-num">1</span>;
</span><span id="19534" class="l"><a href="#19534">19534: </a>                    <span class="php-var">$this</span>-&gt;svggradients[<span class="php-var">$this</span>-&gt;svggradientid][<span class="php-quote">'stops'</span>][] = <span class="php-keyword1">array</span>(<span class="php-quote">'offset'</span> =&gt; <span class="php-var">$offset</span>, <span class="php-quote">'color'</span> =&gt; <span class="php-var">$stop_color</span>, <span class="php-quote">'opacity'</span> =&gt; <span class="php-var">$opacity</span>);
</span><span id="19535" class="l"><a href="#19535">19535: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19536" class="l"><a href="#19536">19536: </a>                }
</span><span id="19537" class="l"><a href="#19537">19537: </a>                <span class="php-comment">// paths</span>
</span><span id="19538" class="l"><a href="#19538">19538: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'path'</span>: {
</span><span id="19539" class="l"><a href="#19539">19539: </a>                    <span class="php-var">$d</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'d'</span>]);
</span><span id="19540" class="l"><a href="#19540">19540: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clipping</span>) {
</span><span id="19541" class="l"><a href="#19541">19541: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19542" class="l"><a href="#19542">19542: </a>                        <span class="php-var">$this</span>-&gt;SVGPath(<span class="php-var">$d</span>, <span class="php-quote">'CNZ'</span>);
</span><span id="19543" class="l"><a href="#19543">19543: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19544" class="l"><a href="#19544">19544: </a>                        <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19545" class="l"><a href="#19545">19545: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19546" class="l"><a href="#19546">19546: </a>                        <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">1</span>, <span class="php-num">1</span>, <span class="php-quote">'SVGPath'</span>, <span class="php-keyword1">array</span>(<span class="php-var">$d</span>, <span class="php-quote">'CNZ'</span>));
</span><span id="19547" class="l"><a href="#19547">19547: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$obstyle</span>)) {
</span><span id="19548" class="l"><a href="#19548">19548: </a>                            <span class="php-var">$this</span>-&gt;SVGPath(<span class="php-var">$d</span>, <span class="php-var">$obstyle</span>);
</span><span id="19549" class="l"><a href="#19549">19549: </a>                        }
</span><span id="19550" class="l"><a href="#19550">19550: </a>                        <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19551" class="l"><a href="#19551">19551: </a>                    }
</span><span id="19552" class="l"><a href="#19552">19552: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19553" class="l"><a href="#19553">19553: </a>                }
</span><span id="19554" class="l"><a href="#19554">19554: </a>                <span class="php-comment">// shapes</span>
</span><span id="19555" class="l"><a href="#19555">19555: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'rect'</span>: {
</span><span id="19556" class="l"><a href="#19556">19556: </a>                    <span class="php-var">$x</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'x'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19557" class="l"><a href="#19557">19557: </a>                    <span class="php-var">$y</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'y'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'y'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19558" class="l"><a href="#19558">19558: </a>                    <span class="php-var">$w</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'width'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'width'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19559" class="l"><a href="#19559">19559: </a>                    <span class="php-var">$h</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'height'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'height'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19560" class="l"><a href="#19560">19560: </a>                    <span class="php-var">$rx</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'rx'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'rx'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19561" class="l"><a href="#19561">19561: </a>                    <span class="php-var">$ry</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'ry'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'ry'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-var">$rx</span>);
</span><span id="19562" class="l"><a href="#19562">19562: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clipping</span>) {
</span><span id="19563" class="l"><a href="#19563">19563: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19564" class="l"><a href="#19564">19564: </a>                        <span class="php-var">$this</span>-&gt;RoundedRectXY(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-quote">'1111'</span>, <span class="php-quote">'CNZ'</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>());
</span><span id="19565" class="l"><a href="#19565">19565: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19566" class="l"><a href="#19566">19566: </a>                        <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19567" class="l"><a href="#19567">19567: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19568" class="l"><a href="#19568">19568: </a>                        <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'RoundedRectXY'</span>, <span class="php-keyword1">array</span>(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-quote">'1111'</span>, <span class="php-quote">'CNZ'</span>));
</span><span id="19569" class="l"><a href="#19569">19569: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$obstyle</span>)) {
</span><span id="19570" class="l"><a href="#19570">19570: </a>                            <span class="php-var">$this</span>-&gt;RoundedRectXY(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-quote">'1111'</span>, <span class="php-var">$obstyle</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>());
</span><span id="19571" class="l"><a href="#19571">19571: </a>                        }
</span><span id="19572" class="l"><a href="#19572">19572: </a>                        <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19573" class="l"><a href="#19573">19573: </a>                    }
</span><span id="19574" class="l"><a href="#19574">19574: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19575" class="l"><a href="#19575">19575: </a>                }
</span><span id="19576" class="l"><a href="#19576">19576: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'circle'</span>: {
</span><span id="19577" class="l"><a href="#19577">19577: </a>                    <span class="php-var">$cx</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19578" class="l"><a href="#19578">19578: </a>                    <span class="php-var">$cy</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cy'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'cy'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19579" class="l"><a href="#19579">19579: </a>                    <span class="php-var">$r</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'r'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'r'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19580" class="l"><a href="#19580">19580: </a>                    <span class="php-var">$x</span> = <span class="php-var">$cx</span> - <span class="php-var">$r</span>;
</span><span id="19581" class="l"><a href="#19581">19581: </a>                    <span class="php-var">$y</span> = <span class="php-var">$cy</span> - <span class="php-var">$r</span>;
</span><span id="19582" class="l"><a href="#19582">19582: </a>                    <span class="php-var">$w</span> = <span class="php-num">2</span> * <span class="php-var">$r</span>;
</span><span id="19583" class="l"><a href="#19583">19583: </a>                    <span class="php-var">$h</span> = <span class="php-var">$w</span>;
</span><span id="19584" class="l"><a href="#19584">19584: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clipping</span>) {
</span><span id="19585" class="l"><a href="#19585">19585: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19586" class="l"><a href="#19586">19586: </a>                        <span class="php-var">$this</span>-&gt;Circle(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-quote">'CNZ'</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>(), <span class="php-num">8</span>);
</span><span id="19587" class="l"><a href="#19587">19587: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19588" class="l"><a href="#19588">19588: </a>                        <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19589" class="l"><a href="#19589">19589: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19590" class="l"><a href="#19590">19590: </a>                        <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'Circle'</span>, <span class="php-keyword1">array</span>(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-quote">'CNZ'</span>));
</span><span id="19591" class="l"><a href="#19591">19591: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$obstyle</span>)) {
</span><span id="19592" class="l"><a href="#19592">19592: </a>                            <span class="php-var">$this</span>-&gt;Circle(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$r</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-var">$obstyle</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>(), <span class="php-num">8</span>);
</span><span id="19593" class="l"><a href="#19593">19593: </a>                        }
</span><span id="19594" class="l"><a href="#19594">19594: </a>                        <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19595" class="l"><a href="#19595">19595: </a>                    }
</span><span id="19596" class="l"><a href="#19596">19596: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19597" class="l"><a href="#19597">19597: </a>                }
</span><span id="19598" class="l"><a href="#19598">19598: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'ellipse'</span>: {
</span><span id="19599" class="l"><a href="#19599">19599: </a>                    <span class="php-var">$cx</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'cx'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19600" class="l"><a href="#19600">19600: </a>                    <span class="php-var">$cy</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'cy'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'cy'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19601" class="l"><a href="#19601">19601: </a>                    <span class="php-var">$rx</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'rx'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'rx'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19602" class="l"><a href="#19602">19602: </a>                    <span class="php-var">$ry</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'ry'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'ry'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19603" class="l"><a href="#19603">19603: </a>                    <span class="php-var">$x</span> = <span class="php-var">$cx</span> - <span class="php-var">$rx</span>;
</span><span id="19604" class="l"><a href="#19604">19604: </a>                    <span class="php-var">$y</span> = <span class="php-var">$cy</span> - <span class="php-var">$ry</span>;
</span><span id="19605" class="l"><a href="#19605">19605: </a>                    <span class="php-var">$w</span> = <span class="php-num">2</span> * <span class="php-var">$rx</span>;
</span><span id="19606" class="l"><a href="#19606">19606: </a>                    <span class="php-var">$h</span> = <span class="php-num">2</span> * <span class="php-var">$ry</span>;
</span><span id="19607" class="l"><a href="#19607">19607: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$clipping</span>) {
</span><span id="19608" class="l"><a href="#19608">19608: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19609" class="l"><a href="#19609">19609: </a>                        <span class="php-var">$this</span>-&gt;Ellipse(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-quote">'CNZ'</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>(), <span class="php-num">8</span>);
</span><span id="19610" class="l"><a href="#19610">19610: </a>                    } <span class="php-keyword1">else</span> {
</span><span id="19611" class="l"><a href="#19611">19611: </a>                        <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19612" class="l"><a href="#19612">19612: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19613" class="l"><a href="#19613">19613: </a>                        <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'Ellipse'</span>, <span class="php-keyword1">array</span>(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-quote">'CNZ'</span>));
</span><span id="19614" class="l"><a href="#19614">19614: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$obstyle</span>)) {
</span><span id="19615" class="l"><a href="#19615">19615: </a>                            <span class="php-var">$this</span>-&gt;Ellipse(<span class="php-var">$cx</span>, <span class="php-var">$cy</span>, <span class="php-var">$rx</span>, <span class="php-var">$ry</span>, <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-num">360</span>, <span class="php-var">$obstyle</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>(), <span class="php-num">8</span>);
</span><span id="19616" class="l"><a href="#19616">19616: </a>                        }
</span><span id="19617" class="l"><a href="#19617">19617: </a>                        <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19618" class="l"><a href="#19618">19618: </a>                    }
</span><span id="19619" class="l"><a href="#19619">19619: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19620" class="l"><a href="#19620">19620: </a>                }
</span><span id="19621" class="l"><a href="#19621">19621: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'line'</span>: {
</span><span id="19622" class="l"><a href="#19622">19622: </a>                    <span class="php-var">$x1</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x1'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'x1'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19623" class="l"><a href="#19623">19623: </a>                    <span class="php-var">$y1</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'y1'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'y1'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19624" class="l"><a href="#19624">19624: </a>                    <span class="php-var">$x2</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x2'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'x2'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19625" class="l"><a href="#19625">19625: </a>                    <span class="php-var">$y2</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'y2'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'y2'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19626" class="l"><a href="#19626">19626: </a>                    <span class="php-var">$x</span> = <span class="php-var">$x1</span>;
</span><span id="19627" class="l"><a href="#19627">19627: </a>                    <span class="php-var">$y</span> = <span class="php-var">$y1</span>;
</span><span id="19628" class="l"><a href="#19628">19628: </a>                    <span class="php-var">$w</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$x2</span> - <span class="php-var">$x1</span>);
</span><span id="19629" class="l"><a href="#19629">19629: </a>                    <span class="php-var">$h</span> = <span class="php-keyword2">abs</span>(<span class="php-var">$y2</span> - <span class="php-var">$y1</span>);
</span><span id="19630" class="l"><a href="#19630">19630: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$clipping</span>) {
</span><span id="19631" class="l"><a href="#19631">19631: </a>                        <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19632" class="l"><a href="#19632">19632: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19633" class="l"><a href="#19633">19633: </a>                        <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'Line'</span>, <span class="php-keyword1">array</span>(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>));
</span><span id="19634" class="l"><a href="#19634">19634: </a>                        <span class="php-var">$this</span>-&gt;Line(<span class="php-var">$x1</span>, <span class="php-var">$y1</span>, <span class="php-var">$x2</span>, <span class="php-var">$y2</span>);
</span><span id="19635" class="l"><a href="#19635">19635: </a>                        <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19636" class="l"><a href="#19636">19636: </a>                    }
</span><span id="19637" class="l"><a href="#19637">19637: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19638" class="l"><a href="#19638">19638: </a>                }
</span><span id="19639" class="l"><a href="#19639">19639: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'polyline'</span>:
</span><span id="19640" class="l"><a href="#19640">19640: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'polygon'</span>: {
</span><span id="19641" class="l"><a href="#19641">19641: </a>                    <span class="php-var">$points</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'points'</span>])?<span class="php-var">$attribs</span>[<span class="php-quote">'points'</span>]:<span class="php-quote">'0 0'</span>);
</span><span id="19642" class="l"><a href="#19642">19642: </a>                    <span class="php-var">$points</span> = <span class="php-keyword2">trim</span>(<span class="php-var">$points</span>);
</span><span id="19643" class="l"><a href="#19643">19643: </a>                    <span class="php-comment">// note that point may use a complex syntax not covered here</span>
</span><span id="19644" class="l"><a href="#19644">19644: </a>                    <span class="php-var">$points</span> = <span class="php-keyword2">preg_split</span>(<span class="php-quote">'/[\,\s]+/si'</span>, <span class="php-var">$points</span>);
</span><span id="19645" class="l"><a href="#19645">19645: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword2">count</span>(<span class="php-var">$points</span>) &lt; <span class="php-num">4</span>) {
</span><span id="19646" class="l"><a href="#19646">19646: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19647" class="l"><a href="#19647">19647: </a>                    }
</span><span id="19648" class="l"><a href="#19648">19648: </a>                    <span class="php-var">$p</span> = <span class="php-keyword1">array</span>();
</span><span id="19649" class="l"><a href="#19649">19649: </a>                    <span class="php-var">$xmin</span> = <span class="php-num">2147483647</span>;
</span><span id="19650" class="l"><a href="#19650">19650: </a>                    <span class="php-var">$xmax</span> = <span class="php-num">0</span>;
</span><span id="19651" class="l"><a href="#19651">19651: </a>                    <span class="php-var">$ymin</span> = <span class="php-num">2147483647</span>;
</span><span id="19652" class="l"><a href="#19652">19652: </a>                    <span class="php-var">$ymax</span> = <span class="php-num">0</span>;
</span><span id="19653" class="l"><a href="#19653">19653: </a>                    <span class="php-keyword1">foreach</span> (<span class="php-var">$points</span> <span class="php-keyword1">as</span> <span class="php-var">$key</span> =&gt; <span class="php-var">$val</span>) {
</span><span id="19654" class="l"><a href="#19654">19654: </a>                        <span class="php-var">$p</span>[<span class="php-var">$key</span>] = <span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$val</span>, <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>);
</span><span id="19655" class="l"><a href="#19655">19655: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$key</span> % <span class="php-num">2</span>) == <span class="php-num">0</span>) {
</span><span id="19656" class="l"><a href="#19656">19656: </a>                            <span class="php-comment">// X coordinate</span>
</span><span id="19657" class="l"><a href="#19657">19657: </a>                            <span class="php-var">$xmin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$xmin</span>, <span class="php-var">$p</span>[<span class="php-var">$key</span>]);
</span><span id="19658" class="l"><a href="#19658">19658: </a>                            <span class="php-var">$xmax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$xmax</span>, <span class="php-var">$p</span>[<span class="php-var">$key</span>]);
</span><span id="19659" class="l"><a href="#19659">19659: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="19660" class="l"><a href="#19660">19660: </a>                            <span class="php-comment">// Y coordinate</span>
</span><span id="19661" class="l"><a href="#19661">19661: </a>                            <span class="php-var">$ymin</span> = <span class="php-keyword2">min</span>(<span class="php-var">$ymin</span>, <span class="php-var">$p</span>[<span class="php-var">$key</span>]);
</span><span id="19662" class="l"><a href="#19662">19662: </a>                            <span class="php-var">$ymax</span> = <span class="php-keyword2">max</span>(<span class="php-var">$ymax</span>, <span class="php-var">$p</span>[<span class="php-var">$key</span>]);
</span><span id="19663" class="l"><a href="#19663">19663: </a>                        }
</span><span id="19664" class="l"><a href="#19664">19664: </a>                    }
</span><span id="19665" class="l"><a href="#19665">19665: </a>                    <span class="php-var">$x</span> = <span class="php-var">$xmin</span>;
</span><span id="19666" class="l"><a href="#19666">19666: </a>                    <span class="php-var">$y</span> = <span class="php-var">$ymin</span>;
</span><span id="19667" class="l"><a href="#19667">19667: </a>                    <span class="php-var">$w</span> = (<span class="php-var">$xmax</span> - <span class="php-var">$xmin</span>);
</span><span id="19668" class="l"><a href="#19668">19668: </a>                    <span class="php-var">$h</span> = (<span class="php-var">$ymax</span> - <span class="php-var">$ymin</span>);
</span><span id="19669" class="l"><a href="#19669">19669: </a>                    <span class="php-keyword1">if</span> (<span class="php-var">$name</span> == <span class="php-quote">'polyline'</span>) {
</span><span id="19670" class="l"><a href="#19670">19670: </a>                        <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19671" class="l"><a href="#19671">19671: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19672" class="l"><a href="#19672">19672: </a>                        <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'PolyLine'</span>, <span class="php-keyword1">array</span>(<span class="php-var">$p</span>, <span class="php-quote">'CNZ'</span>));
</span><span id="19673" class="l"><a href="#19673">19673: </a>                        <span class="php-var">$this</span>-&gt;PolyLine(<span class="php-var">$p</span>, <span class="php-quote">'D'</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>());
</span><span id="19674" class="l"><a href="#19674">19674: </a>                        <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19675" class="l"><a href="#19675">19675: </a>                    } <span class="php-keyword1">else</span> { <span class="php-comment">// polygon</span>
</span><span id="19676" class="l"><a href="#19676">19676: </a>                        <span class="php-keyword1">if</span> (<span class="php-var">$clipping</span>) {
</span><span id="19677" class="l"><a href="#19677">19677: </a>                            <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19678" class="l"><a href="#19678">19678: </a>                            <span class="php-var">$this</span>-&gt;Polygon(<span class="php-var">$p</span>, <span class="php-quote">'CNZ'</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>(), <span class="php-keyword1">true</span>);
</span><span id="19679" class="l"><a href="#19679">19679: </a>                        } <span class="php-keyword1">else</span> {
</span><span id="19680" class="l"><a href="#19680">19680: </a>                            <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19681" class="l"><a href="#19681">19681: </a>                            <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19682" class="l"><a href="#19682">19682: </a>                            <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>, <span class="php-quote">'Polygon'</span>, <span class="php-keyword1">array</span>(<span class="php-var">$p</span>, <span class="php-quote">'CNZ'</span>));
</span><span id="19683" class="l"><a href="#19683">19683: </a>                            <span class="php-keyword1">if</span> (!<span class="php-keyword1">empty</span>(<span class="php-var">$obstyle</span>)) {
</span><span id="19684" class="l"><a href="#19684">19684: </a>                                <span class="php-var">$this</span>-&gt;Polygon(<span class="php-var">$p</span>, <span class="php-var">$obstyle</span>, <span class="php-keyword1">array</span>(), <span class="php-keyword1">array</span>(), <span class="php-keyword1">true</span>);
</span><span id="19685" class="l"><a href="#19685">19685: </a>                            }
</span><span id="19686" class="l"><a href="#19686">19686: </a>                            <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19687" class="l"><a href="#19687">19687: </a>                        }
</span><span id="19688" class="l"><a href="#19688">19688: </a>                    }
</span><span id="19689" class="l"><a href="#19689">19689: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19690" class="l"><a href="#19690">19690: </a>                }
</span><span id="19691" class="l"><a href="#19691">19691: </a>                <span class="php-comment">// image</span>
</span><span id="19692" class="l"><a href="#19692">19692: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'image'</span>: {
</span><span id="19693" class="l"><a href="#19693">19693: </a>                    <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>]) <span class="php-keyword1">OR</span> <span class="php-keyword1">empty</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>])) {
</span><span id="19694" class="l"><a href="#19694">19694: </a>                        <span class="php-keyword1">break</span>;
</span><span id="19695" class="l"><a href="#19695">19695: </a>                    }
</span><span id="19696" class="l"><a href="#19696">19696: </a>                    <span class="php-var">$x</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'x'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19697" class="l"><a href="#19697">19697: </a>                    <span class="php-var">$y</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'y'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'y'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19698" class="l"><a href="#19698">19698: </a>                    <span class="php-var">$w</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'width'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'width'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19699" class="l"><a href="#19699">19699: </a>                    <span class="php-var">$h</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'height'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'height'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19700" class="l"><a href="#19700">19700: </a>                    <span class="php-var">$img</span> = <span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>];
</span><span id="19701" class="l"><a href="#19701">19701: </a>                    <span class="php-keyword1">if</span> (!<span class="php-var">$clipping</span>) {
</span><span id="19702" class="l"><a href="#19702">19702: </a>                        <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19703" class="l"><a href="#19703">19703: </a>                        <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19704" class="l"><a href="#19704">19704: </a>                        <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>);
</span><span id="19705" class="l"><a href="#19705">19705: </a>                        <span class="php-comment">// fix image path</span>
</span><span id="19706" class="l"><a href="#19706">19706: </a>                        <span class="php-keyword1">if</span> (!<span class="php-var">$this</span>-&gt;empty_string(<span class="php-var">$this</span>-&gt;svgdir) <span class="php-keyword1">AND</span> ((<span class="php-var">$img</span>{<span class="php-num">0</span>} == <span class="php-quote">'.'</span>) <span class="php-keyword1">OR</span> (<span class="php-keyword2">basename</span>(<span class="php-var">$img</span>) == <span class="php-var">$img</span>))) {
</span><span id="19707" class="l"><a href="#19707">19707: </a>                            <span class="php-comment">// replace relative path with full server path</span>
</span><span id="19708" class="l"><a href="#19708">19708: </a>                            <span class="php-var">$img</span> = <span class="php-var">$this</span>-&gt;svgdir.<span class="php-quote">'/'</span>.<span class="php-var">$img</span>;
</span><span id="19709" class="l"><a href="#19709">19709: </a>                        }
</span><span id="19710" class="l"><a href="#19710">19710: </a>                        <span class="php-keyword1">if</span> ((<span class="php-var">$img</span>{<span class="php-num">0</span>} == <span class="php-quote">'/'</span>) <span class="php-keyword1">AND</span> (<span class="php-var">$_SERVER</span>[<span class="php-quote">'DOCUMENT_ROOT'</span>] != <span class="php-quote">'/'</span>)) {
</span><span id="19711" class="l"><a href="#19711">19711: </a>                            <span class="php-var">$findroot</span> = <span class="php-keyword2">strpos</span>(<span class="php-var">$img</span>, <span class="php-var">$_SERVER</span>[<span class="php-quote">'DOCUMENT_ROOT'</span>]);
</span><span id="19712" class="l"><a href="#19712">19712: </a>                            <span class="php-keyword1">if</span> ((<span class="php-var">$findroot</span> === <span class="php-keyword1">false</span>) <span class="php-keyword1">OR</span> (<span class="php-var">$findroot</span> &gt; <span class="php-num">1</span>)) {
</span><span id="19713" class="l"><a href="#19713">19713: </a>                                <span class="php-comment">// replace relative path with full server path</span>
</span><span id="19714" class="l"><a href="#19714">19714: </a>                                <span class="php-var">$img</span> = <span class="php-var">$_SERVER</span>[<span class="php-quote">'DOCUMENT_ROOT'</span>].<span class="php-var">$img</span>;
</span><span id="19715" class="l"><a href="#19715">19715: </a>                            }
</span><span id="19716" class="l"><a href="#19716">19716: </a>                        }
</span><span id="19717" class="l"><a href="#19717">19717: </a>                        <span class="php-var">$img</span> = <span class="php-keyword2">urldecode</span>(<span class="php-var">$img</span>);
</span><span id="19718" class="l"><a href="#19718">19718: </a>                        <span class="php-var">$testscrtype</span> = @<span class="php-keyword2">parse_url</span>(<span class="php-var">$img</span>);
</span><span id="19719" class="l"><a href="#19719">19719: </a>                        <span class="php-keyword1">if</span> (!<span class="php-keyword1">isset</span>(<span class="php-var">$testscrtype</span>[<span class="php-quote">'query'</span>]) <span class="php-keyword1">OR</span> <span class="php-keyword1">empty</span>(<span class="php-var">$testscrtype</span>[<span class="php-quote">'query'</span>])) {
</span><span id="19720" class="l"><a href="#19720">19720: </a>                            <span class="php-comment">// convert URL to server path</span>
</span><span id="19721" class="l"><a href="#19721">19721: </a>                            <span class="php-var">$img</span> = <span class="php-keyword2">str_replace</span>(K_PATH_URL, K_PATH_MAIN, <span class="php-var">$img</span>);
</span><span id="19722" class="l"><a href="#19722">19722: </a>                        }
</span><span id="19723" class="l"><a href="#19723">19723: </a>                        <span class="php-var">$this</span>-&gt;Image(<span class="php-var">$img</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-var">$w</span>, <span class="php-var">$h</span>);
</span><span id="19724" class="l"><a href="#19724">19724: </a>                        <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19725" class="l"><a href="#19725">19725: </a>                    }
</span><span id="19726" class="l"><a href="#19726">19726: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19727" class="l"><a href="#19727">19727: </a>                }
</span><span id="19728" class="l"><a href="#19728">19728: </a>                <span class="php-comment">// text</span>
</span><span id="19729" class="l"><a href="#19729">19729: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'text'</span>:
</span><span id="19730" class="l"><a href="#19730">19730: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'tspan'</span>: {
</span><span id="19731" class="l"><a href="#19731">19731: </a>                    <span class="php-comment">// only basic support - advanced features must be implemented</span>
</span><span id="19732" class="l"><a href="#19732">19732: </a>                    <span class="php-var">$x</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'x'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'x'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19733" class="l"><a href="#19733">19733: </a>                    <span class="php-var">$y</span> = (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'y'</span>])?<span class="php-var">$this</span>-&gt;getHTMLUnitToUnits(<span class="php-var">$attribs</span>[<span class="php-quote">'y'</span>], <span class="php-num">0</span>, <span class="php-var">$this</span>-&gt;svgunit, <span class="php-keyword1">false</span>):<span class="php-num">0</span>);
</span><span id="19734" class="l"><a href="#19734">19734: </a>                    <span class="php-var">$svgstyle</span>[<span class="php-quote">'text-color'</span>] = <span class="php-var">$svgstyle</span>[<span class="php-quote">'fill'</span>];
</span><span id="19735" class="l"><a href="#19735">19735: </a>                    <span class="php-var">$this</span>-&gt;svgtext = <span class="php-quote">''</span>;
</span><span id="19736" class="l"><a href="#19736">19736: </a>                    <span class="php-var">$this</span>-&gt;StartTransform();
</span><span id="19737" class="l"><a href="#19737">19737: </a>                    <span class="php-var">$this</span>-&gt;SVGTransform(<span class="php-var">$tm</span>);
</span><span id="19738" class="l"><a href="#19738">19738: </a>                    <span class="php-var">$obstyle</span> = <span class="php-var">$this</span>-&gt;setSVGStyles(<span class="php-var">$svgstyle</span>, <span class="php-var">$prev_svgstyle</span>, <span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-num">1</span>, <span class="php-num">1</span>);
</span><span id="19739" class="l"><a href="#19739">19739: </a>                    <span class="php-var">$this</span>-&gt;SetXY(<span class="php-var">$x</span>, <span class="php-var">$y</span>, <span class="php-keyword1">true</span>);
</span><span id="19740" class="l"><a href="#19740">19740: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19741" class="l"><a href="#19741">19741: </a>                }
</span><span id="19742" class="l"><a href="#19742">19742: </a>                <span class="php-comment">// use</span>
</span><span id="19743" class="l"><a href="#19743">19743: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'use'</span>: {
</span><span id="19744" class="l"><a href="#19744">19744: </a>                    <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>])) {
</span><span id="19745" class="l"><a href="#19745">19745: </a>                        <span class="php-var">$use</span> = <span class="php-var">$this</span>-&gt;svgdefs[<span class="php-keyword2">substr</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>], <span class="php-num">1</span>)];
</span><span id="19746" class="l"><a href="#19746">19746: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>])) {
</span><span id="19747" class="l"><a href="#19747">19747: </a>                            <span class="php-keyword1">unset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'xlink:href'</span>]);
</span><span id="19748" class="l"><a href="#19748">19748: </a>                        }
</span><span id="19749" class="l"><a href="#19749">19749: </a>                        <span class="php-keyword1">if</span> (<span class="php-keyword1">isset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'id'</span>])) {
</span><span id="19750" class="l"><a href="#19750">19750: </a>                            <span class="php-keyword1">unset</span>(<span class="php-var">$attribs</span>[<span class="php-quote">'id'</span>]);
</span><span id="19751" class="l"><a href="#19751">19751: </a>                        }
</span><span id="19752" class="l"><a href="#19752">19752: </a>                        <span class="php-var">$attribs</span> = <span class="php-keyword2">array_merge</span>(<span class="php-var">$use</span>[<span class="php-quote">'attribs'</span>], <span class="php-var">$attribs</span>);
</span><span id="19753" class="l"><a href="#19753">19753: </a>                        <span class="php-var">$this</span>-&gt;startSVGElementHandler(<span class="php-var">$parser</span>, <span class="php-var">$use</span>[<span class="php-quote">'name'</span>], <span class="php-var">$use</span>[<span class="php-quote">'attribs'</span>]);
</span><span id="19754" class="l"><a href="#19754">19754: </a>                    }
</span><span id="19755" class="l"><a href="#19755">19755: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19756" class="l"><a href="#19756">19756: </a>                }
</span><span id="19757" class="l"><a href="#19757">19757: </a>                <span class="php-keyword1">default</span>: {
</span><span id="19758" class="l"><a href="#19758">19758: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19759" class="l"><a href="#19759">19759: </a>                }
</span><span id="19760" class="l"><a href="#19760">19760: </a>            }
</span><span id="19761" class="l"><a href="#19761">19761: </a>        }
</span><span id="19762" class="l"><a href="#19762">19762: </a>
</span><span id="19763" class="l"><a href="#19763">19763: </a>        <span class="php-comment">/**
</span></span><span id="19764" class="l"><a href="#19764">19764: </a><span class="php-comment">         * Sets the closing SVG element handler function for the XML parser.
</span></span><span id="19765" class="l"><a href="#19765">19765: </a><span class="php-comment">         * @param resource $parser The first parameter, parser, is a reference to the XML parser calling the handler.
</span></span><span id="19766" class="l"><a href="#19766">19766: </a><span class="php-comment">         * @param string $name The second parameter, name, contains the name of the element for which this handler is called. If case-folding is in effect for this parser, the element name will be in uppercase letters. 
</span></span><span id="19767" class="l"><a href="#19767">19767: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="19768" class="l"><a href="#19768">19768: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="19769" class="l"><a href="#19769">19769: </a><span class="php-comment">         * @access protected
</span></span><span id="19770" class="l"><a href="#19770">19770: </a><span class="php-comment">         */</span>
</span><span id="19771" class="l"><a href="#19771">19771: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> endSVGElementHandler(<span class="php-var">$parser</span>, <span class="php-var">$name</span>) {
</span><span id="19772" class="l"><a href="#19772">19772: </a>            <span class="php-keyword1">switch</span>(<span class="php-var">$name</span>) {
</span><span id="19773" class="l"><a href="#19773">19773: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'defs'</span>: {
</span><span id="19774" class="l"><a href="#19774">19774: </a>                    <span class="php-var">$this</span>-&gt;svgdefsmode = <span class="php-keyword1">false</span>;
</span><span id="19775" class="l"><a href="#19775">19775: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19776" class="l"><a href="#19776">19776: </a>                }
</span><span id="19777" class="l"><a href="#19777">19777: </a>                <span class="php-comment">// clipPath</span>
</span><span id="19778" class="l"><a href="#19778">19778: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'clipPath'</span>: {
</span><span id="19779" class="l"><a href="#19779">19779: </a>                    <span class="php-var">$this</span>-&gt;svgclipmode = <span class="php-keyword1">false</span>;
</span><span id="19780" class="l"><a href="#19780">19780: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19781" class="l"><a href="#19781">19781: </a>                }
</span><span id="19782" class="l"><a href="#19782">19782: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'g'</span>: {
</span><span id="19783" class="l"><a href="#19783">19783: </a>                    <span class="php-comment">// ungroup: remove last style from array</span>
</span><span id="19784" class="l"><a href="#19784">19784: </a>                    <span class="php-keyword2">array_pop</span>(<span class="php-var">$this</span>-&gt;svgstyles);
</span><span id="19785" class="l"><a href="#19785">19785: </a>                    <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19786" class="l"><a href="#19786">19786: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19787" class="l"><a href="#19787">19787: </a>                }
</span><span id="19788" class="l"><a href="#19788">19788: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'text'</span>:
</span><span id="19789" class="l"><a href="#19789">19789: </a>                <span class="php-keyword1">case</span> <span class="php-quote">'tspan'</span>: {
</span><span id="19790" class="l"><a href="#19790">19790: </a>                    <span class="php-comment">// print text</span>
</span><span id="19791" class="l"><a href="#19791">19791: </a>                    <span class="php-var">$this</span>-&gt;Cell(<span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-keyword2">trim</span>(<span class="php-var">$this</span>-&gt;svgtext), <span class="php-num">0</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-quote">''</span>, <span class="php-num">0</span>, <span class="php-keyword1">false</span>, <span class="php-quote">'L'</span>, <span class="php-quote">'T'</span>);
</span><span id="19792" class="l"><a href="#19792">19792: </a>                    <span class="php-var">$this</span>-&gt;StopTransform();
</span><span id="19793" class="l"><a href="#19793">19793: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19794" class="l"><a href="#19794">19794: </a>                }
</span><span id="19795" class="l"><a href="#19795">19795: </a>                <span class="php-keyword1">default</span>: {
</span><span id="19796" class="l"><a href="#19796">19796: </a>                    <span class="php-keyword1">break</span>;
</span><span id="19797" class="l"><a href="#19797">19797: </a>                }
</span><span id="19798" class="l"><a href="#19798">19798: </a>            }
</span><span id="19799" class="l"><a href="#19799">19799: </a>        }
</span><span id="19800" class="l"><a href="#19800">19800: </a>
</span><span id="19801" class="l"><a href="#19801">19801: </a>        <span class="php-comment">/**
</span></span><span id="19802" class="l"><a href="#19802">19802: </a><span class="php-comment">         * Sets the character data handler function for the XML parser.
</span></span><span id="19803" class="l"><a href="#19803">19803: </a><span class="php-comment">         * @param resource $parser The first parameter, parser, is a reference to the XML parser calling the handler.
</span></span><span id="19804" class="l"><a href="#19804">19804: </a><span class="php-comment">         * @param string $data The second parameter, data, contains the character data as a string. 
</span></span><span id="19805" class="l"><a href="#19805">19805: </a><span class="php-comment">         * @author Nicola Asuni
</span></span><span id="19806" class="l"><a href="#19806">19806: </a><span class="php-comment">         * @since 5.0.000 (2010-05-02)
</span></span><span id="19807" class="l"><a href="#19807">19807: </a><span class="php-comment">         * @access protected
</span></span><span id="19808" class="l"><a href="#19808">19808: </a><span class="php-comment">         */</span>
</span><span id="19809" class="l"><a href="#19809">19809: </a>        <span class="php-keyword1">protected</span> <span class="php-keyword1">function</span> segSVGContentHandler(<span class="php-var">$parser</span>, <span class="php-var">$data</span>) {
</span><span id="19810" class="l"><a href="#19810">19810: </a>            <span class="php-var">$this</span>-&gt;svgtext .= <span class="php-var">$data</span>;
</span><span id="19811" class="l"><a href="#19811">19811: </a>        }
</span><span id="19812" class="l"><a href="#19812">19812: </a>
</span><span id="19813" class="l"><a href="#19813">19813: </a>    } <span class="php-comment">// END OF TCPDF CLASS</span>
</span><span id="19814" class="l"><a href="#19814">19814: </a>}
</span><span id="19815" class="l"><a href="#19815">19815: </a><span class="php-comment">//============================================================+</span>
</span><span id="19816" class="l"><a href="#19816">19816: </a><span class="php-comment">// END OF FILE</span>
</span><span id="19817" class="l"><a href="#19817">19817: </a><span class="php-comment">//============================================================+</span>
</span><span id="19818" class="l"><a href="#19818">19818: </a><span class="xlang">?&gt;</span>
</span><span id="19819" class="l"><a href="#19819">19819: </a></span></code></pre>

	<div id="footer">
		 API documentation generated by <a href="http://apigen.org">ApiGen</a>
	</div>
</div>
</div>
<script src="resources/combined.js?cd021bc814832c24a7cec5319ea03335bfba1caf"></script>
<script src="elementlist.js?364fb370aee78d67df06e4cb04b21088d64700a9"></script>
</body>
</html>
